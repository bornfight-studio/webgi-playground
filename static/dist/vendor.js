/*! For license information please see vendor.js.LICENSE.txt */
(self.webpackChunkb_creative=self.webpackChunkb_creative||[]).push([[736],{92:(e,t,n)=>{"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,{i:()=>on});var i,s,o,a,l,c,u,h,p,d,f,m,g,_=function(){return i||"undefined"!=typeof window&&(i=window.gsap)&&i.registerPlugin&&i},v=1,y=[],b=[],A=[],w=Date.now,x=function(e,t){return t},E=function(e,t){return~A.indexOf(e)&&A[A.indexOf(e)+1][t]},C=function(e){return!!~d.indexOf(e)},S=function(e,t,n,r,i){return e.addEventListener(t,n,{passive:!r,capture:!!i})},M=function(e,t,n,r){return e.removeEventListener(t,n,!!r)},T="scrollLeft",D="scrollTop",I=function(){return f&&f.isPressed||b.cache++},P=function(e,t){var n=function n(r){if(r||0===r){v&&(o.history.scrollRestoration="manual");var i=f&&f.isPressed;r=n.v=Math.round(r)||(f&&f.iOS?1:0),e(r),n.cacheID=b.cache,i&&x("ss",r)}else(t||b.cache!==n.cacheID||x("ref"))&&(n.cacheID=b.cache,n.v=e());return n.v+n.offset};return n.offset=0,e&&n},R={s:T,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:P((function(e){return arguments.length?o.scrollTo(e,B.sc()):o.pageXOffset||a[T]||l[T]||c[T]||0}))},B={s:D,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:R,sc:P((function(e){return arguments.length?o.scrollTo(R.sc(),e):o.pageYOffset||a[D]||l[D]||c[D]||0}))},k=function(e,t){return(t&&t._ctx&&t._ctx.selector||i.utils.toArray)(e)[0]||("string"==typeof e&&!1!==i.config().nullTargetWarn?console.warn("Element not found:",e):null)},O=function(e,t){var n=t.s,r=t.sc;C(e)&&(e=a.scrollingElement||l);var s=b.indexOf(e),o=r===B.sc?1:2;!~s&&(s=b.push(e)-1),b[s+o]||S(e,"scroll",I);var c=b[s+o],u=c||(b[s+o]=P(E(e,n),!0)||(C(e)?r:P((function(t){return arguments.length?e[n]=t:e[n]}))));return u.target=e,c||(u.smooth="smooth"===i.getProperty(e,"scrollBehavior")),u},L=function(e,t,n){var r=e,i=e,s=w(),o=s,a=t||50,l=Math.max(500,3*a),c=function(e,t){var l=w();t||l-s>a?(i=r,r=e,o=s,s=l):n?r+=e:r=i+(e-i)/(l-o)*(s-o)};return{update:c,reset:function(){i=r=n?0:r,o=s=0},getVelocity:function(e){var t=o,a=i,u=w();return(e||0===e)&&e!==r&&c(e),s===o||u-o>l?0:(r+(n?a:-a))/((n?u:s)-t)*1e3}}},F=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},U=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},N=function(){var e,t,n,r;(p=i.core.globals().ScrollTrigger)&&p.core&&(e=p.core,t=e.bridge||{},n=e._scrollers,r=e._proxies,n.push.apply(n,b),r.push.apply(r,A),b=n,A=r,x=function(e,n){return t[e](n)})},j=function(e){return(i=e||_())&&"undefined"!=typeof document&&document.body&&(o=window,a=document,l=a.documentElement,c=a.body,d=[o,a,l,c],i.utils.clamp,g=i.core.context||function(){},h="onpointerenter"in c?"pointer":"mouse",u=z.isTouch=o.matchMedia&&o.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in o||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,m=z.eventTypes=("ontouchstart"in l?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in l?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return v=0}),500),N(),s=1),s};R.op=B,b.cache=0;var z=function(){function e(e){this.init(e)}var t,n,d;return e.prototype.init=function(e){s||j(i)||console.warn("Please gsap.registerPlugin(Observer)"),p||N();var t=e.tolerance,n=e.dragMinimum,r=e.type,d=e.target,_=e.lineHeight,v=e.debounce,b=e.preventDefault,A=e.onStop,x=e.onStopDelay,E=e.ignore,T=e.wheelSpeed,D=e.event,P=e.onDragStart,z=e.onDragEnd,G=e.onDrag,V=e.onPress,H=e.onRelease,Q=e.onRight,W=e.onLeft,q=e.onUp,X=e.onDown,Y=e.onChangeX,K=e.onChangeY,J=e.onChange,Z=e.onToggleX,$=e.onToggleY,ee=e.onHover,te=e.onHoverEnd,ne=e.onMove,re=e.ignoreCheck,ie=e.isNormalizer,se=e.onGestureStart,oe=e.onGestureEnd,ae=e.onWheel,le=e.onEnable,ce=e.onDisable,ue=e.onClick,he=e.scrollSpeed,pe=e.capture,de=e.allowClicks,fe=e.lockAxis,me=e.onLockAxis;this.target=d=k(d)||l,this.vars=e,E&&(E=i.utils.toArray(E)),t=t||1e-9,n=n||0,T=T||1,he=he||1,r=r||"wheel,touch,pointer",v=!1!==v,_||(_=parseFloat(o.getComputedStyle(c).lineHeight)||22);var ge,_e,ve,ye,be,Ae,we,xe=this,Ee=0,Ce=0,Se=O(d,R),Me=O(d,B),Te=Se(),De=Me(),Ie=~r.indexOf("touch")&&!~r.indexOf("pointer")&&"pointerdown"===m[0],Pe=C(d),Re=d.ownerDocument||a,Be=[0,0,0],ke=[0,0,0],Oe=0,Le=function(){return Oe=w()},Fe=function(e,t){return(xe.event=e)&&E&&~E.indexOf(e.target)||t&&Ie&&"touch"!==e.pointerType||re&&re(e,t)},Ue=function(){var e=xe.deltaX=U(Be),n=xe.deltaY=U(ke),r=Math.abs(e)>=t,i=Math.abs(n)>=t;J&&(r||i)&&J(xe,e,n,Be,ke),r&&(Q&&xe.deltaX>0&&Q(xe),W&&xe.deltaX<0&&W(xe),Y&&Y(xe),Z&&xe.deltaX<0!=Ee<0&&Z(xe),Ee=xe.deltaX,Be[0]=Be[1]=Be[2]=0),i&&(X&&xe.deltaY>0&&X(xe),q&&xe.deltaY<0&&q(xe),K&&K(xe),$&&xe.deltaY<0!=Ce<0&&$(xe),Ce=xe.deltaY,ke[0]=ke[1]=ke[2]=0),(ye||ve)&&(ne&&ne(xe),ve&&(G(xe),ve=!1),ye=!1),Ae&&!(Ae=!1)&&me&&me(xe),be&&(ae(xe),be=!1),ge=0},Ne=function(e,t,n){Be[n]+=e,ke[n]+=t,xe._vx.update(e),xe._vy.update(t),v?ge||(ge=requestAnimationFrame(Ue)):Ue()},je=function(e,t){fe&&!we&&(xe.axis=we=Math.abs(e)>Math.abs(t)?"x":"y",Ae=!0),"y"!==we&&(Be[2]+=e,xe._vx.update(e,!0)),"x"!==we&&(ke[2]+=t,xe._vy.update(t,!0)),v?ge||(ge=requestAnimationFrame(Ue)):Ue()},ze=function(e){if(!Fe(e,1)){var t=(e=F(e,b)).clientX,r=e.clientY,i=t-xe.x,s=r-xe.y,o=xe.isDragging;xe.x=t,xe.y=r,(o||Math.abs(xe.startX-t)>=n||Math.abs(xe.startY-r)>=n)&&(G&&(ve=!0),o||(xe.isDragging=!0),je(i,s),o||P&&P(xe))}},Ge=xe.onPress=function(e){Fe(e,1)||e&&e.button||(xe.axis=we=null,_e.pause(),xe.isPressed=!0,e=F(e),Ee=Ce=0,xe.startX=xe.x=e.clientX,xe.startY=xe.y=e.clientY,xe._vx.reset(),xe._vy.reset(),S(ie?d:Re,m[1],ze,b,!0),xe.deltaX=xe.deltaY=0,V&&V(xe))},Ve=xe.onRelease=function(e){if(!Fe(e,1)){M(ie?d:Re,m[1],ze,!0);var t=!isNaN(xe.y-xe.startY),n=xe.isDragging&&(Math.abs(xe.x-xe.startX)>3||Math.abs(xe.y-xe.startY)>3),r=F(e);!n&&t&&(xe._vx.reset(),xe._vy.reset(),b&&de&&i.delayedCall(.08,(function(){if(w()-Oe>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(Re.createEvent){var t=Re.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,o,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}}))),xe.isDragging=xe.isGesturing=xe.isPressed=!1,A&&!ie&&_e.restart(!0),z&&n&&z(xe),H&&H(xe,n)}},He=function(e){return e.touches&&e.touches.length>1&&(xe.isGesturing=!0)&&se(e,xe.isDragging)},Qe=function(){return(xe.isGesturing=!1)||oe(xe)},We=function(e){if(!Fe(e)){var t=Se(),n=Me();Ne((t-Te)*he,(n-De)*he,1),Te=t,De=n,A&&_e.restart(!0)}},qe=function(e){if(!Fe(e)){e=F(e,b),ae&&(be=!0);var t=(1===e.deltaMode?_:2===e.deltaMode?o.innerHeight:1)*T;Ne(e.deltaX*t,e.deltaY*t,0),A&&!ie&&_e.restart(!0)}},Xe=function(e){if(!Fe(e)){var t=e.clientX,n=e.clientY,r=t-xe.x,i=n-xe.y;xe.x=t,xe.y=n,ye=!0,(r||i)&&je(r,i)}},Ye=function(e){xe.event=e,ee(xe)},Ke=function(e){xe.event=e,te(xe)},Je=function(e){return Fe(e)||F(e,b)&&ue(xe)};_e=xe._dc=i.delayedCall(x||.25,(function(){xe._vx.reset(),xe._vy.reset(),_e.pause(),A&&A(xe)})).pause(),xe.deltaX=xe.deltaY=0,xe._vx=L(0,50,!0),xe._vy=L(0,50,!0),xe.scrollX=Se,xe.scrollY=Me,xe.isDragging=xe.isGesturing=xe.isPressed=!1,g(this),xe.enable=function(e){return xe.isEnabled||(S(Pe?Re:d,"scroll",I),r.indexOf("scroll")>=0&&S(Pe?Re:d,"scroll",We,b,pe),r.indexOf("wheel")>=0&&S(d,"wheel",qe,b,pe),(r.indexOf("touch")>=0&&u||r.indexOf("pointer")>=0)&&(S(d,m[0],Ge,b,pe),S(Re,m[2],Ve),S(Re,m[3],Ve),de&&S(d,"click",Le,!1,!0),ue&&S(d,"click",Je),se&&S(Re,"gesturestart",He),oe&&S(Re,"gestureend",Qe),ee&&S(d,h+"enter",Ye),te&&S(d,h+"leave",Ke),ne&&S(d,h+"move",Xe)),xe.isEnabled=!0,e&&e.type&&Ge(e),le&&le(xe)),xe},xe.disable=function(){xe.isEnabled&&(y.filter((function(e){return e!==xe&&C(e.target)})).length||M(Pe?Re:d,"scroll",I),xe.isPressed&&(xe._vx.reset(),xe._vy.reset(),M(ie?d:Re,m[1],ze,!0)),M(Pe?Re:d,"scroll",We,pe),M(d,"wheel",qe,pe),M(d,m[0],Ge,pe),M(Re,m[2],Ve),M(Re,m[3],Ve),M(d,"click",Le,!0),M(d,"click",Je),M(Re,"gesturestart",He),M(Re,"gestureend",Qe),M(d,h+"enter",Ye),M(d,h+"leave",Ke),M(d,h+"move",Xe),xe.isEnabled=xe.isPressed=xe.isDragging=!1,ce&&ce(xe))},xe.kill=xe.revert=function(){xe.disable();var e=y.indexOf(xe);e>=0&&y.splice(e,1),f===xe&&(f=0)},y.push(xe),ie&&C(d)&&(f=xe),xe.enable(D)},t=e,(n=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&r(t.prototype,n),d&&r(t,d),e}();z.version="3.12.2",z.create=function(e){return new z(e)},z.register=j,z.getAll=function(){return y.slice()},z.getById=function(e){return y.filter((function(t){return t.vars.id===e}))[0]},_()&&i.registerPlugin(z);var G,V,H,Q,W,q,X,Y,K,J,Z,$,ee,te,ne,re,ie,se,oe,ae,le,ce,ue,he,pe,de,fe,me,ge,_e,ve,ye,be,Ae,we,xe,Ee=1,Ce=Date.now,Se=Ce(),Me=0,Te=0,De=function(e,t,n){var r=Ve(e)&&("clamp("===e.substr(0,6)||e.indexOf("max")>-1);return n["_"+t+"Clamp"]=r,r?e.substr(6,e.length-7):e},Ie=function(e,t){return!t||Ve(e)&&"clamp("===e.substr(0,6)?e:"clamp("+e+")"},Pe=function e(){return Te&&requestAnimationFrame(e)},Re=function(){return te=1},Be=function(){return te=0},ke=function(e){return e},Oe=function(e){return Math.round(1e5*e)/1e5||0},Le=function(){return"undefined"!=typeof window},Fe=function(){return G||Le()&&(G=window.gsap)&&G.registerPlugin&&G},Ue=function(e){return!!~X.indexOf(e)},Ne=function(e){return("Height"===e?ve:H["inner"+e])||W["client"+e]||q["client"+e]},je=function(e){return E(e,"getBoundingClientRect")||(Ue(e)?function(){return Zt.width=H.innerWidth,Zt.height=ve,Zt}:function(){return pt(e)})},ze=function(e,t){var n=t.s,r=t.d2,i=t.d,s=t.a;return Math.max(0,(n="scroll"+r)&&(s=E(e,n))?s()-je(e)()[i]:Ue(e)?(W[n]||q[n])-Ne(r):e[n]-e["offset"+r])},Ge=function(e,t){for(var n=0;n<oe.length;n+=3)(!t||~t.indexOf(oe[n+1]))&&e(oe[n],oe[n+1],oe[n+2])},Ve=function(e){return"string"==typeof e},He=function(e){return"function"==typeof e},Qe=function(e){return"number"==typeof e},We=function(e){return"object"==typeof e},qe=function(e,t,n){return e&&e.progress(t?0:1)&&n&&e.pause()},Xe=function(e,t){if(e.enabled){var n=t(e);n&&n.totalTime&&(e.callbackAnimation=n)}},Ye=Math.abs,Ke="left",Je="right",Ze="bottom",$e="width",et="height",tt="Right",nt="Left",rt="Top",it="Bottom",st="padding",ot="margin",at="Width",lt="Height",ct="px",ut=function(e){return H.getComputedStyle(e)},ht=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},pt=function(e,t){var n=t&&"matrix(1, 0, 0, 1, 0, 0)"!==ut(e)[ne]&&G.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),r=e.getBoundingClientRect();return n&&n.progress(0).kill(),r},dt=function(e,t){var n=t.d2;return e["offset"+n]||e["client"+n]||0},ft=function(e){var t,n=[],r=e.labels,i=e.duration();for(t in r)n.push(r[t]/i);return n},mt=function(e){var t=G.utils.snap(e),n=Array.isArray(e)&&e.slice(0).sort((function(e,t){return e-t}));return n?function(e,r,i){var s;if(void 0===i&&(i=.001),!r)return t(e);if(r>0){for(e-=i,s=0;s<n.length;s++)if(n[s]>=e)return n[s];return n[s-1]}for(s=n.length,e+=i;s--;)if(n[s]<=e)return n[s];return n[0]}:function(n,r,i){void 0===i&&(i=.001);var s=t(n);return!r||Math.abs(s-n)<i||s-n<0==r<0?s:t(r<0?n-e:n+e)}},gt=function(e,t,n,r){return n.split(",").forEach((function(n){return e(t,n,r)}))},_t=function(e,t,n,r,i){return e.addEventListener(t,n,{passive:!r,capture:!!i})},vt=function(e,t,n,r){return e.removeEventListener(t,n,!!r)},yt=function(e,t,n){(n=n&&n.wheelHandler)&&(e(t,"wheel",n),e(t,"touchmove",n))},bt={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},At={toggleActions:"play",anticipatePin:0},wt={top:0,left:0,center:.5,bottom:1,right:1},xt=function(e,t){if(Ve(e)){var n=e.indexOf("="),r=~n?+(e.charAt(n-1)+1)*parseFloat(e.substr(n+1)):0;~n&&(e.indexOf("%")>n&&(r*=t/100),e=e.substr(0,n-1)),e=r+(e in wt?wt[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Et=function(e,t,n,r,i,s,o,a){var l=i.startColor,c=i.endColor,u=i.fontSize,h=i.indent,p=i.fontWeight,d=Q.createElement("div"),f=Ue(n)||"fixed"===E(n,"pinType"),m=-1!==e.indexOf("scroller"),g=f?q:n,_=-1!==e.indexOf("start"),v=_?l:c,y="border-color:"+v+";font-size:"+u+";color:"+v+";font-weight:"+p+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return y+="position:"+((m||a)&&f?"fixed;":"absolute;"),(m||a||!f)&&(y+=(r===B?Je:Ze)+":"+(s+parseFloat(h))+"px;"),o&&(y+="box-sizing:border-box;text-align:left;width:"+o.offsetWidth+"px;"),d._isStart=_,d.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),d.style.cssText=y,d.innerText=t||0===t?e+"-"+t:e,g.children[0]?g.insertBefore(d,g.children[0]):g.appendChild(d),d._offset=d["offset"+r.op.d2],Ct(d,0,r,_),d},Ct=function(e,t,n,r){var i={display:"block"},s=n[r?"os2":"p2"],o=n[r?"p2":"os2"];e._isFlipped=r,i[n.a+"Percent"]=r?-100:0,i[n.a]=r?"1px":0,i["border"+s+at]=1,i["border"+o+at]=0,i[n.p]=t+"px",G.set(e,i)},St=[],Mt={},Tt=function(){return Ce()-Me>34&&(be||(be=requestAnimationFrame(Qt)))},Dt=function(){(!ue||!ue.isPressed||ue.startX>q.clientWidth)&&(b.cache++,ue?be||(be=requestAnimationFrame(Qt)):Qt(),Me||Ot("scrollStart"),Me=Ce())},It=function(){de=H.innerWidth,pe=H.innerHeight},Pt=function(){b.cache++,!ee&&!ce&&!Q.fullscreenElement&&!Q.webkitFullscreenElement&&(!he||de!==H.innerWidth||Math.abs(H.innerHeight-pe)>.25*H.innerHeight)&&Y.restart(!0)},Rt={},Bt=[],kt=function e(){return vt(on,"scrollEnd",e)||Gt(!0)},Ot=function(e){return Rt[e]&&Rt[e].map((function(e){return e()}))||Bt},Lt=[],Ft=function(e){for(var t=0;t<Lt.length;t+=5)(!e||Lt[t+4]&&Lt[t+4].query===e)&&(Lt[t].style.cssText=Lt[t+1],Lt[t].getBBox&&Lt[t].setAttribute("transform",Lt[t+2]||""),Lt[t+3].uncache=1)},Ut=function(e,t){var n;for(re=0;re<St.length;re++)!(n=St[re])||t&&n._ctx!==t||(e?n.kill(1):n.revert(!0,!0));t&&Ft(t),t||Ot("revert")},Nt=function(e,t){b.cache++,(t||!Ae)&&b.forEach((function(e){return He(e)&&e.cacheID++&&(e.rec=0)})),Ve(e)&&(H.history.scrollRestoration=ge=e)},jt=0,zt=function(){q.appendChild(_e),ve=_e.offsetHeight||H.innerHeight,q.removeChild(_e)},Gt=function(e,t){if(!Me||e){zt(),Ae=on.isRefreshing=!0,b.forEach((function(e){return He(e)&&++e.cacheID&&(e.rec=e())}));var n=Ot("refreshInit");ae&&on.sort(),t||Ut(),b.forEach((function(e){He(e)&&(e.smooth&&(e.target.style.scrollBehavior="auto"),e(0))})),St.slice(0).forEach((function(e){return e.refresh()})),St.forEach((function(e,t){if(e._subPinOffset&&e.pin){var n=e.vars.horizontal?"offsetWidth":"offsetHeight",r=e.pin[n];e.revert(!0,1),e.adjustPinSpacing(e.pin[n]-r),e.refresh()}})),St.forEach((function(e){var t=ze(e.scroller,e._dir);("max"===e.vars.end||e._endClamp&&e.end>t)&&e.setPositions(e.start,Math.max(e.start+1,t),!0)})),n.forEach((function(e){return e&&e.render&&e.render(-1)})),b.forEach((function(e){He(e)&&(e.smooth&&requestAnimationFrame((function(){return e.target.style.scrollBehavior="smooth"})),e.rec&&e(e.rec))})),Nt(ge,1),Y.pause(),jt++,Ae=2,Qt(2),St.forEach((function(e){return He(e.vars.onRefresh)&&e.vars.onRefresh(e)})),Ae=on.isRefreshing=!1,Ot("refresh")}else _t(on,"scrollEnd",kt)},Vt=0,Ht=1,Qt=function(e){if(!Ae||2===e){on.isUpdating=!0,xe&&xe.update(0);var t=St.length,n=Ce(),r=n-Se>=50,i=t&&St[0].scroll();if(Ht=Vt>i?-1:1,Ae||(Vt=i),r&&(Me&&!te&&n-Me>200&&(Me=0,Ot("scrollEnd")),Z=Se,Se=n),Ht<0){for(re=t;re-- >0;)St[re]&&St[re].update(0,r);Ht=1}else for(re=0;re<t;re++)St[re]&&St[re].update(0,r);on.isUpdating=!1}be=0},Wt=[Ke,"top",Ze,Je,ot+it,ot+tt,ot+rt,ot+nt,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],qt=Wt.concat([$e,et,"boxSizing","max"+at,"max"+lt,"position",ot,st,st+rt,st+tt,st+it,st+nt]),Xt=function(e,t,n,r){if(!e._gsap.swappedIn){for(var i,s=Wt.length,o=t.style,a=e.style;s--;)o[i=Wt[s]]=n[i];o.position="absolute"===n.position?"absolute":"relative","inline"===n.display&&(o.display="inline-block"),a[Ze]=a[Je]="auto",o.flexBasis=n.flexBasis||"auto",o.overflow="visible",o.boxSizing="border-box",o[$e]=dt(e,R)+ct,o[et]=dt(e,B)+ct,o[st]=a[ot]=a.top=a[Ke]="0",Kt(r),a[$e]=a["max"+at]=n[$e],a[et]=a["max"+lt]=n[et],a[st]=n[st],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},Yt=/([A-Z])/g,Kt=function(e){if(e){var t,n,r=e.t.style,i=e.length,s=0;for((e.t._gsap||G.core.getCache(e.t)).uncache=1;s<i;s+=2)n=e[s+1],t=e[s],n?r[t]=n:r[t]&&r.removeProperty(t.replace(Yt,"-$1").toLowerCase())}},Jt=function(e){for(var t=qt.length,n=e.style,r=[],i=0;i<t;i++)r.push(qt[i],n[qt[i]]);return r.t=e,r},Zt={left:0,top:0},$t=function(e,t,n,r,i,s,o,a,l,c,u,h,p,d){He(e)&&(e=e(a)),Ve(e)&&"max"===e.substr(0,3)&&(e=h+("="===e.charAt(4)?xt("0"+e.substr(3),n):0));var f,m,g,_=p?p.time():0;if(p&&p.seek(0),isNaN(e)||(e=+e),Qe(e))p&&(e=G.utils.mapRange(p.scrollTrigger.start,p.scrollTrigger.end,0,h,e)),o&&Ct(o,n,r,!0);else{He(t)&&(t=t(a));var v,y,b,A,w=(e||"0").split(" ");g=k(t,a)||q,(v=pt(g)||{})&&(v.left||v.top)||"none"!==ut(g).display||(A=g.style.display,g.style.display="block",v=pt(g),A?g.style.display=A:g.style.removeProperty("display")),y=xt(w[0],v[r.d]),b=xt(w[1]||"0",n),e=v[r.p]-l[r.p]-c+y+i-b,o&&Ct(o,b,r,n-b<20||o._isStart&&b>20),n-=n-b}if(d&&(a[d]=e||-.001,e<0&&(e=0)),s){var x=e+n,E=s._isStart;f="scroll"+r.d2,Ct(s,x,r,E&&x>20||!E&&(u?Math.max(q[f],W[f]):s.parentNode[f])<=x+1),u&&(l=pt(o),u&&(s.style[r.op.p]=l[r.op.p]-r.op.m-s._offset+ct))}return p&&g&&(f=pt(g),p.seek(h),m=pt(g),p._caScrollDist=f[r.p]-m[r.p],e=e/p._caScrollDist*h),p&&p.seek(_),p?e:Math.round(e)},en=/(webkit|moz|length|cssText|inset)/i,tn=function(e,t,n,r){if(e.parentNode!==t){var i,s,o=e.style;if(t===q){for(i in e._stOrig=o.cssText,s=ut(e))+i||en.test(i)||!s[i]||"string"!=typeof o[i]||"0"===i||(o[i]=s[i]);o.top=n,o.left=r}else o.cssText=e._stOrig;G.core.getCache(e).uncache=1,t.appendChild(e)}},nn=function(e,t,n){var r=t,i=r;return function(t){var s=Math.round(e());return s!==r&&s!==i&&Math.abs(s-r)>3&&Math.abs(s-i)>3&&(t=s,n&&n()),i=r,r=t,t}},rn=function(e,t,n){var r={};r[t.p]="+="+n,G.set(e,r)},sn=function(e,t){var n=O(e,t),r="_scroll"+t.p2,i=function t(i,s,o,a,l){var c=t.tween,u=s.onComplete,h={};o=o||n();var p=nn(n,o,(function(){c.kill(),t.tween=0}));return l=a&&l||0,a=a||i-o,c&&c.kill(),s[r]=i,s.modifiers=h,h[r]=function(){return p(o+a*c.ratio+l*c.ratio*c.ratio)},s.onUpdate=function(){b.cache++,Qt()},s.onComplete=function(){t.tween=0,u&&u.call(c)},c=t.tween=G.to(e,s)};return e[r]=n,n.wheelHandler=function(){return i.tween&&i.tween.kill()&&(i.tween=0)},_t(e,"wheel",n.wheelHandler),on.isTouch&&_t(e,"touchmove",n.wheelHandler),i},on=function(){function e(t,n){V||e.register(G)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),me(this),this.init(t,n)}return e.prototype.init=function(t,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),Te){var r,i,s,o,a,l,c,u,h,p,d,f,m,g,_,v,y,w,x,C,S,M,T,D,I,P,L,F,U,N,j,z,V,X,Y,$,ne,ie,se,oe,ce,ue,he=t=ht(Ve(t)||Qe(t)||t.nodeType?{trigger:t}:t,At),pe=he.onUpdate,de=he.toggleClass,fe=he.id,me=he.onToggle,ge=he.onRefresh,_e=he.scrub,ve=he.trigger,be=he.pin,Se=he.pinSpacing,Pe=he.invalidateOnRefresh,Re=he.anticipatePin,Be=he.onScrubComplete,Le=he.onSnapComplete,Fe=he.once,Ge=he.snap,Ke=he.pinReparent,Je=he.pinSpacer,Ze=he.containerAnimation,gt=he.fastScrollEnd,yt=he.preventOverlaps,wt=t.horizontal||t.containerAnimation&&!1!==t.horizontal?R:B,Ct=!_e&&0!==_e,Tt=k(t.scroller||H),It=G.core.getCache(Tt),Rt=Ue(Tt),Bt="fixed"===("pinType"in t?t.pinType:E(Tt,"pinType")||Rt&&"fixed"),Ot=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],Lt=Ct&&t.toggleActions.split(" "),Ft="markers"in t?t.markers:At.markers,Ut=Rt?0:parseFloat(ut(Tt)["border"+wt.p2+at])||0,Nt=this,zt=t.onRefreshInit&&function(){return t.onRefreshInit(Nt)},Vt=function(e,t,n){var r=n.d,i=n.d2,s=n.a;return(s=E(e,"getBoundingClientRect"))?function(){return s()[r]}:function(){return(t?Ne(i):e["client"+i])||0}}(Tt,Rt,wt),Qt=function(e,t){return!t||~A.indexOf(e)?je(e):function(){return Zt}}(Tt,Rt),Wt=0,qt=0,Yt=0,en=O(Tt,wt);if(Nt._startClamp=Nt._endClamp=!1,Nt._dir=wt,Re*=45,Nt.scroller=Tt,Nt.scroll=Ze?Ze.time.bind(Ze):en,o=en(),Nt.vars=t,n=n||t.animation,"refreshPriority"in t&&(ae=1,-9999===t.refreshPriority&&(xe=Nt)),It.tweenScroll=It.tweenScroll||{top:sn(Tt,B),left:sn(Tt,R)},Nt.tweenTo=r=It.tweenScroll[wt.p],Nt.scrubDuration=function(e){(V=Qe(e)&&e)?z?z.duration(e):z=G.to(n,{ease:"expo",totalProgress:"+=0",duration:V,paused:!0,onComplete:function(){return Be&&Be(Nt)}}):(z&&z.progress(1).kill(),z=0)},n&&(n.vars.lazy=!1,n._initted&&!Nt.isReverted||!1!==n.vars.immediateRender&&!1!==t.immediateRender&&n.duration()&&n.render(0,!0,!0),Nt.animation=n.pause(),n.scrollTrigger=Nt,Nt.scrubDuration(_e),N=0,fe||(fe=n.vars.id)),Ge&&(We(Ge)&&!Ge.push||(Ge={snapTo:Ge}),"scrollBehavior"in q.style&&G.set(Rt?[q,W]:Tt,{scrollBehavior:"auto"}),b.forEach((function(e){return He(e)&&e.target===(Rt?Q.scrollingElement||W:Tt)&&(e.smooth=!1)})),s=He(Ge.snapTo)?Ge.snapTo:"labels"===Ge.snapTo?function(e){return function(t){return G.utils.snap(ft(e),t)}}(n):"labelsDirectional"===Ge.snapTo?(oe=n,function(e,t){return mt(ft(oe))(e,t.direction)}):!1!==Ge.directional?function(e,t){return mt(Ge.snapTo)(e,Ce()-qt<500?0:t.direction)}:G.utils.snap(Ge.snapTo),X=Ge.duration||{min:.1,max:2},X=We(X)?J(X.min,X.max):J(X,X),Y=G.delayedCall(Ge.delay||V/2||.1,(function(){var e=en(),t=Ce()-qt<500,i=r.tween;if(!(t||Math.abs(Nt.getVelocity())<10)||i||te||Wt===e)Nt.isActive&&Wt!==e&&Y.restart(!0);else{var o=(e-l)/g,a=n&&!Ct?n.totalProgress():o,u=t?0:(a-j)/(Ce()-Z)*1e3||0,h=G.utils.clamp(-o,1-o,Ye(u/2)*u/.185),p=o+(!1===Ge.inertia?0:h),d=J(0,1,s(p,Nt)),f=Math.round(l+d*g),m=Ge,_=m.onStart,v=m.onInterrupt,y=m.onComplete;if(e<=c&&e>=l&&f!==e){if(i&&!i._initted&&i.data<=Ye(f-e))return;!1===Ge.inertia&&(h=d-o),r(f,{duration:X(Ye(.185*Math.max(Ye(p-a),Ye(d-a))/u/.05||0)),ease:Ge.ease||"power3",data:Ye(f-e),onInterrupt:function(){return Y.restart(!0)&&v&&v(Nt)},onComplete:function(){Nt.update(),Wt=en(),N=j=n&&!Ct?n.totalProgress():Nt.progress,Le&&Le(Nt),y&&y(Nt)}},e,h*g,f-e-h*g),_&&_(Nt,r.tween)}}})).pause()),fe&&(Mt[fe]=Nt),(se=(ve=Nt.trigger=k(ve||!0!==be&&be))&&ve._gsap&&ve._gsap.stRevert)&&(se=se(Nt)),be=!0===be?ve:k(be),Ve(de)&&(de={targets:ve,className:de}),be&&(!1===Se||Se===ot||(Se=!(!Se&&be.parentNode&&be.parentNode.style&&"flex"===ut(be.parentNode).display)&&st),Nt.pin=be,(i=G.core.getCache(be)).spacer?_=i.pinState:(Je&&((Je=k(Je))&&!Je.nodeType&&(Je=Je.current||Je.nativeElement),i.spacerIsNative=!!Je,Je&&(i.spacerState=Jt(Je))),i.spacer=w=Je||Q.createElement("div"),w.classList.add("pin-spacer"),fe&&w.classList.add("pin-spacer-"+fe),i.pinState=_=Jt(be)),!1!==t.force3D&&G.set(be,{force3D:!0}),Nt.spacer=w=i.spacer,U=ut(be),D=U[Se+wt.os2],C=G.getProperty(be),S=G.quickSetter(be,wt.a,ct),Xt(be,w,U),y=Jt(be)),Ft){f=We(Ft)?ht(Ft,bt):bt,p=Et("scroller-start",fe,Tt,wt,f,0),d=Et("scroller-end",fe,Tt,wt,f,0,p),x=p["offset"+wt.op.d2];var nn=k(E(Tt,"content")||Tt);u=this.markerStart=Et("start",fe,nn,wt,f,x,0,Ze),h=this.markerEnd=Et("end",fe,nn,wt,f,x,0,Ze),Ze&&(ie=G.quickSetter([u,h],wt.a,ct)),Bt||A.length&&!0===E(Tt,"fixedMarkers")||(ue=ut(ce=Rt?q:Tt).position,ce.style.position="absolute"===ue||"fixed"===ue?ue:"relative",G.set([p,d],{force3D:!0}),P=G.quickSetter(p,wt.a,ct),F=G.quickSetter(d,wt.a,ct))}if(Ze){var on=Ze.vars.onUpdate,an=Ze.vars.onUpdateParams;Ze.eventCallback("onUpdate",(function(){Nt.update(0,0,1),on&&on.apply(Ze,an||[])}))}if(Nt.previous=function(){return St[St.indexOf(Nt)-1]},Nt.next=function(){return St[St.indexOf(Nt)+1]},Nt.revert=function(e,t){if(!t)return Nt.kill(!0);var r=!1!==e||!Nt.enabled,i=ee;r!==Nt.isReverted&&(r&&($=Math.max(en(),Nt.scroll.rec||0),Yt=Nt.progress,ne=n&&n.progress()),u&&[u,h,p,d].forEach((function(e){return e.style.display=r?"none":"block"})),r&&(ee=Nt,Nt.update(r)),!be||Ke&&Nt.isActive||(r?function(e,t,n){Kt(n);var r=e._gsap;if(r.spacerIsNative)Kt(r.spacerState);else if(e._gsap.swappedIn){var i=t.parentNode;i&&(i.insertBefore(e,t),i.removeChild(t))}e._gsap.swappedIn=!1}(be,w,_):Xt(be,w,ut(be),I)),r||Nt.update(r),ee=i,Nt.isReverted=r)},Nt.refresh=function(i,s,f,b){if(!ee&&Nt.enabled||s)if(be&&i&&Me)_t(e,"scrollEnd",kt);else{!Ae&&zt&&zt(Nt),ee=Nt,r.tween&&!f&&(r.tween.kill(),r.tween=0),z&&z.pause(),Pe&&n&&n.revert({kill:!1}).invalidate(),Nt.isReverted||Nt.revert(!0,!0),Nt._subPinOffset=!1;var A,x,E,S,D,P,F,U,N,j,V,H,X,K=Vt(),J=Qt(),Z=Ze?Ze.duration():ze(Tt,wt),te=g<=.01,re=0,ie=b||0,se=We(f)?f.end:t.end,oe=t.endTrigger||ve,ae=We(f)?f.start:t.start||(0!==t.start&&ve?be?"0 0":"0 100%":0),ce=Nt.pinnedContainer=t.pinnedContainer&&k(t.pinnedContainer,Nt),ue=ve&&Math.max(0,St.indexOf(Nt))||0,he=ue;for(Ft&&We(f)&&(H=G.getProperty(p,wt.p),X=G.getProperty(d,wt.p));he--;)(P=St[he]).end||P.refresh(0,1)||(ee=Nt),!(F=P.pin)||F!==ve&&F!==be&&F!==ce||P.isReverted||(j||(j=[]),j.unshift(P),P.revert(!0,!0)),P!==St[he]&&(ue--,he--);for(He(ae)&&(ae=ae(Nt)),ae=De(ae,"start",Nt),l=$t(ae,ve,K,wt,en(),u,p,Nt,J,Ut,Bt,Z,Ze,Nt._startClamp&&"_startClamp")||(be?-.001:0),He(se)&&(se=se(Nt)),Ve(se)&&!se.indexOf("+=")&&(~se.indexOf(" ")?se=(Ve(ae)?ae.split(" ")[0]:"")+se:(re=xt(se.substr(2),K),se=Ve(ae)?ae:(Ze?G.utils.mapRange(0,Ze.duration(),Ze.scrollTrigger.start,Ze.scrollTrigger.end,l):l)+re,oe=ve)),se=De(se,"end",Nt),c=Math.max(l,$t(se||(oe?"100% 0":Z),oe,K,wt,en()+re,h,d,Nt,J,Ut,Bt,Z,Ze,Nt._endClamp&&"_endClamp"))||-.001,re=0,he=ue;he--;)(F=(P=St[he]).pin)&&P.start-P._pinPush<=l&&!Ze&&P.end>0&&(A=P.end-(Nt._startClamp?Math.max(0,P.start):P.start),(F===ve&&P.start-P._pinPush<l||F===ce)&&isNaN(ae)&&(re+=A*(1-P.progress)),F===be&&(ie+=A));if(l+=re,c+=re,Nt._startClamp&&(Nt._startClamp+=re),Nt._endClamp&&!Ae&&(Nt._endClamp=c||-.001,c=Math.min(c,ze(Tt,wt))),g=c-l||(l-=.01)&&.001,te&&(Yt=G.utils.clamp(0,1,G.utils.normalize(l,c,$))),Nt._pinPush=ie,u&&re&&((A={})[wt.a]="+="+re,ce&&(A[wt.p]="-="+en()),G.set([u,h],A)),be)A=ut(be),S=wt===B,E=en(),M=parseFloat(C(wt.a))+ie,!Z&&c>1&&(V={style:V=(Rt?Q.scrollingElement||W:Tt).style,value:V["overflow"+wt.a.toUpperCase()]},Rt&&"scroll"!==ut(q)["overflow"+wt.a.toUpperCase()]&&(V.style["overflow"+wt.a.toUpperCase()]="scroll")),Xt(be,w,A),y=Jt(be),x=pt(be,!0),U=Bt&&O(Tt,S?R:B)(),Se&&((I=[Se+wt.os2,g+ie+ct]).t=w,(he=Se===st?dt(be,wt)+g+ie:0)&&I.push(wt.d,he+ct),Kt(I),ce&&St.forEach((function(e){e.pin===ce&&!1!==e.vars.pinSpacing&&(e._subPinOffset=!0)})),Bt&&en($)),Bt&&((D={top:x.top+(S?E-l:U)+ct,left:x.left+(S?U:E-l)+ct,boxSizing:"border-box",position:"fixed"})[$e]=D["max"+at]=Math.ceil(x.width)+ct,D[et]=D["max"+lt]=Math.ceil(x.height)+ct,D[ot]=D[ot+rt]=D[ot+tt]=D[ot+it]=D[ot+nt]="0",D[st]=A[st],D[st+rt]=A[st+rt],D[st+tt]=A[st+tt],D[st+it]=A[st+it],D[st+nt]=A[st+nt],v=function(e,t,n){for(var r,i=[],s=e.length,o=n?8:0;o<s;o+=2)r=e[o],i.push(r,r in t?t[r]:e[o+1]);return i.t=e.t,i}(_,D,Ke),Ae&&en(0)),n?(N=n._initted,le(1),n.render(n.duration(),!0,!0),T=C(wt.a)-M+g+ie,L=Math.abs(g-T)>1,Bt&&L&&v.splice(v.length-2,2),n.render(0,!0,!0),N||n.invalidate(!0),n.parent||n.totalTime(n.totalTime()),le(0)):T=g,V&&(V.value?V.style["overflow"+wt.a.toUpperCase()]=V.value:V.style.removeProperty("overflow-"+wt.a));else if(ve&&en()&&!Ze)for(x=ve.parentNode;x&&x!==q;)x._pinOffset&&(l-=x._pinOffset,c-=x._pinOffset),x=x.parentNode;j&&j.forEach((function(e){return e.revert(!1,!0)})),Nt.start=l,Nt.end=c,o=a=Ae?$:en(),Ze||Ae||(o<$&&en($),Nt.scroll.rec=0),Nt.revert(!1,!0),qt=Ce(),Y&&(Wt=-1,Y.restart(!0)),ee=0,n&&Ct&&(n._initted||ne)&&n.progress()!==ne&&n.progress(ne||0,!0).render(n.time(),!0,!0),(te||Yt!==Nt.progress||Ze)&&(n&&!Ct&&n.totalProgress(Ze&&l<-.001&&!Yt?G.utils.normalize(l,c,0):Yt,!0),Nt.progress=te||(o-l)/g===Yt?0:Yt),be&&Se&&(w._pinOffset=Math.round(Nt.progress*T)),z&&z.invalidate(),isNaN(H)||(H-=G.getProperty(p,wt.p),X-=G.getProperty(d,wt.p),rn(p,wt,H),rn(u,wt,H-(b||0)),rn(d,wt,X),rn(h,wt,X-(b||0))),te&&!Ae&&Nt.update(),!ge||Ae||m||(m=!0,ge(Nt),m=!1)}},Nt.getVelocity=function(){return(en()-a)/(Ce()-Z)*1e3||0},Nt.endAnimation=function(){qe(Nt.callbackAnimation),n&&(z?z.progress(1):n.paused()?Ct||qe(n,Nt.direction<0,1):qe(n,n.reversed()))},Nt.labelToScroll=function(e){return n&&n.labels&&(l||Nt.refresh()||l)+n.labels[e]/n.duration()*g||0},Nt.getTrailing=function(e){var t=St.indexOf(Nt),n=Nt.direction>0?St.slice(0,t).reverse():St.slice(t+1);return(Ve(e)?n.filter((function(t){return t.vars.preventOverlaps===e})):n).filter((function(e){return Nt.direction>0?e.end<=l:e.start>=c}))},Nt.update=function(e,t,i){if(!Ze||i||e){var s,u,h,d,f,m,_,b=!0===Ae?$:Nt.scroll(),A=e?0:(b-l)/g,x=A<0?0:A>1?1:A||0,E=Nt.progress;if(t&&(a=o,o=Ze?en():b,Ge&&(j=N,N=n&&!Ct?n.totalProgress():x)),Re&&!x&&be&&!ee&&!Ee&&Me&&l<b+(b-a)/(Ce()-Z)*Re&&(x=1e-4),x!==E&&Nt.enabled){if(d=(f=(s=Nt.isActive=!!x&&x<1)!==(!!E&&E<1))||!!x!=!!E,Nt.direction=x>E?1:-1,Nt.progress=x,d&&!ee&&(u=x&&!E?0:1===x?1:1===E?2:3,Ct&&(h=!f&&"none"!==Lt[u+1]&&Lt[u+1]||Lt[u],_=n&&("complete"===h||"reset"===h||h in n))),yt&&(f||_)&&(_||_e||!n)&&(He(yt)?yt(Nt):Nt.getTrailing(yt).forEach((function(e){return e.endAnimation()}))),Ct||(!z||ee||Ee?n&&n.totalProgress(x,!(!ee||!qt&&!e)):(z._dp._time-z._start!==z._time&&z.render(z._dp._time-z._start),z.resetTo?z.resetTo("totalProgress",x,n._tTime/n._tDur):(z.vars.totalProgress=x,z.invalidate().restart()))),be)if(e&&Se&&(w.style[Se+wt.os2]=D),Bt){if(d){if(m=!e&&x>E&&c+1>b&&b+1>=ze(Tt,wt),Ke)if(e||!s&&!m)tn(be,w);else{var C=pt(be,!0),I=b-l;tn(be,q,C.top+(wt===B?I:0)+ct,C.left+(wt===B?0:I)+ct)}Kt(s||m?v:y),L&&x<1&&s||S(M+(1!==x||m?0:T))}}else S(Oe(M+T*x));Ge&&!r.tween&&!ee&&!Ee&&Y.restart(!0),de&&(f||Fe&&x&&(x<1||!ye))&&K(de.targets).forEach((function(e){return e.classList[s||Fe?"add":"remove"](de.className)})),pe&&!Ct&&!e&&pe(Nt),d&&!ee?(Ct&&(_&&("complete"===h?n.pause().totalProgress(1):"reset"===h?n.restart(!0).pause():"restart"===h?n.restart(!0):n[h]()),pe&&pe(Nt)),!f&&ye||(me&&f&&Xe(Nt,me),Ot[u]&&Xe(Nt,Ot[u]),Fe&&(1===x?Nt.kill(!1,1):Ot[u]=0),f||Ot[u=1===x?1:3]&&Xe(Nt,Ot[u])),gt&&!s&&Math.abs(Nt.getVelocity())>(Qe(gt)?gt:2500)&&(qe(Nt.callbackAnimation),z?z.progress(1):qe(n,"reverse"===h?1:!x,1))):Ct&&pe&&!ee&&pe(Nt)}if(F){var R=Ze?b/Ze.duration()*(Ze._caScrollDist||0):b;P(R+(p._isFlipped?1:0)),F(R)}ie&&ie(-b/Ze.duration()*(Ze._caScrollDist||0))}},Nt.enable=function(t,n){Nt.enabled||(Nt.enabled=!0,_t(Tt,"resize",Pt),Rt||_t(Tt,"scroll",Dt),zt&&_t(e,"refreshInit",zt),!1!==t&&(Nt.progress=Yt=0,o=a=Wt=en()),!1!==n&&Nt.refresh())},Nt.getTween=function(e){return e&&r?r.tween:z},Nt.setPositions=function(e,t,n,r){if(Ze){var i=Ze.scrollTrigger,s=Ze.duration(),o=i.end-i.start;e=i.start+o*e/s,t=i.start+o*t/s}Nt.refresh(!1,!1,{start:Ie(e,n&&!!Nt._startClamp),end:Ie(t,n&&!!Nt._endClamp)},r),Nt.update()},Nt.adjustPinSpacing=function(e){if(I&&e){var t=I.indexOf(wt.d)+1;I[t]=parseFloat(I[t])+e+ct,I[1]=parseFloat(I[1])+e+ct,Kt(I)}},Nt.disable=function(t,n){if(Nt.enabled&&(!1!==t&&Nt.revert(!0,!0),Nt.enabled=Nt.isActive=!1,n||z&&z.pause(),$=0,i&&(i.uncache=1),zt&&vt(e,"refreshInit",zt),Y&&(Y.pause(),r.tween&&r.tween.kill()&&(r.tween=0)),!Rt)){for(var s=St.length;s--;)if(St[s].scroller===Tt&&St[s]!==Nt)return;vt(Tt,"resize",Pt),Rt||vt(Tt,"scroll",Dt)}},Nt.kill=function(e,r){Nt.disable(e,r),z&&!r&&z.kill(),fe&&delete Mt[fe];var s=St.indexOf(Nt);s>=0&&St.splice(s,1),s===re&&Ht>0&&re--,s=0,St.forEach((function(e){return e.scroller===Nt.scroller&&(s=1)})),s||Ae||(Nt.scroll.rec=0),n&&(n.scrollTrigger=null,e&&n.revert({kill:!1}),r||n.kill()),u&&[u,h,p,d].forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),xe===Nt&&(xe=0),be&&(i&&(i.uncache=1),s=0,St.forEach((function(e){return e.pin===be&&s++})),s||(i.spacer=0)),t.onKill&&t.onKill(Nt)},St.push(Nt),Nt.enable(!1,!1),se&&se(Nt),n&&n.add&&!g){var ln=Nt.update;Nt.update=function(){Nt.update=ln,l||c||Nt.refresh()},G.delayedCall(.01,Nt.update),g=.01,l=c=0}else Nt.refresh();be&&function(){if(we!==jt){var e=we=jt;requestAnimationFrame((function(){return e===jt&&Gt(!0)}))}}()}else this.update=this.refresh=this.kill=ke},e.register=function(t){return V||(G=t||Fe(),Le()&&window.document&&e.enable(),V=Te),V},e.defaults=function(e){if(e)for(var t in e)At[t]=e[t];return At},e.disable=function(e,t){Te=0,St.forEach((function(n){return n[t?"kill":"disable"](e)})),vt(H,"wheel",Dt),vt(Q,"scroll",Dt),clearInterval($),vt(Q,"touchcancel",ke),vt(q,"touchstart",ke),gt(vt,Q,"pointerdown,touchstart,mousedown",Re),gt(vt,Q,"pointerup,touchend,mouseup",Be),Y.kill(),Ge(vt);for(var n=0;n<b.length;n+=3)yt(vt,b[n],b[n+1]),yt(vt,b[n],b[n+2])},e.enable=function(){if(H=window,Q=document,W=Q.documentElement,q=Q.body,G&&(K=G.utils.toArray,J=G.utils.clamp,me=G.core.context||ke,le=G.core.suppressOverwrites||ke,ge=H.history.scrollRestoration||"auto",Vt=H.pageYOffset,G.core.globals("ScrollTrigger",e),q)){Te=1,(_e=document.createElement("div")).style.height="100vh",_e.style.position="absolute",zt(),Pe(),z.register(G),e.isTouch=z.isTouch,fe=z.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_t(H,"wheel",Dt),X=[H,Q,W,q],G.matchMedia?(e.matchMedia=function(e){var t,n=G.matchMedia();for(t in e)n.add(t,e[t]);return n},G.addEventListener("matchMediaInit",(function(){return Ut()})),G.addEventListener("matchMediaRevert",(function(){return Ft()})),G.addEventListener("matchMedia",(function(){Gt(0,1),Ot("matchMedia")})),G.matchMedia("(orientation: portrait)",(function(){return It(),It}))):console.warn("Requires GSAP 3.11.0 or later"),It(),_t(Q,"scroll",Dt);var t,n,r=q.style,i=r.borderTopStyle,s=G.core.Animation.prototype;for(s.revert||Object.defineProperty(s,"revert",{value:function(){return this.time(-.01,!0)}}),r.borderTopStyle="solid",t=pt(q),B.m=Math.round(t.top+B.sc())||0,R.m=Math.round(t.left+R.sc())||0,i?r.borderTopStyle=i:r.removeProperty("border-top-style"),$=setInterval(Tt,250),G.delayedCall(.5,(function(){return Ee=0})),_t(Q,"touchcancel",ke),_t(q,"touchstart",ke),gt(_t,Q,"pointerdown,touchstart,mousedown",Re),gt(_t,Q,"pointerup,touchend,mouseup",Be),ne=G.utils.checkPrefix("transform"),qt.push(ne),V=Ce(),Y=G.delayedCall(.2,Gt).pause(),oe=[Q,"visibilitychange",function(){var e=H.innerWidth,t=H.innerHeight;Q.hidden?(ie=e,se=t):ie===e&&se===t||Pt()},Q,"DOMContentLoaded",Gt,H,"load",Gt,H,"resize",Pt],Ge(_t),St.forEach((function(e){return e.enable(0,1)})),n=0;n<b.length;n+=3)yt(vt,b[n],b[n+1]),yt(vt,b[n],b[n+2])}},e.config=function(t){"limitCallbacks"in t&&(ye=!!t.limitCallbacks);var n=t.syncInterval;n&&clearInterval($)||($=n)&&setInterval(Tt,n),"ignoreMobileResize"in t&&(he=1===e.isTouch&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(Ge(vt)||Ge(_t,t.autoRefreshEvents||"none"),ce=-1===(t.autoRefreshEvents+"").indexOf("resize"))},e.scrollerProxy=function(e,t){var n=k(e),r=b.indexOf(n),i=Ue(n);~r&&b.splice(r,i?6:2),t&&(i?A.unshift(H,t,q,t,W,t):A.unshift(n,t))},e.clearMatchMedia=function(e){St.forEach((function(t){return t._ctx&&t._ctx.query===e&&t._ctx.kill(!0,!0)}))},e.isInViewport=function(e,t,n){var r=(Ve(e)?k(e):e).getBoundingClientRect(),i=r[n?$e:et]*t||0;return n?r.right-i>0&&r.left+i<H.innerWidth:r.bottom-i>0&&r.top+i<H.innerHeight},e.positionInViewport=function(e,t,n){Ve(e)&&(e=k(e));var r=e.getBoundingClientRect(),i=r[n?$e:et],s=null==t?i/2:t in wt?wt[t]*i:~t.indexOf("%")?parseFloat(t)*i/100:parseFloat(t)||0;return n?(r.left+s)/H.innerWidth:(r.top+s)/H.innerHeight},e.killAll=function(e){if(St.slice(0).forEach((function(e){return"ScrollSmoother"!==e.vars.id&&e.kill()})),!0!==e){var t=Rt.killAll||[];Rt={},t.forEach((function(e){return e()}))}},e}();on.version="3.12.2",on.saveStyles=function(e){return e?K(e).forEach((function(e){if(e&&e.style){var t=Lt.indexOf(e);t>=0&&Lt.splice(t,5),Lt.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),G.core.getCache(e),me())}})):Lt},on.revert=function(e,t){return Ut(!e,t)},on.create=function(e,t){return new on(e,t)},on.refresh=function(e){return e?Pt():(V||on.register())&&Gt(!0)},on.update=function(e){return++b.cache&&Qt(!0===e?2:0)},on.clearScrollMemory=Nt,on.maxScroll=function(e,t){return ze(e,t?R:B)},on.getScrollFunc=function(e,t){return O(k(e),t?R:B)},on.getById=function(e){return Mt[e]},on.getAll=function(){return St.filter((function(e){return"ScrollSmoother"!==e.vars.id}))},on.isScrolling=function(){return!!Me},on.snapDirectional=mt,on.addEventListener=function(e,t){var n=Rt[e]||(Rt[e]=[]);~n.indexOf(t)||n.push(t)},on.removeEventListener=function(e,t){var n=Rt[e],r=n&&n.indexOf(t);r>=0&&n.splice(r,1)},on.batch=function(e,t){var n,r=[],i={},s=t.interval||.016,o=t.batchMax||1e9,a=function(e,t){var n=[],r=[],i=G.delayedCall(s,(function(){t(n,r),n=[],r=[]})).pause();return function(e){n.length||i.restart(!0),n.push(e.trigger),r.push(e),o<=n.length&&i.progress(1)}};for(n in t)i[n]="on"===n.substr(0,2)&&He(t[n])&&"onRefreshInit"!==n?a(0,t[n]):t[n];return He(o)&&(o=o(),_t(on,"refresh",(function(){return o=t.batchMax()}))),K(e).forEach((function(e){var t={};for(n in i)t[n]=i[n];t.trigger=e,r.push(on.create(t))})),r};var an,ln=function(e,t,n,r){return t>r?e(r):t<0&&e(0),n>r?(r-t)/(n-t):n<0?t/(t-n):1},cn=function e(t,n){!0===n?t.style.removeProperty("touch-action"):t.style.touchAction=!0===n?"auto":n?"pan-"+n+(z.isTouch?" pinch-zoom":""):"none",t===W&&e(q,n)},un={auto:1,scroll:1},hn=function(e){var t,n=e.event,r=e.target,i=e.axis,s=(n.changedTouches?n.changedTouches[0]:n).target,o=s._gsap||G.core.getCache(s),a=Ce();if(!o._isScrollT||a-o._isScrollT>2e3){for(;s&&s!==q&&(s.scrollHeight<=s.clientHeight&&s.scrollWidth<=s.clientWidth||!un[(t=ut(s)).overflowY]&&!un[t.overflowX]);)s=s.parentNode;o._isScroll=s&&s!==r&&!Ue(s)&&(un[(t=ut(s)).overflowY]||un[t.overflowX]),o._isScrollT=a}(o._isScroll||"x"===i)&&(n.stopPropagation(),n._gsapAllow=!0)},pn=function(e,t,n,r){return z.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:r=r&&hn,onPress:r,onDrag:r,onScroll:r,onEnable:function(){return n&&_t(Q,z.eventTypes[0],fn,!1,!0)},onDisable:function(){return vt(Q,z.eventTypes[0],fn,!0)}})},dn=/(input|label|select|textarea)/i,fn=function(e){var t=dn.test(e.target.tagName);(t||an)&&(e._gsapAllow=!0,an=t)},mn=function(e){We(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t,n,r,i,s,o,a,l,c=e,u=c.normalizeScrollX,h=c.momentum,p=c.allowNestedScroll,d=c.onRelease,f=k(e.target)||W,m=G.core.globals().ScrollSmoother,g=m&&m.get(),_=fe&&(e.content&&k(e.content)||g&&!1!==e.content&&!g.smooth()&&g.content()),v=O(f,B),y=O(f,R),A=1,w=(z.isTouch&&H.visualViewport?H.visualViewport.scale*H.visualViewport.width:H.outerWidth)/H.innerWidth,x=0,E=He(h)?function(){return h(t)}:function(){return h||2.8},C=pn(f,e.type,!0,p),S=function(){return i=!1},M=ke,T=ke,D=function(){n=ze(f,B),T=J(fe?1:0,n),u&&(M=J(0,ze(f,R))),r=jt},I=function(){_._gsap.y=Oe(parseFloat(_._gsap.y)+v.offset)+"px",_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(_._gsap.y)+", 0, 1)",v.offset=v.cacheID=0},P=function(){D(),s.isActive()&&s.vars.scrollY>n&&(v()>n?s.progress(1)&&v(n):s.resetTo("scrollY",n))};return _&&G.set(_,{y:"+=0"}),e.ignoreCheck=function(e){return fe&&"touchmove"===e.type&&function(){if(i){requestAnimationFrame(S);var e=Oe(t.deltaY/2),n=T(v.v-e);if(_&&n!==v.v+v.offset){v.offset=n-v.v;var r=Oe((parseFloat(_&&_._gsap.y)||0)-v.offset);_.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+r+", 0, 1)",_._gsap.y=r+"px",v.cacheID=b.cache,Qt()}return!0}v.offset&&I(),i=!0}()||A>1.05&&"touchstart"!==e.type||t.isGesturing||e.touches&&e.touches.length>1},e.onPress=function(){i=!1;var e=A;A=Oe((H.visualViewport&&H.visualViewport.scale||1)/w),s.pause(),e!==A&&cn(f,A>1.01||!u&&"x"),o=y(),a=v(),D(),r=jt},e.onRelease=e.onGestureStart=function(e,t){if(v.offset&&I(),t){b.cache++;var r,i,o=E();u&&(i=(r=y())+.05*o*-e.velocityX/.227,o*=ln(y,r,i,ze(f,R)),s.vars.scrollX=M(i)),i=(r=v())+.05*o*-e.velocityY/.227,o*=ln(v,r,i,ze(f,B)),s.vars.scrollY=T(i),s.invalidate().duration(o).play(.01),(fe&&s.vars.scrollY>=n||r>=n-1)&&G.to({},{onUpdate:P,duration:o})}else l.restart(!0);d&&d(e)},e.onWheel=function(){s._ts&&s.pause(),Ce()-x>1e3&&(r=0,x=Ce())},e.onChange=function(e,t,n,i,s){if(jt!==r&&D(),t&&u&&y(M(i[2]===t?o+(e.startX-e.x):y()+t-i[1])),n){v.offset&&I();var l=s[2]===n,c=l?a+e.startY-e.y:v()+n-s[1],h=T(c);l&&c!==h&&(a+=h-c),v(h)}(n||t)&&Qt()},e.onEnable=function(){cn(f,!u&&"x"),on.addEventListener("refresh",P),_t(H,"resize",P),v.smooth&&(v.target.style.scrollBehavior="auto",v.smooth=y.smooth=!1),C.enable()},e.onDisable=function(){cn(f,!0),vt(H,"resize",P),on.removeEventListener("refresh",P),C.kill()},e.lockAxis=!1!==e.lockAxis,(t=new z(e)).iOS=fe,fe&&!v()&&v(1),fe&&G.ticker.add(ke),l=t._dc,s=G.to(t,{ease:"power4",paused:!0,scrollX:u?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:nn(v,v(),(function(){return s.pause()}))},onUpdate:Qt,onComplete:l.vars.onComplete}),t};on.sort=function(e){return St.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+e.start-(t.start+-1e6*(t.vars.refreshPriority||0))})},on.observe=function(e){return new z(e)},on.normalizeScroll=function(e){if(void 0===e)return ue;if(!0===e&&ue)return ue.enable();if(!1===e)return ue&&ue.kill();var t=e instanceof z?e:mn(e);return ue&&ue.target===t.target&&ue.kill(),Ue(t.target)&&(ue=t),t},on.core={_getVelocityProp:L,_inputObserver:pn,_scrollers:b,_proxies:A,bridge:{ss:function(){Me||Ot("scrollStart"),Me=Ce()},ref:function(){return ee}}},Fe()&&G.registerPlugin(on)},578:(e,t,n)=>{"use strict";n.d(t,{C:()=>S});var r=/([\uD800-\uDBFF][\uDC00-\uDFFF](?:[\u200D\uFE0F][\uD800-\uDBFF][\uDC00-\uDFFF]){2,}|\uD83D\uDC69(?:\u200D(?:(?:\uD83D\uDC69\u200D)?\uD83D\uDC67|(?:\uD83D\uDC69\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC6F\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3C-\uDD3E\uDDD6-\uDDDF])\u200D[\u2640\u2642]\uFE0F|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])\uFE0F|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC69\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708]))\uFE0F|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83D\uDC69\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69]))|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]))|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D(?:(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F)/;function i(e){var t=e.nodeType,n="";if(1===t||9===t||11===t){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===t||4===t)return e.nodeValue;return n}var s,o,a,l,c,u,h=/(?:\r|\n|\t\t)/g,p=/(?:\s\s+)/g,d=function(e){s=document,o=window,(l=l||e||o.gsap||console.warn("Please gsap.registerPlugin(SplitText)"))&&(u=l.utils.toArray,c=l.core.context||function(){},a=1)},f=function(e){return o.getComputedStyle(e)},m=function(e){return"absolute"===e.position||!0===e.absolute},g=function(e,t){for(var n,r=t.length;--r>-1;)if(n=t[r],e.substr(0,n.length)===n)return n.length},_=function(e,t){void 0===e&&(e="");var n=~e.indexOf("++"),r=1;return n&&(e=e.split("++").join("")),function(){return"<"+t+" style='position:relative;display:inline-block;'"+(e?" class='"+e+(n?r++:"")+"'>":">")}},v=function e(t,n,r){var i=t.nodeType;if(1===i||9===i||11===i)for(t=t.firstChild;t;t=t.nextSibling)e(t,n,r);else 3!==i&&4!==i||(t.nodeValue=t.nodeValue.split(n).join(r))},y=function(e,t){for(var n=t.length;--n>-1;)e.push(t[n])},b=function(e,t,n){for(var r;e&&e!==t;){if(r=e._next||e.nextSibling)return r.textContent.charAt(0)===n;e=e.parentNode||e._parent}},A=function e(t){var n,r,i=u(t.childNodes),s=i.length;for(n=0;n<s;n++)(r=i[n])._isSplit?e(r):n&&r.previousSibling&&3===r.previousSibling.nodeType?(r.previousSibling.nodeValue+=3===r.nodeType?r.nodeValue:r.firstChild.nodeValue,t.removeChild(r)):3!==r.nodeType&&(t.insertBefore(r.firstChild,r),t.removeChild(r))},w=function(e,t){return parseFloat(t[e])||0},x=function(e,t,n,r,i,o,a){var l,c,u,h,p,d,g,_,x,E,C,S,M=f(e),T=w("paddingLeft",M),D=-999,I=w("borderBottomWidth",M)+w("borderTopWidth",M),P=w("borderLeftWidth",M)+w("borderRightWidth",M),R=w("paddingTop",M)+w("paddingBottom",M),B=w("paddingLeft",M)+w("paddingRight",M),k=w("fontSize",M)*(t.lineThreshold||.2),O=M.textAlign,L=[],F=[],U=[],N=t.wordDelimiter||" ",j=t.tag?t.tag:t.span?"span":"div",z=t.type||t.split||"chars,words,lines",G=i&&~z.indexOf("lines")?[]:null,V=~z.indexOf("words"),H=~z.indexOf("chars"),Q=m(t),W=t.linesClass,q=~(W||"").indexOf("++"),X=[],Y="flex"===M.display,K=e.style.display;for(q&&(W=W.split("++").join("")),Y&&(e.style.display="block"),u=(c=e.getElementsByTagName("*")).length,p=[],l=0;l<u;l++)p[l]=c[l];if(G||Q)for(l=0;l<u;l++)((d=(h=p[l]).parentNode===e)||Q||H&&!V)&&(S=h.offsetTop,G&&d&&Math.abs(S-D)>k&&("BR"!==h.nodeName||0===l)&&(g=[],G.push(g),D=S),Q&&(h._x=h.offsetLeft,h._y=S,h._w=h.offsetWidth,h._h=h.offsetHeight),G&&((h._isSplit&&d||!H&&d||V&&d||!V&&h.parentNode.parentNode===e&&!h.parentNode._isSplit)&&(g.push(h),h._x-=T,b(h,e,N)&&(h._wordEnd=!0)),"BR"===h.nodeName&&(h.nextSibling&&"BR"===h.nextSibling.nodeName||0===l)&&G.push([])));for(l=0;l<u;l++)if(d=(h=p[l]).parentNode===e,"BR"!==h.nodeName)if(Q&&(x=h.style,V||d||(h._x+=h.parentNode._x,h._y+=h.parentNode._y),x.left=h._x+"px",x.top=h._y+"px",x.position="absolute",x.display="block",x.width=h._w+1+"px",x.height=h._h+"px"),!V&&H)if(h._isSplit)for(h._next=c=h.nextSibling,h.parentNode.appendChild(h);c&&3===c.nodeType&&" "===c.textContent;)h._next=c.nextSibling,h.parentNode.appendChild(c),c=c.nextSibling;else h.parentNode._isSplit?(h._parent=h.parentNode,!h.previousSibling&&h.firstChild&&(h.firstChild._isFirst=!0),h.nextSibling&&" "===h.nextSibling.textContent&&!h.nextSibling.nextSibling&&X.push(h.nextSibling),h._next=h.nextSibling&&h.nextSibling._isFirst?null:h.nextSibling,h.parentNode.removeChild(h),p.splice(l--,1),u--):d||(S=!h.nextSibling&&b(h.parentNode,e,N),h.parentNode._parent&&h.parentNode._parent.appendChild(h),S&&h.parentNode.appendChild(s.createTextNode(" ")),"span"===j&&(h.style.display="inline"),L.push(h));else h.parentNode._isSplit&&!h._isSplit&&""!==h.innerHTML?F.push(h):H&&!h._isSplit&&("span"===j&&(h.style.display="inline"),L.push(h));else G||Q?(h.parentNode&&h.parentNode.removeChild(h),p.splice(l--,1),u--):V||e.appendChild(h);for(l=X.length;--l>-1;)X[l].parentNode.removeChild(X[l]);if(G){for(Q&&(E=s.createElement(j),e.appendChild(E),C=E.offsetWidth+"px",S=E.offsetParent===e?0:e.offsetLeft,e.removeChild(E)),x=e.style.cssText,e.style.cssText="display:none;";e.firstChild;)e.removeChild(e.firstChild);for(_=" "===N&&(!Q||!V&&!H),l=0;l<G.length;l++){for(g=G[l],(E=s.createElement(j)).style.cssText="display:block;text-align:"+O+";position:"+(Q?"absolute;":"relative;"),W&&(E.className=W+(q?l+1:"")),U.push(E),u=g.length,c=0;c<u;c++)"BR"!==g[c].nodeName&&(h=g[c],E.appendChild(h),_&&h._wordEnd&&E.appendChild(s.createTextNode(" ")),Q&&(0===c&&(E.style.top=h._y+"px",E.style.left=T+S+"px"),h.style.top="0px",S&&(h.style.left=h._x-S+"px")));0===u?E.innerHTML="&nbsp;":V||H||(A(E),v(E,String.fromCharCode(160)," ")),Q&&(E.style.width=C,E.style.height=h._h+"px"),e.appendChild(E)}e.style.cssText=x}Q&&(a>e.clientHeight&&(e.style.height=a-R+"px",e.clientHeight<a&&(e.style.height=a+I+"px")),o>e.clientWidth&&(e.style.width=o-B+"px",e.clientWidth<o&&(e.style.width=o+P+"px"))),Y&&(K?e.style.display=K:e.style.removeProperty("display")),y(n,L),V&&y(r,F),y(i,U)},E=function(e,t,n,o){var a,l,c,u,d,f,_,y,b=t.tag?t.tag:t.span?"span":"div",A=~(t.type||t.split||"chars,words,lines").indexOf("chars"),w=m(t),x=t.wordDelimiter||" ",E=" "!==x?"":w?"&#173; ":" ",C="</"+b+">",S=1,M=t.specialChars?"function"==typeof t.specialChars?t.specialChars:g:null,T=s.createElement("div"),D=e.parentNode;for(D.insertBefore(T,e),T.textContent=e.nodeValue,D.removeChild(e),_=-1!==(a=i(e=T)).indexOf("<"),!1!==t.reduceWhiteSpace&&(a=a.replace(p," ").replace(h,"")),_&&(a=a.split("<").join("{{LT}}")),d=a.length,l=(" "===a.charAt(0)?E:"")+n(),c=0;c<d;c++)if(f=a.charAt(c),M&&(y=M(a.substr(c),t.specialChars)))f=a.substr(c,y||1),l+=A&&" "!==f?o()+f+"</"+b+">":f,c+=y-1;else if(f===x&&a.charAt(c-1)!==x&&c){for(l+=S?C:"",S=0;a.charAt(c+1)===x;)l+=E,c++;c===d-1?l+=E:")"!==a.charAt(c+1)&&(l+=E+n(),S=1)}else"{"===f&&"{{LT}}"===a.substr(c,6)?(l+=A?o()+"{{LT}}</"+b+">":"{{LT}}",c+=5):f.charCodeAt(0)>=55296&&f.charCodeAt(0)<=56319||a.charCodeAt(c+1)>=65024&&a.charCodeAt(c+1)<=65039?(u=((a.substr(c,12).split(r)||[])[1]||"").length||2,l+=A&&" "!==f?o()+a.substr(c,u)+"</"+b+">":a.substr(c,u),c+=u-1):l+=A&&" "!==f?o()+f+"</"+b+">":f;e.outerHTML=l+(S?C:""),_&&v(D,"{{LT}}","<")},C=function e(t,n,r,i){var s,o,a=u(t.childNodes),l=a.length,c=m(n);if(3!==t.nodeType||l>1){for(n.absolute=!1,s=0;s<l;s++)(o=a[s])._next=o._isFirst=o._parent=o._wordEnd=null,(3!==o.nodeType||/\S+/.test(o.nodeValue))&&(c&&3!==o.nodeType&&"inline"===f(o).display&&(o.style.display="inline-block",o.style.position="relative"),o._isSplit=!0,e(o,n,r,i));return n.absolute=c,void(t._isSplit=!0)}E(t,n,r,i)},S=function(){function e(e,t){a||d(),this.elements=u(e),this.chars=[],this.words=[],this.lines=[],this._originals=[],this.vars=t||{},c(this),this.split(t)}var t=e.prototype;return t.split=function(e){this.isSplit&&this.revert(),this.vars=e=e||this.vars,this._originals.length=this.chars.length=this.words.length=this.lines.length=0;for(var t,n,r,i=this.elements.length,s=e.tag?e.tag:e.span?"span":"div",o=_(e.wordsClass,s),a=_(e.charsClass,s);--i>-1;)r=this.elements[i],this._originals[i]=r.innerHTML,t=r.clientHeight,n=r.clientWidth,C(r,e,o,a),x(r,e,this.chars,this.words,this.lines,n,t);return this.chars.reverse(),this.words.reverse(),this.lines.reverse(),this.isSplit=!0,this},t.revert=function(){var e=this._originals;if(!e)throw"revert() call wasn't scoped properly.";return this.elements.forEach((function(t,n){return t.innerHTML=e[n]})),this.chars=[],this.words=[],this.lines=[],this.isSplit=!1,this},e.create=function(t,n){return new e(t,n)},e}();S.version="3.12.2",S.register=d},358:(e,t,n)=>{"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.d(t,{ZP:()=>Xr});var s,o,a,l,c,u,h,p,d,f,m,g,_,v,y,b={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},A={duration:.5,overwrite:!1,delay:0},w=1e8,x=1e-8,E=2*Math.PI,C=E/4,S=0,M=Math.sqrt,T=Math.cos,D=Math.sin,I=function(e){return"string"==typeof e},P=function(e){return"function"==typeof e},R=function(e){return"number"==typeof e},B=function(e){return void 0===e},k=function(e){return"object"==typeof e},O=function(e){return!1!==e},L=function(){return"undefined"!=typeof window},F=function(e){return P(e)||I(e)},U="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},N=Array.isArray,j=/(?:-?\.?\d|\.)+/gi,z=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,G=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,V=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,H=/[+-]=-?[.\d]+/,Q=/[^,'"\[\]\s]+/gi,W=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,q={},X={},Y=function(e){return(X=Ee(e,q))&&Sn},K=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},J=function(e,t){return!t&&console.warn(e)},Z=function(e,t){return e&&(q[e]=t)&&X&&(X[e]=t)||q},$=function(){return 0},ee={suppressEvents:!0,isStart:!0,kill:!1},te={suppressEvents:!0,kill:!1},ne={suppressEvents:!0},re={},ie=[],se={},oe={},ae={},le=30,ce=[],ue="",he=function(e){var t,n,r=e[0];if(k(r)||P(r)||(e=[e]),!(t=(r._gsap||{}).harness)){for(n=ce.length;n--&&!ce[n].targetTest(r););t=ce[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new Nt(e[n],t)))||e.splice(n,1);return e},pe=function(e){return e._gsap||he(nt(e))[0]._gsap},de=function(e,t,n){return(n=e[t])&&P(n)?e[t]():B(n)&&e.getAttribute&&e.getAttribute(t)||n},fe=function(e,t){return(e=e.split(",")).forEach(t)||e},me=function(e){return Math.round(1e5*e)/1e5||0},ge=function(e){return Math.round(1e7*e)/1e7||0},_e=function(e,t){var n=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+r:"-"===n?e-r:"*"===n?e*r:e/r},ve=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},ye=function(){var e,t,n=ie.length,r=ie.slice(0);for(se={},ie.length=0,e=0;e<n;e++)(t=r[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},be=function(e,t,n,r){ie.length&&!o&&ye(),e.render(t,n,r||o&&t<0&&(e._initted||e._startAt)),ie.length&&!o&&ye()},Ae=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(Q).length<2?t:I(e)?e.trim():e},we=function(e){return e},xe=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Ee=function(e,t){for(var n in t)e[n]=t[n];return e},Ce=function e(t,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(t[r]=k(n[r])?e(t[r]||(t[r]={}),n[r]):n[r]);return t},Se=function(e,t){var n,r={};for(n in e)n in t||(r[n]=e[n]);return r},Me=function(e){var t,n=e.parent||l,r=e.keyframes?(t=N(e.keyframes),function(e,n){for(var r in n)r in e||"duration"===r&&t||"ease"===r||(e[r]=n[r])}):xe;if(O(e.inherit))for(;n;)r(e,n.vars.defaults),n=n.parent||n._dp;return e},Te=function(e,t,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var s,o=e[r];if(i)for(s=t[i];o&&o[i]>s;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},De=function(e,t,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=t._prev,s=t._next;i?i._next=s:e[n]===t&&(e[n]=s),s?s._prev=i:e[r]===t&&(e[r]=i),t._next=t._prev=t.parent=null},Ie=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Pe=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Re=function(e,t,n,r){return e._startAt&&(o?e._startAt.revert(te):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},Be=function e(t){return!t||t._ts&&e(t.parent)},ke=function(e){return e._repeat?Oe(e._tTime,e=e.duration()+e._rDelay)*e:0},Oe=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Le=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Fe=function(e){return e._end=ge(e._start+(e._tDur/Math.abs(e._ts||e._rts||x)||0))},Ue=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=ge(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Fe(e),n._dirty||Pe(n,e)),e},Ne=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=Le(e.rawTime(),t),(!t._dur||Je(0,t.totalDuration(),n)-t._tTime>x)&&t.render(n,!0)),Pe(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},je=function(e,t,n,r){return t.parent&&Ie(t),t._start=ge((R(n)?n:n||e!==l?Xe(e,n,t):e._time)+t._delay),t._end=ge(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Te(e,t,"_first","_last",e._sort?"_start":0),He(t)||(e._recent=t),r||Ne(e,t),e._ts<0&&Ue(e,e._tTime),e},ze=function(e,t){return(q.ScrollTrigger||K("scrollTrigger",t))&&q.ScrollTrigger.create(t,e)},Ge=function(e,t,n,r,i){return qt(e,t,i),e._initted?!n&&e._pt&&!o&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&d!==St.frame?(ie.push(e),e._lazy=[i,r],1):void 0:1},Ve=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},He=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Qe=function(e,t,n,r){var i=e._repeat,s=ge(t)||0,o=e._tTime/e._tDur;return o&&!r&&(e._time*=s/e._dur),e._dur=s,e._tDur=i?i<0?1e10:ge(s*(i+1)+e._rDelay*i):s,o>0&&!r&&Ue(e,e._tTime=e._tDur*o),e.parent&&Fe(e),n||Pe(e.parent,e),e},We=function(e){return e instanceof zt?Pe(e):Qe(e,e._dur)},qe={_start:0,endTime:$,totalDuration:$},Xe=function e(t,n,r){var i,s,o,a=t.labels,l=t._recent||qe,c=t.duration()>=w?l.endTime(!1):t._dur;return I(n)&&(isNaN(n)||n in a)?(s=n.charAt(0),o="%"===n.substr(-1),i=n.indexOf("="),"<"===s||">"===s?(i>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(i<0?l:r).totalDuration()/100:1)):i<0?(n in a||(a[n]=c),a[n]):(s=parseFloat(n.charAt(i-1)+n.substr(i+1)),o&&r&&(s=s/100*(N(r)?r[0]:r).totalDuration()),i>1?e(t,n.substr(0,i-1),r)+s:c+s)):null==n?c:+n},Ye=function(e,t,n){var r,i,s=R(t[1]),o=(s?2:1)+(e<2?0:1),a=t[o];if(s&&(a.duration=t[1]),a.parent=n,e){for(r=a,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=O(i.vars.inherit)&&i.parent;a.immediateRender=O(r.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return new Zt(t[0],a,t[o+1])},Ke=function(e,t){return e||0===e?t(e):t},Je=function(e,t,n){return n<e?e:n>t?t:n},Ze=function(e,t){return I(e)&&(t=W.exec(e))?t[1]:""},$e=[].slice,et=function(e,t){return e&&k(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&k(e[0]))&&!e.nodeType&&e!==c},tt=function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var r;return I(e)&&!t||et(e,1)?(r=n).push.apply(r,nt(e)):n.push(e)}))||n},nt=function(e,t,n){return a&&!t&&a.selector?a.selector(e):!I(e)||n||!u&&Mt()?N(e)?tt(e,n):et(e)?$e.call(e,0):e?[e]:[]:$e.call((t||h).querySelectorAll(e),0)},rt=function(e){return e=nt(e)[0]||J("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return nt(t,n.querySelectorAll?n:n===e?J("Invalid scope")||h.createElement("div"):e)}},it=function(e){return e.sort((function(){return.5-Math.random()}))},st=function(e){if(P(e))return e;var t=k(e)?e:{each:e},n=kt(t.ease),r=t.from||0,i=parseFloat(t.base)||0,s={},o=r>0&&r<1,a=isNaN(r)||o,l=t.axis,c=r,u=r;return I(r)?c=u={center:.5,edges:.5,end:1}[r]||0:!o&&a&&(c=r[0],u=r[1]),function(e,o,h){var p,d,f,m,g,_,v,y,b,A=(h||t).length,x=s[A];if(!x){if(!(b="auto"===t.grid?0:(t.grid||[1,w])[1])){for(v=-w;v<(v=h[b++].getBoundingClientRect().left)&&b<A;);b--}for(x=s[A]=[],p=a?Math.min(b,A)*c-.5:r%b,d=b===w?0:a?A*u/b-.5:r/b|0,v=0,y=w,_=0;_<A;_++)f=_%b-p,m=d-(_/b|0),x[_]=g=l?Math.abs("y"===l?m:f):M(f*f+m*m),g>v&&(v=g),g<y&&(y=g);"random"===r&&it(x),x.max=v-y,x.min=y,x.v=A=(parseFloat(t.amount)||parseFloat(t.each)*(b>A?A-1:l?"y"===l?A/b:b:Math.max(b,A/b))||0)*("edges"===r?-1:1),x.b=A<0?i-A:i,x.u=Ze(t.amount||t.each)||0,n=n&&A<0?Rt(n):n}return A=(x[e]-x.min)/x.max||0,ge(x.b+(n?n(A):A)*x.v)+x.u}},ot=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=ge(Math.round(parseFloat(n)/e)*e*t);return(r-r%1)/t+(R(n)?0:Ze(n))}},at=function(e,t){var n,r,i=N(e);return!i&&k(e)&&(n=i=e.radius||w,e.values?(e=nt(e.values),(r=!R(e[0]))&&(n*=n)):e=ot(e.increment)),Ke(t,i?P(e)?function(t){return r=e(t),Math.abs(r-t)<=n?r:t}:function(t){for(var i,s,o=parseFloat(r?t.x:t),a=parseFloat(r?t.y:0),l=w,c=0,u=e.length;u--;)(i=r?(i=e[u].x-o)*i+(s=e[u].y-a)*s:Math.abs(e[u]-o))<l&&(l=i,c=u);return c=!n||l<=n?e[c]:t,r||c===t||R(t)?c:c+Ze(t)}:ot(e))},lt=function(e,t,n,r){return Ke(N(e)?!t:!0===n?!!(n=0):!r,(function(){return N(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*r)/r}))},ct=function(e,t,n){return Ke(n,(function(n){return e[~~t(n)]}))},ut=function(e){for(var t,n,r,i,s=0,o="";~(t=e.indexOf("random(",s));)r=e.indexOf(")",t),i="["===e.charAt(t+7),n=e.substr(t+7,r-t-7).match(i?Q:j),o+=e.substr(s,t-s)+lt(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),s=r+1;return o+e.substr(s,e.length-s)},ht=function(e,t,n,r,i){var s=t-e,o=r-n;return Ke(i,(function(t){return n+((t-e)/s*o||0)}))},pt=function(e,t,n){var r,i,s,o=e.labels,a=w;for(r in o)(i=o[r]-t)<0==!!n&&i&&a>(i=Math.abs(i))&&(s=r,a=i);return s},dt=function(e,t,n){var r,i,s,o=e.vars,l=o[t],c=a,u=e._ctx;if(l)return r=o[t+"Params"],i=o.callbackScope||e,n&&ie.length&&ye(),u&&(a=u),s=r?l.apply(i,r):l.call(i),a=c,s},ft=function(e){return Ie(e),e.scrollTrigger&&e.scrollTrigger.kill(!!o),e.progress()<1&&dt(e,"onInterrupt"),e},mt=[],gt=function(e){if(L()&&e){var t=(e=!e.name&&e.default||e).name,n=P(e),r=t&&!n&&e.init?function(){this._props=[]}:e,i={init:$,render:ln,add:Qt,kill:un,modifier:cn,rawVars:0},s={targetTest:0,get:0,getSetter:rn,aliases:{},register:0};if(Mt(),e!==r){if(oe[t])return;xe(r,xe(Se(e,i),s)),Ee(r.prototype,Ee(i,Se(e,s))),oe[r.prop=t]=r,e.targetTest&&(ce.push(r),re[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Z(t,r),e.register&&e.register(Sn,r,dn)}else e&&mt.push(e)},_t=255,vt={aqua:[0,_t,_t],lime:[0,_t,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_t],navy:[0,0,128],white:[_t,_t,_t],olive:[128,128,0],yellow:[_t,_t,0],orange:[_t,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_t,0,0],pink:[_t,192,203],cyan:[0,_t,_t],transparent:[_t,_t,_t,0]},yt=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*_t+.5|0},bt=function(e,t,n){var r,i,s,o,a,l,c,u,h,p,d=e?R(e)?[e>>16,e>>8&_t,e&_t]:0:vt.black;if(!d){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),vt[e])d=vt[e];else if("#"===e.charAt(0)){if(e.length<6&&(r=e.charAt(1),i=e.charAt(2),s=e.charAt(3),e="#"+r+r+i+i+s+s+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(d=parseInt(e.substr(1,6),16))>>16,d>>8&_t,d&_t,parseInt(e.substr(7),16)/255];d=[(e=parseInt(e.substr(1),16))>>16,e>>8&_t,e&_t]}else if("hsl"===e.substr(0,3))if(d=p=e.match(j),t){if(~e.indexOf("="))return d=e.match(z),n&&d.length<4&&(d[3]=1),d}else o=+d[0]%360/360,a=+d[1]/100,r=2*(l=+d[2]/100)-(i=l<=.5?l*(a+1):l+a-l*a),d.length>3&&(d[3]*=1),d[0]=yt(o+1/3,r,i),d[1]=yt(o,r,i),d[2]=yt(o-1/3,r,i);else d=e.match(j)||vt.transparent;d=d.map(Number)}return t&&!p&&(r=d[0]/_t,i=d[1]/_t,s=d[2]/_t,l=((c=Math.max(r,i,s))+(u=Math.min(r,i,s)))/2,c===u?o=a=0:(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),o=c===r?(i-s)/h+(i<s?6:0):c===i?(s-r)/h+2:(r-i)/h+4,o*=60),d[0]=~~(o+.5),d[1]=~~(100*a+.5),d[2]=~~(100*l+.5)),n&&d.length<4&&(d[3]=1),d},At=function(e){var t=[],n=[],r=-1;return e.split(xt).forEach((function(e){var i=e.match(G)||[];t.push.apply(t,i),n.push(r+=i.length+1)})),t.c=n,t},wt=function(e,t,n){var r,i,s,o,a="",l=(e+a).match(xt),c=t?"hsla(":"rgba(",u=0;if(!l)return e;if(l=l.map((function(e){return(e=bt(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(s=At(e),(r=n.c).join(a)!==s.c.join(a)))for(o=(i=e.replace(xt,"1").split(G)).length-1;u<o;u++)a+=i[u]+(~r.indexOf(u)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!i)for(o=(i=e.split(xt)).length-1;u<o;u++)a+=i[u]+l[u];return a+i[o]},xt=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in vt)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),Et=/hsl[a]?\(/,Ct=function(e){var t,n=e.join(" ");if(xt.lastIndex=0,xt.test(n))return t=Et.test(n),e[1]=wt(e[1],t),e[0]=wt(e[0],t,At(e[1])),!0},St=function(){var e,t,n,r,i,s,o=Date.now,a=500,l=33,d=o(),f=d,g=1e3/240,_=g,v=[],y=function n(c){var u,h,p,m,y=o()-f,b=!0===c;if(y>a&&(d+=y-l),((u=(p=(f+=y)-d)-_)>0||b)&&(m=++r.frame,i=p-1e3*r.time,r.time=p/=1e3,_+=u+(u>=g?4:g-u),h=1),b||(e=t(n)),h)for(s=0;s<v.length;s++)v[s](p,i,m,c)};return r={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(e){return i/(1e3/(e||60))},wake:function(){p&&(!u&&L()&&(c=u=window,h=c.document||{},q.gsap=Sn,(c.gsapVersions||(c.gsapVersions=[])).push(Sn.version),Y(X||c.GreenSockGlobals||!c.gsap&&c||{}),n=c.requestAnimationFrame,mt.forEach(gt)),e&&r.sleep(),t=n||function(e){return setTimeout(e,_-1e3*r.time+1|0)},m=1,y(2))},sleep:function(){(n?c.cancelAnimationFrame:clearTimeout)(e),m=0,t=$},lagSmoothing:function(e,t){a=e||1/0,l=Math.min(t||33,a)},fps:function(e){g=1e3/(e||240),_=1e3*r.time+g},add:function(e,t,n){var i=t?function(t,n,s,o){e(t,n,s,o),r.remove(i)}:e;return r.remove(e),v[n?"unshift":"push"](i),Mt(),i},remove:function(e,t){~(t=v.indexOf(e))&&v.splice(t,1)&&s>=t&&s--},_listeners:v}}(),Mt=function(){return!m&&St.wake()},Tt={},Dt=/^[\d.\-M][\d.\-,\s]/,It=/["']/g,Pt=function(e){for(var t,n,r,i={},s=e.substr(1,e.length-3).split(":"),o=s[0],a=1,l=s.length;a<l;a++)n=s[a],t=a!==l-1?n.lastIndexOf(","):n.length,r=n.substr(0,t),i[o]=isNaN(r)?r.replace(It,"").trim():+r,o=n.substr(t+1).trim();return i},Rt=function(e){return function(t){return 1-e(1-t)}},Bt=function e(t,n){for(var r,i=t._first;i;)i instanceof zt?e(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?e(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},kt=function(e,t){return e&&(P(e)?e:Tt[e]||function(e){var t,n,r,i,s=(e+"").split("("),o=Tt[s[0]];return o&&s.length>1&&o.config?o.config.apply(null,~e.indexOf("{")?[Pt(s[1])]:(t=e,n=t.indexOf("(")+1,r=t.indexOf(")"),i=t.indexOf("(",n),t.substring(n,~i&&i<r?t.indexOf(")",r+1):r)).split(",").map(Ae)):Tt._CE&&Dt.test(e)?Tt._CE("",e):o}(e))||t},Ot=function(e,t,n,r){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===r&&(r=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var i,s={easeIn:t,easeOut:n,easeInOut:r};return fe(e,(function(e){for(var t in Tt[e]=q[e]=s,Tt[i=e.toLowerCase()]=n,s)Tt[i+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=Tt[e+"."+t]=s[t]})),s},Lt=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},Ft=function e(t,n,r){var i=n>=1?n:1,s=(r||(t?.3:.45))/(n<1?n:1),o=s/E*(Math.asin(1/i)||0),a=function(e){return 1===e?1:i*Math.pow(2,-10*e)*D((e-o)*s)+1},l="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:Lt(a);return s=E/s,l.config=function(n,r){return e(t,n,r)},l},Ut=function e(t,n){void 0===n&&(n=1.70158);var r=function(e){return e?--e*e*((n+1)*e+n)+1:0},i="out"===t?r:"in"===t?function(e){return 1-r(1-e)}:Lt(r);return i.config=function(n){return e(t,n)},i};fe("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;Ot(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),Tt.Linear.easeNone=Tt.none=Tt.Linear.easeIn,Ot("Elastic",Ft("in"),Ft("out"),Ft()),g=7.5625,v=1/(_=2.75),Ot("Bounce",(function(e){return 1-y(1-e)}),y=function(e){return e<v?g*e*e:e<.7272727272727273?g*Math.pow(e-1.5/_,2)+.75:e<.9090909090909092?g*(e-=2.25/_)*e+.9375:g*Math.pow(e-2.625/_,2)+.984375}),Ot("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),Ot("Circ",(function(e){return-(M(1-e*e)-1)})),Ot("Sine",(function(e){return 1===e?1:1-T(e*C)})),Ot("Back",Ut("in"),Ut("out"),Ut()),Tt.SteppedEase=Tt.steps=q.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,r=e+(t?0:1),i=t?1:0;return function(e){return((r*Je(0,.99999999,e)|0)+i)*n}}},A.ease=Tt["quad.out"],fe("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return ue+=e+","+e+"Params,"}));var Nt=function(e,t){this.id=S++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:de,this.set=t?t.getSetter:rn},jt=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Qe(this,+e.duration,1,1),this.data=e.data,a&&(this._ctx=a,a.data.push(this)),m||St.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Qe(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(Mt(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Ue(this,e),!n._dp||n.parent||Ne(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&je(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===x||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),be(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+ke(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+ke(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Oe(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?Le(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(Je(-Math.abs(this._delay),this._tDur,t),!0),Fe(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Mt(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==x&&(this._tTime-=x)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&je(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(O(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Le(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=ne);var t=o;return o=e,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),o=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,We(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,We(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(Xe(this,e),O(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,O(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-x))},t.eventCallback=function(e,t,n){var r=this.vars;return arguments.length>1?(t?(r[e]=t,n&&(r[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete r[e],this):r[e]},t.then=function(e){var t=this;return new Promise((function(n){var r=P(e)?e:we,i=function(){var e=t.then;t.then=null,P(r)&&(r=r(t))&&(r.then||r===t)&&(t.then=e),n(r),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?i():t._prom=i}))},t.kill=function(){ft(this)},e}();xe(jt.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var zt=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=O(t.sortChildren),l&&je(t.parent||l,r(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&ze(r(i),t.scrollTrigger),i}i(t,e);var n=t.prototype;return n.to=function(e,t,n){return Ye(0,arguments,this),this},n.from=function(e,t,n){return Ye(1,arguments,this),this},n.fromTo=function(e,t,n,r){return Ye(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,Me(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new Zt(e,t,Xe(this,n),1),this},n.call=function(e,t,n){return je(this,Zt.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,r,i,s,o){return n.duration=t,n.stagger=n.stagger||r,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new Zt(e,n,Xe(this,i)),this},n.staggerFrom=function(e,t,n,r,i,s,o){return n.runBackwards=1,Me(n).immediateRender=O(n.immediateRender),this.staggerTo(e,t,n,r,i,s,o)},n.staggerFromTo=function(e,t,n,r,i,s,o,a){return r.startAt=n,Me(r).immediateRender=O(r.immediateRender),this.staggerTo(e,t,r,i,s,o,a)},n.render=function(e,t,n){var r,i,s,a,c,u,h,p,d,f,m,g,_=this._time,v=this._dirty?this.totalDuration():this._tDur,y=this._dur,b=e<=0?0:ge(e),A=this._zTime<0!=e<0&&(this._initted||!y);if(this!==l&&b>v&&e>=0&&(b=v),b!==this._tTime||n||A){if(_!==this._time&&y&&(b+=this._time-_,e+=this._time-_),r=b,d=this._start,u=!(p=this._ts),A&&(y||(_=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(m=this._yoyo,c=y+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*c+e,t,n);if(r=ge(b%c),b===v?(a=this._repeat,r=y):((a=~~(b/c))&&a===b/c&&(r=y,a--),r>y&&(r=y)),f=Oe(this._tTime,c),!_&&this._tTime&&f!==a&&this._tTime-f*c-this._dur<=0&&(f=a),m&&1&a&&(r=y-r,g=1),a!==f&&!this._lock){var w=m&&1&f,E=w===(m&&1&a);if(a<f&&(w=!w),_=w?0:b%y?y:b,this._lock=1,this.render(_||(g?0:ge(a*c)),t,!y)._lock=0,this._tTime=b,!t&&this.parent&&dt(this,"onRepeat"),this.vars.repeatRefresh&&!g&&(this.invalidate()._lock=1),_&&_!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,v=this._tDur,E&&(this._lock=2,_=w?y:-1e-4,this.render(_,!0),this.vars.repeatRefresh&&!g&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;Bt(this,g)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(h=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<t)return r;r=r._prev}}(this,ge(_),ge(r)),h&&(b-=r-(r=h._start))),this._tTime=b,this._time=r,this._act=!p,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,_=0),!_&&r&&!t&&!a&&(dt(this,"onStart"),this._tTime!==b))return this;if(r>=_&&e>=0)for(i=this._first;i;){if(s=i._next,(i._act||r>=i._start)&&i._ts&&h!==i){if(i.parent!==this)return this.render(e,t,n);if(i.render(i._ts>0?(r-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(r-i._start)*i._ts,t,n),r!==this._time||!this._ts&&!u){h=0,s&&(b+=this._zTime=-1e-8);break}}i=s}else{i=this._last;for(var C=e<0?e:r;i;){if(s=i._prev,(i._act||C<=i._end)&&i._ts&&h!==i){if(i.parent!==this)return this.render(e,t,n);if(i.render(i._ts>0?(C-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(C-i._start)*i._ts,t,n||o&&(i._initted||i._startAt)),r!==this._time||!this._ts&&!u){h=0,s&&(b+=this._zTime=C?-1e-8:x);break}}i=s}}if(h&&!t&&(this.pause(),h.render(r>=_?0:-1e-8)._zTime=r>=_?1:-1,this._ts))return this._start=d,Fe(this),this.render(e,t,n);this._onUpdate&&!t&&dt(this,"onUpdate",!0),(b===v&&this._tTime>=this.totalDuration()||!b&&_)&&(d!==this._start&&Math.abs(p)===Math.abs(this._ts)||this._lock||((e||!y)&&(b===v&&this._ts>0||!b&&this._ts<0)&&Ie(this,1),t||e<0&&!_||!b&&!_&&v||(dt(this,b===v&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<v&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(R(t)||(t=Xe(this,t,e)),!(e instanceof jt)){if(N(e))return e.forEach((function(e){return n.add(e,t)})),this;if(I(e))return this.addLabel(e,t);if(!P(e))return this;e=Zt.delayedCall(0,e)}return this!==e?je(this,e,t):this},n.getChildren=function(e,t,n,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=-w);for(var i=[],s=this._first;s;)s._start>=r&&(s instanceof Zt?t&&i.push(s):(n&&i.push(s),e&&i.push.apply(i,s.getChildren(!0,t,n)))),s=s._next;return i},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return I(e)?this.removeLabel(e):P(e)?this.killTweensOf(e):(De(this,e),e===this._recent&&(this._recent=this._last),Pe(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ge(St.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=Xe(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var r=Zt.delayedCall(0,t||$,n);return r.data="isPause",this._hasPause=1,je(this,r,Xe(this,e))},n.removePause=function(e){var t=this._first;for(e=Xe(this,e);t;)t._start===e&&"isPause"===t.data&&Ie(t),t=t._next},n.killTweensOf=function(e,t,n){for(var r=this.getTweensOf(e,n),i=r.length;i--;)Gt!==r[i]&&r[i].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,r=[],i=nt(e),s=this._first,o=R(t);s;)s instanceof Zt?ve(s._targets,i)&&(o?(!Gt||s._initted&&s._ts)&&s.globalTime(0)<=t&&s.globalTime(s.totalDuration())>t:!t||s.isActive())&&r.push(s):(n=s.getTweensOf(i,t)).length&&r.push.apply(r,n),s=s._next;return r},n.tweenTo=function(e,t){t=t||{};var n,r=this,i=Xe(r,e),s=t,o=s.startAt,a=s.onStart,l=s.onStartParams,c=s.immediateRender,u=Zt.to(r,xe({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:t.duration||Math.abs((i-(o&&"time"in o?o.time:r._time))/r.timeScale())||x,onStart:function(){if(r.pause(),!n){var e=t.duration||Math.abs((i-(o&&"time"in o?o.time:r._time))/r.timeScale());u._dur!==e&&Qe(u,e,0,1).render(u._time,!0,!0),n=1}a&&a.apply(u,l||[])}},t));return c?u.render(0):u},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,xe({startAt:{time:Xe(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),pt(this,Xe(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),pt(this,Xe(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+x)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var r,i=this._first,s=this.labels;i;)i._start>=n&&(i._start+=e,i._end+=e),i=i._next;if(t)for(r in s)s[r]>=n&&(s[r]+=e);return Pe(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Pe(this)},n.totalDuration=function(e){var t,n,r,i=0,s=this,o=s._last,a=w;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-e:e));if(s._dirty){for(r=s.parent;o;)t=o._prev,o._dirty&&o.totalDuration(),(n=o._start)>a&&s._sort&&o._ts&&!s._lock?(s._lock=1,je(s,o,n-o._delay,1)._lock=0):a=n,n<0&&o._ts&&(i-=n,(!r&&!s._dp||r&&r.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),a=0),o._end>i&&o._ts&&(i=o._end),o=t;Qe(s,s===l&&s._time>i?s._time:i,1,1),s._dirty=0}return s._tDur},t.updateRoot=function(e){if(l._ts&&(be(l,Le(e,l)),d=St.frame),St.frame>=le){le+=b.autoSleep||120;var t=l._first;if((!t||!t._ts)&&b.autoSleep&&St._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||St.sleep()}}},t}(jt);xe(zt.prototype,{_lock:0,_hasPause:0,_forcing:0});var Gt,Vt,Ht=function(e,t,n,r,i,s,o){var a,l,c,u,h,p,d,f,m=new dn(this._pt,e,t,0,1,an,null,i),g=0,_=0;for(m.b=n,m.e=r,n+="",(d=~(r+="").indexOf("random("))&&(r=ut(r)),s&&(s(f=[n,r],e,t),n=f[0],r=f[1]),l=n.match(V)||[];a=V.exec(r);)u=a[0],h=r.substring(g,a.index),c?c=(c+1)%5:"rgba("===h.substr(-5)&&(c=1),u!==l[_++]&&(p=parseFloat(l[_-1])||0,m._pt={_next:m._pt,p:h||1===_?h:",",s:p,c:"="===u.charAt(1)?_e(p,u)-p:parseFloat(u)-p,m:c&&c<4?Math.round:0},g=V.lastIndex);return m.c=g<r.length?r.substring(g,r.length):"",m.fp=o,(H.test(r)||d)&&(m.e=0),this._pt=m,m},Qt=function(e,t,n,r,i,s,o,a,l,c){P(r)&&(r=r(i||0,e,s));var u,h=e[t],p="get"!==n?n:P(h)?l?e[t.indexOf("set")||!P(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,d=P(h)?l?tn:en:$t;if(I(r)&&(~r.indexOf("random(")&&(r=ut(r)),"="===r.charAt(1)&&((u=_e(p,r)+(Ze(p)||0))||0===u)&&(r=u)),!c||p!==r||Vt)return isNaN(p*r)||""===r?(!h&&!(t in e)&&K(t,r),Ht.call(this,e,t,p,r,d,a||b.stringFilter,l)):(u=new dn(this._pt,e,t,+p||0,r-(p||0),"boolean"==typeof h?on:sn,0,d),l&&(u.fp=l),o&&u.modifier(o,this,e),this._pt=u)},Wt=function(e,t,n,r,i,s){var o,a,l,c;if(oe[e]&&!1!==(o=new oe[e]).init(i,o.rawVars?t[e]:function(e,t,n,r,i){if(P(e)&&(e=Yt(e,i,t,n,r)),!k(e)||e.style&&e.nodeType||N(e)||U(e))return I(e)?Yt(e,i,t,n,r):e;var s,o={};for(s in e)o[s]=Yt(e[s],i,t,n,r);return o}(t[e],r,i,s,n),n,r,s)&&(n._pt=a=new dn(n._pt,i,e,0,1,o.render,o,0,o.priority),n!==f))for(l=n._ptLookup[n._targets.indexOf(i)],c=o._props.length;c--;)l[o._props[c]]=a;return o},qt=function e(t,n,r){var i,a,c,u,h,p,d,f,m,g,_,v,y,b=t.vars,E=b.ease,C=b.startAt,S=b.immediateRender,M=b.lazy,T=b.onUpdate,D=b.onUpdateParams,I=b.callbackScope,P=b.runBackwards,R=b.yoyoEase,B=b.keyframes,k=b.autoRevert,L=t._dur,F=t._startAt,U=t._targets,N=t.parent,j=N&&"nested"===N.data?N.vars.targets:U,z="auto"===t._overwrite&&!s,G=t.timeline;if(G&&(!B||!E)&&(E="none"),t._ease=kt(E,A.ease),t._yEase=R?Rt(kt(!0===R?E:R,A.ease)):0,R&&t._yoyo&&!t._repeat&&(R=t._yEase,t._yEase=t._ease,t._ease=R),t._from=!G&&!!b.runBackwards,!G||B&&!b.stagger){if(v=(f=U[0]?pe(U[0]).harness:0)&&b[f.prop],i=Se(b,re),F&&(F._zTime<0&&F.progress(1),n<0&&P&&S&&!k?F.render(-1,!0):F.revert(P&&L?te:ee),F._lazy=0),C){if(Ie(t._startAt=Zt.set(U,xe({data:"isStart",overwrite:!1,parent:N,immediateRender:!0,lazy:!F&&O(M),startAt:null,delay:0,onUpdate:T,onUpdateParams:D,callbackScope:I,stagger:0},C))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(o||!S&&!k)&&t._startAt.revert(te),S&&L&&n<=0&&r<=0)return void(n&&(t._zTime=n))}else if(P&&L&&!F)if(n&&(S=!1),c=xe({overwrite:!1,data:"isFromStart",lazy:S&&!F&&O(M),immediateRender:S,stagger:0,parent:N},i),v&&(c[f.prop]=v),Ie(t._startAt=Zt.set(U,c)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(o?t._startAt.revert(te):t._startAt.render(-1,!0)),t._zTime=n,S){if(!n)return}else e(t._startAt,x,x);for(t._pt=t._ptCache=0,M=L&&O(M)||M&&!L,a=0;a<U.length;a++){if(d=(h=U[a])._gsap||he(U)[a]._gsap,t._ptLookup[a]=g={},se[d.id]&&ie.length&&ye(),_=j===U?a:j.indexOf(h),f&&!1!==(m=new f).init(h,v||i,t,_,j)&&(t._pt=u=new dn(t._pt,h,m.name,0,1,m.render,m,0,m.priority),m._props.forEach((function(e){g[e]=u})),m.priority&&(p=1)),!f||v)for(c in i)oe[c]&&(m=Wt(c,i,t,_,h,j))?m.priority&&(p=1):g[c]=u=Qt.call(t,h,c,"get",i[c],_,j,0,b.stringFilter);t._op&&t._op[a]&&t.kill(h,t._op[a]),z&&t._pt&&(Gt=t,l.killTweensOf(h,g,t.globalTime(n)),y=!t.parent,Gt=0),t._pt&&M&&(se[d.id]=1)}p&&pn(t),t._onInit&&t._onInit(t)}t._onUpdate=T,t._initted=(!t._op||t._pt)&&!y,B&&n<=0&&G.render(w,!0,!0)},Xt=function(e,t,n,r){var i,s,o=t.ease||r||"power1.inOut";if(N(t))s=n[e]||(n[e]=[]),t.forEach((function(e,n){return s.push({t:n/(t.length-1)*100,v:e,e:o})}));else for(i in t)s=n[i]||(n[i]=[]),"ease"===i||s.push({t:parseFloat(e),v:t[i],e:o})},Yt=function(e,t,n,r,i){return P(e)?e.call(t,n,r,i):I(e)&&~e.indexOf("random(")?ut(e):e},Kt=ue+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Jt={};fe(Kt+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return Jt[e]=1}));var Zt=function(e){function t(t,n,i,o){var a;"number"==typeof n&&(i.duration=n,n=i,i=null);var c,u,h,p,d,f,m,g,_=(a=e.call(this,o?n:Me(n))||this).vars,v=_.duration,y=_.delay,A=_.immediateRender,w=_.stagger,x=_.overwrite,E=_.keyframes,C=_.defaults,S=_.scrollTrigger,M=_.yoyoEase,T=n.parent||l,D=(N(t)||U(t)?R(t[0]):"length"in n)?[t]:nt(t);if(a._targets=D.length?he(D):J("GSAP target "+t+" not found. https://greensock.com",!b.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=x,E||w||F(v)||F(y)){if(n=a.vars,(c=a.timeline=new zt({data:"nested",defaults:C||{},targets:T&&"nested"===T.data?T.vars.targets:D})).kill(),c.parent=c._dp=r(a),c._start=0,w||F(v)||F(y)){if(p=D.length,m=w&&st(w),k(w))for(d in w)~Kt.indexOf(d)&&(g||(g={}),g[d]=w[d]);for(u=0;u<p;u++)(h=Se(n,Jt)).stagger=0,M&&(h.yoyoEase=M),g&&Ee(h,g),f=D[u],h.duration=+Yt(v,r(a),u,f,D),h.delay=(+Yt(y,r(a),u,f,D)||0)-a._delay,!w&&1===p&&h.delay&&(a._delay=y=h.delay,a._start+=y,h.delay=0),c.to(f,h,m?m(u,f,D):0),c._ease=Tt.none;c.duration()?v=y=0:a.timeline=0}else if(E){Me(xe(c.vars.defaults,{ease:"none"})),c._ease=kt(E.ease||n.ease||"none");var I,P,B,L=0;if(N(E))E.forEach((function(e){return c.to(D,e,">")})),c.duration();else{for(d in h={},E)"ease"===d||"easeEach"===d||Xt(d,E[d],h,E.easeEach);for(d in h)for(I=h[d].sort((function(e,t){return e.t-t.t})),L=0,u=0;u<I.length;u++)(B={ease:(P=I[u]).e,duration:(P.t-(u?I[u-1].t:0))/100*v})[d]=P.v,c.to(D,B,L),L+=B.duration;c.duration()<v&&c.to({},{duration:v-c.duration()})}}v||a.duration(v=c.duration())}else a.timeline=0;return!0!==x||s||(Gt=r(a),l.killTweensOf(D),Gt=0),je(T,r(a),i),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(A||!v&&!E&&a._start===ge(T._time)&&O(A)&&Be(r(a))&&"nested"!==T.data)&&(a._tTime=-1e-8,a.render(Math.max(0,-y)||0)),S&&ze(r(a),S),a}i(t,e);var n=t.prototype;return n.render=function(e,t,n){var r,i,s,a,l,c,u,h,p,d=this._time,f=this._tDur,m=this._dur,g=e<0,_=e>f-x&&!g?f:e<x?0:e;if(m){if(_!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==g){if(r=_,h=this.timeline,this._repeat){if(a=m+this._rDelay,this._repeat<-1&&g)return this.totalTime(100*a+e,t,n);if(r=ge(_%a),_===f?(s=this._repeat,r=m):((s=~~(_/a))&&s===_/a&&(r=m,s--),r>m&&(r=m)),(c=this._yoyo&&1&s)&&(p=this._yEase,r=m-r),l=Oe(this._tTime,a),r===d&&!n&&this._initted)return this._tTime=_,this;s!==l&&(h&&this._yEase&&Bt(h,c),!this.vars.repeatRefresh||c||this._lock||(this._lock=n=1,this.render(ge(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(Ge(this,g?e:r,n,t,_))return this._tTime=0,this;if(d!==this._time)return this;if(m!==this._dur)return this.render(e,t,n)}if(this._tTime=_,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(p||this._ease)(r/m),this._from&&(this.ratio=u=1-u),r&&!d&&!t&&!s&&(dt(this,"onStart"),this._tTime!==_))return this;for(i=this._pt;i;)i.r(u,i.d),i=i._next;h&&h.render(e<0?e:!r&&c?-1e-8:h._dur*h._ease(r/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(g&&Re(this,e,0,n),dt(this,"onUpdate")),this._repeat&&s!==l&&this.vars.onRepeat&&!t&&this.parent&&dt(this,"onRepeat"),_!==this._tDur&&_||this._tTime!==_||(g&&!this._onUpdate&&Re(this,e,0,!0),(e||!m)&&(_===this._tDur&&this._ts>0||!_&&this._ts<0)&&Ie(this,1),t||g&&!d||!(_||d||c)||(dt(this,_===f?"onComplete":"onReverseComplete",!0),this._prom&&!(_<f&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,r){var i,s,a,l=e.ratio,c=t<0||!t&&(!e._start&&Ve(e)&&(e._initted||!He(e))||(e._ts<0||e._dp._ts<0)&&!He(e))?0:1,u=e._rDelay,h=0;if(u&&e._repeat&&(h=Je(0,e._tDur,t),s=Oe(h,u),e._yoyo&&1&s&&(c=1-c),s!==Oe(e._tTime,u)&&(l=1-c,e.vars.repeatRefresh&&e._initted&&e.invalidate())),c!==l||o||r||e._zTime===x||!t&&e._zTime){if(!e._initted&&Ge(e,t,r,n,h))return;for(a=e._zTime,e._zTime=t||(n?x:0),n||(n=t&&!a),e.ratio=c,e._from&&(c=1-c),e._time=0,e._tTime=h,i=e._pt;i;)i.r(c,i.d),i=i._next;t<0&&Re(e,t,0,!0),e._onUpdate&&!n&&dt(e,"onUpdate"),h&&e._repeat&&!n&&e.parent&&dt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===c&&(c&&Ie(e,1),n||o||(dt(e,c?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,r){m||St.wake(),this._ts||this.play();var i=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||qt(this,i),function(e,t,n,r,i,s,o){var a,l,c,u,h=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!h)for(h=e._ptCache[t]=[],c=e._ptLookup,u=e._targets.length;u--;){if((a=c[u][t])&&a.d&&a.d._pt)for(a=a.d._pt;a&&a.p!==t&&a.fp!==t;)a=a._next;if(!a)return Vt=1,e.vars[t]="+=0",qt(e,o),Vt=0,1;h.push(a)}for(u=h.length;u--;)(a=(l=h[u])._pt||l).s=!r&&0!==r||i?a.s+(r||0)+s*a.c:r,a.c=n-a.s,l.e&&(l.e=me(n)+Ze(l.e)),l.b&&(l.b=a.s+Ze(l.b))}(this,e,t,n,r,this._ease(i/this._dur),i)?this.resetTo(e,t,n,r):(Ue(this,0),this.parent||Te(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?ft(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,Gt&&!0!==Gt.vars.overwrite)._first||ft(this),this.parent&&n!==this.timeline.totalDuration()&&Qe(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,s,o,a,l,c,u=this._targets,h=e?nt(e):u,p=this._ptLookup,d=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0}(u,h))return"all"===t&&(this._pt=0),ft(this);for(r=this._op=this._op||[],"all"!==t&&(I(t)&&(a={},fe(t,(function(e){return a[e]=1})),t=a),t=function(e,t){var n,r,i,s,o=e[0]?pe(e[0]).harness:0,a=o&&o.aliases;if(!a)return t;for(r in n=Ee({},t),a)if(r in n)for(i=(s=a[r].split(",")).length;i--;)n[s[i]]=n[r];return n}(u,t)),c=u.length;c--;)if(~h.indexOf(u[c]))for(a in i=p[c],"all"===t?(r[c]=t,o=i,s={}):(s=r[c]=r[c]||{},o=t),o)(l=i&&i[a])&&("kill"in l.d&&!0!==l.d.kill(a)||De(this,l,"_pt"),delete i[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&d&&ft(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return Ye(1,arguments)},t.delayedCall=function(e,n,r,i){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},t.fromTo=function(e,t,n){return Ye(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return l.killTweensOf(e,t,n)},t}(jt);xe(Zt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),fe("staggerTo,staggerFrom,staggerFromTo",(function(e){Zt[e]=function(){var t=new zt,n=$e.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var $t=function(e,t,n){return e[t]=n},en=function(e,t,n){return e[t](n)},tn=function(e,t,n,r){return e[t](r.fp,n)},nn=function(e,t,n){return e.setAttribute(t,n)},rn=function(e,t){return P(e[t])?en:B(e[t])&&e.setAttribute?nn:$t},sn=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},on=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},an=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(1===e&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},ln=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},cn=function(e,t,n,r){for(var i,s=this._pt;s;)i=s._next,s.p===r&&s.modifier(e,t,n),s=i},un=function(e){for(var t,n,r=this._pt;r;)n=r._next,r.p===e&&!r.op||r.op===e?De(this,r,"_pt"):r.dep||(t=1),r=n;return!t},hn=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},pn=function(e){for(var t,n,r,i,s=e._pt;s;){for(t=s._next,n=r;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:i)?s._prev._next=s:r=s,(s._next=n)?n._prev=s:i=s,s=t}e._pt=r},dn=function(){function e(e,t,n,r,i,s,o,a,l){this.t=t,this.s=r,this.c=i,this.p=n,this.r=s||sn,this.d=o||this,this.set=a||$t,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=hn,this.m=e,this.mt=n,this.tween=t},e}();fe(ue+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return re[e]=1})),q.TweenMax=q.TweenLite=Zt,q.TimelineLite=q.TimelineMax=zt,l=new zt({sortChildren:!1,defaults:A,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),b.stringFilter=Ct;var fn=[],mn={},gn=[],_n=0,vn=0,yn=function(e){return(mn[e]||gn).map((function(e){return e()}))},bn=function(){var e=Date.now(),t=[];e-_n>2&&(yn("matchMediaInit"),fn.forEach((function(e){var n,r,i,s,o=e.queries,a=e.conditions;for(r in o)(n=c.matchMedia(o[r]).matches)&&(i=1),n!==a[r]&&(a[r]=n,s=1);s&&(e.revert(),i&&t.push(e))})),yn("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e)})),_n=e,yn("matchMedia"))},An=function(){function e(e,t){this.selector=t&&rt(t),this.data=[],this._r=[],this.isReverted=!1,this.id=vn++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){P(e)&&(n=t,t=e,e=P);var r=this,i=function(){var e,i=a,s=r.selector;return i&&i!==r&&i.data.push(r),n&&(r.selector=rt(n)),a=r,e=t.apply(r,arguments),P(e)&&r._r.push(e),a=i,r.selector=s,r.isReverted=!1,e};return r.last=i,e===P?i(r):e?r[e]=i:i},t.ignore=function(e){var t=a;a=null,e(this),a=t},t.getTweens=function(){var t=[];return this.data.forEach((function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof Zt&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e){var r=this.getTweens();this.data.forEach((function(e){"isFlip"===e.data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(e){return r.splice(r.indexOf(e),1)})))})),r.map((function(e){return{g:e.globalTime(0),t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),this.data.forEach((function(t){return!(t instanceof Zt)&&t.revert&&t.revert(e)})),this._r.forEach((function(t){return t(e,n)})),this.isReverted=!0}else this.data.forEach((function(e){return e.kill&&e.kill()}));if(this.clear(),t)for(var i=fn.length;i--;)fn[i].id===this.id&&fn.splice(i,1)},t.revert=function(e){this.kill(e||{})},e}(),wn=function(){function e(e){this.contexts=[],this.scope=e}var t=e.prototype;return t.add=function(e,t,n){k(e)||(e={matches:e});var r,i,s,o=new An(0,n||this.scope),l=o.conditions={};for(i in a&&!o.selector&&(o.selector=a.selector),this.contexts.push(o),t=o.add("onMatch",t),o.queries=e,e)"all"===i?s=1:(r=c.matchMedia(e[i]))&&(fn.indexOf(o)<0&&fn.push(o),(l[i]=r.matches)&&(s=1),r.addListener?r.addListener(bn):r.addEventListener("change",bn));return s&&t(o),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),xn={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return gt(e)}))},timeline:function(e){return new zt(e)},getTweensOf:function(e,t){return l.getTweensOf(e,t)},getProperty:function(e,t,n,r){I(e)&&(e=nt(e)[0]);var i=pe(e||{}).get,s=n?we:Ae;return"native"===n&&(n=""),e?t?s((oe[t]&&oe[t].get||i)(e,t,n,r)):function(t,n,r){return s((oe[t]&&oe[t].get||i)(e,t,n,r))}:e},quickSetter:function(e,t,n){if((e=nt(e)).length>1){var r=e.map((function(e){return Sn.quickSetter(e,t,n)})),i=r.length;return function(e){for(var t=i;t--;)r[t](e)}}e=e[0]||{};var s=oe[t],o=pe(e),a=o.harness&&(o.harness.aliases||{})[t]||t,l=s?function(t){var r=new s;f._pt=0,r.init(e,n?t+n:t,f,0,[e]),r.render(1,r),f._pt&&ln(1,f)}:o.set(e,a);return s?l:function(t){return l(e,a,n?t+n:t,o,1)}},quickTo:function(e,t,n){var r,i=Sn.to(e,Ee(((r={})[t]="+=0.1",r.paused=!0,r),n||{})),s=function(e,n,r){return i.resetTo(t,e,n,r)};return s.tween=i,s},isTweening:function(e){return l.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=kt(e.ease,A.ease)),Ce(A,e||{})},config:function(e){return Ce(b,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,i=e.defaults,s=e.extendTimeline;(r||"").split(",").forEach((function(e){return e&&!oe[e]&&!q[e]&&J(t+" effect requires "+e+" plugin.")})),ae[t]=function(e,t,r){return n(nt(e),xe(t||{},i),r)},s&&(zt.prototype[t]=function(e,n,r){return this.add(ae[t](e,k(n)?n:(r=n)&&{},this),r)})},registerEase:function(e,t){Tt[e]=kt(t)},parseEase:function(e,t){return arguments.length?kt(e,t):Tt},getById:function(e){return l.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,r,i=new zt(e);for(i.smoothChildTiming=O(e.smoothChildTiming),l.remove(i),i._dp=0,i._time=i._tTime=l._time,n=l._first;n;)r=n._next,!t&&!n._dur&&n instanceof Zt&&n.vars.onComplete===n._targets[0]||je(i,n,n._start-n._delay),n=r;return je(l,i,0),i},context:function(e,t){return e?new An(e,t):a},matchMedia:function(e){return new wn(e)},matchMediaRefresh:function(){return fn.forEach((function(e){var t,n,r=e.conditions;for(n in r)r[n]&&(r[n]=!1,t=1);t&&e.revert()}))||bn()},addEventListener:function(e,t){var n=mn[e]||(mn[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=mn[e],r=n&&n.indexOf(t);r>=0&&n.splice(r,1)},utils:{wrap:function e(t,n,r){var i=n-t;return N(t)?ct(t,e(0,t.length),n):Ke(r,(function(e){return(i+(e-t)%i)%i+t}))},wrapYoyo:function e(t,n,r){var i=n-t,s=2*i;return N(t)?ct(t,e(0,t.length-1),n):Ke(r,(function(e){return t+((e=(s+(e-t)%s)%s||0)>i?s-e:e)}))},distribute:st,random:lt,snap:at,normalize:function(e,t,n){return ht(e,t,0,1,n)},getUnit:Ze,clamp:function(e,t,n){return Ke(n,(function(n){return Je(e,t,n)}))},splitColor:bt,toArray:nt,selector:rt,mapRange:ht,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||Ze(n))}},interpolate:function e(t,n,r,i){var s=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!s){var o,a,l,c,u,h=I(t),p={};if(!0===r&&(i=1)&&(r=null),h)t={p:t},n={p:n};else if(N(t)&&!N(n)){for(l=[],c=t.length,u=c-2,a=1;a<c;a++)l.push(e(t[a-1],t[a]));c--,s=function(e){e*=c;var t=Math.min(u,~~e);return l[t](e-t)},r=n}else i||(t=Ee(N(t)?[]:{},t));if(!l){for(o in n)Qt.call(p,t,o,"get",n[o]);s=function(e){return ln(e,p)||(h?t.p:t)}}}return Ke(r,s)},shuffle:it},install:Y,effects:ae,ticker:St,updateRoot:zt.updateRoot,plugins:oe,globalTimeline:l,core:{PropTween:dn,globals:Z,Tween:Zt,Timeline:zt,Animation:jt,getCache:pe,_removeLinkedListItem:De,reverting:function(){return o},context:function(e){return e&&a&&(a.data.push(e),e._ctx=a),a},suppressOverwrites:function(e){return s=e}}};fe("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return xn[e]=Zt[e]})),St.add(zt.updateRoot),f=xn.to({},{duration:0});var En=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},Cn=function(e,t){return{name:e,rawVars:1,init:function(e,n,r){r._onInit=function(e){var r,i;if(I(n)&&(r={},fe(n,(function(e){return r[e]=1})),n=r),t){for(i in r={},n)r[i]=t(n[i]);n=r}!function(e,t){var n,r,i,s=e._targets;for(n in t)for(r=s.length;r--;)(i=e._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=En(i,n)),i&&i.modifier&&i.modifier(t[n],e,s[r],n))}(e,n)}}}},Sn=xn.registerPlugin({name:"attr",init:function(e,t,n,r,i){var s,o,a;for(s in this.tween=n,t)a=e.getAttribute(s)||"",(o=this.add(e,"setAttribute",(a||0)+"",t[s],r,i,0,0,s)).op=s,o.b=a,this._props.push(s)},render:function(e,t){for(var n=t._pt;n;)o?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},Cn("roundProps",ot),Cn("modifiers"),Cn("snap",at))||xn;Zt.version=zt.version=Sn.version="3.12.2",p=1,L()&&Mt();Tt.Power0,Tt.Power1,Tt.Power2,Tt.Power3,Tt.Power4,Tt.Linear,Tt.Quad,Tt.Cubic,Tt.Quart,Tt.Quint,Tt.Strong,Tt.Elastic,Tt.Back,Tt.SteppedEase,Tt.Bounce,Tt.Sine,Tt.Expo,Tt.Circ;var Mn,Tn,Dn,In,Pn,Rn,Bn,kn,On={},Ln=180/Math.PI,Fn=Math.PI/180,Un=Math.atan2,Nn=/([A-Z])/g,jn=/(left|right|width|margin|padding|x)/i,zn=/[\s,\(]\S/,Gn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Vn=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},Hn=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},Qn=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Wn=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},qn=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Xn=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Yn=function(e,t,n){return e.style[t]=n},Kn=function(e,t,n){return e.style.setProperty(t,n)},Jn=function(e,t,n){return e._gsap[t]=n},Zn=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},$n=function(e,t,n,r,i){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(i,s)},er=function(e,t,n,r,i){var s=e._gsap;s[t]=n,s.renderTransform(i,s)},tr="transform",nr=tr+"Origin",rr=function e(t,n){var r=this,i=this.target,s=i.style;if(t in On&&s){if(this.tfm=this.tfm||{},"transform"===t)return Gn.transform.split(",").forEach((function(t){return e.call(r,t,n)}));if(~(t=Gn[t]||t).indexOf(",")?t.split(",").forEach((function(e){return r.tfm[e]=Ar(i,e)})):this.tfm[t]=i._gsap.x?i._gsap[t]:Ar(i,t),this.props.indexOf(tr)>=0)return;i._gsap.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(nr,n,"")),t=tr}(s||n)&&this.props.push(t,n,s[t])},ir=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},sr=function(){var e,t,n=this.props,r=this.target,i=r.style,s=r._gsap;for(e=0;e<n.length;e+=3)n[e+1]?r[n[e]]=n[e+2]:n[e+2]?i[n[e]]=n[e+2]:i.removeProperty("--"===n[e].substr(0,2)?n[e]:n[e].replace(Nn,"-$1").toLowerCase());if(this.tfm){for(t in this.tfm)s[t]=this.tfm[t];s.svg&&(s.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(e=Bn())&&e.isStart||i[tr]||(ir(i),s.uncache=1)}},or=function(e,t){var n={target:e,props:[],revert:sr,save:rr};return e._gsap||Sn.core.getCache(e),t&&t.split(",").forEach((function(e){return n.save(e)})),n},ar=function(e,t){var n=Tn.createElementNS?Tn.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Tn.createElement(e);return n.style?n:Tn.createElement(e)},lr=function e(t,n,r){var i=getComputedStyle(t);return i[n]||i.getPropertyValue(n.replace(Nn,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&e(t,ur(n)||n,1)||""},cr="O,Moz,ms,Ms,Webkit".split(","),ur=function(e,t,n){var r=(t||Pn).style,i=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);i--&&!(cr[i]+e in r););return i<0?null:(3===i?"ms":i>=0?cr[i]:"")+e},hr=function(){"undefined"!=typeof window&&window.document&&(Mn=window,Tn=Mn.document,Dn=Tn.documentElement,Pn=ar("div")||{style:{}},ar("div"),tr=ur(tr),nr=tr+"Origin",Pn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",kn=!!ur("perspective"),Bn=Sn.core.reverting,In=1)},pr=function e(t){var n,r=ar("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,s=this.nextSibling,o=this.style.cssText;if(Dn.appendChild(r),r.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(s?i.insertBefore(this,s):i.appendChild(this)),Dn.removeChild(r),this.style.cssText=o,n},dr=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},fr=function(e){var t;try{t=e.getBBox()}catch(n){t=pr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===pr||(t=pr.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+dr(e,["x","cx","x1"])||0,y:+dr(e,["y","cy","y1"])||0,width:0,height:0}},mr=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!fr(e))},gr=function(e,t){if(t){var n=e.style;t in On&&t!==nr&&(t=tr),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(Nn,"-$1").toLowerCase())):n.removeAttribute(t)}},_r=function(e,t,n,r,i,s){var o=new dn(e._pt,t,n,0,1,s?Xn:qn);return e._pt=o,o.b=r,o.e=i,e._props.push(n),o},vr={deg:1,rad:1,turn:1},yr={grid:1,flex:1},br=function e(t,n,r,i){var s,o,a,l,c=parseFloat(r)||0,u=(r+"").trim().substr((c+"").length)||"px",h=Pn.style,p=jn.test(n),d="svg"===t.tagName.toLowerCase(),f=(d?"client":"offset")+(p?"Width":"Height"),m=100,g="px"===i,_="%"===i;return i===u||!c||vr[i]||vr[u]?c:("px"!==u&&!g&&(c=e(t,n,r,"px")),l=t.getCTM&&mr(t),!_&&"%"!==u||!On[n]&&!~n.indexOf("adius")?(h[p?"width":"height"]=m+(g?u:i),o=~n.indexOf("adius")||"em"===i&&t.appendChild&&!d?t:t.parentNode,l&&(o=(t.ownerSVGElement||{}).parentNode),o&&o!==Tn&&o.appendChild||(o=Tn.body),(a=o._gsap)&&_&&a.width&&p&&a.time===St.time&&!a.uncache?me(c/a.width*m):((_||"%"===u)&&!yr[lr(o,"display")]&&(h.position=lr(t,"position")),o===t&&(h.position="static"),o.appendChild(Pn),s=Pn[f],o.removeChild(Pn),h.position="absolute",p&&_&&((a=pe(o)).time=St.time,a.width=o[f]),me(g?s*c/m:s&&c?m/s*c:0))):(s=l?t.getBBox()[p?"width":"height"]:t[f],me(_?c/s*m:c/100*s)))},Ar=function(e,t,n,r){var i;return In||hr(),t in Gn&&"transform"!==t&&~(t=Gn[t]).indexOf(",")&&(t=t.split(",")[0]),On[t]&&"transform"!==t?(i=Rr(e,r),i="transformOrigin"!==t?i[t]:i.svg?i.origin:Br(lr(e,nr))+" "+i.zOrigin+"px"):(!(i=e.style[t])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Cr[t]&&Cr[t](e,t,n)||lr(e,t)||de(e,t)||("opacity"===t?1:0)),n&&!~(i+"").trim().indexOf(" ")?br(e,t,i,n)+n:i},wr=function(e,t,n,r){if(!n||"none"===n){var i=ur(t,e,1),s=i&&lr(e,i,1);s&&s!==n?(t=i,n=s):"borderColor"===t&&(n=lr(e,"borderTopColor"))}var o,a,l,c,u,h,p,d,f,m,g,_=new dn(this._pt,e.style,t,0,1,an),v=0,y=0;if(_.b=n,_.e=r,n+="","auto"===(r+="")&&(e.style[t]=r,r=lr(e,t)||r,e.style[t]=n),Ct(o=[n,r]),r=o[1],l=(n=o[0]).match(G)||[],(r.match(G)||[]).length){for(;a=G.exec(r);)p=a[0],f=r.substring(v,a.index),u?u=(u+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(u=1),p!==(h=l[y++]||"")&&(c=parseFloat(h)||0,g=h.substr((c+"").length),"="===p.charAt(1)&&(p=_e(c,p)+g),d=parseFloat(p),m=p.substr((d+"").length),v=G.lastIndex-m.length,m||(m=m||b.units[t]||g,v===r.length&&(r+=m,_.e+=m)),g!==m&&(c=br(e,t,h,m)||0),_._pt={_next:_._pt,p:f||1===y?f:",",s:c,c:d-c,m:u&&u<4||"zIndex"===t?Math.round:0});_.c=v<r.length?r.substring(v,r.length):""}else _.r="display"===t&&"none"===r?Xn:qn;return H.test(r)&&(_.e=0),this._pt=_,_},xr={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Er=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,r,i,s=t.t,o=s.style,a=t.u,l=s._gsap;if("all"===a||!0===a)o.cssText="",r=1;else for(i=(a=a.split(",")).length;--i>-1;)n=a[i],On[n]&&(r=1,n="transformOrigin"===n?nr:tr),gr(s,n);r&&(gr(s,tr),l&&(l.svg&&s.removeAttribute("transform"),Rr(s,1),l.uncache=1,ir(o)))}},Cr={clearProps:function(e,t,n,r,i){if("isFromStart"!==i.data){var s=e._pt=new dn(e._pt,t,n,0,0,Er);return s.u=r,s.pr=-10,s.tween=i,e._props.push(n),1}}},Sr=[1,0,0,1,0,0],Mr={},Tr=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},Dr=function(e){var t=lr(e,tr);return Tr(t)?Sr:t.substr(7).match(z).map(me)},Ir=function(e,t){var n,r,i,s,o=e._gsap||pe(e),a=e.style,l=Dr(e);return o.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(i=e.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Sr:l:(l!==Sr||e.offsetParent||e===Dn||o.svg||(i=a.display,a.display="block",(n=e.parentNode)&&e.offsetParent||(s=1,r=e.nextElementSibling,Dn.appendChild(e)),l=Dr(e),i?a.display=i:gr(e,"display"),s&&(r?n.insertBefore(e,r):n?n.appendChild(e):Dn.removeChild(e))),t&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Pr=function(e,t,n,r,i,s){var o,a,l,c=e._gsap,u=i||Ir(e,!0),h=c.xOrigin||0,p=c.yOrigin||0,d=c.xOffset||0,f=c.yOffset||0,m=u[0],g=u[1],_=u[2],v=u[3],y=u[4],b=u[5],A=t.split(" "),w=parseFloat(A[0])||0,x=parseFloat(A[1])||0;n?u!==Sr&&(a=m*v-g*_)&&(l=w*(-g/a)+x*(m/a)-(m*b-g*y)/a,w=w*(v/a)+x*(-_/a)+(_*b-v*y)/a,x=l):(w=(o=fr(e)).x+(~A[0].indexOf("%")?w/100*o.width:w),x=o.y+(~(A[1]||A[0]).indexOf("%")?x/100*o.height:x)),r||!1!==r&&c.smooth?(y=w-h,b=x-p,c.xOffset=d+(y*m+b*_)-y,c.yOffset=f+(y*g+b*v)-b):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=x,c.smooth=!!r,c.origin=t,c.originIsAbsolute=!!n,e.style[nr]="0px 0px",s&&(_r(s,c,"xOrigin",h,w),_r(s,c,"yOrigin",p,x),_r(s,c,"xOffset",d,c.xOffset),_r(s,c,"yOffset",f,c.yOffset)),e.setAttribute("data-svg-origin",w+" "+x)},Rr=function(e,t){var n=e._gsap||new Nt(e);if("x"in n&&!t&&!n.uncache)return n;var r,i,s,o,a,l,c,u,h,p,d,f,m,g,_,v,y,A,w,x,E,C,S,M,T,D,I,P,R,B,k,O,L=e.style,F=n.scaleX<0,U="px",N="deg",j=getComputedStyle(e),z=lr(e,nr)||"0";return r=i=s=l=c=u=h=p=d=0,o=a=1,n.svg=!(!e.getCTM||!mr(e)),j.translate&&("none"===j.translate&&"none"===j.scale&&"none"===j.rotate||(L[tr]=("none"!==j.translate?"translate3d("+(j.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==j.rotate?"rotate("+j.rotate+") ":"")+("none"!==j.scale?"scale("+j.scale.split(" ").join(",")+") ":"")+("none"!==j[tr]?j[tr]:"")),L.scale=L.rotate=L.translate="none"),g=Ir(e,n.svg),n.svg&&(n.uncache?(T=e.getBBox(),z=n.xOrigin-T.x+"px "+(n.yOrigin-T.y)+"px",M=""):M=!t&&e.getAttribute("data-svg-origin"),Pr(e,M||z,!!M||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==Sr&&(A=g[0],w=g[1],x=g[2],E=g[3],r=C=g[4],i=S=g[5],6===g.length?(o=Math.sqrt(A*A+w*w),a=Math.sqrt(E*E+x*x),l=A||w?Un(w,A)*Ln:0,(h=x||E?Un(x,E)*Ln+l:0)&&(a*=Math.abs(Math.cos(h*Fn))),n.svg&&(r-=f-(f*A+m*x),i-=m-(f*w+m*E))):(O=g[6],B=g[7],I=g[8],P=g[9],R=g[10],k=g[11],r=g[12],i=g[13],s=g[14],c=(_=Un(O,R))*Ln,_&&(M=C*(v=Math.cos(-_))+I*(y=Math.sin(-_)),T=S*v+P*y,D=O*v+R*y,I=C*-y+I*v,P=S*-y+P*v,R=O*-y+R*v,k=B*-y+k*v,C=M,S=T,O=D),u=(_=Un(-x,R))*Ln,_&&(v=Math.cos(-_),k=E*(y=Math.sin(-_))+k*v,A=M=A*v-I*y,w=T=w*v-P*y,x=D=x*v-R*y),l=(_=Un(w,A))*Ln,_&&(M=A*(v=Math.cos(_))+w*(y=Math.sin(_)),T=C*v+S*y,w=w*v-A*y,S=S*v-C*y,A=M,C=T),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,u=180-u),o=me(Math.sqrt(A*A+w*w+x*x)),a=me(Math.sqrt(S*S+O*O)),_=Un(C,S),h=Math.abs(_)>2e-4?_*Ln:0,d=k?1/(k<0?-k:k):0),n.svg&&(M=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Tr(lr(e,tr)),M&&e.setAttribute("transform",M))),Math.abs(h)>90&&Math.abs(h)<270&&(F?(o*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(a*=-1,h+=h<=0?180:-180)),t=t||n.uncache,n.x=r-((n.xPercent=r&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-r)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+U,n.y=i-((n.yPercent=i&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-i)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+U,n.z=s+U,n.scaleX=me(o),n.scaleY=me(a),n.rotation=me(l)+N,n.rotationX=me(c)+N,n.rotationY=me(u)+N,n.skewX=h+N,n.skewY=p+N,n.transformPerspective=d+U,(n.zOrigin=parseFloat(z.split(" ")[2])||0)&&(L[nr]=Br(z)),n.xOffset=n.yOffset=0,n.force3D=b.force3D,n.renderTransform=n.svg?jr:kn?Nr:Or,n.uncache=0,n},Br=function(e){return(e=e.split(" "))[0]+" "+e[1]},kr=function(e,t,n){var r=Ze(t);return me(parseFloat(t)+parseFloat(br(e,"x",n+"px",r)))+r},Or=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Nr(e,t)},Lr="0deg",Fr="0px",Ur=") ",Nr=function(e,t){var n=t||this,r=n.xPercent,i=n.yPercent,s=n.x,o=n.y,a=n.z,l=n.rotation,c=n.rotationY,u=n.rotationX,h=n.skewX,p=n.skewY,d=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,_=n.target,v=n.zOrigin,y="",b="auto"===g&&e&&1!==e||!0===g;if(v&&(u!==Lr||c!==Lr)){var A,w=parseFloat(c)*Fn,x=Math.sin(w),E=Math.cos(w);w=parseFloat(u)*Fn,A=Math.cos(w),s=kr(_,s,x*A*-v),o=kr(_,o,-Math.sin(w)*-v),a=kr(_,a,E*A*-v+v)}m!==Fr&&(y+="perspective("+m+Ur),(r||i)&&(y+="translate("+r+"%, "+i+"%) "),(b||s!==Fr||o!==Fr||a!==Fr)&&(y+=a!==Fr||b?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+Ur),l!==Lr&&(y+="rotate("+l+Ur),c!==Lr&&(y+="rotateY("+c+Ur),u!==Lr&&(y+="rotateX("+u+Ur),h===Lr&&p===Lr||(y+="skew("+h+", "+p+Ur),1===d&&1===f||(y+="scale("+d+", "+f+Ur),_.style[tr]=y||"translate(0, 0)"},jr=function(e,t){var n,r,i,s,o,a=t||this,l=a.xPercent,c=a.yPercent,u=a.x,h=a.y,p=a.rotation,d=a.skewX,f=a.skewY,m=a.scaleX,g=a.scaleY,_=a.target,v=a.xOrigin,y=a.yOrigin,b=a.xOffset,A=a.yOffset,w=a.forceCSS,x=parseFloat(u),E=parseFloat(h);p=parseFloat(p),d=parseFloat(d),(f=parseFloat(f))&&(d+=f=parseFloat(f),p+=f),p||d?(p*=Fn,d*=Fn,n=Math.cos(p)*m,r=Math.sin(p)*m,i=Math.sin(p-d)*-g,s=Math.cos(p-d)*g,d&&(f*=Fn,o=Math.tan(d-f),i*=o=Math.sqrt(1+o*o),s*=o,f&&(o=Math.tan(f),n*=o=Math.sqrt(1+o*o),r*=o)),n=me(n),r=me(r),i=me(i),s=me(s)):(n=m,s=g,r=i=0),(x&&!~(u+"").indexOf("px")||E&&!~(h+"").indexOf("px"))&&(x=br(_,"x",u,"px"),E=br(_,"y",h,"px")),(v||y||b||A)&&(x=me(x+v-(v*n+y*i)+b),E=me(E+y-(v*r+y*s)+A)),(l||c)&&(o=_.getBBox(),x=me(x+l/100*o.width),E=me(E+c/100*o.height)),o="matrix("+n+","+r+","+i+","+s+","+x+","+E+")",_.setAttribute("transform",o),w&&(_.style[tr]=o)},zr=function(e,t,n,r,i){var s,o,a=360,l=I(i),c=parseFloat(i)*(l&&~i.indexOf("rad")?Ln:1)-r,u=r+c+"deg";return l&&("short"===(s=i.split("_")[1])&&(c%=a)!==c%180&&(c+=c<0?a:-360),"cw"===s&&c<0?c=(c+36e9)%a-~~(c/a)*a:"ccw"===s&&c>0&&(c=(c-36e9)%a-~~(c/a)*a)),e._pt=o=new dn(e._pt,t,n,r,c,Hn),o.e=u,o.u="deg",e._props.push(n),o},Gr=function(e,t){for(var n in t)e[n]=t[n];return e},Vr=function(e,t,n){var r,i,s,o,a,l,c,u=Gr({},n._gsap),h=n.style;for(i in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),h[tr]=t,r=Rr(n,1),gr(n,tr),n.setAttribute("transform",s)):(s=getComputedStyle(n)[tr],h[tr]=t,r=Rr(n,1),h[tr]=s),On)(s=u[i])!==(o=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(a=Ze(s)!==(c=Ze(o))?br(n,i,s,c):parseFloat(s),l=parseFloat(o),e._pt=new dn(e._pt,r,i,a,l-a,Vn),e._pt.u=c||0,e._props.push(i));Gr(r,u)};fe("padding,margin,Width,Radius",(function(e,t){var n="Top",r="Right",i="Bottom",s="Left",o=(t<3?[n,r,i,s]:[n+s,n+r,i+r,i+s]).map((function(n){return t<2?e+n:"border"+n+e}));Cr[t>1?"border"+e:e]=function(e,t,n,r,i){var s,a;if(arguments.length<4)return s=o.map((function(t){return Ar(e,t,n)})),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(r+"").split(" "),a={},o.forEach((function(e,t){return a[e]=s[t]=s[t]||s[(t-1)/2|0]})),e.init(t,a,i)}}));var Hr,Qr,Wr,qr={name:"css",register:hr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,i){var s,o,a,l,c,u,h,p,d,f,m,g,_,v,y,A,w,x,E,C,S=this._props,M=e.style,T=n.vars.startAt;for(h in In||hr(),this.styles=this.styles||or(e),A=this.styles.props,this.tween=n,t)if("autoRound"!==h&&(o=t[h],!oe[h]||!Wt(h,t,n,r,e,i)))if(c=typeof o,u=Cr[h],"function"===c&&(c=typeof(o=o.call(n,r,e,i))),"string"===c&&~o.indexOf("random(")&&(o=ut(o)),u)u(this,e,h,o,n)&&(y=1);else if("--"===h.substr(0,2))s=(getComputedStyle(e).getPropertyValue(h)+"").trim(),o+="",xt.lastIndex=0,xt.test(s)||(p=Ze(s),d=Ze(o)),d?p!==d&&(s=br(e,h,s,d)+d):p&&(o+=p),this.add(M,"setProperty",s,o,r,i,0,0,h),S.push(h),A.push(h,0,M[h]);else if("undefined"!==c){if(T&&h in T?(s="function"==typeof T[h]?T[h].call(n,r,e,i):T[h],I(s)&&~s.indexOf("random(")&&(s=ut(s)),Ze(s+"")||(s+=b.units[h]||Ze(Ar(e,h))||""),"="===(s+"").charAt(1)&&(s=Ar(e,h))):s=Ar(e,h),l=parseFloat(s),(f="string"===c&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),h in Gn&&("autoAlpha"===h&&(1===l&&"hidden"===Ar(e,"visibility")&&a&&(l=0),A.push("visibility",0,M.visibility),_r(this,M,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&~(h=Gn[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in On)if(this.styles.save(h),g||((_=e._gsap).renderTransform&&!t.parseTransform||Rr(e,t.parseTransform),v=!1!==t.smoothOrigin&&_.smooth,(g=this._pt=new dn(this._pt,M,tr,0,1,_.renderTransform,_,0,-1)).dep=1),"scale"===h)this._pt=new dn(this._pt,_,"scaleY",_.scaleY,(f?_e(_.scaleY,f+a):a)-_.scaleY||0,Vn),this._pt.u=0,S.push("scaleY",h),h+="X";else{if("transformOrigin"===h){A.push(nr,0,M[nr]),x=void 0,E=void 0,C=void 0,x=(w=o).split(" "),E=x[0],C=x[1]||"50%","top"!==E&&"bottom"!==E&&"left"!==C&&"right"!==C||(w=E,E=C,C=w),x[0]=xr[E]||E,x[1]=xr[C]||C,o=x.join(" "),_.svg?Pr(e,o,0,v,0,this):((d=parseFloat(o.split(" ")[2])||0)!==_.zOrigin&&_r(this,_,"zOrigin",_.zOrigin,d),_r(this,M,h,Br(s),Br(o)));continue}if("svgOrigin"===h){Pr(e,o,1,v,0,this);continue}if(h in Mr){zr(this,_,h,l,f?_e(l,f+o):o);continue}if("smoothOrigin"===h){_r(this,_,"smooth",_.smooth,o);continue}if("force3D"===h){_[h]=o;continue}if("transform"===h){Vr(this,o,e);continue}}else h in M||(h=ur(h)||h);if(m||(a||0===a)&&(l||0===l)&&!zn.test(o)&&h in M)a||(a=0),(p=(s+"").substr((l+"").length))!==(d=Ze(o)||(h in b.units?b.units[h]:p))&&(l=br(e,h,s,d)),this._pt=new dn(this._pt,m?_:M,h,l,(f?_e(l,f+a):a)-l,m||"px"!==d&&"zIndex"!==h||!1===t.autoRound?Vn:Wn),this._pt.u=d||0,p!==d&&"%"!==d&&(this._pt.b=s,this._pt.r=Qn);else if(h in M)wr.call(this,e,h,s,f?f+o:o);else if(h in e)this.add(e,h,s||e[h],f?f+o:o,r,i);else if("parseTransform"!==h){K(h,o);continue}m||(h in M?A.push(h,0,M[h]):A.push(h,1,s||e[h])),S.push(h)}y&&pn(this)},render:function(e,t){if(t.tween._time||!Bn())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Ar,aliases:Gn,getSetter:function(e,t,n){var r=Gn[t];return r&&r.indexOf(",")<0&&(t=r),t in On&&t!==nr&&(e._gsap.x||Ar(e,"x"))?n&&Rn===n?"scale"===t?Zn:Jn:(Rn=n||{})&&("scale"===t?$n:er):e.style&&!B(e.style[t])?Yn:~t.indexOf("-")?Kn:rn(e,t)},core:{_removeProperty:gr,_getMatrix:Ir}};Sn.utils.checkPrefix=ur,Sn.core.getStyleSaver=or,Wr=fe((Hr="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Qr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){On[e]=1})),fe(Qr,(function(e){b.units[e]="deg",Mr[e]=1})),Gn[Wr[13]]=Hr+","+Qr,fe("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");Gn[t[1]]=Wr[t[0]]})),fe("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){b.units[e]="px"})),Sn.registerPlugin(qr);var Xr=Sn.registerPlugin(qr)||Sn;Xr.core.Tween},315:function(e,t,n){var r,i;i=this,r=function(){return i.is=function(){var e={VERSION:"0.8.0",not:{},all:{},any:{}},t=Object.prototype.toString,r=Array.prototype.slice,i=Object.prototype.hasOwnProperty;function s(e){return function(){return!e.apply(null,r.call(arguments))}}function o(e){return function(){for(var t=u(arguments),n=t.length,r=0;r<n;r++)if(!e.call(null,t[r]))return!1;return!0}}function a(e){return function(){for(var t=u(arguments),n=t.length,r=0;r<n;r++)if(e.call(null,t[r]))return!0;return!1}}var l={"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t}};function c(e,t){var n=t+"",r=+(n.match(/\d+/)||NaN),i=n.match(/^[<>]=?|/)[0];return l[i]?l[i](e,r):e==r||r!=r}function u(t){var n=r.call(t);return 1===n.length&&e.array(n[0])&&(n=n[0]),n}e.arguments=function(e){return"[object Arguments]"===t.call(e)||null!=e&&"object"==typeof e&&"callee"in e},e.array=Array.isArray||function(e){return"[object Array]"===t.call(e)},e.boolean=function(e){return!0===e||!1===e||"[object Boolean]"===t.call(e)},e.char=function(t){return e.string(t)&&1===t.length},e.date=function(e){return"[object Date]"===t.call(e)},e.domNode=function(t){return e.object(t)&&t.nodeType>0},e.error=function(e){return"[object Error]"===t.call(e)},e.function=function(e){return"[object Function]"===t.call(e)||"function"==typeof e},e.json=function(e){return"[object Object]"===t.call(e)},e.nan=function(e){return e!=e},e.null=function(e){return null===e},e.number=function(n){return e.not.nan(n)&&"[object Number]"===t.call(n)},e.object=function(e){return Object(e)===e},e.regexp=function(e){return"[object RegExp]"===t.call(e)},e.sameType=function(n,r){var i=t.call(n);return i===t.call(r)&&("[object Number]"!==i||!e.any.nan(n,r)||e.all.nan(n,r))},e.sameType.api=["not"],e.string=function(e){return"[object String]"===t.call(e)},e.undefined=function(e){return void 0===e},e.windowObject=function(e){return null!=e&&"object"==typeof e&&"setInterval"in e},e.empty=function(t){if(e.object(t)){var n=Object.getOwnPropertyNames(t).length;return!!(0===n||1===n&&e.array(t)||2===n&&e.arguments(t))}return""===t},e.existy=function(e){return null!=e},e.falsy=function(e){return!e},e.truthy=s(e.falsy),e.above=function(t,n){return e.all.number(t,n)&&t>n},e.above.api=["not"],e.decimal=function(t){return e.number(t)&&t%1!=0},e.equal=function(t,n){return e.all.number(t,n)?t===n&&1/t==1/n:e.all.string(t,n)||e.all.regexp(t,n)?""+t==""+n:!!e.all.boolean(t,n)&&t===n},e.equal.api=["not"],e.even=function(t){return e.number(t)&&t%2==0},e.finite=isFinite||function(t){return e.not.infinite(t)&&e.not.nan(t)},e.infinite=function(e){return e===1/0||e===-1/0},e.integer=function(t){return e.number(t)&&t%1==0},e.negative=function(t){return e.number(t)&&t<0},e.odd=function(t){return e.number(t)&&t%2==1},e.positive=function(t){return e.number(t)&&t>0},e.under=function(t,n){return e.all.number(t,n)&&t<n},e.under.api=["not"],e.within=function(t,n,r){return e.all.number(t,n,r)&&t>n&&t<r},e.within.api=["not"];var h={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([\/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/};function p(t,n){e[t]=function(e){return n[t].test(e)}}for(var d in h)h.hasOwnProperty(d)&&p(d,h);e.ip=function(t){return e.ipv4(t)||e.ipv6(t)},e.capitalized=function(t){if(e.not.string(t))return!1;for(var n=t.split(" "),r=0;r<n.length;r++){var i=n[r];if(i.length){var s=i.charAt(0);if(s!==s.toUpperCase())return!1}}return!0},e.endWith=function(t,n){if(e.not.string(t))return!1;n+="";var r=t.length-n.length;return r>=0&&t.indexOf(n,r)===r},e.endWith.api=["not"],e.include=function(e,t){return e.indexOf(t)>-1},e.include.api=["not"],e.lowerCase=function(t){return e.string(t)&&t===t.toLowerCase()},e.palindrome=function(t){if(e.not.string(t))return!1;for(var n=(t=t.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).length-1,r=0,i=Math.floor(n/2);r<=i;r++)if(t.charAt(r)!==t.charAt(n-r))return!1;return!0},e.space=function(t){if(e.not.char(t))return!1;var n=t.charCodeAt(0);return n>8&&n<14||32===n},e.startWith=function(t,n){return e.string(t)&&0===t.indexOf(n)},e.startWith.api=["not"],e.upperCase=function(t){return e.string(t)&&t===t.toUpperCase()};var f=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];e.day=function(t,n){return e.date(t)&&n.toLowerCase()===f[t.getDay()]},e.day.api=["not"],e.dayLightSavingTime=function(e){var t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r},e.future=function(t){var n=new Date;return e.date(t)&&t.getTime()>n.getTime()},e.inDateRange=function(t,n,r){if(e.not.date(t)||e.not.date(n)||e.not.date(r))return!1;var i=t.getTime();return i>n.getTime()&&i<r.getTime()},e.inDateRange.api=["not"],e.inLastMonth=function(t){return e.inDateRange(t,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date)},e.inLastWeek=function(t){return e.inDateRange(t,new Date((new Date).setDate((new Date).getDate()-7)),new Date)},e.inLastYear=function(t){return e.inDateRange(t,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date)},e.inNextMonth=function(t){return e.inDateRange(t,new Date,new Date((new Date).setMonth((new Date).getMonth()+1)))},e.inNextWeek=function(t){return e.inDateRange(t,new Date,new Date((new Date).setDate((new Date).getDate()+7)))},e.inNextYear=function(t){return e.inDateRange(t,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1)))},e.leapYear=function(t){return e.number(t)&&(t%4==0&&t%100!=0||t%400==0)},e.month=function(t,n){return e.date(t)&&n.toLowerCase()===m[t.getMonth()]},e.month.api=["not"],e.past=function(t){var n=new Date;return e.date(t)&&t.getTime()<n.getTime()},e.quarterOfYear=function(t,n){return e.date(t)&&e.number(n)&&n===Math.floor((t.getMonth()+3)/3)},e.quarterOfYear.api=["not"],e.today=function(t){var n=(new Date).toDateString();return e.date(t)&&t.toDateString()===n},e.tomorrow=function(t){var n=new Date,r=new Date(n.setDate(n.getDate()+1)).toDateString();return e.date(t)&&t.toDateString()===r},e.weekend=function(t){return e.date(t)&&(6===t.getDay()||0===t.getDay())},e.weekday=s(e.weekend),e.year=function(t,n){return e.date(t)&&e.number(n)&&n===t.getFullYear()},e.year.api=["not"],e.yesterday=function(t){var n=new Date,r=new Date(n.setDate(n.getDate()-1)).toDateString();return e.date(t)&&t.toDateString()===r};var g=e.windowObject("object"==typeof n.g&&n.g)&&n.g,_=e.windowObject("object"==typeof self&&self)&&self,v=e.windowObject("object"==typeof this&&this)&&this,y=g||_||v||Function("return this")(),b=_&&_.document,A=y.is,w=_&&_.navigator,x=(w&&w.appVersion||"").toLowerCase(),E=(w&&w.userAgent||"").toLowerCase(),C=(w&&w.vendor||"").toLowerCase();function S(){var t=e;for(var n in t)if(i.call(t,n)&&e.function(t[n]))for(var r=t[n].api||["not","all","any"],l=0;l<r.length;l++)"not"===r[l]&&(e.not[n]=s(e[n])),"all"===r[l]&&(e.all[n]=o(e[n])),"any"===r[l]&&(e.any[n]=a(e[n]))}return e.android=function(){return/android/.test(E)},e.android.api=["not"],e.androidPhone=function(){return/android/.test(E)&&/mobile/.test(E)},e.androidPhone.api=["not"],e.androidTablet=function(){return/android/.test(E)&&!/mobile/.test(E)},e.androidTablet.api=["not"],e.blackberry=function(){return/blackberry/.test(E)||/bb10/.test(E)},e.blackberry.api=["not"],e.chrome=function(e){var t=/google inc/.test(C)?E.match(/(?:chrome|crios)\/(\d+)/):null;return null!==t&&c(t[1],e)},e.chrome.api=["not"],e.desktop=function(){return e.not.mobile()&&e.not.tablet()},e.desktop.api=["not"],e.edge=function(e){var t=E.match(/edge\/(\d+)/);return null!==t&&c(t[1],e)},e.edge.api=["not"],e.firefox=function(e){var t=E.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&c(t[1],e)},e.firefox.api=["not"],e.ie=function(e){var t=E.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&c(t[1],e)},e.ie.api=["not"],e.ios=function(){return e.iphone()||e.ipad()||e.ipod()},e.ios.api=["not"],e.ipad=function(e){var t=E.match(/ipad.+?os (\d+)/);return null!==t&&c(t[1],e)},e.ipad.api=["not"],e.iphone=function(e){var t=E.match(/iphone(?:.+?os (\d+))?/);return null!==t&&c(t[1]||1,e)},e.iphone.api=["not"],e.ipod=function(e){var t=E.match(/ipod.+?os (\d+)/);return null!==t&&c(t[1],e)},e.ipod.api=["not"],e.linux=function(){return/linux/.test(x)},e.linux.api=["not"],e.mac=function(){return/mac/.test(x)},e.mac.api=["not"],e.mobile=function(){return e.iphone()||e.ipod()||e.androidPhone()||e.blackberry()||e.windowsPhone()},e.mobile.api=["not"],e.offline=s(e.online),e.offline.api=["not"],e.online=function(){return!w||!0===w.onLine},e.online.api=["not"],e.opera=function(e){var t=E.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&c(t[1],e)},e.opera.api=["not"],e.phantom=function(e){var t=E.match(/phantomjs\/(\d+)/);return null!==t&&c(t[1],e)},e.phantom.api=["not"],e.safari=function(e){var t=E.match(/version\/(\d+).+?safari/);return null!==t&&c(t[1],e)},e.safari.api=["not"],e.tablet=function(){return e.ipad()||e.androidTablet()||e.windowsTablet()},e.tablet.api=["not"],e.touchDevice=function(){return!!b&&("ontouchstart"in _||"DocumentTouch"in _&&b instanceof DocumentTouch)},e.touchDevice.api=["not"],e.windows=function(){return/win/.test(x)},e.windows.api=["not"],e.windowsPhone=function(){return e.windows()&&/phone/.test(E)},e.windowsPhone.api=["not"],e.windowsTablet=function(){return e.windows()&&e.not.windowsPhone()&&/touch/.test(E)},e.windowsTablet.api=["not"],e.propertyCount=function(t,n){if(e.not.object(t)||e.not.number(n))return!1;var r=0;for(var s in t)if(i.call(t,s)&&++r>n)return!1;return r===n},e.propertyCount.api=["not"],e.propertyDefined=function(t,n){return e.object(t)&&e.string(n)&&n in t},e.propertyDefined.api=["not"],e.inArray=function(t,n){if(e.not.array(n))return!1;for(var r=0;r<n.length;r++)if(n[r]===t)return!0;return!1},e.inArray.api=["not"],e.sorted=function(t,n){if(e.not.array(t))return!1;for(var r=l[n]||l[">="],i=1;i<t.length;i++)if(!r(t[i],t[i-1]))return!1;return!0},S(),e.setNamespace=function(){return y.is=A,this},e.setRegexp=function(e,t){for(var n in h)i.call(h,n)&&t===n&&(h[n]=e)},e}()}.call(t,n,t,e),void 0===r||(e.exports=r)},568:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Bve:()=>__webpackgi_exports__addBasePlugins,IiN:()=>__webpackgi_exports__TonemapPlugin,kZK:()=>__webpackgi_exports__SimpleTextPlugin,ksm:()=>__webpackgi_exports__AssetManagerPlugin,oMA:()=>__webpackgi_exports__ViewerApp});var __webpackgi_modules__={109:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),t.Z=i},44:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),t.Z=i},798:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),t.Z=i},729:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),t.Z=i},898:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),t.Z=i},513:function(e,t,n){var r=n(352),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),t.Z=i},476:function(e){var t;t=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r={convertToObject:function(e){var t=e.substring(e.indexOf("{")+1).trim().slice(0,-1),n={};return t.split(";").map((function(e){if(e=e.trim()){var t=e.split(":");n[t[0].trim()]=t[1].trim()}})),n},getFromSheets:function(e){var t=document.styleSheets;for(var n in t){var i=null;try{i=t[n].rules||t[n].cssRules}catch(e){}if(i)for(var s in i)if(i[s].selectorText&&-1!=i[s].selectorText.split(",").indexOf(e))return i[s].cssText?r.convertToObject(i[s].cssText):r.convertToObject(i[s].style.cssText)}return{}},getPropertyDefault:function(e){return"timing-function"==e?"ease":"iteration-count"==e?1:"direction"==e?"normal":"fill-mode"==e?"none":null}};t.default=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r={generateId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<8;++n)e+=t.charAt(Math.floor(62*Math.random()));return e},frameToString:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},convertTimeToMs:function(e){if(!e)return 0;if("number"==typeof e)return e;var t=parseFloat(e);return-1!=e.indexOf("ms")?t:1e3*t},prefixes:["","-webkit-","-moz-","-o-"]};t.default=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(0))&&r.__esModule?r:{default:r};t.default=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.styles="string"==typeof t?i.default.getFromSheets(t):t,"string"==typeof n){var r=i.default.getFromSheets(n);for(var s in this.options={},r)this.options[s.replace("animation-","")]=r[s]}else this.options="number"==typeof n?{duration:n}:n}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(4)),s=a(n(1)),o=a(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,n,r,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.constructor===Array?this.doms=t:this.doms=[t],n.constructor===Array?this.frames=n:this.frames=[n],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},null!=r&&null!=r)if("boolean"==typeof r)this.options.instant=r;else if("number"==typeof r)this.options.count=r,"boolean"==typeof i&&(this.options.instant=i);else for(var o in r)"pauseAt"==o&&r.pauseAt.constructor!==Array?this.options[o]=[r[o]]:this.options[o]=r[o];for(var a in this.promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=s.default.prefixes:this.prefixes=[""],t)this.countRemainder[a]=this.options.count-1;this.options.instant&&this.play()}return r(e,[{key:"play",value:function(){var e=this;for(var t in this.clear(),this.promiseSupported&&(this.promise=new Promise((function(t){e.promiseResolve=t}))),this.doms){var n=this.makeAnimation(this.doms[t]);this.animations[t]=n.names,this.styleDoms[t]=n.styleDom,this.superSets[t]=this.makeSuperSet(this.doms[t],this.animations[t]),this.playAnimation(this.doms[t],this.superSets[t]),this.eventHandler[t]=this.handleAnimationEnd.bind(this,t),this.doms[t].addEventListener("animationend",this.eventHandler[t])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(e){if(!e){for(var t in this.doms)this.clear(t);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var n=this.styleDoms[e];for(var r in n&&n.parentNode&&n.parentNode.removeChild(n),this.superSets[e])for(var i in this.prefixes)this.doms[e].style[this.prefixes[i]+"animation-"+r]=null;for(var s in this.prefixes)this.doms[e].style[this.prefixes[s]+"animation-play-state"]=null;this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.countRemainder[e]=this.options.count-1}},{key:"replay",value:function(e){var t=this.doms[e],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.doms[e]=n,this.doms[e].addEventListener("animationend",this.eventHandler[e])}},{key:"pause",value:function(){for(var e in this.doms)this.pauseDom(this.doms[e])}},{key:"resume",value:function(){for(var e in this.doms)this.resumeDom(this.doms[e])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(e,t){var n=t.animationName,r=n.substring(n.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(r))&&this.pauseDom(this.doms[e]),r==this.frames.length&&(-1==this.countRemainder[e]?this.replay(e):this.countRemainder[e]>0?(this.countRemainder[e]--,this.replay(e)):(this.options.applyOnEnd&&this.applyOnEnd(e),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(e){var t=this.newFrames[this.frames.length];for(var n in t)this.doms[e].style[n]=t[n]}},{key:"makeAnimation",value:function(e){var t={},n=[],r={};for(var s in this.frames)for(var o in n.push(this.frames[s].styles),n[s])r[o]=!0;var a=window.getComputedStyle(e);for(var l in r)t[l]=a[l];n.unshift(t);for(var c=[n[0]],u=1;u<n.length;++u){var h=JSON.parse(JSON.stringify(c[u-1]));for(var p in n[u])h[p]=n[u][p];c.push(h)}return this.newFrames=c,i.default.make(c,this.prefixes)}},{key:"makeSuperSet",value:function(e,t){var n=0,r={};for(var i in this.frames)for(var a in this.frames[i].options)r[a]="";r.name="",r.duration="",r.delay="";for(var l=0;l<this.frames.length;++l){if(l)for(var c in r)r[c]+=",";var u=s.default.convertTimeToMs(this.frames[l].options.duration),h=s.default.convertTimeToMs(this.frames[l].options.delay);for(var p in l<this.options.startFrom&&(u=0,h=0),r.name+=t[l],r.duration+=u+"ms",r.delay+=n+h+"ms",r)"name"!=p&&"duration"!=p&&"delay"!=p&&(r[p]+=this.frames[l].options[p]?this.frames[l].options[p]:o.default.getPropertyDefault(p));var d=this.frames[l].options["iteration-count"];n+=u*parseInt(d||1)+h}return r}},{key:"playAnimation",value:function(e,t){for(var n in t)for(var r in this.prefixes)e.style[this.prefixes[r]+"animation-"+n]=t[n];this.options.pauseAt.includes(0)&&this.pauseDom(e)}}]),e}();t.default=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(1))&&r.__esModule?r:{default:r},s={make:function(e,t){for(var n=[],r="",o="atr-"+i.default.generateId(),a=document.createElement("style"),l=0;l<e.length-1;++l)n.push(o+"-"+(l+1)),r+=s.makeFromTwoFrames(e[l],e[l+1],n[l],t);return a.innerHTML=r,a.class="foo",document.getElementsByTagName("head")[0].appendChild(a),{names:n,styleDom:a}},makeFromTwoFrames:function(e,t,n,r){var s="";for(var o in r)s+="@"+r[o]+"keyframes "+n+" {",s+="0%",s+="{"+i.default.frameToString(e)+"}",s+="100%",s+="{"+i.default.frameToString(t)+"}",s+="}";return s}};t.default=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=t.Frame=void 0;var r=s(n(2)),i=s(n(3));function s(e){return e&&e.__esModule?e:{default:e}}t.Frame=r.default,t.Queue=i.default}])},e.exports=t()},352:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(i[o]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);r&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},388:function(e){e.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var s=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(r,i,s,o,a,l,c,u,h){var p=e("crypto");function d(e,t){return function(e,t){var n;if(void 0===(n="passthrough"!==t.algorithm?p.createHash(t.algorithm):new y).write&&(n.write=n.update,n.end=n.update),v(t,n).dispatch(e),n.update||n.end(""),n.digest)return n.digest("buffer"===t.encoding?void 0:t.encoding);var r=n.read();return"buffer"!==t.encoding?r.toString(t.encoding):r}(e,t=g(e,t))}(n=t.exports=d).sha1=function(e){return d(e)},n.keys=function(e){return d(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},n.MD5=function(e){return d(e,{algorithm:"md5",encoding:"hex"})},n.keysMD5=function(e){return d(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=p.getHashes?p.getHashes().slice():["sha1","md5"];f.push("passthrough");var m=["buffer","hex","binary","base64"];function g(e,t){t=t||{};var n={};if(n.algorithm=t.algorithm||"sha1",n.encoding=t.encoding||"hex",n.excludeValues=!!t.excludeValues,n.algorithm=n.algorithm.toLowerCase(),n.encoding=n.encoding.toLowerCase(),n.ignoreUnknown=!0===t.ignoreUnknown,n.respectType=!1!==t.respectType,n.respectFunctionNames=!1!==t.respectFunctionNames,n.respectFunctionProperties=!1!==t.respectFunctionProperties,n.unorderedArrays=!0===t.unorderedArrays,n.unorderedSets=!1!==t.unorderedSets,n.unorderedObjects=!1!==t.unorderedObjects,n.replacer=t.replacer||void 0,n.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error("Object argument required.");for(var r=0;r<f.length;++r)f[r].toLowerCase()===n.algorithm.toLowerCase()&&(n.algorithm=f[r]);if(-1===f.indexOf(n.algorithm))throw new Error('Algorithm "'+n.algorithm+'"  not supported. supported values: '+f.join(", "));if(-1===m.indexOf(n.encoding)&&"passthrough"!==n.algorithm)throw new Error('Encoding "'+n.encoding+'"  not supported. supported values: '+m.join(", "));return n}function _(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function v(e,t,n){function r(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return n=n||[],{dispatch:function(t){return e.replacer&&(t=e.replacer(t)),this["_"+(null===t?"null":typeof t)](t)},_object:function(t){var i,o=Object.prototype.toString.call(t),a=/\[object (.*)\]/i.exec(o);if(a=(a=a?a[1]:"unknown:["+o+"]").toLowerCase(),0<=(i=n.indexOf(t)))return this.dispatch("[CIRCULAR:"+i+"]");if(n.push(t),void 0!==s&&s.isBuffer&&s.isBuffer(t))return r("buffer:"),r(t);if("object"===a||"function"===a||"asyncfunction"===a){var l=Object.keys(t);e.unorderedObjects&&(l=l.sort()),!1===e.respectType||_(t)||l.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(l=l.filter((function(t){return!e.excludeKeys(t)}))),r("object:"+l.length+":");var c=this;return l.forEach((function(n){c.dispatch(n),r(":"),e.excludeValues||c.dispatch(t[n]),r(",")}))}if(!this["_"+a]){if(e.ignoreUnknown)return r("["+a+"]");throw new Error('Unknown object type "'+a+'"')}this["_"+a](t)},_array:function(t,i){i=void 0!==i?i:!1!==e.unorderedArrays;var s=this;if(r("array:"+t.length+":"),!i||t.length<=1)return t.forEach((function(e){return s.dispatch(e)}));var o=[],a=t.map((function(t){var r=new y,i=n.slice();return v(e,r,i).dispatch(t),o=o.concat(i.slice(n.length)),r.read().toString()}));return n=n.concat(o),a.sort(),this._array(a,!1)},_date:function(e){return r("date:"+e.toJSON())},_symbol:function(e){return r("symbol:"+e.toString())},_error:function(e){return r("error:"+e.toString())},_boolean:function(e){return r("bool:"+e.toString())},_string:function(e){r("string:"+e.length+":"),r(e.toString())},_function:function(t){r("fn:"),_(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return r("number:"+e.toString())},_xml:function(e){return r("xml:"+e.toString())},_null:function(){return r("Null")},_undefined:function(){return r("Undefined")},_regexp:function(e){return r("regex:"+e.toString())},_uint8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return r("url:"+e.toString())},_map:function(t){r("map:");var n=Array.from(t);return this._array(n,!1!==e.unorderedSets)},_set:function(t){r("set:");var n=Array.from(t);return this._array(n,!1!==e.unorderedSets)},_file:function(e){return r("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return r("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return r("domwindow")},_bigint:function(e){return r("bigint:"+e.toString())},_process:function(){return r("process")},_timer:function(){return r("timer")},_pipe:function(){return r("pipe")},_tcp:function(){return r("tcp")},_udp:function(){return r("udp")},_tty:function(){return r("tty")},_statwatcher:function(){return r("statwatcher")},_securecontext:function(){return r("securecontext")},_connection:function(){return r("connection")},_zlib:function(){return r("zlib")},_context:function(){return r("context")},_nodescript:function(){return r("nodescript")},_httpparser:function(){return r("httpparser")},_dataview:function(){return r("dataview")},_signal:function(){return r("signal")},_fsevent:function(){return r("fsevent")},_tlswrap:function(){return r("tlswrap")}}}function y(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}n.writeToStream=function(e,t,n){return void 0===n&&(n=t,t={}),v(t=g(e,t),n).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(e,t,n){(function(e,t,r,i,s,o,a,l,c){!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),i="0".charCodeAt(0),s="a".charCodeAt(0),o="A".charCodeAt(0),a="-".charCodeAt(0),l="_".charCodeAt(0);function c(e){var t=e.charCodeAt(0);return t===n||t===a?62:t===r||t===l?63:t<i?-1:t<i+10?t-i+26+26:t<o+26?t-o:t<s+26?t-s+26:void 0}e.toByteArray=function(e){var n,r;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.length,s="="===e.charAt(i-2)?2:"="===e.charAt(i-1)?1:0,o=new t(3*e.length/4-s),a=0<s?e.length-4:e.length,l=0;function u(e){o[l++]=e}for(n=0;n<a;n+=4,0)u((16711680&(r=c(e.charAt(n))<<18|c(e.charAt(n+1))<<12|c(e.charAt(n+2))<<6|c(e.charAt(n+3))))>>16),u((65280&r)>>8),u(255&r);return 2==s?u(255&(r=c(e.charAt(n))<<2|c(e.charAt(n+1))>>4)):1==s&&(u((r=c(e.charAt(n))<<10|c(e.charAt(n+1))<<4|c(e.charAt(n+2))>>2)>>8&255),u(255&r)),o},e.fromByteArray=function(e){var t,n,r,i,s=e.length%3,o="";function a(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,r=e.length-s;t<r;t+=3)o+=a((i=n=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+a(i>>12&63)+a(i>>6&63)+a(63&i);switch(s){case 1:o+=a((n=e[e.length-1])>>2),o+=a(n<<4&63),o+="==";break;case 2:o+=a((n=(e[e.length-2]<<8)+e[e.length-1])>>10),o+=a(n>>4&63),o+=a(n<<2&63),o+="="}return o}}(void 0===n?this.base64js={}:n)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(e,t,n){(function(t,r,i,s,o,a,l,c,u){var h=e("base64-js"),p=e("ieee754");function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);var r,s,o,a,l,c=typeof e;if("base64"===t&&"string"==c)for(e=(r=e).trim?r.trim():r.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==c)s=M(e);else if("string"==c)s=i.byteLength(e,t);else{if("object"!=c)throw new Error("First argument needs to be a number, array or string.");s=M(e.length)}if(i._useTypedArrays?o=i._augment(new Uint8Array(s)):((o=this).length=s,o._isBuffer=!0),i._useTypedArrays&&"number"==typeof e.byteLength)o._set(e);else if(T(l=e)||i.isBuffer(l)||l&&"object"==typeof l&&"number"==typeof l.length)for(a=0;a<s;a++)i.isBuffer(e)?o[a]=e.readUInt8(a):o[a]=e[a];else if("string"==c)o.write(e,0,t);else if("number"==c&&!i._useTypedArrays&&!n)for(a=0;a<s;a++)o[a]=0;return o}function d(e,t,n,r){r||(F("boolean"==typeof n,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+1<e.length,"Trying to read beyond buffer length"));var i,s=e.length;if(!(s<=t))return n?(i=e[t],t+1<s&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<s&&(i|=e[t+1])),i}function f(e,t,n,r){r||(F("boolean"==typeof n,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+3<e.length,"Trying to read beyond buffer length"));var i,s=e.length;if(!(s<=t))return n?(t+2<s&&(i=e[t+2]<<16),t+1<s&&(i|=e[t+1]<<8),i|=e[t],t+3<s&&(i+=e[t+3]<<24>>>0)):(t+1<s&&(i=e[t+1]<<16),t+2<s&&(i|=e[t+2]<<8),t+3<s&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}function m(e,t,n,r){if(r||(F("boolean"==typeof n,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var i=d(e,t,n,!0);return 32768&i?-1*(65535-i+1):i}}function g(e,t,n,r){if(r||(F("boolean"==typeof n,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var i=f(e,t,n,!0);return 2147483648&i?-1*(4294967295-i+1):i}}function _(e,t,n,r){return r||(F("boolean"==typeof n,"missing or invalid endian"),F(t+3<e.length,"Trying to read beyond buffer length")),p.read(e,t,n,23,4)}function v(e,t,n,r){return r||(F("boolean"==typeof n,"missing or invalid endian"),F(t+7<e.length,"Trying to read beyond buffer length")),p.read(e,t,n,52,8)}function y(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+1<e.length,"trying to write beyond buffer length"),k(t,65535));var s=e.length;if(!(s<=n))for(var o=0,a=Math.min(s-n,2);o<a;o++)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function b(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+3<e.length,"trying to write beyond buffer length"),k(t,4294967295));var s=e.length;if(!(s<=n))for(var o=0,a=Math.min(s-n,4);o<a;o++)e[n+o]=t>>>8*(r?o:3-o)&255}function A(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+1<e.length,"Trying to write beyond buffer length"),O(t,32767,-32768)),e.length<=n||y(e,0<=t?t:65535+t+1,n,r,i)}function w(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+3<e.length,"Trying to write beyond buffer length"),O(t,2147483647,-2147483648)),e.length<=n||b(e,0<=t?t:4294967295+t+1,n,r,i)}function x(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+3<e.length,"Trying to write beyond buffer length"),L(t,34028234663852886e22,-34028234663852886e22)),e.length<=n||p.write(e,t,n,r,23,4)}function E(e,t,n,r,i){i||(F(null!=t,"missing value"),F("boolean"==typeof r,"missing or invalid endian"),F(null!=n,"missing offset"),F(n+7<e.length,"Trying to write beyond buffer length"),L(t,17976931348623157e292,-17976931348623157e292)),e.length<=n||p.write(e,t,n,r,52,8)}n.Buffer=i,n.SlowBuffer=i,n.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(e){return!(null==e||!e._isBuffer)},i.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=I(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=P(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;default:throw new Error("Unknown encoding")}return n},i.concat=function(e,t){if(F(T(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new i(0);if(1===e.length)return e[0];if("number"!=typeof t)for(s=t=0;s<e.length;s++)t+=e[s].length;for(var n=new i(t),r=0,s=0;s<e.length;s++){var o=e[s];o.copy(n,r),r+=o.length}return n},i.prototype.write=function(e,t,n,r){var s;isFinite(t)?isFinite(n)||(r=n,n=void 0):(s=r,r=t,t=n,n=s),t=Number(t)||0;var o,a,l,c,u,h,p,d=this.length-t;switch((!n||d<(n=Number(n)))&&(n=d),r=String(r||"utf8").toLowerCase()){case"hex":o=function(e,t,n,r){n=Number(n)||0;var s=e.length-n;(!r||s<(r=Number(r)))&&(r=s);var o=t.length;F(o%2==0,"Invalid hex string"),o/2<r&&(r=o/2);for(var a=0;a<r;a++){var l=parseInt(t.substr(2*a,2),16);F(!isNaN(l),"Invalid hex string"),e[n+a]=l}return i._charsWritten=2*a,a}(this,e,t,n);break;case"utf8":case"utf-8":u=e,h=t,p=n,o=i._charsWritten=R(I(u),this,h,p);break;case"ascii":case"binary":o=function(e,t,n,r){return i._charsWritten=R(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}(this,e,t,n);break;case"base64":a=e,l=t,c=n,o=i._charsWritten=R(P(a),this,l,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=function(e,t,n,r){return i._charsWritten=R(function(e){for(var t,n,r,i=[],s=0;s<e.length;s++)n=(t=e.charCodeAt(s))>>8,r=t%256,i.push(r),i.push(n);return i}(t),e,n,r)}(this,e,t,n);break;default:throw new Error("Unknown encoding")}return o},i.prototype.toString=function(e,t,n){var r,i,s,o,a=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(n=void 0!==n?Number(n):n=a.length)===t)return"";switch(e){case"hex":r=function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",s=t;s<n;s++)i+=D(e[s]);return i}(a,t,n);break;case"utf8":case"utf-8":r=function(e,t,n){var r="",i="";n=Math.min(e.length,n);for(var s=t;s<n;s++)e[s]<=127?(r+=B(i)+String.fromCharCode(e[s]),i=""):i+="%"+e[s].toString(16);return r+B(i)}(a,t,n);break;case"ascii":case"binary":r=function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}(a,t,n);break;case"base64":i=a,o=n,r=0===(s=t)&&o===i.length?h.fromByteArray(i):h.fromByteArray(i.slice(s,o));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=function(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}(a,t,n);break;default:throw new Error("Unknown encoding")}return r},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(e,t,n,r){if(n=n||0,r||0===r||(r=this.length),t=t||0,r!==n&&0!==e.length&&0!==this.length){F(n<=r,"sourceEnd < sourceStart"),F(0<=t&&t<e.length,"targetStart out of bounds"),F(0<=n&&n<this.length,"sourceStart out of bounds"),F(0<=r&&r<=this.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var s=r-n;if(s<100||!i._useTypedArrays)for(var o=0;o<s;o++)e[o+t]=this[o+n];else e._set(this.subarray(n,n+s),t)}},i.prototype.slice=function(e,t){var n=this.length;if(e=S(e,n,0),t=S(t,n,n),i._useTypedArrays)return i._augment(this.subarray(e,t));for(var r=t-e,s=new i(r,void 0,!0),o=0;o<r;o++)s[o]=this[o+e];return s},i.prototype.get=function(e){return this.readUInt8(e)},i.prototype.set=function(e,t){return this.writeUInt8(e,t)},i.prototype.readUInt8=function(e,t){if(t||(F(null!=e,"missing offset"),F(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},i.prototype.readUInt16LE=function(e,t){return d(this,e,!0,t)},i.prototype.readUInt16BE=function(e,t){return d(this,e,!1,t)},i.prototype.readUInt32LE=function(e,t){return f(this,e,!0,t)},i.prototype.readUInt32BE=function(e,t){return f(this,e,!1,t)},i.prototype.readInt8=function(e,t){if(t||(F(null!=e,"missing offset"),F(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){return m(this,e,!0,t)},i.prototype.readInt16BE=function(e,t){return m(this,e,!1,t)},i.prototype.readInt32LE=function(e,t){return g(this,e,!0,t)},i.prototype.readInt32BE=function(e,t){return g(this,e,!1,t)},i.prototype.readFloatLE=function(e,t){return _(this,e,!0,t)},i.prototype.readFloatBE=function(e,t){return _(this,e,!1,t)},i.prototype.readDoubleLE=function(e,t){return v(this,e,!0,t)},i.prototype.readDoubleBE=function(e,t){return v(this,e,!1,t)},i.prototype.writeUInt8=function(e,t,n){n||(F(null!=e,"missing value"),F(null!=t,"missing offset"),F(t<this.length,"trying to write beyond buffer length"),k(e,255)),t>=this.length||(this[t]=e)},i.prototype.writeUInt16LE=function(e,t,n){y(this,e,t,!0,n)},i.prototype.writeUInt16BE=function(e,t,n){y(this,e,t,!1,n)},i.prototype.writeUInt32LE=function(e,t,n){b(this,e,t,!0,n)},i.prototype.writeUInt32BE=function(e,t,n){b(this,e,t,!1,n)},i.prototype.writeInt8=function(e,t,n){n||(F(null!=e,"missing value"),F(null!=t,"missing offset"),F(t<this.length,"Trying to write beyond buffer length"),O(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},i.prototype.writeInt16LE=function(e,t,n){A(this,e,t,!0,n)},i.prototype.writeInt16BE=function(e,t,n){A(this,e,t,!1,n)},i.prototype.writeInt32LE=function(e,t,n){w(this,e,t,!0,n)},i.prototype.writeInt32BE=function(e,t,n){w(this,e,t,!1,n)},i.prototype.writeFloatLE=function(e,t,n){x(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){x(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){E(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){E(this,e,t,!1,n)},i.prototype.fill=function(e,t,n){if(e=e||0,t=t||0,n=n||this.length,"string"==typeof e&&(e=e.charCodeAt(0)),F("number"==typeof e&&!isNaN(e),"value is not a number"),F(t<=n,"end < start"),n!==t&&0!==this.length){F(0<=t&&t<this.length,"start out of bounds"),F(0<=n&&n<=this.length,"end out of bounds");for(var r=t;r<n;r++)this[r]=e}},i.prototype.inspect=function(){for(var e=[],t=this.length,r=0;r<t;r++)if(e[r]=D(this[r]),r===n.INSPECT_MAX_BYTES){e[r+1]="...";break}return"<Buffer "+e.join(" ")+">"},i.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new Error("Buffer.toArrayBuffer not supported in this browser");if(i._useTypedArrays)return new i(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer};var C=i.prototype;function S(e,t,n){return"number"!=typeof e?n:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function M(e){return(e=~~Math.ceil(+e))<0?0:e}function T(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function D(e){return e<16?"0"+e.toString(16):e.toString(16)}function I(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else{var i=n;55296<=r&&r<=57343&&n++;for(var s=encodeURIComponent(e.slice(i,n+1)).substr(1).split("%"),o=0;o<s.length;o++)t.push(parseInt(s[o],16))}}return t}function P(e){return h.toByteArray(e)}function R(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}function B(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function k(e,t){F("number"==typeof e,"cannot write a non-number as a number"),F(0<=e,"specified a negative value for writing an unsigned value"),F(e<=t,"value is larger than maximum value for type"),F(Math.floor(e)===e,"value has a fractional component")}function O(e,t,n){F("number"==typeof e,"cannot write a non-number as a number"),F(e<=t,"value larger than maximum allowed value"),F(n<=e,"value smaller than minimum allowed value"),F(Math.floor(e)===e,"value has a fractional component")}function L(e,t,n){F("number"==typeof e,"cannot write a non-number as a number"),F(e<=t,"value larger than maximum allowed value"),F(n<=e,"value smaller than minimum allowed value")}function F(e,t){if(!e)throw new Error(t||"Failed assertion")}i._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=C.get,e.set=C.set,e.write=C.write,e.toString=C.toString,e.toLocaleString=C.toString,e.toJSON=C.toJSON,e.copy=C.copy,e.slice=C.slice,e.readUInt8=C.readUInt8,e.readUInt16LE=C.readUInt16LE,e.readUInt16BE=C.readUInt16BE,e.readUInt32LE=C.readUInt32LE,e.readUInt32BE=C.readUInt32BE,e.readInt8=C.readInt8,e.readInt16LE=C.readInt16LE,e.readInt16BE=C.readInt16BE,e.readInt32LE=C.readInt32LE,e.readInt32BE=C.readInt32BE,e.readFloatLE=C.readFloatLE,e.readFloatBE=C.readFloatBE,e.readDoubleLE=C.readDoubleLE,e.readDoubleBE=C.readDoubleBE,e.writeUInt8=C.writeUInt8,e.writeUInt16LE=C.writeUInt16LE,e.writeUInt16BE=C.writeUInt16BE,e.writeUInt32LE=C.writeUInt32LE,e.writeUInt32BE=C.writeUInt32BE,e.writeInt8=C.writeInt8,e.writeInt16LE=C.writeInt16LE,e.writeInt16BE=C.writeInt16BE,e.writeInt32LE=C.writeInt32LE,e.writeInt32BE=C.writeInt32BE,e.writeFloatLE=C.writeFloatLE,e.writeFloatBE=C.writeFloatBE,e.writeDoubleLE=C.writeDoubleLE,e.writeDoubleBE=C.writeDoubleBE,e.fill=C.fill,e.inspect=C.inspect,e.toArrayBuffer=C.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){var h=new(i=e("buffer").Buffer)(4);h.fill(0),t.exports={hash:function(e,t,n,r){return i.isBuffer(e)||(e=new i(e)),function(e,t,n){for(var r=new i(t),s=n?r.writeInt32BE:r.writeInt32LE,o=0;o<e.length;o++)s.call(r,e[o],4*o,!0);return r}(t(function(e,t){var n;e.length%4!=0&&(n=e.length+(4-e.length%4),e=i.concat([e,h],n));for(var r=[],s=t?e.readInt32BE:e.readInt32LE,o=0;o<e.length;o+=4)r.push(s.call(e,o));return r}(e,r),8*e.length),n,r)}}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(e,t,n){(function(t,r,i,s,o,a,l,c,u){i=e("buffer").Buffer;var h=e("./sha"),p=e("./sha256"),d=e("./rng"),f={sha1:h,sha256:p,md5:e("./md5")},m=64,g=new i(m);function _(e,t){var n=f[e=e||"sha1"],r=[];return n||v("algorithm:",e,"is not yet supported"),{update:function(e){return i.isBuffer(e)||(e=new i(e)),r.push(e),e.length,this},digest:function(e){var s=i.concat(r),o=t?function(e,t,n){i.isBuffer(t)||(t=new i(t)),i.isBuffer(n)||(n=new i(n)),t.length>m?t=e(t):t.length<m&&(t=i.concat([t,g],m));for(var r=new i(m),s=new i(m),o=0;o<m;o++)r[o]=54^t[o],s[o]=92^t[o];var a=e(i.concat([r,n]));return e(i.concat([s,a]))}(n,t,s):n(s);return r=null,e?o.toString(e):o}}}function v(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}g.fill(0),n.createHash=function(e){return _(e)},n.createHmac=_,n.randomBytes=function(e,t){if(!t||!t.call)return new i(d(e));try{t.call(this,void 0,new i(d(e)))}catch(e){t(e)}},function(e,t){for(var n in e)t(e[n])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],(function(e){n[e]=function(){v("sorry,",e,"is not implemented yet")}}))}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){var h=e("./helpers");function p(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=n,l=r,c=i,u=s;n=f(n,r,i,s,e[o+0],7,-680876936),s=f(s,n,r,i,e[o+1],12,-389564586),i=f(i,s,n,r,e[o+2],17,606105819),r=f(r,i,s,n,e[o+3],22,-1044525330),n=f(n,r,i,s,e[o+4],7,-176418897),s=f(s,n,r,i,e[o+5],12,1200080426),i=f(i,s,n,r,e[o+6],17,-1473231341),r=f(r,i,s,n,e[o+7],22,-45705983),n=f(n,r,i,s,e[o+8],7,1770035416),s=f(s,n,r,i,e[o+9],12,-1958414417),i=f(i,s,n,r,e[o+10],17,-42063),r=f(r,i,s,n,e[o+11],22,-1990404162),n=f(n,r,i,s,e[o+12],7,1804603682),s=f(s,n,r,i,e[o+13],12,-40341101),i=f(i,s,n,r,e[o+14],17,-1502002290),n=m(n,r=f(r,i,s,n,e[o+15],22,1236535329),i,s,e[o+1],5,-165796510),s=m(s,n,r,i,e[o+6],9,-1069501632),i=m(i,s,n,r,e[o+11],14,643717713),r=m(r,i,s,n,e[o+0],20,-373897302),n=m(n,r,i,s,e[o+5],5,-701558691),s=m(s,n,r,i,e[o+10],9,38016083),i=m(i,s,n,r,e[o+15],14,-660478335),r=m(r,i,s,n,e[o+4],20,-405537848),n=m(n,r,i,s,e[o+9],5,568446438),s=m(s,n,r,i,e[o+14],9,-1019803690),i=m(i,s,n,r,e[o+3],14,-187363961),r=m(r,i,s,n,e[o+8],20,1163531501),n=m(n,r,i,s,e[o+13],5,-1444681467),s=m(s,n,r,i,e[o+2],9,-51403784),i=m(i,s,n,r,e[o+7],14,1735328473),n=g(n,r=m(r,i,s,n,e[o+12],20,-1926607734),i,s,e[o+5],4,-378558),s=g(s,n,r,i,e[o+8],11,-2022574463),i=g(i,s,n,r,e[o+11],16,1839030562),r=g(r,i,s,n,e[o+14],23,-35309556),n=g(n,r,i,s,e[o+1],4,-1530992060),s=g(s,n,r,i,e[o+4],11,1272893353),i=g(i,s,n,r,e[o+7],16,-155497632),r=g(r,i,s,n,e[o+10],23,-1094730640),n=g(n,r,i,s,e[o+13],4,681279174),s=g(s,n,r,i,e[o+0],11,-358537222),i=g(i,s,n,r,e[o+3],16,-722521979),r=g(r,i,s,n,e[o+6],23,76029189),n=g(n,r,i,s,e[o+9],4,-640364487),s=g(s,n,r,i,e[o+12],11,-421815835),i=g(i,s,n,r,e[o+15],16,530742520),n=_(n,r=g(r,i,s,n,e[o+2],23,-995338651),i,s,e[o+0],6,-198630844),s=_(s,n,r,i,e[o+7],10,1126891415),i=_(i,s,n,r,e[o+14],15,-1416354905),r=_(r,i,s,n,e[o+5],21,-57434055),n=_(n,r,i,s,e[o+12],6,1700485571),s=_(s,n,r,i,e[o+3],10,-1894986606),i=_(i,s,n,r,e[o+10],15,-1051523),r=_(r,i,s,n,e[o+1],21,-2054922799),n=_(n,r,i,s,e[o+8],6,1873313359),s=_(s,n,r,i,e[o+15],10,-30611744),i=_(i,s,n,r,e[o+6],15,-1560198380),r=_(r,i,s,n,e[o+13],21,1309151649),n=_(n,r,i,s,e[o+4],6,-145523070),s=_(s,n,r,i,e[o+11],10,-1120210379),i=_(i,s,n,r,e[o+2],15,718787259),r=_(r,i,s,n,e[o+9],21,-343485551),n=v(n,a),r=v(r,l),i=v(i,c),s=v(s,u)}return Array(n,r,i,s)}function d(e,t,n,r,i,s){return v((o=v(v(t,e),v(r,s)))<<(a=i)|o>>>32-a,n);var o,a}function f(e,t,n,r,i,s,o){return d(t&n|~t&r,e,t,i,s,o)}function m(e,t,n,r,i,s,o){return d(t&r|n&~r,e,t,i,s,o)}function g(e,t,n,r,i,s,o){return d(t^n^r,e,t,i,s,o)}function _(e,t,n,r,i,s,o){return d(n^(t|~r),e,t,i,s,o)}function v(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}t.exports=function(e){return h.hash(e,p,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(e,t,n){(function(e,n,r,i,s,o,a,l,c){var u;u=function(e){for(var t,n=new Array(e),r=0;r<e;r++)0==(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n},t.exports=u}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){var h=e("./helpers");function p(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n,r,i,s,o,a=Array(80),l=1732584193,c=-271733879,u=-1732584194,h=271733878,p=-1009589776,m=0;m<e.length;m+=16){for(var g=l,_=c,v=u,y=h,b=p,A=0;A<80;A++){a[A]=A<16?e[m+A]:f(a[A-3]^a[A-8]^a[A-14]^a[A-16],1);var w=d(d(f(l,5),(i=c,s=u,o=h,(r=A)<20?i&s|~i&o:!(r<40)&&r<60?i&s|i&o|s&o:i^s^o)),d(d(p,a[A]),(n=A)<20?1518500249:n<40?1859775393:n<60?-1894007588:-899497514));p=h,h=u,u=f(c,30),c=l,l=w}l=d(l,g),c=d(c,_),u=d(u,v),h=d(h,y),p=d(p,b)}return Array(l,c,u,h,p)}function d(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t){return e<<t|e>>>32-t}t.exports=function(e){return h.hash(e,p,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(e,t,n){(function(n,r,i,s,o,a,l,c,u){function h(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function p(e,t){return e>>>t|e<<32-t}function d(e,t){var n,r,i,s,o,a,l,c,u,d,f=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),m=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),g=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var _,v,y,b,A,w,x,E,C=0;C<e.length;C+=16){n=m[0],r=m[1],i=m[2],s=m[3],o=m[4],a=m[5],l=m[6],c=m[7];for(var S=0;S<64;S++)g[S]=S<16?e[S+C]:h(h(h(p(E=g[S-2],17)^p(E,19)^E>>>10,g[S-7]),p(x=g[S-15],7)^p(x,18)^x>>>3),g[S-16]),u=h(h(h(h(c,p(w=o,6)^p(w,11)^p(w,25)),(A=o)&a^~A&l),f[S]),g[S]),d=h(p(b=n,2)^p(b,13)^p(b,22),(_=n)&(v=r)^_&(y=i)^v&y),c=l,l=a,a=o,o=h(s,u),s=i,i=r,r=n,n=h(u,d);m[0]=h(n,m[0]),m[1]=h(r,m[1]),m[2]=h(i,m[2]),m[3]=h(s,m[3]),m[4]=h(o,m[4]),m[5]=h(a,m[5]),m[6]=h(l,m[6]),m[7]=h(c,m[7])}return m}var f=e("./helpers");t.exports=function(e){return f.hash(e,d,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(e,t,n){(function(e,n,r,i,s,o,a,l,c){function u(){}(e=t.exports={}).nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<n.length&&n.shift()())}),!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=u,e.addListener=u,e.once=u,e.off=u,e.removeListener=u,e.removeAllListeners=u,e.emit=u,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(e,t,n){(function(e,t,r,i,s,o,a,l,c){n.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,p=n?-1:1,d=e[t+h];for(h+=p,s=d&(1<<-u)-1,d>>=-u,u+=a;0<u;s=256*s+e[t+h],h+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;0<u;o=256*o+e[t+h],h+=p,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=c}return(d?-1:1)*o*Math.pow(2,s-r)},n.write=function(e,t,n,r,i,s){var o,a,l,c=8*s-i-1,u=(1<<c)-1,h=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),2<=(t+=1<=o+h?p/l:p*Math.pow(2,1-h))*l&&(o++,l/=2),u<=o+h?(a=0,o=u):1<=o+h?(a=(t*l-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));8<=i;e[n+d]=255&a,d+=f,a/=256,i-=8);for(o=o<<i|a,c+=i;0<c;e[n+d]=255&o,d+=f,o/=256,c-=8);e[n+d-f]|=128*m}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(e){var t=function(){function e(e){return l(e,c(a(u(e.length),e),1/e.length))}function t(e){return a(h(e),e)}function n(e,t){return c(e,t?1/(e.length-1):1/e.length)}function r(e){var t=function(e){var t,n=Math.pow(2,-52),r=1e-64/n,i=0,s=0,o=0,a=0,l=0,c=p(e),u=c.length,h=c[0].length;if(u<h)throw"Need more rows than columns";var d=new Array(h),f=new Array(h);for(s=0;s<h;s++)d[s]=f[s]=0;var m=function e(t,n,r){void 0===r&&(r=0);var i,s=t[r],o=Array(s);if(r===t.length-1){for(i=s-2;i>=0;i-=2)o[i+1]=n,o[i]=n;return-1===i&&(o[0]=n),o}for(i=s-1;i>=0;i--)o[i]=e(t,n,r+1);return o}([h,h],0);function g(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var _=0,v=0,y=0,b=0,A=0,w=0,x=0;for(s=0;s<h;s++){for(d[s]=v,x=0,l=s+1,o=s;o<u;o++)x+=c[o][s]*c[o][s];if(x<=r)v=0;else for(_=c[s][s],v=Math.sqrt(x),_>=0&&(v=-v),y=_*v-x,c[s][s]=_-v,o=l;o<h;o++){for(x=0,a=s;a<u;a++)x+=c[a][s]*c[a][o];for(_=x/y,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(f[s]=v,x=0,o=l;o<h;o++)x+=c[s][o]*c[s][o];if(x<=r)v=0;else{for(_=c[s][s+1],v=Math.sqrt(x),_>=0&&(v=-v),y=_*v-x,c[s][s+1]=_-v,o=l;o<h;o++)d[o]=c[s][o]/y;for(o=l;o<u;o++){for(x=0,a=l;a<h;a++)x+=c[o][a]*c[s][a];for(a=l;a<h;a++)c[o][a]+=x*d[a]}}(A=Math.abs(f[s])+Math.abs(d[s]))>b&&(b=A)}for(s=h-1;-1!=s;s+=-1){if(0!=v){for(y=v*c[s][s+1],o=l;o<h;o++)m[o][s]=c[s][o]/y;for(o=l;o<h;o++){for(x=0,a=l;a<h;a++)x+=c[s][a]*m[a][o];for(a=l;a<h;a++)m[a][o]+=x*m[a][s]}}for(o=l;o<h;o++)m[s][o]=0,m[o][s]=0;m[s][s]=1,v=d[s],l=s}for(s=h-1;-1!=s;s+=-1){for(l=s+1,v=f[s],o=l;o<h;o++)c[s][o]=0;if(0!=v){for(y=c[s][s]*v,o=l;o<h;o++){for(x=0,a=l;a<u;a++)x+=c[a][s]*c[a][o];for(_=x/y,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(o=s;o<u;o++)c[o][s]=c[o][s]/v}else for(o=s;o<u;o++)c[o][s]=0;c[s][s]+=1}for(n*=b,a=h-1;-1!=a;a+=-1)for(var E=0;E<50;E++){var C=!1;for(l=a;-1!=l;l+=-1){if(Math.abs(d[l])<=n){C=!0;break}if(Math.abs(f[l-1])<=n)break}if(!C){i=0,x=1;var S=l-1;for(s=l;s<a+1&&(_=x*d[s],d[s]=i*d[s],!(Math.abs(_)<=n));s++)for(y=g(_,v=f[s]),f[s]=y,i=v/y,x=-_/y,o=0;o<u;o++)A=c[o][S],w=c[o][s],c[o][S]=A*i+w*x,c[o][s]=-A*x+w*i}if(w=f[a],l==a){if(w<0)for(f[a]=-w,o=0;o<h;o++)m[o][a]=-m[o][a];break}if(E>=49)throw"Error: no convergence.";for(b=f[l],v=g(_=(((A=f[a-1])-w)*(A+w)+((v=d[a-1])-(y=d[a]))*(v+y))/(2*y*A),1),_=_<0?((b-w)*(b+w)+y*(A/(_-v)-y))/b:((b-w)*(b+w)+y*(A/(_+v)-y))/b,i=1,x=1,s=l+1;s<a+1;s++){for(v=d[s],A=f[s],y=x*v,v*=i,w=g(_,y),d[s-1]=w,_=b*(i=_/w)+v*(x=y/w),v=-b*x+v*i,y=A*x,A*=i,o=0;o<h;o++)b=m[o][s-1],w=m[o][s],m[o][s-1]=b*i+w*x,m[o][s]=-b*x+w*i;for(w=g(_,y),f[s-1]=w,_=(i=_/w)*v+(x=y/w)*A,b=-x*v+i*A,o=0;o<u;o++)A=c[o][s-1],w=c[o][s],c[o][s-1]=A*i+w*x,c[o][s]=-A*x+w*i}d[l]=0,d[a]=_,f[a]=b}for(s=0;s<f.length;s++)f[s]<n&&(f[s]=0);for(s=0;s<h;s++)for(o=s-1;o>=0;o--)if(f[o]<f[s]){for(i=f[o],f[o]=f[s],f[s]=i,a=0;a<c.length;a++)t=c[a][s],c[a][s]=c[a][o],c[a][o]=t;for(a=0;a<m.length;a++)t=m[a][s],m[a][s]=m[a][o],m[a][o]=t;s=o}return{U:c,S:f,V:m}}(e),n=t.U;return t.S.map((function(e,t){var r={};return r.eigenvalue=e,r.vector=n.map((function(e,n){return-1*e[t]})),r}))}function i(t,...n){var r=n.map((function(e){return e.vector})),i=a(r,h(e(t))),s=c(a(u(t.length),t),-1/t.length);return{adjustedData:i,formattedAdjustedData:o(i,2),avgData:s,selectedVectors:r}}function s(i){return r(n(t(e(i)),!1))}function o(e,t){var n=Math.pow(10,t||2);return e.map((function(e,t){return e.map((function(e){return Math.round(e*n)/n}))}))}function a(e,t){if(!(e[0]&&t[0]&&e.length&&t.length))throw new Error("Both A and B should be matrices");if(t.length!==e[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t[0].length;i++)for(var s=0;s<e[0].length;s++)n[r][i]=n[r][i]?n[r][i]+e[r][s]*t[s][i]:e[r][s]*t[s][i]}return n}function l(e,t){if(e.length!==t.length||e[0].length!==t[0].length)throw new Error("Both A and B should have the same dimensions");for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t[0].length;i++)n[r][i]=e[r][i]-t[r][i]}return n}function c(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=[];for(var i=0;i<e[0].length;i++)n[r][i]=e[r][i]*t}return n}function u(e){for(var t=[],n=0;n<e;n++){t[n]=[];for(var r=0;r<e;r++)t[n][r]=1}return t}function h(e){return p(e)[0].map((function(t,n){return e.map((function(e){return e[n]}))}))}function p(e){var t=JSON.stringify(e);return JSON.parse(t)}return{computeDeviationScores:t,computeDeviationMatrix:e,computeSVD:r,computePercentageExplained:function(e,...t){var n=e.map((function(e){return e.eigenvalue})).reduce((function(e,t){return e+t}));return t.map((function(e){return e.eigenvalue})).reduce((function(e,t){return e+t}))/n},computeOriginalData:function(e,t,n){var r=l(h(a(h(t),e)),n);return{originalData:r,formattedOriginalData:o(r,2)}},computeVarianceCovariance:n,computeAdjustedData:i,getEigenVectors:s,analyseTopResult:function(e){var t=s(e).sort((function(e,t){return t.eigenvalue-e.eigenvalue}));return i(e,t[0].vector)},transpose:h,multiply:a,clone:p,scale:c}}();e.exports=t},701:function(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=r.base?l[0]+r.base:l[0],u=s[c]||0,h="".concat(c," ").concat(u);s[c]=u+1;var p=n(h),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(d);else{var f=i(d,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=r(e,i),c=0;c<s.length;c++){var u=n(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},182:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},850:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},236:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/",r+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),r+="/"),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},213:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1:function(e){self,e.exports=function(){var e={820:function(e,t,n){var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,".treejs {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.treejs *:after,\n.treejs *:before {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.treejs > .treejs-node {\n  padding-left: 0;\n}\n.treejs .treejs-nodes {\n  list-style: none;\n  padding-left: 18px;\n  margin: 0;\n  overflow: hidden;\n  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;\n  -o-transition: height 150ms ease-out, opacity 150ms ease-out;\n  transition: height 150ms ease-out, opacity 150ms ease-out;\n}\n.treejs .treejs-node {\n  cursor: pointer;\n  overflow: hidden;\n}\n.treejs .treejs-node.treejs-placeholder {\n  padding-left: 18px;\n}\n.treejs .treejs-switcher {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n  -webkit-transition: -webkit-transform 150ms ease-out;\n  transition: -webkit-transform 150ms ease-out;\n  -o-transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;\n}\n.treejs .treejs-switcher:before {\n  position: absolute;\n  top: 8px;\n  left: 6px;\n  display: block;\n  content: ' ';\n  border: 4px solid transparent;\n  border-top: 4px solid rgba(245, 245, 245, 0.7);\n  -webkit-transition: border-color 150ms;\n  -o-transition: border-color 150ms;\n  transition: border-color 150ms;\n}\n.treejs .treejs-switcher:hover:before {\n  border-top: 4px solid rgba(245, 245, 245, 0.96);\n}\n.treejs .treejs-node__close > .treejs-switcher {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n}\n.treejs .treejs-node__close > .treejs-nodes {\n  height: 0;\n}\n.treejs .treejs-checkbox {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n}\n.treejs .treejs-checkbox:before {\n  -webkit-transition: all 0.3s;\n  -o-transition: all 0.3s;\n  transition: all 0.3s;\n  cursor: pointer;\n  position: absolute;\n  top: 2px;\n  content: ' ';\n  display: block;\n  width: 16px;\n  height: 16px;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n}\n.treejs .treejs-checkbox:hover:before {\n  -webkit-box-shadow: 0 0 2px 1px #1890ff;\n          box-shadow: 0 0 2px 1px #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 4px;\n  left: 5px;\n  width: 5px;\n  height: 9px;\n  border: 2px solid #fff;\n  border-top: none;\n  border-left: none;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 9px;\n  left: 3px;\n  width: 10px;\n  height: 2px;\n  background-color: #fff;\n}\n.treejs .treejs-node__disabled {\n  cursor: not-allowed;\n  color: rgba(255, 255, 255, 0.25);\n}\n.treejs .treejs-node__disabled .treejs-checkbox {\n  cursor: not-allowed;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:before {\n  cursor: not-allowed;\n  border-color: #d9d9d9 !important;\n  background-color: #f5f5f5 !important;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:hover:before {\n  -webkit-box-shadow: none !important;\n          box-shadow: none !important;\n}\n.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-label {\n  vertical-align: middle;\n}\n","",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:["@color-disable: #d4d4d4;\n@bgcolor-disable: #f5f5f5;\n@greyborder: #d9d9d9;\n@bluebg: #1890ff;\n\n.treejs {\n  box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  user-select: none;\n\n  *:after,\n  *:before {\n    box-sizing: border-box;\n  }\n\n  & > .treejs-node {\n    padding-left: 0;\n  }\n\n  .treejs-nodes {\n    list-style: none;\n    padding-left: 18px;\n    margin: 0; //  for default ul...\n    overflow: hidden;\n    transition: height 150ms ease-out, opacity 150ms ease-out;\n  }\n\n  .treejs-node {\n    cursor: pointer;\n    overflow: hidden;\n\n    &.treejs-placeholder {\n      padding-left: 18px;\n    }\n  }\n\n  .treejs-switcher {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n    transition: transform 150ms ease-out;\n\n    &:before {\n      position: absolute;\n      top: 8px;\n      left: 6px;\n      display: block;\n      content: ' ';\n      border: 4px solid transparent;\n      border-top: 4px solid rgba(245, 245, 245, 0.7);\n      transition: border-color 150ms;\n    }\n    &:hover:before {\n      border-top: 4px solid rgba(245, 245, 245, 0.96);\n    }\n  }\n  .treejs-node__close > .treejs-switcher {\n    transform: rotate(-90deg);\n  }\n  .treejs-node__close > .treejs-nodes {\n    height: 0;\n  }\n\n  .treejs-checkbox {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n\n    &:before {\n      transition: all 0.3s;\n      cursor: pointer;\n      position: absolute;\n      top: 2px;\n      content: ' ';\n      display: block;\n      width: 16px;\n      height: 16px;\n      border: 1px solid @greyborder;\n      border-radius: 2px;\n    }\n    &:hover:before {\n      box-shadow: 0 0 2px 1px @bluebg;\n    }\n  }\n  .treejs-node__checked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 4px;\n        left: 5px;\n        width: 5px;\n        height: 9px;\n        border: 2px solid #fff;\n        border-top: none;\n        border-left: none;\n        transform: rotate(45deg);\n      }\n    }\n  }\n  .treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 9px;\n        left: 3px;\n        width: 10px;\n        height: 2px;\n        background-color: #fff;\n      }\n    }\n  }\n\n  .treejs-node__disabled {\n    cursor: not-allowed;\n    color: rgba(255, 255, 255, 0.25);\n    .treejs-checkbox {\n      cursor: not-allowed;\n      &:before {\n        cursor: not-allowed;\n        border-color: @greyborder !important;\n        background-color: @bgcolor-disable !important;\n      }\n      &:hover:before {\n        box-shadow: none !important;\n      }\n    }\n    .treejs-node__checked {\n      & > .treejs-checkbox {\n        &:after {\n          border-color: @greyborder;\n        }\n      }\n    }\n    .treejs-node__halfchecked {\n      & > .treejs-checkbox {\n        &:after {\n          background-color: @greyborder;\n        }\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__checked {\n    & > .treejs-checkbox {\n      &:after {\n        border-color: @greyborder;\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:after {\n        background-color: @greyborder;\n      }\n    }\n  }\n\n  .treejs-label {\n    vertical-align: middle;\n  }\n}\n"],sourceRoot:""}]),t.Z=o},645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),t.push(u))}},t}},537:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),s="/*# ".concat(i," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([s]).join("\n")}return[t].join("\n")}},379:function(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=r.base?l[0]+r.base:l[0],u=s[c]||0,h="".concat(c," ").concat(u);s[c]=u+1;var p=n(h),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(d);else{var f=i(d,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=r(e,i),c=0;c<s.length;c++){var u=n(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},636:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/",r+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),r+="/"),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nc=void 0;var r={};return function(){n.d(r,{default:function(){return T}});var e=n(379),t=n.n(e),i=n(795),s=n.n(i),o=n(636),a=n.n(o),l=n(216),c=n.n(l),u=n(589),h=n.n(u),p=n(820),d={};p.Z&&p.Z.locals&&(d.locals=p.Z.locals);var f,m=0,g={};g.styleTagTransform=h(),g.setAttributes=a(),g.insert=function(e,t){(t.target||document.head).appendChild(e)},g.domAPI=s(),g.insertStyleElement=c(),d.use=function(e){return g.options=e||{},m++||(f=t()(p.Z,g)),d},d.unuse=function(){m>0&&! --m&&(f(),f=null)};var _=d;function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,s=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){var t={};return e.reduce((function(e,n){return t[n]||(t[n]=!0,e.push(n)),e}),[])}function C(e,t){requestAnimationFrame((function(){t.enter(),requestAnimationFrame((function(){t.active(),setTimeout((function(){t.leave()}),e)}))}))}function S(e,t){try{var n=e.liElementsById[t.parent.id];n.classList.contains("treejs-node__close")||n.getElementsByClassName("treejs-switcher")[0].click()}catch(e){return}Object.prototype.hasOwnProperty.call(t,"parent")&&S(e,t.parent)}function M(e,t){var n=e.liElementsById[t.id];n.classList.contains("treejs-node__close")&&n.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(t,"children")&&t.children.forEach((function(t){return M(e,t)}))}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_.use({target:"string"==typeof this.container?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=t,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},n),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(e){this.setValues(E(e))}},disables:{get:function(){return this.getDisables()},set:function(e){this.setDisables(E(e))}},selectedNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&(1===t[n].status||2===t[n].status)){var r=A({},t[n]);delete r.parent,delete r.children,e.push(r)}})),e}},disabledNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&t[n].disabled){var r=A({},t[n]);delete r.parent,e.push(r)}})),e}}}),this.init(this.options.data)}var t,n,r;return t=e,r=[{key:"onSwitcherClick",value:function(e){var t=e.parentNode,n=t.lastChild,r=n.scrollHeight;t.classList.contains("treejs-node__close")?C(150,{enter:function(){n.style.height=0,n.style.opacity=0},active:function(){n.style.height="".concat(r,"px"),n.style.opacity=1},leave:function(){n.style.height="",n.style.opacity="",t.classList.remove("treejs-node__close")}}):C(150,{enter:function(){n.style.height="".concat(r,"px"),n.style.opacity=1},active:function(){n.style.height=0,n.style.opacity=0},leave:function(){n.style.height="",n.style.opacity="",t.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(e){var t,n=(t=e,JSON.parse(JSON.stringify(t))),r={},i={},s=[],o=[];return function e(t,n){t.forEach((function(t){r[t.id]=t,t.checked&&s.push(t.id),t.disabled&&o.push(t.id),n&&(t.parent=n),t.children&&t.children.length?e(t.children,t):i[t.id]=t}))}(n),{treeNodes:n,nodesById:r,leafNodesById:i,defaultValues:s,defaultDisables:o}}},{key:"createRootEle",value:function(){var e=document.createElement("div");return e.classList.add("treejs"),e}},{key:"createUlEle",value:function(){var e=document.createElement("ul");return e.classList.add("treejs-nodes"),e}},{key:"createLiEle",value:function(e,t){var n=document.createElement("li");if(n.classList.add("treejs-node"),t&&n.classList.add("treejs-node__close"),e.children&&e.children.length){var r=document.createElement("span");r.classList.add("treejs-switcher"),n.appendChild(r)}else n.classList.add("treejs-placeholder");var i=document.createElement("span");i.classList.add("treejs-checkbox"),n.appendChild(i);var s=document.createElement("span");s.classList.add("treejs-label");var o=document.createTextNode(e.text);return s.appendChild(o),n.appendChild(s),n.nodeId=e.id,n}}],(n=[{key:"init",value:function(t){var n=e.parseTreeData(t),r=n.treeNodes,i=n.nodesById,s=n.leafNodesById,o=n.defaultValues,a=n.defaultDisables;this.treeNodes=r,this.nodesById=i,this.leafNodesById=s,this.render(this.treeNodes);var l=this.options,c=l.values,u=l.disables,h=l.loaded;c&&c.length?this.setValues(c):o&&o.length&&this.setValues(o),u&&u.length?this.setDisables(u):a&&a.length&&this.setDisables(a),"function"==typeof h&&h.call(this)}},{key:"render",value:function(t){var n=e.createRootEle();n.appendChild(this.buildTree(t,0)),this.bindEvent(n);var r="string"==typeof this.container?document.querySelector(this.container):this.container;!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(r),r.appendChild(n)}},{key:"buildTree",value:function(t,n){var r=this,i=e.createUlEle();return t&&t.length&&t.forEach((function(t){var s=e.createLiEle(t,n===r.options.closeDepth-1);r.liElementsById[t.id]=s;var o=null;t.children&&t.children.length&&(o=r.buildTree(t.children,n+1)),o&&s.appendChild(o),i.appendChild(s)})),i}},{key:"bindEvent",value:function(t){var n=this;t.addEventListener("click",(function(t){var r=t.target;"SPAN"===r.nodeName&&r.classList.contains("treejs-checkbox")?n.onItemClick(r.parentNode.nodeId):"SPAN"===r.nodeName&&r.classList.contains("treejs-label")?n.onItemLabelClick(r.parentNode.nodeId):"LI"===r.nodeName&&r.classList.contains("treejs-node")?n.onItemClick(r.nodeId):"SPAN"===r.nodeName&&r.classList.contains("treejs-switcher")&&e.onSwitcherClick(r)}),!1)}},{key:"onItemClick",value:function(e){var t=this.nodesById[e],n=this.options.onChange;t.disabled||(this.setValue(e),this.updateLiElements()),n&&n.call(this)}},{key:"onItemLabelClick",value:function(e){var t=this.options.onItemLabelClick;t&&t.call(this,e)}},{key:"setValue",value:function(e){var t=this.nodesById[e];if(t){var n=t.status,r=1===n||2===n?0:2;t.status=r,this.markWillUpdateNode(t),this.walkUp(t,"status"),this.walkDown(t,"status")}}},{key:"getValues",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(e.leafNodesById,n)&&(1!==e.leafNodesById[n].status&&2!==e.leafNodesById[n].status||t.push(n))})),t}},{key:"setValues",value:function(e){var t=this;this.emptyNodesCheckStatus(),e.forEach((function(e){t.setValue(e)})),this.updateLiElements();var n=this.options.onChange;n&&n.call(this)}},{key:"setDisable",value:function(e){var t=this.nodesById[e];t&&(t.disabled||(t.disabled=!0,this.markWillUpdateNode(t),this.walkUp(t,"disabled"),this.walkDown(t,"disabled")))}},{key:"getDisables",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach((function(n){Object.prototype.hasOwnProperty.call(e.leafNodesById,n)&&e.leafNodesById[n].disabled&&t.push(n)})),t}},{key:"setDisables",value:function(e){var t=this;this.emptyNodesDisable(),e.forEach((function(e){t.setDisable(e)})),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach((function(e){e.disabled||(e.status=0)}))}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach((function(e){e.disabled=!1}))}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(e,t){var n=v(t,2),r=n[0],i=n[1];return 1!==i.status&&2!==i.status||(e[r]=i),e}),{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce((function(e,t){var n=v(t,2),r=n[0],i=n[1];return i.disabled&&(e[r]=i),e}),{})}},{key:"updateLiElements",value:function(){var e=this;Object.values(this.willUpdateNodesById).forEach((function(t){e.updateLiElement(t)})),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(e){this.willUpdateNodesById[e.id]=e}},{key:"walkUp",value:function(e,t){var n=e.parent;if(n){if("status"===t){var r,i=n.children.reduce((function(e,t){return Number.isNaN(t.status)?e:e+t.status}),0);if(r=i?i===2*n.children.length?2:1:0,n.status===r)return;n.status=r}else{var s=n.children.reduce((function(e,t){return e&&t.disabled}),!0);if(n.disabled===s)return;n.disabled=s}this.markWillUpdateNode(n),this.walkUp(n,t)}}},{key:"walkDown",value:function(e,t){var n=this;e.children&&e.children.length&&e.children.forEach((function(r){"status"===t&&r.disabled||(r[t]=e[t],n.markWillUpdateNode(r),n.walkDown(r,t))}))}},{key:"updateLiElement",value:function(e){var t=this.liElementsById[e.id].classList;switch(e.status){case 0:t.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:t.remove("treejs-node__checked"),t.add("treejs-node__halfchecked");break;case 2:t.remove("treejs-node__halfchecked"),t.add("treejs-node__checked")}switch(e.disabled){case!0:t.contains("treejs-node__disabled")||t.add("treejs-node__disabled");break;case!1:t.contains("treejs-node__disabled")&&t.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var e=this;Object.keys(this.leafNodesById).forEach((function(t){var n=e.leafNodesById[t];S(e,n)}))}},{key:"expandAll",value:function(){M(this,this.treeNodes[0])}}])&&x(t.prototype,n),r&&x(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()}(),r.default}()},346:function(e,t){!function(e){class t{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const n=this._eventListeners;void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}hasEventListener(e,t){const n=this._eventListeners;return void 0!==n[e]&&n[e].includes(t)}removeEventListener(e,t){const n=this._eventListeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}}function n(){return("undefined"==typeof performance?Date:performance).now()}class r{constructor(e=r.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(r.MIN_DECAY_MILLISECONDS,e)}update(e,t,n,r){const i=2e-4*this.naturalFrequency;if(null==e||0===r)return t;if(e===t&&0===this.velocity)return t;if(n<0)return e;const s=e-t,o=this.velocity+this.naturalFrequency*s,a=s+n*o,l=Math.exp(-this.naturalFrequency*n),c=(o-this.naturalFrequency*a)*l,u=-this.naturalFrequency*(c+o*l);return Math.abs(c)<i*Math.abs(r)&&u*s>=0?(this.velocity=0,t):(this.velocity=c,t+a*l)}}async function i(e){return new Promise(((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e}))}function s(e,t=document.head){const n=document.createElement("style");return n.type="text/css",n.innerText=e,null==t||t.appendChild(n),n}r.SETTLING_TIME=1e4,r.MIN_DECAY_MILLISECONDS=.001,r.DECAY_MILLISECONDS=50;const o={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function a(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function l(e,t,n){return e.replace(new RegExp(a(t),"g"),n)}const c=(e,...t)=>String.raw({raw:e},...t),u=(e,...t)=>{let n=String.raw({raw:e},...t);return n=l(n,"%","%25"),n=l(n,"> <","><"),n=l(n,"; }",";}"),n=l(n,"<","%3c"),n=l(n,">","%3e"),n=l(n,'"',"'"),n=l(n,"#","%23"),n=l(n,"{","%7b"),n=l(n,"}","%7d"),n=l(n,"|","%7c"),n=l(n,"^","%5e"),n=l(n,"`","%60"),n=l(n,"@","%40"),n=l(n,"&","&amp;"),n=l(n,"\n","%0A"),"data:image/svg+xml;charset=UTF-8,"+n};function h(e,t){const n=window.URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout((()=>{document.body.removeChild(r),window.URL.revokeObjectURL(n)}),1e3)}async function p(e){return new Promise(((t,n)=>{const r=new FileReader;r.onload=e=>t(r.result),r.onerror=e=>n(r.error),r.onabort=e=>n(new Error("Read aborted")),r.readAsDataURL(e)}))}function d(e,t){let n;do{n=Object.getOwnPropertyDescriptor(e,t)}while(!n&&(e=Object.getPrototypeOf(e)));return n}function f(e,t,n=!0,r=!1){const i=d(e,t);return!!(null==i?void 0:i.set)||n&&!1!==(null==i?void 0:i.writable)&&void 0===(null==i?void 0:i.get)||r&&!i}function m(e,t,n,r=!0,i=!1){return!(!e||!f(e,t,r,i)||(e[t]=n,0))}function g(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}const _={priority:1/0,serialize:(e,t)=>Object.fromEntries(Object.entries(e).map((([e,n])=>[e,v.Serialize(n,t,!1)]))),deserialize:(e,t,n)=>Object.assign(t||{},Object.fromEntries(Object.entries(e).map((([e,r])=>[e,v.Deserialize(r,null==t?void 0:t[e],n,!1)])))),isType:e=>(e.constructor||Object)===Object};class v{static GetSerializer(e){return v.Serializers.find((t=>t.isType(e)))}static RegisterSerializer(...e){var t;for(const n of e){const e=null!==(t=n.priority)&&void 0!==t?t:1e10,r=g(v.Serializers,(t=>void 0!==t.priority&&t.priority<e));r>=0?v.Serializers.splice(r+1,0,n):v.Serializers.push(n)}}static UnregisterSerializer(...e){for(const t of e){const e=v.Serializers.indexOf(t);e>=0&&v.Serializers.splice(e,1)}}static Serialize(e,t,n=!1){var r,i;if("function"==typeof e)return;if(!n){const n=v.GetSerializer(e);if(n)return n.serialize(e,t);if("function"==typeof e.toJSON){const n=e.toJSON(t);return e.serializableClassId&&n&&(n.serializableClassId=e.serializableClassId),n}}let s=null!==(r=e.constructor)&&void 0!==r?r:Object;const o={};for(;s&&s!==Object;){const n=null!==(i=v.TypeMap.get(s))&&void 0!==i?i:[];for(const[r,i]of n)o[r]=v.Serialize(e[i],t,!1);s=Object.getPrototypeOf(s)}return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}static Deserialize(e,t,n,r=!1){var i,s;if(void 0===e)return t;if(t===e)return t;if(e&&"object"==typeof e&&(e.constructor||Object)===Object&&e.resource&&"string"==typeof e.resource&&e.uuid){const r=null==n?void 0:n[e.resource];if(!r)return console.warn(`Resource ${e.resource} not found`),t;if("object"==typeof(e=r[e.uuid])&&(e.__useCount=e.__useCount?e.__useCount+1:1),e||console.warn(`Resource ${e.resource} with uuid ${e.uuid} not found`),t===e)return t;if(e&&"object"==typeof e){if((e.constructor||Object)!==Object)return t?(console.warn("replacing object",t,"with deserialized object from meta",e),e):e;console.error("Deserialize; meta should only have class instances, not js objects",e,t,n)}}if(e&&"object"==typeof e&&(e.constructor||Object)!==Object&&!Array.isArray(e)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",e,"source",t,e.constructor,e.constructor!==Object),e&&"object"==typeof e)if(!e.serializableClassId||t&&t.serializableClassId===e.serializableClassId)(e.constructor||Object)!==Object||t?Array.isArray(e)&&!t&&(t=[]):t={};else{const n=v.SerializableClasses.get(e.serializableClassId);n&&(t=n.DataInConstructor?new n(e):new n)}if("function"==typeof t)return console.error("cannot deserialize over function",t,e),t;if(!r){const r=v.GetSerializer(e);if(r&&r!==_)return r.deserialize(e,t,n)}if(!e||null==t||"object"!=typeof t)return e;if(!r&&"function"==typeof(null==t?void 0:t.fromJSON))return t.fromJSON(e,n),t;let o=null!==(i=t.constructor)&&void 0!==i?i:Object;if(o===Object)return _.deserialize(e,t,n);for(;o&&o!==Object;){const r=null!==(s=v.TypeMap.get(o))&&void 0!==s?s:[];for(const[i,s]of r){const r=t[s],o=v.Deserialize(e[i],r,n,!1);o!==r&&m(t,s,o,!0)}o=Object.getPrototypeOf(o)}return t}}function y(e,t="param"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(n,r)=>{Object.defineProperty(n,r,{get(){return this[`_oc_${r}`]},set(n){var i;const s=this[`_oc_${r}`];if(s===n)return;this[`_oc_${r}`]=n;const o="param"===t?[r,n,s]:"object"===t?[{key:r,value:n,oldValue:s}]:"";if("string"==typeof e)null===(i=this[e])||void 0===i||i.call(this,...o);else if("function"==typeof e){let t=!1;if(e.name){let n=this;for(;n;){if(n[e.name]===e){e.call(this,...o),t=!0;break}n=Object.getPrototypeOf(n)}}t||(e.name&&this[e.name].name===`bound ${e.name}`?this[e.name](...o):e(...o))}}})}}function b(e,{backgroundColor:t="",scale:n=1,width:r=512,height:i=512}){const s=document.createElement("canvas"),o=s.getContext("2d"),a=n,l=r,c=i;return s.width=l*a,s.height=c*a,s.style.width=`${l}`,s.style.height=`${c}`,(null==t?void 0:t.length)>0&&(o.fillStyle=t,o.fillRect(0,0,s.width,s.height)),o.drawImage(e,0,0,s.width,s.height),s}v.TypeMap=new Map,v.SerializableClasses=new Map,v.Serializers=[{priority:0,isType:e=>Array.isArray(e),serialize:(e,t)=>e.map((e=>v.Serialize(e,t,!1))),deserialize:(e,t,n)=>{const r=e.length;Array.isArray(t)||(t=[]);for(let i=0;i<r;i++){const r=e[i],s=t.length>i?v.Deserialize(r,t[i],n,!1):v.Deserialize(r,void 0,n,!1);t.length<=i?t.push(s):t[i]=s}return t}},{priority:0,isType:e=>!e||"object"!=typeof e,serialize:e=>{if(e&&"number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e},deserialize:(e,t)=>{if("number"==typeof t){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}return e}},_];const A=async(e,t)=>b(await i(e),t),w=async(e,t)=>await A(e,t).then((e=>e.toDataURL("image/png"))),x=async e=>p(await(await fetch(e)).blob());function E(e,t,{width:n,height:r},i=!0){const s=`\n<svg viewBox="0 0 ${n} ${r}" xmlns="http://www.w3.org/2000/svg">\n    <style>\n    ${t}\n    </style>\n    <foreignObject x="0" y="0" width="100%" height="100%">\n        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">\n            ${e}\n        </div>\n    </foreignObject>\n</svg>\n    `;return i?u(s):s}e.Damper=r,e.LinearToSRGB=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055},e.PointerDragHelper=class extends t{constructor(){super(...arguments),this._onPointerDown=e=>{if(0!==e.button)return;if(!this._element)return;this._pointerUp=void 0;const t=e.clientX/this._element.clientWidth*2-1,r=-e.clientY/this._element.clientHeight*2+1,i=n();this._pointerDown={x:t,y:r,time:i},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=e=>{if(!this._pointerDown||!this._pointer)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,r=-e.clientY/this._element.clientHeight*2+1,i=n();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:t-this._pointerDown.x,y:r-this._pointerDown.y,time:i-this._pointerDown.time},delta:{x:t-this._pointer.x,y:r-this._pointer.y,time:i-this._pointer.time}}),this._pointer={x:t,y:r,time:n()},e.buttons%2==0&&this._onPointerUp(e)},this._onPointerUp=e=>{if(0!==e.button)return;if(!this._pointerDown)return;if(!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,r=-e.clientY/this._element.clientHeight*2+1,i=n();this._pointerUp={x:t,y:r,time:i},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(e){this._element!==e&&(this._element&&this._removeElement(),this._element=e,this._element&&this._addElement())}_removeElement(){var e,t,n,r,i;null===(e=this._element)||void 0===e||e.removeEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.removeEventListener("pointermove",this._onPointerMove),null===(n=this._element)||void 0===n||n.removeEventListener("pointerup",this._onPointerUp),null===(r=this._element)||void 0===r||r.removeEventListener("pointercancel",this._onPointerUp),null===(i=this._element)||void 0===i||i.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var e,t,n,r,i;null===(e=this._element)||void 0===e||e.addEventListener("pointerdown",this._onPointerDown),null===(t=this._element)||void 0===t||t.addEventListener("pointermove",this._onPointerMove),null===(n=this._element)||void 0===n||n.addEventListener("pointerup",this._onPointerUp),null===(r=this._element)||void 0===r||r.addEventListener("pointercancel",this._onPointerUp),null===(i=this._element)||void 0===i||i.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},e.SRGBToLinear=function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)},e.Serialization=v,e.SimpleEventDispatcher=t,e.TYPED_ARRAYS=o,e.absMax=function(e,t){return Math.abs(e)>Math.abs(t)?e:t},e.aesGcmDecrypt=async function(e,t){const n="string"==typeof t?(new TextEncoder).encode(t):t,r=await crypto.subtle.digest("SHA-256",n),i=e.slice(0,12),s={name:"AES-GCM",iv:"string"==typeof i?new Uint8Array(Array.from(i).map((e=>e.charCodeAt(0)))):i},o=await crypto.subtle.importKey("raw",r,s,!1,["decrypt"]),a=e.slice(12),l="string"==typeof a?new Uint8Array(Array.from(a).map((e=>e.charCodeAt(0)))):a;try{const t=await crypto.subtle.decrypt(s,o,l);return"string"==typeof e?(new TextDecoder).decode(t):new Uint8Array(t)}catch(e){throw new Error("Decrypt failed")}},e.aesGcmEncrypt=async function(e,t,n){const r="string"==typeof t?(new TextEncoder).encode(t):t,i=await crypto.subtle.digest("SHA-256",r),s=crypto.getRandomValues(new Uint8Array(12)),o=Array.from(s).map((e=>String.fromCharCode(e))).join(""),a={name:"AES-GCM",iv:s},l=await crypto.subtle.importKey("raw",i,a,!1,["encrypt"]),c="string"==typeof e?(new TextEncoder).encode(e):e,u=await crypto.subtle.encrypt(a,l,c),h=new Uint8Array(u),p=Array.from(h),d=p.map((e=>String.fromCharCode(e))).join(""),f=n?"string"==typeof n?n:(new TextDecoder).decode(n):"",m=n?"string"==typeof n?(new TextEncoder).encode(n):Array.from(n):[];return"string"==typeof e?f+o+d:new Uint8Array([...m,...s,...p])},e.arrayBufferToBase64=function(e){if(!window)return console.warn("window is required"),"";let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)},e.base64ToArrayBuffer=function(e){if(!window)return console.warn("window is required"),new Uint8Array(0);const t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer},e.blobToDataURL=p,e.canvasFlipY=function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(!n)throw new Error("Unable to get 2d context");return n.translate(0,e.height),n.scale(1,-1),n.drawImage(e,0,0),t},e.clearBit=function(e,t){return e&~(1<<t)},e.colorToDataUrl=function(e,t=1,n=1){const r=document.createElement("canvas");r.width=t,r.height=n;const i=r.getContext("2d");i.fillStyle="#"+e,i.fillRect(0,0,t,n);const s=r.toDataURL();return r.remove(),s},e.copyProps=function(e,t,n){for(const r of n){const n=e[r];void 0!==n&&m(t,r,n,!0)}return t},e.createCanvasElement=function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e},e.createDiv=function({innerHTML:e="",id:t,classList:n,addToBody:r=!0,elementTag:i="div"}){const s=document.createElement(i);return t&&(s.id=t),s.innerHTML=e,n&&s.classList.add(...n),r&&document.body.appendChild(s),s},e.createImage=i,e.createScriptFromURL=async function(e,t=document.head){return new Promise(((n,r)=>{const i=document.createElement("script");i.setAttribute("src",e),i.addEventListener("load",(()=>n(i))),i.addEventListener("error",r),t.appendChild(i)}))},e.createStyles=s,e.css=c,e.deepAccessObject=function(e,t,n=!1){for("string"==typeof e&&(e=e.split("."));e.length>0;){if(!t)return;const r=e.splice(0,1)[0];if(!(r.length<1)){if(!(r in t)){if(n)throw new Error("invalid access, check "+r+" in "+t);return}t=t[r]}}return t},e.downloadBlob=h,e.downloadFile=function(e,t){return h(e,null!=t?t:e.name)},e.embedUrlRefs=async function(e,t=x){const n=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(n)for(const r of n){const n=await t(r);e=e.replace(r,n)}return e},e.escapeRegExp=a,e.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then((e=>e[0])):window.chooseFileSystemEntries()},e.getFilenameFromPath=function(e){return e.substring(e.lastIndexOf("/")+1)},e.getKeyByValue=function(e,t){return Object.keys(e).find((n=>e[n]===t))},e.getNewFileHandle=function(){if("showSaveFilePicker"in window){const e={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(e)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},e.getOrCall=function(e,...t){return"function"==typeof e&&(e=e(...t)),e},e.getPropertyDescriptor=d,e.getTypedArray=function(e,t){return new o[e](t)},e.getUrlQueryParam=function(e,t=null){var n;return null!==(n=new URL(window.location.href).searchParams.get(e))&&void 0!==n?n:t},e.glsl=(e,...t)=>String.raw({raw:e},...t),e.html=(e,...t)=>String.raw({raw:e},...t),e.htmlToCanvas=async function(e,t,n){const r=E(e,t,n);return await A(r,n)},e.htmlToPng=async function(e,t,n){const r=E(e,t,n);return await w(r,n)},e.htmlToSvg=E,e.imageBitmapToBase64=function(e,t=8192,n=!1){var r;if(!e.width||!e.height)return"";const i=document.createElement("canvas");i.width=Math.min(t,e.width),i.height=Math.floor(1+i.width*e.height/e.width);const s=e instanceof ImageBitmap,o=s&&n&&Math.abs(i.width-e.width)<.5?i.getContext("bitmaprenderer"):void 0;o?o.transferFromImageBitmap(e):null===(r=i.getContext("2d"))||void 0===r||r.drawImage(e,0,0,i.width,i.height);const a=i.toDataURL("image/png");return i.remove(),s&&n&&e.close(),a},e.imageDataToCanvas=function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t},e.imageToCanvas=b,e.imageUrlToImageData=async function(e){return new Promise(((t,n)=>{const r=new Image;r.addEventListener("load",(()=>{const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");if(!i)return void n(new Error("Could not get 2d context"));i.drawImage(r,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height);t(s),e.remove(),r.remove()}),!1),r.addEventListener("error",(e=>{r.remove(),n(e)}),!1),r.src=e}))},e.includesAll=function(e,t){for(const n of t)if(!e.includes(n))return!1;return!0},e.isPropertyWritable=f,e.isWebpExportSupported=function(){const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&e.toDataURL("image/webp").startsWith("data:image/webp")},e.longestCommonPrefix=function(e){return e.sort(),e[0].split("").map(((t,n)=>e[e.length-1][n]===t?t:"\0")).join("").split("\0").at(0)||""},e.makeColorSvg=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${e}'/%3E%3C/svg%3E%0A`,e.makeColorSvgCircle=e=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${e}'/%3E%3C/svg%3E%0A`,e.makeTextSvg=e=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${e}%3C/text%3E%3C/svg%3E%0A`,e.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},e.now=n,e.objectHasOwn=function(e,t){return Object.hasOwn?Object.hasOwn(e,t):e.hasOwnProperty(t)},e.onChange=y,e.onChange2=function(e,t="void"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return y(e,t)},e.onChange3=function(e,t="object"){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return y(e,t)},e.parseFileExtension=function(e){var t;if(!e||""===e||e.match(/__MACOSX\/.*\._/))return"";const n=null!==(t=(e=e.replace(/\?.*$/,"")).split(/[\\/]/).pop())&&void 0!==t?t:"",r=n.lastIndexOf(".");return""===n||r<1?"":n.slice(r+1)},e.pathJoin=function(e,t="/"){return e.join(t)},e.prettyScrollbar=function(e=document.head){return s(c`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,e)},e.readFile=function(e){return e.text?e.text():function(e){return new Promise((t=>{const n=new FileReader;n.addEventListener("loadend",(e=>{const n=e.srcElement.result;t(n)})),n.readAsText(e)}))}(e)},e.remoteWorkerURL=function(e,t){const n=(t?`var Module = { locateFile: function(s) { return "${t}"; } }; \n`:"")+`importScripts( "${e}" );`;return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))},e.replaceAll=l,e.safeSetProperty=m,e.serializable=function(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},v.SerializableClasses.set(e,t),t)},e.serialize=function(e){return(t,n)=>{const r=t.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");v.TypeMap.has(r)||v.TypeMap.set(r,[]),v.TypeMap.get(r).push([e||n,n])}},e.setUrlQueryParam=function(e,t,n=!1){const r=new URLSearchParams(location.search);null==t?r.has(e)&&r.delete(e):r.set(e,t),n?window.location.search=r.toString():window.history.replaceState({},"","?"+r.toString())},e.svgToCanvas=A,e.svgToPng=w,e.svgUrl=u,e.timeout=async function(e){return new Promise((t=>setTimeout(t,Math.max(0,e))))},e.toTitleCase=function(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},e.updateBit=function(e,t,n){return e&~(1<<t)|(n?1:0)<<t},e.uploadFile=async function(e=!1,t=!1,n){const r=document.createElement("input");r.type="file",r.multiple=e,r.accept=n||"*",r.webkitdirectory=t,r.style.display="none",document.body.appendChild(r),r.click();const i=await new Promise((e=>{r.onchange=t=>{e(Array.from(r.files||[]))}}));return document.body.removeChild(r),i},e.verifyPermission=async function(e,t){const n={};return t&&(n.writable=!0,n.mode="readwrite"),"granted"===await e.queryPermission(n)||"granted"===await e.requestPermission(n)},e.writeFile=async function(e,t){if(e.createWriter){const n=await e.createWriter();return await n.write(0,t),void await n.close()}const n=await e.createWritable();await n.write(t),await n.close()}}(t)},819:function(e,t){!function(e){const t="tp";function n(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const r=e(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function r(e){return{custom:t=>n(t)(e),boolean:n((e=>"boolean"==typeof e?e:void 0))(e),number:n((e=>"number"==typeof e?e:void 0))(e),string:n((e=>"string"==typeof e?e:void 0))(e),function:n((e=>"function"==typeof e?e:void 0))(e),constant:t=>n((e=>e===t?t:void 0))(e),raw:n((e=>e))(e),object:t=>n((e=>{if(null!==(n=e)&&"object"==typeof n)return function(e,t){return Object.keys(t).reduce(((n,r)=>{if(void 0===n)return;const i=(0,t[r])(e[r]);return i.succeeded?Object.assign(Object.assign({},n),{[r]:i.value}):void 0}),{})}(e,t);var n}))(e),array:t=>n((e=>{if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const r=n(t);return r.succeeded&&void 0!==r.value?[...e,r.value]:void 0}),[]);var n}))(e)}}const i={optional:r(!0),required:r(!1)};function s(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function o(e){return[e[0],e[1],e[2]]}function a(e){return t=>function(e,t){const n=s("float"===t?2:0);return`rgb(${o(e.getComponents("rgb",t)).map((e=>n(e))).join(", ")})`}(t,e)}function l(e){return t=>function(e,t){const n=s(2),r=s("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?n:r)(e))).join(", ")})`}(t,e)}function c(e){return t=>function(e,t){const n=s("float"===t?2:0),r=["r","g","b"];return`{${o(e.getComponents("rgb",t)).map(((e,t)=>`${r[t]}: ${n(e)}`)).join(", ")}}`}(t,e)}function u(e){return t=>function(e,t){const n=s(2),r=s("float"===t?2:0),i=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>`${i[t]}: ${(3===t?n:r)(e)}`)).join(", ")}}`}(t,e)}function h(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))}function p(e){return h(this,void 0,void 0,(function*(){const t=new Image;return t.crossOrigin="anonymous",new Promise(((n,r)=>{t.src=e,t.onload=()=>{n(t)},t.onerror=r}))}))}s(0),["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:a(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:l(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:c(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:u(t)}]),[]);const d=(f="img",(e,n)=>[t,"-",f,"v",e?`_${e}`:"",n?`-${n}`:""].join(""));var f;class m{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(d()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(d("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.classList.add(d("image")),this.image_.classList.add(d(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=e=>{t.clickCallback?t.clickCallback(e,this.input):this.input.click()},this.element.classList.add(d("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?null==t||t.classList.add(d("area_dragging")):null==t||t.classList.remove(d("area_dragging"))}}let g=null;class _{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new m(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose((()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)})),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(e){const t=(null==e?void 0:e.target).files;if(!t||!t.length)return;const n=t[0];this.setValue(n)}onDrop(e){return h(this,void 0,void 0,(function*(){e.preventDefault();try{const{dataTransfer:t}=e,n=null==t?void 0:t.files[0];if(n)this.setValue(n);else{const e=null==t?void 0:t.getData("url");if(!e)throw new Error("No url");this.setValue(e)}}catch(e){console.error("Could not parse the dropped image",e)}finally{this.view.changeDraggingState(!1)}}))}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){return h(this,void 0,void 0,(function*(){e instanceof HTMLImageElement?this.updateImage(e.src):"string"!=typeof e&&e?yield this.setValue(e):("placeholder"!==e&&e||(e=(yield this.handlePlaceholderImage()).src),this.updateImage(e))}))}updateImage(e){this.view.changeImage(e)}setValue(e){return h(this,void 0,void 0,(function*(){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const n=yield p(t).catch((()=>{}));this.value.setRawValue(n||e)}else e?this.value.setRawValue(yield p(e)):this.value.setRawValue(yield this.handlePlaceholderImage())}))}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return h(this,void 0,void 0,(function*(){return g||(g=yield function(){const e=document.createElement("canvas");e.width=320,e.height=50;const t=e.getContext("2d");return t.fillStyle="#00000004",t.fillRect(0,0,e.width,e.height),t.fillStyle="#eee",t.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',t.textAlign="center",t.textBaseline="middle",t.fillText("No image",.5*e.width,.5*e.height),new Promise((t=>{e.toBlob((e=>{const n=new Image;n.src=URL.createObjectURL(e),n.isPlaceholder=!0,n.onload=()=>{t(n)}}))}))}()),g}))}}const v=[".jpg",".png",".gif"],y={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(e,t){if(!(e instanceof HTMLImageElement||"string"==typeof e))return null;const n=i,r=function(e,t){const n=i.required.object(t)(e);return n.succeeded?n.value:void 0}(t,{view:n.required.constant("input-image"),acceptUrl:n.optional.boolean,clickCallback:n.optional.function,imageFit:n.optional.custom((e=>"contain"===e||"cover"===e?e:void 0)),extensions:n.optional.array(n.required.string)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>e=>void 0!==e.src?""===e.src?"placeholder":e.src:e,writer:e=>(e,t)=>{e.write(t)}},controller(e){var t,n;return new _(e.document,{value:e.value,imageFit:null!==(t=e.params.imageFit)&&void 0!==t?t:"cover",clickCallback:e.params.clickCallback,viewProps:e.viewProps,extensions:null!==(n=e.params.extensions)&&void 0!==n?n:v})}};e.plugin=y,Object.defineProperty(e,"__esModule",{value:!0})}(t)},665:function(e,t){!function(e){class t{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class n{constructor(e){this.target=e}}class r extends n{constructor(e,t,n,r){super(e),this.value=t,this.presetKey=n,this.last=null==r||r}}class i extends n{constructor(e,t,n){super(e),this.value=t,this.presetKey=n}}class s extends n{constructor(e,t){super(e),this.expanded=t}}class o extends n{constructor(e,t){super(e),this.index=t}}function a(e){return null==e}function l(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function c(e,t){let n=e;do{const e=Object.getOwnPropertyDescriptor(n,t);if(e&&(void 0!==e.set||!0===e.writable))return!0;n=Object.getPrototypeOf(n)}while(null!==n);return!1}const u={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class h{static alreadyDisposed(){return new h({type:"alreadydisposed"})}static notBindable(){return new h({type:"notbindable"})}static propertyNotFound(e){return new h({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new h({type:"shouldneverhappen"})}constructor(e){var t;this.message=null!==(t=u[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}}class p{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=null!=n?n:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!p.isBindable(n))throw h.notBindable();if(!(e in n))throw h.propertyNotFound(e);n[e]=t}}class d extends t{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const r=t.bind(this);return this.controller_.valueController.emitter.on(e,(()=>{r(new n(this))})),this}}class f{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}const m="tp";function g(e){return(t,n)=>[m,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function _(e){return e.rawValue}function v(e,t){var n,r;e.emitter.on("change",(n=_,r=t,e=>r(n(e)))),t(e.rawValue)}function y(e,t,n){v(e.value(t),n)}function b(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function A(e,t){v(e,(e=>{t.textContent=null!=e?e:""}))}const w=g("btn");class x{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(w()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(w("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(w("t")),A(t.props.value("title"),r),this.buttonElement.appendChild(r)}}class E{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new x(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class C{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new f,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e,i=this.rawValue_;(!this.equals_(i,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:r,sender:this}))}}class S{constructor(e){this.emitter=new f,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},r=this.value_;(r!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:this.value_,sender:this}))}}function M(e,t){const n=null==t?void 0:t.constraint,r=null==t?void 0:t.equals;return n||r?new C(e,t):new S(e)}class T{constructor(e){this.emitter=new f,this.valMap_=e;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:M(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new T(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function D(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const r=e(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function I(e){return{custom:t=>D(t)(e),boolean:D((e=>"boolean"==typeof e?e:void 0))(e),number:D((e=>"number"==typeof e?e:void 0))(e),string:D((e=>"string"==typeof e?e:void 0))(e),function:D((e=>"function"==typeof e?e:void 0))(e),constant:t=>D((e=>e===t?t:void 0))(e),raw:D((e=>e))(e),object:t=>D((e=>{if(null!==(n=e)&&"object"==typeof n)return function(e,t){return Object.keys(t).reduce(((n,r)=>{if(void 0===n)return;const i=(0,t[r])(e[r]);return i.succeeded?Object.assign(Object.assign({},n),{[r]:i.value}):void 0}),{})}(e,t);var n}))(e),array:t=>D((e=>{if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const r=n(t);return r.succeeded&&void 0!==r.value?[...e,r.value]:void 0}),[]);var n}))(e)}}const P={optional:I(!0),required:I(!1)};function R(e,t){const n=P.required.object(t)(e);return n.succeeded?n.value:void 0}function B(e){console.warn([`Missing '${e.key}' of ${e.target} in ${e.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class k{constructor(e){this.value_=e}static create(e){return[new k(e),(t,n)=>{e.setRawValue(t,n)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const O=g("");function L(e,t){return b(e,O(void 0,t))}class F extends T{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=k.create(M(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,r;const i=null!=e?e:{};return new F(T.createCore({disabled:null!==(t=i.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n,parent:null!==(r=i.parent)&&void 0!==r?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){v(this.globalDisabled_,L(e,"disabled")),y(this,"hidden",L(e,"hidden"))}bindDisabled(e){v(this.globalDisabled_,(t=>{e.disabled=t}))}bindTabIndex(e){v(this.globalDisabled_,(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}getGlobalDisabled_(){const e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const U=g(""),N={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class j{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(U(void 0,N[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(U(void 0,N[e]))}))})),this.viewProps.handleDispose((()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)}))}get parent(){return this.parent_}set parent(e){this.parent_=e,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):B({key:"parent",target:F.name,place:"BladeController.parent"})}}const z="http://www.w3.org/2000/svg";function G(e){e.offsetHeight}function V(e){return void 0!==e.ontouchstart}const H={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Q(e,t){const n=e.createElementNS(z,"svg");return n.innerHTML=H[t],n}function W(e,t,n){e.insertBefore(t,e.children[n])}function q(e){e.parentElement&&e.parentElement.removeChild(e)}function X(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function Y(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const K=g("lbl");class J{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(K()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(K("l")),y(t.props,"label",(t=>{a(t)?this.element.classList.add(K(void 0,"nol")):(this.element.classList.remove(K(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,r)=>{r>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const r=e.createElement("div");r.classList.add(K("v")),this.element.appendChild(r),this.valueElement=r}}class Z extends j{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new J(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const $={id:"button",type:"blade",accept(e){const t=P,n=R(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller:e=>new Z(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:new E(e.document,{props:T.fromObject({title:e.params.title}),viewProps:e.viewProps})}),api:e=>e.controller instanceof Z&&e.controller.valueController instanceof E?new d(e.controller):null};class ee extends j{constructor(e){super(e),this.value=e.value}}function te(){return new T({positions:M([],{equals:l})})}class ne extends T{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=T.createCore(t);return new ne(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!a(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};y(this,"expanded",n),y(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function re(e,t){t.style.height=e.styleHeight}function ie(e,t){e.value("expanded").emitter.on("beforechange",(()=>{if(e.set("completed",!1),a(e.get("expandedHeight"))){const n=function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),G(t),n=t.clientHeight,e.set("temporaryExpanded",null),G(t)})),n}(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),G(t)})),e.emitter.on("change",(()=>{re(e,t)})),re(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class se extends t{constructor(e,t){super(e),this.rackApi_=t}}class oe{constructor(e){this.emitter=new f,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw h.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class ae extends t{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new r(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}class le extends Z{constructor(e,t){super(e,t),this.binding=t.binding}}class ce extends t{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new i(this,t,this.controller_.binding.target.presetKey)})}}class ue extends Z{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function he(e){return e instanceof fe?e.apiSet_:e instanceof se?e.rackApi_.apiSet_:null}function pe(e,t){const n=e.find((e=>e.controller_===t));if(!n)throw h.shouldNeverHappen();return n}function de(e,t,n){if(!p.isBindable(e))throw h.notBindable();return new p(e,t,n)}class fe extends t{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new f,this.apiSet_=new oe(he),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((e=>{this.setUpApi_(e)}))}get children(){return this.controller_.rack.children.map((e=>pe(this.apiSet_,e)))}addInput(e,t,n){const r=null!=n?n:{},i=this.controller_.view.element.ownerDocument,s=this.pool_.createInput(i,de(e,t,r.presetKey),r),o=new ae(s);return this.add(o,r.index)}addMonitor(e,t,n){const r=null!=n?n:{},i=this.controller_.view.element.ownerDocument,s=this.pool_.createMonitor(i,de(e,t),r),o=new ce(s);return this.add(o,r.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addSeparator(e){return function(e,t){const n=null!=t?t:{};return e.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find((t=>t.controller_===e.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),r=this.pool_.createBladeApi(n);return this.add(r,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpApi_(e){this.apiSet_.find((t=>t.controller_===e))||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=pe(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof le){const n=pe(this.apiSet_,t),i=t.binding;this.emitter_.emit("change",{event:new r(n,i.target.read(),i.target.presetKey,e.options.last)})}else if(t instanceof ee){const n=pe(this.apiSet_,t);this.emitter_.emit("change",{event:new r(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof ue))throw h.shouldNeverHappen();const t=pe(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new i(t,n.target.read(),n.target.presetKey)})}}class me extends se{constructor(e,t){super(e,new fe(e.rackController,t)),this.emitter_=new f,this.controller_.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",{event:new s(this,e.sender.rawValue)})})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class ge extends j{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class _e{constructor(e,t){const n=g(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function ve(e){return e instanceof Ae?e.rack:e instanceof ge?e.rackController.rack:null}function ye(e){const t=ve(e);return t?t.bcSet_:null}class be{constructor(e){var t,n;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new f,this.blade_=null!==(t=e.blade)&&void 0!==t?t:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new oe(ye),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),c(e,"parent")?e.parent=this:(e.parent_=this,B({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(e,t)}remove(e){c(e,"parent")?e.parent=null:(e.parent_=null,B({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter((t=>t instanceof e))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof le)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof ue)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ee)n.value.emitter.on("change",this.onChildValueChange_);else{const e=ve(n);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof le)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof ue)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ee)n.value.emitter.off("change",this.onChildValueChange_);else{const e=ve(n);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const r=[];e===t&&(r.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||r.push("veryfirst")),e===n&&(r.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||r.push("verylast")),e.blade.set("positions",r)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildInputChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof le&&r.binding===t)return r}return null}(this.find(le),e.sender);if(!t)throw h.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof ue&&r.binding===t)return r}return null}(this.find(ue),e.sender);if(!t)throw h.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof ee&&r.value===t)return r}return null}(this.find(ee),e.sender);if(!t)throw h.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ae extends j{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new _e(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new be({blade:t.root?void 0:t.blade,viewProps:t.viewProps});n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--)this.rack.children[e].viewProps.set("disposed",!0)}))}onRackAdd_(e){e.isRoot&&W(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&q(e.bladeController.view.element)}}const we=g("cnt");class xe{constructor(e,t){var n;this.className_=g(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),we()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),y(this.foldable_,"completed",b(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),y(t.props,"title",(e=>{a(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(this.className_("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(this.className_("t")),A(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;const o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const l=t.containerElement;l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class Ee extends ge{constructor(e,t){var n;const r=ne.create(null===(n=t.expanded)||void 0===n||n),i=new Ae(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:i,view:new xe(e,{containerElement:i.view.element,foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,ie(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ce={id:"folder",type:"blade",accept(e){const t=P,n=R(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller:e=>new Ee(e.document,{blade:e.blade,expanded:e.params.expanded,props:T.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof Ee?new me(e.controller,e.pool):null};class Se extends ee{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new J(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Me extends t{}const Te=g("spr");class De{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Te()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(Te("r")),this.element.appendChild(n)}}class Ie extends j{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new De(e,{viewProps:t.viewProps})}))}}const Pe={id:"separator",type:"blade",accept(e){const t=R(e,{view:P.required.constant("separator")});return t?{params:t}:null},controller:e=>new Ie(e.document,{blade:e.blade,viewProps:e.viewProps}),api:e=>e.controller instanceof Ie?new Me(e.controller):null},Re=g("tbi");class Be{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Re()),t.viewProps.bindClassModifiers(this.element),y(t.props,"selected",(e=>{e?this.element.classList.add(Re(void 0,"sel")):this.element.classList.remove(Re(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(Re("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(Re("t")),A(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class ke{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Be(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Oe{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ke(e,{props:t.itemProps,viewProps:F.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ae(e,{blade:te(),viewProps:F.create()}),this.props=t.props,y(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Le{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class Fe extends se{constructor(e,t){super(e,new fe(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new f,this.pageApiMap_=new Map,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})})),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((e=>{this.setUpPageApi_(e)}))}get pages(){return this.controller_.pageSet.items.map((e=>{const t=this.pageApiMap_.get(e);if(!t)throw h.shouldNeverHappen();return t}))}addPage(e){const t=this.controller_.view.element.ownerDocument,n=new Oe(t,{itemProps:T.fromObject({selected:!1,title:e.title}),props:T.fromObject({selected:!1})});this.controller_.add(n,e.index);const r=this.pageApiMap_.get(n);if(!r)throw h.shouldNeverHappen();return r}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find((t=>t.controller_===e.contentController));if(!t)throw h.shouldNeverHappen();const n=new Le(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw h.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new o(this,e.rawValue)})}}class Ue{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=M(!0),this.selectedIndex=M(-1),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Ne=g("tab");class je{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ne(),we()),t.viewProps.bindClassModifiers(this.element),v(t.empty,b(this.element,Ne(void 0,"nop")));const n=e.createElement("div");n.classList.add(Ne("t")),this.element.appendChild(n),this.itemsElement=n;const r=e.createElement("div");r.classList.add(Ne("i")),this.element.appendChild(r);const i=t.contentsElement;i.classList.add(Ne("c")),this.element.appendChild(i),this.contentsElement=i}}class ze extends ge{constructor(e,t){const n=new Ae(e,{blade:t.blade,viewProps:t.viewProps}),r=new Ue;super({blade:t.blade,rackController:n,view:new je(e,{contentsElement:n.view.element,empty:r.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new oe((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=r}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;W(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;q(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const Ge={id:"tab",type:"blade",accept(e){const t=P,n=R(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(e){const t=new ze(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const r=new Oe(e.document,{itemProps:T.fromObject({selected:!1,title:n.title}),props:T.fromObject({selected:!1})});t.add(r)})),t},api:e=>e.controller instanceof ze?new Fe(e.controller,e.pool):null};class Ve{constructor(){this.disabled=!1,this.emitter=new f}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class He{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new f,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Qe{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new f,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function We(e,t){for(;e.length<t;)e.push(void 0)}function qe(e){const t=[];return We(t,e),M(t)}function Xe(e){const t=e.indexOf(void 0);return t<0?e:e.slice(0,t)}class Ye{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new f,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=function(e,t){const n=[...Xe(e),t];return n.length>e.length?n.splice(0,n.length-e.length):We(n,e.length),n}(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}class Ke{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function Je(e,t){if(e instanceof t)return e;if(e instanceof Ke){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class Ze{constructor(e){this.values=T.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class $e{constructor(e){this.values=T.fromObject({options:e})}get options(){return this.values.get("options")}constrain(e){const t=this.values.get("options");return 0===t.length||t.filter((t=>t.value===e)).length>0?e:t[0].value}}class et{constructor(e){this.values=T.fromObject({max:e.max,min:e.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let r=e;return a(n)||(r=Math.max(r,n)),a(t)||(r=Math.min(r,t)),r}}class tt{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}const nt=g("lst");class rt{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(nt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(nt("s")),y(this.props_,"options",(t=>{X(n),t.forEach(((t,r)=>{const i=e.createElement("option");i.dataset.index=String(r),i.textContent=t.text,i.value=String(t.value),n.appendChild(i)}))})),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const r=e.createElement("div");r.classList.add(nt("m")),r.appendChild(Q(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class it{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new rt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget.selectedOptions.item(0);if(!t)return;const n=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const st=g("pop");class ot{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(st()),t.viewProps.bindClassModifiers(this.element),v(t.shows,b(this.element,st(void 0,"v")))}}class at{constructor(e,t){this.shows=M(!1),this.viewProps=t.viewProps,this.view=new ot(e,{shows:this.shows,viewProps:this.viewProps})}}const lt=g("txt");class ct{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(lt()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(lt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class ut{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ct(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);a(n)||(this.value.rawValue=n),this.view.refresh()}}function ht(e){return"false"!==e&&!!e}function pt(e){return function(e){return String(e)}(e)}class dt{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const ft={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class mt{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=ft[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const gt={"+":e=>e,"-":e=>-e,"~":e=>~e};class _t{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=gt[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function vt(e){return(t,n)=>{for(let r=0;r<e.length;r++){const i=e[r](t,n);if(""!==i)return i}return""}}function yt(e,t){var n;const r=e.substr(t).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function bt(e,t){var n;const r=e.substr(t).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function At(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const r=function(e,t){const n=bt(e,t);if(""!==n)return n;const r=e.substr(t,1);if("-"!==r&&"+"!==r)return"";const i=bt(e,t+=1);return""===i?"":r+i}(e,t);return""===r?"":n+r}function wt(e,t){const n=e.substr(t,1);if("0"===n)return n;const r=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=r.length,""===r?"":r+bt(e,t)}const xt=vt([function(e,t){const n=wt(e,t);if(t+=n.length,""===n)return"";const r=e.substr(t,1);if(t+=r.length,"."!==r)return"";const i=bt(e,t);return n+r+i+At(e,t+=i.length)},function(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const r=bt(e,t);return t+=r.length,""===r?"":n+r+At(e,t)},function(e,t){const n=wt(e,t);return t+=n.length,""===n?"":n+At(e,t)}]),Et=vt([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const r=function(e,t){var n;const r=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}(e,t);return""===r?"":n+r}]),Ct=vt([Et,xt]);function St(e,t,n){n+=yt(t,n).length;const r=e.filter((e=>t.startsWith(e,n)))[0];return r?(n+=r.length,{cursor:n+=yt(t,n).length,operator:r}):null}const Mt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(n,r)=>{const i=e(n,r);if(!i)return null;r=i.cursor;let s=i.evaluable;for(;;){const i=St(t,n,r);if(!i)break;r=i.cursor;const o=e(n,r);if(!o)return null;r=o.cursor,s=new mt(i.operator,s,o.evaluable)}return s?{cursor:r,evaluable:s}:null}}(e,t)),(function e(t,n){const r=function(e,t){var n;return null!==(n=function(e,t){const n=Ct(e,t);return t+=n.length,""===n?null:{evaluable:new dt(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const r=Tt(e,t);if(!r)return null;t=r.cursor,t+=yt(e,t).length;const i=e.substr(t,1);return t+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:t}}(e,t)}(t,n);if(r)return r;const i=t.substr(n,1);if(n+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;const s=e(t,n);return s?{cursor:n=s.cursor,evaluable:new _t(i,s.evaluable)}:null}));function Tt(e,t){return t+=yt(e,t).length,Mt(e,t)}function Dt(e){var t;const n=function(e){const t=Tt(e,0);return t?t.cursor+yt(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function It(e){if("number"==typeof e)return e;if("string"==typeof e){const t=Dt(e);if(!a(t))return t}return 0}function Pt(e){return String(e)}function Rt(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const Bt=Rt(0);function kt(e){return Bt(e)+"%"}function Ot(e){return String(e)}function Lt(e){return e}function Ft({primary:e,secondary:t,forward:n,backward:r}){let i=!1;function s(e){i||(i=!0,e(),i=!1)}e.emitter.on("change",(r=>{s((()=>{t.setRawValue(n(e,t),r.options)}))})),t.emitter.on("change",(i=>{s((()=>{e.setRawValue(r(e,t),i.options)})),s((()=>{t.setRawValue(n(e,t),i.options)}))})),s((()=>{t.setRawValue(n(e,t),{forceEmit:!1,last:!0})}))}function Ut(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function Nt(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function jt(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function zt(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function Gt(e,t){var n,r;const i=t.ownerDocument.defaultView,s=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=i&&i.scrollX)&&void 0!==n?n:0)+s.left),y:e.pageY-((null!==(r=i&&i.scrollY)&&void 0!==r?r:0)+s.top)}}class Vt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new f,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Gt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Gt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Gt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Ht(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function Qt(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Wt(e,t,n){return Math.min(Math.max(e,t),n)}function qt(e,t){return(e%t+t)%t}const Xt=g("txt");class Yt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Xt(),Xt(void 0,"num")),t.arrayPosition&&this.element.classList.add(Xt(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Xt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Xt()),this.inputElement.classList.add(Xt("i"));const r=e.createElement("div");r.classList.add(Xt("k")),this.element.appendChild(r),this.knobElement=r;const i=e.createElementNS(z,"svg");i.classList.add(Xt("g")),this.knobElement.appendChild(i);const s=e.createElementNS(z,"path");s.classList.add(Xt("gb")),i.appendChild(s),this.guideBodyElem_=s;const o=e.createElementNS(z,"path");o.classList.add(Xt("gh")),i.appendChild(o),this.guideHeadElem_=o;const a=e.createElement("div");a.classList.add(g("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Xt(void 0,"drg"));this.element.classList.add(Xt(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),r=Wt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+r},0 L${n},4 L${n+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Kt{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=M(null),this.view=new Yt(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Vt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const r=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("minValue"),i=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue");let s=e;return void 0!==r&&(s=Math.max(s,r)),void 0!==i&&(s=Math.min(s,i)),s}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);a(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=Ut(this.baseStep_,Nt(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==Ut(this.baseStep_,Nt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Jt=g("sld");class Zt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Jt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Jt("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const r=e.createElement("div");r.classList.add(Jt("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Wt(Ht(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class $t{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Zt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Ht(Wt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ut(this.baseStep_,jt(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ut(this.baseStep_,jt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const en=g("sldtxt");class tn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(en());const n=e.createElement("div");n.classList.add(en("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(en("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class nn{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new $t(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Kt(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new tn(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function rn(e,t){e.write(t)}function sn(e){const t=P;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function on(e){if("inline"===e||"popup"===e)return e}function an(e){const t=P;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function ln(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function cn(e){return a(e)?null:new $e(ln(e))}function un(e,t){const n=e&&Je(e,tt);return n?Qt(n.step):Math.max(Qt(t),2)}function hn(e){const t=function(e){const t=e?Je(e,tt):null;return t?t.step:null}(e);return null!=t?t:1}function pn(e,t){var n;const r=e&&Je(e,tt),i=Math.abs(null!==(n=null==r?void 0:r.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}const dn=g("ckb");class fn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(dn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(dn("l")),this.element.appendChild(n);const r=e.createElement("input");r.classList.add(dn("i")),r.type="checkbox",n.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const i=e.createElement("div");i.classList.add(dn("w")),n.appendChild(i);const s=Q(e,"check");i.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class mn{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new fn(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}const gn={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=R(t,{options:P.optional.custom(sn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ht,constraint:e=>function(e){const t=[],n=cn(e.options);return n&&t.push(n),new Ke(t)}(e.params),writer:e=>rn},controller:e=>{const t=e.document,n=e.value,r=e.constraint,i=r&&Je(r,$e);return i?new it(t,{props:new T({options:i.values.value("options")}),value:n,viewProps:e.viewProps}):new mn(t,{value:n,viewProps:e.viewProps})}},_n=g("col");class vn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(_n()),t.foldable.bindExpandedClass(this.element,_n(void 0,"expanded")),y(t.foldable,"completed",b(this.element,_n(void 0,"cpl")));const n=e.createElement("div");n.classList.add(_n("h")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(_n("s")),n.appendChild(r),this.swatchElement=r;const i=e.createElement("div");if(i.classList.add(_n("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(_n("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function yn(e,t,n){const r=qt(e,360),i=Wt(t/100,0,1),s=Wt(n/100,0,1),o=s*i,a=o*(1-Math.abs(r/60%2-1)),l=s-o;let c,u,h;return[c,u,h]=r>=0&&r<60?[o,a,0]:r>=60&&r<120?[a,o,0]:r>=120&&r<180?[0,o,a]:r>=180&&r<240?[0,a,o]:r>=240&&r<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function bn(e){return[e[0],e[1],e[2]]}function An(e,t){return[e[0],e[1],e[2],t]}const wn={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const r=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==r?t*(100-Math.abs(2*n-100))/r:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const r=(e%360+360)%360,i=Wt(t/100,0,1),s=Wt(n/100,0,1),o=(1-Math.abs(2*s-1))*i,a=o*(1-Math.abs(r/60%2-1)),l=s-o/2;let c,u,h;return[c,u,h]=r>=0&&r<60?[o,a,0]:r>=60&&r<120?[a,o,0]:r>=120&&r<180?[0,o,a]:r>=180&&r<240?[0,a,o]:r>=240&&r<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}},hsv:{hsl:function(e,t,n){const r=100-Math.abs(n*(200-t)/100-100);return[e,0!==r?t*n/r:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:yn},rgb:{hsl:function(e,t,n){const r=Wt(e/255,0,1),i=Wt(t/255,0,1),s=Wt(n/255,0,1),o=Math.max(r,i,s),a=Math.min(r,i,s),l=o-a;let c=0,u=0;const h=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=r===o?(i-s)/l:i===o?2+(s-r)/l:4+(r-i)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*h]},hsv:function(e,t,n){const r=Wt(e/255,0,1),i=Wt(t/255,0,1),s=Wt(n/255,0,1),o=Math.max(r,i,s),a=o-Math.min(r,i,s);let l;return l=0===a?0:o===r?((i-s)/a%6+6)%6*60:o===i?60*((s-r)/a+2):60*((r-i)/a+4),[l,100*(0===o?0:a/o),100*o]},rgb:(e,t,n)=>[e,t,n]}};function xn(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function En(e,t,n,r){const i=xn(t,n),s=xn(t,r);return e.map(((e,t)=>e/i[t]*s[t]))}function Cn(e,t){return"object"==typeof e&&!a(e)&&t in e&&"number"==typeof e[t]}class Sn{static black(e="int"){return new Sn([0,0,0],"rgb",e)}static fromObject(e,t="int"){const n="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new Sn(n,"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return Cn(e,"r")&&Cn(e,"g")&&Cn(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&Cn(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const n=e.comps_,r=t.comps_;for(let e=0;e<n.length;e++)if(n[e]!==r[e])return!1;return!0}constructor(e,t,n="int"){this.mode=t,this.type=n,this.comps_=function(e,t,n){var r;const i=xn(t,n);return["rgb"===t?Wt(e[0],0,i[0]):(s=e[0],o=i[0],s===o?o:qt(s,o)),Wt(e[1],0,i[1]),Wt(e[2],0,i[2]),Wt(null!==(r=e[3])&&void 0!==r?r:1,0,1)];var s,o}(e,t,n)}getComponents(e,t="int"){return An(function(e,t,n){const r=En(e,t.mode,t.type,"int");return En(wn[t.mode][n.mode](...r),n.mode,"int",n.type)}(bn(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Mn=g("colp");class Tn{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Mn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Mn("hsv"));const r=e.createElement("div");r.classList.add(Mn("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(Mn("h")),this.hPaletteView_=t.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");if(s.classList.add(Mn("rgb")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(Mn("a"));const r=e.createElement("div");r.classList.add(Mn("ap")),r.appendChild(this.alphaViews_.palette.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(Mn("at")),i.appendChild(this.alphaViews_.text.element),n.appendChild(i),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Dn(e){return"int"===e?"int":"float"===e?"float":void 0}function In(e){const t=P;return R(e,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Dn)}),expanded:t.optional.boolean,picker:t.optional.custom(on)})}function Pn(e){return e?.1:1}function Rn(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}function Bn(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const kn={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function On(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),r=t[2];return kn[r](n)}function Ln(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Bn(t[1],255),Bn(t[2],255),Bn(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Fn(e){return t=>{const n=Ln(t);return n?new Sn(n,"rgb",e):null}}function Un(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Bn(t[1],255),Bn(t[2],255),Bn(t[3],255),Bn(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Nn(e){return t=>{const n=Un(t);return n?new Sn(n,"rgb",e):null}}function jn(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1]),Bn(t[2],100),Bn(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function zn(e){return t=>{const n=jn(t);return n?new Sn(n,"hsl",e):null}}function Gn(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[On(t[1]),Bn(t[2],100),Bn(t[3],100),Bn(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Vn(e){return t=>{const n=Gn(t);return n?new Sn(n,"hsl",e):null}}function Hn(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function Qn(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Ht(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Ht(parseInt(n[4],16),0,255,0,1)]:null}function Wn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function qn(e){return t=>{const n=Wn(t);return n?new Sn(n,"rgb",e):null}}function Xn(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Yn(e){return t=>{const n=Xn(t);return n?new Sn(n,"rgb",e):null}}const Kn=[{parser:Hn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Qn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Ln,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Un,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:jn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Gn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Wn,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Xn,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Jn(e,t="int"){const n=function(e){return Kn.reduce(((t,{parser:n,result:r})=>t||(n(e)?r:null)),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}const Zn={int:[function(e){const t=Hn(e);return t?new Sn(t,"rgb","int"):null},function(e){const t=Qn(e);return t?new Sn(t,"rgb","int"):null},Fn("int"),Nn("int"),zn("int"),Vn("int"),qn("int"),Yn("int")],float:[Fn("float"),Nn("float"),zn("float"),Vn("float"),qn("float"),Yn("float")]};function $n(e){const t=Zn[e];return e=>t.reduce(((t,n)=>t||n(e)),null)}function er(e){const t=Wt(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function tr(e,t="#"){return`${t}${bn(e.getComponents("rgb")).map(er).join("")}`}function nr(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(er).join("")}`}function rr(e,t){const n=Rt("float"===t?2:0);return`rgb(${bn(e.getComponents("rgb",t)).map((e=>n(e))).join(", ")})`}function ir(e){return t=>rr(t,e)}function sr(e,t){const n=Rt(2),r=Rt("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?n:r)(e))).join(", ")})`}function or(e){return t=>sr(t,e)}function ar(e,t){const n=Rt("float"===t?2:0),r=["r","g","b"];return`{${bn(e.getComponents("rgb",t)).map(((e,t)=>`${r[t]}: ${n(e)}`)).join(", ")}}`}function lr(e){return t=>ar(t,e)}function cr(e,t){const n=Rt(2),r=Rt("float"===t?2:0),i=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>`${i[t]}: ${(3===t?n:r)(e)}`)).join(", ")}}`}function ur(e){return t=>cr(t,e)}const hr=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:tr},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:nr},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Rt(0),kt,kt];return`hsl(${bn(e.getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Rt(0),kt,kt,Rt(2)];return`hsla(${e.getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:ir(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:or(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:lr(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:ur(t)}]),[])];function pr(e){return hr.reduce(((t,n)=>{return t||(r=n.format,i=e,r.alpha===i.alpha&&r.mode===i.mode&&r.notation===i.notation&&r.type===i.type?n.stringifier:null);var r,i}),null)}const dr=g("apl");class fr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(dr()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(dr("b")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(dr("c")),n.appendChild(r),this.colorElem_=r;const i=e.createElement("div");i.classList.add(dr("m")),this.element.appendChild(i),this.markerElem_=i;const s=e.createElement("div");s.classList.add(dr("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Sn([t[0],t[1],t[2],0],"rgb"),r=new Sn([t[0],t[1],t[2],255],"rgb"),i=["to right",sr(n),sr(r)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`,this.previewElem_.style.backgroundColor=sr(e);const s=Ht(t[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class mr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new fr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,r=this.value.rawValue,[i,s,o]=r.getComponents("hsv");this.value.setRawValue(new Sn([i,s,o,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ut(Pn(!0),jt(e));if(0===t)return;const n=this.value.rawValue,[r,i,s,o]=n.getComponents("hsv");this.value.setRawValue(new Sn([r,i,s,o+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ut(Pn(!0),jt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const gr=g("coltxt");class _r{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(gr("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(((t,n)=>{const r=e.createElement("option");return r.textContent=n.text,r.value=n.value,t.appendChild(r),t}),e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(gr("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const r=e.createElement("div");r.classList.add(gr("mm")),r.appendChild(Q(e,"dropdown")),n.appendChild(r),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(gr("w")),this.element.appendChild(i),this.textsElem_=i,this.textViews_=t.textViews,this.applyTextViews_(),v(t.colorMode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){X(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(gr("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)}))}}function vr(e,t,n){const r=xn(e,t)[n];return new Ze({min:0,max:r})}function yr(e,t,n){return new Kt(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Pn(!1),parser:t.parser,props:T.fromObject({draggingScale:"float"===t.colorType?.01:1,formatter:(r=t.colorType,Rt("float"===r?2:0))}),value:M(0,{constraint:vr(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var r}class br{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=M(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new _r(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[yr(e,t,0),yr(e,t,1),yr(e,t,2)];return n.forEach(((e,t)=>{Ft({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[t],backward:(e,n)=>{const r=this.colorMode.rawValue,i=e.rawValue.getComponents(r,this.colorType_);return i[t]=n.rawValue,new Sn(An(bn(i),i[3]),r,this.colorType_)}})})),n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Ar=g("hpl");class wr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ar()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(Ar("c")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Ar("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=rr(new Sn([t,100,100],"hsv"));const n=Ht(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class xr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new wr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ht(Wt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),r=this.value.rawValue,[,i,s,o]=r.getComponents("hsv");this.value.setRawValue(new Sn([n,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ut(Pn(!1),jt(e));if(0===t)return;const n=this.value.rawValue,[r,i,s,o]=n.getComponents("hsv");this.value.setRawValue(new Sn([r+t,i,s,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ut(Pn(!1),jt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Er=g("svp");class Cr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Er()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=64,n.width=64,n.classList.add(Er("c")),this.element.appendChild(n),this.canvasElement=n;const r=e.createElement("div");r.classList.add(Er("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,i=e.getImageData(0,0,n,r),s=i.data;for(let e=0;e<r;e++)for(let i=0;i<n;i++){const o=Ht(i,0,n,0,100),a=Ht(e,0,r,100,0),l=yn(t[0],o,a),c=4*(e*n+i);s[c]=l[0],s[c+1]=l[1],s[c+2]=l[2],s[c+3]=255}e.putImageData(i,0,0);const o=Ht(t[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Ht(t[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Sr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Cr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ht(e.point.x,0,e.bounds.width,0,100),r=Ht(e.point.y,0,e.bounds.height,100,0),[i,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Sn([i,n,r,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){zt(e.key)&&e.preventDefault();const[t,n,r,i]=this.value.rawValue.getComponents("hsv"),s=Pn(!1),o=Ut(s,jt(e)),a=Ut(s,Nt(e));0===o&&0===a||this.value.setRawValue(new Sn([t,n+o,r+a,i],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Pn(!1),n=Ut(t,jt(e)),r=Ut(t,Nt(e));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Mr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new xr(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Sr(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new mr(e,{value:this.value,viewProps:this.viewProps}),text:new Kt(e,{parser:Dt,baseStep:.1,props:T.fromObject({draggingScale:.01,formatter:Rt(2)}),value:M(0,{constraint:new Ze({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ft({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const n=e.rawValue.getComponents();return n[3]=t.rawValue,new Sn(n,e.rawValue.mode)}}),this.textC_=new br(e,{colorType:t.colorType,parser:Dt,value:this.value,viewProps:this.viewProps}),this.view=new Tn(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Tr=g("colsw");class Dr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Tr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Tr("sw")),this.element.appendChild(n),this.swatchElem_=n;const r=e.createElement("button");r.classList.add(Tr("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=nr(e)}onValueChange_(){this.update_()}}class Ir{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Dr(e,{value:this.value,viewProps:this.viewProps})}}class Pr{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ne.create(t.expanded),this.swatchC_=new Ir(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new ut(e,{parser:t.parser,props:T.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vn(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new at(e,{viewProps:this.viewProps}):null;const r=new Mr(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ie(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Y(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!V(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function Rr(e){return bn(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function Br(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function kr(e){return"number"!=typeof e?Sn.black():new Sn([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function Or(e){return"number"!=typeof e?Sn.black():new Sn([(t=e)>>24&255,t>>16&255,t>>8&255,Ht(255&t,0,255,0,1)],"rgb");var t}function Lr(e){var t;return!(!(null==e?void 0:e.alpha)&&!(null===(t=null==e?void 0:e.color)||void 0===t?void 0:t.alpha))}function Fr(e){return e?e=>nr(e,"0x"):e=>tr(e,"0x")}const Ur={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"view"in e&&"color"===e.view}(t))return null;const n=In(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>Lr(e.params)?Or:kr,equals:Sn.equals,writer:e=>function(e){const t=e?Br:Rr;return(e,n)=>{rn(e,t(n))}}(Lr(e.params))},controller:e=>{const t=Lr(e.params),n="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0;return new Pr(e.document,{colorType:"int",expanded:null!=n&&n,formatter:Fr(t),parser:$n("int"),pickerLayout:null!=r?r:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function Nr(e,t){return n=>e?cr(n,t):ar(n,t)}const jr={id:"input-color-object",type:"input",accept:(e,t)=>{if(!Sn.isColorObject(e))return null;const n=In(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>function(e){return t=>function(e,t){return Sn.isColorObject(e)?Sn.fromObject(e,t):Sn.black(t)}(t,e)}(Rn(e.params)),equals:Sn.equals,writer:e=>{return r=e.initialValue,t=Sn.isRgbaColorObject(r),n=Rn(e.params),(e,r)=>{t?function(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)}(e,r,n):function(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b)}(e,r,n)};var t,n,r}},controller:e=>{var t;const n=Sn.isRgbaColorObject(e.initialValue),r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0,s=null!==(t=Rn(e.params))&&void 0!==t?t:"int";return new Pr(e.document,{colorType:s,expanded:null!=r&&r,formatter:Nr(n,s),parser:$n(s),pickerLayout:null!=i?i:"popup",supportsAlpha:n,value:e.value,viewProps:e.viewProps})}},zr={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;const n=Jn(e,Rn(t));if(!n)return null;if(!pr(n))return null;const r=In(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>{var t;return function(e){const t=Zn[e];return n=>{if("string"!=typeof n)return Sn.black(e);const r=t.reduce(((e,t)=>e||t(n)),null);return null!=r?r:Sn.black(e)}}(null!==(t=Rn(e.params))&&void 0!==t?t:"int")},equals:Sn.equals,writer:e=>{const t=Jn(e.initialValue,Rn(e.params));if(!t)throw h.shouldNeverHappen();const n=function(e){const t=pr(e);return t?(e,n)=>{rn(e,t(n))}:null}(t);if(!n)throw h.notBindable();return n}},controller:e=>{const t=Jn(e.initialValue,Rn(e.params));if(!t)throw h.shouldNeverHappen();const n=pr(t);if(!n)throw h.shouldNeverHappen();const r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new Pr(e.document,{colorType:t.type,expanded:null!=r&&r,formatter:n,parser:$n(t.type),pickerLayout:null!=i?i:"popup",supportsAlpha:t.alpha,value:e.value,viewProps:e.viewProps})}};class Gr{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,r;return null!==(r=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==r?r:e}));return this.asm_.fromComponents(t)}}const Vr=g("pndtxt");class Hr{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Vr()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(Vr("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}class Qr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,r)=>function(e,t,n){return new Kt(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:M(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}(e,t,r))),this.acs_.forEach(((e,n)=>{Ft({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[n],backward:(e,r)=>{const i=t.assembly.toComponents(e.rawValue);return i[n]=r.rawValue,t.assembly.fromComponents(i)}})})),this.view=new Hr(e,{textViews:this.acs_.map((e=>e.view))})}}function Wr(e,t){return"step"in e&&!a(e.step)?new tt(e.step,t):null}function qr(e){return a(e.max)||a(e.min)?a(e.max)&&a(e.min)?null:new et({max:e.max,min:e.min}):new Ze({max:e.max,min:e.min})}const Xr={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=P,r=R(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(sn),step:n.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>It,constraint:e=>function(e,t){const n=[],r=Wr(e,t);r&&n.push(r);const i=qr(e);i&&n.push(i);const s=cn(e.options);return s&&n.push(s),new Ke(n)}(e.params,e.initialValue),writer:e=>rn},controller:e=>{var t;const n=e.value,r=e.constraint,i=r&&Je(r,$e);if(i)return new it(e.document,{props:new T({options:i.values.value("options")}),value:n,viewProps:e.viewProps});const s=null!==(t="format"in e.params?e.params.format:void 0)&&void 0!==t?t:Rt(un(r,n.rawValue)),o=r&&Je(r,Ze);return o?new nn(e.document,{baseStep:hn(r),parser:Dt,sliderProps:new T({maxValue:o.values.value("max"),minValue:o.values.value("min")}),textProps:T.fromObject({draggingScale:pn(r,n.rawValue),formatter:s}),value:n,viewProps:e.viewProps}):new Kt(e.document,{baseStep:hn(r),parser:Dt,props:T.fromObject({draggingScale:pn(r,n.rawValue),formatter:s}),value:n,viewProps:e.viewProps})}};class Yr{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const Kr={toComponents:e=>e.getComponents(),fromComponents:e=>new Yr(...e)},Jr=g("p2d");class Zr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jr()),t.viewProps.bindClassModifiers(this.element),v(t.expanded,b(this.element,Jr(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Jr("h")),this.element.appendChild(n);const r=e.createElement("button");r.classList.add(Jr("b")),r.appendChild(Q(e,"p2dpad")),t.viewProps.bindDisabled(r),n.appendChild(r),this.buttonElement=r;const i=e.createElement("div");if(i.classList.add(Jr("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(Jr("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const $r=g("p2dp");class ei{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add($r()),"popup"===t.layout&&this.element.classList.add($r(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add($r("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const r=e.createElementNS(z,"svg");r.classList.add($r("g")),this.padElement.appendChild(r),this.svgElem_=r;const i=e.createElementNS(z,"line");i.classList.add($r("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);const s=e.createElementNS(z,"line");s.classList.add($r("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);const o=e.createElementNS(z,"line");o.classList.add($r("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=e.createElement("div");a.classList.add($r("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,r=Ht(e,-n,+n,0,100),i=Ht(t,-n,+n,0,100),s=this.invertsY_?100-i:i;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${s}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ti(e,t,n){return[Ut(t[0],jt(e)),Ut(t[1],Nt(e))*(n?1:-1)]}class ni{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new ei(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Vt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,r=Ht(e.point.x,0,e.bounds.width,-n,+n),i=Ht(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new Yr(r,i),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){zt(e.key)&&e.preventDefault();const[t,n]=ti(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(new Yr(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=ti(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ri{constructor(e,t){var n,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ne.create(t.expanded),this.popC_="popup"===t.pickerLayout?new at(e,{viewProps:this.viewProps}):null;const i=new ni(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.textC_=new Qr(e,{assembly:Kr,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Zr(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ie(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Y(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!V(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}class ii{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y,r=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const si={toComponents:e=>e.getComponents(),fromComponents:e=>new ii(...e)};function oi(e){return ii.isObject(e)?new ii(e.x,e.y,e.z):new ii}function ai(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function li(e,t){return{baseStep:hn(t),constraint:t,textProps:T.fromObject({draggingScale:pn(t,e),formatter:Rt(un(t,e))})}}const ci={id:"input-point3d",type:"input",accept:(e,t)=>{if(!ii.isObject(e))return null;const n=P,r=R(t,{x:n.optional.custom(an),y:n.optional.custom(an),z:n.optional.custom(an)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>oi,constraint:e=>{return t=e.params,n=e.initialValue,new Gr({assembly:si,components:[Oi("x"in t?t.x:void 0,n.x),Oi("y"in t?t.y:void 0,n.y),Oi("z"in t?t.z:void 0,n.z)]});var t,n},equals:ii.equals,writer:e=>ai},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Gr))throw h.shouldNeverHappen();return new Qr(e.document,{assembly:si,axes:[li(t.rawValue.x,n.components[0]),li(t.rawValue.y,n.components[1]),li(t.rawValue.z,n.components[2])],parser:Dt,value:t,viewProps:e.viewProps})}};class ui{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.z=n,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(a(e))return!1;const t=e.x,n=e.y,r=e.z,i=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const hi={toComponents:e=>e.getComponents(),fromComponents:e=>new ui(...e)};function pi(e){return ui.isObject(e)?new ui(e.x,e.y,e.z,e.w):new ui}function di(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}const fi={id:"input-point4d",type:"input",accept:(e,t)=>{if(!ui.isObject(e))return null;const n=P,r=R(t,{x:n.optional.custom(an),y:n.optional.custom(an),z:n.optional.custom(an),w:n.optional.custom(an)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>pi,constraint:e=>{return t=e.params,n=e.initialValue,new Gr({assembly:hi,components:[Oi("x"in t?t.x:void 0,n.x),Oi("y"in t?t.y:void 0,n.y),Oi("z"in t?t.z:void 0,n.z),Oi("w"in t?t.w:void 0,n.w)]});var t,n},equals:ui.equals,writer:e=>di},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof Gr))throw h.shouldNeverHappen();return new Qr(e.document,{assembly:hi,axes:t.rawValue.getComponents().map(((e,t)=>{return r=e,{baseStep:hn(i=n.components[t]),constraint:i,textProps:T.fromObject({draggingScale:pn(i,r),formatter:Rt(un(i,r))})};var r,i})),parser:Dt,value:t,viewProps:e.viewProps})}},mi={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=R(t,{options:P.optional.custom(sn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ot,constraint:e=>function(e){const t=[],n=cn(e.options);return n&&t.push(n),new Ke(t)}(e.params),writer:e=>rn},controller:e=>{const t=e.document,n=e.value,r=e.constraint,i=r&&Je(r,$e);return i?new it(t,{props:new T({options:i.values.value("options")}),value:n,viewProps:e.viewProps}):new ut(t,{parser:e=>e,props:T.fromObject({formatter:Lt}),value:n,viewProps:e.viewProps})}},gi={defaultInterval:200,defaultLineCount:3},_i=g("mll");class vi{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(_i()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(_i("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class yi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new vi(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const bi=g("sgl");class Ai{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(bi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(bi("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class wi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ai(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const xi={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=R(t,{lineCount:P.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ht},controller:e=>{var t;return 1===e.value.rawValue.length?new wi(e.document,{formatter:pt,value:e.value,viewProps:e.viewProps}):new yi(e.document,{formatter:pt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:gi.defaultLineCount,value:e.value,viewProps:e.viewProps})}},Ei=g("grl");class Ci{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ei()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(z,"svg");n.classList.add(Ei("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const r=e.createElementNS(z,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const i=e.createElement("div");i.classList.add(Ei("t"),g("tt")()),this.element.appendChild(i),this.tooltipElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),r=this.props_.get("maxValue"),i=[];this.value.rawValue.forEach(((s,o)=>{if(void 0===s)return;const a=Ht(o,0,t,0,e.width),l=Ht(s,n,r,e.height,0);i.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",i.join(" "));const s=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o)return void s.classList.remove(Ei("t","a"));const a=Ht(this.cursor_.rawValue,0,t,0,e.width),l=Ht(o,n,r,e.height,0);s.style.left=`${a}px`,s.style.top=`${l}px`,s.textContent=`${this.formatter_(o)}`,s.classList.contains(Ei("t","a"))||(s.classList.add(Ei("t","a"),Ei("t","in")),G(s),s.classList.remove(Ei("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Si{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=M(-1),this.view=new Ci(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),V(e)){const e=new Vt(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Ht(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(Ht(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Mi(e){return"format"in e&&!a(e.format)?e.format:Rt(2)}function Ti(e){return"view"in e&&"graph"===e.view}const Di={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=P,r=R(t,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return r?{initialValue:e,params:r}:null},binding:{defaultBufferSize:e=>Ti(e)?64:1,reader:e=>It},controller:e=>Ti(e.params)?function(e){var t,n,r;return new Si(e.document,{formatter:Mi(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:gi.defaultLineCount,props:T.fromObject({maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(r="min"in e.params?e.params.min:null)&&void 0!==r?r:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new wi(e.document,{formatter:Mi(e.params),value:e.value,viewProps:e.viewProps}):new yi(e.document,{formatter:Mi(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:gi.defaultLineCount,value:e.value,viewProps:e.viewProps})}(e)},Ii={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=P,r=R(t,{lineCount:n.optional.number,multiline:n.optional.boolean});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Ot},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new yi(e.document,{formatter:Lt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:gi.defaultLineCount,value:n,viewProps:e.viewProps}):new wi(e.document,{formatter:Lt,value:n,viewProps:e.viewProps})}};function Pi(e,t){return 0===t?new Ve:new He(e,null!=t?t:gi.defaultInterval)}class Ri{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){if(a(t.read()))throw new h({context:{key:t.key},type:"nomatchingcontroller"});const r=this.pluginsMap_.inputs.reduce(((r,i)=>null!=r?r:function(e,t){const n=e.accept(t.target.read(),t.params);if(a(n))return null;const r=P,i={target:t.target,initialValue:n.initialValue,params:n.params},s=e.binding.reader(i),o=e.binding.constraint?e.binding.constraint(i):void 0,l=M(s(n.initialValue),{constraint:o,equals:e.binding.equals}),c=new Qe({reader:s,target:t.target,value:l,writer:e.binding.writer(i)}),u=r.optional.boolean(t.params.disabled).value,h=r.optional.boolean(t.params.hidden).value,p=e.controller({constraint:o,document:t.document,initialValue:n.initialValue,params:n.params,value:c.value,viewProps:F.create({disabled:u,hidden:h})}),d=r.optional.string(t.params.label).value;return new le(t.document,{binding:c,blade:te(),props:T.fromObject({label:null!=d?d:t.target.key}),valueController:p})}(i,{document:e,target:t,params:n})),null);if(r)return r;throw new h({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const r=this.pluginsMap_.monitors.reduce(((r,i)=>null!=r?r:function(e,t){var n,r,i;const s=P,o=e.accept(t.target.read(),t.params);if(a(o))return null;const l={target:t.target,initialValue:o.initialValue,params:o.params},c=e.binding.reader(l),u=null!==(r=null!==(n=s.optional.number(t.params.bufferSize).value)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(o.params))&&void 0!==r?r:1,h=s.optional.number(t.params.interval).value,p=new Ye({reader:c,target:t.target,ticker:Pi(t.document,h),value:qe(u)}),d=s.optional.boolean(t.params.disabled).value,f=s.optional.boolean(t.params.hidden).value,m=e.controller({document:t.document,params:o.params,value:p.value,viewProps:F.create({disabled:d,hidden:f})}),g=null!==(i=s.optional.string(t.params.label).value)&&void 0!==i?i:t.target.key;return new ue(t.document,{binding:p,blade:te(),props:T.fromObject({label:g}),valueController:m})}(i,{document:e,params:n,target:t})),null);if(r)return r;throw new h({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce(((n,r)=>null!=n?n:function(e,t){const n=e.accept(t.params);if(!n)return null;const r=P.optional.boolean(t.params.disabled).value,i=P.optional.boolean(t.params.hidden).value;return e.controller({blade:te(),document:t.document,params:Object.assign(Object.assign({},n.params),{disabled:r,hidden:i}),viewProps:F.create({disabled:r,hidden:i})})}(r,{document:e,params:t})),null);if(!n)throw new h({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof le)return new ae(e);if(e instanceof ue)return new ce(e);if(e instanceof Ae)return new fe(e,this);const t=this.pluginsMap_.blades.reduce(((t,n)=>null!=t?t:n.api({controller:e,pool:this})),null);if(!t)throw h.shouldNeverHappen();return t}}function Bi(e){return Yr.isObject(e)?new Yr(e.x,e.y):new Yr}function ki(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function Oi(e,t){if(!e)return;const n=[],r=Wr(e,t);r&&n.push(r);const i=qr(e);return i&&n.push(i),new Ke(n)}function Li(e,t){const[n,r]=e?function(e){const t=Je(e,Ze);if(t)return[t.values.get("min"),t.values.get("max")];const n=Je(e,et);return n?[n.minValue,n.maxValue]:[void 0,void 0]}(e):[];if(!a(n)||!a(r))return Math.max(Math.abs(null!=n?n:0),Math.abs(null!=r?r:0));const i=hn(e);return Math.max(10*Math.abs(i),10*Math.abs(t))}function Fi(e,t){const n=t instanceof Gr?t.components[0]:void 0,r=t instanceof Gr?t.components[1]:void 0,i=Li(n,e.x),s=Li(r,e.y);return Math.max(i,s)}function Ui(e,t){return{baseStep:hn(t),constraint:t,textProps:T.fromObject({draggingScale:pn(t,e),formatter:Rt(un(t,e))})}}function Ni(e){if(!("y"in e))return!1;const t=e.y;return!!t&&"inverted"in t&&!!t.inverted}const ji={id:"input-point2d",type:"input",accept:(e,t)=>{if(!Yr.isObject(e))return null;const n=P,r=R(t,{expanded:n.optional.boolean,picker:n.optional.custom(on),x:n.optional.custom(an),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Bi,constraint:e=>{return t=e.params,n=e.initialValue,new Gr({assembly:Kr,components:[Oi("x"in t?t.x:void 0,n.x),Oi("y"in t?t.y:void 0,n.y)]});var t,n},equals:Yr.equals,writer:e=>ki},controller:e=>{const t=e.document,n=e.value,r=e.constraint;if(!(r instanceof Gr))throw h.shouldNeverHappen();const i="expanded"in e.params?e.params.expanded:void 0,s="picker"in e.params?e.params.picker:void 0;return new ri(t,{axes:[Ui(n.rawValue.x,r.components[0]),Ui(n.rawValue.y,r.components[1])],expanded:null!=i&&i,invertsY:Ni(e.params),maxValue:Fi(n.rawValue,r),parser:Dt,pickerLayout:null!=s?s:"popup",value:n,viewProps:e.viewProps})}};class zi extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class Gi extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class Vi extends t{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new r(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}const Hi={id:"list",type:"blade",accept(e){const t=P,n=R(e,{options:t.required.custom(sn),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(e){const t=new $e(ln(e.params.options)),n=M(e.params.value,{constraint:t}),r=new it(e.document,{props:new T({options:t.values.value("options")}),value:n,viewProps:e.viewProps});return new Se(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:r})},api:e=>e.controller instanceof Se&&e.controller.valueController instanceof it?new zi(e.controller):null};class Qi extends me{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){(function(e,t){e.forEach((e=>{const n=t[e.target.presetKey];void 0!==n&&e.writer(e.target,e.reader(n))}))})(this.controller_.rackController.rack.find(le).map((e=>e.binding)),e),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(le).map((e=>e.binding.target)).reduce(((e,t)=>Object.assign(e,{[t.presetKey]:t.read()})),{})}refresh(){this.controller_.rackController.rack.find(le).forEach((e=>{e.binding.read()})),this.controller_.rackController.rack.find(ue).forEach((e=>{e.binding.read()}))}}class Wi extends Ee{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const qi={id:"slider",type:"blade",accept(e){const t=P,n=R(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(e){var t,n;const r=null!==(t=e.params.value)&&void 0!==t?t:0,i=new Ze({max:e.params.max,min:e.params.min}),s=new nn(e.document,{baseStep:1,parser:Dt,sliderProps:new T({maxValue:i.values.value("max"),minValue:i.values.value("min")}),textProps:T.fromObject({draggingScale:pn(void 0,r),formatter:null!==(n=e.params.format)&&void 0!==n?n:Pt}),value:M(r,{constraint:i}),viewProps:e.viewProps});return new Se(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:s})},api:e=>e.controller instanceof Se&&e.controller.valueController instanceof nn?new Gi(e.controller):null},Xi={id:"text",type:"blade",accept(e){const t=P,n=R(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(e){var t;const n=new ut(e.document,{parser:e.params.parse,props:T.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:M(e.params.value),viewProps:e.viewProps});return new Se(e.document,{blade:e.blade,props:T.fromObject({label:e.params.label}),valueController:n})},api:e=>e.controller instanceof Se&&e.controller.valueController instanceof ut?new Vi(e.controller):null};function Yi(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const r=e.createElement("style");r.dataset.tpStyle=t,r.textContent=n,e.head.appendChild(r)}const Ki=new class{constructor(e){const[t,n]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("3.1.6");e.BladeApi=t,e.ButtonApi=d,e.FolderApi=me,e.InputBindingApi=ae,e.ListApi=zi,e.MonitorBindingApi=ce,e.Pane=class extends Qi{constructor(e){var t,n;const r=null!=e?e:{},i=null!==(t=r.document)&&void 0!==t?t:globalThis.document,s=function(){const e=new Ri;return[ji,ci,fi,mi,Xr,zr,jr,Ur,gn,xi,Ii,Di,$,Ce,Pe,Ge].forEach((t=>{e.register(t)})),e}();super(new Wi(i,{expanded:r.expanded,blade:te(),props:T.fromObject({title:r.title}),viewProps:F.create()}),s),this.pool_=s,this.containerElem_=null!==(n=r.container)&&void 0!==n?n:function(e){const t=e.createElement("div");return t.classList.add(g("dfw")()),e.body&&e.body.appendChild(t),t}(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw h.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw h.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach((e=>{this.pool_.register(e),this.embedPluginStyle_(e)}))}embedPluginStyle_(e){e.css&&Yi(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Yi(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((e=>{this.embedPluginStyle_(e)})),this.registerPlugin({plugins:[qi,Hi,Ge,Xi]})}},e.SeparatorApi=Me,e.SliderApi=Gi,e.TabApi=Fe,e.TabPageApi=Le,e.TextApi=Vi,e.TpChangeEvent=r,e.VERSION=Ki,Object.defineProperty(e,"__esModule",{value:!0})}(t)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(e){super(e),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform(e,t){return e?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(e,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(e=!0,t=!1){return e&&super.preload(),t&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS="object"!=typeof WebAssembly||"js"===this.encoderConfig.type,librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then((libraries=>{const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),eval(jsContent+"\nDracoEncoderModule;")?.()})),this.encoderPending}async initDecoder(){await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then((async e=>e.text())).then((e=>{const t=e.indexOf("/* worker */");if(t<1)throw new Error("unable to load decoder module");return e.substring(0,t-1)}));return eval(jsContent+"\nDracoDecoderModule;")?.()}async _loadLibrary(e,t){return DRACOLoader2.LibraryValueMap[e]?DRACOLoader2.LibraryValueMap[e]:DRACOLoader2.LibraryValueMap[e]=await super._loadLibrary(e,t)}static SetDecoderJsString(e){this.LibraryValueMap["draco_decoder.js"]=e}}DRACOLoader2.LibraryValueMap={}},988:function(e,t,n){n.d(t,{$TI:function(){return hd},$V:function(){return gd},$Vf:function(){return lf},$YQ:function(){return yl},A5E:function(){return Ui},AXT:function(){return $c},Aip:function(){return gf},B02:function(){return c},BFQ:function(){return Qe},BG$:function(){return ot},BKK:function(){return pf},BVF:function(){return j},BVQ:function(){return uu},BbS:function(){return Vp},Bf4:function(){return ae},BtG:function(){return Os},CJI:function(){return Ei},CP7:function(){return El},CaW:function(){return Je},CdI:function(){return $},Cne:function(){return vf},CtA:function(){return Ge},CtF:function(){return jh},D1R:function(){return be},D9w:function(){return je},DT1:function(){return af},Djp:function(){return st},DqL:function(){return Xh},DvJ:function(){return Cs},E2K:function(){return Ve},EB7:function(){return Uc},EJi:function(){return ph},EoG:function(){return Z},F5T:function(){return Si},FDw:function(){return Ae},FE5:function(){return ih},FIo:function(){return uh},FM8:function(){return On},FT0:function(){return vh},FUD:function(){return pt},FvO:function(){return Ed},GG6:function(){return ut},GQ:function(){return qd},GUF:function(){return Gt},GVz:function(){return or},GZb:function(){return uf},G_r:function(){return Ht},Gih:function(){return ht},Gql:function(){return wp},H$k:function(){return nh},HTd:function(){return fe},HW6:function(){return mf},HdW:function(){return gt},HgB:function(){return fn},HkE:function(){return ml},Hmr:function(){return Tp},Hw6:function(){return $n},Hy8:function(){return L},Hyl:function(){return zc},IEO:function(){return sc},IFH:function(){return Dt},IKL:function(){return fh},ILR:function(){return qe},IOt:function(){return Ut},Ilk:function(){return Ri},Ir4:function(){return dn},JOQ:function(){return js},JQ4:function(){return Me},JUT:function(){return ar},JWc:function(){return hn},KI_:function(){return zt},Kgo:function(){return mu},KhW:function(){return P},Kj0:function(){return xs},Kz5:function(){return Se},L5g:function(){return _f},L5s:function(){return bp},LBq:function(){return _d},LSk:function(){return vn},LY2:function(){return te},L_r:function(){return yn},Lcc:function(){return bf},LgZ:function(){return k},LsT:function(){return Ce},Ltg:function(){return rr},Lun:function(){return ul},M5h:function(){return w},M6v:function(){return q},M8C:function(){return kn},Mig:function(){return fp},MyG:function(){return $t},N$j:function(){return ic},N4l:function(){return A},NDo:function(){return K},NMF:function(){return Et},NYV:function(){return at},Ns1:function(){return X},NwF:function(){return Lh},Ny0:function(){return Gc},O7d:function(){return Yu},OAl:function(){return rn},OM3:function(){return Ji},OTo:function(){return Be},OdW:function(){return lc},OoA:function(){return he},Ox3:function(){return dp},PA7:function(){return Nt},PMe:function(){return op},Pa4:function(){return hr},PeU:function(){return o},Pnf:function(){return St},PpQ:function(){return Zn},QM0:function(){return pn},QRU:function(){return Sp},QZ1:function(){return un},QmN:function(){return s},Qpg:function(){return kd},R2R:function(){return Rh},REq:function(){return hf},RNb:function(){return Gi},ROQ:function(){return jc},RSm:function(){return mh},Rki:function(){return Vd},RlZ:function(){return N},RsA:function(){return i},RvT:function(){return sn},S2y:function(){return l},S3k:function(){return Yh},S9g:function(){return Zr},SJI:function(){return Gp},SPe:function(){return _c},SUY:function(){return Lp},Se2:function(){return z},Sm8:function(){return T},So8:function(){return Ip},SvJ:function(){return ft},Syv:function(){return xt},T95:function(){return xe},TOt:function(){return bu},TUj:function(){return yd},TUv:function(){return rc},T_1:function(){return ef},T_J:function(){return Jt},T__:function(){return Vc},T_f:function(){return mp},TlE:function(){return zi},Tme:function(){return pi},Tn7:function(){return ch},TyD:function(){return pe},U7:function(){return nu},USm:function(){return Jr},UY4:function(){return Dc},UZH:function(){return r},Uk6:function(){return oh},UlW:function(){return Rt},Uol:function(){return fu},V1s:function(){return Ps},V4E:function(){return ff},VLJ:function(){return Od},VYz:function(){return Xp},Vdb:function(){return F},Vj0:function(){return Ys},Vkp:function(){return Ln},VzW:function(){return Te},W2J:function(){return ln},WMw:function(){return b},WTc:function(){return Vi},WXh:function(){return sh},Wbm:function(){return C},WdD:function(){return qs},Wid:function(){return hh},Wjw:function(){return cf},Wl3:function(){return f},Wpd:function(){return U},Wqd:function(){return au},WwZ:function(){return Pt},Wzm:function(){return Fc},XZw:function(){return yf},Xaj:function(){return x},Xcj:function(){return ad},XvJ:function(){return rh},Y8D:function(){return Oe},YBo:function(){return gh},YGz:function(){return ee},YKA:function(){return At},YLQ:function(){return de},YN5:function(){return nf},YT8:function(){return Yc},Ywn:function(){return lr},Z6B:function(){return gn},ZAu:function(){return gl},ZQ6:function(){return ru},ZRs:function(){return Xt},ZTh:function(){return vt},ZZA:function(){return Ch},Z_g:function(){return Nc},Zp0:function(){return yp},Zr5:function(){return G},ZzF:function(){return fr},Zzh:function(){return wd},_12:function(){return Ws},_3:function(){return sf},_AM:function(){return Xe},_C8:function(){return Sh},_Li:function(){return m},_MY:function(){return u},_YM:function(){return Ph},_YX:function(){return Td},_am:function(){return ks},_fP:function(){return ur},_iA:function(){return h},_kC:function(){return $h},_lf:function(){return Mt},_sL:function(){return Tt},a$l:function(){return Ki},aCh:function(){return jt},aH4:function(){return me},aLr:function(){return Rr},aNw:function(){return Vh},aVm:function(){return Qi},ad5:function(){return Qt},anP:function(){return ho},aq0:function(){return Ld},av9:function(){return ze},b5g:function(){return Cl},bBp:function(){return sd},bGH:function(){return E},b_z:function(){return du},bdR:function(){return y},blk:function(){return Tc},bnF:function(){return Au},brP:function(){return Ue},bsb:function(){return mt},c8b:function(){return D},cBI:function(){return jd},cBK:function(){return Kh},cJO:function(){return Ju},cLu:function(){return De},cPb:function(){return Rs},cRx:function(){return Le},cU9:function(){return Dh},ce8:function(){return qt},cek:function(){return hp},cum:function(){return an},dSO:function(){return oe},dUE:function(){return Bh},dYG:function(){return Mh},dZ3:function(){return ne},dd2:function(){return ir},dj0:function(){return cn},dpR:function(){return Zh},dwk:function(){return d},e62:function(){return Yi},eD:function(){return H},eMJ:function(){return Zt},eaV:function(){return Ke},ehD:function(){return g},ejS:function(){return Mc},ekQ:function(){return et},epp:function(){return Kn},fHI:function(){return pu},fO1:function(){return Lc},fQA:function(){return Wd},fQK:function(){return fl},fSK:function(){return O},fY$:function(){return ie},fto:function(){return Ze},g8_:function(){return le},gH0:function(){return ud},gSk:function(){return It},g_z:function(){return tu},ghN:function(){return I},gi4:function(){return it},gti:function(){return su},hEm:function(){return Ne},hH6:function(){return Wh},iAb:function(){return Ee},iDF:function(){return Wu},iKG:function(){return ro},iLg:function(){return Oh},iMs:function(){return dd},iUV:function(){return rd},iWC:function(){return R},iWj:function(){return Vs},i_9:function(){return Pp},iiP:function(){return dt},irR:function(){return Pe},j4z:function(){return on},j87:function(){return qi},jAl:function(){return bt},jFi:function(){return v},jZA:function(){return nt},jfJ:function(){return Yt},jwo:function(){return tn},jyi:function(){return Wl},jyz:function(){return Is},k0A:function(){return Ie},k74:function(){return B},kB5:function(){return Pl},kFz:function(){return cr},kaV:function(){return _h},knz:function(){return Ot},kqm:function(){return Yp},ksN:function(){return Q},l0P:function(){return $e},l8J:function(){return mn},lCJ:function(){return Xi},lDi:function(){return gp},lGU:function(){return yt},lLk:function(){return zh},lRF:function(){return cl},lRj:function(){return ye},lb7:function(){return cc},lfu:function(){return Th},lk7:function(){return _p},m7l:function(){return Uh},mSO:function(){return Ft},mTL:function(){return Dp},mXe:function(){return iu},m_w:function(){return of},mzJ:function(){return id},nls:function(){return vc},ntZ:function(){return p},ntt:function(){return Vt},nvb:function(){return tf},o8S:function(){return $u},oAp:function(){return Ls},oa8:function(){return eh},oqc:function(){return Kt},p3g:function(){return sr},p7y:function(){return cu},pBf:function(){return bn},pIN:function(){return Ct},pKu:function(){return ct},pQR:function(){return Zu},ptH:function(){return tt},qhX:function(){return Y},qkB:function(){return Fe},qlB:function(){return Wi},qyh:function(){return ve},rAo:function(){return Hi},rBU:function(){return Xs},rDY:function(){return Ds},rOj:function(){return S},r_:function(){return M},rnI:function(){return kt},rpg:function(){return ce},s4_:function(){return Ap},sYA:function(){return qh},tEQ:function(){return Gh},tGC:function(){return Zd},tJx:function(){return Xd},tUh:function(){return Ih},tf:function(){return Kp},tm_:function(){return a},trn:function(){return rf},u37:function(){return Op},u7G:function(){return vp},u9r:function(){return ss},uEv:function(){return wt},uL9:function(){return J},uWy:function(){return ue},uXU:function(){return en},ub3:function(){return _},ujx:function(){return df},v3W:function(){return We},v9Y:function(){return _n},vBJ:function(){return ki},vCF:function(){return V},vCx:function(){return Ye},vZf:function(){return ge},vmT:function(){return ep},vpT:function(){return Dl},vuL:function(){return _t},vxC:function(){return se},w$m:function(){return W},wJv:function(){return Re},wem:function(){return _e},wk1:function(){return ke},woe:function(){return kc},wuA:function(){return He},x12:function(){return Ec},x5V:function(){return Wt},xEZ:function(){return nr},xG9:function(){return Id},xJs:function(){return lt},xWb:function(){return ld},xeV:function(){return Rl},xfE:function(){return re},xo$:function(){return th},xoR:function(){return dh},xsS:function(){return Tl},y$t:function(){return lu},y2t:function(){return rt},y8_:function(){return $d},yC1:function(){return Fh},yGw:function(){return zr},ybr:function(){return Ml},yj7:function(){return eu},ylh:function(){return pd},yo9:function(){return Sl},yt0:function(){return nn},ywz:function(){return we},yxD:function(){return Jh},z$h:function(){return Bt},z81:function(){return Lt},z8B:function(){return Kl},zHn:function(){return jr},zbs:function(){return kh},zf8:function(){return hu}});const r="152",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,u=0,h=1,p=2,d=3,f=0,m=1,g=2,_=2,v=0,y=1,b=2,A=3,w=4,x=5,E=100,C=101,S=102,M=103,T=104,D=200,I=201,P=202,R=203,B=204,k=205,O=206,L=207,F=208,U=209,N=210,j=0,z=1,G=2,V=3,H=4,Q=5,W=6,q=7,X=0,Y=1,K=2,J=0,Z=1,$=2,ee=3,te=4,ne=5,re=300,ie=301,se=302,oe=303,ae=304,le=306,ce=1e3,ue=1001,he=1002,pe=1003,de=1004,fe=1004,me=1005,ge=1005,_e=1006,ve=1007,ye=1007,be=1008,Ae=1008,we=1009,xe=1010,Ee=1011,Ce=1012,Se=1013,Me=1014,Te=1015,De=1016,Ie=1017,Pe=1018,Re=1020,Be=1021,ke=1023,Oe=1024,Le=1025,Fe=1026,Ue=1027,Ne=1028,je=1029,ze=1030,Ge=1031,Ve=1033,He=33776,Qe=33777,We=33778,qe=33779,Xe=35840,Ye=35841,Ke=35842,Je=35843,Ze=36196,$e=37492,et=37496,tt=37808,nt=37809,rt=37810,it=37811,st=37812,ot=37813,at=37814,lt=37815,ct=37816,ut=37817,ht=37818,pt=37819,dt=37820,ft=37821,mt=36492,gt=36283,_t=36284,vt=36285,yt=36286,bt=2200,At=2201,wt=2202,xt=2300,Et=2301,Ct=2302,St=2400,Mt=2401,Tt=2402,Dt=2500,It=2501,Pt=0,Rt=1,Bt=2,kt=3e3,Ot=3001,Lt=3200,Ft=3201,Ut=0,Nt=1,jt="",zt="srgb",Gt="srgb-linear",Vt="display-p3",Ht="rgbm-16",Qt=0,Wt=7680,qt=7681,Xt=7682,Yt=7683,Kt=34055,Jt=34056,Zt=5386,$t=512,en=513,tn=514,nn=515,rn=516,sn=517,on=518,an=519,ln=35044,cn=35048,un=35040,hn=35045,pn=35049,dn=35041,fn=35046,mn=35050,gn=35042,_n="100",vn="300 es",yn=1035;class bn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const An=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wn=1234567;const xn=Math.PI/180,En=180/Math.PI;function Cn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(An[255&e]+An[e>>8&255]+An[e>>16&255]+An[e>>24&255]+"-"+An[255&t]+An[t>>8&255]+"-"+An[t>>16&15|64]+An[t>>24&255]+"-"+An[63&n|128]+An[n>>8&255]+"-"+An[n>>16&255]+An[n>>24&255]+An[255&r]+An[r>>8&255]+An[r>>16&255]+An[r>>24&255]).toLowerCase()}function Sn(e,t,n){return Math.max(t,Math.min(n,e))}function Mn(e,t){return(e%t+t)%t}function Tn(e,t,n){return(1-n)*e+n*t}function Dn(e){return 0==(e&e-1)&&0!==e}function In(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Pn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Rn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Bn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const kn={DEG2RAD:xn,RAD2DEG:En,generateUUID:Cn,clamp:Sn,euclideanModulo:Mn,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Tn,damp:function(e,t,n,r){return Tn(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Mn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(wn=e);let t=wn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*xn},radToDeg:function(e){return e*En},isPowerOfTwo:Dn,ceilPowerOfTwo:In,floorPowerOfTwo:Pn,setQuaternionFromProperEuler:function(e,t,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((t+r)/2),u=o((t+r)/2),h=s((t-r)/2),p=o((t-r)/2),d=s((r-t)/2),f=o((r-t)/2);switch(i){case"XYX":e.set(a*u,l*h,l*p,a*c);break;case"YZY":e.set(l*p,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*p,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*d,a*c);break;case"YXY":e.set(l*d,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Bn,denormalize:Rn};class On{constructor(e=0,t=0){On.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*r+e.x,this.y=i*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ln{constructor(){Ln.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,i,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],g=r[6],_=r[1],v=r[4],y=r[7],b=r[2],A=r[5],w=r[8];return i[0]=s*f+o*_+a*b,i[3]=s*m+o*v+a*A,i[6]=s*g+o*y+a*w,i[1]=l*f+c*_+u*b,i[4]=l*m+c*v+u*A,i[7]=l*g+c*y+u*w,i[2]=h*f+p*_+d*b,i[5]=h*m+p*v+d*A,i[8]=h*g+p*y+d*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,h=o*a-c*i,p=l*i-s*a,d=t*u+n*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(o*n-r*s)*f,e[3]=h*f,e[4]=(c*t-r*a)*f,e[5]=(r*i-o*t)*f,e[6]=p*f,e[7]=(n*a-l*t)*f,e[8]=(s*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+e,-r*l,r*a,-r*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Fn.makeScale(e,t)),this}rotate(e){return this.premultiply(Fn.makeRotation(-e)),this}translate(e,t){return this.premultiply(Fn.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Fn=new Ln;function Un(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Nn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function jn(e,t){return new Nn[e](t)}function zn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const Gn={};function Vn(e){e in Gn||(Gn[e]=!0,console.warn(e))}function Hn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Qn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Wn=(new Ln).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),qn=(new Ln).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Xn={[Gt]:e=>e,[zt]:e=>e.convertSRGBToLinear(),[Vt]:function(e){return e.convertSRGBToLinear().applyMatrix3(qn)}},Yn={[Gt]:e=>e,[zt]:e=>e.convertLinearToSRGB(),[Vt]:function(e){return e.applyMatrix3(Wn).convertLinearToSRGB()}},Kn={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Gt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=Xn[t],i=Yn[n];if(void 0===r||void 0===i)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return i(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let Jn;class Zn{static getDataURL(e,t=!1){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===Jn&&(Jn=zn("canvas")),Jn.width=e.width,Jn.height=e.height;const t=Jn.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=Jn}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=zn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Hn(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Hn(t[e]/255)):t[e]=Hn(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class $n{constructor(e=null){this.isSource=!0,this.uuid=Cn(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(er(r[t].image)):e.push(er(r[t]))}else e=er(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function er(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return Zn.getDataURL(e);if(e.data){let t=[];try{t=Array.from(e.data)}catch(n){n.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(n),t=e.data}return{data:t,width:e.width,height:e.height,type:e.data.constructor.name}}return void 0!==e.url?e.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let tr=0;class nr extends bn{constructor(e=nr.DEFAULT_IMAGE,t=nr.DEFAULT_MAPPING,n=ue,r=ue,i=_e,s=be,o=ke,a=we,l=nr.DEFAULT_ANISOTROPY,c=jt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:tr++}),this.uuid=Cn(),this.name="",this.source=new $n(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new On(0,0),this.repeat=new On(1,1),this.center=new On(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ln,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(Vn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Ot?zt:jt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===zt?Ot:kt,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ce:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case he:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ce:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case he:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return Vn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===zt?Ot:kt}set encoding(e){Vn("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ot?zt:jt}}nr.DEFAULT_IMAGE=null,nr.DEFAULT_MAPPING=re,nr.DEFAULT_ANISOTROPY=1;class rr{constructor(e=0,t=0,n=0,r=1){rr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const s=.01,o=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],p=a[5],d=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<s&&Math.abs(u-f)<s&&Math.abs(d-m)<s){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(p+1)/2,_=(g+1)/2,v=(c+h)/4,y=(u+f)/4,b=(d+m)/4;return e>a&&e>_?e<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=y/n):a>_?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=b/r):_<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(_),n=y/i,r=b/i),this.set(n,r,i,t),this}let _=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-d)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ir extends bn{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new rr(0,0,e,t),this.scissorTest=!1,this.viewport=new rr(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==n.encoding&&(Vn("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Ot?zt:jt),this.texture=new nr(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:_e,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new $n(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class sr extends nr{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=pe,this.minFilter=pe,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class or extends ir{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new sr(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class ar extends nr{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=pe,this.minFilter=pe,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lr extends ir{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new ar(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class cr extends ir{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class ur{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[s+0],p=i[s+1],d=i[s+2],f=i[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=p,e[t+2]=d,void(e[t+3]=f);if(u!==f||a!==h||l!==p||c!==d){let e=1-o;const t=a*h+l*p+c*d+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,t*n);e=Math.sin(e*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*e+h*i,l=l*e+p*i,c=c*e+d*i,u=u*e+f*i,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],p=i[s+2],d=i[s+3];return e[t]=o*d+c*u+a*p-l*h,e[t+1]=a*d+c*h+l*u-o*p,e[t+2]=l*d+c*p+o*h-a*u,e[t+3]=c*d-o*u-a*h-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,i=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),p=a(r/2),d=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+o+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(i-l)*e,this._z=(s-r)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-a)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(i+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(i-l)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(s-r)/e,this._x=(i+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Sn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class hr{constructor(e=0,t=0,n=0){hr.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(dr.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dr.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*r-o*n,c=a*n+o*t-i*r,u=a*r+i*n-s*t,h=-i*t-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,a=t.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return pr.copy(this).projectOnVector(e),this.sub(pr)}reflect(e){return this.sub(pr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pr=new hr,dr=new ur;class fr{constructor(e=new hr(1/0,1/0,1/0),t=new hr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(gr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(gr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=gr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),_r.copy(e.boundingBox),_r.applyMatrix4(e.matrixWorld),this.union(_r);else{const n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,r=t.count;n<r;n++)gr.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(gr)}else null===n.boundingBox&&n.computeBoundingBox(),_r.copy(n.boundingBox),_r.applyMatrix4(e.matrixWorld),this.union(_r)}const n=e.children;for(let e=0,r=n.length;e<r;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,gr),gr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Er),Cr.subVectors(this.max,Er),vr.subVectors(e.a,Er),yr.subVectors(e.b,Er),br.subVectors(e.c,Er),Ar.subVectors(yr,vr),wr.subVectors(br,yr),xr.subVectors(vr,br);let t=[0,-Ar.z,Ar.y,0,-wr.z,wr.y,0,-xr.z,xr.y,Ar.z,0,-Ar.x,wr.z,0,-wr.x,xr.z,0,-xr.x,-Ar.y,Ar.x,0,-wr.y,wr.x,0,-xr.y,xr.x,0];return!!Tr(t,vr,yr,br,Cr)&&(t=[1,0,0,0,1,0,0,0,1],!!Tr(t,vr,yr,br,Cr)&&(Sr.crossVectors(Ar,wr),t=[Sr.x,Sr.y,Sr.z],Tr(t,vr,yr,br,Cr)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,gr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(gr).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(mr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),mr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),mr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),mr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),mr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),mr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),mr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),mr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(mr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const mr=[new hr,new hr,new hr,new hr,new hr,new hr,new hr,new hr],gr=new hr,_r=new fr,vr=new hr,yr=new hr,br=new hr,Ar=new hr,wr=new hr,xr=new hr,Er=new hr,Cr=new hr,Sr=new hr,Mr=new hr;function Tr(e,t,n,r,i){for(let s=0,o=e.length-3;s<=o;s+=3){Mr.fromArray(e,s);const o=i.x*Math.abs(Mr.x)+i.y*Math.abs(Mr.y)+i.z*Math.abs(Mr.z),a=t.dot(Mr),l=n.dot(Mr),c=r.dot(Mr);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Dr=new fr,Ir=new hr,Pr=new hr;class Rr{constructor(e=new hr,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Dr.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ir.subVectors(e,this.center);const t=Ir.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Ir,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Pr.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ir.copy(e.center).add(Pr)),this.expandByPoint(Ir.copy(e.center).sub(Pr))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Br=new hr,kr=new hr,Or=new hr,Lr=new hr,Fr=new hr,Ur=new hr,Nr=new hr;class jr{constructor(e=new hr,t=new hr(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Br)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Br.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Br.copy(this.origin).addScaledVector(this.direction,t),Br.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){kr.copy(e).add(t).multiplyScalar(.5),Or.copy(t).sub(e).normalize(),Lr.copy(this.origin).sub(kr);const i=.5*e.distanceTo(t),s=-this.direction.dot(Or),o=Lr.dot(this.direction),a=-Lr.dot(Or),l=Lr.lengthSq(),c=Math.abs(1-s*s);let u,h,p,d;if(c>0)if(u=s*a-o,h=s*o-a,d=i*c,u>=0)if(h>=-d)if(h<=d){const e=1/c;u*=e,h*=e,p=u*(u+s*h+2*o)+h*(s*u+h+2*a)+l}else h=i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;else h<=-d?(u=Math.max(0,-(-s*i+o)),h=u>0?-i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l):h<=d?(u=0,h=Math.min(Math.max(-i,-a),i),p=h*(h+2*a)+l):(u=Math.max(0,-(s*i+o)),h=u>0?i:Math.min(Math.max(-i,-a),i),p=-u*u+h*(h+2*a)+l);else h=s>0?-i:i,u=Math.max(0,-(s*h+o)),p=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(kr).addScaledVector(Or,h),p}intersectSphere(e,t){Br.subVectors(e.center,this.origin);const n=Br.dot(this.direction),r=Br.dot(Br)-n*n,i=e.radius*e.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),u>=0?(o=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Br)}intersectTriangle(e,t,n,r,i){Fr.subVectors(t,e),Ur.subVectors(n,e),Nr.crossVectors(Fr,Ur);let s,o=this.direction.dot(Nr);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Lr.subVectors(this.origin,e);const a=s*this.direction.dot(Ur.crossVectors(Lr,Ur));if(a<0)return null;const l=s*this.direction.dot(Fr.cross(Lr));if(l<0)return null;if(a+l>o)return null;const c=-s*Lr.dot(Nr);return c<0?null:this.at(c/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class zr{constructor(){zr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,r,i,s,o,a,l,c,u,h,p,d,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new zr).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Gr.setFromMatrixColumn(e,0).length(),i=1/Gr.setFromMatrixColumn(e,1).length(),s=1/Gr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=s*c,n=s*u,r=o*c,i=o*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-o*a,t[2]=i-e*l,t[6]=r+n*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e+i*o,t[4]=r*o-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e-i*o,t[4]=-s*u,t[8]=r+n*o,t[1]=n+r*o,t[5]=s*c,t[9]=i-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,n=s*u,r=o*c,i=o*u;t[0]=a*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=a*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,n=s*l,r=o*a,i=o*l;t[0]=a*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=s*a,n=s*l,r=o*a,i=o*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=s*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=o*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Hr,e,Qr)}lookAt(e,t,n){const r=this.elements;return Xr.subVectors(e,t),0===Xr.lengthSq()&&(Xr.z=1),Xr.normalize(),Wr.crossVectors(n,Xr),0===Wr.lengthSq()&&(1===Math.abs(n.z)?Xr.x+=1e-4:Xr.z+=1e-4,Xr.normalize(),Wr.crossVectors(n,Xr)),Wr.normalize(),qr.crossVectors(Xr,Wr),r[0]=Wr.x,r[4]=qr.x,r[8]=Xr.x,r[1]=Wr.y,r[5]=qr.y,r[9]=Xr.y,r[2]=Wr.z,r[6]=qr.z,r[10]=Xr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],A=r[0],w=r[4],x=r[8],E=r[12],C=r[1],S=r[5],M=r[9],T=r[13],D=r[2],I=r[6],P=r[10],R=r[14],B=r[3],k=r[7],O=r[11],L=r[15];return i[0]=s*A+o*C+a*D+l*B,i[4]=s*w+o*S+a*I+l*k,i[8]=s*x+o*M+a*P+l*O,i[12]=s*E+o*T+a*R+l*L,i[1]=c*A+u*C+h*D+p*B,i[5]=c*w+u*S+h*I+p*k,i[9]=c*x+u*M+h*P+p*O,i[13]=c*E+u*T+h*R+p*L,i[2]=d*A+f*C+m*D+g*B,i[6]=d*w+f*S+m*I+g*k,i[10]=d*x+f*M+m*P+g*O,i[14]=d*E+f*T+m*R+g*L,i[3]=_*A+v*C+y*D+b*B,i[7]=_*w+v*S+y*I+b*k,i[11]=_*x+v*M+y*P+b*O,i[15]=_*E+v*T+y*R+b*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*p-n*a*p)+e[7]*(+t*a*p-t*l*h+i*s*h-r*s*p+r*l*c-i*a*c)+e[11]*(+t*l*u-t*o*p-i*s*u+n*s*p+i*o*c-n*l*c)+e[15]*(-r*o*c-t*a*u+t*o*h+r*s*u-n*s*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*a*p-o*m*p-u*a*g+o*h*g,v=d*h*l-c*m*l-d*a*p+s*m*p+c*a*g-s*h*g,y=c*f*l-d*u*l+d*o*p-s*f*p-c*o*g+s*u*g,b=d*u*a-c*f*a-d*o*h+s*f*h+c*o*m-s*u*m,A=t*_+n*v+r*y+i*b;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/A;return e[0]=_*w,e[1]=(f*h*i-u*m*i-f*r*p+n*m*p+u*r*g-n*h*g)*w,e[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,e[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*p-n*a*p)*w,e[4]=v*w,e[5]=(c*m*i-d*h*i+d*r*p-t*m*p-c*r*g+t*h*g)*w,e[6]=(d*a*i-s*m*i-d*r*l+t*m*l+s*r*g-t*a*g)*w,e[7]=(s*h*i-c*a*i+c*r*l-t*h*l-s*r*p+t*a*p)*w,e[8]=y*w,e[9]=(d*u*i-c*f*i-d*n*p+t*f*p+c*n*g-t*u*g)*w,e[10]=(s*f*i-d*o*i+d*n*l-t*f*l-s*n*g+t*o*g)*w,e[11]=(c*o*i-s*u*i-c*n*l+t*u*l+s*n*p-t*o*p)*w,e[12]=b*w,e[13]=(c*f*r-d*u*r+d*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(d*o*r-s*f*r-d*n*a+t*f*a+s*n*m-t*o*m)*w,e[15]=(s*u*r-c*o*r+c*n*a-t*u*a-s*n*h+t*o*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,a=e.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,s){return this.set(1,n,i,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,s=t._y,o=t._z,a=t._w,l=i+i,c=s+s,u=o+o,h=i*l,p=i*c,d=i*u,f=s*c,m=s*u,g=o*u,_=a*l,v=a*c,y=a*u,b=n.x,A=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(p+y)*b,r[2]=(d-v)*b,r[3]=0,r[4]=(p-y)*A,r[5]=(1-(h+g))*A,r[6]=(m+_)*A,r[7]=0,r[8]=(d+v)*w,r[9]=(m-_)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Gr.set(r[0],r[1],r[2]).length();const s=Gr.set(r[4],r[5],r[6]).length(),o=Gr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Vr.copy(this);const a=1/i,l=1/s,c=1/o;return Vr.elements[0]*=a,Vr.elements[1]*=a,Vr.elements[2]*=a,Vr.elements[4]*=l,Vr.elements[5]*=l,Vr.elements[6]*=l,Vr.elements[8]*=c,Vr.elements[9]*=c,Vr.elements[10]*=c,t.setFromRotationMatrix(Vr),n.x=i,n.y=s,n.z=o,this}makePerspective(e,t,n,r,i,s){const o=this.elements,a=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(s+i)/(s-i),p=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,s){const o=this.elements,a=1/(t-e),l=1/(n-r),c=1/(s-i),u=(t+e)*a,h=(n+r)*l,p=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Gr=new hr,Vr=new zr,Hr=new hr(0,0,0),Qr=new hr(1,1,1),Wr=new hr,qr=new hr,Xr=new hr,Yr=new zr,Kr=new ur;class Jr{constructor(e=0,t=0,n=0,r=Jr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],p=r[10];switch(t){case"XYZ":this._y=Math.asin(Sn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Sn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Sn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Sn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Sn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Sn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Yr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Yr,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Kr.setFromEuler(this),this.setFromQuaternion(Kr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Jr.DEFAULT_ORDER="XYZ";class Zr{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let $r=0;const ei=new hr,ti=new ur,ni=new zr,ri=new hr,ii=new hr,si=new hr,oi=new ur,ai=new hr(1,0,0),li=new hr(0,1,0),ci=new hr(0,0,1),ui={type:"added"},hi={type:"removed"};class pi extends bn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:$r++}),this.uuid=Cn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pi.DEFAULT_UP.clone();const e=new hr,t=new Jr,n=new ur,r=new hr(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new zr},normalMatrix:{value:new Ln}}),this.matrix=new zr,this.matrixWorld=new zr,this.matrixAutoUpdate=pi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Zr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,t,n,r,i,s){this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,material:i,group:s})}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ti.setFromAxisAngle(e,t),this.quaternion.multiply(ti),this}rotateOnWorldAxis(e,t){return ti.setFromAxisAngle(e,t),this.quaternion.premultiply(ti),this}rotateX(e){return this.rotateOnAxis(ai,e)}rotateY(e){return this.rotateOnAxis(li,e)}rotateZ(e){return this.rotateOnAxis(ci,e)}translateOnAxis(e,t){return ei.copy(e).applyQuaternion(this.quaternion),this.position.add(ei.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ai,e)}translateY(e){return this.translateOnAxis(li,e)}translateZ(e){return this.translateOnAxis(ci,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ni.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ri.copy(e):ri.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ii.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ni.lookAt(ii,ri,this.up):ni.lookAt(ri,ii,this.up),this.quaternion.setFromRotationMatrix(ni),r&&(ni.extractRotation(r.matrixWorld),ti.setFromRotationMatrix(ni),this.quaternion.premultiply(ti.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ui)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(hi)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(hi)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ni.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ni.multiply(e.parent.matrixWorld)),e.applyMatrix4(ni),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ii,e,si),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ii,oi,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=s(e.geometries),r=s(e.materials),i=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[t,n]of Object.entries(e.userData))this.userData[t]=!n||n&&(n.isTexture||n.isObject3D)?n:JSON.parse(JSON.stringify(n));if(!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}pi.DEFAULT_UP=new hr(0,1,0),pi.DEFAULT_MATRIX_AUTO_UPDATE=!0,pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const di=new hr,fi=new hr,mi=new hr,gi=new hr,_i=new hr,vi=new hr,yi=new hr,bi=new hr,Ai=new hr,wi=new hr;let xi=!1;class Ei{constructor(e=new hr,t=new hr,n=new hr){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),di.subVectors(e,t),r.cross(di);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){di.subVectors(r,t),fi.subVectors(n,t),mi.subVectors(e,t);const s=di.dot(di),o=di.dot(fi),a=di.dot(mi),l=fi.dot(fi),c=fi.dot(mi),u=s*l-o*o;if(0===u)return i.set(-2,-1,-1);const h=1/u,p=(l*a-o*c)*h,d=(s*c-o*a)*h;return i.set(1-p-d,d,p)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,gi),gi.x>=0&&gi.y>=0&&gi.x+gi.y<=1}static getUV(e,t,n,r,i,s,o,a){return!1===xi&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),xi=!0),this.getInterpolation(e,t,n,r,i,s,o,a)}static getInterpolation(e,t,n,r,i,s,o,a){return this.getBarycoord(e,t,n,r,gi),a.setScalar(0),a.addScaledVector(i,gi.x),a.addScaledVector(s,gi.y),a.addScaledVector(o,gi.z),a}static isFrontFacing(e,t,n,r){return di.subVectors(n,t),fi.subVectors(e,t),di.cross(fi).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return di.subVectors(this.c,this.b),fi.subVectors(this.a,this.b),.5*di.cross(fi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ei.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ei.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return!1===xi&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),xi=!0),Ei.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}getInterpolation(e,t,n,r,i){return Ei.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Ei.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ei.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let s,o;_i.subVectors(r,n),vi.subVectors(i,n),bi.subVectors(e,n);const a=_i.dot(bi),l=vi.dot(bi);if(a<=0&&l<=0)return t.copy(n);Ai.subVectors(e,r);const c=_i.dot(Ai),u=vi.dot(Ai);if(c>=0&&u<=c)return t.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(n).addScaledVector(_i,s);wi.subVectors(e,i);const p=_i.dot(wi),d=vi.dot(wi);if(d>=0&&p<=d)return t.copy(i);const f=p*l-a*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),t.copy(n).addScaledVector(vi,o);const m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return yi.subVectors(i,r),o=(u-c)/(u-c+(p-d)),t.copy(r).addScaledVector(yi,o);const g=1/(m+f+h);return s=f*g,o=h*g,t.copy(n).addScaledVector(_i,s).addScaledVector(vi,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ci=0;class Si extends bn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ci++}),this.uuid=Cn(),this.name="",this.type="Material",this.blending=y,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=B,this.blendDst=k,this.blendEquation=E,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=an,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wt,this.stencilZFail=Wt,this.stencilZPass=Wt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r&&(r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):Array.isArray(n)&&r&&"function"==typeof r.fromArray?r.fromArray(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=Mi({},e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}function Mi(e,t){if(!t)return e;for(const n of Object.keys(t)){if(n.startsWith("__"))continue;if("function"==typeof e[n]||"function"==typeof t[n])continue;const r=t[n],i=!r||r.isTexture||r.isObject3D||r.isMaterial;i||"function"!=typeof t[n].clone?i||"object"!=typeof t[n]&&!Array.isArray(t[n])?e[n]=t[n]:e[n]=Mi(Array.isArray(t[n])?[]:{},t[n]):e[n]=t[n].clone()}return e}const Ti={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},Ii={h:0,s:0,l:0};function Pi(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Ri{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=zt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Kn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Kn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Kn.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Kn.workingColorSpace){if(e=Mn(e,1),t=Sn(t,0,1),n=Sn(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Pi(i,r,e+1/3),this.g=Pi(i,r,e),this.b=Pi(i,r,e-1/3)}return Kn.toWorkingColorSpace(this,r),this}setStyle(e,t=zt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=zt){const n=Ti[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Hn(e.r),this.g=Hn(e.g),this.b=Hn(e.b),this}copyLinearToSRGB(e){return this.r=Qn(e.r),this.g=Qn(e.g),this.b=Qn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=zt){return Kn.fromWorkingColorSpace(Bi.copy(this),e),65536*Math.round(Sn(255*Bi.r,0,255))+256*Math.round(Sn(255*Bi.g,0,255))+Math.round(Sn(255*Bi.b,0,255))}getHexString(e=zt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Kn.workingColorSpace){Kn.fromWorkingColorSpace(Bi.copy(this),t);const n=Bi.r,r=Bi.g,i=Bi.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case n:a=(r-i)/e+(r<i?6:0);break;case r:a=(i-n)/e+2;break;case i:a=(n-r)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=Kn.workingColorSpace){return Kn.fromWorkingColorSpace(Bi.copy(this),t),e.r=Bi.r,e.g=Bi.g,e.b=Bi.b,e}getStyle(e=zt){Kn.fromWorkingColorSpace(Bi.copy(this),e);const t=Bi.r,n=Bi.g,r=Bi.b;return e!==zt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(Di),Di.h+=e,Di.s+=t,Di.l+=n,this.setHSL(Di.h,Di.s,Di.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Di),e.getHSL(Ii);const n=Tn(Di.h,Ii.h,t),r=Tn(Di.s,Ii.s,t),i=Tn(Di.l,Ii.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Bi=new Ri;Ri.NAMES=Ti;class ki extends Si{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Oi=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=1199570944,o[32]=2147483648;for(let e=33;e<63;++e)o[e]=2147483648+(e-32<<23);o[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(a[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:a}}();function Li(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Sn(e,-65504,65504),Oi.floatView[0]=e;const t=Oi.uint32View[0],n=t>>23&511;return Oi.baseTable[n]+((8388607&t)>>Oi.shiftTable[n])}function Fi(e){const t=e>>10;return Oi.uint32View[0]=Oi.mantissaTable[Oi.offsetTable[t]+(1023&e)]+Oi.exponentTable[t],Oi.floatView[0]}const Ui={toHalfFloat:Li,fromHalfFloat:Fi},Ni=new hr,ji=new On;class zi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=ln,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ji.fromBufferAttribute(this,t),ji.applyMatrix3(e),this.setXY(t,ji.x,ji.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ni.fromBufferAttribute(this,t),Ni.applyMatrix3(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ni.fromBufferAttribute(this,t),Ni.applyMatrix4(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ni.fromBufferAttribute(this,t),Ni.applyNormalMatrix(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ni.fromBufferAttribute(this,t),Ni.transformDirection(e),this.setXYZ(t,Ni.x,Ni.y,Ni.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Rn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Rn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Rn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Rn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array),i=Bn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ln&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Gi extends zi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Vi extends zi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Hi extends zi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Qi extends zi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Wi extends zi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class qi extends zi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Xi extends zi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Yi extends zi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Fi(this.array[e*this.itemSize]);return this.normalized&&(t=Rn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize]=Li(t),this}getY(e){let t=Fi(this.array[e*this.itemSize+1]);return this.normalized&&(t=Rn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+1]=Li(t),this}getZ(e){let t=Fi(this.array[e*this.itemSize+2]);return this.normalized&&(t=Rn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+2]=Li(t),this}getW(e){let t=Fi(this.array[e*this.itemSize+3]);return this.normalized&&(t=Rn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Bn(t,this.array)),this.array[e*this.itemSize+3]=Li(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array)),this.array[e+0]=Li(t),this.array[e+1]=Li(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array)),this.array[e+0]=Li(t),this.array[e+1]=Li(n),this.array[e+2]=Li(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array),i=Bn(i,this.array)),this.array[e+0]=Li(t),this.array[e+1]=Li(n),this.array[e+2]=Li(r),this.array[e+3]=Li(i),this}}class Ki extends zi{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Ji extends zi{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Zi=0;const $i=new zr,es=new pi,ts=new hr,ns=new fr,rs=new fr,is=new hr;class ss extends bn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Zi++}),this.uuid=Cn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Un(e)?Xi:Wi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ln).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return $i.makeRotationFromQuaternion(e),this.applyMatrix4($i),this}rotateX(e){return $i.makeRotationX(e),this.applyMatrix4($i),this}rotateY(e){return $i.makeRotationY(e),this.applyMatrix4($i),this}rotateZ(e){return $i.makeRotationZ(e),this.applyMatrix4($i),this}translate(e,t,n){return $i.makeTranslation(e,t,n),this.applyMatrix4($i),this}scale(e,t,n){return $i.makeScale(e,t,n),this.applyMatrix4($i),this}lookAt(e){return es.lookAt(e),es.updateMatrix(),this.applyMatrix4(es.matrix),this}center(e=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(ts).negate(),this.translate(ts.x,ts.y,ts.z),e&&e.copy(ts),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ki(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new fr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new hr(-1/0,-1/0,-1/0),new hr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ns.setFromBufferAttribute(n),this.morphTargetsRelative?(is.addVectors(this.boundingBox.min,ns.min),this.boundingBox.expandByPoint(is),is.addVectors(this.boundingBox.max,ns.max),this.boundingBox.expandByPoint(is)):(this.boundingBox.expandByPoint(ns.min),this.boundingBox.expandByPoint(ns.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Rr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new hr,1/0);if(e){const n=this.boundingSphere.center;if(ns.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];rs.setFromBufferAttribute(n),this.morphTargetsRelative?(is.addVectors(ns.min,rs.min),ns.expandByPoint(is),is.addVectors(ns.max,rs.max),ns.expandByPoint(is)):(ns.expandByPoint(rs.min),ns.expandByPoint(rs.max))}ns.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)is.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(is));if(t)for(let i=0,s=t.length;i<s;i++){const s=t[i],o=this.morphTargetsRelative;for(let t=0,i=s.count;t<i;t++)is.fromBufferAttribute(s,t),o&&(ts.fromBufferAttribute(e,t),is.add(ts)),r=Math.max(r,n.distanceToSquared(is))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,s=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new zi(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new hr,c[e]=new hr;const u=new hr,h=new hr,p=new hr,d=new On,f=new On,m=new On,g=new hr,_=new hr;function v(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),p.fromArray(r,3*n),d.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*n),h.sub(u),p.sub(u),f.sub(d),m.sub(d);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(i),_.copy(p).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(_),c[t].add(_),c[n].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)v(n[e+0],n[e+1],n[e+2])}const b=new hr,A=new hr,w=new hr,x=new hr;function E(e){w.fromArray(i,3*e),x.copy(w);const t=l[e];b.copy(t),b.sub(w.multiplyScalar(w.dot(t))).normalize(),A.crossVectors(x,t);const n=A.dot(c[e])<0?-1:1;a[4*e]=b.x,a[4*e+1]=b.y,a[4*e+2]=b.z,a[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)E(n[e+0]),E(n[e+1]),E(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new zi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new hr,i=new hr,s=new hr,o=new hr,a=new hr,l=new hr,c=new hr,u=new hr;if(e)for(let h=0,p=e.count;h<p;h+=3){const p=e.getX(h+0),d=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,p),i.fromBufferAttribute(t,d),s.fromBufferAttribute(t,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,p),a.fromBufferAttribute(n,d),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)is.fromBufferAttribute(e,t),is.normalize(),e.setXYZ(t,is.x,is.y,is.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,s=new n.constructor(t.length*r);let o=0,a=0;for(let i=0,l=t.length;i<l;i++){o=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)s[a++]=n[o++]}return new zi(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ss,n=this.index.array,r=this.attributes;for(const i in r){const s=e(r[i],n);t.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);s.push(r)}t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];s.push(r.toJSON(e.data))}s.length>0&&(r[t]=s,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const os=new zr,as=new jr,ls=new Rr,cs=new hr,us=new hr,hs=new hr,ps=new hr,ds=new hr,fs=new hr,ms=new On,gs=new On,_s=new On,vs=new hr,ys=new hr,bs=new hr,As=new hr,ws=new hr;class xs extends pi{constructor(e=new ss,t=new ki){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.isMesh?(void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this):this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){fs.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(ds.fromBufferAttribute(a,e),s?fs.addScaledVector(ds,r):fs.addScaledVector(ds.sub(t),r))}t.add(fs)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),ls.copy(n.boundingSphere),ls.applyMatrix4(i),as.copy(e.ray).recast(e.near),!1===ls.containsPoint(as.origin)){if(null===as.intersectSphere(ls,cs))return;if(as.origin.distanceToSquared(cs)>(e.far-e.near)**2)return}os.copy(i).invert(),as.copy(e.ray).applyMatrix4(os),null!==n.boundingBox&&!1===as.intersectsBox(n.boundingBox)||this._computeIntersections(e,t)}}_computeIntersections(e,t){let n;const r=this.geometry,i=this.material,s=r.index,o=r.attributes.position,a=r.attributes.uv,l=r.attributes.uv1,c=r.attributes.normal,u=r.groups,h=r.drawRange;if(null!==s)if(Array.isArray(i))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=i[o.materialIndex];for(let r=Math.max(o.start,h.start),i=Math.min(s.count,Math.min(o.start+o.count,h.start+h.count));r<i;r+=3){const i=s.getX(r),u=s.getX(r+1),h=s.getX(r+2);n=Es(this,p,e,as,a,l,c,i,u,h),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=o.materialIndex,t.push(n))}}else for(let r=Math.max(0,h.start),o=Math.min(s.count,h.start+h.count);r<o;r+=3){const o=s.getX(r),u=s.getX(r+1),h=s.getX(r+2);n=Es(this,i,e,as,a,l,c,o,u,h),n&&(n.faceIndex=Math.floor(r/3),t.push(n))}else if(void 0!==o)if(Array.isArray(i))for(let r=0,s=u.length;r<s;r++){const s=u[r],p=i[s.materialIndex];for(let r=Math.max(s.start,h.start),i=Math.min(o.count,Math.min(s.start+s.count,h.start+h.count));r<i;r+=3)n=Es(this,p,e,as,a,l,c,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=s.materialIndex,t.push(n))}else for(let r=Math.max(0,h.start),s=Math.min(o.count,h.start+h.count);r<s;r+=3)n=Es(this,i,e,as,a,l,c,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),t.push(n))}}function Es(e,t,n,r,i,s,o,a,l,c){e.getVertexPosition(a,us),e.getVertexPosition(l,hs),e.getVertexPosition(c,ps);const u=function(e,t,n,r,i,s,o,a){let l;if(l=t.side===m?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,t.side===f,a),null===l)return null;ws.copy(a),ws.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(ws);return c<n.near||c>n.far?null:{distance:c,point:ws.clone(),object:e}}(e,t,n,r,us,hs,ps,As);if(u){i&&(ms.fromBufferAttribute(i,a),gs.fromBufferAttribute(i,l),_s.fromBufferAttribute(i,c),u.uv=Ei.getInterpolation(As,us,hs,ps,ms,gs,_s,new On)),s&&(ms.fromBufferAttribute(s,a),gs.fromBufferAttribute(s,l),_s.fromBufferAttribute(s,c),u.uv1=Ei.getInterpolation(As,us,hs,ps,ms,gs,_s,new On),u.uv2=u.uv1),o&&(vs.fromBufferAttribute(o,a),ys.fromBufferAttribute(o,l),bs.fromBufferAttribute(o,c),u.normal=Ei.getInterpolation(As,us,hs,ps,vs,ys,bs,new hr),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a,b:l,c,normal:new hr,materialIndex:0};Ei.getNormal(us,hs,ps,e.normal),u.face=e}return u}class Cs extends ss{constructor(e=1,t=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[];let h=0,p=0;function d(e,t,n,r,i,s,d,f,m,g,_){const v=s/m,y=d/g,b=s/2,A=d/2,w=f/2,x=m+1,E=g+1;let C=0,S=0;const M=new hr;for(let s=0;s<E;s++){const o=s*y-A;for(let a=0;a<x;a++){const h=a*v-b;M[e]=h*r,M[t]=o*i,M[n]=w,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-s/g),C+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+x*e,r=h+t+x*(e+1),i=h+(t+1)+x*(e+1),s=h+(t+1)+x*e;a.push(n,r,s),a.push(r,i,s),S+=6}o.addGroup(p,S,_),p+=S,h+=C}d("z","y","x",-1,-1,n,t,e,s,i,0),d("z","y","x",1,-1,n,t,-e,s,i,1),d("x","z","y",1,1,e,n,t,r,s,2),d("x","z","y",1,-1,e,n,-t,r,s,3),d("x","y","z",1,-1,e,t,n,r,i,4),d("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Ki(l,3)),this.setAttribute("normal",new Ki(c,3)),this.setAttribute("uv",new Ki(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cs(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ss(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Ms(e){const t={};for(let n=0;n<e.length;n++){const r=Ss(e[n]);for(const e in r)t[e]=r[e]}return t}function Ts(e){return null===e.getRenderTarget()?e.outputColorSpace:Gt}const Ds={clone:Ss,merge:Ms};class Is extends Si{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ss(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Ps extends pi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zr,this.projectionMatrix=new zr,this.projectionMatrixInverse=new zr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Rs extends Ps{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*En*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*xn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*En*Math.atan(Math.tan(.5*xn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*xn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/e,t-=s.offsetY*n/o,r*=s.width/e,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Bs=-90;class ks extends pi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const r=new Rs(Bs,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const i=new Rs(Bs,1,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(-1,0,0),this.add(i);const s=new Rs(Bs,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);const o=new Rs(Bs,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const a=new Rs(Bs,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);const l=new Rs(Bs,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,s,o,a,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=J,e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class Os extends nr{constructor(e,t,n,r,i,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ie,n,r,i,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ls extends ir{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];void 0!==t.encoding&&(Vn("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ot?zt:jt),this.texture=new Os(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_e}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n=new Cs(5,5,5),r=new Is({name:"CubemapFromEquirect",uniforms:Ss({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:m,blending:v});r.uniforms.tEquirect.value=t;const i=new xs(n,r),s=t.minFilter;return t.minFilter===be&&(t.minFilter=_e),new ks(1,10,this).update(e,i),t.minFilter=s,i.geometry.dispose(),i.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const Fs=new hr,Us=new hr,Ns=new Ln;class js{constructor(e=new hr(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Fs.subVectors(n,t).cross(Us.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Fs),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Ns.getNormalMatrix(e),r=this.coplanarPoint(Fs).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const zs=new Rr,Gs=new hr;class Vs{constructor(e=new js,t=new js,n=new js,r=new js,i=new js,s=new js){this.planes=[e,t,n,r,i,s]}set(e,t,n,r,i,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],g=n[13],_=n[14],v=n[15];return t[0].setComponents(o-r,u-a,f-h,v-m).normalize(),t[1].setComponents(o+r,u+a,f+h,v+m).normalize(),t[2].setComponents(o+i,u+l,f+p,v+g).normalize(),t[3].setComponents(o-i,u-l,f-p,v-g).normalize(),t[4].setComponents(o-s,u-c,f-d,v-_).normalize(),t[5].setComponents(o+s,u+c,f+d,v+_).normalize(),this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),zs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),zs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(zs)}intersectsSprite(e){return zs.center.set(0,0,0),zs.radius=.7071067811865476,zs.applyMatrix4(e.matrixWorld),this.intersectsSphere(zs)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Gs.x=r.normal.x>0?e.max.x:e.min.x,Gs.y=r.normal.y>0?e.max.y:e.min.y,Gs.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Gs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Hs(){let e=null,t=!1,n=null,r=null;function i(t,s){n(t,s),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Qs(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=r.get(t);void 0===s?r.set(t,function(t,r){const i=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(r,o),e.bufferData(r,i,s),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):s.version<t.version&&(function(t,r,i){const s=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,s):(n?e.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(s.buffer,t,i),s.version=t.version)}}}class Ws extends ss{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,s=t/2,o=Math.floor(n),a=Math.floor(r),l=o+1,c=a+1,u=e/o,h=t/a,p=[],d=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-s;for(let n=0;n<l;n++){const r=n*u-i;d.push(r,-t,0),f.push(0,0,1),m.push(n/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),s=t+1+l*e;p.push(n,r,s),p.push(r,i,s)}this.setIndex(p),this.setAttribute("position",new Ki(d,3)),this.setAttribute("normal",new Ki(f,3)),this.setAttribute("uv",new Ki(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ws(e.width,e.height,e.widthSegments,e.heightSegments)}}const qs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\t#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1\n\tdiffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;\n\t#else\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n\t#endif\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\treflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tmat4 rotationMatrix(vec3 axis, float angle) {\n\t\taxis = normalize(axis);\n\t\tfloat s = sin(angle);\n\t\tfloat c = cos(angle);\n\t\tfloat oc = 1.0 - c;\n\t\treturn mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n\t\t\t\t\toc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n\t\t\t\t\toc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n\t\t\t\t\t0.0,                                0.0,                                0.0,                                1.0);\n\t}\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform float envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t#if defined( FIX_ENV_DIRECTION )\n\t\t\tvec3 worldNormal = normal;\n\t\t#else\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#endif\n\t\t\tworldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#if !defined( FIX_ENV_DIRECTION )\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\t#endif\n\t\t\treflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_NORMALMAP_TANGENTSPACE\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\ndiffuseColor.a = min(max(diffuseColor.a, 0.), 1.);\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\t#ifndef WebGL2Context\n\t#define textureLod texture2DLodEXT\n\t#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))\n\t#define isinf(x) (x > 1e20 || x < -1e20)\n\t#endif\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tif(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"#ifdef HAS_TEXTURE\nvarying vec2 vUv;\nuniform mat3 uvTransform;\nuniform bool flipX;\nuniform bool flipY;\n#endif\nvoid main() {\n#ifdef HAS_TEXTURE\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;\n    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;\n#endif\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"#ifdef HAS_TEXTURE\nuniform sampler2D t2D;\nvarying vec2 vUv;\n#endif\nuniform float backgroundIntensity;\nuniform vec3 backgroundColor;\nvoid main() {\n#ifdef HAS_TEXTURE\n\tvec4 texColor = texture2D( t2D, vUv );\n#else\n\tvec4 texColor = vec4( 1.0 );\n#endif\n\ttexColor.rgb *= backgroundColor * backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#include <envmap_common_pars_fragment>\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\tvReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\ttexColor.rgb *= envMapIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Xs={common:{diffuse:{value:new Ri(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ln}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ln}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ln}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ln},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ln},normalScale:{value:new On(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ln},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ln}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ln}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ln}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ri(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ri(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ln}},sprite:{diffuse:{value:new Ri(16777215)},opacity:{value:1},center:{value:new On(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaTest:{value:0}}},Ys={basic:{uniforms:Ms([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.fog]),vertexShader:qs.meshbasic_vert,fragmentShader:qs.meshbasic_frag},lambert:{uniforms:Ms([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.fog,Xs.lights,{emissive:{value:new Ri(0)}}]),vertexShader:qs.meshlambert_vert,fragmentShader:qs.meshlambert_frag},phong:{uniforms:Ms([Xs.common,Xs.specularmap,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.fog,Xs.lights,{emissive:{value:new Ri(0)},specular:{value:new Ri(1118481)},shininess:{value:30}}]),vertexShader:qs.meshphong_vert,fragmentShader:qs.meshphong_frag},standard:{uniforms:Ms([Xs.common,Xs.envmap,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.roughnessmap,Xs.metalnessmap,Xs.fog,Xs.lights,{emissive:{value:new Ri(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qs.meshphysical_vert,fragmentShader:qs.meshphysical_frag},toon:{uniforms:Ms([Xs.common,Xs.aomap,Xs.lightmap,Xs.emissivemap,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.gradientmap,Xs.fog,Xs.lights,{emissive:{value:new Ri(0)}}]),vertexShader:qs.meshtoon_vert,fragmentShader:qs.meshtoon_frag},matcap:{uniforms:Ms([Xs.common,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,Xs.fog,{matcap:{value:null}}]),vertexShader:qs.meshmatcap_vert,fragmentShader:qs.meshmatcap_frag},points:{uniforms:Ms([Xs.points,Xs.fog]),vertexShader:qs.points_vert,fragmentShader:qs.points_frag},dashed:{uniforms:Ms([Xs.common,Xs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qs.linedashed_vert,fragmentShader:qs.linedashed_frag},depth:{uniforms:Ms([Xs.common,Xs.displacementmap]),vertexShader:qs.depth_vert,fragmentShader:qs.depth_frag},normal:{uniforms:Ms([Xs.common,Xs.bumpmap,Xs.normalmap,Xs.displacementmap,{opacity:{value:1}}]),vertexShader:qs.meshnormal_vert,fragmentShader:qs.meshnormal_frag},sprite:{uniforms:Ms([Xs.sprite,Xs.fog]),vertexShader:qs.sprite_vert,fragmentShader:qs.sprite_frag},background:{uniforms:{uvTransform:{value:new Ln},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new Ri(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:qs.background_vert,fragmentShader:qs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:qs.backgroundCube_vert,fragmentShader:qs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qs.cube_vert,fragmentShader:qs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qs.equirect_vert,fragmentShader:qs.equirect_frag},distanceRGBA:{uniforms:Ms([Xs.common,Xs.displacementmap,{referencePosition:{value:new hr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qs.distanceRGBA_vert,fragmentShader:qs.distanceRGBA_frag},shadow:{uniforms:Ms([Xs.lights,Xs.fog,{color:{value:new Ri(0)},opacity:{value:1}}]),vertexShader:qs.shadow_vert,fragmentShader:qs.shadow_frag}};Ys.physical={uniforms:Ms([Ys.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ln},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ln},clearcoatNormalScale:{value:new On(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ln},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ln},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ln},sheen:{value:0},sheenColor:{value:new Ri(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ln},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ln},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ln},transmissionSamplerSize:{value:new On},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ln},attenuationDistance:{value:0},attenuationColor:{value:new Ri(0)},specularColor:{value:new Ri(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ln},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ln}}]),vertexShader:qs.meshphysical_vert,fragmentShader:qs.meshphysical_frag};const Ks={r:0,b:0,g:0};function Js(e,t,n,r,i,s,o){const a=new Ri(0);let l,c,u=!0===s?0:1,h=null,p=0,d=null;function g(t,n){t.getRGB(Ks,Ts(e)),r.buffers.color.setClear(Ks.r,Ks.g,Ks.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),u=t,g(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,g(a,u)},getPlaneMesh:function(){return l},getBoxMesh:function(){return c},getBoxMesh2:function(){return void 0===c&&(c=new xs(new Cs(1,1,1),new Is({name:"BackgroundCubeMaterial",uniforms:Ss(Ys.backgroundCube.uniforms),vertexShader:Ys.backgroundCube.vertexShader,fragmentShader:Ys.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c},render:function(s,_){let v=!1,y=!0===_.isScene?_.background:null;const b=_.isScene&&void 0!==_.backgroundColor?_.backgroundColor:null;switch("environment"===y&&(y=_.environment),y&&y.isTexture&&(y=(_.backgroundBlurriness>0?n:t).get(y)),null===y?g(a,u):y&&y.isColor&&(g(y,1),v=!0),e.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,o),v=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,o),v=!0}if((e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===le))void 0===c&&(c=new xs(new Cs(1,1,1),new Is({name:"BackgroundCubeMaterial",uniforms:Ss(Ys.backgroundCube.uniforms),vertexShader:Ys.backgroundCube.vertexShader,fragmentShader:Ys.backgroundCube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.envMapRotation.value=y&&y.rotation||0,c.material.uniforms.envMapIntensity.value=y===_.environment&&_.envMapIntensity||1,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.toneMapped=y.colorSpace!==zt,h===y&&p===y.version&&d===e.toneMapping||(c.material.needsUpdate=!0,h=y,p=y.version,d=e.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null);else if(y&&y.isTexture||!y&&b){void 0===l&&(l=new xs(new Ws(2,2),new Is({name:"BackgroundMaterial",uniforms:Ss(Ys.background.uniforms),vertexShader:Ys.background.vertexShader,fragmentShader:Ys.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.backgroundColor.value.set(b||16777215),l.material.uniforms.t2D.value=y,l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,y?(l.material.toneMapped=y.colorSpace!==zt,l.material.uniforms.flipX.value=y.userData.flipX||!1,l.material.uniforms.flipY.value=y.userData.flipY||!1,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),l.material.defines.HAS_TEXTURE="1"):l.material.defines.HAS_TEXTURE&&delete l.material.defines.HAS_TEXTURE;const t=y?y.version:-1;h===y&&p===t&&d===e.toneMapping||(l.material.needsUpdate=!0,h=y,p=t,d=e.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null)}}}}function Zs(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=d(null);let c=l,u=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function p(t){return r.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),a[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function _(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,s,o,a){!0!==r.isWebGL2||i!==e.INT&&i!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,i,s,o,a):e.vertexAttribIPointer(t,n,i,o,a)}function y(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,p,y,b){let A=!1;if(o){const t=function(t,n,i){const o=!0===i.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(y,p,l);c!==t&&(c=t,h(c.object)),A=function(e,t,n,r){const i=c.attributes,s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){const n=i[t];let r=s[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;o++}return c.attributesNum!==o||c.index!==r}(i,y,p,b),A&&function(e,t,n,r){const i={},s=t.attributes;let o=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,o++}c.attributes=i,c.attributesNum=o,c.index=r}(i,y,p,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===p.id&&c.wireframe===e||(c.geometry=y.id,c.program=p.id,c.wireframe=e,A=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(A||u)&&(u=!1,function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const r=c[t];if(r.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,p=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)g(r.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)m(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)v(r.location+e,o/r.locationSize,u,t,l*h,(p+o/r.locationSize*e)*h)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)g(r.location+e,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<r.locationSize;e++)m(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)v(r.location+e,o/r.locationSize,u,t,o*h,o/r.locationSize*e*h)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}_()}(i,l,p,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)p(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)p(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)p(r[e].object),delete r[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function $s(e,t,n,r){const i=r.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,r){e.drawArrays(s,t,r),n.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),n.update(o,s,a)}}function eo(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let o=void 0!==n.precision?n.precision:"highp";const a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function to(e){const t=this;let n=null,r=0,i=!1,s=!1;const o=new js,a=new Ln,l={value:null,needsUpdate:!1};function c(e,n,r,i){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==i||null===c){const t=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==s;++t,n+=4)o.copy(e[t]).applyMatrix4(i,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,a,u){const h=o.clippingPlanes,p=o.clipIntersection,d=o.clipShadows,f=e.get(o);if(!i||null===h||0===h.length||s&&!d)s?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=s?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=c(h,a,t,u);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=e}}}function no(e){let t=new WeakMap;function n(e,t){return t===oe?e.mapping=ie:t===ae&&(e.mapping=se),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const s=i.mapping;if(s===oe||s===ae){if(t.has(i)){const e=t.get(i).texture;return e.rotation=i.rotation,n(e,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=new Ls(s.height/2);return o.fromEquirectangularTexture(e,i),o.texture.rotation=i.rotation,t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class ro extends Ps{constructor(e=-1,t=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,s=n+e,o=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,s=i+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const io=[.125,.215,.35,.446,.526,.582],so=new ro,oo=new Ri;let ao=null;const lo=(1+Math.sqrt(5))/2,co=1/lo,uo=[new hr(1,1,1),new hr(-1,1,1),new hr(1,1,-1),new hr(-1,1,-1),new hr(0,lo,co),new hr(0,lo,-co),new hr(co,0,lo),new hr(-co,0,lo),new hr(lo,co,0),new hr(-lo,co,0)];class ho{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){ao=this._renderer.getRenderTarget(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=go(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=mo(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ao),e.scissorTest=!1,fo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ie||e.mapping===se?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ao=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:_e,minFilter:_e,generateMipmaps:!1,type:De,format:ke,colorSpace:Gt,depthBuffer:!1},r=po(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=po(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const s=e-4+1+io.length;for(let o=0;o<s;o++){const s=Math.pow(2,i);n.push(s);let a=1/s;o>e-4?a=io[o-e+4-1]:0===o&&(a=0),r.push(a);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],p=6,d=6,f=3,m=2,g=1,_=new Float32Array(f*d*p),v=new Float32Array(m*d*p),y=new Float32Array(g*d*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(r,f*d*e),v.set(h,m*d*e);const i=[e,e,e,e,e,e];y.set(i,g*d*e)}const b=new ss;b.setAttribute("position",new zi(_,f)),b.setAttribute("uv",new zi(v,m)),b.setAttribute("faceIndex",new zi(y,g)),t.push(b),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new hr(0,1,0);return new Is({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new xs(this._lodPlanes[0],e);this._renderer.compile(t,so)}_sceneToCubeUV(e,t,n,r){const i=new Rs(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(oo),a.toneMapping=J,a.autoClear=!1;const u=new ki({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),h=new xs(new Cs,u);let p=!1;const d=e.background;d?d.isColor&&(u.color.copy(d),e.background=null,p=!0):(u.color.copy(oo),p=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,s[t],0),i.lookAt(o[t],0,0)):1===n?(i.up.set(0,0,s[t]),i.lookAt(0,o[t],0)):(i.up.set(0,s[t],0),i.lookAt(0,0,o[t]));const l=this._cubeSize;fo(r,n*l,t>2?l:0,l,l),a.setRenderTarget(r),p&&a.render(h,i),a.render(e,i)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=d}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ie||e.mapping===se;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=go()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=mo());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new xs(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;fo(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(s,so)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=uo[(t-1)%uo.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new xs(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/p,f=isFinite(i)?1+Math.floor(3*d):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/d,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=p,u.mipInt.value=_-n;const v=this._sizeLods[r];fo(t,3*v*(r>_-4?r-_+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(c,so)}}function po(e,t,n){const r=new ir(e,t,n);return r.texture.mapping=le,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function fo(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function mo(){return new Is({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function go(){return new Is({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:v,depthTest:!1,depthWrite:!1})}function _o(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,o=s===oe||s===ae,a=s===ie||s===se;if(o||a){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new ho(e)),r=o?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const s=i.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(s)){null===n&&(n=new ho(e));const s=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,s),i.addEventListener("dispose",r),s.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function vo(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function yo(e,t,n,r){const i={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],s=e[t+2];n.push(r,i,i,s,s,r)}}else{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(Un(n)?Xi:Wi)(n,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return s.get(e)}}}function bo(e,t,n,r){const i=r.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(s,r,o,t*a),n.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](s,l,o,r*a,c),n.update(l,s,c)}}function Ao(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function wo(e,t){return e[0]-t[0]}function xo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Eo(e,t,n){const r={},i=new Float32Array(8),s=new WeakMap,o=new rr,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,c,u){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const r=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,i=void 0!==r?r.length:0;let a=s.get(c);if(void 0===a||a.count!==i){void 0!==a&&a.texture.dispose();const e=void 0!==c.morphAttributes.position,n=void 0!==c.morphAttributes.normal,r=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],u=c.morphAttributes.normal||[],h=c.morphAttributes.color||[];let p=0;!0===e&&(p=1),!0===n&&(p=2),!0===r&&(p=3);let d=c.attributes.position.count*p,f=1;d>t.maxTextureSize&&(f=Math.ceil(d/t.maxTextureSize),d=t.maxTextureSize);const m=new Float32Array(d*f*4*i),g=new sr(m,d,f,i);g.type=Te,g.needsUpdate=!0;const _=4*p;for(let t=0;t<i;t++){const i=l[t],s=u[t],a=h[t],c=d*f*4*t;for(let t=0;t<i.count;t++){const l=t*_;!0===e&&(o.fromBufferAttribute(i,t),m[c+l+0]=o.x,m[c+l+1]=o.y,m[c+l+2]=o.z,m[c+l+3]=0),!0===n&&(o.fromBufferAttribute(s,t),m[c+l+4]=o.x,m[c+l+5]=o.y,m[c+l+6]=o.z,m[c+l+7]=0),!0===r&&(o.fromBufferAttribute(a,t),m[c+l+8]=o.x,m[c+l+9]=o.y,m[c+l+10]=o.z,m[c+l+11]=4===a.itemSize?o.w:1)}}a={count:i,texture:g,size:new On(d,f)},s.set(c,a),c.addEventListener("dispose",(function e(){g.dispose(),s.delete(c),c.removeEventListener("dispose",e)}))}let l=0;for(let e=0;e<h.length;e++)l+=h[e];const p=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",p),u.getUniforms().setValue(e,"morphTargetInfluences",h),u.getUniforms().setValue(e,"morphTargetsTexture",a.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",a.size)}else{const t=void 0===h?0:h.length;let n=r[c.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];r[c.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=h[e]}n.sort(xo);for(let e=0;e<8;e++)e<t&&n[e][1]?(a[e][0]=n[e][0],a[e][1]=n[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(wo);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=a[e],n=t[0],r=t[1];n!==Number.MAX_SAFE_INTEGER&&r?(s&&c.getAttribute("morphTarget"+e)!==s[n]&&c.setAttribute("morphTarget"+e,s[n]),o&&c.getAttribute("morphNormal"+e)!==o[n]&&c.setAttribute("morphNormal"+e,o[n]),i[e]=r,l+=r):(s&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),i[e]=0)}const p=c.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",p),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Co(e,t,n,r){let i=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const a=r.render.frame,l=o.geometry,c=t.get(o,l);return i.get(c)!==a&&(t.update(c),i.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER)),c},dispose:function(){i=new WeakMap}}}const So=new nr,Mo=new sr,To=new ar,Do=new Os,Io=[],Po=[],Ro=new Float32Array(16),Bo=new Float32Array(9),ko=new Float32Array(4);function Oo(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let s=Io[i];if(void 0===s&&(s=new Float32Array(i),Io[i]=s),0!==t){r.toArray(s,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(s,i)}return s}function Lo(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Fo(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Uo(e,t){let n=Po[t];void 0===n&&(n=new Int32Array(t),Po[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function No(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function jo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Lo(n,t))return;e.uniform2fv(this.addr,t),Fo(n,t)}}function zo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Lo(n,t))return;e.uniform3fv(this.addr,t),Fo(n,t)}}function Go(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Lo(n,t))return;e.uniform4fv(this.addr,t),Fo(n,t)}}function Vo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;ko.set(r),e.uniformMatrix2fv(this.addr,!1,ko),Fo(n,r)}}function Ho(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;Bo.set(r),e.uniformMatrix3fv(this.addr,!1,Bo),Fo(n,r)}}function Qo(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;Ro.set(r),e.uniformMatrix4fv(this.addr,!1,Ro),Fo(n,r)}}function Wo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function qo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Lo(n,t))return;e.uniform2iv(this.addr,t),Fo(n,t)}}function Xo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Lo(n,t))return;e.uniform3iv(this.addr,t),Fo(n,t)}}function Yo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Lo(n,t))return;e.uniform4iv(this.addr,t),Fo(n,t)}}function Ko(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Jo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Lo(n,t))return;e.uniform2uiv(this.addr,t),Fo(n,t)}}function Zo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Lo(n,t))return;e.uniform3uiv(this.addr,t),Fo(n,t)}}function $o(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Lo(n,t))return;e.uniform4uiv(this.addr,t),Fo(n,t)}}function ea(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||So,i)}function ta(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||To,i)}function na(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Do,i)}function ra(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Mo,i)}function ia(e,t){e.uniform1fv(this.addr,t)}function sa(e,t){const n=Oo(t,this.size,2);e.uniform2fv(this.addr,n)}function oa(e,t){const n=Oo(t,this.size,3);e.uniform3fv(this.addr,n)}function aa(e,t){const n=Oo(t,this.size,4);e.uniform4fv(this.addr,n)}function la(e,t){const n=Oo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ca(e,t){const n=Oo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ua(e,t){const n=Oo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ha(e,t){e.uniform1iv(this.addr,t)}function pa(e,t){e.uniform2iv(this.addr,t)}function da(e,t){e.uniform3iv(this.addr,t)}function fa(e,t){e.uniform4iv(this.addr,t)}function ma(e,t){e.uniform1uiv(this.addr,t)}function ga(e,t){e.uniform2uiv(this.addr,t)}function _a(e,t){e.uniform3uiv(this.addr,t)}function va(e,t){e.uniform4uiv(this.addr,t)}function ya(e,t,n){const r=this.cache,i=t.length,s=Uo(n,i);Lo(r,s)||(e.uniform1iv(this.addr,s),Fo(r,s));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||So,s[e])}function ba(e,t,n){const r=this.cache,i=t.length,s=Uo(n,i);Lo(r,s)||(e.uniform1iv(this.addr,s),Fo(r,s));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||To,s[e])}function Aa(e,t,n){const r=this.cache,i=t.length,s=Uo(n,i);Lo(r,s)||(e.uniform1iv(this.addr,s),Fo(r,s));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Do,s[e])}function wa(e,t,n){const r=this.cache,i=t.length,s=Uo(n,i);Lo(r,s)||(e.uniform1iv(this.addr,s),Fo(r,s));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||Mo,s[e])}class xa{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return No;case 35664:return jo;case 35665:return zo;case 35666:return Go;case 35674:return Vo;case 35675:return Ho;case 35676:return Qo;case 5124:case 35670:return Wo;case 35667:case 35671:return qo;case 35668:case 35672:return Xo;case 35669:case 35673:return Yo;case 5125:return Ko;case 36294:return Jo;case 36295:return Zo;case 36296:return $o;case 35678:case 36198:case 36298:case 36306:case 35682:return ea;case 35679:case 36299:case 36307:return ta;case 35680:case 36300:case 36308:case 36293:return na;case 36289:case 36303:case 36311:case 36292:return ra}}(t.type)}}class Ea{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ia;case 35664:return sa;case 35665:return oa;case 35666:return aa;case 35674:return la;case 35675:return ca;case 35676:return ua;case 5124:case 35670:return ha;case 35667:case 35671:return pa;case 35668:case 35672:return da;case 35669:case 35673:return fa;case 5125:return ma;case 36294:return ga;case 36295:return _a;case 36296:return va;case 35678:case 36198:case 36298:case 36306:case 35682:return ya;case 35679:case 36299:case 36307:return ba;case 35680:case 36300:case 36308:case 36293:return Aa;case 36289:case 36303:case 36311:case 36292:return wa}}(t.type)}}class Ca{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(e,t[s.id],n)}}}const Sa=/(\w+)(\])?(\[|\.)?/g;function Ma(e,t){e.seq.push(t),e.map[t.id]=t}function Ta(e,t,n){const r=e.name,i=r.length;for(Sa.lastIndex=0;;){const s=Sa.exec(r),o=Sa.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){Ma(n,void 0===c?new xa(a,e,t):new Ea(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Ca(a),Ma(n,e)),n=e}}}class Da{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Ta(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,s=t.length;i!==s;++i){const s=t[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function Ia(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let Pa=0;function Ra(e){switch(e){case jt:case Gt:return["Linear","( value )"];case zt:return["sRGB","( value )"];case Ht:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}function Ba(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=i;e<s;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function ka(e,t){const n=Ra(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Oa(e,t){const n=Ra(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function La(e,t){let n;switch(t){case Z:n="Linear";break;case $:n="Reinhard";break;case ee:n="OptimizedCineon";break;case te:n="ACESFilmic";break;case ne:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Fa(e){return""!==e}function Ua(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Na(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ja=/^[ \t]*#include +<([\w\d./]+)>/gm;function za(e){return e.replace(ja,Ga)}function Ga(e,t){const n=qs[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return za(n)}const Va=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ha(e){return e.replace(Va,Qa)}function Qa(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Wa(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function qa(e,t,n,r){const i=e.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===p?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===d&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ie:case se:t="ENVMAP_TYPE_CUBE";break;case le:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===se&&(t="ENVMAP_MODE_REFRACTION"),t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case X:t="ENVMAP_BLENDING_MULTIPLY";break;case Y:t="ENVMAP_BLENDING_MIX";break;case K:t="ENVMAP_BLENDING_ADD"}return t}(n),m=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fa).join("\n")}(n),_=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),v=i.createProgram();let y,b,A=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(y=[_].filter(Fa).join("\n"),y.length>0&&(y+="\n"),b=[g,_].filter(Fa).join("\n"),b.length>0&&(b+="\n")):(y=[Wa(n),"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fa).join("\n"),b=[g,Wa(n),"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==J?"#define TONE_MAPPING":"",n.toneMapping!==J?qs.tonemapping_pars_fragment:"",n.toneMapping!==J?La("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",qs.encodings_pars_fragment,Oa("linearToOutputTexel",n.outputColorSpace),n.transmissionSamplerMapEncoding?ka("transmissionSamplerMapTexelToLinear",n.transmissionSamplerMapEncoding):"",n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Fa).join("\n")),o=za(o),o=Ua(o,n),o=Na(o,n),a=za(a),a=Ua(a,n),a=Na(a,n),o=Ha(o),a=Ha(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(A="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#define varying in",n.glslVersion===vn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===vn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join("\n")+"\n"+b);const w=A+y+o,x=A+b+a,E=Ia(i,i.VERTEX_SHADER,w),C=Ia(i,i.FRAGMENT_SHADER,x);if(i.attachShader(v,E),i.attachShader(v,C),void 0!==n.index0AttributeName?i.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),e.debug.checkShaderErrors){const t=i.getProgramInfoLog(v).trim(),n=i.getShaderInfoLog(E).trim(),r=i.getShaderInfoLog(C).trim();let s=!0,o=!0;if(!1===i.getProgramParameter(v,i.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,v,E,C);else{const e=Ba(i,E,"vertex"),n=Ba(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==n&&""!==r||(o=!1);o&&(this.diagnostics={runnable:s,programLog:t,vertexShader:{log:n,prefix:y},fragmentShader:{log:r,prefix:b}})}let S,M;return i.deleteShader(E),i.deleteShader(C),this.getUniforms=function(){return void 0===S&&(S=new Da(i,v)),S},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),s=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[s]={type:r.type,location:e.getAttribLocation(t,s),locationSize:o}}return n}(i,v)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.name=n.shaderName,this.id=Pa++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=E,this.fragmentShader=C,this}let Xa=0;class Ya{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Ka(e),t.set(e,n)),n}}class Ka{constructor(e){this.id=Xa++,this.code=e,this.usedTimes=0}}function Ja(e,t,n,r,i,s,o){const a=new Zr,l=new Ya,c=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,p=i.vertexTextures;let d=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(e){return 1===e?"uv1":2===e?"uv2":3===e?"uv3":"uv"}return{getParameters:function(s,a,c,v,b){const A=v.fog,w=b.geometry,x=s.isMeshStandardMaterial?v.environment:null,E=(s.isMeshStandardMaterial?n:t).get(s.envMap||x),C=E&&E.mapping===le?E.image.height:null,S=f[s.type];null!==s.precision&&(d=i.getMaxPrecision(s.precision),d!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",d,"instead."));const M=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,T=void 0!==M?M.length:0;let D,I,P,R,B=0;if(void 0!==w.morphAttributes.position&&(B=1),void 0!==w.morphAttributes.normal&&(B=2),void 0!==w.morphAttributes.color&&(B=3),S){const e=Ys[S];D=e.vertexShader,I=e.fragmentShader}else D=s.vertexShader,I=s.fragmentShader,l.update(s),P=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const k=e.getRenderTarget(),O=e.userData&&e.userData.transmissionRenderTarget,L=k?Array.isArray(k.texture)?k.texture[0]:k.texture:null,F=!0===b.isInstancedMesh,U=!!s.map,N=!!s.matcap,j=!!E,z=!!s.aoMap,G=!!s.lightMap,V=!!s.bumpMap,H=!!s.normalMap,Q=!!s.displacementMap,W=!!s.emissiveMap,q=!!s.metalnessMap,X=!!s.roughnessMap,Y=s.clearcoat>0,K=s.iridescence>0,Z=s.sheen>0,$=s.transmission>0,ee=Y&&!!s.clearcoatMap,te=Y&&!!s.clearcoatNormalMap,ne=Y&&!!s.clearcoatRoughnessMap,re=K&&!!s.iridescenceMap,ie=K&&!!s.iridescenceThicknessMap,se=Z&&!!s.sheenColorMap,oe=Z&&!!s.sheenRoughnessMap,ae=!!s.specularMap,ce=!!s.specularColorMap,ue=!!s.specularIntensityMap,he=$&&!!s.transmissionMap,pe=$&&!!s.thicknessMap,de=!!s.gradientMap,fe=!!s.alphaMap,me=s.alphaTest>0,ge=!!s.extensions,_e=!!w.attributes.uv1,ve=!!w.attributes.uv2,ye=!!w.attributes.uv3;return{isWebGL2:u,shaderID:S,shaderName:s.type,vertexShader:D,fragmentShader:I,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:d,instancing:F,instancingColor:F&&null!==b.instanceColor,supportsVertexTextures:p,outputColorSpace:null===k?e.outputColorSpace:!0===k.isXRRenderTarget||L.colorSpace&&L.colorSpace!==zt?L.colorSpace:Gt,map:U,matcap:N,envMap:j,envMapMode:j&&E.mapping,envMapCubeUVHeight:C,aoMap:z,lightMap:G,bumpMap:V,normalMap:H,displacementMap:p&&Q,emissiveMap:W,normalMapObjectSpace:H&&s.normalMapType===Nt,normalMapTangentSpace:H&&s.normalMapType===Ut,metalnessMap:q,roughnessMap:X,clearcoat:Y,clearcoatMap:ee,clearcoatNormalMap:te,clearcoatRoughnessMap:ne,iridescence:K,iridescenceMap:re,iridescenceThicknessMap:ie,sheen:Z,sheenColorMap:se,sheenRoughnessMap:oe,specularMap:ae,specularColorMap:ce,specularIntensityMap:ue,transmission:$,transmissionMap:he,thicknessMap:pe,transmissionSamplerMapEncoding:O&&O.texture.colorSpace||Gt,gradientMap:de,opaque:!1===s.transparent&&s.blending===y&&!(s.transmission>0),alphaMap:fe,alphaTest:me,combine:s.combine,mapUv:U&&_(s.map.channel),aoMapUv:z&&_(s.aoMap.channel),lightMapUv:G&&_(s.lightMap.channel),bumpMapUv:V&&_(s.bumpMap.channel),normalMapUv:H&&_(s.normalMap.channel),displacementMapUv:Q&&_(s.displacementMap.channel),emissiveMapUv:W&&_(s.emissiveMap.channel),metalnessMapUv:q&&_(s.metalnessMap.channel),roughnessMapUv:X&&_(s.roughnessMap.channel),clearcoatMapUv:ee&&_(s.clearcoatMap.channel),clearcoatNormalMapUv:te&&_(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ne&&_(s.clearcoatRoughnessMap.channel),iridescenceMapUv:re&&_(s.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&_(s.iridescenceThicknessMap.channel),sheenColorMapUv:se&&_(s.sheenColorMap.channel),sheenRoughnessMapUv:oe&&_(s.sheenRoughnessMap.channel),specularMapUv:ae&&_(s.specularMap.channel),specularColorMapUv:ce&&_(s.specularColorMap.channel),specularIntensityMapUv:ue&&_(s.specularIntensityMap.channel),transmissionMapUv:he&&_(s.transmissionMap.channel),thicknessMapUv:pe&&_(s.thicknessMap.channel),alphaMapUv:fe&&_(s.alphaMap.channel),vertexTangents:H&&!!w.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,vertexUv1s:_e,vertexUv2s:ve,vertexUv3s:ye,pointsUvs:!0===b.isPoints&&!!w.attributes.uv&&(U||fe),fog:!!A,useFog:!0===s.fog,fogExp2:A&&A.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===b.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:T,morphTextureStride:B,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:J,useLegacyLights:e.useLegacyLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===g,flipSided:s.side===m,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:ge&&!0===s.extensions.derivatives,extensionFragDepth:ge&&!0===s.extensions.fragDepth,extensionDrawBuffers:ge&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:ge&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.matcap&&a.enable(4),t.envMap&&a.enable(5),t.normalMapObjectSpace&&a.enable(6),t.normalMapTangentSpace&&a.enable(7),t.clearcoat&&a.enable(8),t.iridescence&&a.enable(9),t.alphaTest&&a.enable(10),t.vertexColors&&a.enable(11),t.vertexAlphas&&a.enable(12),t.vertexUv1s&&a.enable(13),t.vertexUv2s&&a.enable(14),t.vertexUv3s&&a.enable(15),t.vertexTangents&&a.enable(16),e.push(a.mask),a.disableAll(),t.fog&&a.enable(0),t.useFog&&a.enable(1),t.flatShading&&a.enable(2),t.logarithmicDepthBuffer&&a.enable(3),t.skinning&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.morphColors&&a.enable(7),t.premultipliedAlpha&&a.enable(8),t.shadowMapEnabled&&a.enable(9),t.useLegacyLights&&a.enable(10),t.doubleSided&&a.enable(11),t.flipSided&&a.enable(12),t.useDepthPacking&&a.enable(13),t.dithering&&a.enable(14),t.transmission&&a.enable(15),t.sheen&&a.enable(16),t.opaque&&a.enable(17),t.pointsUvs&&a.enable(18),e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Ys[t];n=Ds.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new qa(e,n,t,s),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Za(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function $a(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function el(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function tl(){const e=[];let t=0;const n=[],r=[],i=[];function s(n,r,i,s,o,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?r.push(u):!0===o.transparent?i.push(u):n.push(u)},unshift:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?r.unshift(u):!0===o.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||$a),r.length>1&&r.sort(t||el),i.length>1&&i.sort(t||el)}}}function nl(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new tl,e.set(t,[i])):n>=r.length?(i=new tl,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function rl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new hr,color:new Ri};break;case"SpotLight":n={position:new hr,direction:new hr,color:new Ri,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new hr,color:new Ri,distance:0,decay:0};break;case"HemisphereLight":n={direction:new hr,skyColor:new Ri,groundColor:new Ri};break;case"RectAreaLight":n={color:new Ri,position:new hr,halfWidth:new hr,halfHeight:new hr}}return e[t.id]=n,n}}}let il=0;function sl(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function ol(e,t){const n=new rl,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new On};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new On,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)i.probe.push(new hr);const s=new hr,o=new zr,a=new zr;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,v=0,y=0;s.sort(sl);const b=!0===o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,A=t.intensity,w=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*A*b,l+=o.g*A*b,c+=o.b*A*b;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],A);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=x,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(A*b),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[p]=e;const s=t.shadow;if(t.map&&(i.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&y++),i.spotLightMatrix[p]=s.matrix,t.castShadow){const e=r.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,i.spotShadow[p]=e,i.spotShadowMap[p]=x,_++}p++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(A),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=x,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(A*b),e.groundColor.copy(t.groundColor).multiplyScalar(A*b),i.hemi[f]=e,f++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Xs.LTC_FLOAT_1,i.rectAreaLTC2=Xs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Xs.LTC_HALF_1,i.rectAreaLTC2=Xs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=l,i.ambient[2]=c;const A=i.hash;A.directionalLength===u&&A.pointLength===h&&A.spotLength===p&&A.rectAreaLength===d&&A.hemiLength===f&&A.numDirectionalShadows===m&&A.numPointShadows===g&&A.numSpotShadows===_&&A.numSpotMaps===v||(i.directional.length=u,i.spot.length=p,i.rectArea.length=d,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=_+v-y,i.spotLightMap.length=v,i.numSpotLightShadowsWithMaps=y,A.directionalLength=u,A.pointLength=h,A.spotLength=p,A.rectAreaLength=d,A.hemiLength=f,A.numDirectionalShadows=m,A.numPointShadows=g,A.numSpotShadows=_,A.numSpotMaps=v,i.version=il++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,p=e.length;t<p;t++){const p=e[t];if(p.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),n++}else if(p.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),l++}else if(p.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),a.identity(),o.copy(p.matrixWorld),o.premultiply(h),a.extractRotation(o),e.halfWidth.set(.5*p.width,0,0),e.halfHeight.set(0,.5*p.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(p.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(p.matrixWorld),e.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(p.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function al(e,t){const n=new ol(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function ll(e,t){let n=new WeakMap;return{get:function(r,i=0){const s=n.get(r);let o;return void 0===s?(o=new al(e,t),n.set(r,[o])):i>=s.length?(o=new al(e,t),s.push(o)):o=s[i],o},dispose:function(){n=new WeakMap}}}class cl extends Si{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Lt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ul extends Si{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function hl(e,t,n){let r=new Vs;const i=new On,s=new On,o=new rr,a=new cl({depthPacking:Ft}),l=new ul,c={},u=n.maxTextureSize,p={[f]:m,[m]:f,[g]:g},_=new Is({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new On},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=_.clone();y.defines.HORIZONTAL_PASS=1;const b=new ss;b.setAttribute("position",new zi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new xs(b,_),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h;let x=this.type;function E(n,r){const s=t.update(A);_.defines.VSM_SAMPLES!==n.blurSamples&&(_.defines.VSM_SAMPLES=n.blurSamples,y.defines.VSM_SAMPLES=n.blurSamples,_.needsUpdate=!0,y.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new ir(i.x,i.y)),_.uniforms.shadow_pass.value=n.map.texture,_.uniforms.resolution.value=n.mapSize,_.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,s,_,A,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,s,y,A,null)}function C(t,n,r,i){let s=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===r.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=s.clone(),r[t]=i),s=i}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=i===d?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:p[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial&&(e.properties.get(s).light=r),s}function S(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===d)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=C(n,u,o,a);e.renderBufferDirect(s,null,r,t,n,c)}}}else if(i.visible){const t=C(n,i,o,a);e.renderBufferDirect(s,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)S(l[e],i,s,o,a)}this.render=function(t,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(v),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);const f=x!==d&&this.type===d,m=x===d&&this.type!==d;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const g=h.getFrameExtents();if(i.multiply(g),s.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/g.x),i.x=s.x*g.x,h.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/g.y),i.y=s.y*g.y,h.mapSize.y=s.y)),null===h.map||!0===f||!0===m){const e=this.type!==d?{minFilter:pe,magFilter:pe}:{};null!==h.map&&h.map.dispose(),h.map=new ir(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const _=h.getViewportCount();for(let e=0;e<_;e++){const t=h.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),p.viewport(o),h.updateMatrices(c,e),r=h.getFrustum(),S(n,a,h.camera,c,this.type)}!0!==h.isPointLightShadow&&this.type===d&&E(h,a),h.needsUpdate=!1}x=this.type,w.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function pl(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new rr;let r=null;const i=new rr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,s,o,a){!0===a&&(t*=o,r*=o,s*=o),n.set(t,r,s,o),!1===i.equals(n)&&(e.clearColor(t,r,s,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?Ae(e.DEPTH_TEST):we(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case j:e.depthFunc(e.NEVER);break;case z:e.depthFunc(e.ALWAYS);break;case G:e.depthFunc(e.LESS);break;case V:e.depthFunc(e.LEQUAL);break;case H:e.depthFunc(e.EQUAL);break;case Q:e.depthFunc(e.GEQUAL);break;case W:e.depthFunc(e.GREATER);break;case q:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},c=new function(){let t=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?Ae(e.STENCIL_TEST):we(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&s===o||(e.stencilFunc(t,n,o),r=t,i=n,s=o)},setOp:function(t,n,r){o===t&&a===n&&l===r||(e.stencilOp(t,n,r),o=t,a=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}},u=new WeakMap,h=new WeakMap;let p={},d={},f=new WeakMap,_=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,ne=null,re=!1,ie=null,se=null,oe=null,ae=null,le=null;const ce=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ue=!1,he=0;const pe=e.getParameter(e.VERSION);-1!==pe.indexOf("WebGL")?(he=parseFloat(/^WebGL (\d)/.exec(pe)[1]),ue=he>=1):-1!==pe.indexOf("OpenGL ES")&&(he=parseFloat(/^OpenGL ES (\d)/.exec(pe)[1]),ue=he>=2);let de=null,fe={};const me=e.getParameter(e.SCISSOR_BOX),ge=e.getParameter(e.VIEWPORT),_e=(new rr).fromArray(me),ve=(new rr).fromArray(ge);function ye(t,n,i,s){const o=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,o);return a}const be={};function Ae(t){!0!==p[t]&&(e.enable(t),p[t]=!0)}function we(t){!1!==p[t]&&(e.disable(t),p[t]=!1)}be[e.TEXTURE_2D]=ye(e.TEXTURE_2D,e.TEXTURE_2D,1),be[e.TEXTURE_CUBE_MAP]=ye(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(be[e.TEXTURE_2D_ARRAY]=ye(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),be[e.TEXTURE_3D]=ye(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),s.setClear(1),c.setClear(0),Ae(e.DEPTH_TEST),s.setFunc(V),Se(!1),Me(a),Ae(e.CULL_FACE),Ce(v);const xe={[E]:e.FUNC_ADD,[C]:e.FUNC_SUBTRACT,[S]:e.FUNC_REVERSE_SUBTRACT};if(r)xe[M]=e.MIN,xe[T]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[M]=e.MIN_EXT,xe[T]=e.MAX_EXT)}const Ee={[D]:e.ZERO,[I]:e.ONE,[P]:e.SRC_COLOR,[B]:e.SRC_ALPHA,[N]:e.SRC_ALPHA_SATURATE,[F]:e.DST_COLOR,[O]:e.DST_ALPHA,[R]:e.ONE_MINUS_SRC_COLOR,[k]:e.ONE_MINUS_SRC_ALPHA,[U]:e.ONE_MINUS_DST_COLOR,[L]:e.ONE_MINUS_DST_ALPHA};function Ce(t,n,r,i,s,o,a,l){if(t!==v){if(!1===Y&&(Ae(e.BLEND),Y=!0),t===x)s=s||n,o=o||r,a=a||i,n===J&&s===ee||(e.blendEquationSeparate(xe[n],xe[s]),J=n,ee=s),r===Z&&i===$&&o===te&&a===ne||(e.blendFuncSeparate(Ee[r],Ee[i],Ee[o],Ee[a]),Z=r,$=i,te=o,ne=a),K=t,re=!1;else if(t!==K||l!==re){if(J===E&&ee===E||(e.blendEquation(e.FUNC_ADD),J=E,ee=E),l)switch(t){case y:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case b:e.blendFunc(e.ONE,e.ONE);break;case A:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case w:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case y:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case b:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case A:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case w:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,te=null,ne=null,K=t,re=l}}else!0===Y&&(we(e.BLEND),Y=!1)}function Se(t){ie!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),ie=t)}function Me(t){t!==o?(Ae(e.CULL_FACE),t!==se&&(t===a?e.cullFace(e.BACK):t===l?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):we(e.CULL_FACE),se=t}function Te(t,n,r){t?(Ae(e.POLYGON_OFFSET_FILL),ae===n&&le===r||(e.polygonOffset(n,r),ae=n,le=r)):we(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:s,stencil:c},enable:Ae,disable:we,bindFramebuffer:function(t,n){return d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(d[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(d[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,i){let s=_,o=!1;if(r)if(s=f.get(i),void 0===s&&(s=[],f.set(i,s)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)s[n]=e.COLOR_ATTACHMENT0+n;s.length=t.length,o=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,o=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return X!==t&&(e.useProgram(t),X=t,!0)},setBlending:Ce,setMaterial:function(t,n){t.side===g?we(e.CULL_FACE):Ae(e.CULL_FACE);let r=t.side===m;n&&(r=!r),Se(r),t.blending===y&&!1===t.transparent?Ce(v):Ce(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);const o=t.stencilWrite;c.setTest(o),o&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Te(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?Ae(e.SAMPLE_ALPHA_TO_COVERAGE):we(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Se,setCullFace:Me,setLineWidth:function(t){t!==oe&&(ue&&e.lineWidth(t),oe=t)},setPolygonOffset:Te,setScissorTest:function(t){t?Ae(e.SCISSOR_TEST):we(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+ce-1),de!==t&&(e.activeTexture(t),de=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===de?e.TEXTURE0+ce-1:de);let i=fe[r];void 0===i&&(i={type:void 0,texture:void 0},fe[r]=i),i.type===t&&i.texture===n||(de!==r&&(e.activeTexture(r),de=r),e.bindTexture(t,n||be[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=fe[de];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=h.get(n);void 0===r&&(r=new WeakMap,h.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=h.get(n).get(t);u.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),u.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===_e.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),_e.copy(t))},viewport:function(t){!1===ve.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ve.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),p={},de=null,fe={},d={},f=new WeakMap,_=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,ne=null,re=!1,ie=null,se=null,oe=null,ae=null,le=null,_e.set(0,0,e.canvas.width,e.canvas.height),ve.set(0,0,e.canvas.width,e.canvas.height),i.reset(),s.reset(),c.reset()}}}function dl(e,t,n,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,d="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return _?new OffscreenCanvas(e,t):zn("canvas")}function y(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Pn:Math.floor,s=r(i*e.width),o=r(i*e.height);void 0===m&&(m=v(s,o));const a=n?v(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return Dn(e.width)&&Dn(e.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==pe&&e.minFilter!==_e}function w(t){e.generateMipmap(t)}function x(n,r,i,s,o=!1){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;return r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RGBA&&(i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=s===zt&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)),l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function E(e,t,n){return!0===A(e,n)||e.isFramebufferTexture&&e.minFilter!==pe&&e.minFilter!==_e?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function C(t){return t===pe||t===de||t===me?e.NEAREST:e.LINEAR}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=g.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&T(e),0===Object.keys(i).length&&g.delete(n)}r.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=t.texture,i=r.get(t),s=r.get(n);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function T(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete g.get(i)[n.__cacheKey],o.memory.textures--}let D=0;function I(t,i){const s=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void O(s,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+i)}const P={[ce]:e.REPEAT,[ue]:e.CLAMP_TO_EDGE,[he]:e.MIRRORED_REPEAT},R={[pe]:e.NEAREST,[de]:e.NEAREST_MIPMAP_NEAREST,[me]:e.NEAREST_MIPMAP_LINEAR,[_e]:e.LINEAR,[ve]:e.LINEAR_MIPMAP_NEAREST,[be]:e.LINEAR_MIPMAP_LINEAR};function B(n,s,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,P[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,P[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,R[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,R[s.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS===ue&&s.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C(s.minFilter)),s.minFilter!==pe&&s.minFilter!==_e&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===pe)return;if(s.minFilter!==me&&s.minFilter!==be)return;if(s.type===Te&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===De&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function k(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const i=n.source;let s=g.get(i);void 0===s&&(s={},g.set(i,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;const i=s[t.__cacheKey];void 0!==i&&(s[t.__cacheKey].usedTimes--,0===i.usedTimes&&T(n)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return r}function O(t,i,o){let l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);const c=k(t,i),h=i.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const p=r.get(h);if(h.version!==p.__version||!0===c){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=function(e){return!a&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==pe&&e.minFilter!==_e)}(i)&&!1===b(i.image);let r=y(i.image,t,!1,u);r=z(i,r);const d=b(r)||a,f=s.convert(i.format,i.colorSpace);let m,g=s.convert(i.type),_=x(i.internalFormat,f,g,i.colorSpace);B(l,i,d);const v=i.mipmaps,C=a&&!0!==i.isVideoTexture,S=void 0===p.__version||!0===c,M=E(i,r,d);if(i.isDepthTexture)_=e.DEPTH_COMPONENT,a?_=i.type===Te?e.DEPTH_COMPONENT32F:i.type===Me?e.DEPTH_COMPONENT24:i.type===Re?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:i.type===Te&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Fe&&_===e.DEPTH_COMPONENT&&i.type!==Ce&&i.type!==Me&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Me,g=s.convert(i.type)),i.format===Ue&&_===e.DEPTH_COMPONENT&&(_=e.DEPTH_STENCIL,i.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Re,g=s.convert(i.type))),S&&(C?n.texStorage2D(e.TEXTURE_2D,1,_,r.width,r.height):n.texImage2D(e.TEXTURE_2D,0,_,r.width,r.height,0,f,g,null));else if(i.isDataTexture)if(v.length>0&&d){C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,r=v.length;t<r;t++)m=v[t],C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data);i.generateMipmaps=!1}else C?(S&&n.texStorage2D(e.TEXTURE_2D,M,_,r.width,r.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,f,g,r.data)):n.texImage2D(e.TEXTURE_2D,0,_,r.width,r.height,0,f,g,r.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){C&&S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,_,v[0].width,v[0].height,r.depth);for(let t=0,s=v.length;t<s;t++)m=v[t],i.format!==ke?null!==f?C?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,r.depth,f,m.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,r.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,r.depth,f,g,m.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,r.depth,0,f,g,m.data)}else{C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,r=v.length;t<r;t++)m=v[t],i.format!==ke?null!==f?C?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data)}else if(i.isDataArrayTexture)C?(S&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,_,r.width,r.height,r.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,r.width,r.height,r.depth,0,f,g,r.data);else if(i.isData3DTexture)C?(S&&n.texStorage3D(e.TEXTURE_3D,M,_,r.width,r.height,r.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):n.texImage3D(e.TEXTURE_3D,0,_,r.width,r.height,r.depth,0,f,g,r.data);else if(i.isFramebufferTexture){if(S)if(C)n.texStorage2D(e.TEXTURE_2D,M,_,r.width,r.height);else{let t=r.width,i=r.height;for(let r=0;r<M;r++)n.texImage2D(e.TEXTURE_2D,r,_,t,i,0,f,g,null),t>>=1,i>>=1}}else if(v.length>0&&d){C&&S&&n.texStorage2D(e.TEXTURE_2D,M,_,v[0].width,v[0].height);for(let t=0,r=v.length;t<r;t++)m=v[t],C?n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,g,m):n.texImage2D(e.TEXTURE_2D,t,_,f,g,m);i.generateMipmaps=!1}else C?(S&&n.texStorage2D(e.TEXTURE_2D,M,_,r.width,r.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,g,r)):n.texImage2D(e.TEXTURE_2D,0,_,f,g,r);A(i,d)&&w(l),p.__version=h.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function L(t,i,o,a,l){const c=s.convert(o.format,o.colorSpace),u=s.convert(o.type),h=x(o.internalFormat,c,u,o.colorSpace);r.get(i).__hasExternalTextures||(l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null)),n.bindFramebuffer(e.FRAMEBUFFER,t),j(i)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,l,r.get(o).__webglTexture,0,N(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,l,r.get(o).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function F(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=e.DEPTH_COMPONENT16;if(r||j(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Te?i=e.DEPTH_COMPONENT32F:t.type===Me&&(i=e.DEPTH_COMPONENT24));const r=N(n);j(n)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=N(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):j(n)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let i=0;i<t.length;i++){const o=t[i],a=s.convert(o.format,o.colorSpace),l=s.convert(o.type),c=x(o.internalFormat,a,l,o.colorSpace),u=N(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):j(n)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function U(t){const i=r.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);const s=r.get(i.depthTexture).__webglTexture,o=N(i);if(i.depthTexture.format===Fe)j(i)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(i.depthTexture.format!==Ue)throw new Error("Unknown depthTexture format");j(i)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),F(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),F(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(e){return Math.min(h,e.samples)}function j(e){const n=r.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,n){const r=e.colorSpace,i=e.format,s=e.type;return!0===e.isCompressedTexture||e.format===yn||r!==Gt&&r!==jt&&(r===zt?!1===a?!0===t.has("EXT_sRGB")&&i===ke?(e.format=yn,e.minFilter=_e,e.generateMipmaps=!1):n=Zn.sRGBToLinear(n):i===ke&&s===we||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):r===Ht||console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}this.allocateTextureUnit=function(){const e=D;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),D+=1,e},this.resetTextureUnits=function(){D=0},this.setTexture2D=I,this.setTexture2DArray=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?O(s,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?O(s,t,i):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;const l=k(t,i),u=i.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const h=r.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=i.isCompressedTexture||i.image[0].isCompressedTexture,r=i.image[0]&&i.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=t||r?r?i.image[e].image:i.image[e]:y(i.image[e],!1,!0,c),p[e]=z(i,p[e]);const d=p[0],f=b(d)||a,m=s.convert(i.format,i.colorSpace),g=s.convert(i.type),_=x(i.internalFormat,m,g,i.colorSpace),v=a&&!0!==i.isVideoTexture,C=void 0===h.__version||!0===l;let S,M=E(i,d,f);if(B(e.TEXTURE_CUBE_MAP,i,f),t){v&&C&&n.texStorage2D(e.TEXTURE_CUBE_MAP,M,_,d.width,d.height);for(let t=0;t<6;t++){S=p[t].mipmaps;for(let r=0;r<S.length;r++){const s=S[r];i.format!==ke?null!==m?v?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,s.width,s.height,m,s.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,s.width,s.height,m,g,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,s.width,s.height,0,m,g,s.data)}}}else{S=i.mipmaps,v&&C&&(S.length>0&&M++,n.texStorage2D(e.TEXTURE_CUBE_MAP,M,_,p[0].width,p[0].height));for(let t=0;t<6;t++)if(r){v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,m,g,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,p[t].width,p[t].height,0,m,g,p[t].data);for(let r=0;r<S.length;r++){const i=S[r].image[t].image;v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,m,g,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,i.width,i.height,0,m,g,i.data)}}else{v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m,g,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,m,g,p[t]);for(let r=0;r<S.length;r++){const i=S[r];v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,m,g,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,m,g,i.image[t])}}}A(i,f)&&w(e.TEXTURE_CUBE_MAP),h.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,i):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,n,i){const s=r.get(t);void 0!==n&&L(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==i&&U(t)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultipleRenderTargets,d=b(t)||a;if(h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),p)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===j(t)){const r=p?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<r.length;n++){const i=r[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const o=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=x(i.internalFormat,o,a,i.colorSpace,!0===t.isXRRenderTarget),u=N(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),F(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),B(e.TEXTURE_CUBE_MAP,l,d);for(let n=0;n<6;n++)L(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);A(l,d)&&w(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(p){const i=t.texture;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r.get(o);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),B(e.TEXTURE_2D,o,d),L(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D),A(o,d)&&w(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(r,u.__webglTexture),B(r,l,d),L(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r),A(l,d)&&w(r),n.unbindTexture()}t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(t){const i=b(t)||a,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D;for(let e=0,t=s.length;e<t;e++){const t=s[e],a=r.get(t),l=a.__webglTexture;a.__version!==t.version&&(n.bindTexture(o,l),B(o,t,i),n.unbindTexture(),a.__version=t.version),A(t,i)&&(n.bindTexture(o,l),w(o),n.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===j(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),h){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,e.NEAREST),d&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=L,this.useMultisampledRTT=j}function fl(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=jt){let s;if(n===we)return e.UNSIGNED_BYTE;if(n===Ie)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Pe)return e.UNSIGNED_SHORT_5_5_5_1;if(n===xe)return e.BYTE;if(n===Ee)return e.SHORT;if(n===Ce)return e.UNSIGNED_SHORT;if(n===Se)return e.INT;if(n===Me)return e.UNSIGNED_INT;if(n===Te)return e.FLOAT;if(n===De)return r?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(n===Be)return e.ALPHA;if(n===ke)return e.RGBA;if(n===Oe)return e.LUMINANCE;if(n===Le)return e.LUMINANCE_ALPHA;if(n===Fe)return e.DEPTH_COMPONENT;if(n===Ue)return e.DEPTH_STENCIL;if(n===yn)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(n===Ne)return e.RED;if(n===je)return e.RED_INTEGER;if(n===ze)return e.RG;if(n===Ge)return e.RG_INTEGER;if(n===Ve)return e.RGBA_INTEGER;if(n===He||n===Qe||n===We||n===qe)if(i===zt){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===He)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Qe)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===We)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===qe)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===He)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Qe)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===We)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===qe)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Xe||n===Ye||n===Ke||n===Je){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(n===Xe)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ye)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ke)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Je)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Ze)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===$e||n===et){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(n===$e)return i===zt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===et)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(n===tt||n===nt||n===rt||n===it||n===st||n===ot||n===at||n===lt||n===ct||n===ut||n===ht||n===pt||n===dt||n===ft){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(n===tt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===nt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===rt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===it)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===st)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ot)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===at)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===lt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ct)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ut)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===ht)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===pt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===dt)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ft)return i===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===mt){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(n===mt)return i===zt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===gt||n===_t||n===vt||n===yt){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(n===mt)return s.COMPRESSED_RED_RGTC1_EXT;if(n===_t)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===vt)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===yt)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Re?r?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class ml extends Rs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class gl extends pi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _l={type:"move"};class vl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new gl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new gl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new hr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new hr),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new gl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new hr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new hr),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_l)))}return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new gl;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class yl extends nr{constructor(e,t,n,r,i,s,o,a,l,c){if((c=void 0!==c?c:Fe)!==Fe&&c!==Ue)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Fe&&(n=Me),void 0===n&&c===Ue&&(n=Re),super(null,r,i,s,o,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:pe,this.minFilter=void 0!==a?a:pe,this.flipY=!1,this.generateMipmaps=!1}}class bl extends bn{constructor(e,t){super();const n=this;let r=null,i=1,s=null,o="local-floor",a=1,l=null,c=null,u=null,h=null,p=null,d=null;const f=t.getContextAttributes();let m=null,g=null;const _=[],v=[],y=new Set,b=new Map,A=new Rs;A.layers.enable(1),A.viewport=new rr;const w=new Rs;w.layers.enable(2),w.viewport=new rr;const x=[A,w],E=new ml;E.layers.enable(1),E.layers.enable(2);let C=null,S=null;function M(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function T(){r.removeEventListener("select",M),r.removeEventListener("selectstart",M),r.removeEventListener("selectend",M),r.removeEventListener("squeeze",M),r.removeEventListener("squeezestart",M),r.removeEventListener("squeezeend",M),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",D);for(let e=0;e<_.length;e++){const t=v[e];null!==t&&(v[e]=null,_[e].disconnect(t))}C=null,S=null,e.setRenderTarget(m),p=null,h=null,u=null,r=null,g=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function D(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=v.indexOf(n);r>=0&&(v[r]=null,_[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=v.indexOf(n);if(-1===r){for(let e=0;e<_.length;e++){if(e>=v.length){v.push(n),r=e;break}if(null===v[e]){v[e]=n,r=e;break}}if(-1===r)break}const i=_[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new vl,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new vl,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new vl,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:p},this.getBinding=function(){return u},this.getFrame=function(){return d},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",M),r.addEventListener("selectstart",M),r.addEventListener("selectend",M),r.addEventListener("squeeze",M),r.addEventListener("squeezestart",M),r.addEventListener("squeezeend",M),r.addEventListener("end",T),r.addEventListener("inputsourceschange",D),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:i};p=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:p}),g=new ir(p.framebufferWidth,p.framebufferHeight,{format:ke,type:we,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,s=null,o=null;f.depth&&(o=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?Ue:Fe,s=f.stencil?Re:Me);const a={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(a),r.updateRenderState({layers:[h]}),g=new ir(h.textureWidth,h.textureHeight,{format:ke,type:we,depthTexture:new yl(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await r.requestReferenceSpace(o),k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const I=new hr,P=new hr;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;E.near=w.near=A.near=e.near,E.far=w.far=A.far=e.far,C===E.near&&S===E.far||(r.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,S=E.far);const t=e.parent,n=E.cameras;R(E,t);for(let e=0;e<n.length;e++)R(n[e],t);2===n.length?function(e,t,n){I.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const r=I.distanceTo(P),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],p=o*u,d=o*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,_=a+f,v=p-m,y=d+(r-m),b=l*a/_*g,A=c*a/_*g;e.projectionMatrix.makePerspective(v,y,b,A,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,A,w):E.projectionMatrix.copy(A.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*En*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,t)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==h||null!==p)return a},this.setFoveation=function(e){a=e,null!==h&&(h.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)},this.getPlanes=function(){return y};let B=null;this.onPreAnimationFrameCallback=null;const k=new Hs;k.setAnimationLoop((function(t,r){if(n.onPreAnimationFrameCallback&&n.onPreAnimationFrameCallback(t,r),c=r.getViewerPose(l||s),d=r,null!==c){const t=c.views;null!==p&&(e.setRenderTargetFramebuffer(g,p.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let s=null;if(null!==p)s=p.getViewport(i);else{const t=u.getViewSubImage(h,i);s=t.viewport,0===r&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=x[r];void 0===o&&(o=new Rs,o.layers.enable(r),o.viewport=new rr,x[r]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===r&&(E.matrix.copy(o.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===n&&E.cameras.push(o)}}for(let e=0;e<_.length;e++){const t=v[e],n=_[e];null!==t&&void 0!==n&&n.update(t,r,l||s)}if(B&&B(t,r),r.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:r.detectedPlanes});let e=null;for(const t of y)r.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(const t of e)y.delete(t),b.delete(t),n.dispatchEvent({type:"planeremoved",data:t});for(const e of r.detectedPlanes)if(y.has(e)){const t=b.get(e);e.lastChangedTime>t&&(b.set(e,e.lastChangedTime),n.dispatchEvent({type:"planechanged",data:e}))}else y.add(e),b.set(e,r.lastChangedTime),n.dispatchEvent({type:"planeadded",data:e})}d=null})),this.setAnimationLoop=function(e){B=e},this.dispose=function(){}}}function Al(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,i.side===m&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),i.side===m&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const s=t.get(i).envMap;if(s){r.envMap.value=s;const e=t.get(i).environment||s;r.envMapRotation.value=e?e.rotation:0,r.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio}if(i.lightMap){r.lightMap.value=i.lightMap;const t=!0===e.useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshTransformUniform:n,refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ts(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,s,o,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform)),e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform)),t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===m&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,a)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,s,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(void 0!==i.transmission&&(e.transmission&&(e.transmission.value=i.transmission),e.transmissionSamplerMap&&a&&(e.transmissionSamplerMap.value=a?a.texture:null),e.transmissionSamplerSize&&a&&e.transmissionSamplerSize.value.set(a.width,a.height)),i.uniformsNeedUpdate=!1)}}}function wl(e,t,n,r){let i={},s={},o=[];const a=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const r=e.value;if(void 0===n[t]){if("number"==typeof r)n[t]=r;else{const e=Array.isArray(r)?r:[r],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());n[t]=i}return!0}if("number"==typeof r){if(n[t]!==r)return n[t]=r,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],i=Array.isArray(r)?r:[r];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(i[t]))return n.copy(i[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let p=i[n.id];void 0===p&&(function(e){const t=e.uniforms;let n=0,r=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],s={boundary:0,storage:0},o=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);s.boundary+=t.boundary,s.storage+=t.storage}i.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,e>0&&(r=n%16,0!==r&&16-r-s.boundary<0&&(n+=16-r,i.__offset=n)),n+=s.storage}r=n%16,r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),p=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=p,n.addEventListener("dispose",u));const d=h.program;r.updateUBOMapping(n,d);const f=t.render.frame;s[n.id]!==f&&(function(t){const n=i[t.id],r=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=r[t];if(!0===l(n,t,s)){const t=n.__offset,r=Array.isArray(n.value)?n.value:[n.value];let i=0;for(let s=0;s<r.length;s++){const o=r[s],a=c(o);"number"==typeof o?(n.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+i,n.__data)):o.isMatrix3?(n.__data[0]=o.elements[0],n.__data[1]=o.elements[1],n.__data[2]=o.elements[2],n.__data[3]=o.elements[0],n.__data[4]=o.elements[3],n.__data[5]=o.elements[4],n.__data[6]=o.elements[5],n.__data[7]=o.elements[0],n.__data[8]=o.elements[6],n.__data[9]=o.elements[7],n.__data[10]=o.elements[8],n.__data[11]=o.elements[0]):(o.toArray(n.__data,i),i+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},s={}}}}function xl(){const e=zn("canvas");return e.style.display="block",e}class El{constructor(e={}){const{canvas:t=xl(),context:n=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;let p;this.isWebGLRenderer=!0,p=null!==n?n.getContextAttributes().alpha:o;let d=null,_=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=zt,this.useLegacyLights=!0,this.toneMapping=J,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const b=this;let A=!1,w=0,x=0,E=null,C=-1,S=null;const M=new rr,T=new rr;let D=null,I=t.width,P=t.height,R=1,B=null,k=null;const O=new rr(0,0,I,P),L=new rr(0,0,I,P);let F=!1;const U=new Vs;let N=!1,j=!1,z=null;const G=new zr,V=new hr,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Q(){return null===E?R:1}let W,q,X,Y,K,Z,$,ee,te,ne,re,ie,se,oe,ae,le,ce,ue,he,pe,de,fe,me,ge,_e=n;function ve(e,n){for(let r=0;r<e.length;r++){const i=e[r],s=t.getContext(i,n);if(null!==s)return s}return null}try{const e={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${r}`),t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",Ce,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===b.isWebGL1Renderer&&t.shift(),_e=ve(t,e),null===_e)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ye(){W=new vo(_e),q=new eo(_e,W,e),W.init(q),fe=new fl(_e,W,q),X=new pl(_e,W,q),Y=new Ao(_e),K=new Za,Z=new dl(_e,W,X,K,q,fe,Y),$=new no(b),ee=new _o(b),te=new Qs(_e,q),me=new Zs(_e,W,te,q),ne=new yo(_e,te,Y,me),re=new Co(_e,ne,te,Y),he=new Eo(_e,q,Z),le=new to(K),ie=new Ja(b,$,ee,W,q,me,le),se=new Al(b,K),oe=new nl,ae=new ll(W,q),ue=new Js(b,$,ee,X,re,p,l),ce=new hl(b,re,q),ge=new wl(_e,Y,q,X),pe=new $s(_e,W,Y,q),de=new bo(_e,W,Y,q),Y.programs=ie.programs,b.capabilities=q,b.extensions=W,b.properties=K,b.renderLists=oe,b.shadowMap=ce,b.state=X,b.info=Y,b.background=ue,b.cubemaps=$,b.cubeuvmaps=ee,b.materials=se}ye();const Ae=new bl(b,_e);function xe(e){e.preventDefault(),A=!0,b.onContextLost(e)}function Ee(){A=!1;const e=b.info?b.info.autoReset:void 0,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,i=ce.type;ye(),b.info&&void 0!==e&&(b.info.autoReset=e),ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=i,b.onContextRestore&&b.onContextRestore()}function Ce(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage),b.onContextCreationError(e)}function Se(e){const t=e.target;t.removeEventListener("dispose",Se),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),K.remove(e)}(t)}this.xr=Ae,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(I,P,!1))},this.getSize=function(e){return e.set(I,P)},this.setSize=function(e,n,r=!0){Ae.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,P=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(I*R,P*R).floor()},this.setDrawingBufferSize=function(e,n,r){I=e,P=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(M)},this.getViewport=function(e){return e.copy(O)},this.setViewport=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),X.viewport(M.copy(O).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,r){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,r),X.scissor(T.copy(L).multiplyScalar(R).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){X.setScissorTest(F=e)},this.setOpaqueSort=function(e){B=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;e&&(r|=_e.COLOR_BUFFER_BIT),t&&(r|=_e.DEPTH_BUFFER_BIT),n&&(r|=_e.STENCIL_BUFFER_BIT),_e.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",Ce,!1),oe.dispose(),ae.dispose(),K.dispose(),$.dispose(),ee.dispose(),re.dispose(),me.dispose(),ge.dispose(),ie.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",Ie),Ae.removeEventListener("sessionend",Pe),z&&(z.dispose(),z=null),Re.stop()},this.renderBufferDirect=function(e,t,n,r,i,s){null===t&&(t=H);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=function(e,t,n,r,i){!0!==t.isScene&&(t=H),Z.resetTextureUnits();const s=t.fog,o=r.isMeshStandardMaterial?t.environment:null,a=null===E?b.outputColorSpace:!0===E.isXRRenderTarget||E.texture.colorSpace&&E.texture.colorSpace!==zt?E.texture.colorSpace:Gt,l=(r.isMeshStandardMaterial?ee:$).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,d=!!n.morphAttributes.color,f=r.toneMapped?b.toneMapping:J,m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,v=K.get(r),y=_.state.lights;if(!0===N&&(!0===j||e!==S)){const t=e===S&&r.id===C;le.setState(r,e,t)}let A=!1;r.version===v.__version?v.needsLights&&v.lightsStateVersion!==y.state.version||v.outputColorSpace!==a||i.isInstancedMesh&&!1===v.instancing?A=!0:i.isInstancedMesh||!0!==v.instancing?i.isSkinnedMesh&&!1===v.skinning?A=!0:i.isSkinnedMesh||!0!==v.skinning?v.envMap!==l||!0===r.fog&&v.fog!==s?A=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===le.numPlanes&&v.numIntersection===le.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==p||v.morphColors!==d||v.toneMapping!==f||!0===q.isWebGL2&&v.morphTargetsCount!==g)&&(A=!0):A=!0:A=!0:A=!0:(A=!0,v.__version=r.version);let w=v.currentProgram;!0===A&&(w=Ue(r,t,i));let x=!1,M=!1,T=!1;const D=w.getUniforms(),I=v.uniforms;if(X.useProgram(w.program)&&(x=!0,M=!0,T=!0),r.id!==C&&(C=r.id,M=!0),x||S!==e){if(D.setValue(_e,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&D.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),S!==e&&(S=e,M=!0,T=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=D.map.cameraPosition;void 0!==t&&t.setValue(_e,V.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&D.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&D.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){D.setOptional(_e,i,"bindMatrix"),D.setOptional(_e,i,"bindMatrixInverse");const e=i.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),D.setValue(_e,"boneTexture",e.boneTexture,Z),D.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const B=n.morphAttributes;var k,O;(void 0!==B.position||void 0!==B.normal||void 0!==B.color&&!0===q.isWebGL2)&&he.update(i,n,w),(M||v.receiveShadow!==i.receiveShadow)&&(v.receiveShadow=i.receiveShadow,D.setValue(_e,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),M&&(D.setValue(_e,"toneMappingExposure",b.toneMappingExposure),v.needsLights&&(O=T,(k=I).ambientLightColor.needsUpdate=O,k.lightProbe.needsUpdate=O,k.directionalLights.needsUpdate=O,k.directionalLightShadows.needsUpdate=O,k.pointLights.needsUpdate=O,k.pointLightShadows.needsUpdate=O,k.spotLights.needsUpdate=O,k.spotLightShadows.needsUpdate=O,k.rectAreaLights.needsUpdate=O,k.hemisphereLights.needsUpdate=O),s&&!0===r.fog&&se.refreshFogUniforms(I,s),se.refreshMaterialUniforms(I,r,R,P,b.userData.transmissionRenderTarget||z),Da.upload(_e,v.uniformsList,I,Z)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Da.upload(_e,v.uniformsList,I,Z),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&D.setValue(_e,"center",i.center),D.setValue(_e,"modelViewMatrix",i.modelViewMatrix),D.setValue(_e,"normalMatrix",i.normalMatrix),D.setValue(_e,"modelMatrix",i.matrixWorld);const L=r.extraUniformsToUpload;if(L&&Object.entries(L).forEach((([e,t])=>D.setValue(_e,e,t.value,Z))),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(q.isWebGL2){const n=e[t];ge.update(n,w),ge.bind(n,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return w}(e,t,n,r,i);X.setMaterial(r,o);let l=n.index,c=1;!0===r.wireframe&&(l=ne.getWireframeAttribute(n),c=2);const u=n.drawRange,h=n.attributes.position;let p=u.start*c,d=(u.start+u.count)*c;null!==s&&(p=Math.max(p,s.start*c),d=Math.min(d,(s.start+s.count)*c)),null!==l?(p=Math.max(p,0),d=Math.min(d,l.count)):null!=h&&(p=Math.max(p,0),d=Math.min(d,h.count));const f=d-p;if(f<0||f===1/0)return;let m;me.setup(i,r,a,n,l);let g=pe;if(null!==l&&(m=te.get(l),g=de,g.setIndex(m)),i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*Q()),g.setMode(_e.LINES)):g.setMode(_e.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*Q()),i.isLineSegments?g.setMode(_e.LINES):i.isLineLoop?g.setMode(_e.LINE_LOOP):g.setMode(_e.LINE_STRIP)}else i.isPoints?g.setMode(_e.POINTS):i.isSprite&&g.setMode(_e.TRIANGLES);if(i.isInstancedMesh)g.renderInstances(p,f,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(p,f,t)}else g.render(p,f)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===g&&!1===e.forceSinglePass?(e.side=m,e.needsUpdate=!0,Ue(e,t,n),e.side=f,e.needsUpdate=!0,Ue(e,t,n),e.side=g):Ue(e,t,n)}_=ae.get(e),_.init(),y.push(_),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),_.setupLights(b.useLegacyLights),e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++)n(r[i],e,t);else n(r,e,t)})),y.pop(),_=null};let Me=null;function Ie(){Re.stop()}function Pe(){Re.start()}const Re=new Hs;function Be(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)_.pushLight(e),e.castShadow&&_.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=re.update(e),i=e.material;i.visible&&d.push(e,t,i,n,V.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(),e.skeleton.frame=Y.render.frame);const t=re.update(e),i=e.material;if(r&&(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(G)),Array.isArray(i)){const r=t.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&d.push(e,t,a,n,V.z,o)}}else i.visible&&d.push(e,t,i,n,V.z,null)}const i=e.children;for(let e=0,s=i.length;e<s;e++)Be(i[e],t,n,r)}function Oe(e,t,n,r){const i=e.opaque,s=e.transmissive,o=e.transparent;if(_.setupLightsView(n),!0===N&&le.setGlobalState(b.clippingPlanes,n),void 0===b.userData.transmissionRender&&!1!==b.userData.renderTransmissionPass&&s.length>0&&function(e,t,n,r){if(console.warn("three.js internal render transmission pass should not be called"),null===z){const e=q.isWebGL2;z=new ir(1024,1024,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?De:we,minFilter:be,samples:e&&!0===a?4:0})}const i=b.getRenderTarget();b.setRenderTarget(z),b.clear();const s=b.toneMapping;b.toneMapping=J,Le(e,n,r),Z.updateMultisampleRenderTarget(z),Z.updateRenderTargetMipmap(z);let o=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.object,a=i.geometry,l=i.material,c=i.group;if(l.side===g&&s.layers.test(r.layers)){const e=l.side;l.side=m,l.needsUpdate=!0,Fe(s,n,r,a,l,c),l.side=e,l.needsUpdate=!0,o=!0}}!0===o&&(Z.updateMultisampleRenderTarget(z),Z.updateRenderTargetMipmap(z)),b.setRenderTarget(i),b.toneMapping=s}([...i,...o],s,t,n),r&&X.viewport(M.copy(r)),!1!==b.userData.opaqueRender&&i.length>0&&Le(i,t,n),!1!==b.userData.transparentRender&&o.length>0&&Le(o,t,n),!1!==b.userData.transmissionRender&&s.length>0){z||(z=new ir(1,1));const e=(b.userData.transmissionRenderTarget||z).texture,r=q.isWebGL2,i=e.generateMipmaps,o=e.minFilter;r&&b.userData.blurTransmissionTarget&&b.userData.transmissionRenderTarget&&(e.generateMipmaps=!0,e.minFilter=be,e.needsUpdate=!0,Z.updateMultisampleRenderTarget(b.userData.transmissionRenderTarget),Z.updateRenderTargetMipmap(b.userData.transmissionRenderTarget)),Le(s,t,n),r&&b.userData.blurTransmissionTarget&&b.userData.transmissionRenderTarget&&(e.generateMipmaps=i,e.minFilter=o,e.needsUpdate=!0,Z.updateMultisampleRenderTarget(b.userData.transmissionRenderTarget),Z.updateRenderTargetMipmap(b.userData.transmissionRenderTarget))}X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function Le(e,t,n){const r={...b.userData};b.userData.opaqueRender=void 0,b.userData.transparentRender=void 0,b.userData.transmissionRender=void 0,b.userData.backgroundRender=void 0;const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===i?s.material:i,c=s.group;o.layers.test(n.layers)&&Fe(o,t,n,a,l,c)}Object.assign(b.userData,r)}function Fe(e,t,n,r,i,s){e.onBeforeRender(b,t,n,r,i,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(b,t,n,r,e,s),!0===i.transparent&&i.side===g&&!1===i.forceSinglePass?(i.side=m,i.needsUpdate=!0,b.renderBufferDirect(n,t,r,i,e,s),i.side=f,i.needsUpdate=!0,b.renderBufferDirect(n,t,r,i,e,s),i.side=g):b.renderBufferDirect(n,t,r,i,e,s),e.onAfterRender(b,t,n,r,i,s),i.onAfterRender(b,t,n,r,e,s)}function Ue(e,t,n){!0!==t.isScene&&(t=H);const r=K.get(e),i=_.state.lights,s=_.state.shadowsArray,o=i.state.version,a=ie.getParameters(e,i.state,s,t,n),l=ie.getProgramCacheKey(a);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:$).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Se),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Ne(e,a),u}else a.uniforms=ie.getUniforms(e),e.onBuild(n,a,b),e.onBeforeCompile(a,b),u=ie.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=le.uniform),Ne(e,a),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=u.getUniforms(),d=Da.seqWithValue(p.seq,h);return r.currentProgram=u,r.uniformsList=d,u}function Ne(e,t){const n=K.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){Me&&Me(e)})),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Me=e,Ae.setAnimationLoop(e),null===e?Re.stop():Re.start()},Ae.addEventListener("sessionstart",Ie),Ae.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==A){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ae.enabled&&!0===Ae.isPresenting&&(!0===Ae.cameraAutoUpdate&&Ae.updateCamera(t),t=Ae.getCamera()),!0===e.isScene&&e.onBeforeRender(b,e,t,E),_=ae.get(e,y.length),_.init(),y.push(_),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(G),j=this.localClippingEnabled,N=le.init(this.clippingPlanes,j),d=oe.get(e,v.length),d.init(),v.push(d),Be(e,t,0,b.sortObjects),d.finish(),!0===b.sortObjects&&d.sort(B,k),!1!==b.userData.shadowMapRender){!0===N&&le.beginShadows();const n=_.state.shadowsArray;n.length>0&&ce.render(n,e,t),!0===N&&le.endShadows()}if(!0===this.info.autoReset&&this.info.reset(),!1!==b.userData.backgroundRender&&ue.render(d,e),!1!==b.userData.sceneRender)if(_.setupLights(b.useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Oe(d,e,r,r.viewport)}}else Oe(d,e,t);null!==E&&(Z.updateMultisampleRenderTarget(E),Z.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(b,e,t),me.resetDefaultState(),C=-1,S=null,y.pop(),_=y.length>0?y[y.length-1]:null,v.pop(),d=v.length>0?v[v.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=n;const r=K.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=K.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){E=e,w=t,x=n;let r=!0,i=null,s=!1,o=!1;if(e){const n=K.get(e);void 0!==n.__useDefaultFramebuffer?(X.bindFramebuffer(_e.FRAMEBUFFER,null),r=!1):void 0===n.__webglFramebuffer?Z.setupRenderTarget(e):n.__hasExternalTextures&&Z.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);const a=e.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=!0);const l=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=l[t],s=!0):i=q.isWebGL2&&e.samples>0&&!1===Z.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:l,M.copy(e.viewport),T.copy(e.scissor),D=e.scissorTest}else M.copy(O).multiplyScalar(R).floor(),T.copy(L).multiplyScalar(R).floor(),D=F;if(X.bindFramebuffer(_e.FRAMEBUFFER,i)&&q.drawBuffers&&r&&X.drawBuffers(e,i),X.viewport(M),X.scissor(T),X.setScissorTest(D),s){const r=K.get(e.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(o){const r=K.get(e.texture),i=t||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}C=-1},this.readRenderTargetPixels=function(e,t,n,r,i,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){X.bindFramebuffer(_e.FRAMEBUFFER,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==ke&&fe.convert(a)!==_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===De&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===we||fe.convert(l)===_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_TYPE)||l===Te&&(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&_e.readPixels(t,n,r,i,fe.convert(a),fe.convert(l),s)}finally{const e=E?K.get(E).__webglFramebuffer:null;X.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),s=Math.floor(t.image.height*r);Z.setTexture2D(t,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,n,0,0,e.x,e.y,i,s),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,s=t.image.height,o=fe.convert(n.format),a=fe.convert(n.type);Z.setTexture2D(n,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,n.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,i,s,o,a,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):_e.texSubImage2D(_e.TEXTURE_2D,r,e.x,e.y,o,a,t.image),0===r&&n.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(b.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=fe.convert(r.format),c=fe.convert(r.type);let u;if(r.isData3DTexture)Z.setTexture3D(r,0),u=_e.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Z.setTexture2DArray(r,0),u=_e.TEXTURE_2D_ARRAY}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,r.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,r.unpackAlignment);const h=_e.getParameter(_e.UNPACK_ROW_LENGTH),p=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),d=_e.getParameter(_e.UNPACK_SKIP_PIXELS),f=_e.getParameter(_e.UNPACK_SKIP_ROWS),m=_e.getParameter(_e.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,g.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,g.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,e.min.x),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,e.min.y),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?_e.texSubImage3D(u,i,t.x,t.y,t.z,s,o,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(u,i,t.x,t.y,t.z,s,o,a,l,g.data)):_e.texSubImage3D(u,i,t.x,t.y,t.z,s,o,a,l,c,g),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,h),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,p),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,d),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,f),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&_e.generateMipmap(u),X.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Z.setTextureCube(e,0):e.isData3DTexture?Z.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Z.setTexture2DArray(e,0):Z.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){w=0,x=0,E=null,X.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===zt?Ot:kt}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ot?zt:Gt}}class Cl extends El{}Cl.prototype.isWebGL1Renderer=!0;class Sl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ri(e),this.density=t}clone(){return new Sl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Ml{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ri(e),this.near=t,this.far=n}clone(){return new Ml(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Tl extends pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Dl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ln,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Cn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Cn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Cn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Il=new hr;class Pl{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Il.fromBufferAttribute(this,t),Il.applyMatrix4(e),this.setXYZ(t,Il.x,Il.y,Il.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Il.fromBufferAttribute(this,t),Il.applyNormalMatrix(e),this.setXYZ(t,Il.x,Il.y,Il.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Il.fromBufferAttribute(this,t),Il.transformDirection(e),this.setXYZ(t,Il.x,Il.y,Il.z);return this}setX(e,t){return this.normalized&&(t=Bn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Bn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Bn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Bn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Rn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Rn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Rn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Rn(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bn(t,this.array),n=Bn(n,this.array),r=Bn(r,this.array),i=Bn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new zi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Pl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Rl extends Si{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Bl;const kl=new hr,Ol=new hr,Ll=new hr,Fl=new On,Ul=new On,Nl=new zr,jl=new hr,zl=new hr,Gl=new hr,Vl=new On,Hl=new On,Ql=new On;class Wl extends pi{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Bl){Bl=new ss;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Dl(e,5);Bl.setIndex([0,1,2,0,2,3]),Bl.setAttribute("position",new Pl(t,3,0,!1)),Bl.setAttribute("uv",new Pl(t,2,3,!1))}this.geometry=Bl,this.material=void 0!==e?e:new Rl,this.center=new On(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ol.setFromMatrixScale(this.matrixWorld),Nl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ll.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ol.multiplyScalar(-Ll.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;ql(jl.set(-.5,-.5,0),Ll,s,Ol,r,i),ql(zl.set(.5,-.5,0),Ll,s,Ol,r,i),ql(Gl.set(.5,.5,0),Ll,s,Ol,r,i),Vl.set(0,0),Hl.set(1,0),Ql.set(1,1);let o=e.ray.intersectTriangle(jl,zl,Gl,!1,kl);if(null===o&&(ql(zl.set(-.5,.5,0),Ll,s,Ol,r,i),Hl.set(0,1),o=e.ray.intersectTriangle(jl,Gl,zl,!1,kl),null===o))return;const a=e.ray.origin.distanceTo(kl);a<e.near||a>e.far||t.push({distance:a,point:kl.clone(),uv:Ei.getInterpolation(kl,jl,zl,Gl,Vl,Hl,Ql,new On),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function ql(e,t,n,r,i,s){Fl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Ul.x=s*Fl.x-i*Fl.y,Ul.y=i*Fl.x+s*Fl.y):Ul.copy(Fl),e.copy(t),e.x+=Ul.x,e.y+=Ul.y,e.applyMatrix4(Nl)}const Xl=new hr,Yl=new hr;class Kl extends pi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Xl.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Xl);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Xl.setFromMatrixPosition(e.matrixWorld),Yl.setFromMatrixPosition(this.matrixWorld);const n=Xl.distanceTo(Yl)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}}const Jl=new hr,Zl=new rr,$l=new rr,ec=new hr,tc=new zr,nc=new hr;class rc extends xs{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new zr,this.bindMatrixInverse=new zr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new fr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)nc.fromBufferAttribute(t,e),this.applyBoneTransform(e,nc),this.boundingBox.expandByPoint(nc)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Rr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)nc.fromBufferAttribute(t,e),this.applyBoneTransform(e,nc),this.boundingSphere.expandByPoint(nc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;Zl.fromBufferAttribute(r.attributes.skinIndex,e),$l.fromBufferAttribute(r.attributes.skinWeight,e),Jl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=$l.getComponent(e);if(0!==r){const i=Zl.getComponent(e);tc.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(ec.copy(Jl).applyMatrix4(tc),r)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class ic extends pi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class sc extends nr{constructor(e=null,t=1,n=1,r,i,s,o,a,l=pe,c=pe,u,h){super(null,s,o,a,l,c,r,i,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const oc=new zr,ac=new zr;class lc{constructor(e=[],t=[]){this.uuid=Cn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new zr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new zr;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:ac;oc.multiplyMatrices(i,t[r]),oc.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new lc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=In(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new sc(t,e,e,ke,Te);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new ic),this.bones.push(i),this.boneInverses.push((new zr).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const s=n[r];e.boneInverses.push(s.toArray())}return e}}class cc extends zi{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const uc=new zr,hc=new zr,pc=[],dc=new fr,fc=new zr,mc=new xs,gc=new Rr;class _c extends xs{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new cc(new Float32Array(16*n),16),this.instanceColor=null,this.sourceTrs=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,fc)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new fr),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,uc),dc.copy(e.boundingBox).applyMatrix4(uc),this.boundingBox.union(dc)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Rr),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,uc),gc.copy(e.boundingSphere).applyMatrix4(uc),this.boundingSphere.union(gc)}copy(e,t){return super.copy(e,t),e.isInstancedMesh?(this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this):this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(mc.geometry=this.geometry,mc.material=this.material,void 0!==mc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),gc.copy(this.boundingSphere),gc.applyMatrix4(n),!1!==e.ray.intersectsSphere(gc)))for(let i=0;i<r;i++){this.getMatrixAt(i,uc),hc.multiplyMatrices(n,uc),mc.matrixWorld=hc,mc.raycast(e,pc);for(let e=0,n=pc.length;e<n;e++){const n=pc[e];n.instanceId=i,n.object=this,t.push(n)}pc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new cc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class vc extends Si{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ri(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const yc=new hr,bc=new hr,Ac=new zr,wc=new jr,xc=new Rr;class Ec extends pi{constructor(e=new ss,t=new vc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)yc.fromBufferAttribute(t,e-1),bc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=yc.distanceTo(bc);e.setAttribute("lineDistance",new Ki(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),xc.copy(n.boundingSphere),xc.applyMatrix4(r),xc.radius+=i,!1===e.ray.intersectsSphere(xc))return;Ac.copy(r).invert(),wc.copy(e.ray).applyMatrix4(Ac);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new hr,c=new hr,u=new hr,h=new hr,p=this.isLineSegments?2:1,d=n.index,f=n.attributes.position;if(null!==d)for(let n=Math.max(0,s.start),r=Math.min(d.count,s.start+s.count)-1;n<r;n+=p){const r=d.getX(n),i=d.getX(n+1);if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,i),wc.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),r=Math.min(f.count,s.start+s.count)-1;n<r;n+=p){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),wc.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Cc=new hr,Sc=new hr;class Mc extends Ec{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Cc.fromBufferAttribute(t,e),Sc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Cc.distanceTo(Sc);e.setAttribute("lineDistance",new Ki(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Tc extends Ec{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Dc extends Si{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Ic=new zr,Pc=new jr,Rc=new Rr,Bc=new hr;class kc extends pi{constructor(e=new ss,t=new Dc){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Rc.copy(n.boundingSphere),Rc.applyMatrix4(r),Rc.radius+=i,!1===e.ray.intersectsSphere(Rc))return;Ic.copy(r).invert(),Pc.copy(e.ray).applyMatrix4(Ic);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l)for(let n=Math.max(0,s.start),i=Math.min(l.count,s.start+s.count);n<i;n++){const i=l.getX(n);Bc.fromBufferAttribute(c,i),Oc(Bc,i,a,r,e,t,this)}else for(let n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);n<i;n++)Bc.fromBufferAttribute(c,n),Oc(Bc,n,a,r,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Oc(e,t,n,r,i,s,o){const a=Pc.distanceSqToPoint(e);if(a<n){const n=new hr;Pc.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:o})}}class Lc extends nr{constructor(e,t,n,r,i,s,o,a,l){super(e,t,n,r,i,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:_e,this.magFilter=void 0!==i?i:_e,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Fc extends nr{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=pe,this.minFilter=pe,this.generateMipmaps=!1,this.needsUpdate=!0}}class Uc extends nr{constructor(e,t,n,r,i,s,o,a,l,c,u,h){super(null,s,o,a,l,c,r,i,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Nc extends Uc{constructor(e,t,n,r,i,s){super(e,t,n,i,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ue}}class jc extends nr{constructor(e,t,n,r,i,s,o,a,l){super(e,t,n,r,i,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class zc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let s;s=t||e*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const c=n[r];return(r+(s-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=t||(s.isVector2?new On:new hr);return a.copy(o).sub(s).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new hr,r=[],i=[],s=[],o=new hr,a=new zr;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new hr)}i[0]=new hr,s[0]=new hr;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(r[t-1],r[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Sn(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Sn(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Gc extends zc{constructor(e=0,t=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const n=t||new On,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Vc extends Gc{constructor(e,t,n,r,i,s){super(e,t,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Hc(){let e=0,t=0,n=0,r=0;function i(i,s,o,a){e=i,t=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(e,t,n,r,s){i(t,n,s*(n-e),s*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,s,o,a){let l=(t-e)/s-(n-e)/(s+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+a)+(r-n)/a;l*=o,c*=o,i(t,n,l,c)},calc:function(i){const s=i*i;return e+t*i+n*s+r*(s*i)}}}const Qc=new hr,Wc=new Hc,qc=new Hc,Xc=new Hc;class Yc extends zc{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new hr){const n=t,r=this.points,i=r.length,s=(i-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(Qc.subVectors(r[0],r[1]).add(r[0]),o=Qc);const u=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(Qc.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Qc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Wc.initNonuniformCatmullRom(o.x,u.x,h.x,a.x,t,n,r),qc.initNonuniformCatmullRom(o.y,u.y,h.y,a.y,t,n,r),Xc.initNonuniformCatmullRom(o.z,u.z,h.z,a.z,t,n,r)}else"catmullrom"===this.curveType&&(Wc.initCatmullRom(o.x,u.x,h.x,a.x,this.tension),qc.initCatmullRom(o.y,u.y,h.y,a.y,this.tension),Xc.initCatmullRom(o.z,u.z,h.z,a.z,this.tension));return n.set(Wc.calc(c),qc.calc(c),Xc.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new hr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Kc(e,t,n,r,i){const s=.5*(r-t),o=.5*(i-n),a=e*e;return(2*n-2*r+s+o)*(e*a)+(-3*n+3*r-2*s-o)*a+s*e+n}function Jc(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Zc(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class $c extends zc{constructor(e=new On,t=new On,n=new On,r=new On){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new On){const n=t,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Zc(e,r.x,i.x,s.x,o.x),Zc(e,r.y,i.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class eu extends zc{constructor(e=new hr,t=new hr,n=new hr,r=new hr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new hr){const n=t,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Zc(e,r.x,i.x,s.x,o.x),Zc(e,r.y,i.y,s.y,o.y),Zc(e,r.z,i.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class tu extends zc{constructor(e=new On,t=new On){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new On){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new On){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class nu extends zc{constructor(e=new hr,t=new hr){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new hr){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new hr){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ru extends zc{constructor(e=new On,t=new On,n=new On){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new On){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(Jc(e,r.x,i.x,s.x),Jc(e,r.y,i.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iu extends zc{constructor(e=new hr,t=new hr,n=new hr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new hr){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(Jc(e,r.x,i.x,s.x),Jc(e,r.y,i.y,s.y),Jc(e,r.z,i.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class su extends zc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new On){const n=t,r=this.points,i=(r.length-1)*e,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return n.set(Kc(o,a.x,l.x,c.x,u.x),Kc(o,a.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new On).fromArray(n))}return this}}var ou=Object.freeze({__proto__:null,ArcCurve:Vc,CatmullRomCurve3:Yc,CubicBezierCurve:$c,CubicBezierCurve3:eu,EllipseCurve:Gc,LineCurve:tu,LineCurve3:nu,QuadraticBezierCurve:ru,QuadraticBezierCurve3:iu,SplineCurve:su});class au extends zc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new tu(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,s=this.curves[i],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new ou[n.type]).fromJSON(n))}return this}}class lu extends au{constructor(e){super(),this.type="Path",this.currentPoint=new On,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new tu(this.currentPoint.clone(),new On(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new ru(this.currentPoint.clone(),new On(e,t),new On(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,s){const o=new $c(this.currentPoint.clone(),new On(e,t),new On(n,r),new On(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new su(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,n,r,i,s),this}absarc(e,t,n,r,i,s){return this.absellipse(e,t,n,n,r,i,s),this}ellipse(e,t,n,r,i,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,s,o,a),this}absellipse(e,t,n,r,i,s,o,a){const l=new Gc(e,t,n,r,i,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class cu extends ss{constructor(e=[new On(0,-.5),new On(.5,0),new On(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Sn(r,0,2*Math.PI);const i=[],s=[],o=[],a=[],l=[],c=1/t,u=new hr,h=new On,p=new hr,d=new hr,f=new hr;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,p.x=1*g,p.y=-m,p.z=0*g,f.copy(p),p.normalize(),a.push(p.x,p.y,p.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,p.x=1*g,p.y=-m,p.z=0*g,d.copy(p),p.x+=f.x,p.y+=f.y,p.z+=f.z,p.normalize(),a.push(p.x,p.y,p.z),f.copy(d)}for(let i=0;i<=t;i++){const p=n+i*c*r,d=Math.sin(p),f=Math.cos(p);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*f,s.push(u.x,u.y,u.z),h.x=i/t,h.y=n/(e.length-1),o.push(h.x,h.y);const r=a[3*n+0]*d,c=a[3*n+1],p=a[3*n+0]*f;l.push(r,c,p)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,s=r,o=r+e.length,a=r+e.length+1,l=r+1;i.push(s,o,l),i.push(a,l,o)}this.setIndex(i),this.setAttribute("position",new Ki(s,3)),this.setAttribute("uv",new Ki(o,2)),this.setAttribute("normal",new Ki(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cu(e.points,e.segments,e.phiStart,e.phiLength)}}class uu extends cu{constructor(e=1,t=1,n=4,r=8){const i=new lu;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new uu(e.radius,e.length,e.capSegments,e.radialSegments)}}class hu extends ss{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],s=[],o=[],a=[],l=new hr,c=new On;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[u]/e+1)/2,c.y=(s[u+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new Ki(s,3)),this.setAttribute("normal",new Ki(o,3)),this.setAttribute("uv",new Ki(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hu(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class pu extends ss{constructor(e=1,t=1,n=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],p=[];let d=0;const f=[],m=n/2;let g=0;function _(n){const i=d,s=new On,f=new hr;let _=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*y,0),h.push(0,y,0),p.push(.5,.5),d++;const b=d;for(let e=0;e<=r;e++){const t=e/r*a+o,n=Math.cos(t),i=Math.sin(t);f.x=v*i,f.y=m*y,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,y,0),s.x=.5*n+.5,s.y=.5*i*y+.5,p.push(s.x,s.y),d++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),_+=3}l.addGroup(g,_,!0===n?1:2),g+=_}!function(){const s=new hr,_=new hr;let v=0;const y=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,v=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*a+o,l=Math.sin(i),f=Math.cos(i);_.x=v*l,_.y=-g*n+m,_.z=v*f,u.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),h.push(s.x,s.y,s.z),p.push(t,1-g),c.push(d++)}f.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],s=f[t][e+1];c.push(n,r,s),c.push(r,i,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Ki(u,3)),this.setAttribute("normal",new Ki(h,3)),this.setAttribute("uv",new Ki(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class du extends pu{constructor(e=1,t=1,n=32,r=1,i=!1,s=0,o=2*Math.PI){super(0,e,t,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(e){return new du(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class fu extends ss{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],s=[];function o(e,t,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const o=e.clone().lerp(n,r/i),a=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)s[r][e]=0===e&&r===i?o:o.clone().lerp(a,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(s[e][n+1]),a(s[e+1][n]),a(s[e][n])):(a(s[e][n+1]),a(s[e+1][n+1]),a(s[e+1][n]))}}function a(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new hr,r=new hr,i=new hr;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],r),l(t[s+2],i),o(n,r,i,e)}(r),function(e){const t=new hr;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new hr;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(r,1-o)}var t;(function(){const e=new hr,t=new hr,n=new hr,r=new hr,o=new On,a=new On,l=new On;for(let h=0,p=0;h<i.length;h+=9,p+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(s[p+0],s[p+1]),a.set(s[p+2],s[p+3]),l.set(s[p+4],s[p+5]),r.copy(e).add(t).add(n).divideScalar(3);const d=u(r);c(o,p+0,e,d),c(a,p+2,t,d),c(l,p+4,n,d)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);i>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new Ki(i,3)),this.setAttribute("normal",new Ki(i.slice(),3)),this.setAttribute("uv",new Ki(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fu(e.vertices,e.indices,e.radius,e.details)}}class mu extends fu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mu(e.radius,e.detail)}}const gu=new hr,_u=new hr,vu=new hr,yu=new Ei;class bu extends ss{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(xn*t),s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},p=[];for(let e=0;e<a;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=yu;if(t.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),yu.getNormal(vu),u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],s=yu[c[e]],o=yu[c[t]],a=`${n}_${r}`,d=`${r}_${n}`;d in h&&h[d]?(vu.dot(h[d].normal)<=i&&(p.push(s.x,s.y,s.z),p.push(o.x,o.y,o.z)),h[d]=null):a in h||(h[a]={index0:l[e],index1:l[t],normal:vu.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];gu.fromBufferAttribute(o,t),_u.fromBufferAttribute(o,n),p.push(gu.x,gu.y,gu.z),p.push(_u.x,_u.y,_u.z)}this.setAttribute("position",new Ki(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Au extends lu{constructor(e){super(e),this.uuid=Cn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new lu).fromJSON(n))}return this}}function wu(e,t,n,r,i){let s,o;if(i===function(e,t,n,r){let i=0;for(let s=t,o=n-r;s<n;s+=r)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}(e,t,n,r)>0)for(s=t;s<n;s+=r)o=Vu(s,e[s],e[s+1],o);else for(s=n-r;s>=t;s-=r)o=Vu(s,e[s],e[s+1],o);return o&&Fu(o,o.next)&&(Hu(o),o=o.next),o}function xu(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Fu(r,r.next)&&0!==Lu(r.prev,r,r.next))r=r.next;else{if(Hu(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Eu(e,t,n,r,i,s,o){if(!e)return;!o&&s&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Ru(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,s,o,a,l,c=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ,r);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(e,r,i,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Su(e,r,i,s):Cu(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Hu(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Eu(e=Mu(xu(e),t,n),t,n,r,i,s,2):2===o&&Tu(e,t,n,r,i,s):Eu(xu(e),t,n,r,i,s,1);break}}function Cu(e){const t=e.prev,n=e,r=e.next;if(Lu(t,n,r)>=0)return!1;const i=t.x,s=n.x,o=r.x,a=t.y,l=n.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,p=i>s?i>o?i:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=p&&f.y>=h&&f.y<=d&&ku(i,a,s,l,o,c,f.x,f.y)&&Lu(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Su(e,t,n,r){const i=e.prev,s=e,o=e.next;if(Lu(i,s,o)>=0)return!1;const a=i.x,l=s.x,c=o.x,u=i.y,h=s.y,p=o.y,d=a<l?a<c?a:c:l<c?l:c,f=u<h?u<p?u:p:h<p?h:p,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>p?u:p:h>p?h:p,_=Ru(d,f,t,n,r),v=Ru(m,g,t,n,r);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=_&&b&&b.z<=v;){if(y.x>=d&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&ku(a,u,l,h,c,p,y.x,y.y)&&Lu(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=d&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&ku(a,u,l,h,c,p,b.x,b.y)&&Lu(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=d&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==o&&ku(a,u,l,h,c,p,y.x,y.y)&&Lu(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=d&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&ku(a,u,l,h,c,p,b.x,b.y)&&Lu(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Mu(e,t,n){let r=e;do{const i=r.prev,s=r.next.next;!Fu(i,s)&&Uu(i,r,r.next,s)&&zu(i,s)&&zu(s,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(s.i/n|0),Hu(r),Hu(r.next),r=e=s),r=r.next}while(r!==e);return xu(r)}function Tu(e,t,n,r,i,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Ou(o,e)){let a=Gu(o,e);return o=xu(o,o.next),a=xu(a,a.next),Eu(o,t,n,r,i,s,0),void Eu(a,t,n,r,i,s,0)}e=e.next}o=o.next}while(o!==e)}function Du(e,t){return e.x-t.x}function Iu(e,t){const n=function(e,t){let n,r=t,i=-1/0;const s=e.x,o=e.y;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){const e=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=s&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===s))return n}r=r.next}while(r!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;r=n;do{s>=r.x&&r.x>=l&&s!==r.x&&ku(o<c?s:i,o,l,c,o<c?i:s,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(s-r.x),zu(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Pu(n,r)))&&(n=r,h=u)),r=r.next}while(r!==a);return n}(e,t);if(!n)return t;const r=Gu(n,e);return xu(r,r.next),xu(n,n.next)}function Pu(e,t){return Lu(e.prev,e,t.prev)<0&&Lu(t.next,e,e.next)<0}function Ru(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Bu(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ku(e,t,n,r,i,s,o,a){return(i-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(r-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function Ou(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Uu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(zu(e,t)&&zu(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Lu(e.prev,e,t.prev)||Lu(e,t.prev,t))||Fu(e,t)&&Lu(e.prev,e,e.next)>0&&Lu(t.prev,t,t.next)>0)}function Lu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Fu(e,t){return e.x===t.x&&e.y===t.y}function Uu(e,t,n,r){const i=ju(Lu(e,t,n)),s=ju(Lu(e,t,r)),o=ju(Lu(n,r,e)),a=ju(Lu(n,r,t));return i!==s&&o!==a||!(0!==i||!Nu(e,n,t))||!(0!==s||!Nu(e,r,t))||!(0!==o||!Nu(n,e,r))||!(0!==a||!Nu(n,t,r))}function Nu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ju(e){return e>0?1:e<0?-1:0}function zu(e,t){return Lu(e.prev,e,e.next)<0?Lu(e,t,e.next)>=0&&Lu(e,e.prev,t)>=0:Lu(e,t,e.prev)<0||Lu(e,e.next,t)<0}function Gu(e,t){const n=new Qu(e.i,e.x,e.y),r=new Qu(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Vu(e,t,n,r){const i=new Qu(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Hu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Wu{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Wu.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];qu(e),Xu(n,e);let s=e.length;t.forEach(qu);for(let e=0;e<t.length;e++)r.push(s),s+=t[e].length,Xu(n,t[e]);const o=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let s=wu(e,0,i,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,p,d;if(r&&(s=function(e,t,n,r){const i=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)a=t[s]*r,l=s<o-1?t[s+1]*r:e.length,c=wu(e,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Bu(c));for(i.sort(Du),s=0;s<i.length;s++)n=Iu(i[s],n);return n}(e,t,s,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],p=e[t+1],h<a&&(a=h),p<l&&(l=p),h>c&&(c=h),p>u&&(u=p);d=Math.max(c-a,u-l),d=0!==d?32767/d:0}return Eu(s,o,n,a,l,d,0),o}(n,r);for(let e=0;e<o.length;e+=3)i.push(o.slice(e,e+3));return i}}function qu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Xu(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Yu extends ss{constructor(e=new Au([new On(.5,.5),new On(-.5,.5),new On(-.5,-.5),new On(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)s(e[t]);function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,p=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Ku;let g,_,v,y,b,A=!1;f&&(g=f.getSpacedPoints(a),A=!0,c=!1,_=f.computeFrenetFrames(a,!1),v=new hr,y=new hr,b=new hr),c||(d=0,u=0,h=0,p=0);const w=e.extractPoints(o);let x=w.shape;const E=w.holes;if(!Wu.isClockWise(x)){x=x.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];Wu.isClockWise(t)&&(E[e]=t.reverse())}}const C=Wu.triangulateShape(x,E),S=x;for(let e=0,t=E.length;e<t;e++){const t=E[e];x=x.concat(t)}function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const T=x.length,D=C.length;function I(e,t,n){let r,i,s;const o=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),p=Math.sqrt(l*l+c*c),d=t.x-a/h,f=t.y+o/h,m=((n.x-c/p-d)*c-(n.y+l/p-f)*l)/(o*c-a*l);r=d+o*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new On(r,i);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new On(r/s,i/s)}const P=[];for(let e=0,t=S.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),P[e]=I(S[e],S[n],S[r]);const R=[];let B,k=P.concat();for(let e=0,t=E.length;e<t;e++){const t=E[e];B=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),B[e]=I(t[e],t[r],t[i]);R.push(B),k=k.concat(B)}for(let e=0;e<d;e++){const t=e/d,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+p;for(let e=0,t=S.length;e<t;e++){const t=M(S[e],P[e],r);F(t.x,t.y,-n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];B=R[e];for(let e=0,i=t.length;e<i;e++){const i=M(t[e],B[e],r);F(i.x,i.y,-n)}}}const O=h+p;for(let e=0;e<T;e++){const t=c?M(x[e],k[e],O):x[e];A?(y.copy(_.normals[0]).multiplyScalar(t.x),v.copy(_.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(y).add(v),F(b.x,b.y,b.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<T;t++){const n=c?M(x[t],k[t],O):x[t];A?(y.copy(_.normals[e]).multiplyScalar(n.x),v.copy(_.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(y).add(v),F(b.x,b.y,b.z)):F(n.x,n.y,l/a*e)}for(let e=d-1;e>=0;e--){const t=e/d,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+p;for(let e=0,t=S.length;e<t;e++){const t=M(S[e],P[e],r);F(t.x,t.y,l+n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];B=R[e];for(let e=0,i=t.length;e<i;e++){const i=M(t[e],B[e],r);A?F(i.x,i.y+g[a-1].y,g[a-1].x+n):F(i.x,i.y,l+n)}}}function L(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*d;e<n;e++){const n=T*e,s=T*(e+1);N(t+r+n,t+i+n,t+i+s,t+r+s)}}}function F(e,t,n){s.push(e),s.push(t),s.push(n)}function U(e,t,i){j(e),j(t),j(i);const s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[2])}function N(e,t,i,s){j(e),j(t),j(s),j(t),j(i),j(s);const o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);z(a[0]),z(a[1]),z(a[3]),z(a[1]),z(a[2]),z(a[3])}function j(e){r.push(s[3*e+0]),r.push(s[3*e+1]),r.push(s[3*e+2])}function z(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=T*e;for(let e=0;e<D;e++){const n=C[e];U(n[2]+t,n[1]+t,n[0]+t)}e=a+2*d,t=T*e;for(let e=0;e<D;e++){const n=C[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<D;e++){const t=C[e];U(t[2],t[1],t[0])}for(let e=0;e<D;e++){const t=C[e];U(t[0]+T*a,t[1]+T*a,t[2]+T*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;L(S,t),t+=S.length;for(let e=0,n=E.length;e<n;e++){const n=E[e];L(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Ki(r,3)),this.setAttribute("uv",new Ki(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new ou[r.type]).fromJSON(r)),new Yu(n,e.options)}}const Ku={generateTopUV:function(e,t,n,r,i){const s=t[3*n],o=t[3*n+1],a=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new On(s,o),new On(a,l),new On(c,u)]},generateSideWallUV:function(e,t,n,r,i,s){const o=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],p=t[3*i],d=t[3*i+1],f=t[3*i+2],m=t[3*s],g=t[3*s+1],_=t[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new On(o,1-l),new On(c,1-h),new On(p,1-f),new On(m,1-_)]:[new On(a,1-l),new On(u,1-h),new On(d,1-f),new On(g,1-_)]}};class Ju extends fu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ju(e.radius,e.detail)}}class Zu extends fu{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Zu(e.radius,e.detail)}}class $u extends ss{constructor(e=.5,t=1,n=32,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),p=new hr,d=new On;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*s;p.x=u*Math.cos(r),p.y=u*Math.sin(r),a.push(p.x,p.y,p.z),l.push(0,0,1),d.x=(p.x/t+1)/2,d.y=(p.y/t+1)/2,c.push(d.x,d.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,s=r+n+1,a=r+n+2,l=r+1;o.push(i,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Ki(a,3)),this.setAttribute("normal",new Ki(l,3)),this.setAttribute("uv",new Ki(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $u(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class eh extends ss{constructor(e=new Au([new On(0,.5),new On(-.5,-.5),new On(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Wu.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===Wu.isClockWise(t)&&(u[e]=t.reverse())}const h=Wu.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+o,i=t[1]+o,s=t[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new Ki(r,3)),this.setAttribute("normal",new Ki(i,3)),this.setAttribute("uv",new Ki(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new eh(n,e.curveSegments)}}class th extends ss{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new hr,h=new hr,p=[],d=[],f=[],m=[];for(let p=0;p<=n;p++){const g=[],_=p/n;let v=0;0===p&&0===s?v=.5/t:p===n&&a===Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(r+a*i)*Math.sin(s+_*o),u.y=e*Math.cos(s+_*o),u.z=e*Math.sin(r+a*i)*Math.sin(s+_*o),d.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+v,1-_),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],o=c[e+1][r],l=c[e+1][r+1];(0!==e||s>0)&&p.push(t,i,l),(e!==n-1||a<Math.PI)&&p.push(i,o,l)}this.setIndex(p),this.setAttribute("position",new Ki(d,3)),this.setAttribute("normal",new Ki(f,3)),this.setAttribute("uv",new Ki(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new th(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class nh extends fu{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new nh(e.radius,e.detail)}}class rh extends ss{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],a=[],l=[],c=new hr,u=new hr,h=new hr;for(let s=0;s<=n;s++)for(let p=0;p<=r;p++){const d=p/r*i,f=s/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(d),u.y=(e+t*Math.cos(f))*Math.sin(d),u.z=t*Math.sin(f),o.push(u.x,u.y,u.z),c.x=e*Math.cos(d),c.y=e*Math.sin(d),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(p/r),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,o=(r+1)*(e-1)+t,a=(r+1)*e+t;s.push(n,i,a),s.push(i,o,a)}this.setIndex(s),this.setAttribute("position",new Ki(o,3)),this.setAttribute("normal",new Ki(a,3)),this.setAttribute("uv",new Ki(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class ih extends ss{constructor(e=1,t=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new hr,h=new hr,p=new hr,d=new hr,f=new hr,m=new hr,g=new hr;for(let o=0;o<=n;++o){const v=o/n*i*Math.PI*2;_(v,i,s,e,p),_(v+.01,i,s,e,d),m.subVectors(d,p),g.addVectors(d,p),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,s=-t*Math.cos(i),d=t*Math.sin(i);u.x=p.x+(s*g.x+d*f.x),u.y=p.y+(s*g.y+d*f.y),u.z=p.z+(s*g.z+d*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,p).normalize(),l.push(h.x,h.y,h.z),c.push(o/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,a=(r+1)*(e-1)+t;o.push(n,i,a),o.push(i,s,a)}function _(e,t,n,r,i){const s=Math.cos(e),o=Math.sin(e),a=n/t*e,l=Math.cos(a);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Ki(a,3)),this.setAttribute("normal",new Ki(l,3)),this.setAttribute("uv",new Ki(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ih(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class sh extends ss{constructor(e=new iu(new hr(-1,-1,0),new hr(-1,1,0),new hr(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const s=e.computeFrenetFrames(t,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new hr,a=new hr,l=new On;let c=new hr;const u=[],h=[],p=[],d=[];function f(i){c=e.getPointAt(i/t,c);const l=s.normals[i],p=s.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+i*p.x,a.y=s*l.y+i*p.y,a.z=s*l.z+i*p.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,p.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,o=(r+1)*(e-1)+t;d.push(n,i,o),d.push(i,s,o)}}()}(),this.setIndex(d),this.setAttribute("position",new Ki(u,3)),this.setAttribute("normal",new Ki(h,3)),this.setAttribute("uv",new Ki(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new sh((new ou[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class oh extends ss{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new hr,i=new hr;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let a=0;a<3;a++){const l=o.getX(e+a),c=o.getX(e+(a+1)%3);r.fromBufferAttribute(s,l),i.fromBufferAttribute(s,c),!0===ah(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const s=e.attributes.position;for(let e=0,o=s.count/3;e<o;e++)for(let o=0;o<3;o++){const a=3*e+o,l=3*e+(o+1)%3;r.fromBufferAttribute(s,a),i.fromBufferAttribute(s,l),!0===ah(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new Ki(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function ah(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var lh=Object.freeze({__proto__:null,BoxGeometry:Cs,CapsuleGeometry:uu,CircleGeometry:hu,ConeGeometry:du,CylinderGeometry:pu,DodecahedronGeometry:mu,EdgesGeometry:bu,ExtrudeGeometry:Yu,IcosahedronGeometry:Ju,LatheGeometry:cu,OctahedronGeometry:Zu,PlaneGeometry:Ws,PolyhedronGeometry:fu,RingGeometry:$u,ShapeGeometry:eh,SphereGeometry:th,TetrahedronGeometry:nh,TorusGeometry:rh,TorusKnotGeometry:ih,TubeGeometry:sh,WireframeGeometry:oh});class ch extends Si{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ri(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class uh extends Is{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hh extends Si{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ri(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ph extends hh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new On(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Sn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ri(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ri(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ri(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class dh extends Si{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ri(16777215),this.specular=new Ri(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fh extends Si{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ri(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class mh extends Si{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class gh extends Si{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=X,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _h extends Si{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ri(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ut,this.normalScale=new On(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class vh extends vc{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function yh(e,t,n){return Ah(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function bh(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Ah(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wh(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function xh(e,t,n){const r=e.length,i=new e.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*t;for(let n=0;n!==t;++n)i[o++]=e[r+n]}return i}function Eh(e,t,n,r){let i=1,s=e[0];for(;void 0!==s&&void 0===s[r];)s=e[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(t.push(s.time),n.push.apply(n,o)),s=e[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(t.push(s.time),o.toArray(n,n.length)),s=e[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(t.push(s.time),n.push(o)),s=e[i++]}while(void 0!==s)}const Ch={arraySlice:yh,convertArray:bh,isTypedArray:Ah,getKeyframeOrder:wh,sortedArray:xh,flattenJSON:Eh,subclip:function(e,t,n,r,i=30){const s=e.clone();s.name=t;const o=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*i;if(!(s<n||s>=r)){l.push(t.times[e]);for(let n=0;n<a;++n)c.push(t.values[e*a+n])}}0!==l.length&&(t.times=bh(l,t.times.constructor),t.values=bh(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let e=0;e<s.tracks.length;++e)a>s.tracks[e].times[0]&&(a=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,s=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===o)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let p;if(s<=r.times[0]){const e=a,t=l-a;p=yh(r.values,e,t)}else if(s>=r.times[h]){const e=h*l+a,t=e+l-a;p=yh(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=l-a;e.evaluate(s),p=yh(e.resultBuffer,t,n)}"quaternion"===i&&(new ur).fromArray(p).normalize().conjugate().toArray(p);const d=o.times.length;for(let e=0;e<d;++e){const t=e*u+c;if("quaternion"===i)ur.multiplyQuaternionsFlat(o.values,t,p,0,o.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)o.values[t+n]-=p[n]}}}return e.blendMode=It,e}};class Sh{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let s;n:{r:if(!(e<r)){for(let s=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=t[++n],e<r)break t}s=t.length;break n}if(e>=i)break e;{const o=t[1];e<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=t[--n-1],e>=i)break t}s=n,n=0}}for(;n<s;){const r=n+s>>>1;e<t[r]?s=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Mh extends Sh{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:St,endingEnd:St}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,s=e+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Mt:i=e,o=2*t-n;break;case Tt:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Mt:s=e,a=2*n-t;break;case Tt:s=1,a=n+r[1]-r[0];break;default:s=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-t)/(r-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,_=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,v=(-1-p)*m+(1.5+p)*f+.5*d,y=p*m-p*f;for(let e=0;e!==o;++e)i[e]=g*s[c+e]+_*s[l+e]+v*s[a+e]+y*s[u+e];return i}}class Th extends Sh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==o;++e)i[e]=s[l+e]*u+s[a+e]*c;return i}}class Dh extends Sh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ih{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=bh(t,this.TimeBufferType),this.values=bh(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:bh(e.times,Array),values:bh(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Dh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Th(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Mh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xt:t=this.InterpolantFactoryMethodDiscrete;break;case Et:t=this.InterpolantFactoryMethodLinear;break;case Ct:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xt;case this.InterpolantFactoryMethodLinear:return Et;case this.InterpolantFactoryMethodSmooth:return Ct}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const e=this.getValueSize();this.times=yh(n,i,s),this.values=yh(this.values,i*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,s),e=!1;break}s=r}if(void 0!==r&&Ah(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=yh(this.times),t=yh(this.values),n=this.getValueSize(),r=this.getInterpolation()===Ct,i=e.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,s=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[s+o]){i=!0;break}}}if(i){if(o!==s){e[s]=e[o];const r=o*n,i=s*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++s}}if(i>0){e[s]=e[i];for(let e=i*n,r=s*n,o=0;o!==n;++o)t[r+o]=t[e+o];++s}return s!==e.length?(this.times=yh(e,0,s),this.values=yh(t,0,s*n)):(this.times=e,this.values=t),this}clone(){const e=yh(this.times,0),t=yh(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Ih.prototype.TimeBufferType=Float32Array,Ih.prototype.ValueBufferType=Float32Array,Ih.prototype.DefaultInterpolation=Et;class Ph extends Ih{}Ph.prototype.ValueTypeName="bool",Ph.prototype.ValueBufferType=Array,Ph.prototype.DefaultInterpolation=xt,Ph.prototype.InterpolantFactoryMethodLinear=void 0,Ph.prototype.InterpolantFactoryMethodSmooth=void 0;class Rh extends Ih{}Rh.prototype.ValueTypeName="color";class Bh extends Ih{}Bh.prototype.ValueTypeName="number";class kh extends Sh{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-t)/(r-t);let l=e*o;for(let e=l+o;l!==e;l+=4)ur.slerpFlat(i,0,s,l-o,s,l,a);return i}}class Oh extends Ih{InterpolantFactoryMethodLinear(e){return new kh(this.times,this.values,this.getValueSize(),e)}}Oh.prototype.ValueTypeName="quaternion",Oh.prototype.DefaultInterpolation=Et,Oh.prototype.InterpolantFactoryMethodSmooth=void 0;class Lh extends Ih{}Lh.prototype.ValueTypeName="string",Lh.prototype.ValueBufferType=Array,Lh.prototype.DefaultInterpolation=xt,Lh.prototype.InterpolantFactoryMethodLinear=void 0,Lh.prototype.InterpolantFactoryMethodSmooth=void 0;class Fh extends Ih{}Fh.prototype.ValueTypeName="vector";class Uh{constructor(e,t=-1,n,r=Dt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Cn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Nh(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Ih.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,s=[];for(let e=0;e<i;e++){let o=[],a=[];o.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const l=wh(o);o=xh(o,1,l),a=xh(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new Bh(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(i);if(s&&s.length>1){const e=s[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const s=[];for(const e in r)s.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const s=[],o=[];Eh(n,s,o,r),0!==s.length&&i.push(new e(t,s,o))}},r=[],i=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new Bh(".morphTargetInfluence["+n+"]",e,s))}a=e.length*s}else{const s=".bones["+t[e].name+"]";n(Fh,s+".position",i,"pos",r),n(Oh,s+".quaternion",i,"rot",r),n(Fh,s+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,a,r,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Nh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Bh;case"vector":case"vector2":case"vector3":case"vector4":return Fh;case"color":return Rh;case"quaternion":return Oh;case"bool":case"boolean":return Ph;case"string":return Lh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Eh(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const jh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e,t){return!1===this.enabled?t?Promise.resolve():void 0:t?Promise.resolve(this.files[e]):this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class zh{constructor(e,t,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===s&&void 0!==r.onStart&&r.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Gh=new zh;class Vh{constructor(e){this.manager=void 0!==e?e:Gh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Hh={};class Qh extends Error{constructor(e,t){super(e),this.response=t}}class Wh extends Vh{constructor(e){super(e),this.responseType="text",this.useCache=!0}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),(this.useCache?jh.get(e,this.responseType,this.mimeType):Promise.resolve(void 0)).then((i=>{if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==Hh[e])return void Hh[e].push({onLoad:t,onProgress:n,onError:r});Hh[e]=[],Hh[e].push({onLoad:t,onProgress:n,onError:r});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Hh[e],r=t.body.getReader(),i=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=i?parseInt(i):0,o=0!==s;let a=0;const l=new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:i})=>{if(r)e.close();else{a+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}}))}()}});return new Response(l)}throw new Qh(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{this.useCache&&jh.add(e,t,this.responseType);const n=Hh[e];delete Hh[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const n=Hh[e];if(void 0===n)throw this.manager.itemError(e),t;delete Hh[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.useCache&&this.manager.itemEnd(e)})),this.useCache&&this.manager.itemStart(e)}))}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class qh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new Wh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Uh.parse(e[n]);t.push(r)}return t}}class Xh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=[],o=new Uc,a=new Wh(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=i.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=_e),o.image=s,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=_e),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}class Yh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=e;void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=jh.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout((function(){t&&t(o),s.manager.itemEnd(e)}),0),o;const a=zn("img");function l(){u(),jh.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(t){u(),r&&r(t),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),jh.get(e,"blob").then((t=>{if(void 0!==t&&!t.type.startsWith("text/plain"))return t.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(t=new Blob([t],{type:"image/svg+xml"})),void(a.src=URL.createObjectURL(t));const s=new Wh(this.manager);s.useCache=!1,s.setPath(this.path),s.setCrossOrigin(this.crossOrigin),s.setResponseType("blob"),s.load(i,(function(t){t.type||(e.endsWith(".svg")||e.startsWith("data:image/svg"))&&(t=new Blob([t],{type:"image/svg+xml"})),jh.add(e,t,"blob"),a.src=URL.createObjectURL(t)}),n,(e=>{u(),r&&r(e)}))})),a}}class Kh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=new Os,s=new Yh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(e[n],(function(e){i.images[n]=e,o++,6===o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}class Jh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new sc,o=new Wh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data,s.image.complete=!0),s.wrapS=void 0!==n.wrapS?n.wrapS:ue,s.wrapT=void 0!==n.wrapT?n.wrapT:ue,s.magFilter=void 0!==n.magFilter?n.magFilter:_e,s.minFilter=void 0!==n.minFilter?n.minFilter:_e,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?s.colorSpace=n.colorSpace:void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=be),1===n.mipmapCount&&(s.minFilter=_e),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n))}),n,r),s}}class Zh extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=new nr,s=new Yh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class $h extends pi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ri(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class ep extends $h{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ri(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const tp=new zr,np=new hr,rp=new hr;class ip{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new On(512,512),this.map=null,this.mapPass=null,this.matrix=new zr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vs,this._frameExtents=new On(1,1),this._viewportCount=1,this._viewports=[new rr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;np.setFromMatrixPosition(e.matrixWorld),t.position.copy(np),rp.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(rp),t.updateMatrixWorld(),tp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tp),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(tp)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.normalBias=e.normalBias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class sp extends ip{constructor(){super(new Rs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*En*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class op extends $h{constructor(e,t,n=0,r=Math.PI/3,i=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new sp}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const ap=new zr,lp=new hr,cp=new hr;class up extends ip{constructor(){super(new Rs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new On(4,2),this._viewportCount=6,this._viewports=[new rr(2,1,1,1),new rr(0,1,1,1),new rr(3,1,1,1),new rr(1,1,1,1),new rr(3,0,1,1),new rr(1,0,1,1)],this._cubeDirections=[new hr(1,0,0),new hr(-1,0,0),new hr(0,0,1),new hr(0,0,-1),new hr(0,1,0),new hr(0,-1,0)],this._cubeUps=[new hr(0,1,0),new hr(0,1,0),new hr(0,1,0),new hr(0,1,0),new hr(0,0,1),new hr(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),lp.setFromMatrixPosition(e.matrixWorld),n.position.copy(lp),cp.copy(n.position),cp.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(cp),n.updateMatrixWorld(),r.makeTranslation(-lp.x,-lp.y,-lp.z),ap.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ap)}}class hp extends $h{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new up}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class pp extends ip{constructor(){super(new ro(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class dp extends $h{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.shadow=new pp}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class fp extends $h{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class mp extends $h{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class gp{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new hr)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*r),t.addScaledVector(s[2],.488603*i),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*r*1.092548),t.addScaledVector(s[5],r*i*1.092548),t.addScaledVector(s[6],.315392*(3*i*i-1)),t.addScaledVector(s[7],n*i*1.092548),t.addScaledVector(s[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*r),t.addScaledVector(s[2],1.023328*i),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*r),t.addScaledVector(s[5],.858086*r*i),t.addScaledVector(s[6],.743125*i*i-.247708),t.addScaledVector(s[7],.858086*n*i),t.addScaledVector(s[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class _p extends $h{constructor(e=new gp,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class vp extends Vh{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,s=new Wh(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=e.metadata&&e.metadata.version<=4.5?Gt:void 0,i=vp.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color,r),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Ri).setHex(e.sheenColor,r)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive,r),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular,r),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor,r),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor,r),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const s=e.uniforms[t];switch(i.uniforms[t]={},s.type){case"t":i.uniforms[t].value=n(s.value);break;case"c":i.uniforms[t].value=(new Ri).setHex(s.value,r);break;case"v2":i.uniforms[t].value=(new On).fromArray(s.value);break;case"v3":i.uniforms[t].value=(new hr).fromArray(s.value);break;case"v4":i.uniforms[t].value=(new rr).fromArray(s.value);break;case"m3":i.uniforms[t].value=(new Ln).fromArray(s.value);break;case"m4":i.uniforms[t].value=(new zr).fromArray(s.value);break;default:i.uniforms[t].value=s.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new On).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new On).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:ch,SpriteMaterial:Rl,RawShaderMaterial:uh,ShaderMaterial:Is,PointsMaterial:Dc,MeshPhysicalMaterial:ph,MeshStandardMaterial:hh,MeshPhongMaterial:dh,MeshToonMaterial:fh,MeshNormalMaterial:mh,MeshLambertMaterial:gh,MeshDepthMaterial:cl,MeshDistanceMaterial:ul,MeshBasicMaterial:ki,MeshMatcapMaterial:_h,LineDashedMaterial:vh,LineBasicMaterial:vc,Material:Si}[e]}}class yp{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class bp extends ss{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Ap extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new Wh(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],s=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),o=jn(i.type,s),a=new Dl(o,i.stride);return a.uuid=i.uuid,t[r]=a,a}const i=e.isInstancedBufferGeometry?new bp:new ss,s=e.data.index;if(void 0!==s){const e=jn(s.type,s.array);i.setIndex(new zi(e,1))}const o=e.data.attributes;for(const t in o){const n=o[t];let s;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);s=new Pl(t,n.itemSize,n.offset,n.normalized)}else{const e=jn(n.type,n.array);s=new(n.isInstancedBufferAttribute?cc:zi)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),i.setAttribute(t,s)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let o;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);o=new Pl(t,i.itemSize,i.offset,i.normalized)}else{const e=jn(i.type,i.array);o=new zi(e,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),s.push(o)}i.morphAttributes[t]=s}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new hr;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new Rr(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class wp extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=""===this.path?yp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Wh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){let s=null;try{s=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(s,t)}),n,r)}async loadAsync(e,t){const n=""===this.path?yp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Wh(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),s=JSON.parse(i),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,a,o,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,s),a=this.parseObject(e.object,r,o,s,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new Au).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new lc).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new Ap;for(let i=0,s=e.length;i<s;i++){let s;const o=e[i];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;default:o.type in lh?s=lh[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.userData&&(s.userData=o.userData),n[o.uuid]=s}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new vp;i.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Uh.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:jn(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){const n=new zh(t);i=new Yh(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=s(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new sc(n.data,n.width,n.height)))}r[n.uuid]=new $n(e)}else{const e=s(n.url);r[n.uuid]=new $n(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:jn(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){r=new Yh(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new sc(r.data,r.width,r.height)))}n[r.uuid]=new $n(e)}else{const e=await i(r.url);n[r.uuid]=new $n(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,s=e.length;i<s;i++){const s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=t[s.image],a=o?o.data:void 0;let l;Array.isArray(a)?(l=new Os,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new sc:new nr,a&&a.complete&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,xp)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Ep),l.wrapT=n(s.wrap[1],Ep)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace?l.colorSpace=s.colorSpace:void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Cp)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Cp)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),r[s.uuid]=l}return r}parseObject(e,t,n,r,i){let s;const o=e.metadata&&e.metadata.version<=4.5?Gt:void 0;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}let u,h;switch(e.type){case"Scene":s=new Tl,void 0!==e.background&&(Number.isInteger(e.background)?s.background=(new Ri).setHex(e.background,o):s.background=c(e.background)),void 0!==e.environment&&(s.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Ml(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new Sl(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new Rs(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new ro(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new fp(e.color,e.intensity);break;case"DirectionalLight":s=new dp(e.color,e.intensity);break;case"PointLight":s=new hp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new mp(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new op(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new ep(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new _p).fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),s=new rc(u,h),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),s=new xs(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;s=new _c(u,h,t),s.instanceMatrix=new cc(new Float32Array(n.array),16),void 0!==r&&(s.instanceColor=new cc(new Float32Array(r.array),r.itemSize));break;case"LOD":s=new Kl;break;case"Line":s=new Ec(a(e.geometry),l(e.material));break;case"LineLoop":s=new Tc(a(e.geometry),l(e.material));break;case"LineSegments":s=new Mc(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new kc(a(e.geometry),l(e.material));break;case"Sprite":s=new Wl(l(e.material));break;case"Group":s=new gl;break;case"Bone":s=new ic;break;default:s=new pi}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)s.add(this.parseObject(o[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=s.getObjectByProperty("uuid",n.object);void 0!==r&&s.addLevel(r,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}const xp={UVMapping:re,CubeReflectionMapping:ie,CubeRefractionMapping:se,EquirectangularReflectionMapping:oe,EquirectangularRefractionMapping:ae,CubeUVReflectionMapping:le},Ep={RepeatWrapping:ce,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:he},Cp={NearestFilter:pe,NearestMipmapNearestFilter:de,NearestMipmapLinearFilter:me,LinearFilter:_e,LinearMipmapNearestFilter:ve,LinearMipmapLinearFilter:be};class Sp extends Vh{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this;jh.get(e,"blob").then((n=>{if(void 0!==n)return i.manager.itemStart(e),void createImageBitmap(n,Object.assign(i.options,{colorSpaceConversion:"none"})).then((function(n){t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}));const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(t){return jh.add(e,t,"blob"),createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}))}}let Mp;class Tp{static getContext(){return void 0===Mp&&(Mp=new(window.AudioContext||window.webkitAudioContext)),Mp}static setContext(e){Mp=e}}class Dp extends Vh{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new Wh(this.manager);function o(t){r?r(t):console.error(t),i.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){try{const n=e.slice(0);Tp.getContext().decodeAudioData(n,(function(e){t(e)}),o)}catch(e){o(e)}}),n,r)}}class Ip extends _p{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const r=(new Ri).set(e),i=(new Ri).set(t),s=new hr(r.r,r.g,r.b),o=new hr(i.r,i.g,i.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}class Pp extends _p{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=(new Ri).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Rp=new zr,Bp=new zr,kp=new zr;class Op{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Rs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Rs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,kp.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(xn*t.fov*.5)/t.zoom;let s,o;Bp.elements[12]=-n,Rp.elements[12]=n,s=-i*t.aspect+r,o=i*t.aspect+r,kp.elements[0]=2*t.near/(o-s),kp.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(kp),s=-i*t.aspect-r,o=i*t.aspect-r,kp.elements[0]=2*t.near/(o-s),kp.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(kp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Bp),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rp)}}class Lp{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Fp(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Fp();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Fp(){return("undefined"==typeof performance?Date:performance).now()}const Up=new hr,Np=new ur,jp=new hr,zp=new hr;class Gp extends pi{constructor(){super(),this.type="AudioListener",this.context=Tp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Lp}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Up,Np,jp),zp.set(0,0,-1).applyQuaternion(Np),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Up.x,e),t.positionY.linearRampToValueAtTime(Up.y,e),t.positionZ.linearRampToValueAtTime(Up.z,e),t.forwardX.linearRampToValueAtTime(zp.x,e),t.forwardY.linearRampToValueAtTime(zp.y,e),t.forwardZ.linearRampToValueAtTime(zp.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Up.x,Up.y,Up.z),t.setOrientation(zp.x,zp.y,zp.z,n.x,n.y,n.z)}}class Vp extends pi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Hp=new hr,Qp=new ur,Wp=new hr,qp=new hr;class Xp extends Vp{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Hp,Qp,Wp),qp.set(0,0,1).applyQuaternion(Qp);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Hp.x,e),t.positionY.linearRampToValueAtTime(Hp.y,e),t.positionZ.linearRampToValueAtTime(Hp.z,e),t.orientationX.linearRampToValueAtTime(qp.x,e),t.orientationY.linearRampToValueAtTime(qp.y,e),t.orientationZ.linearRampToValueAtTime(qp.z,e)}else t.setPosition(Hp.x,Hp.y,Hp.z),t.setOrientation(qp.x,qp.y,qp.z)}}class Yp{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Kp{constructor(e,t,n){let r,i,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==r;++e)n[i+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){o.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){ur.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const s=this._workIndex*i;ur.multiplyQuaternionsFlat(e,s,e,t,e,n),ur.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,n,r,i){const s=1-r;for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]*s+e[n+o]*r}}_lerpAdditive(e,t,n,r,i){for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]+e[n+s]*r}}}const Jp="\\[\\]\\.:\\/",Zp=new RegExp("["+Jp+"]","g"),$p="[^"+Jp+"]",ed="[^"+Jp.replace("\\.","")+"]",td=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",$p)+/(WCOD+)?/.source.replace("WCOD",ed)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$p)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$p)+"$"),nd=["material","materials","bones","map"];class rd{constructor(e,t,n){this.path=t,this.parsedPath=n||rd.parseTrackName(t),this.node=rd.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new rd.Composite(e,t,n):new rd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Zp,"")}static parseTrackName(e){const t=td.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==nd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const s=n(i.children);if(s)return s}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=rd.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const s=e[r];if(void 0===s){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}rd.Composite=class{constructor(e,t,n){const r=n||rd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},rd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},rd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},rd.prototype.GetterByBindingType=[rd.prototype._getValue_direct,rd.prototype._getValue_array,rd.prototype._getValue_arrayElement,rd.prototype._getValue_toArray],rd.prototype.SetterByBindingTypeAndVersioning=[[rd.prototype._setValue_direct,rd.prototype._setValue_direct_setNeedsUpdate,rd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[rd.prototype._setValue_array,rd.prototype._setValue_array_setNeedsUpdate,rd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[rd.prototype._setValue_arrayElement,rd.prototype._setValue_arrayElement_setNeedsUpdate,rd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[rd.prototype._setValue_fromArray,rd.prototype._setValue_fromArray_setNeedsUpdate,rd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class id{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Cn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let p=t[h];if(void 0===p){p=a++,t[h]=p,e.push(u);for(let e=0,t=s;e!==t;++e)i[e].push(new rd(u,n[e],r[e]))}else if(p<l){o=e[p];const a=--l,c=e[a];t[c.uuid]=p,e[p]=c,t[h]=a,e[a]=u;for(let e=0,t=s;e!==t;++e){const t=i[e],s=t[a];let o=t[p];t[p]=s,void 0===o&&(o=new rd(u,n[e],r[e])),t[a]=o}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=t[a];if(void 0!==l&&l>=i){const s=i++,c=e[s];t[c.uuid]=l,e[l]=c,t[a]=s,e[s]=o;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[l];t[l]=r,t[s]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<i){const o=--i,a=e[o],c=--s,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=o,e[o]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[l]=r,t[o]=i,t.pop()}}else{const i=--s,o=e[i];i>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,s.push(e),o.push(t),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new rd(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];t[e[o]]=n,s[n]=a,s.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}class sd{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,s=i.length,o=new Array(s),a={endingStart:St,endingEnd:St};for(let e=0;e!==s;++e){const t=i[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=At,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,s=n/r;e.warp(1,i,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===It)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulateAdditive(o);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulate(r,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const s=n===wt;if(0===e)return-1===i?r:s&&1==(1&i)?t-r:r;if(n===bt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Mt,r.endingEnd=Mt):(r.endingStart=e?this.zeroSlopeAtStart?Mt:St:Tt,r.endingEnd=t?this.zeroSlopeAtEnd?Mt:St:Tt)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=t,o[1]=i+e,a[1]=n,this}}const od=new Float32Array(1);class ad extends bn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,s=e._propertyBindings,o=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)++u.referenceCount,s[e]=u;else{if(u=s[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new Kp(rd.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),s[e]=u}o[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let s=i[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[t];void 0===s&&(s={},r[t]=s),s[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Th(new Float32Array(2),new Float32Array(2),1,od),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let s="string"==typeof e?Uh.findByName(r,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Dt),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new sd(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Uh.findByName(n,e):e,s=i?i.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),s=this._accuIndex^=1;for(let o=0;o!==n;++o)t[o]._update(r,e,i,s);const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,s=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,t[i]=s,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class ld{constructor(e){this.value=e}clone(){return new ld(void 0===this.value.clone?this.value:this.value.clone())}}let cd=0;class ud extends bn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:cd++}),this.name="",this.usage=ln,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}}class hd extends Dl{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class pd{constructor(e,t,n,r,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class dd{constructor(e,t,n=0,r=1/0){this.ray=new jr(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Zr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return md(e,this,n,t),n.sort(fd),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)md(e[r],this,n,t);return n.sort(fd),n}}function fd(e,t){return e.distance-t.distance}function md(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)md(r[e],t,n,!0)}}class gd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Sn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class _d{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const vd=new On;class yd{constructor(e=new On(1/0,1/0),t=new On(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=vd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,vd).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const bd=new hr,Ad=new hr;class wd{constructor(e=new hr,t=new hr){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){bd.subVectors(e,this.start),Ad.subVectors(this.end,this.start);const n=Ad.dot(Ad);let r=Ad.dot(bd)/n;return t&&(r=Sn(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const xd=new hr;class Ed extends pi{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new ss,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,s=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Ki(r,3));const i=new vc({fog:!1,toneMapped:!1});this.cone=new Mc(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Cd=new hr,Sd=new zr,Md=new zr;class Td extends Mc{constructor(e){const t=Dd(e),n=new ss,r=[],i=[],s=new Ri(0,0,1),o=new Ri(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new Ki(r,3)),n.setAttribute("color",new Ki(i,3)),super(n,new vc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Md.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Sd.multiplyMatrices(Md,i.matrixWorld),Cd.setFromMatrixPosition(Sd),r.setXYZ(n,Cd.x,Cd.y,Cd.z),Sd.multiplyMatrices(Md,i.parent.matrixWorld),Cd.setFromMatrixPosition(Sd),r.setXYZ(n+1,Cd.x,Cd.y,Cd.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Dd(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Dd(e.children[n]));return t}class Id extends xs{constructor(e,t,n){super(new th(t,4,2),new ki({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Pd=new hr,Rd=new Ri,Bd=new Ri;class kd extends pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Zu(t);r.rotateY(.5*Math.PI),this.material=new ki({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new zi(s,3)),this.add(new xs(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Rd.copy(this.light.color),Bd.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Rd:Bd;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Pd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Od extends Mc{constructor(e=10,t=10,n=4473924,r=8947848){n=new Ri(n),r=new Ri(r);const i=t/2,s=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,u=-o;e<=t;e++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new ss;c.setAttribute("position",new Ki(a,3)),c.setAttribute("color",new Ki(l,3)),super(c,new vc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ld extends Mc{constructor(e=10,t=16,n=8,r=64,i=4473924,s=8947848){i=new Ri(i),s=new Ri(s);const o=[],a=[];if(t>1)for(let n=0;n<t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;o.push(0,0,0),o.push(l,0,c);const u=1&n?i:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<n;t++){const l=1&t?i:s,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;o.push(n,0,i),a.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,o.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new ss;l.setAttribute("position",new Ki(o,3)),l.setAttribute("color",new Ki(a,3)),super(l,new vc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Fd=new hr,Ud=new hr,Nd=new hr;class jd extends pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new ss;r.setAttribute("position",new Ki([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new vc({fog:!1,toneMapped:!1});this.lightPlane=new Ec(r,i),this.add(this.lightPlane),r=new ss,r.setAttribute("position",new Ki([0,0,0,0,0,1],3)),this.targetLine=new Ec(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Fd.setFromMatrixPosition(this.light.matrixWorld),Ud.setFromMatrixPosition(this.light.target.matrixWorld),Nd.subVectors(Ud,Fd),this.lightPlane.lookAt(Ud),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ud),this.targetLine.scale.z=Nd.length()}}const zd=new hr,Gd=new Ps;class Vd extends Mc{constructor(e){const t=new ss,n=new vc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={};function o(e,t){a(e),a(t)}function a(e){r.push(0,0,0),i.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(r.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new Ki(r,3)),t.setAttribute("color",new Ki(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Ri(16755200),c=new Ri(16711680),u=new Ri(43775),h=new Ri(16777215),p=new Ri(3355443);this.setColors(l,c,u,h,p)}setColors(e,t,n,r,i){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,i.r,i.g,i.b),s.setXYZ(41,i.r,i.g,i.b),s.setXYZ(42,i.r,i.g,i.b),s.setXYZ(43,i.r,i.g,i.b),s.setXYZ(44,i.r,i.g,i.b),s.setXYZ(45,i.r,i.g,i.b),s.setXYZ(46,i.r,i.g,i.b),s.setXYZ(47,i.r,i.g,i.b),s.setXYZ(48,i.r,i.g,i.b),s.setXYZ(49,i.r,i.g,i.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Gd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Hd("c",t,e,Gd,0,0,-1),Hd("t",t,e,Gd,0,0,1),Hd("n1",t,e,Gd,-1,-1,-1),Hd("n2",t,e,Gd,1,-1,-1),Hd("n3",t,e,Gd,-1,1,-1),Hd("n4",t,e,Gd,1,1,-1),Hd("f1",t,e,Gd,-1,-1,1),Hd("f2",t,e,Gd,1,-1,1),Hd("f3",t,e,Gd,-1,1,1),Hd("f4",t,e,Gd,1,1,1),Hd("u1",t,e,Gd,.7,1.1,-1),Hd("u2",t,e,Gd,-.7,1.1,-1),Hd("u3",t,e,Gd,0,2,-1),Hd("cf1",t,e,Gd,-1,0,1),Hd("cf2",t,e,Gd,1,0,1),Hd("cf3",t,e,Gd,0,-1,1),Hd("cf4",t,e,Gd,0,1,1),Hd("cn1",t,e,Gd,-1,0,-1),Hd("cn2",t,e,Gd,1,0,-1),Hd("cn3",t,e,Gd,0,-1,-1),Hd("cn4",t,e,Gd,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Hd(e,t,n,r,i,s,o){zd.set(i,s,o).unproject(r);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],zd.x,zd.y,zd.z)}}const Qd=new fr;class Wd extends Mc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new ss;i.setIndex(new zi(n,1)),i.setAttribute("position",new zi(r,3)),super(i,new vc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Qd.setFromObject(this.object),Qd.isEmpty())return;const t=Qd.min,n=Qd.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class qd extends Mc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new ss;r.setIndex(new zi(n,1)),r.setAttribute("position",new Ki([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new vc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Xd extends Ec{constructor(e,t=1,n=16776960){const r=n,i=new ss;i.setAttribute("position",new Ki([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new vc({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new ss;s.setAttribute("position",new Ki([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new xs(s,new ki({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Yd=new hr;let Kd,Jd;class Zd extends pi{constructor(e=new hr(0,0,1),t=new hr(0,0,0),n=1,r=16776960,i=.2*n,s=.2*i){super(),this.type="ArrowHelper",void 0===Kd&&(Kd=new ss,Kd.setAttribute("position",new Ki([0,0,0,0,1,0],3)),Jd=new pu(0,.5,1,5,1),Jd.translate(0,-.5,0)),this.position.copy(t),this.line=new Ec(Kd,new vc({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new xs(Jd,new ki({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Yd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Yd,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class $d extends Mc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new ss;n.setAttribute("position",new Ki(t,3)),n.setAttribute("color",new Ki([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new vc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Ri,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ef{constructor(){this.type="ShapePath",this.color=new Ri,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new lu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,s){return this.currentPath.bezierCurveTo(e,t,n,r,i,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=t[i],o=t[s],a=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],a=-a,o=t[i],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return r}const n=Wu.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,s,o;const a=[];if(1===r.length)return s=r[0],o=new Au,o.curves=s.curves,a.push(o),a;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let h,p,d=[],f=0;u[f]=void 0,d[f]=[];for(let t=0,o=r.length;t<o;t++)s=r[t],h=s.getPoints(),i=n(h),i=e?!i:i,i?(!l&&u[f]&&f++,u[f]={s:new Au,p:h},u[f].s.curves=s.curves,l&&f++,d[f]=[]):d[f].push({h:s,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Au;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let e=0,t=u.length;e<t;e++)c[e]=[];for(let r=0,i=u.length;r<i;r++){const i=d[r];for(let s=0;s<i.length;s++){const o=i[s];let a=!0;for(let i=0;i<u.length;i++)t(o.p,u[i].p)&&(r!==i&&n++,a?(a=!1,c[i].push(o)):e=!0);a&&c[r].push(o)}}n>0&&!1===e&&(d=c)}for(let e=0,t=u.length;e<t;e++){o=u[e].s,a.push(o),p=d[e];for(let e=0,t=p.length;e<t;e++)o.holes.push(p[e].h)}return a}}class tf extends Cs{constructor(e,t,n,r,i,s){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,r,i,s)}}class nf extends uu{constructor(e,t,n,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,r)}}class rf extends hu{constructor(e,t,n,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,r)}}class sf extends du{constructor(e,t,n,r,i,s,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,r,i,s,o)}}class of extends pu{constructor(e,t,n,r,i,s,o,a){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,r,i,s,o,a)}}class af extends mu{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class lf extends Yu{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class cf extends Ju{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class uf extends cu{constructor(e,t,n,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,r)}}class hf extends Zu{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class pf extends Ws{constructor(e,t,n,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,r)}}class df extends fu{constructor(e,t,n,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,r)}}class ff extends $u{constructor(e,t,n,r,i,s){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,r,i,s)}}class mf extends eh{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class gf extends th{constructor(e,t,n,r,i,s,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,r,i,s,o)}}class _f extends nh{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class vf extends rh{constructor(e,t,n,r,i){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,r,i)}}class yf extends ih{constructor(e,t,n,r,i,s){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,r,i,s)}}class bf extends sh{constructor(e,t,n,r,i){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,r,i)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=r)},553:function(e,t,n){n.d(t,{_:function(){return s}});var r=n(988);const i=new WeakMap;class s extends r.aNw{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new r.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{this.parse(e,t,i)}),n,i)}parse(e,t,n){this.decodeDracoFile(e,t,null,null,r.KI_).catch(n)}decodeDracoFile(e,t,n,i,s=r.GUF){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if(i.has(e)){const t=i.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then((n=>(r=n,new Promise(((n,i)=>{r._callbacks[s]={resolve:n,reject:i},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{r&&s&&this._releaseTask(r,s)})),i.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new r.u9r;e.index&&t.setIndex(new r.TlE(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,o=i.array,a=i.itemSize,l=new r.TlE(o,a);"color"===s&&this._assignVertexColorSpace(l,i.vertexColorSpace),t.setAttribute(s,l)}return t}_assignVertexColorSpace(e,t){if(t!==r.KI_)return;const n=new r.Ilk;for(let t=0,r=e.count;t<r;t++)n.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new r.hH6(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,r)=>{n.load(e,t,void 0,r)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const r=o,i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){this.workerPool.map((e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}const o="\nfunction DRACOWorker() {\n\n\tlet decoderConfig;\n\tlet decoderPending;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tdecoderConfig = message.decoderConfig;\n\t\t\t\tdecoderPending = new Promise( function ( resolve/*, reject*/ ) {\n\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\n\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\n\t\t\t\t\t\tresolve( { draco: draco } );\n\n\t\t\t\t\t};\n\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tconst taskConfig = message.taskConfig;\n\t\t\t\tdecoderPending.then( ( module ) => {\n\n\t\t\t\t\tconst draco = module.draco;\n\t\t\t\t\tconst decoder = new draco.Decoder();\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );\n\n\t\t\t\t\t\tconst buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\n\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t} finally {\n\n\t\t\t\t\t\tdraco.destroy( decoder );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeGeometry( draco, decoder, array, taskConfig ) {\n\n\t\tconst attributeIDs = taskConfig.attributeIDs;\n\t\tconst attributeTypes = taskConfig.attributeTypes;\n\n\t\tlet dracoGeometry;\n\t\tlet decodingStatus;\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType( array );\n\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tdracoGeometry = new draco.Mesh();\n\t\t\tdecodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );\n\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\n\n\t\t\tdracoGeometry = new draco.PointCloud();\n\t\t\tdecodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\n\n\t\t}\n\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\n\n\t\t}\n\n\t\tconst geometry = { index: null, attributes: [] };\n\n\t\t// Gather all vertex attributes.\n\t\tfor ( const attributeName in attributeIDs ) {\n\n\t\t\tconst attributeType = self[ attributeTypes[ attributeName ] ];\n\n\t\t\tlet attribute;\n\t\t\tlet attributeID;\n\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\n\t\t\t// IDs. glTF files always do the latter, and .drc files typically do the former.\n\t\t\tif ( taskConfig.useUniqueIDs ) {\n\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\n\n\t\t\t} else {\n\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\n\n\t\t\t\tif ( attributeID === - 1 ) continue;\n\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\n\n\t\t\t}\n\n\t\t\tconst attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );\n\n\t\t\tif ( attributeName === 'color' ) {\n\n\t\t\t\tattributeResult.vertexColorSpace = taskConfig.vertexColorSpace;\n\n\t\t\t}\n\n\t\t\tgeometry.attributes.push( attributeResult );\n\n\t\t}\n\n\t\t// Add index.\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\n\n\t\t}\n\n\t\tdraco.destroy( dracoGeometry );\n\n\t\treturn geometry;\n\n\t}\n\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\n\n\t\tconst numFaces = dracoGeometry.num_faces();\n\t\tconst numIndices = numFaces * 3;\n\t\tconst byteLength = numIndices * 4;\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\n\t\tconst index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn { array: index, itemSize: 1 };\n\n\t}\n\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\n\n\t\tconst numComponents = attribute.num_components();\n\t\tconst numPoints = dracoGeometry.num_points();\n\t\tconst numValues = numPoints * numComponents;\n\t\tconst byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\n\t\tconst dataType = getDracoDataType( draco, attributeType );\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\n\t\tconst array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn {\n\t\t\tname: attributeName,\n\t\t\tarray: array,\n\t\t\titemSize: numComponents\n\t\t};\n\n\t}\n\n\tfunction getDracoDataType( draco, attributeType ) {\n\n\t\tswitch ( attributeType ) {\n\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\n\t\t\tcase Int8Array: return draco.DT_INT8;\n\t\t\tcase Int16Array: return draco.DT_INT16;\n\t\t\tcase Int32Array: return draco.DT_INT32;\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\n\n\t\t}\n\n\t}\n\n}\n"}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(e){var t=__webpackgi_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpackgi_module_cache__[e]={id:e,exports:{}};return __webpackgi_modules__[e].call(n.exports,n,n.exports,__webpackgi_require__),n.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpackgi_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},__webpackgi_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpackgi_require__.r(n);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((function(t){r[t]=function(){return e[t]}}));return r.default=function(){return e},__webpackgi_require__.d(n,r),n},__webpackgi_require__.d=function(e,t){for(var n in t)__webpackgi_require__.o(t,n)&&!__webpackgi_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(e){return Promise.all(Object.keys(__webpackgi_require__.f).reduce((function(t,n){return __webpackgi_require__.f[n](e,t),t}),[]))},__webpackgi_require__.u=function(e){return e+".mjs"},__webpackgi_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(e,t,n,r){if(inProgress[e])inProgress[e].push(t);else{var i,s;if(void 0!==n)for(var o=document.getElementsByTagName("script"),a=0;a<o.length;a++){var l=o[a];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==dataWebpackPrefix+n){i=l;break}}i||(s=!0,(i=document.createElement("script")).type="module",i.charset="utf-8",i.timeout=120,__webpackgi_require__.nc&&i.setAttribute("nonce",__webpackgi_require__.nc),i.setAttribute("data-webpack",dataWebpackPrefix+n),i.src=e),inProgress[e]=[t];var c=function(t,n){i.onerror=i.onload=null,clearTimeout(u);var r=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(n)})),t)return t(n)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=c.bind(null,i.onerror),i.onload=c.bind(null,i.onload),s&&document.head.appendChild(i)}},__webpackgi_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;if(!(e="file:///Users/karlovidek/work/webgi-playground/node_modules/webgi/dist/examples/runtime/bundle.m.js"))throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=e+"../../"}(),function(){var e={698:0};__webpackgi_require__.f.j=function(t,n){var r=__webpackgi_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((function(n,i){r=e[t]=[n,i]}));n.push(r[2]=i);var s=__webpackgi_require__.p+__webpackgi_require__.u(t),o=new Error;__webpackgi_require__.l(s,(function(n){if(__webpackgi_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,r[1](o)}}),"chunk-"+t,t)}};var t=function(t,n){var r,i,s=n[0],o=n[1],a=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in o)__webpackgi_require__.o(o,r)&&(__webpackgi_require__.m[r]=o[r]);a&&a(__webpackgi_require__)}for(t&&t(n);l<s.length;l++)i=s[l],__webpackgi_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkwebgi=self.webpackChunkwebgi||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};!function(){var e;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return xd},LY2:function(){return n.LY2},GYo:function(){return tT},GPz:function(){return BE},HRj:function(){return mn},li4:function(){return CE},FO5:function(){return PE},Nlh:function(){return ME},Mp4:function(){return Ut},QvI:function(){return qt},PrA:function(){return HO},JHp:function(){return na},bGH:function(){return n.bGH},NDo:function(){return n.NDo},gSk:function(){return n.gSk},WMw:function(){return n.WMw},OTo:function(){return n.OTo},Se2:function(){return n.Se2},cum:function(){return n.cum},Mig:function(){return n.Mig},B$7:function(){return Nr},i_9:function(){return n.i_9},bBp:function(){return n.bBp},m7l:function(){return n.m7l},sYA:function(){return n.sYA},Xcj:function(){return n.Xcj},mzJ:function(){return n.mzJ},ZZA:function(){return n.ZZA},$Ph:function(){return nc},T__:function(){return n.T__},HkE:function(){return n.HkE},tGC:function(){return n.tGC},g1S:function(){return By},I$C:function(){return Oy},QIH:function(){return co},_JE:function(){return Pd},SwW:function(){return Ed},ksm:function(){return fo},jl_:function(){return ms},b7R:function(){return Ps},BDV:function(){return as},Ea_:function(){return ys},qff:function(){return ms},tmC:function(){return hs},BON:function(){return io},P40:function(){return Ms},wLL:function(){return Zs},iHO:function(){return xs},BbS:function(){return n.BbS},kqm:function(){return n.kqm},Hmr:function(){return n.Hmr},SJI:function(){return n.SJI},mTL:function(){return n.mTL},y8_:function(){return n.y8_},_Li:function(){return n._Li},w7U:function(){return ma},g56:function(){return V_},bj3:function(){return Qe},z81:function(){return n.z81},_MY:function(){return n._MY},yEv:function(){return Dv},dFZ:function(){return Ko},N$j:function(){return n.N$j},_YM:function(){return n._YM},TUj:function(){return n.TUj},ZzF:function(){return n.ZzF},qzb:function(){return v},GQ:function(){return n.GQ},nvb:function(){return n.nvb},DvJ:function(){return n.DvJ},fQA:function(){return n.fQA},cPz:function(){return La},TlE:function(){return n.TlE},u9r:function(){return n.u9r},s4_:function(){return n.s4_},T95:function(){return n.T95},F5w:function(){return xC},NlP:function(){return eT},$8Z:function(){return AC},YYN:function(){return hE},CtF:function(){return n.CtF},V1s:function(){return n.V1s},jOv:function(){return Rt},Rki:function(){return n.Rki},pzV:function(){return Zk},itZ:function(){return kh},MMq:function(){return PT},qKx:function(){return Oh},Hmi:function(){return hk},X4S:function(){return OE},vlJ:function(){return oL},nPO:function(){return UE},zcQ:function(){return Ic},GH1:function(){return Rc},ROQ:function(){return n.ROQ},YN5:function(){return n.YN5},BVQ:function(){return n.BVQ},YT8:function(){return n.YT8},_DE:function(){return Lo},YGz:function(){return n.YGz},trn:function(){return n.trn},zf8:function(){return n.zf8},uWy:function(){return n.uWy},wYQ:function(){return Lp},SUY:function(){return n.SUY},Ilk:function(){return n.Ilk},R2R:function(){return n.R2R},epp:function(){return n.epp},xmJ:function(){return xo},GD$:function(){return fs},Z_g:function(){return n.Z_g},EB7:function(){return n.EB7},DqL:function(){return n.DqL},_3:function(){return n._3},b_z:function(){return n.b_z},OCn:function(){return GE},N_j:function(){return XL},hNv:function(){return nv},_am:function(){return n._am},kB7:function(){return _c},fY$:function(){return n.fY$},vxC:function(){return n.vxC},BtG:function(){return n.BtG},cBK:function(){return n.cBK},g8_:function(){return n.g8_},AXT:function(){return n.AXT},yj7:function(){return n.yj7},dYG:function(){return n.dYG},tm_:function(){return n.tm_},S2y:function(){return n.S2y},B02:function(){return n.B02},PeU:function(){return n.PeU},Hyl:function(){return n.Hyl},Wqd:function(){return n.Wqd},c0Q:function(){return MT},re0:function(){return TT},Xaj:function(){return n.Xaj},DUb:function(){return bl},dZ3:function(){return n.dZ3},m_w:function(){return n.m_w},fHI:function(){return n.fHI},LBq:function(){return n.LBq},Qww:function(){return kr.Q},CGV:function(){return t.Damper},JUT:function(){return n.JUT},p3g:function(){return n.p3g},IEO:function(){return n.IEO},yxD:function(){return n.yxD},CUS:function(){return Iv},A5E:function(){return n.A5E},zqG:function(){return Rd},PfX:function(){return Ns},Q1o:function(){return Is},jfJ:function(){return n.jfJ},T_J:function(){return n.T_J},tEQ:function(){return n.tEQ},gb4:function(){return os},qkB:function(){return n.qkB},cvk:function(){return ta},HWo:function(){return la},brP:function(){return n.brP},$YQ:function(){return n.$YQ},X8d:function(){return cT},Zdt:function(){return uT},yNB:function(){return Sc},h7x:function(){return Tc},Ox3:function(){return n.Ox3},qtn:function(){return Lr},cBI:function(){return n.cBI},cU9:function(){return n.cU9},ntt:function(){return n.ntt},DT1:function(){return n.DT1},Kgo:function(){return n.Kgo},ehD:function(){return n.ehD},fhJ:function(){return mo},y1s:function(){return go},fSK:function(){return n.fSK},Vdb:function(){return n.Vdb},l8J:function(){return n.l8J},dj0:function(){return n.dj0},QM0:function(){return n.QM0},n94:function(){return Ry},OIS:function(){return q_},q8b:function(){return Mh},TOt:function(){return n.TOt},xaN:function(){return p},Ny0:function(){return n.Ny0},NeD:function(){return tC},Zof:function(){return js},N1Y:function(){return ky},itK:function(){return ga},eD:function(){return n.eD},jwo:function(){return n.jwo},dSO:function(){return n.dSO},Bf4:function(){return n.Bf4},USm:function(){return n.USm},pBf:function(){return n.pBf},eBg:function(){return AO},$Vf:function(){return n.$Vf},O7d:function(){return n.O7d},ksq:function(){return lm},hFL:function(){return LE},gXf:function(){return F_},hH6:function(){return n.hH6},izP:function(){return DT},kpi:function(){return Ca},DwZ:function(){return gT},kN3:function(){return _T},e62:function(){return n.e62},a$l:function(){return n.a$l},OM3:function(){return n.OM3},VzW:function(){return n.VzW},ybr:function(){return n.ybr},yo9:function(){return n.yo9},Dzq:function(){return ac},zCA:function(){return lc},$Bt:function(){return oa},Wzm:function(){return n.Wzm},Wl3:function(){return n.Wl3},iWj:function(){return n.iWj},DNz:function(){return mp},m1M:function(){return $t},ylh:function(){return n.ylh},v9Y:function(){return n.v9Y},LSk:function(){return n.LSk},LHE:function(){return Cl},KE0:function(){return kx},KCF:function(){return Bx},a4n:function(){return ly},NKC:function(){return Ap},jrv:function(){return xp},zIH:function(){return dr},Hfk:function(){return Tr},png:function(){return Sr},tAj:function(){return Mr},Eb_:function(){return Dr},SJj:function(){return vp},cF0:function(){return Xe},BT2:function(){return tv},_8p:function(){return sy},V5Z:function(){return Dp},s5b:function(){return Ip},BHZ:function(){return _a},hkn:function(){return Ht},GFY:function(){return Yt},w$m:function(){return n.w$m},ksN:function(){return n.ksN},j4z:function(){return n.j4z},OAl:function(){return n.OAl},VLJ:function(){return n.VLJ},C73:function(){return Q_},ZAu:function(){return n.ZAu},ibP:function(){return vs},lth:function(){return np},_fI:function(){return fs},hUN:function(){return dc},cLu:function(){return n.cLu},vmT:function(){return n.vmT},Qpg:function(){return n.Qpg},So8:function(){return n.So8},eOv:function(){return Wk},Wjw:function(){return n.Wjw},cJO:function(){return n.cJO},QRU:function(){return n.QRU},S3k:function(){return n.S3k},OPJ:function(){return kE},PpQ:function(){return n.PpQ},q_9:function(){return _n},ZRs:function(){return n.ZRs},oqc:function(){return n.oqc},T_x:function(){return us},lb7:function(){return n.lb7},L5s:function(){return n.L5s},$TI:function(){return n.$TI},SPe:function(){return n.SPe},aVm:function(){return n.aVm},j87:function(){return n.j87},RNb:function(){return n.RNb},Kz5:function(){return n.Kz5},vpT:function(){return n.vpT},kB5:function(){return n.kB5},_C8:function(){return n._C8},Syv:function(){return n.Syv},NMF:function(){return n.NMF},pIN:function(){return n.pIN},eMJ:function(){return n.eMJ},rN7:function(){return id},iUp:function(){return sd},GFd:function(){return Tv},x5V:function(){return n.x5V},tUh:function(){return n.tUh},z8B:function(){return n.z8B},vcl:function(){return tp},GZb:function(){return n.GZb},p7y:function(){return n.p7y},S9g:function(){return n.S9g},Zr5:function(){return n.Zr5},vCF:function(){return n.vCF},yt0:function(){return n.yt0},uXU:function(){return n.uXU},_kC:function(){return n._kC},lk7:function(){return n.lk7},USc:function(){return qk},x12:function(){return n.x12},w_R:function(){return Cv},Zzh:function(){return n.Zzh},nls:function(){return n.nls},g_z:function(){return n.g_z},U7:function(){return n.U7},FT0:function(){return n.FT0},L1_:function(){return Ev},blk:function(){return n.blk},YRm:function(){return Pa},ejS:function(){return n.ejS},wUb:function(){return xv},zOz:function(){return Da},rnI:function(){return n.rnI},wem:function(){return n.wem},lfu:function(){return n.lfu},FDw:function(){return n.FDw},lRj:function(){return n.lRj},D1R:function(){return n.D1R},qyh:function(){return n.qyh},GUF:function(){return n.GUF},EoG:function(){return n.EoG},aNw:function(){return n.aNw},Zp0:function(){return n.Zp0},lLk:function(){return n.lLk},jAl:function(){return n.jAl},uEv:function(){return n.uEv},YKA:function(){return n.YKA},cRx:function(){return n.cRx},Y8D:function(){return n.Y8D},RsA:function(){return n.RsA},Y0m:function(){return Bd},F5T:function(){return n.F5T},EDU:function(){return pm},z$Q:function(){return R_},KA8:function(){return Ft},ZqF:function(){return ya},XUj:function(){return O_},Me$:function(){return L_},u7G:function(){return n.u7G},PEk:function(){return gn},BG4:function(){return hm},M8C:function(){return n.M8C},Vkp:function(){return n.Vkp},yGw:function(){return n.yGw},Sm8:function(){return n.Sm8},Kj0:function(){return n.Kj0},vBJ:function(){return n.vBJ},QfV:function(){return hn},lRF:function(){return n.lRF},Lun:function(){return n.Lun},YBo:function(){return n.YBo},kaV:function(){return n.kaV},RSm:function(){return n.RSm},xoR:function(){return n.xoR},EJi:function(){return n.EJi},Wid:function(){return n.Wid},iuj:function(){return cn},IKL:function(){return n.IKL},r_:function(){return n.r_},OoA:function(){return n.OoA},qhX:function(){return n.qhX},CRe:function(){return rp},qPT:function(){return Fo},M5h:function(){return n.M5h},Ns1:function(){return n.Ns1},TyD:function(){return n.TyD},vZf:function(){return n.vZf},HTd:function(){return n.HTd},aH4:function(){return n.aH4},YLQ:function(){return n.YLQ},BVF:function(){return n.BVF},MyG:function(){return n.MyG},jFi:function(){return n.jFi},aCh:function(){return n.aCh},uL9:function(){return n.uL9},TNj:function(){return lp},IFH:function(){return n.IFH},bdR:function(){return n.bdR},RPs:function(){return Fl},kM_:function(){return vc},M6v:function(){return n.M6v},RvT:function(){return n.RvT},dUE:function(){return n.dUE},oe_:function(){return qd},BuN:function(){return Xd},Tme:function(){return n.Tme},N9P:function(){return vn},Gql:function(){return n.Gql},$XY:function(){return gr},O9d:function(){return Sa},zEO:function(){return bn},qfx:function(){return qE},PA7:function(){return n.PA7},REq:function(){return n.REq},pQR:function(){return n.pQR},ghN:function(){return n.ghN},Hy8:function(){return n.Hy8},Wpd:function(){return n.Wpd},LgZ:function(){return n.LgZ},iWC:function(){return n.iWC},mqn:function(){return sL},SKe:function(){return It},iKG:function(){return n.iKG},rCq:function(){return bE},_iA:function(){return n._iA},ntZ:function(){return n.ntZ},anP:function(){return n.anP},X2e:function(){return tE},oxT:function(){return op},FCo:function(){return KE},y$t:function(){return n.y$t},cPb:function(){return n.cPb},lmx:function(){return _l},JOQ:function(){return n.JOQ},BKK:function(){return n.BKK},_12:function(){return n._12},tJx:function(){return n.tJx},mjX:function(){return va},cek:function(){return n.cek},qD0:function(){return Ur},xG9:function(){return n.xG9},eqi:function(){return t.PointerDragHelper},wI8:function(){return CT},Sgv:function(){return ST},woe:function(){return n.woe},UY4:function(){return n.UY4},aq0:function(){return n.aq0},ujx:function(){return n.ujx},Uol:function(){return n.Uol},JiH:function(){return nC},VYz:function(){return n.VYz},B2H:function(){return fa},_Pm:function(){return ba},EsW:function(){return sa},iUV:function(){return n.iUV},tf:function(){return n.tf},ZQ6:function(){return n.ZQ6},mXe:function(){return n.mXe},_fP:function(){return n._fP},iLg:function(){return n.iLg},zbs:function(){return n.zbs},ZTh:function(){return n.ZTh},HdW:function(){return n.HdW},UZH:function(){return n.UZH},mSO:function(){return n.mSO},wk1:function(){return n.wk1},E2K:function(){return n.E2K},FUD:function(){return n.FUD},pKu:function(){return n.pKu},GG6:function(){return n.GG6},Gih:function(){return n.Gih},iiP:function(){return n.iiP},SvJ:function(){return n.SvJ},ptH:function(){return n.ptH},jZA:function(){return n.jZA},y2t:function(){return n.y2t},gi4:function(){return n.gi4},Djp:function(){return n.Djp},BG$:function(){return n.BG$},NYV:function(){return n.NYV},xJs:function(){return n.xJs},bsb:function(){return n.bsb},ekQ:function(){return n.ekQ},CaW:function(){return n.CaW},eaV:function(){return n.eaV},BFQ:function(){return n.BFQ},v3W:function(){return n.v3W},ILR:function(){return n.ILR},G_r:function(){return n.G_r},N3F:function(){return F},fto:function(){return n.fto},l0P:function(){return n.l0P},vCx:function(){return n.vCx},_AM:function(){return n._AM},wuA:function(){return n.wuA},av9:function(){return n.av9},CtA:function(){return n.CtA},BvQ:function(){return ql},FZJ:function(){return Kl},FIo:function(){return n.FIo},zHn:function(){return n.zHn},iMs:function(){return n.iMs},T_f:function(){return n.T_f},hEm:function(){return n.hEm},D9w:function(){return n.D9w},sHH:function(){return z_},CdI:function(){return n.CdI},rkc:function(){return Jk},rpg:function(){return n.rpg},ce8:function(){return n.ce8},rOj:function(){return n.rOj},P6m:function(){return Z_},JA6:function(){return J_},V4E:function(){return n.V4E},o8S:function(){return n.o8S},flB:function(){return kt},lGU:function(){return n.lGU},vuL:function(){return n.vuL},KI_:function(){return n.KI_},iLN:function(){return Qo},X6w:function(){return Cp},rz_:function(){return Sp},jsw:function(){return gc},srG:function(){return kl},i6Z:function(){return ec},vfv:function(){return ev},xsS:function(){return n.xsS},or:function(){return Xk},EQj:function(){return Wh},Rnn:function(){return RT},TyN:function(){return OT},ov0:function(){return Oa},WdD:function(){return n.WdD},Vj0:function(){return n.Vj0},jyz:function(){return n.jyz},mTM:function(){return Nt},Mn1:function(){return jt},Hlq:function(){return Gt},Fi7:function(){return N_},Tn7:function(){return n.Tn7},bnF:function(){return n.bnF},HW6:function(){return n.HW6},oa8:function(){return n.oa8},T_1:function(){return n.T_1},zHJ:function(){return eC},iDF:function(){return n.iDF},iAb:function(){return n.iAb},d4E:function(){return ov},lBg:function(){return Gk},JeJ:function(){return av},FKY:function(){return t.SimpleEventDispatcher},zlZ:function(){return Pv},vkg:function(){return An},brh:function(){return Rv},kZK:function(){return uC},puG:function(){return Vk},OdW:function(){return n.OdW},_YX:function(){return n._YX},TUv:function(){return n.TUv},Hw6:function(){return n.Hw6},aLr:function(){return n.aLr},Aip:function(){return n.Aip},xo$:function(){return n.xo$},bIn:function(){return aL},$V:function(){return n.$V},lDi:function(){return n.lDi},gti:function(){return n.gti},PMe:function(){return n.PMe},iwP:function(){return Fr},FvO:function(){return n.FvO},jyi:function(){return n.jyi},xeV:function(){return n.xeV},k74:function(){return n.k74},RlZ:function(){return n.RlZ},KhW:function(){return n.KhW},HgB:function(){return n.HgB},W2J:function(){return n.W2J},JWc:function(){return n.JWc},u37:function(){return n.u37},Z6B:function(){return n.Z6B},QZ1:function(){return n.QZ1},Ir4:function(){return n.Ir4},NwF:function(){return n.NwF},Wbm:function(){return n.Wbm},N4l:function(){return n.N4l},Jxm:function(){return B_},ej9:function(){return k_},QmN:function(){return n.QmN},Y4W:function(){return t.TYPED_ARRAYS},IOt:function(){return n.IOt},NOD:function(){return dp},L5g:function(){return n.L5g},H$k:function(){return n.H$k},cuP:function(){return aC},xEZ:function(){return n.xEZ},dpR:function(){return n.dpR},wOD:function(){return ua},KNb:function(){return po},IiN:function(){return Ro},Cne:function(){return n.Cne},XvJ:function(){return n.XvJ},XZw:function(){return n.XZw},FE5:function(){return n.FE5},lVp:function(){return ml},CJI:function(){return n.CJI},z$h:function(){return n.z$h},UlW:function(){return n.UlW},WwZ:function(){return n.WwZ},zG7:function(){return Rp},Lcc:function(){return n.Lcc},WXh:function(){return n.WXh},Vjr:function(){return JE},LuM:function(){return zk},LP5:function(){return xk},ub3:function(){return n.ub3},OV:function(){return aD},G_n:function(){return lD},xfE:function(){return n.xfE},qlB:function(){return n.qlB},lCJ:function(){return n.lCJ},WTc:function(){return n.WTc},rAo:function(){return n.rAo},LZj:function(){return Io},xWb:function(){return n.xWb},gH0:function(){return n.gH0},rBU:function(){return n.rBU},rDY:function(){return n.rDY},ywz:function(){return n.ywz},wJv:function(){return n.wJv},JQ4:function(){return n.JQ4},k0A:function(){return n.k0A},irR:function(){return n.irR},LsT:function(){return n.LsT},q5h:function(){return so},TKh:function(){return ro},tyg:function(){return no},Ro5:function(){return Ss},dwk:function(){return n.dwk},t0w:function(){return pD},M7$:function(){return hD},ML4:function(){return uD},FM8:function(){return n.FM8},Pa4:function(){return n.Pa4},Ltg:function(){return n.Ltg},yC1:function(){return n.yC1},lHq:function(){return Kh},fO1:function(){return n.fO1},oMA:function(){return yo},JzW:function(){return e},QEt:function(){return Hh},b5g:function(){return n.b5g},Ywn:function(){return n.Ywn},GVz:function(){return n.GVz},oAp:function(){return n.oAp},kFz:function(){return n.kFz},dd2:function(){return n.dd2},CP7:function(){return n.CP7},fQK:function(){return n.fQK},Wd$:function(){return sv},t1_:function(){return bO},v27:function(){return ka},Uk6:function(){return n.Uk6},H7Z:function(){return Ia},_sL:function(){return n._sL},czO:function(){return cD},Pnf:function(){return n.Pnf},c8b:function(){return n.c8b},_lf:function(){return n._lf},ad5:function(){return n.ad5},sZV:function(){return $s},TfA:function(){return Js},sKX:function(){return lo},UdM:function(){return Ks},P0y:function(){return ws},L_r:function(){return n.L_r},zC5:function(){return t.absMax},Bve:function(){return rv},b5G:function(){return Yo},UeO:function(){return Or},qCx:function(){return YL},$nx:function(){return hy},Bk6:function(){return vr},EER:function(){return ep},y4l:function(){return xn},P39:function(){return Ep},HI1:function(){return t.aesGcmDecrypt},ZYi:function(){return t.aesGcmEncrypt},wXW:function(){return rg},r5x:function(){return eg},MSI:function(){return og},EUu:function(){return _L},jtH:function(){return Sh},T0T:function(){return Ph},gAb:function(){return uL},je_:function(){return hL},wBP:function(){return Ih},LU2:function(){return Xc},wQL:function(){return vL},Zs7:function(){return xg},sMc:function(){return t.arrayBufferToBase64},x7s:function(){return Ug},Mnd:function(){return AL},A0_:function(){return wL},d73:function(){return Gm},HCD:function(){return K},YQ8:function(){return qe},RG9:function(){return J},G2P:function(){return Qc},XLf:function(){return qc},CGN:function(){return Wc},RGi:function(){return t.base64ToArrayBuffer},mvg:function(){return Vm},Hiy:function(){return un},XMc:function(){return tg},N7M:function(){return Zm},iv:function(){return ig},n55:function(){return t.blobToDataURL},IaC:function(){return Nm},h9t:function(){return Kc},yDW:function(){return Jc},gJv:function(){return Yc},l$g:function(){return wC},vQi:function(){return $M},$MY:function(){return sn},wJl:function(){return nn},Z7Y:function(){return Gc},X7D:function(){return Hc},BnX:function(){return Vc},uZ5:function(){return nu},zVI:function(){return Wm},Wz1:function(){return t.colorToDataUrl},DpF:function(){return $o},nNb:function(){return gs},cqZ:function(){return _s},pKN:function(){return dE},CN8:function(){return xc},DdI:function(){return fE},rrX:function(){return mE},uqj:function(){return A},Z9P:function(){return P},KlC:function(){return bc},KVn:function(){return L},oau:function(){return wg},aw9:function(){return Me},Aap:function(){return tt},Dxg:function(){return t.copyProps},MjT:function(){return De},F7Q:function(){return Fc},IFq:function(){return bL},IJl:function(){return Lc},O5A:function(){return t.createCanvasElement},wCn:function(){return t.createDiv},gGT:function(){return Oc},pEc:function(){return pE},Bi6:function(){return t.createImage},fi_:function(){return Gg},TT:function(){return pg},q2Z:function(){return qO},NyK:function(){return We},bgu:function(){return t.createScriptFromURL},kcS:function(){return t.createStyles},rRN:function(){return bC},ivY:function(){return t.css},_s1:function(){return WL},_HO:function(){return q},tpL:function(){return X},DMK:function(){return oh},LjN:function(){return Rs},iFs:function(){return Bs},qTg:function(){return t.deepAccessObject},J4G:function(){return E},Zj8:function(){return dL},Wtl:function(){return ls},DmK:function(){return cs},Htt:function(){return xL},Nv0:function(){return S},tCp:function(){return M},Hx7:function(){return je},imt:function(){return Ue},US6:function(){return kg},vZs:function(){return Ec},TE$:function(){return ML},lmu:function(){return t.downloadBlob},SvO:function(){return t.downloadFile},YQY:function(){return Nc},mZN:function(){return zc},VvG:function(){return jc},omp:function(){return t.embedUrlRefs},utz:function(){return Qm},TFV:function(){return bo},hrz:function(){return t.escapeRegExp},H$s:function(){return T},JKM:function(){return fg},jZf:function(){return lL},RjL:function(){return Ek},RRI:function(){return Og},RUq:function(){return lC},_t4:function(){return bt},YHh:function(){return At},R8g:function(){return U},f1L:function(){return t.getFileHandle},Bbl:function(){return t.getFilenameFromPath},V9r:function(){return t.getKeyByValue},a95:function(){return t.getNewFileHandle},PZ2:function(){return t.getOrCall},w7A:function(){return t.getPropertyDescriptor},N6S:function(){return z},Uxp:function(){return G},tAz:function(){return j},R$F:function(){return H},N33:function(){return V},JFD:function(){return N},gw2:function(){return uo},rfc:function(){return t.getTypedArray},wo6:function(){return t.getUrlQueryParam},V4T:function(){return fr},H4P:function(){return t.glsl},NLp:function(){return wp},swA:function(){return bs},_Z3:function(){return As},ivc:function(){return gs},rZ1:function(){return _s},CpZ:function(){return zg},dyc:function(){return t.html},MxZ:function(){return t.htmlToCanvas},btp:function(){return t.htmlToPng},mXy:function(){return t.htmlToSvg},Ej0:function(){return $e},ep4:function(){return Se},DQP:function(){return et},VNr:function(){return Te},V7q:function(){return t.imageBitmapToBase64},hiB:function(){return t.imageDataToCanvas},zEk:function(){return t.imageToCanvas},qfq:function(){return t.imageUrlToImageData},piB:function(){return t.includesAll},IIc:function(){return mL},rrF:function(){return ps},naq:function(){return ds},zlD:function(){return C},sXR:function(){return rh},p5I:function(){return Dh},wps:function(){return EL},wuo:function(){return CL},GpE:function(){return t.isPropertyWritable},F4b:function(){return sh},NN$:function(){return _p},t$v:function(){return zm},tdn:function(){return Fh},Y9t:function(){return Uh},GEo:function(){return Uc},GGm:function(){return t.longestCommonPrefix},DH3:function(){return ng},uxM:function(){return t.makeColorSvg},zH3:function(){return t.makeColorSvgCircle},MLs:function(){return Xt},xXG:function(){return Ce},YM4:function(){return Th},B3r:function(){return cL},iAx:function(){return t.makeTextSvg},lDn:function(){return W},P1O:function(){return x},iib:function(){return O},qf5:function(){return k},n4s:function(){return w},fr:function(){return R},Z9s:function(){return D},oaQ:function(){return kc},CD7:function(){return gu},Rc0:function(){return Uu},iPG:function(){return th},TIc:function(){return t.mobileAndTabletCheck},xsC:function(){return ag},zOc:function(){return t.now},i8W:function(){return t.objectHasOwn},r46:function(){return Eg},z2C:function(){return t.onChange},N4A:function(){return t.onChange2},hjq:function(){return t.onChange3},_X$:function(){return t.parseFileExtension},_yn:function(){return zt},Dyg:function(){return t.pathJoin},cUc:function(){return ln},zGw:function(){return Ku},Ctq:function(){return Jm},$ch:function(){return TL},k5b:function(){return Xm},kZl:function(){return hg},OCg:function(){return yg},Kd3:function(){return t.prettyScrollbar},YjH:function(){return Fg},Ui8:function(){return cy},YD2:function(){return mu},vi9:function(){return gL},ij3:function(){return $m},pJq:function(){return t.readFile},YPW:function(){return Ym},_tY:function(){return t.remoteWorkerURL},Bg1:function(){return KO},kon:function(){return t.replaceAll},M3g:function(){return Bc},F2z:function(){return jm},pJF:function(){return HE},knz:function(){return n.knz},Ejo:function(){return t.safeSetProperty},BgY:function(){return Ge},qCG:function(){return Oe},HD9:function(){return Ne},Rgz:function(){return Ve},fEB:function(){return Le},Udc:function(){return Ze},ZQg:function(){return Je},ofC:function(){return Y},yRy:function(){return t.setUrlQueryParam},_NL:function(){return JL},LCA:function(){return Ke},Sy1:function(){return QO},Vs_:function(){return WO},j1w:function(){return yn},i8J:function(){return KL},p7C:function(){return Lt},ZAS:function(){return jh},ipH:function(){return PL},$TF:function(){return IL},uZI:function(){return RL},VWG:function(){return um},pQ7:function(){return Lh},STw:function(){return du},jc8:function(){return an},BL_:function(){return Hm},S6:function(){return qL},T8U:function(){return Gs},TD6:function(){return zs},akS:function(){return t.svgToCanvas},QKE:function(){return t.svgToPng},dKx:function(){return t.svgUrl},OvX:function(){return pL},doP:function(){return Re},$jA:function(){return Ie},T99:function(){return Pe},LJS:function(){return Be},VsW:function(){return t.timeout},LZE:function(){return B},YMc:function(){return DL},aPg:function(){return Z},LFn:function(){return t.toTitleCase},VsX:function(){return I},wey:function(){return Um},MaE:function(){return gt},s4x:function(){return vt},FJA:function(){return ut},vIA:function(){return mt},Spv:function(){return wt},w8l:function(){return yt},riG:function(){return _t},Kbh:function(){return pt},BFq:function(){return xt},t8K:function(){return dt},Q7n:function(){return ht},KGF:function(){return ft},e5:function(){return Q},Rik:function(){return oo},GZo:function(){return ao},Bds:function(){return Ts},HTu:function(){return Ds},cTq:function(){return t.uploadFile},X_Y:function(){return rn},dA8:function(){return tn},NSm:function(){return Et},bwS:function(){return Km},Lks:function(){return BL},Rvq:function(){return fL},P4F:function(){return t.verifyPermission},Pd0:function(){return _r},Pjo:function(){return qm},Tum:function(){return yr},dRH:function(){return Ar},RX0:function(){return br},reQ:function(){return kL},cWm:function(){return sg},NC9:function(){return t.writeFile},$Re:function(){return eo},Xo9:function(){return to},LNO:function(){return Es},iZP:function(){return Cs}}),function(e){e[e.Error=-2]="Error",e[e.Destroyed=-1]="Destroyed",e[e.None=0]="None",e[e.Running=1]="Running",e[e.Paused=2]="Paused"}(e||(e={}));var t=__webpackgi_require__(346),n=__webpackgi_require__(988);const r={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class i{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const s=new n.iKG(-1,1,1,-1,0,1),o=new n.u9r;o.setAttribute("position",new n.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new n.a$l([0,2,0,0,2,0],2));class a{constructor(e){this._mesh=new n.Kj0(o,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,s)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class l extends i{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof n.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=n.rDY.clone(e.uniforms),this.material=new n.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new a(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class c extends i{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),i=e.state;let s,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,s,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class u extends i{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class h{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const r=e.getSize(new n.FM8);this._width=r.width,this._height=r.height,(t=new n.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new l(r),this.clock=new n.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,r=this.passes.length;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==c&&(r instanceof c?n=!0:r instanceof u&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new n.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class p extends h{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}const d=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function f(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(d[255&e]+d[e>>8&255]+d[e>>16&255]+d[e>>24&255]+"-"+d[255&t]+d[t>>8&255]+"-"+d[t>>16&15|64]+d[t>>24&255]+"-"+d[63&n|128]+d[n>>8&255]+"-"+d[n>>16&255]+d[n>>24&255]+d[255&r]+d[r>>8&255]+d[r>>16&255]+d[r>>24&255]).toLowerCase()}function m(e,t,n){return Math.max(t,Math.min(n,e))}function g(e,t,n){return(1-n)*e+n*t}Math.PI,Math.PI;class _{constructor(e=0,t=0){_.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(m(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*r+e.x,this.y=i*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class v extends n.ZzF{expandByObject(e,t=!1,n=!1){if(!1===e.userData?.bboxVisible)return this;if(!e.visible&&n)return this;if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),y.copy(e.boundingBox),y.applyMatrix4(e.matrixWorld),this.union(y);else{const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,r=t.count;n<r;n++)b.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(b)}else null===n.boundingBox&&n.computeBoundingBox(),y.copy(n.boundingBox),y.applyMatrix4(e.matrixWorld),this.union(y)}const r=e.children;for(let e=0,i=r.length;e<i;e++)this.expandByObject(r[e],t,n);return this}expandByObjects(e,t=!1,n=!1){for(let r=0,i=e.length;r<i;r++)this.expandByObject(e[r],t,n);return this}getPoints(){return[new n.Pa4(this.min.x,this.min.y,this.min.z),new n.Pa4(this.min.x,this.min.y,this.max.z),new n.Pa4(this.min.x,this.max.y,this.min.z),new n.Pa4(this.min.x,this.max.y,this.max.z),new n.Pa4(this.max.x,this.min.y,this.min.z),new n.Pa4(this.max.x,this.min.y,this.max.z),new n.Pa4(this.max.x,this.max.y,this.min.z),new n.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),r=new n.TUj;for(const n of t){const t=n.project(e);r.min.min(t),r.max.max(t)}return r}}const y=new v,b=new n.Pa4;function A(e,t,r=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=new Float32Array(e.count*e.itemSize);for(let n=0,r=0;n<e.count;n++)t[r++]=e.getX(n),t[r++]=e.getY(n),e.itemSize>2&&(t[r++]=e.getZ(n));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const s=e.index?e.toNonIndexed():e,o=t.generateTangents(i(s.attributes.position),i(s.attributes.normal),i(s.attributes.uv));if(r)for(let e=3;e<o.length;e+=4)o[e]*=-1;return s.setAttribute("tangent",new n.TlE(o,4)),e!==s&&e.copy(s),e}function w(e,t=!1){const r=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),o={},a={},l=e[0].morphTargetsRelative,c=new n.u9r;let u=0;for(let n=0;n<e.length;++n){const h=e[n];let p=0;if(r!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(h.attributes[e]),p++}if(p!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(l!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!s.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(h.morphAttributes[e])}if(t){let e;if(r)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}c.addGroup(u,e,n),u+=e}}if(r){let t=0;const n=[];for(let r=0;r<e.length;++r){const i=e[r].index;for(let e=0;e<i.count;++e)n.push(i.getX(e)+t);t+=e[r].attributes.position.count}c.setIndex(n)}for(const e in o){const t=x(o[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;c.setAttribute(e,t)}for(const e in a){const t=a[e][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let r=0;r<a[e].length;++r)t.push(a[e][r][n]);const r=x(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;c.morphAttributes[e].push(r)}}return c}function x(e){let t,r,i,s=0;for(let n=0;n<e.length;++n){const o=e[n];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=o.normalized),i!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=o.array.length}const o=new t(s);let a=0;for(let t=0;t<e.length;++t)o.set(e[t].array,a),a+=e[t].array.length;return new n.TlE(o,r,i)}function E(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?S(e):e.isInstancedBufferAttribute?(new n.lb7).copy(e):(new n.TlE).copy(e)}function C(e){let t,r=0,i=0;for(let n=0,s=e.length;n<s;++n){const s=e[n];if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=s.array.length,i+=s.itemSize}const s=new n.vpT(new t(r),i);let o=0;const a=[],l=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let t=0,r=e.length;t<r;t++){const r=e[t],i=r.itemSize,u=r.count,h=new n.kB5(s,i,o,r.normalized);a.push(h),o+=i;for(let e=0;e<u;e++)for(let t=0;t<i;t++)h[c[t]](e,r[l[t]](e))}return a}function S(e){const t=e.data.array.constructor,r=e.count,i=e.itemSize,s=e.normalized,o=new t(r*i);let a;a=e.isInstancedInterleavedBufferAttribute?new n.lb7(o,i,s,e.meshPerAttribute):new n.TlE(o,i,s);for(let t=0;t<r;t++)a.setX(t,e.getX(t)),i>=2&&a.setY(t,e.getY(t)),i>=3&&a.setZ(t,e.getZ(t)),i>=4&&a.setW(t,e.getW(t));return a}function M(e){const t=e.attributes,n=e.morphTargets,r=new Map;for(const e in t){const n=t[e];n.isInterleavedBufferAttribute&&(r.has(n)||r.set(n,S(n)),t[e]=r.get(n))}for(const e in n){const t=n[e];t.isInterleavedBufferAttribute&&(r.has(t)||r.set(t,S(t)),n[e]=r.get(t))}}function T(e){let t=0;for(const n in e.attributes){const r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function D(e,t=1e-4){const r=t>0;t=Math.max(t,Number.EPSILON);const i={},s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count;let l=0;const c=Object.keys(e.attributes),u={},h={},p=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let t=0,r=c.length;t<r;t++){const r=c[t],i=e.attributes[r];u[r]=new n.TlE(new i.array.constructor(i.count*i.itemSize),i.itemSize,i.normalized);const s=e.morphAttributes[r];s&&(h[r]=new n.TlE(new s.array.constructor(s.count*s.itemSize),s.itemSize,s.normalized))}const m=Math.log10(1/t),g=Math.pow(10,m);for(let t=0;t<a;t++){const n=s?s.getX(t):t;let o="";for(let t=0,i=c.length;t<i&&r;t++){const r=c[t],i=e.getAttribute(r),s=i.itemSize;for(let e=0;e<s;e++)o+=~~(i[d[e]](n)*g)+","}if(r&&o in i)p.push(i[o]);else{for(let t=0,r=c.length;t<r;t++){const r=c[t],i=e.getAttribute(r),s=e.morphAttributes[r],o=i.itemSize,a=u[r],p=h[r];for(let e=0;e<o;e++){const t=d[e],r=f[e];if(a[r](l,i[t](n)),s)for(let e=0,i=s.length;e<i;e++)p[e][r](l,s[e][t](n))}}r&&(i[o]=l),p.push(l),l++}}const _=e.clone();for(const t in e.attributes){const e=u[t];if(_.setAttribute(t,new n.TlE(e.array.slice(0,l*e.itemSize),e.itemSize,e.normalized)),t in h)for(let e=0;e<h[t].length;e++){const r=h[t][e];_.morphAttributes[t][e]=new n.TlE(r.array.slice(0,l*r.itemSize),r.itemSize,r.normalized)}}return _.setIndex(p),_}function I(e,t){if(t===n.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===n.z$h||t===n.UlW){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const i=r.count-2,s=[];if(t===n.z$h)for(let e=1;e<=i;e++)s.push(r.getX(0)),s.push(r.getX(e)),s.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(s.push(r.getX(e)),s.push(r.getX(e+1)),s.push(r.getX(e+2))):(s.push(r.getX(e+2)),s.push(r.getX(e+1)),s.push(r.getX(e)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(s),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function P(e){const t=new n.Pa4,r=new n.Pa4,i=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4,u=new n.Pa4;function h(e,n,h,p,d,f,m,g){t.fromBufferAttribute(n,d),r.fromBufferAttribute(n,f),i.fromBufferAttribute(n,m);const _=e.morphTargetInfluences;if(h&&_){l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(let e=0,n=h.length;e<n;e++){const n=_[e],g=h[e];0!==n&&(s.fromBufferAttribute(g,d),o.fromBufferAttribute(g,f),a.fromBufferAttribute(g,m),p?(l.addScaledVector(s,n),c.addScaledVector(o,n),u.addScaledVector(a,n)):(l.addScaledVector(s.sub(t),n),c.addScaledVector(o.sub(r),n),u.addScaledVector(a.sub(i),n)))}t.add(l),r.add(c),i.add(u)}e.isSkinnedMesh&&(e.applyBoneTransform(d,t),e.applyBoneTransform(f,r),e.applyBoneTransform(m,i)),g[3*d+0]=t.x,g[3*d+1]=t.y,g[3*d+2]=t.z,g[3*f+0]=r.x,g[3*f+1]=r.y,g[3*f+2]=r.z,g[3*m+0]=i.x,g[3*m+1]=i.y,g[3*m+2]=i.z}const p=e.geometry,d=e.material;let f,m,g;const _=p.index,v=p.attributes.position,y=p.morphAttributes.position,b=p.morphTargetsRelative,A=p.attributes.normal,w=p.morphAttributes.position,x=p.groups,E=p.drawRange;let C,S,M,T,D,I,P;const R=new Float32Array(v.count*v.itemSize),B=new Float32Array(A.count*A.itemSize);if(null!==_)if(Array.isArray(d))for(C=0,M=x.length;C<M;C++)for(D=x[C],I=Math.max(D.start,E.start),P=Math.min(D.start+D.count,E.start+E.count),S=I,T=P;S<T;S+=3)f=_.getX(S),m=_.getX(S+1),g=_.getX(S+2),h(e,v,y,b,f,m,g,R),h(e,A,w,b,f,m,g,B);else for(I=Math.max(0,E.start),P=Math.min(_.count,E.start+E.count),C=I,M=P;C<M;C+=3)f=_.getX(C),m=_.getX(C+1),g=_.getX(C+2),h(e,v,y,b,f,m,g,R),h(e,A,w,b,f,m,g,B);else if(Array.isArray(d))for(C=0,M=x.length;C<M;C++)for(D=x[C],I=Math.max(D.start,E.start),P=Math.min(D.start+D.count,E.start+E.count),S=I,T=P;S<T;S+=3)f=S,m=S+1,g=S+2,h(e,v,y,b,f,m,g,R),h(e,A,w,b,f,m,g,B);else for(I=Math.max(0,E.start),P=Math.min(v.count,E.start+E.count),C=I,M=P;C<M;C+=3)f=C,m=C+1,g=C+2,h(e,v,y,b,f,m,g,R),h(e,A,w,b,f,m,g,B);return{positionAttribute:v,normalAttribute:A,morphedPositionAttribute:new n.a$l(R,3),morphedNormalAttribute:new n.a$l(B,3)}}function R(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort(((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start)),null===e.getIndex()){const t=e.getAttribute("position"),n=[];for(let e=0;e<t.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}const n=e.getIndex(),r=[];for(let e=0;e<t.length;e++){const i=t[e],s=i.start,o=s+i.count;for(let e=s;e<o;e++)r.push(n.getX(e))}e.dispose(),e.setIndex(r);let i=0;for(let e=0;e<t.length;e++){const n=t[e];n.start=i,i+=n.count}let s=t[0];e.groups=[s];for(let n=1;n<t.length;n++){const r=t[n];s.materialIndex===r.materialIndex?s.count+=r.count:(s=r,e.groups.push(s))}return e}function B(e,t=Math.PI/3){const r=Math.cos(t),i=100*(1+1e-10),s=[new n.Pa4,new n.Pa4,new n.Pa4],o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4;function u(e){return`${~~(e.x*i)},${~~(e.y*i)},${~~(e.z*i)}`}const h=e.toNonIndexed(),p=h.attributes.position,d={};for(let e=0,t=p.count/3;e<t;e++){const t=3*e,r=s[0].fromBufferAttribute(p,t+0),i=s[1].fromBufferAttribute(p,t+1),l=s[2].fromBufferAttribute(p,t+2);o.subVectors(l,i),a.subVectors(r,i);const c=(new n.Pa4).crossVectors(o,a).normalize();for(let e=0;e<3;e++){const t=u(s[e]);t in d||(d[t]=[]),d[t].push(c)}}const f=new Float32Array(3*p.count),m=new n.TlE(f,3,!1);for(let e=0,t=p.count/3;e<t;e++){const t=3*e,n=s[0].fromBufferAttribute(p,t+0),i=s[1].fromBufferAttribute(p,t+1),h=s[2].fromBufferAttribute(p,t+2);o.subVectors(h,i),a.subVectors(n,i),l.crossVectors(o,a).normalize();for(let e=0;e<3;e++){const n=d[u(s[e])];c.set(0,0,0);for(let e=0,t=n.length;e<t;e++){const t=n[e];l.dot(t)>r&&c.add(t)}c.normalize(),m.setXYZ(t+e,c.x,c.y,c.z)}}return h.setAttribute("normal",m),h}function k(e,t=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),w(e,t)}function O(e){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),x(e)}function L(e,t){let r,i;if(Array.isArray(e))for(const n of e){const e=L(n,t);void 0===r||void 0===i?(r=e.min.clone(),i=e.max.clone()):(r.min(e.min),i.max(e.max))}const s=e;if(void 0!==s.geometry){const o=s.geometry.vertices;if(void 0===o&&void 0!==s.geometry.attributes&&"position"in s.geometry.attributes){const o=new n.Pa4,a=s.geometry.attributes.position;for(let n=0;n<a.count*a.itemSize;n+=a.itemSize){o.set(a.array[n],a.array[n+1],a.array[3]);const s=o.applyMatrix4(e.matrixWorld).project(t),l=new _(s.x,s.y);void 0===r||void 0===i?(r=l.clone(),i=l.clone()):(r.min(l),i.max(l))}}else for(const n of o){const s=n.clone().applyMatrix4(e.matrixWorld).project(t),o=new _(s.x,s.y);void 0===r||void 0===i?(r=o.clone(),i=o.clone()):(r.min(o),i.max(o))}}if(void 0!==e.children)for(const n of e.children){const e=L(n,t);void 0===r||void 0===i?(r=e.min.clone(),i=e.max.clone()):(r.min(e.min),i.max(e.max))}return new n.TUj(r,i)}const F="rgbm-16";function U(e){switch(e){case n.aCh:case n.GUF:return["Linear","( value )"];case n.KI_:return["sRGB","( value )"];case F:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",e),["Linear","( value )"]}}function N(e,t){let r;return e&&e.isTexture?r=e.colorSpace:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.colorSpace):r=n.GUF,t&&e&&e.isTexture&&e.format===n.wk1&&e.type===n.ywz&&e.colorSpace===n.KI_&&(r=n.GUF),r}function j(e,t){const n=U(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function z(e,t,n){return j(e+"TexelToLinear",N(t,n))+"\n"}function G(e,t){return j(e+"TexelToLinear",t)+"\n"}function V(e,t){const n=U(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function H(e,t,n){return V(e,N(t,n))}function Q({uniforms:e,propKey:n,thisTarget:r=!1}={}){const i=!!e,s=!!n,o=r;return(r,a)=>{const l=t=>{const r=o?t:i?e:t.uniforms||t._uniforms;let l=s?n:a;o&&(l="_"+l);let c=r[l];return c||(c={value:null},r[l]=c),c};Object.defineProperty(r,a,{get(){return l(this).value},set(e){l(this).value=e,(0,t.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function W(e,n,r=!1,i){const s=!!n,o=!!e;return(a,l)=>{const c=t=>({t:s?n:t.defines||t._defines,p:o?e:l});Object.defineProperty(a,l,{get(){const{t:e,p:t}=c(r?this:this.material);return e[t]},set(e){const{t:n,p:s}=c(r?this:this.material);if((0,t.safeSetProperty)(n,s,e,!0),"function"==typeof i){const t=[s,e];if(i.name){const e=this[i.name];e===i?i.call(this,...t):e.name===`bound ${i.name}`?e(...t):i(...t)}else i(...t)}else(0,t.safeSetProperty)(r?this:this.material,"needsUpdate",!0,!0)}})}}function q(e){const t=new n.IEO(new Uint8Array([Math.floor(255*e.r),Math.floor(255*e.g),Math.floor(255*e.b),255]),1,1,n.wk1,n.ywz);return t.needsUpdate=!0,t.colorSpace=n.aCh,t}function X(e){const t=new n.IEO(new Uint8Array([Math.floor(255*e.x),Math.floor(255*e.y),Math.floor(255*e.z),Math.floor(255*e.w)]),1,1,n.wk1,n.ywz);return t.needsUpdate=!0,t}function Y(e,t,n){const r=e.userData,{backgroundRender:i,transparentRender:s,shadowMapRender:o,mainRenderPass:a,opaqueRender:l,transmissionRender:c,sceneRender:u,screenSpaceRendering:h}=r;void 0!==t.backgroundRender&&(r.backgroundRender=t.backgroundRender),void 0!==t.transparentRender&&(r.transparentRender=t.transparentRender),void 0!==t.shadowMapRender&&(r.shadowMapRender=t.shadowMapRender),void 0!==t.mainRenderPass&&(r.mainRenderPass=t.mainRenderPass),void 0!==t.opaqueRender&&(r.opaqueRender=t.opaqueRender),void 0!==t.sceneRender&&(r.sceneRender=t.sceneRender),void 0!==t.transmissionRender&&(r.transmissionRender=t.transmissionRender),void 0!==t.screenSpaceRendering&&(r.screenSpaceRendering=t.screenSpaceRendering),n(),r.backgroundRender=i,r.transparentRender=s,r.shadowMapRender=o,r.mainRenderPass=a,r.opaqueRender=l,r.sceneRender=u,r.transmissionRender=c,r.screenSpaceRendering=h}function K(e){const t=(new v).expandByObject(e,!0,!0).getCenter(new n.Pa4);e.position.sub(t),e.updateMatrix(),e.userData.autoCentered=!0,e.userData.isCentered=!0}function J(e,t,r){const i=.5*(new v).expandByObject(e,!0,!0).getSize(new n.Pa4).length();void 0===t&&(t=e.userData.autoScaleRadius||1);const s=t/i;return isFinite(s)&&(e.userData.pseudoCentered?e.children.forEach((e=>{e.scale.multiplyScalar(s)})):e.scale.multiplyScalar(s),(r||e.userData.isCentered)&&e.position.multiplyScalar(s),e.traverse((e=>{e.isLight&&e.shadow?.camera?.right&&(e.shadow.camera.right*=s,e.shadow.camera.left*=s,e.shadow.camera.top*=s,e.shadow.camera.bottom*=s),e.isCamera&&e.right&&(e.right*=s,e.left*=s,e.top*=s,e.bottom*=s)})),e.userData.autoScaled=!0,e.userData.autoScaleRadius=t,e.dispatchEvent({type:"objectUpdate"})),e}function Z(e,t=-1){return D(e,t)}const $=2,ee=3,te=0,ne=1,re=3,ie=4,se=1006,oe=3001,ae="srgb",le="srgb-linear",ce="display-p3";class ue{constructor(){ue.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,i,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],g=r[6],_=r[1],v=r[4],y=r[7],b=r[2],A=r[5],w=r[8];return i[0]=s*f+o*_+a*b,i[3]=s*m+o*v+a*A,i[6]=s*g+o*y+a*w,i[1]=l*f+c*_+u*b,i[4]=l*m+c*v+u*A,i[7]=l*g+c*y+u*w,i[2]=h*f+p*_+d*b,i[5]=h*m+p*v+d*A,i[8]=h*g+p*y+d*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,h=o*a-c*i,p=l*i-s*a,d=t*u+n*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(o*n-r*s)*f,e[3]=h*f,e[4]=(c*t-r*a)*f,e[5]=(r*i-o*t)*f,e[6]=p*f,e[7]=(n*a-l*t)*f,e[8]=(s*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+e,-r*l,r*a,-r*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(he.makeScale(e,t)),this}rotate(e){return this.premultiply(he.makeRotation(-e)),this}translate(e,t){return this.premultiply(he.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const he=new ue;function pe(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function de(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const fe=(new ue).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),me=(new ue).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),ge={[le]:e=>e,[ae]:e=>e.convertSRGBToLinear(),[ce]:function(e){return e.convertSRGBToLinear().applyMatrix3(me)}},_e={[le]:e=>e,[ae]:e=>e.convertLinearToSRGB(),[ce]:function(e){return e.applyMatrix3(fe).convertLinearToSRGB()}},ve={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return le},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=ge[t],i=_e[n];if(void 0===r||void 0===i)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return i(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},ye={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},be={h:0,s:0,l:0},Ae={h:0,s:0,l:0};function we(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class xe{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ae){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ve.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=ve.workingColorSpace){return this.r=e,this.g=t,this.b=n,ve.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=ve.workingColorSpace){if(e=function(e,t){return(e%1+1)%1}(e),t=m(t,0,1),n=m(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=we(i,r,e+1/3),this.g=we(i,r,e),this.b=we(i,r,e-1/3)}return ve.toWorkingColorSpace(this,r),this}setStyle(e,t=ae){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ae){const n=ye[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=pe(e.r),this.g=pe(e.g),this.b=pe(e.b),this}copyLinearToSRGB(e){return this.r=de(e.r),this.g=de(e.g),this.b=de(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ae){return ve.fromWorkingColorSpace(Ee.copy(this),e),65536*Math.round(m(255*Ee.r,0,255))+256*Math.round(m(255*Ee.g,0,255))+Math.round(m(255*Ee.b,0,255))}getHexString(e=ae){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ve.workingColorSpace){ve.fromWorkingColorSpace(Ee.copy(this),t);const n=Ee.r,r=Ee.g,i=Ee.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case n:a=(r-i)/e+(r<i?6:0);break;case r:a=(i-n)/e+2;break;case i:a=(n-r)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=ve.workingColorSpace){return ve.fromWorkingColorSpace(Ee.copy(this),t),e.r=Ee.r,e.g=Ee.g,e.b=Ee.b,e}getStyle(e=ae){ve.fromWorkingColorSpace(Ee.copy(this),e);const t=Ee.r,n=Ee.g,r=Ee.b;return e!==ae?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(be),be.h+=e,be.s+=t,be.l+=n,this.setHSL(be.h,be.s,be.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(be),e.getHSL(Ae);const n=g(be.h,Ae.h,t),r=g(be.s,Ae.s,t),i=g(be.l,Ae.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ee=new xe;function Ce(e,t){return{type:"folder",label:t+" Sampler",hidden:()=>!e[t],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[e[t],"repeat"],onChange:e?.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[e[t],"offset"],onChange:e?.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[e[t],"center"],onChange:e?.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[e[t],"rotation"],onChange:e?.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[e[t],"colorSpace"],children:[["Linear",n.GUF],["sRGB",n.KI_]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{const n=e[t];n&&(n.needsUpdate=!0)},e?.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>e[t]?.flipY??!1,setValue:n=>{const r=e[t];if(r&&r.flipY!==n)if(r.image&&ImageBitmap&&r.image instanceof ImageBitmap){const t=r,i=r.source.data;createImageBitmap(i,{imageOrientation:"flipY"}).then((r=>{i.close&&i.close(),t.flipY=n,t.source.data=r,t.source.needsUpdate=!0,t.needsUpdate=!0,e?.setDirty?.()}))}else r.flipY=n,r.needsUpdate=!0,e?.setDirty?.()}}),()=>({type:"dropdown",label:"Wrap S",property:[e[t],"wrapS"],children:[["ClampToEdge",n.uWy],["MirroredRepeat",n.OoA],["Repeat",n.rpg]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},e?.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[e[t],"wrapT"],children:[["ClampToEdge",n.uWy],["MirroredRepeat",n.OoA],["Repeat",n.rpg]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},e?.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[e[t],"anisotropy"],onChange:[()=>{e[t]&&(e[t].needsUpdate=!0),e.needsUpdate=!0},e?.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[e[t],"minFilter"],children:[["Linear",se],["Nearest",n.TyD],["NearestMipmapNearest",n.YLQ],["NearestMipmapLinear",n.vZf],["LinearMipmapNearest",n.qyh],["LinearMipmapLinear",n.D1R]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},e?.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[e[t],"magFilter"],children:[["Linear",se],["Nearest",n.TyD]].map((e=>({label:e[0],value:e[1]}))),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},e?.setDirty]})]}}xe.NAMES=ye;const Se=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Me(e,t,n=!0){if(!t)return e;for(const r of Object.keys(t)){if(n&&Se.includes(r))continue;if(r.startsWith("__"))continue;const i=t[r];if("function"==typeof e[r]||"function"==typeof i)continue;const s=!i||i.isTexture||i.isObject3D||i.isMaterial;s||"function"!=typeof i.clone?s||"object"!=typeof i&&!Array.isArray(i)?e[r]=i:e[r]=Me(Array.isArray(i)?[]:{},i,!1):e[r]=i.clone()}return e}const Te=["appliedMaterials","uuid"];function De(e,t){if(t)for(const n of Object.keys(t))Te.includes(n)||n.startsWith("__")||"function"!=typeof e[n]&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}function Ie(e,r,i){const s=i?.data??new Uint8ClampedArray(e.height*e.width*4),o=e.data instanceof Float32Array,a=e.data instanceof Uint16Array;for(let i=0;i<s.length;i++)s[i]=o?255*e.data[i]:a?255*n.A5E.fromHalfFloat(e.data[i]):e.data[i],r===n.GUF&&(s[i]=255*(0,t.LinearToSRGB)(s[i]/255));return i??new ImageData(s,e.width,e.height)}function Pe(e,t,n=!1){let r;return r=e.isDataTexture?Ie(e.image,e.colorSpace):e.image,Re(r,t,n)}function Re(e,n,r=!1){const i=document.createElement("canvas");i.width=Math.min(n,e.width),i.height=Math.floor(1+i.width*e.height/e.width);const s=i.getContext("2d");if(!s)return console.error("textureToDataUrl: could not get canvas context"),i;!0===r&&(s.translate(0,i.height),s.scale(1,-1));let o=!1;if(void 0!==e.data){const t=e;if(e.width!==i.width||e.height!==i.height){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r?(r.putImageData(t,0,0),s.drawImage(n,0,0,i.width,i.height)):(console.error("textureToDataUrl: could not get temp canvas context"),s.putImageData(t,0,0))}else s.putImageData(t,0,0),r&&(o=!0)}else s.drawImage(e,0,0,i.width,i.height);return o?(0,t.canvasFlipY)(i):i}function Be(e,t,n,r,i){return Pe(e,t,n).toDataURL(r,i)}String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)});const ke=new Map;function Oe(e){return(t,n)=>{const r=t.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");ke.has(r)||ke.set(r,[]),ke.get(r).push([e||n,n])}}const Le={obj:(e,t)=>Object.fromEntries(Object.entries(e).map((([e,n])=>[e,Ne(n,!1,t)]))),vec4:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isVector4:!0}),vec3:e=>({x:e.x,y:e.y,z:e.z,isVector3:!0}),vec2:e=>({x:e.x,y:e.y,isVector2:!0}),color:e=>({r:e.r,g:e.g,b:e.b,isColor:!0}),quat:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isQuaternion:!0}),texture:(e,t)=>{if(!e?.isTexture)throw new Error("Expected a texture");if(t?.textures[e.uuid])return{uuid:e.uuid,resource:"textures"};if(e.isRenderTargetTexture&&!e.userData?.serializableRenderTarget)return;const n=e.source.data,r=!e.isRenderTargetTexture&&e.userData.rootPath;r&&e.source.data&&(e.userData.__embedUrlImagePreviews?e.source.data=Pe(e,16,e.flipY):e.source.data=null);const i=e.userData;e.userData={};const s={images:{}};let o=e.toJSON(t||s);return!t&&o.image&&(o.image=r&&!e.userData.__embedUrlImagePreviews?void 0:s.images[o.image]),e.userData=i,o.userData=Ne(De({},i),!1,t),r&&(t&&!e.userData.__embedUrlImagePreviews&&delete t.images[e.source.uuid],e.source.data=n),t?.textures&&!o.resource&&(t.textures[o.uuid]||(t.textures[o.uuid]=o),o={uuid:o.uuid,resource:"textures"}),o},material:(e,t)=>{if(!e?.isMaterial)throw new Error("Expected a material");if(t?.materials[e.uuid])return{uuid:e.uuid,resource:"materials"};e.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const n=t??{textures:{},images:{}},r={},i={};for(const[t,s]of Object.entries(e))if(s?.isTexture&&!t.startsWith("__")){const o=Le.texture(s,n);r[t]=o,i[t]=s,e[t]=o?{isTexture:!0,toJSON:()=>o}:null}let s=e.toJSON(t);for(const[t,n]of Object.entries(i))e[t]=n,delete i[t];if(t){for(const[e,t]of Object.entries(r))t&&(s[e]=t);t?.materials&&(t.materials[s.uuid]||(t.materials[s.uuid]=s),s={uuid:s.uuid,resource:"materials"})}else{for(const[e,t]of Object.entries(r))t&&(s[e]=t.uuid);s.textures=Object.values(n.textures),s.images=Object.values(n.images)}return s}},Fe=e=>(t,n)=>n?.copy?.(t)??(new e).copy(t),Ue={obj:(e,t,n)=>Object.assign(t,Object.fromEntries(Object.entries(e).map((([e,r])=>[e,je(r,t?.[e],!1,n)])))),vec4:Fe(n.Ltg),vec3:Fe(n.Pa4),vec2:Fe(_),color:Fe(xe),quat:Fe(n._fP)};function Ne(e,t,n){if("function"==typeof e)return;if(Array.isArray(e))return e.map((e=>Ne(e,!1,n)));if("object"!=typeof e){if("number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e}if(!e)return e;let r=e.constructor??Object;if(r===Object)return Le.obj(e,n);if(e.isVector2)return Le.vec2(e);if(e.isVector3)return Le.vec3(e);if(e.isVector4)return Le.vec4(e);if(e.isColor)return Le.color(e);if(e.isQuaternion)return Le.quat(e);if(e.isTexture)return Le.texture(e,n);if(e.isMaterial)return Le.material(e,n);if(!t&&"function"==typeof e.toJSON){const t=e.toJSON(n);return e.serializableClassId&&t&&(t.serializableClassId=e.serializableClassId),t}const i={};for(;r&&r!==Object;)ke.get(r)?.forEach((([t,r])=>{const s=e[r];i[t]=Ne(s,!1,n)})),r=Object.getPrototypeOf(r);return e.serializableClassId&&(i.serializableClassId=e.serializableClassId),i}function je(e,n,r,i){let s=n;if(void 0===e)return s;if("number"==typeof n){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}if(Array.isArray(e)){const t=e.length;Array.isArray(s)||(s=[]);for(let n=0;n<t;n++){const t=e[n],r=s.length>n?je(t,s[n],!1,i):je(t,void 0,!1,i);s.length<=n?s.push(r):s[n]=r}return s}let o=!1;if(e&&e.resource&&"string"==typeof e.resource&&(e=i[e.resource]?.[e.uuid],o=!0),!s&&e&&!o)if(e.serializableClassId){const t=ze.get(e.serializableClassId);t&&(s=t.DataInConstructor?new t(e):new t)}else"object"!=typeof e||e.constructor&&e.constructor!==Object||(s={});if("function"==typeof s)return console.error("cannot deserialize over function",s,e),s;if(e&&"object"==typeof e&&!o){if(e.isVector2)return Ue.vec2(e,s);if(e.isVector3)return Ue.vec3(e,s);if(e.isVector4)return Ue.vec4(e,s);if(e.isColor)return Ue.color(e,s);if(e.isQuaternion)return Ue.quat(e,s)}if(null==e||null==s||"object"!=typeof s||s.isTexture)return o&&(e?e.__useCount=e.__useCount?e.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),e;let a=s.constructor??Object;if(a===Object)return Ue.obj(e,s,i);if(!r&&"function"==typeof s.fromJSON)return s.isMaterial&&(Object.entries(e).forEach((([t,n])=>{if(!n||!n.resource||"string"!=typeof n.resource)return;const r=i[n.resource]?.[n.uuid];e[t]=r||null})),e.userData&&(e.userData=je(e.userData,void 0,!1,i))),s.fromJSON(e,i),s;for(;a&&a!==Object;)ke.get(a)?.forEach((([n,r])=>{const o=s[r],a=je(e[n],o,!1,i);a!==o&&(0,t.safeSetProperty)(s,r,a,!0)})),a=Object.getPrototypeOf(a);return s}const ze=new Map;function Ge(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},ze.set(e,t),t)}function Ve(e,t,n,r){if(t?.extras[e.uuid])return{uuid:e.uuid,resource:"extras"};let i="";if(e.source?._sourceImgBuffer||e.userData.__sourceBuffer){const t=new Uint8Array(e.source?._sourceImgBuffer||e.userData.__sourceBuffer),n=r||e.userData.mimeType||"";i={data:Array.from(t),type:t.constructor.name,path:e.userData.__sourceBlob?.name||e.userData.rootPath||"file."+n.split("/")[1]},n&&(i.mimeType=n)}else e.userData.rootPath?i=e.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const s={uuid:e.uuid,url:i,userData:De({},e.userData),type:e.type,name:n||e.name};return t?.extras?(t.extras[e.uuid]=s,{uuid:e.uuid,resource:"extras"}):s}var He=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Qe=class extends t.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const e=this._passes,n=[],r={};for(const t of e){if(!1===t.enabled)continue;const e={after:t.after??[],before:t.before??[],dependencies:new Set(t.required??[])};r[t.passId]=e}for(const[e,t]of Object.entries(r)){const n=new Set([...t.after,...t.before]);t.dependencies.forEach((e=>n.has(e)&&n.delete(e))),n.forEach((n=>{const i=r[n];if(i){if(i.dependencies.has(e))throw console.error("cyclic",e,n),"Cyclic dependency";t.dependencies.add(n)}}))}for(;;){let i=!1;const s=[...Object.entries(r)];for(const[o,a]of s)if(!n.includes(o)&&(0,t.includesAll)(n,a.dependencies.values())){const t=Math.max(-1,...a.after.map((e=>n.indexOf(e)))),s=Math.min(n.length,...a.before.map((e=>{const t=n.indexOf(e);return t<0?n.length:t})));if(t>=s)throw console.error(a,e,n,t,s),"Not possible";n.splice(a.after.length>0?t+1:s,0,o),i=!0,delete r[o]}if(Object.keys(r).length<1)break;if(!i)throw console.error(s,r,n),"Not possible 2"}return this.pipeline=n,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,t){const n=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=n,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:n,time:e,renderer:this,xrFrame:t}))}get clock(){return this._composer.clock}registerPass(e,t=!0){if(t)for(const t of[...this._passes])e.passId===t.passId&&this.unregisterPass(t);this._passes.push(e),e.onRegister?.(this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){const t=this._passes.indexOf(e);t>=0&&(e.onUnregister?.(this),this._passes.splice(t,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:e,canvas:t,alpha:r=!0,targetOptions:i}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new n.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new n.CP7({canvas:t,antialias:!1,alpha:r,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=e=>{this.dispatchEvent({type:"contextLost",event:e})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new n.FM8(t.clientWidth,t.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=n.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=n.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=n._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(i,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new p(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}setSize(e,t,n=!1){!n&&(e?Math.abs(e-this._renderSize.width):0)+(t?Math.abs(t-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),t&&(this._renderSize.height=t),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach((e=>{const t=e,n=t.sizeMultiplier;if(n){const e=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*n);t.setSize(Math.floor(e.width),Math.floor(e.height))}})),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,t,{viewport:r,material:i,shader:s,pass:o,clear:a=!0}={}){const l=this._composer.copyPass,{renderToScreen:c,material:u,uniforms:h,clear:p}=l;i&&(l.material=i);const d=this._renderer.getViewport(new n.Ltg),f=this._renderer.autoClear,m=this._renderer.getRenderTarget();r&&this._renderer.setViewport((new n.Ltg).fromArray(r)),this._renderer.autoClear=!1,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=a,Y(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},(()=>{l.render(this._renderer,t??null,{texture:e},0,!1)})),l.renderToScreen=c,l.clear=p,l.material=u,l.uniforms=h,this._renderer.autoClear=f,r&&this._renderer.setViewport(d),this._renderer.setRenderTarget(m)}clearColor({r:e,g:t,b:r,a:i,target:s,depth:o=!0,stencil:a=!0}){const l=this._renderer.getClearColor(new n.Ilk),c=this._renderer.getClearAlpha();this._renderer.setClearAlpha(i??c),this._renderer.setClearColor(new n.Ilk(e??l.r,t??l.g,r??l.b));const u=this._renderer.getRenderTarget(),h=this._renderer.getActiveCubeFace(),p=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(s??null),this._renderer.clear(!0,o,a),this._renderer.setRenderTarget(u,h,p),this._renderer.setClearColor(l),this._renderer.setClearAlpha(c)}renderModel(e,t){this._renderer.render(e.modelObject,t.cameraObject)}renderScene(e){const t=e.activeCamera;t&&this.renderModel(e,t)}_updated(){this.dispatchEvent({type:"update"})}render(){this._passesNeedsUpdate&&this.refreshPasses();for(const e of this._passes)e.passObject.enabled&&e.update?.();this._composer.render(),this._frameCount+=1,this._totalFrameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex((e=>e.dirty))>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const t of this._pipeline){const n=this._passes.find((e=>e.passId===t));n?e.push(n.passObject):console.warn("Unable to find pass: ",t)}[...this._composer.passes].forEach((e=>this._composer.removePass(e))),e.forEach((e=>this._composer.addPass(e))),this._updated()}dispose(){this._trackedTargets.forEach((e=>e.dispose())),this._trackedTargets=[],this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e,samples:t=0,colorSpace:r=n.aCh,type:i=n.ywz,format:s=n.wk1,depthBuffer:o=!0,depthTexture:a=!1,size:l,textureCount:c=1,...u}={},h=!0){this.isWebGL2||(t=0),void 0!==e&&void 0!==l&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(l=l||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1))).width=Math.floor(l.width),l.height=Math.floor(l.height);const p=a?new n.$YQ(l.width,l.height,n.ywz):void 0,d=this.createTargetCustom(c>1?{width:l.width,height:l.height,count:c}:l,{samples:t,colorSpace:r,type:i,format:s,depthBuffer:o,depthTexture:p},c>1?n.kFz:n.dd2);return this._processNewTarget(d,e,h),this._setTargetOptions(d,u),d}_processNewTarget(e,t,n){return void 0!==t&&(e.sizeMultiplier=t),n&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:t,count:r},i={},s){const o=this._processNewTarget,a=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let l=[e,t];if(r&&r>1&&l.push(r),s?.prototype===n.oAp.prototype){if(e!==t)throw"Width and height of cube render target must be equal";l=[e]}i={format:n.wk1,minFilter:n.wem,magFilter:n.wem,generateMipmaps:!1,type:n.ywz,colorSpace:n.aCh,...i};const c=[this,...l,i];return new class extends(s??n.dd2){constructor(e,...t){super(...t),this.renderer=e,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach((e=>{e.colorSpace=i.colorSpace,e.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})})):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(e){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=a(this.__target,"image/png",90);const t=this.__toJSON.call(this,e);return delete this.source.data.url,t.isRenderTargetTexture=!0,t})}setSize(e,t,n){super.setSize(Math.floor(e),Math.floor(t),n)}clone(e=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const t=super.clone();return t.texture.isRenderTargetTexture=!0,o(t,this.sizeMultiplier||1,e)}}(...c)}getTempTarget(e={}){const t=We(e);let n;return this._tempTargets[t]?.length&&(n=this._tempTargets[t].pop()),n?this._setTargetOptions(n,e):(n=this.createTarget(e),this._processNewTempTarget(n,t)),n}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,void 0===this._tempTargets[t]&&(this._tempTargets[t]=[]),e}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._tempTargets[t].length>this.maxTempPerKey?e.dispose():this._tempTargets[t].push(e)}updateShaderProperties(e){return this.stableNoise?e.uniforms.frameCount?e.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),e.uniforms.frameCount2&&(e.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(e,t){e.texture.minFilter=t.minFilter??n.wem,e.texture.magFilter=t.magFilter??n.wem,e.texture.generateMipmaps=t.generateMipmaps??!1,e.texture.generateMipmaps&&e.texture.minFilter===n.wem&&(e.texture.minFilter=n.FDw),e.texture.generateMipmaps||e.texture.minFilter!==n.FDw||(e.texture.minFilter=n.wem)}renderTargetToDataUrl(e,t="image/png",r=90){const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");if(!s)throw new Error("Unable to get 2d context");const o=s.createImageData(e.width,e.height,{colorSpace:["display-p3","srgb"].includes(e.texture.colorSpace)?e.texture.colorSpace:void 0});if(e.texture.type===n.cLu){const t=new Uint16Array(e.width*e.height*4);this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,t),Ie({data:t,width:e.width,height:e.height},e.texture.colorSpace,o)}else if(e.texture.type===n.VzW){const t=new Float32Array(e.width*e.height*4);this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,t),Ie({data:t,width:e.width,height:e.height},e.texture.colorSpace,o)}else this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,o.data);s.putImageData(o,0,0);const a=i.toDataURL(t,r);return i.remove(),a}renderTargetToBuffer(e){const t=e.texture.type===n.cLu?new Uint16Array(e.width*e.height*4):new Uint8Array(e.width*e.height*4);return this._renderer.readRenderTargetPixels(e,0,0,e.width,e.height,t),t}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(e){this.rendererObject.useLegacyLights=e,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(e){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=e}get renderScale(){return this.displayCanvasScaling}set renderScale(e){this.displayCanvasScaling=e}};function We(e={}){return[e.sizeMultiplier,e.samples,e.colorSpace,e.type,e.format,e.depthBuffer,e.depthTexture,e.size?.width,e.size?.height].join(";")}function qe(e){if(!e.isMaterial&&!e.isBufferGeometry)return;const t=Array.from(e.userData.__appliedMeshes).filter((e=>!e.isInstancedMesh&&!!e.parent&&0===e.children.length&&!Array.isArray(e.material)));if(t.length<2)return;const r=new Map;for(const e of t){const t=(i=e).parent.uuid+"_"+i.geometry.uuid+"_"+i.material?.uuid;r.has(t)||r.set(t,[]),r.get(t).push(e),e.updateMatrix()}var i;const s=r.keys();for(const e of s){const t=r.get(e),i=t[0];if(!i)continue;if(t.length<2)continue;const s=new n.SPe(i.geometry,i.material,t.length),o=i.userData;i.userData={},s.copy(i),tt(s.userData,o);const a=i.parent;s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),s.updateMatrix();const l=new Float32Array(3*s.count),c=new Float32Array(4*s.count),u=new Float32Array(3*s.count);for(let e=0;e<t.length;e++){const n=t[e],r=n.matrix;r.determinant()<0&&(r.elements[0]*=-1,r.elements[1]*=-1,r.elements[2]*=-1),s.setMatrixAt(e,r),n.position.toArray(l,3*e),n.quaternion.toArray(c,4*e),n.scale.toArray(u,3*e),n.removeFromParent(),n.material?.userData?.__appliedMeshes?.delete(n),n.geometry?.userData?.__appliedMeshes?.delete(n)}s.material.userData?.__appliedMeshes?.add(s),s.geometry.userData.__appliedMeshes.add(s),s.sourceTrs={TRANSLATION:new n.TlE(l,3),ROTATION:new n.TlE(c,4),SCALE:new n.TlE(u,3)},s.instanceMatrix.needsUpdate=!0,a.add(s),a.setDirty()}}He([Oe()],Qe.prototype,"stableNoise",void 0),He([Oe()],Qe.prototype,"useLegacyLights",null),Qe=He([Ge("RenderManager")],Qe);class Xe{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const r=this.writer,i=e;let s=i.sourceTrs;if(!s){const e=new Float32Array(3*i.count),t=new Float32Array(4*i.count),r=new Float32Array(3*i.count),o=new n.yGw,a=new n.Pa4,l=new n._fP,c=new n.Pa4;for(let n=0;n<i.count;n++)i.getMatrixAt(n,o),o.decompose(a,l,c),a.toArray(e,3*n),l.toArray(t,4*n),c.toArray(r,3*n);s={TRANSLATION:new n.TlE(e,3),ROTATION:new n.TlE(t,4),SCALE:new n.TlE(r,3)}}s={TRANSLATION:r.processAccessor(s.TRANSLATION),ROTATION:r.processAccessor(s.ROTATION),SCALE:r.processAccessor(s.SCALE)},i.instanceColor&&(s.COLOR=r.processAccessor(new n.TlE(i.instanceColor.array,3))),r.extensionsUsed[this.name]=!0,r.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:s}}}function Ye(e,t){if(e.uiConfig)return e.uiConfig;const r={type:"folder",label:()=>e.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[e,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{e.dispatchEvent({type:"select",ui:!0,value:e,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!e.parent,value:()=>{const t=e.parent;t&&t.dispatchEvent({type:"select",ui:!0,value:t})}},{type:"input",label:"Name",property:[e,"name"],onChange:t=>{t.last&&e.setDirty?.({sceneUpdate:!0,refreshUi:!0})}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!e.isMesh,property:[e,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!e.isMesh,property:[e,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[e,"frustumCulled"]},{type:"vec3",label:"Position",property:[e,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[e,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[e,"scale"]},{type:"input",label:"Render Order",property:[e,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",e.userData.autoScaleRadius||"2",!0],value:t=>{if(!t)return;const n=parseFloat(t);Math.abs(n)>0&&J(e,n)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&K(e)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map((t=>({type:"button",label:"Rotate "+t+"90",value:()=>{e.rotateOnAxis(new n.Pa4(t.includes("X")?1:0,t.includes("Y")?1:0,t.includes("Z")?1:0),Math.PI/2*(t.includes("-")?-1:1)),e.setDirty?.({sceneUpdate:!0,refreshUi:!1})}})))},void 0!==e.userData.license?{type:"input",label:"License/Credits",property:[e.userData,"license"],limitedUi:!0}:{}]},i=e;if(i?.isMesh&&!1!==t){const t=[()=>{const t=Object.entries(i.morphTargetDictionary||{});return t.length?{label:"Morph Targets",type:"folder",children:t.map((([t,n])=>({type:"slider",label:t,bounds:[0,1],stepSize:1e-4,property:[i.morphTargetInfluences,n],onChange:t=>{e.setDirty?.({sceneUpdate:t.last,frameFade:!1,refreshUi:!1})}})))}:void 0},()=>i.geometry?.uiConfig,()=>Array.isArray(i.material)?i.material.length<1?void 0:{label:"Materials",type:"folder",children:i.material.map((e=>e?.uiConfig)).filter((e=>e))}:i.material?.uiConfig];r.children.push(...t)}const s=e;if(s?.isCamera){const t=[{type:"button",label:"Set View",value:()=>{e.dispatchEvent({type:"setView",ui:!0,camera:e}),r.uiRefresh?.("postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>e.userData.iCamera?.isActiveCamera,value:()=>{e.dispatchEvent({type:"activateMain",ui:!0,camera:e}),r.uiRefresh?.("postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>!e.userData.iCamera?.isActiveCamera,value:()=>{e.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),r.uiRefresh?.("postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>e.userData.autoLookAtTarget??!1,setValue:t=>{e.userData.autoLookAtTarget=t,r.uiRefresh?.("postFrame",!0)}}];r.children.push(...t)}return e.uiConfig=r,r}function Ke(e,t,n){if(!e)return void console.warn("setupIModel: object is undefined");if(e.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",e),delete e.__disposed),e.userData||(e.userData={}),e.userData.__iModelSetup&&e.modelObject)return e;e.userData.__iModelSetup=!0;let r=[];r.push((()=>{[...e.children].forEach((t=>{t?.dispose?.(),e.add(t)})),e.parent&&e.removeFromParent()})),e.isLight&&!e.assetType?(e.assetType="light",e.lightObject=e):e.isCamera?(e.assetType="camera",e.cameraObject=e):e.assetType||(e.assetType="model"),e.modelObject||(e.modelObject=e),e.setDirty||(e.setDirty=(t={})=>{e.dispatchEvent({...t,type:"objectUpdate",object:e})},e.userData.setDirty&&console.warn("userData.setDirty already defined",e.userData.setDirty,e),e.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated, use setDirty directly"),e.setDirty?.(t)}),e.addEventListener("added",(t=>{const n=e.parent?.userData.parentRoot??e.parent;n!==e.userData.parentRoot&&e.traverse((e=>{e.userData.parentRoot=n})),e.setDirty?.({change:"addedToParent"})})),e.addEventListener("removed",(()=>{e.setDirty?.({change:"removedFromParent"}),void 0!==e.userData.parentRoot&&e.traverse((e=>{e.userData.parentRoot=void 0}))})),r.push((()=>{}));const i=e.dispose;e.dispose=()=>{e.dispatchEvent({type:"dispose"}),i?.call(e)},e.userData.dispose&&console.warn("userData.dispose already defined"),e.userData.dispose=()=>{console.warn("userData.dispose is deprecated, use dispose directly"),e.dispose?.()};const s=e;!s.isMesh&&!s.isLine||s.userData.__meshSetup||(s.userData.__meshSetup=!0,s.setMaterial||(s.setMaterial=e=>Je(s,e)),s.setGeometry||(s.setGeometry=(e,t=!1)=>Ze(s,e,t),s.setGeometry(s.geometry,!0)),e.userData.setMaterial&&console.warn("userData.setMaterial already defined"),e.userData.setMaterial=t=>{console.warn("userData.setMaterial is deprecated, use setMaterial directly"),e.setMaterial?.(t)},e.userData.setGeometry&&console.warn("userData.setGeometry already defined"),e.userData.setGeometry=(t,...n)=>{console.warn("userData.setGeometry is deprecated, use setGeometry directly"),e.setGeometry?.(t,...n)},e.userData.__keepShadowDef||(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0),r.push((()=>{const e=s.setMaterial?.(void 0)||[],t=s.setGeometry?.(void 0);for(const t of e)t&&t.userData&&0===t.userData.__appliedMeshes?.size&&!1!==t.userData.disposeOnIdle&&t.dispose();t&&t.userData&&0===t.userData.__appliedMeshes?.size&&!1!==t.userData.disposeOnIdle&&t.dispose(),s.setMaterial?.(e),s.setGeometry?.(t)}))),e.uiConfig||"model"!==e.assetType&&"camera"!==e.assetType||(Ye(e),r.push((()=>{}))),e.addEventListener("objectUpdate",(({refreshUi:t})=>!1!==t&&e.uiConfig?.uiRefresh?.("postFrame",!0,1))),e.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(e.userData.__autoParentDispatchEvents=e.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],e.isCamera&&e.userData.__autoParentDispatchEvents.push("activateMain","setView")),t&&(e.userData.parentRoot=t);const o=e.dispatchEvent;e.dispatchEvent=t=>{e.userData.__autoParentDispatchEvents?.includes(t.type)&&(t.parentDispatch=!0),t.parentDispatch&&(t=>{const n=e.userData.parentRoot??e.parent;n?.modelObject&&n.dispatchEvent(t)})(t),o.call(e,t)};const a=e.clone;e.clone=(...t)=>{const r=e.userData;e.userData={};let i=a.call(e,...t);e.userData=r,tt(i.userData,r);const s=e.userData.parentRoot;return s&&"model"!==s.assetType&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),i=Ke(i,s,n),i.userData.cloneParent=e.uuid,i};const l=e.copy;e.copy=(t,...n)=>{const r=t.userData;t.userData={};const i=l.call(e,t,...n);return t.userData=r,tt(e.userData,t),i};const c=e.add;return e.add=(...t)=>(t.forEach((t=>Ke(t,e.userData.parentRoot||e,n))),c.call(e,...t)),(e=n?.(e)??e).addEventListener("dispose",(()=>{r.forEach((e=>e())),r=[]})),[...e.children].forEach((t=>Ke(t,e,n))),e}function Je(e,t){const n=(Array.isArray(t)?t:[t]).map((e=>e?.materialObject)).filter((e=>e));if(e.material==n||1===n.length&&e.material===n[0])return[];e.userData.__materialUpdater||(e.userData.__materialUpdater=()=>{e.dispatchEvent({type:"materialUpdate"})}),e.userData.__textureUpdater||(e.userData.__textureUpdater=()=>{e.dispatchEvent({type:"textureUpdate"})});const r=Array.isArray(e.material)?[...e.material]:[e.material];for(const t of r)t&&(t.removeEventListener("materialUpdate",e.userData.__materialUpdater),t.removeEventListener("textureUpdate",e.userData.__textureUpdater),t.userData?.__appliedMeshes?.delete(e));const i=[];for(const t of n)t.userData.__appliedMeshes||(t.userData.__appliedMeshes=new Set),i.push(t),t&&(t.addEventListener("materialUpdate",e.userData.__materialUpdater),t.addEventListener("textureUpdate",e.userData.__textureUpdater),t.userData.__appliedMeshes.add(e));return e.material=1!==i.length?i:i[0]??void 0,e.dispatchEvent({type:"materialChanged",material:t,mesh:e}),e.uiConfig?.uiRefresh?.("postFrame",!0),r}function Ze(e,t,r=!1){e.userData.__objectUpdater||(e.userData.__objectUpdater=t=>{e.dispatchEvent({...t,type:"objectUpdate"})});let i=e.geometry;const s=i;return(i!==t||r)&&(i&&(i.removeEventListener("geometryUpdate",e.userData.__objectUpdater),i.userData?.__appliedMeshes?.delete(e)),i=t,i&&!i.userData.__appliedMeshes&&(i.userData.__appliedMeshes=new Set),e.geometry=i??void 0,i&&(e.updateMorphTargets(),i.addEventListener("geometryUpdate",e.userData.__objectUpdater),i.userData?.__appliedMeshes?.add(e))),t&&!t.uiConfig&&(t.uiConfig=function(e){return{label:"Geometry",type:"folder",children:[{type:"input",property:[e,"uuid"],disabled:!0},{type:"input",property:[e,"name"]},{type:"button",label:"Center Geometry",value:()=>{e.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const t=new n.Pa4;e.center(t),e.userData.__appliedMeshes.forEach((e=>{e.position.sub(t),e.setDirty&&e.setDirty()}))}},{type:"button",label:"Compute vertex normals",value:()=>{e.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{e.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{e.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!e.index,value:()=>{if(e.attributes.index)return;const t=parseFloat(prompt("Tolerance","-1")??"-1");Z(e,t)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!e.index,value:()=>{e.attributes.index&&e.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{e.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||e.setAttribute("uv1",e.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!e.hasAttribute("color"),value:()=>{e.hasAttribute("color")?confirm("Remove color attribute?")&&e.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!e.userData.__appliedMeshes||e.userData.__appliedMeshes.size<2,value:()=>{qe(e)}},{type:"input",label:"Mesh count",get value(){return e.userData?.__appliedMeshes?.size??0},set value(e){},disabled:!0}]}}(e.geometry)),e.dispatchEvent({type:"geometryChanged",geometry:t}),e.uiConfig?.uiRefresh?.("postFrame",!0),s===i?void 0:s||void 0}const $e=["appliedMeshes"],et=["parentRoot","iCamera","iModel"];function tt(e,t){if(t)for(const n of Object.keys(t))et.includes(n)||n.startsWith("__")||"function"!=typeof e[n]&&"function"!=typeof t[n]&&(e[n]=t[n]);return e}var nt,rt=new Uint8Array(16);function it(){if(!nt&&!(nt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return nt(rt)}for(var st=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,ot=[],at=0;at<256;++at)ot.push((at+256).toString(16).substr(1));var lt=function(e,t,n){var r=(e=e||{}).random||(e.rng||it)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(ot[e[t+0]]+ot[e[t+1]]+ot[e[t+2]]+ot[e[t+3]]+"-"+ot[e[t+4]]+ot[e[t+5]]+"-"+ot[e[t+6]]+ot[e[t+7]]+"-"+ot[e[t+8]]+ot[e[t+9]]+"-"+ot[e[t+10]]+ot[e[t+11]]+ot[e[t+12]]+ot[e[t+13]]+ot[e[t+14]]+ot[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&st.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}(r)};const ct=new Map;function ut(e,t){return(n,r)=>{const i=n.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");ct.has(i)||ct.set(i,[]);const s=ct.get(i);if(!(s.findIndex((e=>e.propKey===r))<0))throw new Error(`Property ${r} already has a uiConfig decorator`);s.push({params:t||{},propKey:r,uiType:e})}}function ht(e,t){return ut("checkbox",{label:e,params:t})}function pt(e,t){return ut("monitor",{label:e,params:t})}function dt(e,t,n,r){return ut("slider",{label:e,bounds:t,stepSize:n,params:r})}function ft(e,t,n,r){return ut("vec",{label:e,bounds:t,stepSize:n,params:r})}function mt(e,t,n){return ut("dropdown",{label:e,children:t,params:n})}function gt(e,t){return ut("button",{label:e,params:t})}function _t(e,t){return ut("input",{label:e,params:t})}function vt(e,t){return ut("color",{label:e,params:t})}function yt(e,t){return ut("image",{label:e,params:t})}function bt(e){let t=e?.constructor;if(!e||!t)return[];const n=[],r=[];for(;t&&t!==Object;)r.push(t),t=Object.getPrototypeOf(t);if(!r.length){const t="object"==typeof e?Object.keys(e):Array.isArray(e)?e.map(((e,t)=>t)):[];for(const r of t){const t=e[r];if(null==t)continue;const i=t?.uiConfig;if(i)n.push(i);else{const i=Et(t);"folder"===i?n.push(At(r+"",t)):i&&n.push({type:i,label:r+"",property:[e,r]})}}}return r.reverse().forEach((t=>{ct.get(t)?.forEach((({params:t,propKey:r,uiType:i})=>{let s;if(!i){const t=e[r];s=t?.uiConfig,s?n.push(s):null!=t&&("folder"===(i=Et(t))?s=At(r+"",t):i&&(s={type:i,label:r+"",property:[e,r]}))}if(s||(s={property:[e,r],type:i||"input"}),t){const n="function"==typeof t.params?t.params(e):t.params||{};delete t.params,Object.assign(s,{...t,...n})}n.push(s)}))})),n}function At(e,t,n={},r="folder"){return{type:r,label:e,children:bt(t),uuid:lt(),...n}}function wt(e,t,n="folder"){return r=>class extends r{constructor(){super(...arguments),this.uiConfig=At(e,this,t||{},n)}}}function xt(e,t){return wt(e,t,"panel")}function Et(e){return null==e?null:Array.isArray(e)?"folder":"boolean"==typeof e?"checkbox":"number"==typeof e?"number":"string"==typeof e?"input":"function"==typeof e?"button":"number"==typeof e.x?"vec":"number"==typeof e.r?"color":e.isTexture?"image":"object"==typeof e?"folder":null}const Ct={type:"change"},St={type:"start"},Mt={type:"end"};class Tt extends n.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new n.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new n.Pa4(1/0,1/0,1/0),this.clampMin=new n.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.RsA.ROTATE,MIDDLE:n.RsA.DOLLY,RIGHT:n.RsA.PAN},this.touches={ONE:n.QmN.ROTATE,TWO:n.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",V),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",V),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(Ct),r.update(),s=i.NONE},this.update=function(){const t=new n.Pa4,p=(new n._fP).setFromUnitVectors(e.up,new n.Pa4(0,1,0)),d=p.clone().invert(),f=new n.Pa4,m=new n._fP,g=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const e=r.object.position;t.copy(e).sub(r.target),t.applyQuaternion(p),a.setFromVector3(t),r.autoRotate&&s===i.NONE&&E(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(a.theta+=l.theta*r.dampingFactor,a.phi+=l.phi*r.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let n=r.minAzimuthAngle,_=r.maxAzimuthAngle;isFinite(n)&&isFinite(_)&&(n<-Math.PI?n+=g:n>Math.PI&&(n-=g),_<-Math.PI?_+=g:_>Math.PI&&(_-=g),a.theta=n<=_?Math.max(n,Math.min(_,a.theta)):a.theta>(n+_)/2?Math.max(n,a.theta):Math.min(_,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),Math.abs(l.radius)>0&&(r.dollyZoom&&(r.object.zoom=Math.max(Math.max(r.minZoom,.1),Math.min(Math.min(r.maxZoom,20),r.object.zoom*(1+l.radius*(r.enableDamping?r.dampingFactor:1)))),r.object.updateProjectionMatrix(),(r.object.zoom>=Math.min(r.maxZoom,20)||r.object.zoom<=Math.max(r.minZoom,.1))&&(l.radius=0)),a.radius*=1+l.radius*(r.enableDamping?r.dampingFactor:1)),Math.abs(c-1)>1e-5&&(r.dollyZoom&&(r.object.zoom=Math.max(Math.max(r.minZoom,.1),Math.min(Math.min(r.maxZoom,20),r.object.zoom*c)),r.object.updateProjectionMatrix(),(r.object.zoom>=Math.min(r.maxZoom,20)||r.object.zoom<=Math.max(r.minZoom,.1))&&(c=1)),a.radius*=c);let v=0;r.autoPushTarget&&a.radius<r.minDistance&&(v=r.minDistance-a.radius),r.autoPullTarget&&a.radius>r.maxDistance&&(v=r.maxDistance-a.radius),a.radius=Math.max(r.minDistance,Math.min(r.maxDistance,a.radius)),!0===r.enableDamping?r.target.addScaledVector(u,r.dampingFactor):r.target.add(u),t.setFromSpherical(a),t.applyQuaternion(d),e.copy(r.target).add(t),r.target.add(t.normalize().multiplyScalar(-v)),e.clamp(r.clampMin,r.clampMax),r.target.clamp(r.clampMin,r.clampMax),r.object.lookAt(r.target);let y=!1;return!0===r.enableDamping&&Math.abs(l.theta)+Math.abs(l.phi)+Math.abs(l.radius)+u.length()>.001?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,l.radius*=1-r.dampingFactor,u.multiplyScalar(1-r.dampingFactor),y=!0):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(h||y||f.distanceToSquared(r.object.position)>o||8*(1-m.dot(r.object.quaternion))>o)&&(r.dispatchEvent(Ct),f.copy(r.object.position),m.copy(r.object.quaternion),h=!1,!0)}}(),this.stopDamping=function(){l.set(0,0,0),u.set(0,0,0)},this.dispose=function(){r.domElement.removeEventListener("contextmenu",H),r.domElement.removeEventListener("pointerdown",N),r.domElement.removeEventListener("pointercancel",z),r.domElement.removeEventListener("wheel",G),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",z),null!==r._domElementKeyEvents&&(r._domElementKeyEvents.removeEventListener("keydown",V),r._domElementKeyEvents=null)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const o=1e-6,a=new n.$V,l=new n.$V(0,0,0);let c=1;const u=new n.Pa4;let h=!1;const p=new n.FM8,d=new n.FM8,f=new n.FM8,m=new n.FM8,g=new n.FM8,_=new n.FM8,v=new n.FM8,y=new n.FM8,b=new n.FM8,A=[],w={};function x(){return r.enableDamping?1:Math.pow(.95,r.zoomSpeed)}function E(e){l.theta-=e}function C(e){l.phi-=e}this.rotateUp=C,this.rotateLeft=E;const S=function(){const e=new n.Pa4;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),M=function(){const e=new n.Pa4;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),T=function(){const e=new n.Pa4;return function(t,n){const i=r.domElement;if(r.object.isPerspectiveCamera){const s=r.object.position;e.copy(s).sub(r.target);let o=e.length();o*=Math.tan(r.object.fov/2*Math.PI/180),S(2*t*o/i.clientHeight,r.object.matrix),M(2*n*o/i.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(S(t*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),M(n*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function D(e,t=0){r.object.isPerspectiveCamera?(c/=e,l.radius=Math.max(-r.maxZoomSpeed,Math.min(r.maxZoomSpeed,l.radius-t))):r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function I(e,t=0){r.object.isPerspectiveCamera?(c*=e,l.radius=Math.max(-r.maxZoomSpeed,Math.min(r.maxZoomSpeed,l.radius+t))):r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function P(e){p.set(e.clientX,e.clientY)}function R(e){m.set(e.clientX,e.clientY)}function B(){if(1===A.length)p.set(A[0].pageX,A[0].pageY);else{const e=.5*(A[0].pageX+A[1].pageX),t=.5*(A[0].pageY+A[1].pageY);p.set(e,t)}}function k(){if(1===A.length)m.set(A[0].pageX,A[0].pageY);else{const e=.5*(A[0].pageX+A[1].pageX),t=.5*(A[0].pageY+A[1].pageY);m.set(e,t)}}function O(){const e=A[0].pageX-A[1].pageX,t=A[0].pageY-A[1].pageY,n=Math.sqrt(e*e+t*t);v.set(0,n)}function L(e){if(1==A.length)d.set(e.pageX,e.pageY);else{const t=W(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);d.set(n,r)}f.subVectors(d,p).multiplyScalar(r.rotateSpeed);const t=r.domElement;E(2*Math.PI*f.x/t.clientHeight),C(2*Math.PI*f.y/t.clientHeight),p.copy(d)}function F(e){if(1===A.length)g.set(e.pageX,e.pageY);else{const t=W(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(n,r)}_.subVectors(g,m).multiplyScalar(r.panSpeed),T(_.x,_.y),m.copy(g)}function U(e){const t=W(e),n=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(n*n+i*i);y.set(0,s),b.set(0,Math.pow(y.y/v.y,6*r.zoomSpeed)),D(b.y),v.copy(y)}function N(e){!1!==r.enabled&&(0===A.length&&(r.domElement.setPointerCapture(e.pointerId),r.domElement.addEventListener("pointermove",j),r.domElement.addEventListener("pointerup",z)),function(e){A.push(e)}(e),"touch"===e.pointerType?function(e){switch(Q(e),A.length){case 1:switch(r.touches.ONE){case n.QmN.ROTATE:if(!1===r.enableRotate)return;B(),s=i.TOUCH_ROTATE;break;case n.QmN.PAN:if(!1===r.enablePan)return;k(),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(r.touches.TWO){case n.QmN.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&O(),r.enablePan&&k(),s=i.TOUCH_DOLLY_PAN;break;case n.QmN.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&O(),r.enableRotate&&B(),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(St)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.RsA.DOLLY:if(!1===r.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),s=i.DOLLY;break;case n.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;R(e),s=i.PAN}else{if(!1===r.enableRotate)return;P(e),s=i.ROTATE}break;case n.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;P(e),s=i.ROTATE}else{if(!1===r.enablePan)return;R(e),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(St)}(e))}function j(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(Q(e),s){case i.TOUCH_ROTATE:if(!1===r.enableRotate)return;L(e),r.update();break;case i.TOUCH_PAN:if(!1===r.enablePan)return;F(e),r.update();break;case i.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&U(e),r.enablePan&&F(e)}(e),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&U(e),r.enableRotate&&L(e)}(e),r.update();break;default:s=i.NONE}}(e):function(e){switch(s){case i.ROTATE:if(!1===r.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),f.subVectors(d,p).multiplyScalar(r.rotateSpeed);const t=r.domElement;E(2*Math.PI*f.x/t.clientHeight),C(2*Math.PI*f.y/t.clientHeight),p.copy(d),r.update()}(e);break;case i.DOLLY:if(!1===r.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,v),b.y>0?D(x()):b.y<0&&I(x()),v.copy(y),r.update()}(e);break;case i.PAN:if(!1===r.enablePan)return;!function(e){g.set(e.clientX,e.clientY),_.subVectors(g,m).multiplyScalar(r.panSpeed),T(_.x,_.y),m.copy(g),r.update()}(e)}}(e))}function z(e){!function(e){delete w[e.pointerId];for(let t=0;t<A.length;t++)if(A[t].pointerId==e.pointerId)return void A.splice(t,1)}(e),0===A.length&&(r.domElement.releasePointerCapture(e.pointerId),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",z)),r.dispatchEvent(Mt),s=i.NONE}function G(e){!1!==r.enabled&&!1!==r.enableZoom&&s===i.NONE&&(e.preventDefault(),r.dispatchEvent(St),function(e){let t=0;switch(e.deltaMode){case 2:t+=1*e.deltaY;break;case 1:t+=.4*e.deltaY;break;default:t+=.01*e.deltaY}e.deltaY<0?I(1,t*r.zoomSpeed):e.deltaY>0&&D(1,-t*r.zoomSpeed),r.update()}(e),r.dispatchEvent(Mt))}function V(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?C(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):T(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?C(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):T(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?E(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):T(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?E(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):T(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function H(e){!1!==r.enabled&&e.preventDefault()}function Q(e){let t=w[e.pointerId];void 0===t&&(t=new n.FM8,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function W(e){const t=e.pointerId===A[0].pointerId?A[1]:A[0];return w[t.pointerId]}this.zoomIn=function(e){D(1,e*r.zoomSpeed)},this.zoomOut=function(e){I(1,e*r.zoomSpeed)},r.domElement.addEventListener("contextmenu",H),r.domElement.addEventListener("pointerdown",N),r.domElement.addEventListener("pointercancel",z),r.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}var Dt=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let It=class extends Tt{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new n.Pa4(-1e4,-1e4,-1e4),this.clampMax=new n.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(e){super.zoomIn(e)}zoomOut(e){super.zoomOut(e)}dispatchEvent(e){super.dispatchEvent(e)}};Dt([Oe()],It.prototype,"type",void 0),Dt([ht()],It.prototype,"enabled",void 0),Dt([ht(),Oe()],It.prototype,"dollyZoom",void 0),Dt([ht(),Oe()],It.prototype,"enableDamping",void 0),Dt([_t(),Oe()],It.prototype,"dampingFactor",void 0),Dt([ht(),Oe()],It.prototype,"autoRotate",void 0),Dt([_t(),Oe()],It.prototype,"autoRotateSpeed",void 0),Dt([ht(),Oe()],It.prototype,"enableZoom",void 0),Dt([_t(),Oe()],It.prototype,"zoomSpeed",void 0),Dt([_t(),Oe()],It.prototype,"maxZoomSpeed",void 0),Dt([ht(),Oe()],It.prototype,"enableRotate",void 0),Dt([_t(),Oe()],It.prototype,"rotateSpeed",void 0),Dt([ht(),Oe()],It.prototype,"enablePan",void 0),Dt([_t(),Oe()],It.prototype,"panSpeed",void 0),Dt([_t(),Oe()],It.prototype,"autoPushTarget",void 0),Dt([_t(),Oe()],It.prototype,"autoPullTarget",void 0),Dt([_t(),Oe()],It.prototype,"minDistance",void 0),Dt([_t(),Oe()],It.prototype,"maxDistance",void 0),Dt([_t(),Oe()],It.prototype,"minZoom",void 0),Dt([_t(),Oe()],It.prototype,"maxZoom",void 0),Dt([_t(),Oe()],It.prototype,"minPolarAngle",void 0),Dt([_t(),Oe()],It.prototype,"maxPolarAngle",void 0),Dt([_t(),Oe()],It.prototype,"minAzimuthAngle",void 0),Dt([_t(),Oe()],It.prototype,"maxAzimuthAngle",void 0),Dt([ft(),Oe()],It.prototype,"clampMin",void 0),Dt([ft(),Oe()],It.prototype,"clampMax",void 0),Dt([Oe()],It.prototype,"screenSpacePanning",void 0),Dt([Oe()],It.prototype,"keyPanSpeed",void 0),It=Dt([xt("Orbit Controls")],It);var Pt=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Rt extends t.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){const n={...e};n.position?.isVector3&&(n.position=[n.position.x,n.position.y,n.position.z]),n.target?.isVector3&&(n.target=[n.target.x,n.target.y,n.target.z]),Object.keys(n).forEach((e=>"frustumSize"!==e&&void 0===n[e]&&delete n[e])),Object.assign(this._options,n),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const e="PerspectiveCamera"===this._options.type?new n.cPb:new n.iKG;e.name=this._camera.name,e.near=this._camera.modelObject.near,e.far=this._camera.modelObject.far,e.zoom=this._camera.modelObject.zoom,e.scale.copy(this._camera.modelObject.scale);const r=this._isActiveCamera;r&&this.deactivateMain(),this._camera=this._setCameraObject(e),t=this._camera.modelObject,r&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let r=this._options.aspect;if("auto"===r&&(r=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),"PerspectiveCamera"===this._options.type&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=r),"OrthographicCamera"===this._options.type){const e=this._options.frustumSize;void 0!==e?(t.top=e/2,t.bottom=-e/2,t.left=r*e/2,t.right=-r*e/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Ke(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&""!==this._options.controlsMode}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,r){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=e=>{this.setDirty(e)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new n.Pa4(0,0,10),this._target=new n.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(e,t)=>{const n=new It(e,t.ownerDocument?t:t.documentElement);return n.screenSpacePanning=!0,n}]]),this._positionWorld=new n.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:e=>this._camera.userData.autoNearFar=e,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.5,setValue:e=>this._camera.userData.minNearPlane=e,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:e=>this._camera.userData.maxFarPlane=e,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map((e=>({label:""===e?"none":e,value:e}))),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>this._controls?.zoomIn?{type:"button",label:"Zoom in",value:()=>{this._controls?.zoomIn(1)}}:{},()=>this._controls?.zoomOut?{type:"button",label:"Zoom out",value:()=>{this._controls?.zoomOut(1)}}:{},()=>this._controls?.uiConfig]},this.assetType="model",this.uuid=f(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=r??document.body;const i={...t}??this._options;this._camera=this._setCameraObject(e??("OrthographicCamera"===i.type?new n.iKG(-1,1,1,-1):new n.cPb)),this._camera.modelObject.userData.iCamera=this;const s=e;e&&(s.isPerspectiveCamera?(i.fov=s.fov,i.focus=s.focus,i.aspect=s.aspect<=0||s.userData.autoAspect?"auto":s.aspect,i.zoom=s.zoom):s.isOrthographicCamera&&(i.left=s.left,i.right=s.right,i.top=s.top,i.bottom=s.bottom,i.zoom=s.zoom),i.near=s.near,i.far=s.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(i)}refreshAspect(e=!0){"auto"===this._options.aspect&&this._refreshCameraOptions(e)}refreshTarget(e=4){this._controls?.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new n.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){const e=this._options.controlsMode;this._controls=this._controlsCtors.get(e)?.(this._camera.modelObject,this._container)??void 0,this._controls||""===e||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),this._controls?.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){this._controlsMode,this._controls?.removeEventListener("change",this.setDirty),this._controls?.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){if(this._options.controlsEnabled){const e=this._options.controlsMode;this._controls?this._controlsMode===e&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=e}if(this._controls){const e=this.interactionsEnabled;this._controls.enabled=e,e&&this._camera.modelObject.up.copy(n.Tme.DEFAULT_UP)}e&&this.setDirty(),this.uiConfig.uiRefresh?.("postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),void 0!==this._camera.modelObject.fov&&(this._options.fov=this._camera.modelObject.fov),void 0!==this._camera.modelObject.focus&&(this._options.focus=this._camera.modelObject.focus),void 0!==this._camera.modelObject.zoom&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach((e=>e?.uiRefresh?.("postFrame",!1,1)))}activateMain(e=!0){this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new n.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),this._camera.setDirty?.({change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){const t=this.target;this._controls?.target?.set(t.x,t.y,t.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(void 0!==this._camera.userData.autoLookAtTarget&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(t),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){return e.uniforms.cameraPositionWorld?.value?.copy(this._positionWorld),e.uniforms.cameraNearFar?.value?.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA="PerspectiveCamera"===this._camera.modelObject.type?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA="OrthographicCamera"===this._camera.modelObject.type?"1":"0",this}toJSON(e){return Object.assign({},Ne(this,!0,e))}fromJSON(e,t){return je(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Pt([Oe("camControls")],Rt.prototype,"_controls",void 0),Pt([Oe()],Rt.prototype,"userData",void 0),Pt([(0,t.onChange)(Rt.prototype._nearFarChanged)],Rt.prototype,"near",void 0),Pt([(0,t.onChange)(Rt.prototype._nearFarChanged)],Rt.prototype,"far",void 0),Pt([Oe("camOptions")],Rt.prototype,"_options",void 0),Pt([Oe("position")],Rt.prototype,"_position",void 0),Pt([Oe("target")],Rt.prototype,"_target",void 0);var Bt=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class kt extends n.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let t=this._cameras.indexOf(e);t<0&&(this._cameras.push(e),t=this._cameras.length-1),this._activeCamera=t}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new v,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new Rt(new n.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Ke(new n.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new n.GQ(this.getBounds())}addModel(e,t={}){return"model"!==e.assetType&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){"widget"!==e.assetType&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e?.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let r=!1;switch(n){case"model":r=e.modelObject.isCamera,r&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:r=!1}={}){const i=e;i?(t&&!i.userData.autoScaled&&J(i,i.userData.autoScaleRadius||n),i.traverse((e=>{e.isMesh&&!e.userData.__keepShadowDef&&(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0)})),r?this.modelObject.add(i):this.modelRoot.add(i),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach((e=>{(e.dispose??e.modelObject?.removeFromParent)()})),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.environment?.mapping===n.xfE&&(this.environment.mapping=n.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map((e=>Ke(e)))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);"texture"!==e.assetType&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||"texture"===e.assetType||e.isTexture||e.isColor||"environment"===e)t=("texture"===e?.assetType||e.isTexture)&&e.textureObject||e;else{if("string"!=typeof e&&"number"!=typeof e)return void console.error("Unknown Background type",e);t=new n.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new n.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e?.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){return!1===e.sceneUpdate?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),this.boxHelper?.box?.copy?.(this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new n.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.disposeSceneModels(),this.clear(),this.environment?.dispose()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse((t=>{t.name===e&&n.push(t)})),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){const n=e.lightObject;n&&(n.children,t?this.add(n):this.modelRoot.add(n))}getBounds(e=!1,t=!0){return(new v).expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(!1===e.cameraObject.userData.autoNearFar)return e.near=e.cameraObject.userData.minNearPlane??.5,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const t=this.getBounds(!1),r=e.cameraObject.getWorldPosition(new n.Pa4).sub(t.getCenter(new n.Pa4)),i=1.5*t.getSize(new n.Pa4).length()/2,s=Math.max(.1,-r.clone().normalize().dot(e.cameraObject.getWorldDirection(new n.Pa4))),o=r.length(),a=Math.max(e.cameraObject.userData.minNearPlane??.5,s*(o-i)),l=Math.min(Math.max(a+i,s*(o+i)),e.cameraObject.userData.maxFarPlane??1e3);e.near=a,e.far=l}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return Ne(this,!0,e)}fromJSON(e,t){const n=e.environment;return void 0!==n&&(this.setEnvironment(je(n,this.getEnvironment(),!1,t)),delete e.environment),je(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}Bt([Oe()],kt.prototype,"defaultCamera",void 0),Bt([(0,t.onChange2)(kt.prototype.setDirty),Oe()],kt.prototype,"envMapIntensity",void 0),Bt([(0,t.onChange2)(kt.prototype.setDirty),Oe()],kt.prototype,"fixedEnvMapDirection",void 0),Bt([(0,t.onChange2)(kt.prototype.setDirty),Oe()],kt.prototype,"backgroundIntensity",void 0),Bt([Oe(),(0,t.onChange)(kt.prototype._onEnvironmentChange.name)],kt.prototype,"environment",void 0),Bt([Oe(),(0,t.onChange)(kt.prototype._onBackgroundChange)],kt.prototype,"background",void 0),Bt([Oe(),(0,t.onChange)(kt.prototype._onBackgroundChange)],kt.prototype,"backgroundColor",void 0);const Ot=!0;function Lt(e,t,n,{replaceAll:r=!1,prepend:i=!1,append:s=!1}={}){if(Ot&&!e.includes(t))return console.error(`${t} not found in shader`),e;let o=n;return i?o=n+t:s&&(o=t+n),r?e.replaceAll(t,o):e.replace(t,o)}class Ft{static ApplyMaterialExtensions(e,t,n,r){for(const i of n)this.ApplyMaterialExtension(e,t,i,r)}static ApplyMaterialExtension(e,n,r,i){let s=(0,t.getOrCall)(r.parsFragmentSnippet,i,e)??"";s.length&&(n.fragmentShader=Lt(n.fragmentShader,this.VoidMain,"\n"+s+"\n",{prepend:!0})),s=(0,t.getOrCall)(r.parsVertexSnippet,i,e)??"",s.length&&(n.vertexShader=Lt(n.vertexShader,this.VoidMain,"\n"+s+"\n",{prepend:!0})),r.extraUniforms&&(n.uniforms=Object.assign(n.uniforms,r.extraUniforms)),r.extraDefines&&function(e,t){let n=!1;t.materialObject&&void 0===t.materialObject.defines&&(t.materialObject.defines={});const r=Object.entries(e);for(const[e,i]of r)void 0===i?void 0!==t.materialObject.defines[e]&&(delete t.materialObject.defines[e],n=!0):t.materialObject.defines[e]!==i&&(t.materialObject.defines[e]=i,n=!0);n&&(t.materialObject.needsUpdate=!0)}(r.extraDefines,e),r.shaderExtender&&r.shaderExtender(n,e,i),e.lastShader=n}static CacheKeyForExtensions(e,t){let n="";for(const r of t)n+=this.CacheKeyForExtension(e,r);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach((e=>n+=e)),n}static RegisterExtensions(e,n){const r=[];if(n)for(const t of n)t.isCompatible&&t.isCompatible(e)&&(r.push(t),t.uuid||(t.uuid=lt()),t.__setDirty||(t.__setDirty=()=>{t.updateVersion||(t.updateVersion=0),t.updateVersion++}),t.setDirty||(t.setDirty=t.__setDirty));return e.materialExtensions=r,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",(n=>function(e,{object:n,renderer:r}){if(e.materialExtensions)for(const i of e.materialExtensions){if(i.onObjectRender?.(n,e,r),e.lastShader){const n=(0,t.getOrCall)(i.updaters)||[];for(const t of n)t&&t.updateShaderProperties(e.lastShader)}i.updateVersion!==e.materialObject.userData["_"+i.uuid+"_version"]&&(e.materialObject.userData["_"+i.uuid+"_version"]=i.updateVersion,e.materialObject.needsUpdate=!0)}}(e,n)))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",(t=>function(e,{object:t,renderer:n}){if(e.materialExtensions)for(const r of e.materialExtensions)r.onAfterRender?.(t,e,n)}(e,t)))),r}}Ft.VoidMain="void main()";class Ut extends n.jyz{constructor(e,t=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=Ft.RegisterExtensions(this,e?.customMaterialExtensions??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ft.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Ft.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ft.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,r,i){super.onBeforeRender(e,t,n,r,i),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}onAfterRender(e,t,n,r,i){super.onAfterRender(e,t,n,r,i),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class Nt extends Ut{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class jt extends Nt{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map((e=>e.id)).join(";")!==e.join(";")&&(this.textures=e.map((e=>({id:e,colorSpace:n.aCh}))),this.setDirty())}_setUniformTexSize(e,t){if(!t||!e)return;const n=t.image?.width??512,r=t.image?.height??512,i=e.value;i.isVector2||console.warn("uniform is not a Vector2"),i&&Math.abs(i.x-n)+Math.abs(i.y-r)>.1&&(i.x=n,i.y=r,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,r,i){this._setUniformTexSize(this.uniforms.screenSize,e.getRenderTarget()?.texture);for(const e of this.textures){const t=e.id,n=this.uniforms[t]?.value;n&&(this._setUniformTexSize(this.uniforms[t+"Size"],n),n.colorSpace!==e.colorSpace&&(e.colorSpace=n.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,r,i)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map((e=>`uniform sampler2D ${e.id}; \n`+G(e.id??"input",e.colorSpace??n.aCh))).join("\n")+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map((e=>e.id+e.colorSpace)).join(";")}}function zt(e,...t){const n=e.fragmentShader;return new jt({defines:Object.assign({},e.defines),uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:n},t)}class Gt extends l{constructor(e,...t){super(e.isMaterial?e:zt(e,...t),t.length<1?Gt.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){this.material?.dispose?.(),this.fsQuad?.dispose?.(),this.onDirty=[]}setDirty(){this.onDirty.forEach((e=>e()))}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach((e=>e?.updateShaderProperties(this.material))))}render(e,t,n,r,i){this.enabled&&super.render(e,t||null,n,r,i)}}Gt.DEFAULT_TEX_ID="tDiffuse",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([ht("Enabled"),Oe()],Gt.prototype,"enabled",void 0);class Vt extends i{constructor(e,t,r,i,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new n.Ilk}render(e,t,n,r,i,s){if(!this.scene||!this.camera)return;const o=e.autoClear;let a,l;if(e.autoClear=!1,void 0!==this.overrideMaterial&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,a),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=l),e.autoClear=o}}class Ht extends Gt{constructor(e,n="c = a + b;",i="",s){super({vertexShader:r.vertexShader,fragmentShader:t.glsl`
                varying vec2 vUv;
                
                ${i}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${n}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:s},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Qt extends Nt{constructor(e=!0){super({vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#if IS_GLSL3 > 0\nout vec3 vViewPosition;\n#else\nvarying vec3 vViewPosition;\n#endif\nvoid main(){\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#include <packing>\nuniform float alphaTest;\n#endif\n#if IS_GLSL3 > 0\n#ifndef gl_FragColor \nlayout(location=0)out vec4 A;layout(location=1)out vec4 B;\n#endif\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <alphamap_pars_fragment>\nuniform vec2 cameraNearFar;uniform vec4 flags;\n#if IS_GLSL3 > 0\nin vec3 vViewPosition;\n#else\nvarying vec3 vViewPosition;\n#endif\nvec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){\n#glMarker mainStart\n#ifdef USE_ALPHAMAP\n#ifdef ALPHA_I_RGBA_PACKING\nif(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)\n#else\nif(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)\n#endif\ndiscard;\n#endif\n#include <normal_fragment_begin>\n#ifdef FORCED_LINEAR_DEPTH\nfloat linearZ=float(FORCED_LINEAR_DEPTH);\n#else\nfloat linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);\n#endif\nvec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);\n#if IS_GLSL3 > 0\n#ifndef gl_FragColor \nA=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;\n#else\ngl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);\n#endif\n#else\ngl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);\n#endif\n}",uniforms:{cameraNearFar:{value:new n.FM8(.1,1e3)},alphaMap:{value:null},displacementMap:{value:null},displacementScale:{value:null},displacementBias:{value:null},displacementMapTransform:{value:new n.Vkp},alphaTest:{value:0},alphaMapTransform:{value:new n.Vkp},flags:{value:new n.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?n.LSk:n.v9Y}),this._updaters=[]}onBeforeRender(e,t,r,i,s){super.onBeforeRender(e,t,r,i,s);let o=s.material;Array.isArray(o)&&(o=o[0]),this.uniforms.alphaMap.value=o?.alphaMap??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!o||!o.alphaTest||o.alphaTest<1e-7?.001:o.alphaTest,this.uniforms.displacementMap.value=o?.displacementMap??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=o?.displacementScale??1,this.uniforms.displacementBias.value=o?.displacementBias??0,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(o?.userData.matId?o?.userData.matId:0)/255,this._updaters.forEach((e=>{e(s,this.uniforms.flags.value)})),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let a=this.uniforms.alphaMap.value?1:void 0;a!==this.defines.USE_ALPHAMAP&&(void 0===a?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=a,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),a=this.uniforms.displacementMap.value?1:void 0,a!==this.defines.USE_DISPLACEMENTMAP&&(void 0===a?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=a,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),a=o.userData.ALPHA_I_RGBA_PACKING?1:void 0,a!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===a?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=a,this.needsUpdate=!0),a=o.userData.forcedLinearDepth??void 0,a!==this.defines.FORCED_LINEAR_DEPTH&&(void 0===a?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=a,this.needsUpdate=!0),this.side=o.side??n.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);-1!==t&&this._updaters.splice(t,1)}}var Wt="#ifndef UNPACK_GBUFFER_SNIPPET\n#define UNPACK_GBUFFER_SNIPPET \nuniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nuniform sampler2D tGBufferFlags;\n#endif\nivec4 getGBufferFlags(const in vec2 uv){\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nreturn ivec4(texture2D(tGBufferFlags,uv)*255.);\n#else\nreturn ivec4(1);\n#endif\n}\n#endif\n";class qt extends t.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=Ne(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(je(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){return this._viewer?.getPluginByType("AssetManager")?.exportPluginPreset(this)??this.toJSON?.()}async importState(e){const t=this._viewer?.getPluginByType("AssetManager");t?await t.importPluginPreset(e,this):this.fromJSON?.(e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(void 0===n&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function Xt(e,n,r){return{...n,get dirty(){return n.dirty||!1},set dirty(e){(0,t.safeSetProperty)(n,"dirty",e,!0)},update(){this.passObject.enabled&&(this.passObject.updateShaderProperties?.((0,t.getOrCall)(r)),n.update?.call(this))},onRegister(t){this.passObject.materialExtension&&e.getPluginByType("AssetManager")?.materials?.registerMaterialExtension(this.passObject.materialExtension),n.onRegister?.call(this,t)},onUnregister(t){this.passObject.materialExtension&&e.getPluginByType("AssetManager")?.materials?.unregisterMaterialExtension(this.passObject.materialExtension),n.onUnregister?.call(this,t)},dispose(){this.passObject.dispose?.(),n.dispose?.call(this)}}}class Yt extends qt{_update(e){return this._pass?.enabled&&this.enabled||!1}get enabled(){return this._pass?.passObject?.enabled||this._enabledTemp}set enabled(e){this._pass?.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(t){t&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Xt(e,t),void 0!==t.passObject.onDirty&&t.passObject.onDirty.push((()=>t.dirty=!0)),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){this._pass&&e.renderer.unregisterPass(this._pass),this._pass?.dispose?.(),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=this.pass;return n&&(t.pass=Ne(n?.passObject??n,!1,e)),t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&je(e.pass,n?.passObject??n,!1,t)}return this}}!function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe()],Yt.prototype,"enabled",null);const Kt=new Set,Jt=new Set;class Zt extends Vt{constructor(e,t,n=new xe(1,1,1),r=1){super(void 0,void 0,t,n,r),this.target=e}render(e,t,n,r,i){const s=e.getRenderTarget(),o=e.getActiveCubeFace(),a=e.getActiveMipmapLevel();this.scene?.traverse((({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(Kt.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(Jt.add([e,e.transmission]),e.transmission=0))})),Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(e,t,this.target,r,i))),Kt.forEach((e=>e.transparent=!e.transparent)),Kt.clear(),Jt.forEach((([e,t])=>e.transmission=t)),Jt.clear(),e.setRenderTarget(s,o,a)}}class $t extends Yt{get material(){return this._material}passCtor(e){const t=this._viewer?.renderer.isWebGL2&&this.renderFlagsBuffer,r=e.renderer.createTarget({depthBuffer:!0,samples:this._viewer?.renderer.composerTarget.samples||0,type:n.ywz,textureCount:t?2:1});Array.isArray(r.texture)?(r.texture[0].name="gbufferDepthNormal",r.texture[1].name="gbufferFlags",this._gbufferTextures=r.texture):(r.texture.name="gbufferDepthNormal",this._gbufferTextures.push(r.texture)),this._gbufferTarget=r;const i=this._viewer?.getPluginByType("debug");return i&&(i.addTexture("gbuffer depth normal",(()=>this.getDepthNormal()),[40,110,300,200]),this._gbufferTextures.length>1&&i.addTexture("gbuffer flags",(()=>this.getFlagsTexture()),[40,310,200,100])),this._material=new Qt(t),this._material.userData.isGBufferMaterial=!0,new Zt(r,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Wt}updateShaderProperties(e){if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:this._viewer?.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const t=e.uniforms.tGBufferFlags.value?1:0;t!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=t,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}$t.PluginType="GBuffer";class en extends Vt{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:n.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?n.cLu:n.ywz,format:n.wk1,minFilter:n.wem,magFilter:n.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new xe(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new Ht({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,r,i){let s=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,r,i),this.needsSwap=s,void(e.userData.mainRenderPass=void 0);const o=e.userData;o||console.error("threejs is not patched?");const a=this._viewer.useGBufferDepth;let l;if(a){const t=this._viewer.getPlugin($t)?.getTarget();if(t){const n=e.properties.get(t);l=n.__webglDepthRenderbuffer||n.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let c=(t=!1)=>{super.render(e,void 0,n,r,i,l)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(s=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const t=e.autoClearDepth;e.autoClearDepth=!a,Y(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},c),e.autoClearDepth=t}if(!a){const t=e.properties.get(n);l=t.__webglDepthRenderbuffer||t.__webglDepthbuffer}c=()=>{super.render(e,void 0,this.transparentTarget,r,i,l)};{const t=this.clear,n=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},c),this.clear=t,e.autoClearDepth=n}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,i),s=!0);{const r=this.clear;this.clear=!1,o.transmissionRenderTarget=s?t:n,o.blurTransmissionTarget=this.blurTransmissionTarget&&0===o.transmissionRenderTarget.samples,Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},c),o.blurTransmissionTarget=void 0,o.transmissionRenderTarget=void 0,this.clear=r}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,i),s=!0)}}else{{const t=this.clear,n=e.autoClearDepth;e.autoClearDepth=!a,this.clear=!0,Y(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},c),this.clear=t,e.autoClearDepth=n}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const r=this.clear;this.clear=!1,o.transmissionRenderTarget=t,o.blurTransmissionTarget=this.blurTransmissionTarget,Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},c),o.blurTransmissionTarget=void 0,o.transmissionRenderTarget=void 0,this.clear=r}s=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=s,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function tn(e,t){return e.multiplyScalar(e.w*t),e.w=1,e}function nn(e,t){return tn(e,t),new xe(e.x,e.y,e.z)}function rn(e,t){const n=Math.max(e.x,Math.max(e.y,e.z));let r=Math.max(Math.min(n/t,1),0);return r=Math.ceil(255*r)/255,e.divideScalar(r*t),e.w=r,e}function sn(e,t){return rn(new n.Ltg(e.r,e.g,e.b,1),t)}const on={name:"",blending:n.bdR,side:n.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:n.k74,blendDst:n.LgZ,blendEquation:n.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:n.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:n.cum,stencilRef:0,stencilFuncMask:255,stencilFail:n.x5V,stencilZFail:n.x5V,stencilZPass:n.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},an={...on,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:n.IOt,normalScale:new n.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},ln={...an,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new n.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new xe(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new xe(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new xe(1,1,1),specularColorMap:null};class cn extends n.EJi{constructor(e){super(e),this.typeSlug=cn.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=Ft.RegisterExtensions(this,e?.customMaterialExtensions??[])}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),this._uiConfig?.uiRefresh?.("postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ft.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ce(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Ce(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Ce(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Ce(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",n.IOt],["ObjectSpace",n.PA7]].map((e=>({label:e[0],value:e[1]})))},Ce(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Ce(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Ce(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Ce(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Ce(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Ce(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Ce(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Ce(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Ce(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Ce(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",n.BVF],["Always",n.Se2],["Less",n.Zr5],["LessEqual",n.vCF],["Equal",n.eD],["GreaterEqual",n.ksN],["Greater",n.w$m],["NotEqual",n.M6v]].map((e=>({label:e[0],value:e[1]})))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",te],["Normal",ne],["Additive",n.WMw],["Subtractive",re],["Multiply",ie]].map((e=>({label:e[0],value:e[1]})))},{type:"image",property:[this,"alphaMap"]},Ce(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>!0===this.userData.inverseAlphaMap,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ce(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ce(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},Ce(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},Ce(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",n.Wl3],["Back",n._Li],["Double",n.ehD]].map((e=>({label:e[0],value:e[1]})))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>this.userData?.__appliedMeshes?.size??0,setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Ne(this,!1),null,2)],{type:"application/json"});(0,t.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>e.getUiConfig?.(this)))].filter((e=>e)),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const t of r)e.vertexShader=Lt(e.vertexShader,t[0],"#glMarker "+t[1]+"\n"+t[0]);for(const t of n)e.fragmentShader=Lt(e.fragmentShader,t[0],"#glMarker "+t[1]+"\n"+t[0]);Ft.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ft.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,i){super.onBeforeRender(e,t,n,r,i),void 0===this.envMapIntensity||this.userData.separateEnvMapIntensity||void 0===t.envMapIntensity||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),void 0!==this.envMap&&void 0!==t.fixedEnvMapDirection&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):void 0!==this.defines.FIX_ENV_DIRECTION&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:i});const s=this.userData.inverseAlphaMap?1:0;s!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=s,this.needsUpdate=!0)}onAfterRender(e,t,n,r,i){super.onAfterRender(e,t,n,r,i),void 0!==this.userData.__envIntensity&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}copyProps(e,n=!1,r=!0){if(!n&&!["MeshStandardMaterial",cn.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},s=Array.from(Object.keys(ln));(0,t.copyProps)(e,i,s);const o=i.userData;delete i.userData;for(const e of Object.keys(i))void 0===i[e]&&delete i[e];if(this.setValues(i),r){const e={};for(const t of Se)void 0!==this.userData[t]&&(e[t]=this.userData[t])}return o&&Me(this.userData,o),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},Me(n.userData,t),n.userData.uuid=this.userData.uuid;const r=e||{textures:Object.fromEntries(n.textures?.map((e=>[e.uuid,e]))||[]),images:Object.fromEntries(n.images?.map((e=>[e.uuid,e]))||[])};n.userData=Ne(n.userData,!1,r),e||(Object.keys(r.textures).length>0&&(n.textures=Object.values(r.textures)),Object.keys(r.images).length>0&&(n.images=Object.values(r.images))),n.type=cn.TYPE;for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}cn.TypeSlug="pmat",cn.TYPE="MeshStandardMaterial2";const un={...on,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:n.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class hn extends n.vBJ{constructor(e){super(e),this.typeSlug=hn.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.materialExtensions=Ft.RegisterExtensions(this,e?.customMaterialExtensions??[])}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),this._uiConfig?.uiRefresh?.("postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ft.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ce(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",te],["Normal",ne],["Additive",n.WMw],["Subtractive",re],["Multiply",ie]].map((e=>({label:e[0],value:e[1]})))},{type:"image",property:[this,"alphaMap"]},Ce(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ce(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ce(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",n.Wl3],["Back",n._Li],["Double",n.ehD]].map((e=>({label:e[0],value:e[1]})))},{type:"input",label:"Mesh count",getValue:()=>this.userData?.__appliedMeshes?.size??0,setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Ne(this,!1),null,2)],{type:"application/json"});(0,t.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>e.getUiConfig?.(this)))].filter((e=>e)),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const t of r)e.vertexShader=Lt(e.vertexShader,t[0],"#glMarker "+t[1]+"\n"+t[0]);for(const t of n)e.fragmentShader=Lt(e.fragmentShader,t[0],"#glMarker "+t[1]+"\n"+t[0]);Ft.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ft.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,i){super.onBeforeRender(e,t,n,r,i),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}onAfterRender(e,t,n,r,i){super.onAfterRender(e,t,n,r,i),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}copyProps(e,n=!1){if(!n&&!["MeshBasicMaterial",hn.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const r={},i=Array.from(Object.keys(un));(0,t.copyProps)(e,r,i);const s=r.userData;delete r.userData;for(const e of Object.keys(r))void 0===r[e]&&delete r[e];return this.setValues(r),s&&Me(this.userData,s),this.setDirty(),this}toJSON(e){const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},Me(n.userData,t),n.userData.uuid=this.userData.uuid;const r=e||{textures:Object.fromEntries(n.textures?.map((e=>[e.uuid,e]))||[]),images:Object.fromEntries(n.images?.map((e=>[e.uuid,e]))||[])};n.userData=Ne(n.userData,!1,r),e||(Object.keys(r.textures).length>0&&(n.textures=Object.values(r.textures)),Object.keys(r.images).length>0&&(n.images=Object.values(r.images))),n.type=hn.TYPE;for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}hn.TypeSlug="bmat",hn.TYPE="MeshBasicMaterial2";const pn={materialType:cn.TYPE,name:"standard",color:"#ffffff"},dn={materialType:hn.TYPE,name:"basic",color:"#ffffff"},fn={[cn.TYPE]:pn.name,MeshStandardMaterial:pn.name,MeshPhysicalMaterial:pn.name,[hn.TYPE]:dn.name,MeshBasicMaterial:dn.name};class mn extends t.SimpleEventDispatcher{constructor(){super(),this._templates=[pn,dn],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||"material"!==t.assetType)return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),r=[];n.forEach((e=>{const n=e.userData.__appliedMaterials;n?.delete(t),n&&!1!==e.userData.disposeOnIdle&&0===n.size&&r.push(e)})),r.forEach((e=>{e.dispose()})),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find((t=>t.materialType===e));if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find((t=>t.name===e))}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach((e=>{this._getMapsForMaterial(e).forEach((t=>{let n=t.userData.__appliedMaterials;n||(t.userData.__appliedMaterials=n=new Set),t.addEventListener("update",(()=>e.dispatchEvent({type:"textureUpdate",texture:t}))),n.add(e)}))}))}_getMapsForMaterial(e){const t=new Set;for(const n of Object.values(e))n&&n.isTexture&&t.add(n);for(const n of Object.values(e.userData??{}))n&&n.isTexture&&t.add(n);return t}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter((t=>t.uuid!==e.uuid)),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=lt());const t=this._templates.find((t=>t.templateUUID===e.templateUUID));t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter((t=>t.templateUUID!==e.templateUUID))}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find((t=>t.uuid===e)):void 0}findMaterialsByName(e,t=!1){return this._materials.filter((n=>"string"!=typeof e||t?null!==n.name.match("string"==typeof e?"^"+e+"$":e):n.name===e))}getMaterialsOfType(e){return e?this._materials.filter((t=>t.typeSlug===e)):[]}getAllMaterials(){return[...this._materials]}processModel(e,n){const r=this._processModel(e,n);return(0,t.safeSetProperty)(e,"modelObject",r),e}_processMaterial(e,t){if(!e)return;if(e.materialObject?.isMaterial)return e;let n=e.mmMaterial;if(!n){const r=e.userData?.uuid||e.uuid;if(n=this.findMaterial(r),n)n.copyProps(e);else{const r=!1===t.useSourceMaterial||!e.isMaterial,i=t.materialTemplate||(r?"standard":fn[e.type]||"standard");n=this.generateFromTemplate(i,r?{}:e)}e.mmMaterial=n}return n}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),!1!==t.register&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,n,r=!0,i=!1){const s=Ne(e,!1),o=JSON.stringify(s,null,r?0:2),a=(n||e.name||"physical_material")+"."+e.typeSlug,l=new File([o],a,{type:"application/json"});return i&&(0,t.downloadFile)(l),l}applyMaterial(e,t){const n=Object.getPrototypeOf(e).constructor.TYPE;let r=this.findMaterialsByName(t,!0);(!r||r.length<1)&&(r=[this.findMaterial(t)]);let i=!1;for(const t of r)if(t&&!t.userData.__isVariation&&t!==e)if(Object.getPrototypeOf(t).constructor.TYPE===n){const n=t.name;t.copyProps(e),t.name=n,i=!0}else{const r=t["__"+n]||this.generateFromTemplateType(n);if(!r)continue;const s=t.name;r.copyProps(e),r.name=s;const o=t.userData.__appliedMeshes;for(const e of[...o??[]])e?.setMaterial?.(r),e&&(i=!0);t["__"+n]=r}return i}}class gn extends mn{_generateFromTemplate(e,r){let i;const s={...e};s.customMaterialExtensions=[...s.customMaterialExtensions??[],...this._materialExtensions];const o=r?.metadata&&r?.metadata.version<=4.5;o&&(n.epp.enabled=!1);let a={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":r&&(0,t.copyProps)(r,s,Array.from(Object.keys(ln))),"MeshBasicMaterial"===r?.type&&(s.roughness=.9,s.metalness=0,s.userData?.uuid&&delete s.userData.uuid),a=s.userData?.uuid,a&&delete s.userData.uuid,i=new cn({customMaterialExtensions:s.customMaterialExtensions}).fromJSON(s,void 0,!0),a&&(i.uuid=a),i.userData.uuid=i.uuid,i.setDirty(),r?.isMaterial&&void 0!==r.userData&&(r.userData.iMaterial=i);break;case"MeshBasicMaterial2":case"basic":case"unlit":r&&(0,t.copyProps)(r,s,Array.from(Object.keys(un))),a=s.userData?.uuid,a&&delete s.userData.uuid,i=new hn({customMaterialExtensions:s.customMaterialExtensions}).fromJSON(s,void 0,!0),a&&(i.uuid=a,s.userData.uuid=a),i.userData.uuid=i.uuid,i.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:a=null,r&&r.userData&&(a=r.userData,delete r.userData),i=e.generator?.(s,r)||void 0,r&&a&&(r.userData=a),a&&i&&(Me(i.userData,a),a?.uuid&&(i.uuid=a.uuid),a=null),i&&(i.userData.uuid=i.uuid)}if(i){r.runtimeMaterial&&(i.userData.__runtimeMaterial=!0);const t=i;if(i.clone=()=>{t.userData.cloneId||(t.userData.cloneId="0"),t.userData.cloneCount||(t.userData.cloneCount=0),t.userData.cloneCount+=1;const n=this.generateFromTemplate(e.name);return n&&(n.copyProps(t),n.userData.cloneId=n.userData.cloneId+"_"+t.userData.cloneCount,n.userData.cloneCount=0,n.name=n.name+"_"+n.userData.cloneId,n.userData.uuid=n.uuid),n?.materialObject},r){let e=this.findMaterial(r?.uuid);e&&this.unregisterMaterial(e),e=this.findMaterial(r?.materialObject?.uuid),e&&this.unregisterMaterial(e)}}return o&&(n.epp.enabled=!0),i?this.registerMaterialObject(i):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let r=!0;Array.isArray(n)||(n=[n],r=!1);const i=[];for(const e of n){const n=this._processMaterial(e,t);i.push(n?.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(r?i:i[0]))}if(!1!==t.recursive)for(let n=0;n<e.modelObject.children.length;n++)e.modelObject.children[n]=this._processModel(e.modelObject.children[n],t);return e}}class _n{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return"function"==typeof this.onCtor?this.onCtor(t,e):t}constructor(e,t,n,r){this.cls=e,this.ext=t,this.root=n,this.onCtor=r}}class vn{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:r=!1,autoScale:i=!1,autoScaleRadius:s=2,license:o=""}={}){if(this.assetType="model",this._modelObject=Ke(new n.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!r||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||r||(e.userData.isCentered=!0):K(e),this._modelObject=e;else{r&&console.error("cannot use pseudoCenter and autoCenter at the same time");const t=(new v).expandByObject(e,!0,!0).getCenter(new n.Pa4);this._modelObject.position.copy(t).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}i&&!this._modelObject.userData.autoScaled?J(this._modelObject,e.userData.autoScaleRadius||s):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",(()=>{this.__disposed=!0})),this._modelObject.userData.iModel=this,this.license=o}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&"function"==typeof e?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){this._modelObject?.setDirty?.(e),this._uiConfig?.uiRefresh?.("postFrame",!0)}setMaterial(e){return this._modelObject.isMesh?this._modelObject.setMaterial?.(e)||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){if(this._modelObject.isMesh)return this._modelObject.setGeometry?.(e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Ye(this._modelObject,!1)),this._uiConfig}clone(){return new vn(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function yn(e,t){return[e.modelObject,...e.modelObject.children].forEach((n=>{Ke(n,n!==e.modelObject?e:void 0,t)})),e}class bn{constructor(){this._processors=new Map}add(e,t){this._processors.has(e)||this._processors.set(e,[]),this._processors.get(e)?.push(t)}remove(e,t){const n=this._processors.get(e),r=n?.indexOf(t)||n?.findIndex((e=>e.process&&e.process===t.process||e.processAsync&&e.processAsync===t.processAsync));!n||!r||r<0||n.splice(r,1)}get(e){return this._processors.get(e)??[]}async process(e,t,n){const r=this.get(e),i=t.assetType;for(const e of r)e.forAssetType===i&&(t=e.process?.(t,n)??t,t=await(e.processAsync?.(t,n))??t);return t}dispose(){this._processors.clear()}}class An extends n.hH6{load(e,t,n,r){return super.load(e,(e=>{try{if("string"!=typeof e)throw new Error("Invalid JSON");t?.(JSON.parse(e))}catch(e){r?.(e)}}),n,r)}}class wn extends n.yxD{constructor(e){super(e),this.type=n.cLu}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,n){t=t||1024;let r=e.pos,i=-1,s=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=a.indexOf("\n"))&&s<t&&r<e.byteLength;)o+=a,s+=a.length,r+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=s+i+1),o+a.slice(0,i))},i=function(e,t,n,r){const i=e[t+3],s=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*s,n[r+1]=e[t+1]*s,n[r+2]=e[t+2]*s,n[r+3]=1},s=function(e,t,r,i){const s=e[t+3],o=Math.pow(2,s-128)/255;r[i+0]=n.A5E.toHalfFloat(Math.min(e[t+0]*o,65504)),r[i+1]=n.A5E.toHalfFloat(Math.min(e[t+1]*o,65504)),r[i+2]=n.A5E.toHalfFloat(Math.min(e[t+2]*o,65504)),r[i+3]=n.A5E.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=r(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(a.valid|=1,a.programtype=c[1],a.string+=l+"\n";l=r(e),!1!==l;)if(a.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(a.gamma=parseFloat(c[1])),(c=l.match(i))&&(a.exposure=parseFloat(c[1])),(c=l.match(s))&&(a.valid|=2,a.format=c[1]),(c=l.match(o))&&(a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=l+"\n";return 2&a.valid?4&a.valid?a:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==a){const e=a.width,r=a.height,l=function(e,n,r){const i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(i!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const s=new Uint8Array(4*n*r);if(!s.length)return t(4,"unable to allocate buffer space");let o=0,a=0;const l=4*i,c=new Uint8Array(4),u=new Uint8Array(l);let h=r;for(;h>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=i)return t(3,"bad rgbe scanline format");let n,r=0;for(;r<l&&a<e.byteLength;){n=e[a++];const i=n>128;if(i&&(n-=128),0===n||r+n>l)return t(3,"bad scanline data");if(i){const t=e[a++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(a,a+n),r),r+=n,a+=n}const p=i;for(let e=0;e<p;e++){let t=0;s[o]=u[e+t],t+=i,s[o+1]=u[e+t],t+=i,s[o+2]=u[e+t],t+=i,s[o+3]=u[e+t],o+=4}h--}return s}(o.subarray(o.pos),e,r);if(-1!==l){let t,o,c;switch(this.type){case n.VzW:c=l.length/4;const e=new Float32Array(4*c);for(let t=0;t<c;t++)i(l,4*t,e,4*t);t=e,o=n.VzW;break;case n.cLu:c=l.length/4;const r=new Uint16Array(4*c);for(let e=0;e<c;e++)s(l,4*e,r,4*e);t=r,o=n.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:a.string,gamma:a.gamma,exposure:a.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){switch(e.type){case n.VzW:case n.cLu:e.colorSpace=n.GUF,e.minFilter=n.wem,e.magFilter=n.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,i)}}function xn(e){return new _n(class extends wn{constructor(t){super(t),this.setDataType(uo(e.renderer.rendererObject))}},["hdr"],!1)}class En extends n.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new In(e)})),this.register((function(e){return new Fn(e)})),this.register((function(e){return new Un(e)})),this.register((function(e){return new Nn(e)})),this.register((function(e){return new Rn(e)})),this.register((function(e){return new Bn(e)})),this.register((function(e){return new kn(e)})),this.register((function(e){return new On(e)})),this.register((function(e){return new Dn(e)})),this.register((function(e){return new Ln(e)})),this.register((function(e){return new Pn(e)})),this.register((function(e){return new Mn(e)})),this.register((function(e){return new jn(e)})),this.register((function(e){return new zn(e)}))}load(e,t,r,i){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new n.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{s.parse(n,o,(function(n){t(n),s.manager.itemEnd(e)}),a,e)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,i){let s;const o={},a={},l=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Gn){try{o[Sn.KHR_BINARY_GLTF]=new Vn(e)}catch(e){return void(r&&r(e))}s=JSON.parse(o[Sn.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new hr(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);a[t.name]=t,o[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){const t=s.extensionsUsed[e],n=s.extensionsRequired||[];switch(t){case Sn.KHR_MATERIALS_UNLIT:o[t]=new Tn;break;case Sn.KHR_DRACO_MESH_COMPRESSION:o[t]=new Hn(s,this.dracoLoader);break;case Sn.KHR_TEXTURE_TRANSFORM:o[t]=new Qn;break;case Sn.KHR_MESH_QUANTIZATION:o[t]=new Wn;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,r)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}function Cn(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Sn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Mn{constructor(e){this.parser=e,this.name=Sn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new n.Ilk(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new n.Ox3(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new n.cek(l),a.distance=c;break;case"spot":a=new n.PMe(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,sr(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(a),t.cache.add(r,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class Tn{constructor(){this.name=Sn.KHR_MATERIALS_UNLIT}getMaterialType(){return n.vBJ}extendParams(e,t,r){const i=[];e.color=new n.Ilk(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&i.push(r.assignTexture(e,"map",s.baseColorTexture,n.KI_))}return Promise.all(i)}}class Dn{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class In{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.FM8(e,e)}return Promise.all(s)}}class Pn{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class Rn{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new n.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,n.KI_)),void 0!==o.sheenRoughnessTexture&&s.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),i.extras&&void 0!==i.extras.sheenFactor&&(t.sheen=i.extras.sheenFactor,delete i.extras.sheenFactor),Promise.all(s)}}class Bn{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class kn{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new n.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class On{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class Ln{constructor(e){this.parser=e,this.name=Sn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new n.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,n.KI_)),Promise.all(s)}}class Fn{constructor(e){this.parser=e,this.name=Sn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class Un{constructor(e){this.parser=e,this.name=Sn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Nn{constructor(e){this.parser=e,this.name=Sn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=r.images[s.source];let a=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class jn{constructor(e){this.name=Sn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class zn{constructor(e){this.name=Sn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const i=t.meshes[r.mesh];for(const e of i.primitives)if(e.mode!==Kn.TRIANGLES&&e.mode!==Kn.TRIANGLE_STRIP&&e.mode!==Kn.TRIANGLE_FAN&&void 0!==e.mode)return null;const s=r.extensions[this.name].attributes,o=[],a={};for(const e in s)o.push(this.parser.getDependency("accessor",s[e]).then((t=>(a[e]=t,a[e]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,s=[];for(const e of r){const t=new n.yGw,r=new n.Pa4,o=new n._fP,l=new n.Pa4(1,1,1),c=new n.SPe(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&l.fromBufferAttribute(a.SCALE,e),c.setMatrixAt(e,t.compose(r,o,l));c.sourceTrs=a;for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);n.Tme.prototype.copy.call(c,e),this.parser.assignFinalMaterial(c),s.push(c)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}}const Gn="glTF";class Vn{constructor(e){this.name=Sn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Gn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let s=0;for(;s<r;){const t=i.getUint32(s,!0);s+=4;const r=i.getUint32(s,!0);if(s+=4,1313821514===r){const r=new Uint8Array(e,12+s,t);this.content=n.decode(r)}else if(5130562===r){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Hn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Sn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const e in s){const t=tr[e]||e.toLowerCase();o[t]=s[e]}for(const t in e.attributes){const r=tr[t]||t.toLowerCase();if(void 0!==s[t]){const i=n.accessors[e.attributes[t]],s=Jn[i.componentType];l[r]=s.name,a[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),o,l)}))}))}}class Qn{constructor(){this.name=Sn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Wn{constructor(){this.name=Sn.KHR_MESH_QUANTIZATION}}class qn extends n._C8{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-t,u=(n-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,_=1-m,v=g-h+u;for(let e=0;e!==o;e++){const t=s[f+e+o],n=s[f+e+a]*c,r=s[d+e+o],l=s[d+e]*c;i[e]=_*t+v*n+m*r+g*l}return i}}const Xn=new n._fP;class Yn extends qn{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return Xn.fromArray(i).normalize().toArray(i),i}}const Kn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Jn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Zn={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},$n={33071:n.uWy,33648:n.OoA,10497:n.rpg},er={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},nr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},rr={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv};function ir(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function sr(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function or(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ar(e){const t=e.extensions&&e.extensions[Sn.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+lr(t.attributes):e.indices+":"+lr(e.attributes)+":"+e.mode,n}function lr(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function cr(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const ur=new n.yGw;class hr{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Cn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;"undefined"!=typeof navigator&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&s<98?this.textureLoader=new n.dpR(this.options.manager):this.textureLoader=new n.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const s={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};ir(i,s,r),sr(s,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,r]of e.children.entries())i(r,t.children[n])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Sn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,s){r.load(n.Zp0.resolveURL(t.uri,i.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=er[i.type],t=Jn[i.componentType],r=!0===i.normalized,s=new t(i.count*e);return Promise.resolve(new n.TlE(s,e,r))}const s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],o=er[i.type],a=Jn[i.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,u=i.byteOffset||0,h=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;let d,f;if(h&&h!==c){const e=Math.floor(u/h),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=t.cache.get(r);c||(d=new a(s,e*h,i.count*h/l),c=new n.vpT(d,h/l),t.cache.add(r,c)),f=new n.kB5(c,o,u%h/l,p)}else d=null===s?new a(i.count*o):new a(s,u,i.count*o),f=new n.TlE(d,o,p);if(void 0!==i.sparse){const t=er.SCALAR,r=Jn[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,u=new r(e[1],l,i.sparse.count*t),h=new a(e[2],c,i.sparse.count*o);null!==s&&(f=new n.TlE(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(f.setX(t,h[e*o]),o>=2&&f.setY(t,h[e*o+1]),o>=3&&f.setZ(t,h[e*o+2]),o>=4&&f.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let s=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,r){const i=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then((function(t){t.name=o.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const r=(s.samplers||{})[o.sampler]||{};return t.magFilter=Zn[r.magFilter]||n.wem,t.minFilter=Zn[r.minFilter]||n.D1R,t.wrapS=$n[r.wrapS]||n.rpg,t.wrapT=$n[r.wrapT]||n.rpg,r.extras&&void 0!==r.extras.uuid&&(t.uuid=r.extras.uuid),i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t,r=!1,i=!1){const s=this,o=this.json,a=this.options;if(!i&&void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const l=o.images[e],c=self.URL||self.webkitURL;void 0===l.uri&&l.extras&&l.extras.uri&&(l.uri=l.extras.uri);let u=l.uri||"",h=!1,p=null;if(void 0===l.bufferView||r&&u){if(void 0===l.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else u=s.getDependency("bufferView",l.bufferView).then((function(e){h=!0;const t=new Blob([e],{type:l.mimeType});return u=c.createObjectURL(t),p=t,u}));const d=Promise.resolve(u).then((function(e){return new Promise((function(r,i){let o=r;!0===t.isImageBitmapLoader&&(o=function(e){const t=new n.xEZ(e);t.needsUpdate=!0,r(t)}),t.load(n.Zp0.resolveURL(e,a.path),o,void 0,(function(l){!0===t.isImageBitmapLoader?(t=new n.dpR(s.options.manager),o=r,t.setCrossOrigin(s.options.crossOrigin),t.setRequestHeader(s.options.requestHeader),t.load(n.Zp0.resolveURL(e,a.path),o,void 0,i)):i(l)}))}))})).then((function(i){var o;if(!0===h&&c.revokeObjectURL(u),i.userData.mimeType=l.mimeType||((o=l.uri).search(/\.jpe?g($|\?)/i)>0||0===o.search(/^data\:image\/jpeg/)?"image/jpeg":o.search(/\.webp($|\?)/i)>0||0===o.search(/^data\:image\/webp/)?"image/webp":"image/png"),i.flipY=!1,l.extras){if(void 0!==l.extras.flipY){if(!0===t.isImageBitmapLoader&&void 0!==typeof createImageBitmap){let e=i;const t=l.extras.flipY&&!e.flipY;createImageBitmap(e.source.data,{imageOrientation:t?"flipY":"none"}).then((function(t){e._newTex&&(e=e._newTex),e.source.data.close&&e.source.data.close(),e.source.data=t,e.source.needsUpdate=!0,e.needsUpdate=!0}))}i.flipY=l.extras.flipY,i.needsUpdate=!0,delete l.extras.flipY}void 0!==l.extras.uuid&&(i.source.uuid=l.extras.uuid),void 0!==l.extras.t_uuid&&(i.uuid=l.extras.t_uuid)}return l.uri&&"string"==typeof l.uri&&!1===h&&!l.uri.startsWith("/")&&(i.userData.rootPath=n.Zp0.resolveURL(l.uri,a.path)),p&&(i.userData.__sourceBlob=p),!r&&l.uri&&l.uri!==u&&s.loadImageSource(e,t,!0,!0).then((function(e){i.source.data&&i.source.data.close&&i.source.data.close(),i.dispose(),i.source=e.source,i.source.needsUpdate=!0,i.needsUpdate=!0,i.uuid=e.uuid,i.flipY=e.flipY,i.userData=e.userData,i.setDirty&&i.setDirty(),e._newTex=i})),i})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),e}));return this.sourceCache[e]=d,d}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[Sn.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Sn.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[Sn.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==r&&(s.colorSpace=r),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.UY4,n.F5T.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new n.nls,n.F5T.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||s||o){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return n.Wid}loadMaterial(e){const t=this,r=this.json,i=this.extensions,s=r.materials[e];let o;const a={},l=[];if((s.extensions||{})[Sn.KHR_MATERIALS_UNLIT]){const e=i[Sn.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(a,s,t))}else{const r=s.pbrMetallicRoughness||{};if(a.color=new n.Ilk(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==r.baseColorTexture&&l.push(t.assignTexture(a,"map",r.baseColorTexture,n.KI_)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=n.ehD);const c=s.alphaMode||"OPAQUE";if("BLEND"===c?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===c&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==n.vBJ&&(l.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new n.FM8(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&o!==n.vBJ&&(l.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==n.vBJ&&(a.emissive=(new n.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==n.vBJ&&l.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,n.KI_)),Promise.all(l).then((function(){const n=new o(a);return s.name&&(n.name=s.name),sr(n,s),t.associations.set(n,{materials:e}),s.extensions&&ir(i,n,s),n}))}createUniqueName(e){const t=n.iUV.sanitizeNodeName(e||"");let r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function s(e){return r[Sn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return pr(n,e,t)}))}const o=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],l=ar(a),c=i[l];if(c)o.push(c.promise);else{let e;e=a.extensions&&a.extensions[Sn.KHR_DRACO_MESH_COMPRESSION]?s(a):pr(new n.u9r,a,t),i[l]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,i=this.extensions,s=r.meshes[e],o=s.primitives,a=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new n.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),l.DefaultMaterial):this.getDependency("material",o[e].material);a.push(t)}var l;return a.push(t.loadGeometries(o)),Promise.all(a).then((function(r){const a=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let r=0,u=l.length;r<u;r++){const u=l[r],h=o[r];let p;const d=a[r];if(h.mode===Kn.TRIANGLES||h.mode===Kn.TRIANGLE_STRIP||h.mode===Kn.TRIANGLE_FAN||void 0===h.mode)p=!0===s.isSkinnedMesh?new n.TUv(u,d):new n.Kj0(u,d),!0===p.isSkinnedMesh&&p.normalizeSkinWeights(),h.mode===Kn.TRIANGLE_STRIP?p.geometry=I(p.geometry,n.UlW):h.mode===Kn.TRIANGLE_FAN&&(p.geometry=I(p.geometry,n.z$h));else if(h.mode===Kn.LINES)p=new n.ejS(u,d);else if(h.mode===Kn.LINE_STRIP)p=new n.x12(u,d);else if(h.mode===Kn.LINE_LOOP)p=new n.blk(u,d);else{if(h.mode!==Kn.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new n.woe(u,d)}Object.keys(p.geometry.morphAttributes).length>0&&or(p,s),p.name=t.createUniqueName(s.name||"mesh_"+e),p.geometry&&s.extras&&s.extras.isGeometryUserData?(sr(p.geometry,s),h.extensions&&ir(i,p.geometry,h)):(sr(p,s),h.extensions&&ir(i,p,h)),t.assignFinalMaterial(p),c.push(p)}s.extensions&&c.forEach((e=>ir(i,e,s)));for(let n=0,r=c.length;n<r;n++)t.associations.set(c[n],{meshes:e,primitives:n});if(1===c.length)return c[0];const u=new n.ZAu;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new n.cPb(n.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new n.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),sr(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r=[];for(let e=0,n=t.joints.length;e<n;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then((function(e){const r=e.pop(),i=e,s=[],o=[];for(let e=0,a=i.length;e<a;e++){const a=i[e];if(a){s.push(a);const t=new n.yGw;null!==r&&t.fromArray(r.array,16*e),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new n.OdW(s,o)}))}loadAnimation(e){const t=this.json.animations[e],r=t.name?t.name:"animation_"+e,i=[],s=[],o=[],a=[],l=[];for(let e=0,n=t.channels.length;e<n;e++){const n=t.channels[e],r=t.samplers[n.sampler],c=n.target,u=c.node,h=void 0!==t.parameters?t.parameters[r.input]:r.input,p=void 0!==t.parameters?t.parameters[r.output]:r.output;void 0!==c.node&&(i.push(this.getDependency("node",u)),s.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",p)),a.push(r),l.push(c))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const t=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],c=i[e],u=s[e],h=o[e],p=a[e];if(void 0===r)continue;let d;switch(r.updateMatrix(),nr[p.path]){case nr.weights:d=n.dUE;break;case nr.rotation:d=n.iLg;break;default:d=n.yC1}const f=r.name?r.name:r.uuid,m=void 0!==h.interpolation?rr[h.interpolation]:n.NMF,g=[];nr[p.path]===nr.weights?r.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(f);let _=u.array;if(u.normalized){const e=cr(_.constructor),t=new Float32Array(_.length);for(let n=0,r=_.length;n<r;n++)t[n]=_[n]*e;_=t}for(let e=0,t=g.length;e<t;e++){const t=new d(g[e]+"."+nr[p.path],c.array,_,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new(this instanceof n.iLg?Yn:qn)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}return new n.m7l(r,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),i=[],s=n.children||[];for(let e=0,n=s.length;e<n;e++)i.push(t.getDependency("node",s[e]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),o]).then((function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(r,ur)}));for(let e=0,r=n.length;e<r;e++)t.add(n[e]);return t}))}_loadNodeShallow(e){const t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],o=s.name?i.createUniqueName(s.name):"",a=[],l=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&a.push(l),void 0!==s.camera&&a.push(i.getDependency("camera",s.camera).then((function(e){return i._getNodeRef(i.cameraCache,s.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===s.isBone?new n.N$j:t.length>1?new n.ZAu:1===t.length?t[0]:new n.Tme,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(s.name&&(a.userData.name=s.name,a.name=o),sr(a,s),s.extensions&&ir(r,a,s),void 0!==s.matrix){const e=new n.yGw;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],i=this,s=new n.ZAu;r.name&&(s.name=i.createUniqueName(r.name)),sr(s,r),r.extensions&&ir(t,s,r);const o=r.nodes||[],a=[];for(let e=0,t=o.length;e<t;e++)a.push(i.getDependency("node",o[e]));return Promise.all(a).then((function(e){for(let t=0,n=e.length;t<n;t++)s.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,r]of i.associations)(e instanceof n.F5T||e instanceof n.xEZ)&&t.set(e,r);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(s),s}))}}function pr(e,t,r){const i=t.attributes,s=[];function o(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in i){const n=tr[t]||t.toLowerCase();n in e.attributes||s.push(o(i[t],n))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(n)}return sr(e,t),function(e,t,r){const i=t.attributes,s=new n.ZzF;if(void 0===i.POSITION)return;{const e=r.json.accessors[i.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new n.Pa4(t[0],t[1],t[2]),new n.Pa4(o[0],o[1],o[2])),e.normalized){const t=cr(Jn[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new n.Pa4,t=new n.Pa4;for(let n=0,i=o.length;n<i;n++){const i=o[n];if(void 0!==i.POSITION){const n=r.json.accessors[i.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const e=cr(Jn[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new n.aLr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,t,r),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1,s=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),void 0!==n.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const n=t[0],o=t[1],a=t[2];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}class dr extends En{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(fr)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,r,i){this.preparse.call(this,e,i||t).then((e=>e?super.parse(e,t,n,r):r&&r(new ErrorEvent("no data")))).catch((e=>{console.error(e),r&&r(e??new ErrorEvent("unknown error"))}))}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),n?.traverse((e=>{e.userData.gltfUUID&&(e.uuid=e.userData.gltfUUID,delete e.userData.gltfUUID)})),n}register(e){return super.register(e)}}const fr={key:(e,t,n)=>e.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+n)||"",async process(e,n){if("string"==typeof e)return e;if(!(new TextDecoder).decode(new Uint8Array(e,0,100)).includes("WebGiGLBWrapper"))return e;const r=new Vn(e),i=JSON.parse(r.content||"{}");let s=r.body||e;const o=i.asset?.encryption;if(!o)return s;const a=o.type,l=o.version;if("aesgcm"===a&&1===l){const r=await(0,t.getOrCall)(this.key,o,i,n)||"";try{s=(await(0,t.aesGcmDecrypt)(new Uint8Array(s),r)).buffer}catch(e){throw new ErrorEvent("decryption error")}}return s}};class mr extends n.hH6{constructor(e){super(e),this.type=n.cLu}async loadAsync(e,t){const r=await this.parseAsync(e,t,!1),i=new n.IEO(r.data,r.width,r.height,n.wk1,this.type);return i.needsUpdate=!0,i.flipY=!0,i.colorSpace=n.KI_,i.minFilter=n.wem,i.magFilter=n.wem,i.source.data.complete=!0,i}async parseAsync(e,r,i=!1){let s=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const t=await super.loadAsync(e,r);e=URL.createObjectURL(t),s=!0}const o=await(0,t.imageUrlToImageData)(e);s&&URL.revokeObjectURL(e);let a=Uint8Array;this.type===n.cLu?a=Uint16Array:this.type===n.VzW&&(a=Uint32Array);const l=function(e,t=3,r=Uint16Array,i=!1){let s;const o=e.byteLength>>2,a=new r(o*t);for(let r=0;r<o;r++)s=Math.pow(2,e[4*r+3]-136),i?(a[r*t]=Math.min(e[4*r]*s,65504),a[r*t+1]=Math.min(e[4*r+1]*s,65504),a[r*t+2]=Math.min(e[4*r+2]*s,65504)):(a[r*t]=n.A5E.toHalfFloat(Math.min(e[4*r]*s,65504)),a[r*t+1]=n.A5E.toHalfFloat(Math.min(e[4*r+1]*s,65504)),a[r*t+2]=n.A5E.toHalfFloat(Math.min(e[4*r+2]*s,65504))),4===t&&(a[r*t+3]=n.A5E.toHalfFloat(1));return a}(o.data,4,a,i);return{data:l,width:o.width,height:o.height}}setDataType(e){return this.type=e,this}}class gr extends n.Gql{constructor(e){super(e),this._imageLoader=new n.S3k(e)}static async LoadRootPathTextures(e,t,r,i=!0){const s=[];for(const o of Array.isArray(e)?e:Object.values(e??{})){const e=o?.userData?.rootPath,a=i&&o.image&&t[o.image];if(!e)continue;const l=r.importPath(e,{processImported:!1}).then((e=>{const r=e?.[0],i=r?.source;if(!r||!i)return null;const s=new n.Hw6(i.data);return o.image&&(s.uuid=o.image),o.image=s.uuid,a||(t[s.uuid]=s),r.dispose(),s})).catch((e=>(console.error(e),delete o.userData.rootPath,null)));a?o.rootPathPromise=l:s.push(l)}await Promise.allSettled(s)}parseTextures2(e,t,r){for(const i of e){const e=i?.userData?.rootPath;if(e&&(!i.image||!t[i.image])){const s=new n.Hw6(this._imageLoader.load(e,r));if(!s)continue;i.image&&(s.uuid=i.image),t[s.uuid]=s,i.image=s.uuid}i.userData=je(i.userData,void 0,!1,{images:t})}const i=super.parseTextures(e,t),s={...i};for(const t of e)t.rootPathPromise?.then((e=>{if(!e)return;const n=s[t.uuid];n.dispose(),n.source=e,n.source.needsUpdate=!0,n.needsUpdate=!0}));return i}parseMaterials2(e,t,n){const r={};return e.forEach((e=>{if(!e)return;const i={...e},s=Object.keys(i);for(const e of s)if("map"===e||e.endsWith("Map")){const n=i[e];"string"==typeof n&&(t[n]?i[e]=t[n]:(console.warn(`Texture ${n} not found`),delete i[e]))}i.userData&&(i.userData=je(i.userData,void 0,!1,{textures:t}),i.userData.cloneId&&i.userData.uuid!==e.uuid&&(i.userData.uuid=e.uuid));const o=n.generateFromTemplateType(i.type,i);o&&(r[e.uuid]=o)})),r}}const _r="WEBGI_viewer";function vr(e){return new _n(dr,["gltf","glb","data:model/gltf"],!0,((t,n)=>{if(!t)return t;const r=t,i=new gr(n.loadingManager);return r.register(xr(i,e)),r.register(wr(i)),r.register(Er(i)),r.register((e=>new Ir(e))),r.register((e=>new Pr(e))),r.register((e=>new Rr(e))),r.register((e=>new Br(e))),r.register((t=>{const s=lt()+".drc",o=lt()+".ktx2",a=t.json?.extensionsRequired?.includes?.("KHR_draco_mesh_compression");if(a){const e=n.registerFile(s);e&&r.setDRACOLoader(e)}const l=t.json?.extensionsUsed?.includes?.("EXT_meshopt_compression");l&&(window.MeshoptDecoder?(r.setMeshoptDecoder(window.MeshoptDecoder),t.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const c=t.json?.extensionsUsed?.includes?.("KHR_texture_basisu");if(c){const e=n.registerFile(o);e&&(r.setKTX2Loader(e),t.options.ktx2Loader=e)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async r=>{a&&n.unregisterFile(s),c&&n.unregisterFile(o);const l=await Cr(t,e,i);r.scene&&(r.scene.__importedViewerConfig=l)}}})),r}))}const yr="WEBGI_light_extras",br="WEBGI_object3d_extras",Ar="WEBGI_material_extras",wr=e=>e=>({name:"__"+br,afterRoot:async e=>{(e.scenes||(e.scene?[e.scene]:[])).forEach((e=>{e.traverse((e=>{if(!e.isObject3D)return;const t=e.userData?.gltfExtensions?.[br];if(!t)return void(e.isLight&&!e.isAmbientLight&&(e.castShadow=!0));const n=void 0!==t.castShadow||void 0!==t.receiveShadow;void 0!==t.castShadow&&(e.castShadow=t.castShadow),void 0!==t.receiveShadow&&(e.receiveShadow=t.receiveShadow),void 0!==t.visible&&(e.visible=t.visible),void 0!==t.frustumCulled&&(e.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(e.renderOrder=t.renderOrder),void 0!==t.layers&&(e.layers.mask=t.layers),n&&(e.userData.__keepShadowDef=!0),delete e.userData.gltfExtensions[br]}))}))}}),xr=(e,t)=>e=>({name:"__"+Ar,afterRoot:async e=>{const n=e.scenes||(e.scene?[e.scene]:[]);for(const e of n){const n=e.userData?.gltfExtensions?.[Ar],r=n&&await(t.getPlugin(fo)?.importConfigResources(n.resources||{}))||{};e.traverse((e=>{const n=e?.material;if(!n?.isMaterial)return;const i=n.userData?.gltfExtensions?.[Ar];i&&(void 0!==i.emissiveIntensity&&(n.emissiveIntensity=i.emissiveIntensity),void 0!==i.fog&&(n.fog=i.fog),void 0!==i.flatShading&&(n.flatShading=i.flatShading),void 0!==i.blending&&(n.blending=i.blending),void 0!==i.side&&(n.side=i.side),void 0!==i.shadowSide&&(n.shadowSide=i.shadowSide),void 0!==i.depthFunc&&(n.depthFunc=i.depthFunc),void 0!==i.depthTest&&(n.depthTest=i.depthTest),void 0!==i.depthWrite&&(n.depthWrite=i.depthWrite),void 0!==i.colorWrite&&(n.colorWrite=i.colorWrite),void 0!==i.vertexColors&&(n.vertexColors=i.vertexColors),void 0!==i.alphaTest&&(n.alphaTest=i.alphaTest),void 0!==i.wireframe&&(n.wireframe=i.wireframe),void 0!==i.wireframeLinewidth&&(n.wireframeLinewidth=i.wireframeLinewidth),void 0!==i.wireframeLinecap&&(n.wireframeLinecap=i.wireframeLinecap),void 0!==i.wireframeLinejoin&&(n.wireframeLinejoin=i.wireframeLinejoin),void 0!==i.rotation&&(n.rotation=i.rotation),void 0!==i.polygonOffset&&(n.polygonOffset=i.polygonOffset),void 0!==i.polygonOffsetFactor&&(n.polygonOffsetFactor=i.polygonOffsetFactor),void 0!==i.polygonOffsetUnits&&(n.polygonOffsetUnits=i.polygonOffsetUnits),void 0!==i.dithering&&(n.dithering=i.dithering),void 0!==i.alphaToCoverage&&(n.alphaToCoverage=i.alphaToCoverage),void 0!==i.premultipliedAlpha&&(n.premultipliedAlpha=i.premultipliedAlpha),void 0!==i.toneMapped&&(n.toneMapped=i.toneMapped),void 0!==i.normalScale&&void 0!==n.normalScale&&(Array.isArray(i.normalScale)?n.normalScale.fromArray(i.normalScale):"number"==typeof i.normalScale?n.normalScale.set(i.normalScale,i.normalScale):t.console.warn("normalScale is not an array or number",i.normalScale)),void 0!==i.reflectivity&&(n.reflectivity=i.reflectivity),Object.entries(i).forEach((([e,t])=>{e.startsWith("_")||t&&t.resource&&"string"==typeof t.resource&&(n[e]=je(t,n[e],!1,r))})),delete n.userData.gltfExtensions[Ar])})),n&&delete e.userData.gltfExtensions[Ar]}}}),Er=e=>t=>({name:"__"+yr,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach((t=>{t.traverse((t=>{if(!t.isLight)return;const n=t.userData?.gltfExtensions?.[yr];n&&(!t.shadow&&n.shadow&&console.error("Light has no shadow, cannot import",t,n),n.shadow&&t.shadow&&(void 0!==n.shadow.bias&&(t.shadow.bias=n.shadow.bias),void 0!==n.shadow.normalBias&&(t.shadow.normalBias=n.shadow.normalBias),void 0!==n.shadow.radius&&(t.shadow.radius=n.shadow.radius),void 0!==n.shadow.mapSize&&t.shadow.mapSize.fromArray(n.shadow.mapSize),void 0!==n.shadow.camera&&(t.shadow.camera=e.parseObject(n.shadow.camera))),delete t.userData.gltfExtensions[yr])}))}))}});async function Cr(e,t,n,r){if(!r){const i=e.json.scenes||[];if(1!==i.length){for(const r of i)await Cr(e,t,n,r);return}r=i[0]}const i=r.extensions?.[_r];if(!i)return;const s=[];Object.values(i.resources).forEach((e=>{Object.values(e).forEach((e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data&&s.push(e.url),"Uint8Array"===e.url.type&&e.url.data&&s.push(e.url))}))}));for(const t of s){const n=t.data.image,r=e.json.images[n],i=await e.getDependency("bufferView",r.bufferView);if(r.mimeType.startsWith("image/")&&"Uint16Array"===t.type&&"rgbe"===t.encoding){const e=new Blob([i]);let n=URL.createObjectURL(e);(t.encodingVersion||1)<2&&(n="data:image/png;base64,"+btoa(await e.text())),t.data=(await(new mr).parseAsync(n,void 0,!0)).data,URL.revokeObjectURL(n),delete t.encoding,delete t.encodingVersion}else t.data=i}const o={textures:{},materials:{}},a=i.resources;if(a.textures&&e.json.textures)for(const[t,n]of[...Object.entries(a.textures)]){if(n.uuid||!t)continue;delete a.textures[t];const r=e.json.textures.findIndex((n=>n.extras?.uuid===t||e.json.samplers?.[n.sampler]?.extras?.uuid===t||e.json.images?.[n.source]?.extras?.t_uuid===t));r>=0&&(o.textures[t]=await e.getDependency("texture",r))}if(a.materials&&e.json.materials)for(const[n,r]of[...Object.entries(a.materials)]){if(r.uuid||!n)continue;delete a.materials[n];const i=e.json.materials.findIndex((e=>e.extras?.uuid===n));i>=0&&(o.materials[n]=await e.getDependency("material",i),o.materials[n]=t.getPlugin(fo)?.materials?.processMaterial(o.materials[n],{}))}return i.resources=await t.getPlugin(fo).importConfigResources(a||{},n,o),i}const Sr="WEBGI_materials_bumpmap",Mr="WEBGI_materials_displacementmap",Tr="WEBGI_materials_alphamap",Dr="WEBGI_materials_lightmap";class Ir{constructor(e){this.parser=e,this.name=Sr}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.bumpScale&&(t.bumpScale=s.bumpScale),void 0!==s.bumpTexture&&i.push(n.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class Pr{constructor(e){this.parser=e,this.name=Mr}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.displacementScale&&(t.displacementScale=s.displacementScale),void 0!==s.displacementBias&&(t.displacementBias=s.displacementBias),void 0!==s.displacementTexture&&i.push(n.assignTexture(t,"displacementMap",s.displacementTexture)),Promise.all(i)}}class Rr{constructor(e){this.parser=e,this.name=Dr}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.lightMapIntensity&&(t.lightMapIntensity=s.lightMapIntensity),void 0!==s.lightMapTexture&&i.push(n.assignTexture(t,"lightMap",s.lightMapTexture)),Promise.all(i)}}class Br{constructor(e){this.parser=e,this.name=Tr}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return void 0!==s.alphaTexture&&i.push(n.assignTexture(t,"alphaMap",s.alphaTexture)),Promise.all(i)}}var kr=__webpackgi_require__(23);function Or(){return new _n(kr.Q,["drc"],!0)}class Lr extends n.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new n.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),tt(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this?.shadow,"mapSize"],onChange:()=>{this.shadow.map?.dispose(),this.shadow.mapPass?.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this?.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this?.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this?.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=Ne(tt({},t),!1),this.userData={},this.children=n,r.type="DirectionalLight2",r.target=this.target.position.toArray(),Object.assign(r,Ne(this,!0,e))}fromJSON(e,t){if("DirectionalLight2"!==e.type)return null;const n=e.target,r=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,je(e,this,!0,t),n&&(e.target=n),r&&(void 0!==r.color&&this.color.set(r.color),void 0!==r.intensity&&(this.intensity=r.intensity),e.object=r),this}}class Fr extends n.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,r,i,s){super(e,t,n,r,i,s),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),tt(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this?.shadow,"mapSize"],onChange:()=>{this.shadow.map?.dispose(),this.shadow.mapPass?.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this?.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this?.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=Ne(tt({},t),!1),this.userData={},this.children=n,r.type="SpotLight2",r.target=this.target.position.toArray(),Object.assign(r,Ne(this,!0,e))}fromJSON(e,t){return"SpotLight2"!==e.type?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.angle&&(this.angle=e.object.angle),void 0!==e.object.decay&&(this.decay=e.object.decay),void 0!==e.object.penumbra&&(this.penumbra=e.object.penumbra),je(e,this,!0,t),this):this)}}class Ur extends n.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,r){super(e,t,n,r),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),tt(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this?.shadow,"mapSize"],onChange:()=>{this.shadow.map?.dispose(),this.shadow.mapPass?.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this?.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this?.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=Ne(tt({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,Ne(this,!0,e))}fromJSON(e,t){return"PointLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.decay&&(this.decay=e.object.decay),je(e,this,!0,t),this):this}}class Nr extends n.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),tt(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=Ne(tt({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,Ne(this,!0,e))}fromJSON(e,t){return"AmbientLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),je(e,this,!0,t),this):this}}class jr extends n.aNw{load(e,t,r,i){const s=new n.hH6(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(e,(n=>{try{t(this.parse(n))}catch(t){i?i(t):console.error(t),this.manager.itemError(e)}}),r,i)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,r=null;const i=new n.Pa4(0,0,0),s=new n.Pa4(1,1,1),o=e.split(/[\n\r]+/g);let a=null,l=0;for(let e=0,n=o.length;e<n;e++){const n=o[e].trim(),c=n.split(/\s/g);switch(c[0]){case"TITLE":t=n.substring(7,n.length-1);break;case"LUT_3D_SIZE":const e=c[1];r=parseFloat(e),a=new Uint8Array(r*r*r*4);break;case"DOMAIN_MIN":i.x=parseFloat(c[1]),i.y=parseFloat(c[2]),i.z=parseFloat(c[3]);break;case"DOMAIN_MAX":s.x=parseFloat(c[1]),s.y=parseFloat(c[2]),s.z=parseFloat(c[3]);break;default:const o=parseFloat(c[0]),u=parseFloat(c[1]),h=parseFloat(c[2]);if(o>1||o<0||u>1||u<0||h>1||h<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");a[l+0]=255*o,a[l+1]=255*u,a[l+2]=255*h,a[l+3]=255,l+=4}}const c=new n.IEO;c.image.data=a,c.image.width=r,c.image.height=r*r,c.type=n.ywz,c.magFilter=n.wem,c.minFilter=n.wem,c.wrapS=n.uWy,c.wrapT=n.uWy,c.generateMipmaps=!1,c.needsUpdate=!0;const u=new n.JUT;return u.image.data=a,u.image.width=r,u.image.height=r,u.image.depth=r,u.type=n.ywz,u.magFilter=n.wem,u.minFilter=n.wem,u.wrapS=n.uWy,u.wrapT=n.uWy,u.wrapR=n.uWy,u.generateMipmaps=!1,u.needsUpdate=!0,{title:t,size:r,domainMin:i,domainMax:s,texture:c,texture3D:u}}}let zr=class{constructor({domainMax:e,domainMin:t,size:n,texture:r,texture3D:i,title:s}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=e,this.domainMin=t,this.size=n,this.texture=r,this.texture3D=i,this.title=s,this.uuid=f(),this.userData.__needsSourceBuffer=!0}fromJSON(e,t){return e.type!==this.type&&console.warn("type mismatch while import",e,this),console.error("not supported"),this}toJSON(e){return Ve(this,e,this.texture.name)}};zr=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([Ge("LUTCubeTextureWrapper")],zr);class Gr extends jr{parse(e){const t=super.parse(e);return new zr(t)}}var Vr={},Hr=Uint8Array,Qr=Uint16Array,Wr=Uint32Array,qr=new Hr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xr=new Hr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yr=new Hr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kr=function(e,t){for(var n=new Qr(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Wr(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},Jr=Kr(qr,2),Zr=Jr[0],$r=Jr[1];Zr[28]=258,$r[258]=28;for(var ei=Kr(Xr,0),ti=ei[0],ni=ei[1],ri=new Qr(32768),ii=0;ii<32768;++ii){var si=(43690&ii)>>>1|(21845&ii)<<1;si=(61680&(si=(52428&si)>>>2|(13107&si)<<2))>>>4|(3855&si)<<4,ri[ii]=((65280&si)>>>8|(255&si)<<8)>>>1}var oi=function(e,t,n){for(var r=e.length,i=0,s=new Qr(t);i<r;++i)++s[e[i]-1];var o,a=new Qr(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;if(n){o=new Qr(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[ri[h]>>>l]=c}else for(o=new Qr(r),i=0;i<r;++i)e[i]&&(o[i]=ri[a[e[i]-1]++]>>>15-e[i]);return o},ai=new Hr(288);for(ii=0;ii<144;++ii)ai[ii]=8;for(ii=144;ii<256;++ii)ai[ii]=9;for(ii=256;ii<280;++ii)ai[ii]=7;for(ii=280;ii<288;++ii)ai[ii]=8;var li=new Hr(32);for(ii=0;ii<32;++ii)li[ii]=5;var ci=oi(ai,9,0),ui=oi(ai,9,1),hi=oi(li,5,0),pi=oi(li,5,1),di=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},fi=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},mi=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},gi=function(e){return(e/8|0)+(7&e&&1)},_i=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Qr?Qr:e instanceof Wr?Wr:Hr)(n-t);return r.set(e.subarray(t,n)),r},vi=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Hr(0);var i=!t||n,s=!n||n.i;n||(n={}),t||(t=new Hr(3*r));var o=function(e){var n=t.length;if(e>n){var r=new Hr(Math.max(2*n,e));r.set(t),t=r}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,h=n.d,p=n.m,d=n.n,f=8*r;do{if(!u){n.f=a=fi(e,l,1);var m=fi(e,l+1,3);if(l+=3,!m){var g=e[(M=gi(l)+4)-4]|e[M-3]<<8,_=M+g;if(_>r){if(s)throw"unexpected EOF";break}i&&o(c+g),t.set(e.subarray(M,_),c),n.b=c+=g,n.p=l=8*_;continue}if(1==m)u=ui,h=pi,p=9,d=5;else{if(2!=m)throw"invalid block type";var v=fi(e,l,31)+257,y=fi(e,l+10,15)+4,b=v+fi(e,l+5,31)+1;l+=14;for(var A=new Hr(b),w=new Hr(19),x=0;x<y;++x)w[Yr[x]]=fi(e,l+3*x,7);l+=3*y;var E=di(w),C=(1<<E)-1,S=oi(w,E,1);for(x=0;x<b;){var M,T=S[fi(e,l,C)];if(l+=15&T,(M=T>>>4)<16)A[x++]=M;else{var D=0,I=0;for(16==M?(I=3+fi(e,l,3),l+=2,D=A[x-1]):17==M?(I=3+fi(e,l,7),l+=3):18==M&&(I=11+fi(e,l,127),l+=7);I--;)A[x++]=D}}var P=A.subarray(0,v),R=A.subarray(v);p=di(P),d=di(R),u=oi(P,p,1),h=oi(R,d,1)}if(l>f){if(s)throw"unexpected EOF";break}}i&&o(c+131072);for(var B=(1<<p)-1,k=(1<<d)-1,O=l;;O=l){var L=(D=u[mi(e,l)&B])>>>4;if((l+=15&D)>f){if(s)throw"unexpected EOF";break}if(!D)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){O=l,u=null;break}var F=L-254;if(L>264){var U=qr[x=L-257];F=fi(e,l,(1<<U)-1)+Zr[x],l+=U}var N=h[mi(e,l)&k],j=N>>>4;if(!N)throw"invalid distance";if(l+=15&N,R=ti[j],j>3&&(U=Xr[j],R+=mi(e,l)&(1<<U)-1,l+=U),l>f){if(s)throw"unexpected EOF";break}i&&o(c+131072);for(var z=c+F;c<z;c+=4)t[c]=t[c-R],t[c+1]=t[c+1-R],t[c+2]=t[c+2-R],t[c+3]=t[c+3-R];c=z}}n.l=u,n.p=O,n.b=c,u&&(a=1,n.m=p,n.d=h,n.n=d)}while(!a);return c==t.length?t:_i(t,0,c)},yi=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},bi=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},Ai=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,s=n.slice();if(!i)return[Ti,0];if(1==i){var o=new Hr(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var p=s[0].s;for(r=1;r<i;++r)s[r].s>p&&(p=s[r].s);var d=new Qr(p+1),f=wi(n[u-1],d,0);if(f>t){r=0;var m=0,g=f-t,_=1<<g;for(s.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));r<i;++r){var v=s[r].s;if(!(d[v]>t))break;m+=_-(1<<f-d[v]),d[v]=t}for(m>>>=g;m>0;){var y=s[r].s;d[y]<t?m-=1<<t-d[y]++-1:++r}for(;r>=0&&m;--r){var b=s[r].s;d[b]==t&&(--d[b],++m)}f=t}return[new Hr(d),f]},wi=function(e,t,n){return-1==e.s?Math.max(wi(e.l,t,n+1),wi(e.r,t,n+1)):t[e.s]=n},xi=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Qr(++t),r=0,i=e[0],s=1,o=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==i&&a!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=e[a]}return[n.subarray(0,r),t]},Ei=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Ci=function(e,t,n){var r=n.length,i=gi(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var s=0;s<r;++s)e[i+s+4]=n[s];return 8*(i+4+r)},Si=function(e,t,n,r,i,s,o,a,l,c,u){yi(t,u++,n),++i[256];for(var h=Ai(i,15),p=h[0],d=h[1],f=Ai(s,15),m=f[0],g=f[1],_=xi(p),v=_[0],y=_[1],b=xi(m),A=b[0],w=b[1],x=new Qr(19),E=0;E<v.length;++E)x[31&v[E]]++;for(E=0;E<A.length;++E)x[31&A[E]]++;for(var C=Ai(x,7),S=C[0],M=C[1],T=19;T>4&&!S[Yr[T-1]];--T);var D,I,P,R,B=c+5<<3,k=Ei(i,ai)+Ei(s,li)+o,O=Ei(i,p)+Ei(s,m)+o+14+3*T+Ei(x,S)+(2*x[16]+3*x[17]+7*x[18]);if(B<=k&&B<=O)return Ci(t,u,e.subarray(l,l+c));if(yi(t,u,1+(O<k)),u+=2,O<k){D=oi(p,d,0),I=p,P=oi(m,g,0),R=m;var L=oi(S,M,0);for(yi(t,u,y-257),yi(t,u+5,w-1),yi(t,u+10,T-4),u+=14,E=0;E<T;++E)yi(t,u+3*E,S[Yr[E]]);u+=3*T;for(var F=[v,A],U=0;U<2;++U){var N=F[U];for(E=0;E<N.length;++E){var j=31&N[E];yi(t,u,L[j]),u+=S[j],j>15&&(yi(t,u,N[E]>>>5&127),u+=N[E]>>>12)}}}else D=ci,I=ai,P=hi,R=li;for(E=0;E<a;++E)if(r[E]>255){j=r[E]>>>18&31,bi(t,u,D[j+257]),u+=I[j+257],j>7&&(yi(t,u,r[E]>>>23&31),u+=qr[j]);var z=31&r[E];bi(t,u,P[z]),u+=R[z],z>3&&(bi(t,u,r[E]>>>5&8191),u+=Xr[z])}else bi(t,u,D[r[E]]),u+=I[r[E]];return bi(t,u,D[256]),u+I[256]},Mi=new Wr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ti=new Hr(0),Di=function(e,t,n,r,i,s){var o=e.length,a=new Hr(r+o+5*(1+Math.ceil(o/7e3))+i),l=a.subarray(r,a.length-i),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?c=Ci(l,c,e.subarray(u,h)):(l[u]=s,c=Ci(l,c,e.subarray(u,o)))}else{for(var p=Mi[t-1],d=p>>>13,f=8191&p,m=(1<<n)-1,g=new Qr(32768),_=new Qr(m+1),v=Math.ceil(n/3),y=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},A=new Wr(25e3),w=new Qr(288),x=new Qr(32),E=0,C=0,S=(u=0,0),M=0,T=0;u<o;++u){var D=b(u),I=32767&u,P=_[D];if(g[I]=P,_[D]=I,M<=u){var R=o-u;if((E>7e3||S>24576)&&R>423){c=Si(e,l,0,A,w,x,C,S,T,u-T,c),S=E=C=0,T=u;for(var B=0;B<286;++B)w[B]=0;for(B=0;B<30;++B)x[B]=0}var k=2,O=0,L=f,F=I-P&32767;if(R>2&&D==b(u-F))for(var U=Math.min(d,R)-1,N=Math.min(32767,u),j=Math.min(258,R);F<=N&&--L&&I!=P;){if(e[u+k]==e[u+k-F]){for(var z=0;z<j&&e[u+z]==e[u+z-F];++z);if(z>k){if(k=z,O=F,z>U)break;var G=Math.min(F,z-2),V=0;for(B=0;B<G;++B){var H=u-F+B+32768&32767,Q=H-g[H]+32768&32767;Q>V&&(V=Q,P=H)}}}F+=(I=P)-(P=g[I])+32768&32767}if(O){A[S++]=268435456|$r[k]<<18|ni[O];var W=31&$r[k],q=31&ni[O];C+=qr[W]+Xr[q],++w[257+W],++x[q],M=u+k,++E}else A[S++]=e[u],++w[e[u]]}}c=Si(e,l,s,A,w,x,C,S,T,u-T,c),!s&&7&c&&(c=Ci(l,c+1,Ti))}return _i(a,0,r+gi(c)+i)},Ii=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),Pi=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=Ii[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},Ri=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)i+=r+=n[o];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},Bi=function(e,t,n,r,i){return Di(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},ki=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},Oi=function(e,t,n){for(var r=e(),i=e.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<r.length;++o){var a=r[o],l=s[o];if("function"==typeof a){t+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var h in t+=c,a.prototype)t+=";"+l+".prototype."+h+"="+a.prototype[h].toString();else t+=c}else n[l]=a}return[t,n]},Li=[],Fi=function(e,t,n,r){var i;if(!Li[n]){for(var s="",o={},a=e.length-1,l=0;l<a;++l)s=(i=Oi(e[l],s,o))[0],o=i[1];Li[n]=Oi(e[a],s,o)}var c=ki({},Li[n][1]);return function(e,t,n,r,i){var s=new Worker(Vr[t]||(Vr[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return s.onerror=function(e){return i(e.error,null)},s.onmessage=function(e){return i(null,e.data)},s.postMessage(n,r),s}(Li[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,c,function(e){var t=[];for(var n in e)(e[n]instanceof Hr||e[n]instanceof Qr||e[n]instanceof Wr)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(c),r)},Ui=function(){return[Hr,Qr,Wr,qr,Xr,Yr,Zr,ti,ui,pi,ri,oi,di,fi,mi,gi,_i,vi,ds,Hi,Qi]},Ni=function(){return[Hr,Qr,Wr,qr,Xr,Yr,$r,ni,ci,ai,hi,li,ri,Mi,Ti,oi,yi,bi,Ai,wi,xi,Ei,Ci,Si,gi,_i,Di,Bi,cs,Hi]},ji=function(){return[$i,ns,Zi,Pi,Ii]},zi=function(){return[es,ts]},Gi=function(){return[rs,Zi,Ri]},Vi=function(){return[is]},Hi=function(e){return postMessage(e,[e.buffer])},Qi=function(e){return e&&e.size&&new Hr(e.size)},Wi=function(e,t,n,r,i,s){var o=Fi(n,r,i,(function(e,t){o.terminate(),s(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},qi=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Xi=function(e,t,n,r,i){var s,o=Fi(e,r,i,(function(e,n){e?(o.terminate(),t.ondata.call(t,e)):(n[1]&&o.terminate(),t.ondata.call(t,e,n[0],n[1]))}));o.postMessage(n),t.push=function(e,n){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=n],[e.buffer])},t.terminate=function(){o.terminate()}},Yi=function(e,t){return e[t]|e[t+1]<<8},Ki=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Ji=function(e,t){return Ki(e,t)+4294967296*Ki(e,t+4)},Zi=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},$i=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Zi(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},es=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},ts=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},ns=function(e){return 10+(e.filename&&e.filename.length+1||0)},rs=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},is=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function ss(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var os=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(Bi(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),as=function(e,t){Xi([Ni,function(){return[qi,os]}],this,ss.call(this,e,t),(function(e){var t=new os(e.data);onmessage=qi(t)}),6)};function ls(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ni],(function(e){return Hi(cs(e.data[0],e.data[1]))}),0,n)}function cs(e,t){return Bi(e,t||{},0,0)}var us=function(){function e(e){this.s={},this.p=new Hr(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Hr(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=vi(this.p,this.o,this.s);this.ondata(_i(n,t,this.s.b),this.d),this.o=_i(n,this.s.b-32768),this.s.b=this.o.length,this.p=_i(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),hs=function(e){this.ondata=e,Xi([Ui,function(){return[qi,us]}],this,0,(function(){var e=new us;onmessage=qi(e)}),7)};function ps(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ui],(function(e){return Hi(ds(e.data[0],Qi(e.data[1])))}),1,n)}function ds(e,t){return vi(e,t)}var fs=function(){function e(e,t){this.c=Pi(),this.l=0,this.v=1,os.call(this,e,t)}return e.prototype.push=function(e,t){os.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Bi(e,this.o,this.v&&ns(this.o),t&&8,!t);this.v&&($i(n,this.o),this.v=0),t&&(Zi(n,n.length-8,this.c.d()),Zi(n,n.length-4,this.l)),this.ondata(n,t)},e}(),ms=function(e,t){Xi([Ni,ji,function(){return[qi,os,fs]}],this,ss.call(this,e,t),(function(e){var t=new fs(e.data);onmessage=qi(t)}),8)};function gs(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ni,ji,function(){return[_s]}],(function(e){return Hi(_s(e.data[0],e.data[1]))}),2,n)}function _s(e,t){t||(t={});var n=Pi(),r=e.length;n.p(e);var i=Bi(e,t,ns(t),8),s=i.length;return $i(i,t),Zi(i,s-8,n.d()),Zi(i,s-4,r),i}var vs=function(){function e(e){this.v=1,us.call(this,e)}return e.prototype.push=function(e,t){if(us.prototype.e.call(this,e),this.v){var n=this.p.length>3?es(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}us.prototype.c.call(this,t)},e}(),ys=function(e){this.ondata=e,Xi([Ui,zi,function(){return[qi,us,vs]}],this,0,(function(){var e=new vs;onmessage=qi(e)}),9)};function bs(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ui,zi,function(){return[As]}],(function(e){return Hi(As(e.data[0]))}),3,n)}function As(e,t){return vi(e.subarray(es(e),-8),t||new Hr(ts(e)))}var ws=function(){function e(e,t){this.c=Ri(),this.v=1,os.call(this,e,t)}return e.prototype.push=function(e,t){os.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=Bi(e,this.o,this.v&&2,t&&4,!t);this.v&&(rs(n,this.o),this.v=0),t&&Zi(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),xs=function(e,t){Xi([Ni,Gi,function(){return[qi,os,ws]}],this,ss.call(this,e,t),(function(e){var t=new ws(e.data);onmessage=qi(t)}),10)};function Es(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ni,Gi,function(){return[Cs]}],(function(e){return Hi(Cs(e.data[0],e.data[1]))}),4,n)}function Cs(e,t){t||(t={});var n=Ri();n.p(e);var r=Bi(e,t,2,4);return rs(r,t),Zi(r,r.length-4,n.d()),r}var Ss=function(){function e(e){this.v=1,us.call(this,e)}return e.prototype.push=function(e,t){if(us.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}us.prototype.c.call(this,t)},e}(),Ms=function(e){this.ondata=e,Xi([Ui,Vi,function(){return[qi,us,Ss]}],this,0,(function(){var e=new Ss;onmessage=qi(e)}),11)};function Ts(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Wi(e,t,[Ui,Vi,function(){return[Ds]}],(function(e){return Hi(Ds(e.data[0],Qi(e.data[1])))}),5,n)}function Ds(e,t){return vi((is(e),e.subarray(2,-4)),t)}var Is=function(){function e(e){this.G=vs,this.I=us,this.Z=Ss,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Hr(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,i=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(i):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,t),this.p=null}}},e}(),Ps=function(){function e(e){this.G=ys,this.I=hs,this.Z=Ms,this.ondata=e}return e.prototype.push=function(e,t){Is.prototype.push.call(this,e,t)},e}();function Rs(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?bs(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?ps(e,t,n):Ts(e,t,n)}function Bs(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?As(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?ds(e,t):Ds(e,t)}var ks=function(e,t,n,r){for(var i in e){var s=e[i],o=t+i;s instanceof Hr?n[o]=[s,r]:Array.isArray(s)?n[o]=[s[0],ki(r,s[1])]:ks(s,o+"/",n,r)}},Os="undefined"!=typeof TextEncoder&&new TextEncoder,Ls="undefined"!=typeof TextDecoder&&new TextDecoder,Fs=0;try{Ls.decode(Ti,{stream:!0}),Fs=1}catch(Hl){}var Us=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,_i(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},Ns=function(){function e(e){this.ondata=e,Fs?this.t=new TextDecoder:this.p=Ti}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Hr(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Us(n),i=r[0],s=r[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(i,t)}},e}(),js=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(zs(e),this.d=t||!1)},e}();function zs(e,t){if(t){for(var n=new Hr(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(Os)return Os.encode(e);var i=e.length,s=new Hr(e.length+(e.length>>1)),o=0,a=function(e){s[o++]=e};for(r=0;r<i;++r){if(o+5>s.length){var l=new Hr(o+8+(i-r<<1));l.set(s),s=l}var c=e.charCodeAt(r);c<128||t?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++r))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return _i(s,0,o)}function Gs(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Ls)return Ls.decode(e);var i=Us(e),s=i[0];if(i[1].length)throw"invalid utf-8 data";return s}var Vs=function(e){return 1==e?3:e<6?2:9==e?1:0},Hs=function(e,t){return t+30+Yi(e,t+26)+Yi(e,t+28)},Qs=function(e,t,n){var r=Yi(e,t+28),i=Gs(e.subarray(t+46,t+46+r),!(2048&Yi(e,t+8))),s=t+46+r,o=Ki(e,t+20),a=n&&4294967295==o?Ws(e,s):[o,Ki(e,t+24),Ki(e,t+42)],l=a[0],c=a[1],u=a[2];return[Yi(e,t+10),l,c,i,s+Yi(e,t+30)+Yi(e,t+32),u]},Ws=function(e,t){for(;1!=Yi(e,t);t+=4+Yi(e,t+2));return[Ji(e,t+12),Ji(e,t+4),Ji(e,t+20)]},qs=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},Xs=function(e,t,n,r,i,s,o,a){var l=r.length,c=n.extra,u=a&&a.length,h=qs(c);Zi(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==s&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var p=new Date(null==n.mtime?Date.now():n.mtime),d=p.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(Zi(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=s&&(Zi(e,t,n.crc),Zi(e,t+4,s),Zi(e,t+8,n.size)),Zi(e,t+12,l),Zi(e,t+14,h),t+=16,null!=o&&(Zi(e,t,u),Zi(e,t+6,n.attrs),Zi(e,t+10,o),t+=14),e.set(r,t),t+=l,h)for(var f in c){var m=c[f],g=m.length;Zi(e,t,+f),Zi(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(a,t),t+=u),t},Ys=function(e,t,n,r,i){Zi(e,t,101010256),Zi(e,t+8,n),Zi(e,t+10,n),Zi(e,t+12,r),Zi(e,t+16,i)},Ks=function(){function e(e){this.filename=e,this.c=Pi(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Js=function(){function e(e,t){var n=this;t||(t={}),Ks.call(this,e),this.d=new os(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=Vs(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Ks.prototype.push.call(this,e,t)},e}(),Zs=function(){function e(e,t){var n=this;t||(t={}),Ks.call(this,e),this.d=new as(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=Vs(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Ks.prototype.push.call(this,e,t)},e}(),$s=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=zs(e.filename),r=n.length,i=e.comment,s=i&&zs(i),o=r!=e.filename.length||s&&i.length!=s.length,a=r+qs(e.extra)+30;if(r>65535)throw"filename too long";var l=new Hr(a);Xs(l,0,e,n,o);var c=[l],u=function(){for(var e=0,n=c;e<n.length;e++){var r=n[e];t.ondata(null,r,!1)}c=[]},h=this.d;this.d=0;var p=this.u.length,d=ki(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[p+1];e?e.r():t.d=1}h=1}}),f=0;e.ondata=function(n,r,i){if(n)t.ondata(n,r,i),t.terminate();else if(f+=r.length,c.push(r),i){var s=new Hr(16);Zi(s,0,134695760),Zi(s,4,e.crc),Zi(s,8,f),Zi(s,12,e.size),c.push(s),d.c=f,d.b=a+f+16,d.crc=e.crc,d.size=e.size,h&&d.r(),h=1}else h&&u()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,r=0,i=this.u;r<i.length;r++)n+=46+(l=i[r]).f.length+qs(l.extra)+(l.o?l.o.length:0);for(var s=new Hr(n+22),o=0,a=this.u;o<a.length;o++){var l=a[o];Xs(s,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+qs(l.extra)+(l.o?l.o.length:0),t+=l.b}Ys(s,e,this.u.length,n,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function eo(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var r={};ks(e,"",r,t);var i=Object.keys(r),s=i.length,o=0,a=0,l=s,c=new Array(s),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},p=function(){var e=new Hr(a+22),t=o,r=a-o;a=0;for(var i=0;i<l;++i){var s=c[i];try{var u=s.c.length;Xs(e,a,s,s.f,s.u,u);var h=30+s.f.length+qs(s.extra),p=a+h;e.set(s.c,p),Xs(e,o,s,s.f,s.u,u,a,s.m),o+=16+h+(s.m?s.m.length:0),a=p+u}catch(e){return n(e,null)}}Ys(e,o,c.length,r,t),n(null,e)};s||p();for(var d=function(e){var t=i[e],l=r[t],d=l[0],f=l[1],m=Pi(),g=d.length;m.p(d);var _=zs(t),v=_.length,y=f.comment,b=y&&zs(y),A=b&&b.length,w=qs(f.extra),x=0==f.level?0:8,E=function(r,i){if(r)h(),n(r,null);else{var l=i.length;c[e]=ki(f,{size:g,crc:m.d(),c:i,f:_,m:b,u:v!=t.length||b&&y.length!=A,compression:x}),o+=30+v+w+l,a+=76+2*(v+w)+(A||0)+l,--s||p()}};if(v>65535&&E("filename too long",null),x)if(g<16e4)try{E(null,cs(d,f))}catch(e){E(e,null)}else u.push(ls(d,f,E));else E(null,d)},f=0;f<l;++f)d(f);return h}function to(e,t){t||(t={});var n={},r=[];ks(e,"",n,t);var i=0,s=0;for(var o in n){var a=n[o],l=a[0],c=a[1],u=0==c.level?0:8,h=(x=zs(o)).length,p=c.comment,d=p&&zs(p),f=d&&d.length,m=qs(c.extra);if(h>65535)throw"filename too long";var g=u?cs(l,c):l,_=g.length,v=Pi();v.p(l),r.push(ki(c,{size:l.length,crc:v.d(),c:g,f:x,m:d,u:h!=o.length||d&&p.length!=f,o:i,compression:u})),i+=30+h+m+_,s+=76+2*(h+m)+(f||0)+_}for(var y=new Hr(s+22),b=i,A=s-i,w=0;w<r.length;++w){var x=r[w];Xs(y,x.o,x,x.f,x.u,x.c.length);var E=30+x.f.length+qs(x.extra);y.set(x.c,x.o+E),Xs(y,i,x,x.f,x.u,x.c.length,x.o,x.m),i+=16+E+(x.m?x.m.length:0)}return Ys(y,i,r.length,A,b),y}var no=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),ro=function(){function e(){var e=this;this.i=new us((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),io=function(){function e(e,t){var n=this;t<32e4?this.i=new us((function(e,t){n.ondata(null,e,t)})):(this.i=new hs((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=_i(e,0)),this.i.push(e,t)},e.compression=8,e}(),so=function(){function e(e){this.onfile=e,this.k=[],this.o={0:no},this.p=Ti}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),i=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(i,!this.c):this.k[0].push(i),(e=e.subarray(r)).length)return this.push(e,t)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?e.length?((l=new Hr(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,u=this.c,h=u&&this.d,p=function(){var e,t=Ki(l,o);if(67324752==t){s=1,a=o,d.d=null,d.c=0;var r=Yi(l,o+6),i=Yi(l,o+8),h=2048&r,p=8&r,f=Yi(l,o+26),m=Yi(l,o+28);if(c>o+30+f+m){var g=[];d.k.unshift(g),s=2;var _,v=Ki(l,o+18),y=Ki(l,o+22),b=Gs(l.subarray(o+30,o+=30+f),!h);4294967295==v?(e=p?[-2]:Ws(l,o),v=e[0],y=e[1]):p&&(v=-1),o+=m,d.c=v;var A={name:b,compression:i,start:function(){if(!A.ondata)throw"no callback";if(v){var e=n.o[i];if(!e)throw"unknown compression type "+i;(_=v<0?new e(b):new e(b,v,y)).ondata=function(e,t,n){A.ondata(e,t,n)};for(var t=0,r=g;t<r.length;t++){var s=r[t];_.push(s,!1)}n.k[0]==g&&n.c?n.d=_:_.push(Ti,!0)}else A.ondata(null,Ti,!0)},terminate:function(){_&&_.terminate&&_.terminate()}};v>=0&&(A.size=v,A.originalSize=y),d.onfile(A)}return"break"}if(u){if(134695760==t)return a=o+=12+(-2==u&&8),s=3,d.c=0,"break";if(33639248==t)return a=o-=4,s=3,d.c=0,"break"}},d=this;o<c-4&&"break"!==p();++o);if(this.p=Ti,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==Ki(l,a-16)&&4)):l.subarray(0,o);h?h.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),t);this.p=l.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function oo(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],r=function(){for(var e=0;e<n.length;++e)n[e]()},i={},s=e.length-22;101010256!=Ki(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=Yi(e,s+8);o||t(null,{});var a=o,l=Ki(e,s+16),c=4294967295==l;if(c){if(s=Ki(e,s-12),101075792!=Ki(e,s))return void t("invalid zip file",null);a=o=Ki(e,s+32),l=Ki(e,s+48)}for(var u=function(s){var a=Qs(e,l,c),u=a[0],h=a[1],p=a[2],d=a[3],f=a[4],m=a[5],g=Hs(e,m);l=f;var _=function(e,n){e?(r(),t(e,null)):(i[d]=n,--o||t(null,i))};if(u)if(8==u){var v=e.subarray(g,g+h);if(h<32e4)try{_(null,ds(v,new Hr(p)))}catch(e){_(e,null)}else n.push(ps(v,{size:p},_))}else _("unknown compression type "+u,null);else _(null,_i(e,g,g+h))},h=0;h<a;++h)u();return r}function ao(e){for(var t={},n=e.length-22;101010256!=Ki(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=Yi(e,n+8);if(!r)return{};var i=Ki(e,n+16),s=4294967295==i;if(s){if(n=Ki(e,n-12),101075792!=Ki(e,n))throw"invalid zip file";r=Ki(e,n+32),i=Ki(e,n+48)}for(var o=0;o<r;++o){var a=Qs(e,i,s),l=a[0],c=a[1],u=a[2],h=a[3],p=a[4],d=a[5],f=Hs(e,d);if(i=p,l){if(8!=l)throw"unknown compression type "+l;t[h]=ds(e.subarray(f,f+c),new Hr(u))}else t[h]=_i(e,f,f+c)}return t}class lo extends n.hH6{load(e,t,n,r){return this.setResponseType("arraybuffer"),super.load(e,(e=>{const n=ao(new Uint8Array(e)),r=new Map(Object.entries(n).map((([e,t])=>[e,new File([t],e)])));t?.(r)}),n,r)}}class co extends t.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new bn,this._logger=console.log,this.Importers=[new _n(An,["json"],!1),new _n(n.hH6,["txt"],!1),new _n(mr,["rgbe.png","hdr.png","hdrpng"],!1),new _n(n.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new _n(Gr,["cube"],!1),new _n(lo,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new n.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(xn(e)),this.Importers.push(vr(e)),this.Importers.push(Or())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){let t=decodeURI(e);const n=this._rootContext?.rootUrl;t.includes("://")||!n||t.startsWith(n)||(t=n+t),t=t.replace("./",""),t=t.replace(/^(\/\/)/,"/"),t=t.replace(/\?.*$/,"");const r=this._fileDatabase.get(t);return r?r.ext?(r.objectUrl||(r.objectUrl=URL.createObjectURL(r)+"#"+t),r.objectUrl):(console.error("Unable to determine file extension",r),e):e}_createLoader(e){const t=this._getImporter(e),n=t?.ctor(this);return n&&t?.ext.forEach((e=>{const t=new RegExp(e.startsWith("data:")?"^"+e+"\\/":"\\."+e+"$","i");this._loadingManager.addHandler(t,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}addEventListener(e,t){if(super.addEventListener(e,t),"loaderCreate"===e)for(const e of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:e.loader})}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:r}=t;if(r&&r.length<1&&(r=void 0),0===e.size)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const i=[],s=[];if(e.forEach(((e,t)=>{this.registerFile(t,e);const n=e.ext;n&&(r?.includes(n.toLowerCase())??1)&&(this._isRootFileExtension(n)?i.push(t):s.push(t))})),i.length>0)for(const e of i){let r=await this._importFile(e,void 0,t);r&&(r=await this.processImported(r,t)),n.set(e,r)}else for(const e of s){let r=await this._importFile(e,void 0,t);r&&(r=await this.processImported(r,t)),n.set(e,r)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach(((e,t)=>{this.unregisterFile(t)})),n}registerFile(e,n){e=e.replace(/\?.*$/,"");const r=n?.ext??(0,t.parseFileExtension)(n?.name??e)?.toLowerCase();n&&(n.ext||(n.ext=r),this._fileDatabase.set(e,n));let i=this._getLoader(e);if(i||(i=this._createLoader(n??{name:e,ext:r})),i)for(const t of this._loaderCache)if(t.loader===i){t.files.push(e);break}return i}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t?.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return null!=this.Importers.find((t=>t.root&&t.ext.includes(e.toLowerCase())))}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,r={},i){if(t?.__imported)return t.__imported;let s;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const o=this.resolveURL(e),a=e.replace(/\?.*$/,""),l=r.fileHandler??(await this._loadingManager.getHandler(a)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0));if(!l)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:o,rootUrl:n.Zp0.extractUrlBase(e),baseUrl:n.Zp0.extractUrlBase(o)},s=await l.loadAsync(e+(r.queryString?(e.includes("?")?"&":"?")+r.queryString:""),(t=>{i&&i(t),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:t.loaded||void 0,totalBytes:t.total||void 0,progress:t.total>0?t.loaded/t.total:1})})),l.transform&&(s=await l.transform(s,r)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(n){return console.error("AssetImporter: Unable to import file",e,t),console.error(n),console.error(n?.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:n}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__imported=s;let e=[];Array.isArray(s)?e=s:s.userData?.rootSceneModelRoot?e.push(...s.children):e.push(s),e.forEach((e=>{e.addEventListener?.("dispose",(()=>{t.__imported=void 0}))}))}if(s&&"object"==typeof s){s.__rootPath=e;const n=t||this._fileDatabase.get(e);n&&(s.__rootBlob=n)}return s}_getImporter(e,t=!1){return this.Importers.find((n=>{if(t&&!n.root)return!1;const r=n.ext.find((t=>e.ext&&t===e.ext.toLowerCase()||e.name?.toLowerCase()?.endsWith("."+t.toLowerCase())||t?.startsWith("data:")&&e.name?.startsWith(t)));return!!r&&(e.ext=r,!0)}))}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,t={},n){if(!e)return[];if(!this._cachedAssets.includes(e)){if(1===Object.entries(e).length&&e.path){const t=this._cachedAssets.find((t=>t.path===e.path));t&&Object.assign(e,t)}const t=this._cachedAssets.findIndex((t=>t.path===e.path));t>=0&&this._cachedAssets.splice(t,1),this._cachedAssets.push(e)}let r;if(e?.preImported&&(r=await e.preImported),!t.forceImport&&r){const e=await this.processImported(r,t);let n=!1;for(const t of e){if(t.userData?.rootSceneModelRoot&&[...t.children,...t.__processedChildren||[]].find((e=>e.__disposed))){n=!0;break}if(t.__disposed){n=!0;break}}if(!n||!1===t.reimportDisposed)return e}if(e.preImported=this._importFile(t.pathOverride||e.path,"function"==typeof e.file?.arrayBuffer?e.file:void 0,t,n),r=await e.preImported,r&&(r=await this.processImported(r,t)),r){const t=[];Array.isArray(r)?t.push(...r):r.userData?.rootSceneModelRoot?t.push(...r.children):t.push(r),t.forEach((t=>t.addEventListener?.("dispose",(()=>{e?.preImported&&(e.preImported=void 0)}))))}return r}async importSingle(e,t={}){return"string"==typeof e?await this.importSinglePath(e,t):(await this.importAsset(e,t))?.[0]}async importSinglePath(e,t){return(await this.importPath(e,t))?.[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const r=JSON.stringify(n);let i;return i=this._cachedAssets.find((t=>t.path===e&&t._options===r))||{path:e},i._options=r,t.importedFile&&(i.file=t.importedFile),await this.importAsset(i,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){let r=e;if(!r)return[];if(!1===t.processImported)return[r];if(Array.isArray(r)){const e=[];for(const n of r)e.push(...await this.processImported(n,t));return e}if(r.userData?.rootSceneModelRoot){if(t._rootSceneImported=!0,r.__processedChildren&&!t.forceImporterReprocess)return r.__processedChildren;if(!(r.children.length<1))return r.animations&&(r.children[0].animations||(r.children[0].animations=[]),r.children[0].animations.push(...r.animations)),r.__importedViewerConfig&&(r.children[0].__importedViewerConfig=r.__importedViewerConfig),r.userData.__importData&&(r.children[0].userData.__importData=r.userData.__importData),r.__processedChildren=await this.processImported([...r.children],t),r.__processedChildren;if(r.animations?.length>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",r.animations),!r.__importedViewerConfig)return[];r=r.__importedViewerConfig}if(r.userData?.iModel&&(r=r.userData.iModel),r.userData?.iMaterial&&(r=r.userData.iMaterial),r.assetImporterProcessed&&!t.forceImporterReprocess)return[r];const i=r.__rootPath,s=r.__rootBlob;if(!r.assetType){if(r.isBufferGeometry&&(r=new n.Kj0(r,new n.Wid)),r.isObject3D)if(r.isLight)r=ho(r);else{const e=[];r.traverse((t=>{t!==r&&t.isLight&&e.push(t)}));for(const t of e)ho(t);r=new vn(r,t)}r.isTexture&&(r.assetType="texture",t._testDataTextureComplete&&(r.isDataTexture&&r.image?.data&&(r.image.complete=!0),r.image?.complete&&(r.needsUpdate=!0)),void 0!==t.generateMipmaps&&(r.generateMipmaps=t.generateMipmaps),r.generateMipmaps||r.isRenderTargetTexture||(r.minFilter=r.minFilter===n.D1R?n.wem:r.minFilter,r.magFilter=r.magFilter===n.D1R?n.wem:r.magFilter)),r.isMaterial&&(r.assetType="material")}if(null!=r.assetType)return r.userData&&(r.userData.rootPath||!i||i.startsWith("blob:")||i.startsWith("/")||(r.userData.rootPath=i),s&&(r.userData.__sourceBlob=s,r.userData.__needsSourceBuffer&&(r.userData.__sourceBuffer=await s.arrayBuffer(),delete r.userData.__needsSourceBuffer))),r=await this._processors.process(r.assetType,r,{}),r.assetImporterProcessed=!0,[r];if(r instanceof Map)return[...(await this.importFiles(r,t)).values()].flat();if(r.type&&"ViewerApp"!==r.type&&"ThreeViewer"!==r.type){const e=this._viewer.getPluginByType(r.type);if(e){let t=r._importedResources||{};return r.resources&&(t=await(this._viewer.getManager()?.importConfigResources(r.resources)),delete r.resources,r._importedResources=t),"function"==typeof e.fromJSON&&(await Promise.resolve(e.fromJSON(r,t)),r.assetImporterProcessed=!1),[]}}return r.plugins||"ViewerApp"===r.type||"ThreeViewer"===r.type?(r.resources=await(this._viewer.getManager()?.importConfigResources(r.resources)),await this._viewer.getManager().importViewerConfig(r),r.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",r,r.plugins),[r])}dispose(){this.clearCache(),this._processors?.dispose()}clearLoaderCache(){this._loaderCache.forEach((e=>{e.loader.dispose&&e.loader.dispose()})),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function uo(e){if(!e)return n.ywz;const t=e.extensions.has("EXT_color_buffer_half_float")||e.capabilities.isWebGL2&&e.extensions.has("EXT_color_buffer_float"),r=e.capabilities.isWebGL2||e.extensions.has("OES_texture_float")||e.extensions.has("WEBGL_color_buffer_float");return t?n.cLu:r?n.VzW:n.ywz}function ho(e){if(!e.isLight)return e;if("light"===e.assetType)return e;if(e.uiConfig)return console.warn("ui config already exists, not supported",e),e;let t;if(e.children.length,e.isDirectionalLight&&(t=new Lr),e.isAmbientLight&&(t=new Nr),e.isSpotLight&&(t=new Fr),e.isPointLight&&(t=new Ur),t){t.lightObject.copy?.(e);const n=e.parent;n?.isObject3D&&(n.remove(e),e.dispose(),e.userData.iModel=t,n.add(t.lightObject),t.uuid=e.uuid),Ke(t.lightObject,n)}else console.warn("unknown light type: ",e);return t}class po extends n.u7G{constructor(e){super(e)}async loadAsync(e,t){const r=new n.hH6(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t);try{const e=JSON.parse(i);if(e.images&&this.importer){const t={};let r=e.images;Array.isArray(r)||(r=Object.values(r));for(const r of e.images){if(!r.url||!r.uuid)continue;const e=(await this.importer.importPath(r.url,{processImported:!1}))?.[0],i=e?.source;if(!e||!i)continue;const s=new n.Hw6(i.data);s.uuid=r.uuid,t[s.uuid]=s,e.dispose()}return await gr.LoadRootPathTextures(e.textures,t||e.images,this.importer),this.parse(e,t)}return this.parse(e)}catch(t){throw console.error(t),this.manager.itemError(e),t}}parse(e,t){let n;const r={p:new Promise((e=>{n=e}))};if(e.images||e.textures){const i=new gr(this.manager);let s={};const o=e=>{n(),r.p=void 0,Object.values(s).forEach((e=>{e.isTexture&&e.image?.complete&&(e.needsUpdate=!0)}))};let a=e.images||[];Array.isArray(a)||(a=Object.values(a));const l=t||i.parseImages(a,o);let c=e.textures;Array.isArray(c)||(c=Object.values(c)),s=i.parseTextures2(c,l,o),this.setTextures(s)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const i={...e};if(Object.entries(i).forEach((([e,t])=>{t&&"string"==typeof t&&this.textures[t]&&(i[e]=this.textures[t])})),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.normalScale){const t=e.normalScale;!1===Array.isArray(t)&&(i.normalScale=[t,t])}let s=e.type;"MeshPhysicalMaterial"!==s&&"MeshStandardMaterial"!==s&&"PhysicalMaterial"!==s||(s=cn.TYPE),i.userData=je(i.userData,void 0,!1,this);const o=this.materials?.generateFromTemplateType(s,i)??super.parse(e);return this.setTextures({}),o.userData.imageLoadAwaiter=r,o}}class fo extends t.SimpleEventDispatcher{constructor(e,t,{simpleCache:r=!1,storage:i}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(r||i)&&(r&&(n.CtF.enabled=!0),i&&window.Cache&&"function"==typeof window.Cache&&i instanceof window.Cache)){const e={...n.CtF};n.CtF.get=(t,n,r)=>n?t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")?Promise.resolve(void 0):i.match(t).then((e=>{if(e)switch(n){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,r??"text/html")));case"json":return e.json();default:if(void 0===r)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(r),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})):e.get(t),n.CtF.add=async(t,n,r)=>{if(!r)return e.add(t,n);t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")||(await i.match(t)&&await i.delete(t),await i.put(t,new Response(n,{status:200})))},n.CtF.remove=(t,n)=>{if(!n)return e.remove(t);i.delete(t)}}this.storage=i,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map((e=>this._viewer?.scene.addSceneObject(e,t)))}async addAssetSingle(e,t={}){return e?(await("string"==typeof e?this.addFromPath:this.addAsset).call(this,e,t))?.[0]:void 0}async addImported(e,t={}){return this._importer?.processImported(e,t).then((e=>(this.addProcessedAssets(e,t),e)))}async addImportedSingle(e,t={}){return this.addImported(e,t).then((e=>e?.[0]))}_sceneUpdated(e){if("addSceneObject"===e.type){const t=e.object;"material"===t.assetType&&this._materials?.processMaterial(t,{})}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new gn,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new co(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(e,t)=>(yn(e,(e=>this._materials?.processModel(e,{recursive:!1}))),e)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(e,t)=>(this.materials?.findMaterial(e.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),e.uuid=f(),e.userData.uuid&&(e.userData.uuid=e.uuid)),this._materials.processMaterial(e,t))})),this._importer.Importers.push(new _n(po,[cn.TypeSlug],!1,(e=>(e&&(e.materials=this._materials),e&&(e.importer=this._importer),e))));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new _n(class extends An{async loadAsync(e,n){return t(await super.loadAsync(e,n))}},[fo.ViewerTypeSlug],!0))}onRemove(e){e===this._viewer&&(this._importer?.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),this._materials?.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){return this._viewer?.getPluginByType("AssetExporterPlugin")?.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,n){if(!this._viewer)return{};const r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...n},i=this._viewer.toJSON(r);return e||Object.values(r).forEach((e=>{e&&Object.values(e).forEach((e=>{e.url&&(e.url.data instanceof ArrayBuffer||Array.isArray(e.url.data))&&("Uint16Array"===e.url.type?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer)):"Uint8Array"===e.url.type?(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer)):e.url.data instanceof ArrayBuffer?e.url.data="data:application/octet-stream;base64,"+(0,t.arrayBufferToBase64)(e.url.data.buffer):console.warn("Unsupported buffer type",e.url.type))}))})),i.resources=r,i}exportPluginPresets(e){const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:this._viewer?.serializePlugins(t,e),resources:t}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){const n=e.type;if(!(t=t||this._viewer?.getPluginByType(n)))return void console.warn(`No plugin found for type ${n} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${n} does not support importing presets`);const r=e.resources||{};e.resources&&delete e.resources;const i=await this.importConfigResources(r);return await t.fromJSON(e,i),i&&(e.resources=i),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const e of Object.values(t.materials))e.__useCount?delete e.__useCount:this._materials?.unregisterMaterial(e);for(const e of Object.values(t.textures))e.__useCount&&delete e.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,n,r){if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const i={};Object.values(e).forEach((e=>{e&&Object.values(e).forEach((e=>{if(!e||!e.url)return;if("string"!=typeof e.url.data)return;const n=e.url.data.match(/^data:.*;base64,(.*)$/);n?.[1]?e.url.data=(0,t.base64ToArrayBuffer)(n?.[1]):("Uint8Array"!==e.url.type&&console.error("Unsupported buffer type string for ",e.url.type,"use base64"),e.url.data=(new TextEncoder).encode(e.url.data).buffer)}))})),n=n??new gr(this._importer.loadingManager),i.animations=e.animations?n.parseAnimations(e.animations):{},r&&r.animations&&(i.animations={...i.animations,...r.animations}),i.shapes=e.shapes?n.parseShapes(e.shapes):{},r&&r.shapes&&(i.shapes={...i.shapes,...r.shapes}),i.geometries=e.geometries?n.parseGeometries(e.geometries,i.shapes):{},r&&r.geometries&&(i.geometries={...i.geometries,...r.geometries}),i.images=e.images?await n.parseImagesAsync(Object.values(e.images)):{},r&&r.images&&(i.images={...i.images,...r.images}),await gr.LoadRootPathTextures(e.textures,i.images,this._importer),i.textures=e.textures?n.parseTextures2(Object.values(e.textures),i.images,(()=>{Object.values(i.textures).forEach((e=>{e.isTexture&&e.image?.complete&&(e.needsUpdate=!0)}))})):{};for(const e of Object.entries(i.textures))e[1]=(await this._importer.processImported(e[1],{}))?.[0],e[1]?i.textures[e[0]]=e[1]:delete i.textures[e[0]];r&&r.textures&&(i.textures={...i.textures,...r.textures});const s=e.materials?Object.values(e.materials):[];for(const e of s)Object.entries(e).forEach((([t,n])=>{n&&n.resource&&n.uuid&&"textures"===n.resource&&(e[t]=n.uuid)}));if(i.materials=n.parseMaterials2(s,i.textures,this._materials),r&&r.materials&&(i.materials={...i.materials,...r.materials}),e.object&&(i.object=n.parseObject(e.object,i.geometries,i.materials,i.textures,i.animations),e.skeletons&&(i.skeletons=n.parseSkeletons(e.skeletons,i.object),n.bindSkeletons(i.object,i.skeletons))),e.extras){i.extras=e.extras;for(const n of Object.values(e.extras))if(n.uuid&&n.url)if("string"==typeof n.url){const e=await(this._importer?.importPath(n.url));e?.length>0&&(i.extras[n.uuid]=e[0])}else if(n.url.data){const e=new File([(0,t.getTypedArray)(n.url.type,n.url.data)],n.url.path),r=await(this._importer?.importAsset({path:e.name,file:e}));r?.length>0&&(i.extras[n.uuid]=r[0])}else console.warn("invalid URL type while loading extra resource")}return r&&r.extras&&(i.extras={...i.extras,...r.extras}),i.__isLoadedResources=!0,i}}fo.PluginType="AssetManager",fo.ViewerTypeSlug="vjson";class mo{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e?.addEventListener("dragover",this._onDragover,!1),e?.addEventListener("drop",this._onDrop,!1),t?.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach((([e,t])=>t&&this.on(e,t)))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach((e=>e(t))),this}destroy(){const e=this._el,t=this._inputEl;e?.removeEventListener("dragover",this._onDragover),e?.removeEventListener("drop",this._onDrop),t?.removeEventListener("change",this._onSelect)}_onDrop(e){e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const t=Array.from(e.dataTransfer?.files||[]),n=Array.from(e.dataTransfer?.items||[]);if(0!==t.length||0!==n.length)if(n.length>0){const e=n.map((e=>e.webkitGetAsEntry()));this._loadNextEntry(new Map,e)}else this._emit("drop",{files:new Map(t.map((e=>(e.filePath=e.name,[e.filePath,e]))))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),n=new Map;t.forEach((e=>{e.filePath=e.webkitRelativePath||e.name,n.set(e.filePath,e)})),this._emit("drop",{files:n})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file((r=>{r.filePath=n.fullPath,e.set(n.fullPath,r),this._loadNextEntry(e,t)}),(()=>console.error("Could not load file: %s",n.fullPath)));else if(n.isDirectory){const r=n.createReader(),i=n=>{n.length?(t=t.concat(n),r.readEntries(i)):this._loadNextEntry(e,t)};r.readEntries(i)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class go extends t.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new n.Pa4(.5,.5,3)},this.dependencies=[fo],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new mo(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){if(!e)return;const t=this._viewer;if(!t)return;if(void 0!==this._allowedExtensions)for(const t of e.keys())this._allowedExtensions.includes(t.split(".").pop()?.toLowerCase()??"")||e.delete(t);if(e.size<1)return;const n=t.getPlugin(fo),r={type:"drop",files:e};if(this.importerParams.autoImport){const t={allowedExtensions:this.allowedExtensions,...this.importerParams};if(r.imported=await(n.importer?.importFiles(e,t)),this.importerParams.autoAdd){const e=[...r.imported?.values()??[]].flat(2).filter((e=>!!e))??[];if(r.assets=n.addProcessedAssets(e,{...this.importerParams}),!t._rootSceneImported)for(const e of r.assets)e.modelObject&&e.modelObject.dispatchEvent({type:"select",value:e.modelObject})}}this.dispatchEvent(r)}promptForFile(){this._inputEl?.click()}onRemove(e){this._dropzone?.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map((e=>"."+e)).join(", "):"")}}go.PluginType="Dropzone";var _o=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};function vo(e){return Object.getPrototypeOf(e).constructor.PluginType}class yo extends t.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:r=!1,useRgbm:i=!0,useGBufferDepth:s=!0,screenShader:o="",...a}){super(),this.console=console,this._state=e.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver((e=>this.resize())):void 0,this._lastSize=new n.FM8,this._onContextRestore=e=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=e=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===bo&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=e=>{if(!e||!e.object)return;const t=e.object.__importedViewerConfig||e.object.modelObject?.__importedViewerConfig;if(!t)return;const n=this.getManager();n?n.applyViewerConfig(t,t.resources):this.fromJSON(t,t.resources)},this.alert=async e=>alert(e),this.confirm=async e=>confirm(e),this.prompt=async(e,t,n=!0)=>prompt(e,t),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=o,this._canvas=a.canvas||(0,t.createCanvasElement)();let l=a.container;if(l&&!a.canvas&&l.appendChild(this._canvas),l||(l=this._canvas.parentElement??void 0),!l)throw new Error("No container.");this._container=l,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){const e=window.location.href,n="https://dev-sandbox.pixotronics.com/webgi/";if(!e.startsWith(n))return!0;if(null!==(0,t.getUrlQueryParam)("noUpdate"))return!0;const r=e.match(/\/webgi\/([0-9.a-zA-Z-]+)/)?.[1],i=(await(await fetch(n+"version.txt")).text()).split("\n")[0];if(r&&r!==i){if(confirm(`New version ${i} is available, do you want to open?`)){const e=window.location.href.replace(r,i);return window.location.href=e,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const c=new Rt(void 0,void 0,this._canvas);c.autoLookAtTarget=!0,this.addEventListener("postFrame",(()=>{const e=h.scene.activeCamera;if(e&&e.interactionsEnabled){const t=this.getPluginByType("Progressive")?.postFrameConvergedRecordingDelta();if(void 0!==t&&0===t)return;e.controls?.update()}})),this.scene=new kt(c),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Qe({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:r?4:0,colorSpace:i?F:n.aCh,type:i?n.ywz:n.cLu,depthBuffer:!s,generateMipmaps:!!r,minFilter:r?n.FDw:n.wem}}),this._isAntialiased=r&&this._renderer.isWebGL2;let u=!0;this._renderer.rendererObject.userData||(u=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!u;const h=this;this.renderFilter={passId:"render",passObject:new en(this,u),update(){const e=this.passObject;e.scene=h.scene.modelObject,e.camera=h.scene.activeCamera.cameraObject}};const p={passId:"screen",after:["render"],required:["render"],passObject:Ao(o)};[this.renderFilter,p].forEach((e=>this._renderer.registerPass(e))),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",(e=>this.setDirty(this.scene,e))),this.scene.addEventListener("sceneMaterialUpdate",(e=>this.setDirty(this.scene,e))),this.scene.addEventListener("sceneUpdate",(e=>{this.setDirty(this.scene,e),!1!==e.geometryChanged&&this.renderer.resetShadows()})),this.scene.addEventListener("update",(e=>this.setDirty(this.scene,e))),this._renderer.addEventListener("update",(e=>this.setDirty(this._renderer,e))),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",(()=>{this.scene.activeCamera.refreshAspect()})),this.scene.setBackgroundColor("#ffffff"),a.assetManager&&this.addPluginSync(new fo(void 0,void 0,"boolean"==typeof a.assetManager?{}:a.assetManager)),a.dropzone&&this.addPluginSync(new go),this.console.log("WebGi Viewer instance initialized, version: ",yo.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){for(const e of[...Object.values(this.plugins)])this.removePlugin(e,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),window.webGiViewers?.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let r=0;r<this.maxFramePerLoop;r++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const e=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const t=this._renderer.rendererObject.xr.getCamera()?.cameras[0]?.viewport;t?(0===t.x&&0===t.y||this.console.warn("x and y must be 0?"),e[0]=t.width,e[1]=t.height,this.console.log("resize for xr",e)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...e),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const r=Object.values(this.plugins).filter((e=>e.dirty));r.length>0&&this.setDirty(r),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const i=this._renderer.dirty;if(i){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(e){this.console.error(e),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!i)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return"string"==typeof e?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const r=this.getPlugin(e);if(r)return console.error(`Plugin of type ${vo(r)} already exists, no new plugin created`,r),r;n=new e(...t)}else n=e;const r=vo(n);if(!r)return this.console.error("PluginType is not defined for",n),n;for(const e of n.dependencies||[])await this.getOrAddPlugin(e);return this.plugins[r]&&(this.console.error(`Plugin of type ${r} already exists, old plugin will be removed and disposed`,this.plugins[r],n),await this.removePlugin(this.plugins[r],!0)),this.plugins[r]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const r=this.getPlugin(e);if(r)return console.error(`Plugin of type ${vo(r)} already exists, no new plugin created`,r),r;n=new e(...t)}else n=e;const r=vo(n);if(!r)return this.console.error("PluginType is not defined for",n),n;for(const e of n.dependencies||[])this.getOrAddPluginSync(e);return this.plugins[r]&&(this.console.error(`Plugin of type ${r} already exists, old plugin will be removed and disposed`,this.plugins[r],n),this.removePluginSync(this.plugins[r],!0)),this.plugins[r]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=vo(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=vo(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const t=e.userData.iCamera??new Rt(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return void 0===e.userData.autoLookAtTarget?(t.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):t.autoLookAtTarget=e.userData.autoLookAtTarget,t}setSize(e){this._canvas.style.width=e?.width?e.width+"px":"100%",this._canvas.style.height=e?.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise((n=>{const r=async(...i)=>{this.removeEventListener(e,r),n(await t(...i))};this.addEventListener(e,r)}))}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,null==e||"string"!=typeof e&&"number"!=typeof e&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===bo)return this.scene.setBackground("environment");!e||e?.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let t=this._rawBackground??this.scene.getBackground();return t?(t?.isVector4&&(t=nn(t,7).getHexString()),t?.isColor?t.getHexString():this._rawBackground===bo?this.scene.getEnvironment():t):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(fo)}resetCamera({rootObject:e,centerOffset:t=new n.Pa4(1,1,1),targetOffset:r=new n.Pa4(0,0,0),...i}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const i=e?(new v).expandByObject(e,!0,!0):this.scene.getBounds(!0),s=i.getCenter(new n.Pa4),o=.5*i.getSize(new n.Pa4).length();s.add(r.clone().multiplyScalar(o)),this.scene.activeCamera.position=new n.Pa4(s.x+t.x*o,s.y+t.y*o,s.z+t.z*o),this.scene.activeCamera.target=s,this.setDirty()}}async fitToView(e,t=1.5,n,r){const i=this.getPluginByType("CameraViews");i?await(i?.animateToFitObject(e,t,n,r,{min:(this.scene.activeCamera.getControls()?.minDistance??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){return this.getManager()?.addImportedSingle(e||new n.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){if(t?.isMaterial){const e=this.getManager()?.materials?.findMaterial(t.uuid);if(e)return e}return this.getManager()?.materials?.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map((n=>{if(!t||t.includes(n[1].constructor.PluginType))return!1!==n[1].serializeWithViewer?n[1].toJSON?.(e):void 0})).filter((e=>!!e))}deserializePlugins(e,t){return e.forEach((e=>{if(!e.type)return void this.console.warn("Invalid plugin to import ",e);const n=this.getPluginByType(e.type);n&&n.fromJSON?.(e,t)})),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:yo.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},Ne(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,"environment"===n.background&&(n.background="envMapBackground"),n}fromJSON(e,t){const r={...e};return void 0!==r.backgroundIntensity&&void 0===r.scene?.backgroundIntensity&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=r.backgroundIntensity,delete r.backgroundIntensity),void 0!==r.useLegacyLights&&void 0===r.renderManager?.useLegacyLights&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=r.useLegacyLights,delete r.useLegacyLights),void 0!==r.background&&void 0===r.scene?.background&&(this.console.warn("old file format, background moved to RootScene"),"envMapBackground"===r.background?r.background="environment":"number"==typeof r.background?r.background=(new xe).setHex(r.background,n.GUF):"string"==typeof r.background?r.background=(new xe).setStyle(r.background,n.GUF):r.background?.isColor&&(r.background=new xe(r.background)),r.background?.isColor?(this.scene.backgroundColor=r.background,this.scene.background=null):r.background?(this.scene.backgroundColor=new xe("#ffffff"),r.scene.background=r.background):(this.scene.backgroundColor=null,this.scene.background=null),delete r.background),je(r,this,!0,t),Array.isArray(r.plugins)&&this.deserializePlugins(r.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if("setView"===e.type){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else"activateMain"===e.type&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}yo.VERSION="0.8.7",_o([Oe("renderManager")],yo.prototype,"_renderer",void 0),_o([Oe()],yo.prototype,"scene",void 0),_o([(0,t.onChange)(yo.prototype._renderEnabledChanged)],yo.prototype,"renderEnabled",void 0);const bo="envMapBackground";function Ao(e){return e?.isShaderPass2?e:new Gt({...r,fragmentShader:`\n                       varying vec2 vUv;\n                       \n                       ${Array.isArray(e)?e[0]:e?.pars||""}\n                       \n                       void main() {\n\n                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                            \n                            ${Array.isArray(e)?e[1]:"string"==typeof e?e:e?.main||""}\n                            \n                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class wo extends Gt{constructor(e){super({vertexShader:r.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`\n                varying vec2 vUv;\n                ${e[0]}\n                void main() {\n                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                    #glMarker\n                    ${e[1]}\n                    \n                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha\n                }\n                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=n.Wl3}render(e,t,n,r,i){super.render(e,t,n,r,i),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,r){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,r)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class xo extends Yt{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[$t],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,this.pass.update?.(),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){return this._viewer?.screenShader?.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,t.safeSetProperty)(e.renderer.passes.find((e=>"screen"===e.passId)),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,t.safeSetProperty)(e.renderer.passes.find((e=>"screen"===e.passId)),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){const n=e.screenShader,r=["",""];this._renderToScreen&&!n.isShaderPass2&&(r[0]=Array.isArray(n)?n[0]:n?.pars||"",r[1]=Array.isArray(n)?n[1]:"string"==typeof n?n:n?.main||"");const i=new wo(r);return(0,t.safeSetProperty)(i.uiConfig?.children?.find((e=>"Enabled"===e?.label)),"hidden",!0,!0),i}_update(e){return!!super._update(e)&&(this._pass.passObject.updateShaderProperties(this._viewer?.getPlugin($t)),this._pass.passObject.material.uniforms.tTransparent.value=this._viewer?.renderFilter.passObject.transparentTarget?.texture||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){return this.pass?.passObject?.uiConfig??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}xo.PluginType="CombinedPostPlugin";var Eo=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Co extends qt{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[xo]}get uiConfig(){return this._extension?.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){await super.onAdded(e),this._extension=this.generateExtension(e),e.getPlugin(xo)?.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function So(e,t,n){return e&~(1<<t)|(n?1:0)<<t}function Mo(e,t){return e&~(1<<t)}Eo([Oe("extension")],Co.prototype,"_extension",void 0),Eo([Oe()],Co.prototype,"enabled",void 0);var To,Do=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const Io=n.dZ3;let Po=To=class{constructor(e,r=!0){this.depthTonemap=r,this.toneMapping=n.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            ${this.depthTonemap?Wt:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${"int getToneMapBit(in int number){\n#ifdef WebGL2Context\nreturn(number/2)%2;\n#else\nreturn int(mod(floor(float(number)/2.),2.));\n#endif\n}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;\n#if USE_DEPTH_TONEMAP > 0\nbool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));\n#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0\nbool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;\n#endif\nif(doTonemap){\n#endif\n#if defined( TONE_MAPPING )\noutColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);\n#endif\n#if USE_DEPTH_TONEMAP > 0\n}\n#if TRANSPARENT_BACKGROUND > 0\nif(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;\n#endif\nif(depth<0.00001)outColor.a=0.;\n#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0\noutColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);\n#endif\n#endif\nreturn outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(xo),this._setDirty=this._setDirty.bind(this),this.depthTonemap=r}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker","\ngl_FragColor = ToneMapping(gl_FragColor);\n",{prepend:!0}))}onObjectRender(e,t,r){if(!this.enabled)return;const{toneMapping:i,toneMappingExposure:s,outputColorSpace:o}=r;this._rendererState.toneMapping=i,this._rendererState.toneMappingExposure=s,this._rendererState.outputColorSpace=o;let a=this.tonemapBackground?"1":"0";t.materialObject.defines.TONEMAP_BACKGROUND!==a&&(t.materialObject.defines.TONEMAP_BACKGROUND=a,t.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",t.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(t.materialObject.defines.TRANSPARENT_BACKGROUND=a,t.materialObject.needsUpdate=!0),a=this.renderDepth?"1":"0",t.materialObject.defines.DEBUG_DEPTH!==a&&(t.materialObject.defines.DEBUG_DEPTH=a,t.materialObject.needsUpdate=!0),r.toneMapping=this.toneMapping,r.toneMappingExposure=this.exposure,r.outputColorSpace=n.KI_,t.materialObject.toneMapped=!0,t.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(e,t,n){n.toneMapping=this._rendererState.toneMapping,n.toneMappingExposure=this._rendererState.toneMappingExposure,n.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this.__setDirty?.(),this._setDirty()}};Po.PluginType="Tonemap",Do([mt("Mode",[["Linear",n.EoG],["Reinhard",n.CdI],["Cineon",n.YGz],["ACESFilmic",n.LY2],["Uncharted2",Io]].map((e=>({label:e[0],value:e[1]}))),{limitedUi:!0}),(0,t.onChange)(To.prototype._setDirty),Oe()],Po.prototype,"toneMapping",void 0),Do([(0,t.onChange)(To.prototype._setDirty),ht("Tonemap Background",{limitedUi:!0}),Oe()],Po.prototype,"tonemapBackground",void 0),Do([(0,t.onChange)(To.prototype._setDirty),ht("Clip Background"),Oe()],Po.prototype,"clipBackground",void 0),Do([(0,t.onChange)(To.prototype._setDirty),dt("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Oe()],Po.prototype,"exposure",void 0),Do([(0,t.onChange)(To.prototype._setDirty),dt("Saturation",[0,2],.01,{limitedUi:!0}),Oe()],Po.prototype,"saturation",void 0),Do([(0,t.onChange)(To.prototype._setDirty),dt("Contrast",[0,2],.01,{limitedUi:!0}),Oe()],Po.prototype,"contrast",void 0),Do([(0,t.onChange)(To.prototype._setDirty),ht("Render Depth")],Po.prototype,"renderDepth",void 0),Po=To=Do([wt("Tonemapping")],Po);class Ro extends Co{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){await super.onAdded(e),e.getPlugin($t)?.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Po(e,this.depthTonemap)}get exposure(){return this._extension?.exposure??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){return this._extension?.saturation??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){return this._extension?.contrast??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){return this._extension?.toneMapping??n.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){if(e instanceof n.Kj0&&e.material?.userData){const n=!1===e.material?.userData.postTonemap?0:1;t.w=So(t.w,1,n)}}}Ro.PluginType="Tonemap",n.WdD.tonemapping_pars_fragment=n.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }","\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }\n\n");var Bo,ko=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Oo=Bo=class{constructor(e){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(xo),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = chromaticAberration();\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(t.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this.__setDirty?.(),this._setDirty()}};Oo.PluginType="ChromaticAberration",ko([(0,t.onChange)(Bo.prototype._setDirty),ht("Enable"),Oe()],Oo.prototype,"enabled",void 0),ko([(0,t.onChange)(Bo.prototype._setDirty),dt("Intensity",[0,.1],.001,{limitedUi:!0}),Oe()],Oo.prototype,"aberrationIntensity",void 0),Oo=Bo=ko([wt("ChromaticAberration")],Oo);class Lo extends Co{constructor(){super()}generateExtension(e){return new Oo(e)}get intensity(){return this._extension?.aberrationIntensity??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Lo.PluginType="ChromaticAberration";class Fo extends qt{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map((t=>(t.passId||(console.warn("no id found for pass",t),t.passId=lt()),e.renderer.registerPass(t,!0),[t.passId,t]))))}async onRemove(e){if(this._passes){for(const t of[...Object.values(this._passes)]){const n=t;e.renderer.unregisterPass(n),n?.dispose?.()}this._passes=void 0}await super.onRemove(e)}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=Object.entries(this.passes);t.passes={};for(const[r,i]of n)t.passes[r]=Ne(i?.passObject??i,!1,e);return t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[r,i]of n)je(e.passes[r],i?.passObject??i,!1,t)}return this}}var Uo=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class No extends Gt{constructor(e,t,i="rgba"){super({vertexShader:r.vertexShader,fragmentShader:t+"uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;\n#pragma unroll_loop_start\nfor(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}\n#pragma unroll_loop_end\nfinal_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}",uniforms:{bilDirection:{value:new n.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new n.FM8}},defines:{B_SRC_ACCESSOR:i}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,r,i){this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(this.uniforms.tDiffuse.value?.image.width||0,this.uniforms.tDiffuse.value?.image.height||0),super.render(e,t,this._target,r,i),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(this.uniforms.tDiffuse.value?.image.width||0,this.uniforms.tDiffuse.value?.image.height||0),super.render(e,this._target,t,r,i))}}Uo([Oe(),Q()],No.prototype,"smoothEnabled",void 0),Uo([Oe(),Q()],No.prototype,"edgeSharpness",void 0);var jo="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",zo="#ifndef BASIC_RANDOM_HELPERS\n#define BASIC_RANDOM_HELPERS \nuniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}\n#endif\n",Go="#ifndef SIMPLE_CAMERA_HELPERS\n#define SIMPLE_CAMERA_HELPERS \n#ifndef USE_TRANSMISSION\nuniform mat4 projectionMatrix;\n#endif\nvec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}\n#endif\n",Vo=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Ho extends Gt{constructor(e,r,i){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new n.FM8(512,512)},saoData:{value:new n.Ltg},frameCount:{value:0},cameraNearFar:{value:new n.FM8(.1,1e3)},projection:{value:new n.yGw},saoBiasEpsilon:{value:new n.Pa4(1,1,1)}},vertexShader:jo,fragmentShader:`\n\n${zo}\n\n${i}\n\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){\n#ifdef WebGL2Context\nreturn(number/4)%2;\n#else\nreturn int(mod(floor(float(number)/4.),2.));\n#endif\n}float getViewZFromNDCZ(const in float depth){\n#if PERSPECTIVE_CAMERA == 1\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;\n#if DEPTH_PACKING_MODE == 2\nuncodedDepth=texture2D(tNormalDepth,uv);\n#else\nuncodedDepth=texture2D(tDepth,uv);\n#endif\n#if DEPTH_PACKING_MODE == 0\nreturn uncodedDepth.x;\n#elif DEPTH_PACKING_MODE == 1\n#if LINEAR_DEPTH == 1\nreturn pow2(unpackRGBAToDepth(uncodedDepth));\n#else\nreturn unpackRGBAToDepth(uncodedDepth);\n#endif\n#else\nreturn pow2(unpack16(uncodedDepth.xy));\n#endif\n}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);\n#else\nd=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);\n#endif\n}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(centerDepth);\n#else\nfloat centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);\n#endif\nvec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#if NUM_SAMPLES > 1\nsum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 2\nsum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 3\nsum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 4\nsum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 5\nsum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 6\nsum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 7\nsum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 8\nsum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 9\nsum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 10\nsum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\nfloat aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}\n\n            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(e,t,n)=>{e.defines.SSAO_ENABLED&&(e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>","#ifndef USE_TRANSMISSION\n#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0\nfloat ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);\n#endif\n#else\n#include <aomap_fragment>\n#endif\n#endif\n"))},onObjectRender:(e,t,n)=>{this.materialExtension.extraUniforms.tSSAOMap.value=this._target?.texture;const r=t.materialObject,i=!r.transparent&&r.transmission<.001;let s=this.enabled&&i&&!1!==n.userData.screenSpaceRendering&&!t.userData?.ssaoDisabled?1:0;r.defines.SSAO_ENABLED!==s&&(r.defines.SSAO_ENABLED=s,r.needsUpdate=!0),s=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==s&&(this.materialExtension.extraUniforms.tSSAOMap.value=s,r.needsUpdate=!0)},parsFragmentSnippet:e=>t.glsl`
             uniform sampler2D tSSAOMap;
             ${z("tSSAOMap",this._target?.texture,e.capabilities.isWebGL2)}
            ${Go}
        `,extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:e=>this.enabled?"1":"0"+this._target?.texture?.colorSpace,isCompatible:e=>!e.materialObject.userData?.ssaoDisabled&&e.isMeshStandardMaterial2},this._renderer=e,this._target=r,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new No(this._target,i,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,r,i){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,i),this._smoothEnabled&&this.bilateralPass.render(e,t,n,r,i))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Vo([Oe()],Ho.prototype,"bilateralPass",void 0),Vo([Oe()],Ho.prototype,"parameters",void 0);class Qo extends Fo{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[fo,$t],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Xt(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new Ho(e.renderer,this._aoTarget,e.getPlugin($t)?.getUnpackSnippet()??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin($t)])}},(()=>[e.getPlugin($t),e.scene.activeCamera,e.renderer]))]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){this._viewer?.setDirty()}get enabled(){return this.passes.ssao?.passObject?.enabled||!1}set enabled(e){this.passes.ssao?.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this,t=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[t,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[t.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[t.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[t.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[t.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[t.material?.defines,"NUM_SAMPLES"],onChange:[()=>t.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[t.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[t.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}Qo.PluginType="SSAO";var Wo,qo=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Xo=Wo=class extends Gt{constructor(){super({vertexShader:r.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new n.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:Wt+"\nuniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;\n#if PASS_STEP == 0\nuniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}\n#endif\nvec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){\n#ifdef WebGL2Context\nreturn(number/4)%2;\n#else\nreturn int(mod(floor(float(number)/4.),2.));\n#endif\n}void main(){\n#if PASS_STEP == 0 \nint doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 1 \ngl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 2 \ngl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;\n#elif PASS_STEP == 3 \nvec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;\n#elif PASS_STEP == 4 \nvec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;\n#endif\n#include <encodings_fragment>\n}"},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new n.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(e,t,r,i,s){const o=e.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=r;let l=.5,c=a.width*l,u=a.height*l;const h=[];let p=o.getTempTarget({sizeMultiplier:1,type:n.cLu});h.push(p);let d=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(e,p,d,i,s),d=p;let f=1;for(;f<this.bloomIterations&&(c/=2,u/=2,l/=2,!(u<2||c<2));f++){p=o.getTempTarget({sizeMultiplier:l,type:n.cLu}),h.push(p),this.material.defines.PASS_STEP=1;let t=this._weights[f];t=0!==this._weights[f-1]?this._weights[f]/this._weights[f-1]:this._weights[f],this.material.uniforms.weight.value=t,this.material.needsUpdate=!0,super.render(e,p,d,i,s),d=p}this.clear=!1;const m=e.autoClear;for(e.autoClear=!1,f-=2;f>=0;f--)p=h[f],h[f]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=n.WMw,this.material.needsUpdate=!0,e.autoClear=!1,super.render(e,p,d,i,s),this.material.blending=n.jFi,o.releaseTempTarget(d),d=p;this.clear=!0,e.autoClear=m,e.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(e,t,d,i,s)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(e,t,d,i,s),this.uniforms.tSource.value=null),o.releaseTempTarget(d)}_updateWeights(){if(!this._weights)return;const e=Math.max(Math.min(this.radius,1),0),t=1/(this.bloomIterations-1);for(let n=0;n<this.bloomIterations;n++){let r=n*t+.1,i=1.2-r;r=Math.pow(r,this.power),i=Math.pow(i,this.power),this._weights[n]=i*(1-e)+r*e}this.setDirty()}};function Yo(e){const t=e?.userData;return!!t&&(t[Ko.PluginType]||(t[Ko.PluginType]={}),t[Ko.PluginType].enable=!0,e.isMaterial&&(e.needsUpdate=!0),!0)}qo([Q()],Xo.prototype,"prefilter",void 0),qo([dt("Threshold",[0,2]),(0,t.onChange)(Wo.prototype._thresholdsUpdated),Oe()],Xo.prototype,"threshold",void 0),qo([dt("Soft Threshold",[0,1]),(0,t.onChange)(Wo.prototype._thresholdsUpdated),Oe()],Xo.prototype,"softThreshold",void 0),qo([dt("Intensity",[0,3]),Oe(),Q()],Xo.prototype,"intensity",void 0),qo([dt("Iterations",[0,7],1),(0,t.onChange)(Wo.prototype._updateWeights),Oe()],Xo.prototype,"bloomIterations",void 0),qo([dt("Radius",[0,1],.01),(0,t.onChange)(Wo.prototype._updateWeights),Oe()],Xo.prototype,"radius",void 0),qo([dt("Power",[.2,10],.01),(0,t.onChange)(Wo.prototype._updateWeights),Oe()],Xo.prototype,"power",void 0),qo([ht("Debug")],Xo.prototype,"bloomDebug",void 0),Xo=Wo=qo([wt("Bloom")],Xo);class Ko extends Yt{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:lt(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData[Ko.PluginType]?.enable??!0},set value(n){const r=e.materialObject.userData[Ko.PluginType];n!==r?.enable&&(r||Yo(e.materialObject),e.materialObject.userData[Ko.PluginType].enable=n,t.uiRefresh?.("postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new Xo;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){await super.onAdded(e),e.getPlugin($t)?.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){if(e instanceof n.Kj0&&e.material?.userData){const n=e.material?.userData[Ko.PluginType],r=!1===n?.enable?0:1;t.w=So(t.w,2,r)}}_update(e){return e.getPlugin($t)?.updateShaderProperties(this.pass?.passObject.material),super._update(e)}get uiConfig(){return this.pass?.passObject.uiConfig}}Ko.PluginType="Bloom";var Jo="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Zo=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const $o={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new n.FM8},cameraNearFar:{value:new n.FM8}},vertexShader:jo,fragmentShader:Wt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}\n#include <encodings_fragment>\n}"},ea=(zt({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8}},vertexShader:jo,fragmentShader:"#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);\n#include <encodings_fragment>\n}"},"colorTexture","cocTexture"),zt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:jo,fragmentShader:zo+"\n"+Jo+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));\n#ifdef DOF_MODE\nfloat blurDist=blurRadius*(2.*color.a-1.);\n#else\nfloat blurDist=blurRadius*color.a;\n#endif\nfloat rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));\n#ifdef DOF_MODE\nsampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;\n#endif\ncolorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}\n#pragma unroll_loop_end\ncolorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();\n#include <encodings_fragment>\n}",defines:{DOF_MODE:1}},"colorTexture"));class ta extends Gt{constructor(){super($o,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=ea,this.nearFarBlurScale=new n.FM8(.25,.25),this.focalDepthRange=new n.FM8(.5,1.5),this.crossCenter=new n.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new xe(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=zt({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:jo,fragmentShader:Wt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);\n#include <encodings_fragment>\n}"},"colorTexture"),this.expandCocMaterial=zt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new n.FM8},direction:{value:new n.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:jo,fragmentShader:Wt+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);\n#include <encodings_fragment>\n}"},"colorTexture")}render(e,t,r,i,s){if(!this.enabled)return;const o=e.baseRenderer,a={minFilter:n.TyD,magFilter:n.TyD,type:n.cLu,encoding:n.rnI,sizeMultiplier:.5,isAntialiased:!1,format:n.wk1,depthBuffer:!1,generateMipmaps:!1},l=o.getTempTarget(a),c=o.getTempTarget(a);if(this.computeCocMaterial.uniforms.colorTexture.value=r.texture,o.blit(void 0,l,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=l.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,c,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=c.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,l,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,o.blit(void 0,c,{material:this.dofBlurMaterial});else{const e=o.getTempTarget(a);this.dofBlurMaterial.uniforms.cocTexture.value=l.texture,this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,e,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=e.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,c,{material:this.dofBlurMaterial}),o.releaseTempTarget(e)}this.material.uniforms.blurTexture.value=c.texture,this.material.uniforms.cocTexture.value=l.texture,super.render(e,t,r,i,s),o.releaseTempTarget(l),o.releaseTempTarget(c)}}Zo([Oe(),Q()],ta.prototype,"nearFarBlurScale",void 0),Zo([Oe(),Q()],ta.prototype,"focalDepthRange",void 0),Zo([Q()],ta.prototype,"crossCenter",void 0),Zo([Q()],ta.prototype,"crossRadius",void 0),Zo([Q()],ta.prototype,"crossAlpha",void 0),Zo([Q()],ta.prototype,"crossColor",void 0);class na extends Gt{constructor(e){super({vertexShader:r.vertexShader,fragmentShader:t.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new n.Ltg(1,1,1,1)},weight2:{value:new n.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var ra=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const ia=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class sa extends Fo{constructor(e=2*ia.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=e=>{const t=e.object;(t.modelObject||t.lightObject)&&(t.modelObject||t.lightObject).traverse((e=>{e?.shadow?.camera&&e.shadow.mapSize&&this.trackedJitterCameras.add([e.shadow.camera,e.shadow.mapSize])}))},this._jitterCamera=e=>{const t=e.target;if(this.jitter&&t.renderer.frameCount>1){const e=(e,n)=>{const r={...ia[t.renderer.frameCount%ia.length]};e.setViewOffset(n.width,n.height,r.x,r.y,n.width,n.height)},n=t.scene.activeCamera.cameraObject;e(n,{width:t.canvas.clientWidth*t.renderer.displayCanvasScaling,height:t.canvas.clientHeight*t.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach((t=>e(...t))),this._hasSetOffset=!0,this._viewer?.renderer.resetShadows()}},this._resetCameraJitter=e=>{const t=e.target;this._hasSetOffset&&(t.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=At("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[Xt(e,{passId:"progressive",get dirty(){return t.jitter&&(t._viewer?.renderer.frameCount||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends na{render(n,r,i,s,o){if(e.renderer.frameCount<1)return this.needsSwap=!1,void(i?.texture&&e.renderer.blit(i.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,r,i,s,o),e.renderer.blit(r.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){return(this._viewer?.renderer.frameCount||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=this.lastFrame?.texture??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}sa.PluginType="Progressive",ra([Oe(),_t("Frame count")],sa.prototype,"maxFrameCount",void 0),ra([Oe(),ht("Jitter")],sa.prototype,"jitter",void 0);class oa extends Yt{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:n.wem,magFilter:n.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,t.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[sa],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>!1!==e.frameFade&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{!1!==e.frameFade&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{!1!==e.frameFade&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{const t=this._viewer?.canvas;if(!t)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==t)return void(this.pointerEnabled=!0);const n=t.getBoundingClientRect(),r=(e.clientX-n.left)/n.width,i=(e.clientY-n.top)/n.height;this.pointerEnabled=r<0||r>1||i<0||i>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const n=this,r=e.getPlugin(sa),i=new class extends na{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=At("Frame Fade",this)}render(i,s,o,a,l){this.needsSwap=!1;const c=n._target;if(!c||!n.pointerEnabled||!this.enabled||!n.dirty||n._fadeTimeState<.001)return;n._toSaveFrame&&r.lastFrame&&(e.renderer.blit(r.lastFrame.texture,c),this._lastTime=0,n._toSaveFrame=!1),this.blendTexture=c?.texture;const u=n._fadeTimeState/n._fadeTime;this.weights2.setScalar(u),this.weights2.w=1,this.weights1.setScalar(1-u),this.weights1.w=1,super.render(i,s,o,a,l),this.needsSwap=!0;const h=(0,t.now)();this._lastTime<10&&(this._lastTime=h-10);const p=h-this._lastTime;this._lastTime=h,n._fadeTimeState-=p}};return i.enabled=!0,i}setDirty(){this.enabled&&this._viewer?.setDirty()}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){return this.pass?.passObject?.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}oa.PluginType="FrameFade";var aa=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class la extends Yt{passCtor(e){return new ta}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[$t],this.enableEdit=!1,this._focalPointHit=new n.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new n.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,n=!0,r=!1){this._focalPointHit.copy(e),n&&this._viewer?.getPlugin(oa)?.startTransition(this._frameFadeTime),r&&(this._focalPointHitTime=(0,t.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){return this.pass?.passObject.focalDepthRange.y??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){return this.pass?.passObject.nearFarBlurScale.x??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){return this.pass?.passObject.nearFarBlurScale.y??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,this._viewer?.getPlugin(oa)?.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){await super.onAdded(e),e.getPluginByType("Picking")?.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){return e.getPluginByType("Picking")?.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){this._viewer?.setDirty()}_update(e){if(!super._update(e))return!1;const r=this.pass?.passObject;if(!r)return!1;const i=e.getPlugin($t);i?.updateShaderProperties(r.material),r.dofBlurMaterial.uniforms.frameCount&&e.renderer?.updateShaderProperties(r.dofBlurMaterial);const s=e.scene.activeCamera;if(!s)return!1;s.cameraObject.updateMatrixWorld(!0),s.updateShaderProperties(r.material),s.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),r.focalDepthRange.x=this._tempVec.length(),r.focalDepthRange.x*=s.cameraObject.getWorldDirection(new n.Pa4).dot(this._tempVec.normalize());let o=((0,t.now)()-this._focalPointHitTime)/this.crossFadeTime;if(o=1-Math.min(1,Math.max(0,o)),Math.abs(o-r.crossAlpha)>.01&&(r.crossAlpha=o,this.setDirty()),o>0){const e=this._tempVec.copy(this._focalPointHit).project(s.cameraObject).addScalar(1).divideScalar(2);r.crossCenter.set(e.x,e.y),r.computeCocMaterial.uniformsNeedUpdate=!0,r.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._pass?.passObject?.uiConfig;return e?(e.children?.map((e=>(0,t.getOrCall)(e)))?.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),e.children?.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}la.PluginType="DepthOfField",aa([Oe()],la.prototype,"enableEdit",void 0),aa([Oe("focalPoint")],la.prototype,"_focalPointHit",void 0),aa([Oe()],la.prototype,"crossFadeTime",void 0);var ca=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let ua=class extends qt{addThinFilmLayer(e){return ha(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new pa(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new n.Ltg},thinNoiseLayerFactors:{value:new n.Ltg},thinColorNoiseParams:{value:new n.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&t?.materialObject.userData._thinFilmLayer?.hasThinFilm?zo+"\n#ifndef VORONOISE_HELPER\n#define VORONOISE_HELPER \nfloat voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}\n#endif\n\n#ifndef HSV_HELPERS\n#define HSV_HELPERS \nvec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}\n#endif \n\nuniform vec4 thinBaseLayerFactors;\nuniform vec4 thinNoiseLayerFactors;\nuniform vec4 thinColorNoiseParams;\nuniform float thinFilmFactor;\n        ":"",shaderExtender:(e,t,n)=>{if(!this.enabled||!t.materialObject.userData._thinFilmLayer?.hasThinFilm)return;const r="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(r,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+r),e.defines.USE_UV=""},onObjectRender:(e,t)=>{const n=t.materialObject.userData?._thinFilmLayer;if(!n?.hasThinFilm)return;this._uniforms.thinBaseLayerFactors.value.fromArray(n.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(n.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(n.colorNoiseParams),this._uniforms.thinFilmFactor.value=n.filmFactor;const r=this.enabled?1:0;t.materialObject.defines.THIN_FILM_LAYER_ENABLED!==r&&(t.materialObject.defines.THIN_FILM_LAYER_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._thinFilmLayer?.hasThinFilm?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2||e.isDiamondMaterial,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._thinFilmLayer?.hasThinFilm||!1},set value(r){r!==e.materialObject.userData._thinFilmLayer?.hasThinFilm&&(r?ha(e.materialObject)||t.alert("Cannot add thin film."):e.materialObject.userData._thinFilmLayer&&(e.materialObject.userData._thinFilmLayer.hasThinFilm=!1,e.materialObject.needsUpdate=!0),n.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>!e.materialObject.userData._thinFilmLayer?.hasThinFilm,property:[e.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>!e.materialObject.userData._thinFilmLayer?.hasThinFilm,property:[e.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>!e.materialObject.userData._thinFilmLayer?.hasThinFilm,property:[e.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>!e.materialObject.userData._thinFilmLayer?.hasThinFilm,property:[e.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{this._viewer?.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(da)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function ha(e){const t=e?.userData;if(!t)return!1;t._thinFilmLayer||(t._thinFilmLayer={});const n=t._thinFilmLayer;return n.hasThinFilm=!0,void 0===n.baseLayerFactors&&(n.baseLayerFactors=[.3,.6,1,.9]),void 0===n.noiseLayerFactors&&(n.noiseLayerFactors=[.7,.5,.9,.7]),void 0===n.colorNoiseParams&&(n.colorNoiseParams=[.5,.5,.5,.7]),void 0===n.filmFactor&&(n.filmFactor=.3),e.isMaterial&&(e.needsUpdate=!0),!0}ua.PluginType="ThinFilmLayerPlugin",ua.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",ca([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],ua.prototype,"enabled",void 0),ua=ca([wt("ThinFilmLayer Materials")],ua);class pa{constructor(e){this.parser=e,this.name=ua.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),ha(t),t.userData._thinFilmLayer=je(r,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const da=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._thinFilmLayer)return;if(!t.userData._thinFilmLayer.hasThinFilm)return;n.extensions=n.extensions||{};const r=Ne(t.userData._thinFilmLayer,!1);n.extensions[ua.THIN_FILM_LAYER_GLTF_EXTENSION]=r,e.extensionsUsed[ua.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class fa{async apply(e,t,n){if(!t)return void(this.selected=void 0);let r=this.presets.find((e=>function(e,t){return("string"==typeof e?e:e.path)===("string"==typeof t?t:t.path)}(e,t)));return r||(this.presets.push(t),r=t),this.selected=r,"string"!=typeof r?e.getManager()?.importer?.importAsset(r,n):e.getManager()?.importer?.importPath(r,n)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class ma extends fa{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const r=await super.apply(e,t),i=r?.[0];return i&&(i.colorSpace=n.KI_,e.scene.background=i),i}}class ga extends fa{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),r=n?.[0];return r&&(e.scene.environment=r),r}}class _a extends fa{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,n){const r=await super.apply(e,n),i=r?.[0];return(0,t.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",i),i}}class va extends fa{async apply(e,t){const n=await super.apply(e,t,{processImported:!1});return n?e.getManager()?.importer?.processImported(n):void 0}}class ya extends va{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class ba extends qt{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map((e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map((e=>({label:Aa(e)?.split("/").pop()||"",value:Aa(e)})))],getValue:()=>Aa(e.selected)||"",setValue:t=>{e.apply(this._viewer,e.presets.find((e=>Aa(e)===t)))}}))),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,t.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,t.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){await super.onAdded(e),this.presetGroups.push(new ma),this.presetGroups.push(new ga),this.presetGroups.push(new _a),this.presetGroups.push(new va("Ground")),this.presetGroups.push(new va("CameraViews")),this.presetGroups.push(new va("MaterialConfiguration")),this.presetGroups.push(new ya),this.uiConfig.uiRefresh?.("postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map((e=>[e.name,Aa(e.selected)||void 0])).filter((([,e])=>e)));return e.type=ba.PluginType,e}async fromJSON(e,t){if(!super.fromJSON(e,t))return null;const n={...e};delete n.type;const r=[];for(const[e,t]of Object.entries(n)){const n=this.presetGroups.find((t=>t.name===e)),i=n?.presets;if(!n||!i)continue;const s="string"==typeof t?{path:t}:t;r.push(n.apply(this._viewer,s))}return await Promise.all(r),this.uiConfig.uiRefresh?.("postFrame",!0),this}async loadPresetGroups(e){"string"==typeof e&&e.startsWith("http")&&(e=await fetch(e).then((async e=>e.json())));for(const[t,n]of Object.entries(e)){const e=this.presetGroups.find((e=>e.name===t))?.presets;e?.push(...n)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map((e=>[e.name,e.presets.map(Aa)])).filter((([,e])=>e.length>0)))}}function Aa(e){return e&&"string"!=typeof e?e.path:e}ba.PluginType="PresetLibraryPlugin";var wa,xa=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Ea=wa=class{constructor(e){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=e.getPlugin(xo),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = grain(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(t.materialObject.uniforms.grainIntensity.value=this.grainIntensity,t.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this.__setDirty?.(),this._setDirty()}};xa([(0,t.onChange)(wa.prototype._setDirty),ht("Enable"),Oe()],Ea.prototype,"enabled",void 0),xa([(0,t.onChange)(wa.prototype._setDirty),ht("Multiply"),Oe()],Ea.prototype,"grainMultiply",void 0),xa([(0,t.onChange)(wa.prototype._setDirty),dt("Intensity",[0,20],.01,{limitedUi:!0}),Oe()],Ea.prototype,"grainIntensity",void 0),Ea=wa=xa([wt("FilmicGrain")],Ea);class Ca extends Co{constructor(){super()}generateExtension(e){return new Ea(e)}get intensity(){return this._extension?.grainIntensity??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){return this._extension?.grainMultiply??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}Ca.PluginType="FilmicGrain";class Sa extends t.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){this._scene?.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,r,i){super(),this.hoverEnabled=!1,this._scene=e,this._camera=r??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=i??(e=>!1!==e.userData.userSelectable&&!1!==e.userData.bboxVisible&&null!=e.material&&"ShadowMaterial"!==e.material.type),this.raycaster=new n.iMs,this.mouse=new n.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",(e=>this.onPointerMove(e))),this.domElement.addEventListener("pointerleave",(e=>this.onPointerLeave(e))),this.domElement.addEventListener("pointerout",(e=>this.onPointerLeave(e))),this.domElement.addEventListener("pointercancel",(e=>this.onPointerCancel(e))),this.domElement.addEventListener("pointerenter",(e=>this.onPointerEnter(e))),this.domElement.addEventListener("pointerdown",(e=>this.onPointerDown(e))),this.domElement.addEventListener("pointerup",(e=>this.onPointerUp(e)))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){1===this._selected.length&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,t.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){!1!==e.isPrimary&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=this.checkIntersection()?.intersects[0].object??null))}onPointerLeave(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(!1===e.isPrimary)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=t?.selectedObject||null}addPasses(){}checkIntersection(){const e=this._camera?.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let t=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const n=[],r=t.filter((e=>!n.includes(e.object.id)&&(n.push(e.object.id),!0)));t=r;let i,s=null;const o=[];for(const e of t){for(s=e.object,i=e;!(null==s||s.visible&&this.selectionCondition(s));)s=s.parent;null!=s&&o.push(e)}if(t=o,t.length>0){if(s=t[0].object,i=t[0],this._firstHit&&s.id!==this._firstHit.id)s=i.object;else for(let e=0;e<t.length;e++)if(this.selectedObject&&this.selectedObject.id===t[e].object.id){const n=e+1;if(!(n<t.length))return null;i=t[n],s=i.object}this._firstHit=t[0].object}return s&&i&&s?{selectedObject:s,intersect:i,intersects:t,mouse:this.mouse.toArray()}:null}isHovering(){return null!=this.hoverObject}isSelected(){return null!=this.selectedObject}}const Ma=new n.ZzF,Ta=new n.Pa4;class Da extends n.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new n.$TI(t,6,1);return this.setAttribute("instanceStart",new n.kB5(r,3,0)),this.setAttribute("instanceEnd",new n.kB5(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new n.$TI(t,6,1);return this.setAttribute("instanceColorStart",new n.kB5(r,3,0)),this.setAttribute("instanceColorEnd",new n.kB5(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new n.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new n.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Ma.setFromBufferAttribute(t),this.boundingBox.union(Ma))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new n.aLr),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,s=e.count;i<s;i++)Ta.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Ta)),Ta.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(Ta));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Ia extends Da{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new n.Uk6(e))}}n.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new n.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},n.Vj0.line={uniforms:n.rDY.merge([n.rBU.common,n.rBU.fog,n.rBU.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class Pa extends n.jyz{constructor(e){super({type:"LineMaterial",uniforms:n.rDY.clone(n.Vj0.line.uniforms),vertexShader:n.Vj0.line.vertexShader,fragmentShader:n.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const Ra=new n.Pa4,Ba=new n.Pa4;class ka extends n.Kj0{constructor(e=new Da,t=new Pa({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let e=0,n=0,s=t.count;e<s;e++,n+=2)Ra.fromBufferAttribute(t,e),Ba.fromBufferAttribute(r,e),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+Ra.distanceTo(Ba);const s=new n.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new n.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new n.kB5(s,1,1)),this}}class Oa extends n.ZAu{_updater(){const e=this._object;if(e){const t=(new v).expandByObject(e,!1);t.getCenter(this.position);const r=t.getBoundingSphere(new n.aLr).radius;this.scale.setScalar(r*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new Ia(e);this._geometry=t;const r=new Pa({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new n.FM8(1024,1024),dashed:!1,toneMapped:!1}),i=new ka(t,r);i.computeLineDistances(),i.scale.set(1,1,1),i.visible=!0,this.add(i)}setVisible(e){e!==this.visible&&(this.visible=e,this.setDirty?.({sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){return this._object?(this._object?.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class La extends Oa{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new n.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&((new v).expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const Fa=new n.iMs,Ua=new n.Pa4,Na=new n.Pa4,ja=new n._fP,za={X:new n.Pa4(1,0,0),Y:new n.Pa4(0,1,0),Z:new n.Pa4(0,0,1)},Ga={type:"change"},Va={type:"mouseDown"},Ha={type:"mouseUp",mode:null},Qa={type:"objectChange"};class Wa extends n.Tme{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new dl;this._gizmo=r,this.add(r);const i=new fl;this._plane=i,this.add(i);const s=this;function o(e,t){let n=t;Object.defineProperty(s,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,i[e]=t,r[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(Ga))}}),s[e]=t,i[e]=t,r[e]=t}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new n.Pa4,l=new n.Pa4,c=new n._fP,u=new n._fP,h=new n.Pa4,p=new n._fP,d=new n.Pa4,f=new n.Pa4,m=new n.Pa4,g=new n.Pa4;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",h),o("cameraQuaternion",p),o("pointStart",d),o("pointEnd",f),o("rotationAxis",m),o("rotationAngle",0),o("eye",g),this._offset=new n.Pa4,this._startNorm=new n.Pa4,this._endNorm=new n.Pa4,this._cameraScale=new n.Pa4,this._parentPosition=new n.Pa4,this._parentQuaternion=new n._fP,this._parentQuaternionInv=new n._fP,this._parentScale=new n.Pa4,this._worldScaleStart=new n.Pa4,this._worldQuaternionInv=new n._fP,this._worldScale=new n.Pa4,this._positionStart=new n.Pa4,this._quaternionStart=new n._fP,this._scaleStart=new n.Pa4,this._getPointer=qa.bind(this),this._onPointerDown=Ya.bind(this),this._onPointerHover=Xa.bind(this),this._onPointerMove=Ka.bind(this),this._onPointerUp=Ja.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;Fa.setFromCamera(e,this.camera);const t=Za(this._gizmo.picker[this.mode],Fa);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){Fa.setFromCamera(e,this.camera);const t=Za(this._plane,Fa,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Va.mode=this.mode,this.dispatchEvent(Va)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let i=this.space;if("scale"===n?i="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(i="world"),void 0===r||null===t||!1===this.dragging||-1!==e.button)return;Fa.setFromCamera(e,this.camera);const s=Za(this._plane,Fa,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===i&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===i&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===i&&(r.position.applyQuaternion(ja.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),"world"===i&&(r.parent&&r.position.add(Ua.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(Ua.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),Na.set(e,e,e)}else Ua.copy(this.pointStart),Na.copy(this.pointEnd),Ua.applyQuaternion(this._worldQuaternionInv),Na.applyQuaternion(this._worldQuaternionInv),Na.divide(Ua),-1===t.search("X")&&(Na.x=1),-1===t.search("Y")&&(Na.y=1),-1===t.search("Z")&&(Na.z=1);r.scale.copy(this._scaleStart).multiply(Na),this.scaleSnap&&(-1!==t.search("X")&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(Ua.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ua.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(za[t]),Ua.copy(za[t]),"local"===i&&Ua.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Ua.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===i&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(ja.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(ja.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ga),this.dispatchEvent(Qa)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(Ha.mode=this.mode,this.dispatchEvent(Ha)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ga),this.dispatchEvent(Qa),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Fa}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function qa(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function Xa(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function Ya(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function Ka(e){this.enabled&&this.pointerMove(this._getPointer(e))}function Ja(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function Za(e,t,n){const r=t.intersectObject(e,!0);for(let e=0;e<r.length;e++)if(r[e].object.visible||n)return r[e];return!1}const $a=new n.USm,el=new n.Pa4(0,1,0),tl=new n.Pa4(0,0,0),nl=new n.yGw,rl=new n._fP,il=new n._fP,sl=new n.Pa4,ol=new n.yGw,al=new n.Pa4(1,0,0),ll=new n.Pa4(0,1,0),cl=new n.Pa4(0,0,1),ul=new n.Pa4,hl=new n.Pa4,pl=new n.Pa4;class dl extends n.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new n.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new n.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const i=t.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const h=e.clone();h.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25,e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const f=new n.fHI(0,.04,.1,12);f.translate(0,.05,0);const m=new n.DvJ(.08,.08,.08);m.translate(0,.04,0);const g=new n.u9r;g.setAttribute("position",new n.a$l([0,0,0,1,0,0],3));const _=new n.fHI(.0075,.0075,.5,3);function v(e,t){const r=new n.XvJ(e,.0075,3,64,t*Math.PI*2);return r.rotateY(Math.PI/2),r.rotateX(Math.PI/2),r}_.translate(0,.25,0);const y={X:[[new n.Kj0(f,s),[.5,0,0],[0,0,-Math.PI/2]],[new n.Kj0(f,s),[-.5,0,0],[0,0,Math.PI/2]],[new n.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Kj0(f,o),[0,.5,0]],[new n.Kj0(f,o),[0,-.5,0],[Math.PI,0,0]],[new n.Kj0(_,o)]],Z:[[new n.Kj0(f,a),[0,0,.5],[Math.PI/2,0,0]],[new n.Kj0(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new n.Kj0(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.pQR(.1,0),h.clone()),[0,0,0]]],XY:[[new n.Kj0(new n.DvJ(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},b={X:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,.3,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.pQR(.2,0),r)]],XY:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new n.Kj0(new n.pQR(.01,2),i),null,null,null,"helper"]],END:[[new n.Kj0(new n.pQR(.01,2),i),null,null,null,"helper"]],DELTA:[[new n.x12(function(){const e=new n.u9r;return e.setAttribute("position",new n.a$l([0,0,0,1,1,1],3)),e}(),i),null,null,null,"helper"]],X:[[new n.x12(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.x12(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.x12(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},w={XYZE:[[new n.Kj0(v(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new n.Kj0(v(.5,.5),s)]],Y:[[new n.Kj0(v(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new n.Kj0(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new n.Kj0(v(.75,1),p),null,[0,Math.PI/2,0]]]},x={AXIS:[[new n.x12(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new n.Kj0(new n.xo$(.25,10,8),r)]],X:[[new n.Kj0(new n.XvJ(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n.Kj0(new n.XvJ(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n.Kj0(new n.XvJ(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n.Kj0(new n.XvJ(.75,.1,2,24),r)]]},C={X:[[new n.Kj0(m,s),[.5,0,0],[0,0,-Math.PI/2]],[new n.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]],[new n.Kj0(m,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(m,o),[0,.5,0]],[new n.Kj0(_,o)],[new n.Kj0(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n.Kj0(m,a),[0,0,.5],[Math.PI/2,0,0]],[new n.Kj0(_,a),[0,0,0],[Math.PI/2,0,0]],[new n.Kj0(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n.Kj0(new n.DvJ(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.DvJ(.1,.1,.1),h.clone())]]},S={X:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,.3,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new n.Kj0(new n.fHI(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Kj0(new n.DvJ(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Kj0(new n.DvJ(.2,.2,.2),r),[0,0,0]]]},M={X:[[new n.x12(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.x12(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.x12(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){const t=new n.Tme;for(const n in e)for(let r=e[n].length;r--;){const i=e[n][r][0].clone(),s=e[n][r][1],o=e[n][r][2],a=e[n][r][3],l=e[n][r][4];i.name=n,i.tag=l,s&&i.position.set(s[0],s[1],s[2]),o&&i.rotation.set(o[0],o[1],o[2]),a&&i.scale.set(a[0],a[1],a[2]),i.updateMatrix();const c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=T(y)),this.add(this.gizmo.rotate=T(w)),this.add(this.gizmo.scale=T(C)),this.add(this.picker.translate=T(b)),this.add(this.picker.rotate=T(E)),this.add(this.picker.scale=T(S)),this.add(this.helper.translate=T(A)),this.add(this.helper.rotate=T(x)),this.add(this.helper.scale=T(M)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:il;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let e=0;e<n.length;e++){const r=n[e];let i;if(r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(i*this.size/4),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,n=.2;"X"===r.name&&Math.abs(el.copy(al).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"===r.name&&Math.abs(el.copy(ll).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"===r.name&&Math.abs(el.copy(cl).applyQuaternion(t).dot(this.eye))>e&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs(el.copy(cl).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs(el.copy(al).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs(el.copy(ll).applyQuaternion(t).dot(this.eye))<n&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)}else"rotate"===this.mode&&(rl.copy(t),el.copy(this.eye).applyQuaternion(ja.copy(t).invert()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix(nl.lookAt(this.eye,tl,ll)),"X"===r.name&&(ja.setFromAxisAngle(al,Math.atan2(-el.y,el.z)),ja.multiplyQuaternions(rl,ja),r.quaternion.copy(ja)),"Y"===r.name&&(ja.setFromAxisAngle(ll,Math.atan2(el.x,el.z)),ja.multiplyQuaternions(rl,ja),r.quaternion.copy(ja)),"Z"===r.name&&(ja.setFromAxisAngle(cl,Math.atan2(el.y,el.x)),ja.multiplyQuaternions(rl,ja),r.quaternion.copy(ja)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some((function(e){return r.name===e})))&&(r.material.color.setHex(16776960),r.material.opacity=1)}else r.visible=!1,"AXIS"===r.name?(r.visible=!!this.axis,"X"===this.axis&&(ja.setFromEuler($a.set(0,0,0)),r.quaternion.copy(t).multiply(ja),Math.abs(el.copy(al).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&(ja.setFromEuler($a.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(ja),Math.abs(el.copy(ll).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&(ja.setFromEuler($a.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(ja),Math.abs(el.copy(cl).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&(ja.setFromEuler($a.set(0,Math.PI/2,0)),el.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(nl.lookAt(tl,el,ll)),r.quaternion.multiply(ja),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Ua.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ua.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Ua),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}super.updateMatrixWorld(e)}}class fl extends n.Kj0{constructor(){super(new n._12(1e5,1e5,2,2),new n.vBJ({visible:!1,wireframe:!0,side:n.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),ul.copy(al).applyQuaternion("local"===t?this.worldQuaternion:il),hl.copy(ll).applyQuaternion("local"===t?this.worldQuaternion:il),pl.copy(cl).applyQuaternion("local"===t?this.worldQuaternion:il),el.copy(hl),this.mode){case"translate":case"scale":switch(this.axis){case"X":el.copy(this.eye).cross(ul),sl.copy(ul).cross(el);break;case"Y":el.copy(this.eye).cross(hl),sl.copy(hl).cross(el);break;case"Z":el.copy(this.eye).cross(pl),sl.copy(pl).cross(el);break;case"XY":sl.copy(pl);break;case"YZ":sl.copy(ul);break;case"XZ":el.copy(pl),sl.copy(hl);break;case"XYZ":case"E":sl.set(0,0,0)}break;default:sl.set(0,0,0)}0===sl.length()?this.quaternion.copy(this.cameraQuaternion):(ol.lookAt(Ua.set(0,0,0),sl,el),this.quaternion.setFromRotationMatrix(ol)),super.updateMatrixWorld(e)}}class ml extends Wa{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace("local"===this.space?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(n.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(16===e.keyCode&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",(()=>{this?.object?.dispatchEvent({type:"objectUpdate",fadeFrame:!1})})),this.addEventListener("dragging-changed",(t=>{const n=e?.getPlugin(oa);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value})),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var gl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class _l extends qt{get picker(){return this._picker}setDirty(){this._viewer?.setDirty()}constructor(e=La,t=!1,n=!0,r=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=e=>{this._viewer&&(this.enabled?this.dispatchEvent(e):e.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const e=this.getSelectedObject();this.autoFocus&&e&&this.setSelectedObject(e,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=r}getSelectedObject(){if(this.enabled)return this._picker?.selectedObject||void 0}setSelectedObject(e,t=!1){if(!this.enabled)return;if(!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new Sa(e.scene,e.canvas,void 0,(e=>{if(!e.material)return!1;let t=e,n=!1;for(;t;){if(!t.visible)return!1;if("model"===(t.userData.iModel??t).assetType&&(n=!0),"widget"===(t.userData.iModel??t).assetType)return!1;if(!1===t.userData.userSelectable)return!1;if(!1===t.userData.bboxVisible)return!1;t=t.parent}return n})),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new ml(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",(t=>{this.dispatchEvent(t);const n=this._picker?.selectedObject||void 0;if(this._pickUi){const e=n?.uiConfig,t=this.uiConfig;t.children=[...this._uiConfigChildren],e&&t.children.push(e),t.uiRefresh?.()}const r=this._widget;r&&this._enableWidget&&(n?r.attach(n):r.detach());const i=this._transformControls;i&&this._viewer?.scene.activeCamera.controls&&(n&&i.enabled?i.attach(n):i.detach()),e.setDirty(),this.autoFocus&&this.focusObject(n)})),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",(e=>{void 0===e.value?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(e.value,this.autoFocus||e.focusCamera)})),e.scene.addEventListener("addSceneObject",(async t=>{const n=t.object,r=this.getSelectedObject();if(r&&"material"===n?.assetType&&"function"==typeof r?.setMaterial&&r?.modelObject?.isMesh&&await e.confirm("Applying material: Apply material to the selected object?")){const t=r.material;if(Array.isArray(t))console.warn("Dropping on material array not yet fully supported."),r.setMaterial(n);else{let i=Array.from(t?.userData.__appliedMeshes??[]);(i.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):i.length<1)&&(i=[r]);for(const e of i)e&&e.setMaterial?.(n)}}})),e.scene.addEventListener("sceneUpdate",(t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let r=!1;n?.traverseAncestors((t=>{t===e.scene.modelObject&&(r=!0)})),r||this.setSelectedObject(void 0)}))}async focusObject(e){const t=this._viewer?.getPluginByType("CameraViews");await(t?.animateToFitObject(e,1.25,1e3,"easeOut",{min:(this._viewer?.scene.activeCamera.getControls()?.minDistance??.5)+.5,max:50}))}enableWidget(e){if(this._enableWidget=e,e){const e=this._picker?.selectedObject||void 0;e&&this._widget?.attach(e)}else this._widget?.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}_l.PluginType="Picking",gl([Oe()],_l.prototype,"enabled",void 0),gl([Oe()],_l.prototype,"autoFocus",void 0);var vl,yl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let bl=vl=class extends qt{enableCustomBump(e,t,n){const r=e.materialObject?.userData;if(!r)return!1;if(void 0===r._hasCustomBump){const e=r.__appliedMeshes;let t=!0;if(e)for(const{geometry:n}of e)!n||n.attributes.position&&n.attributes.normal&&n.attributes.uv||(t=!1);if(!t)return!1}return r._hasCustomBump=!0,r._customBumpScale=n??r._customBumpScale??.001,r._customBumpMap=t??r._customBumpMap,e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Al(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new n.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&t?.materialObject.userData._hasCustomBump?"#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n#if CUSTOM_BUMP_MAP_BICUBIC > 0  \nvec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}\n#endif\nvarying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);\n#if CUSTOM_BUMP_MAP_BICUBIC > 0\nfloat Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#else\nfloat Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#endif\nreturn vec2(dBx,dBy);}\n#ifndef USE_BUMPMAP\nvec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n#endif\n#endif\n":"",shaderExtender:(e,t,n)=>{if(!this.enabled||!t.materialObject.userData._hasCustomBump)return;const r=t.materialObject.userData?._customBumpMap;r&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker beforeAccumulation","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );\n#endif\n                ",{prepend:!0}),e.vertexShader=Lt(e.vertexShader,"#include <uv_pars_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                varying vec2 vCustomBumpUv;\n                uniform mat3 customBumpUvTransform;\n#endif\n                ",{prepend:!0}),e.vertexShader=Lt(e.vertexShader,"#include <uv_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;\n#endif\n                ",{prepend:!0}),e.defines.USE_UV="")},onObjectRender:(e,t)=>{const n=t.materialObject.userData;if(!n?._hasCustomBump)return;const r=e;if(!r.isMesh||!r.geometry)return;const i=n._customBumpMap?.isTexture?n._customBumpMap:null;this._uniforms.customBumpMap.value=i,this._uniforms.customBumpScale.value=i?n._customBumpScale:0,i&&(i.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(i.matrix));let s=this.enabled&&i?1:0;t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==s&&(t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=s,t.materialObject.needsUpdate=!0),s=+this._defines.CUSTOM_BUMP_MAP_DEBUG,t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==s&&(t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=s,t.materialObject.needsUpdate=!0),s=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==s&&(t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=s,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._hasCustomBump?"1":"0")+e.materialObject.userData?._customBumpMap?.uuid,isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n=this.enableCustomBump,r={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._hasCustomBump||!1},set value(i){i!==e.materialObject.userData._hasCustomBump&&(i?n(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._hasCustomBump=!1,e.materialObject.needsUpdate=!0),r.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},Ce(e.materialObject.userData,"_customBumpMap")]};return r}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this.enableCustomBumpSelected=()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject()?.material;return"material"===e?.assetType&&this.enableCustomBump(e)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(wl)}async onRemove(e){e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate);const t=e.getPlugin(fo)?.exporter?.getExporter("gltf","glb")?.extensions?.indexOf(wl);return void 0!==t&&-1!==t&&e.getPlugin(fo)?.exporter?.getExporter("gltf","glb")?.extensions?.splice(t,1),super.onRemove(e)}};bl.PluginType="CustomBumpMapPlugin",bl.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",yl([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],bl.prototype,"enabled",void 0),yl([ht("Bicubic",(e=>({onChange:e.setDirty}))),W("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,vl.prototype.setDirty),Oe()],bl.prototype,"bicubicFiltering",void 0),yl([gt("Enable CustomBumpMap",(e=>({hidden:()=>!e._viewer?.getPlugin(_l)})))],bl.prototype,"enableCustomBumpSelected",void 0),bl=vl=yl([wt("CustomBumpMap Materials")],bl);class Al{constructor(e){this.parser=e,this.name=bl.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=o.customBumpScale??0;const a=o.customBumpMap;return a&&s.push(r.assignTexture(t.userData,"_customBumpMap",a).then((e=>{e.encoding=n.knz}))),Promise.all(s)}}const wl=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._hasCustomBump)return;if((t.userData._customBumpScale||0)<.001)return;n.extensions=n.extensions||{};const r={};if(r.customBumpScale=t.userData._customBumpScale||1,t.userData._customBumpMap){const n={index:e.processTexture(t.userData._customBumpMap)};e.applyTextureTransform(n,t.userData._customBumpMap),r.customBumpMap=n}n.extensions[bl.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=r,e.extensionsUsed[bl.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var xl,El=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Cl=xl=class extends qt{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(e){this._animationTime=Math.max(0,Math.min(e,this._animationDuration))}_wheel({deltaY:e}){this.enabled&&Math.abs(e)>.001&&(this._scrollAnimationState=-1*Math.sign(e))}_drag(e){this.enabled&&this._viewer&&("x"===this.dragAxis?this._dragAnimationState=e.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=e.delta.y*this._viewer.canvas.height/4)}_postFrame(){if(!this._viewer)return;const e=this._viewer,n=this.animateOnScroll,r=this.animateOnDrag;if(!this.enabled||this.animations.length<1||"playing"!==this._animationState&&!n&&!r)return this._lastFrameTime=0,void(this._fadeDisabled&&(this._viewer.getPluginByType("FrameFade")?.enable(xl.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const e=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/30);let i=e-this._lastFrameTime;if(i*=this.animationSpeed,this._lastFrameTime=e,n&&r?i*=(0,t.absMax)(this._scrollAnimationState,this._dragAnimationState):n?i*=this._scrollAnimationState:r&&(i*=this._dragAnimationState),Math.abs(i)<1e-4)return;const s=this._viewer.getPluginByType("Progressive")?.postFrameConvergedRecordingDelta();if(s&&s>0&&(i=s),0===s)return;const o=Math.abs(this.timeScale);this._animationTime+=i*(o>0?o:1)}const i=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const s=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map((e=>{e.mixer.setTime(s)})),!(Math.abs(i)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:i,time:s}),e.scene.activeCamera.cameraObject.userData.__animatingCamera&&e.scene.activeCamera.setDirty(),e.scene.refreshActiveCameraNearFar(),e.renderer.resetShadows(),e.setDirty(),!this._fadeDisabled){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(xl.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[fo],this._pointerDragHelper=new t.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=e=>{const t=e.object;if("model"!==t.assetType||!t.modelObject)return;if(!this._viewer)return;let r=!1;t.modelObject.traverse((e=>{const t=e.animations;if(t.length<1)return;const i=Math.max(...t.map((e=>e.duration))),s=new n.Xcj(this._viewer.scene.modelRoot.modelObject),o=t.map((e=>s.clipAction(e).setLoop(this.loopAnimations?n.YKA:n.jAl,this.loopRepetitions)));o.forEach((e=>e.clampWhenFinished=!0)),this.animations.push({mixer:s,clips:t,actions:o,duration:i}),r=!0})),r&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Sl(e,this)))}async onAdded(e){e.getPlugin(fo)?.importer?.addEventListener("loaderCreate",this._loaderCreate),e.scene.addEventListener("addSceneObject",this._objectAdded),e.getPlugin(fo)?.exporter?.getExporter("gltf","glb")?.extensions?.push(Ml),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=e.canvas;let t=-1;return Object.defineProperty(e.scene.modelRoot,"currentTimelineMarker",{get:()=>t,set:n=>e.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[t=n]})}),e.scene.modelRoot.addEventListener("animationTimelineMarker",(({marker:e})=>{if(!this._viewer)return;if(!e)return this._viewer.scene.activeCamera=this._viewer?.scene.defaultCamera,void this._viewer.setDirty();const t=e.camera;t&&(t.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(t))})),super.onAdded(e)}async onRemove(e){for(;this.animations.length;)this.animations.pop();return e.scene.removeEventListener("addSceneObject",this._objectAdded),e.getPlugin(fo)?.importer?.addEventListener("loaderCreate",this._loaderCreate),e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(e)}_onPropertyChange(e=!0){this._animationDuration=Math.max(...this.animations.map((({duration:e})=>e)))*(this.loopAnimations?this.loopRepetitions:1),"playing"===this._animationState&&e&&this.playAnimation()}onStateChange(){this.uiConfig?.children?.map((e=>e&&(0,t.getOrCall)(e))).flat(2).forEach((e=>e?.uiRefresh?.()))}playPauseAnimation(){"playing"===this._animationState?this.pauseAnimation():this.playAnimation()}async playClip(e,t=!1){return this.playClips([e],t)}async playClips(e,t=!1){const n=[];return this.animations.forEach((({actions:t})=>{t.forEach((t=>{e.includes(t.getClip().name)&&n.push(t)}))})),this.playAnimation(t,n)}async playAnimation(e=!1,t){if(!this.enabled)return;let r=!1;"playing"===this._animationState&&(this.stopAnimation(!1),r=!0);let i=0;const s=!t;t||(t=[],this.animations.forEach((({mixer:e,actions:n,clips:r})=>{t.push(...n)}))),r?this.resetAnimation():"paused"!==this.animationState&&(t.forEach((e=>{e.reset()})),this._animationTime=0);const o=lt();this._lastAnimId=o;for(const e of t)e.setLoop(this.loopAnimations?n.YKA:n.jAl,this.loopRepetitions),e.play(),i=Math.max(i,e.getClip().duration/Math.abs(e.timeScale));if(this._animationState="playing",this._viewer?.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise(((e,t)=>{const n=()=>{this.removeEventListener("checkpointEnd",n),e()};this.addEventListener("checkpointEnd",n)}))}else{const e=this.loopAnimations?this.loopRepetitions:1;if(i*=e,!isFinite(i))return;await new Promise(((e,t)=>{const n=t=>{t.time>=i&&(this.removeEventListener("animationStep",n),e())};this.addEventListener("animationStep",n)}))}o===this._lastAnimId&&this.stopAnimation(e)}pauseAnimation(){"playing"===this._animationState?(this._animationState="paused",this._viewer?.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){"paused"===this._animationState?(this._animationState="playing",this._viewer?.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(e=!1){this._animationState="stopped",e?this.resetAnimation():this._viewer?.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&(this._viewer.getPluginByType("FrameFade")?.enable(xl.PluginType),this._fadeDisabled=!1)}resetAnimation(){"stopped"===this._animationState||"none"===this._animationState?(this.animations.forEach((({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)})),this._animationTime=0,this._viewer?.setDirty()):this.stopAnimation(!0)}};Cl.PluginType="GLTFAnimation",Cl.AnimationMarkersExtension="WEBGI_animation_markers",El([Oe()],Cl.prototype,"autoIncrementTime",void 0),El([pt()],Cl.prototype,"animationState",null),El([pt()],Cl.prototype,"animationTime",null),El([pt()],Cl.prototype,"animationDuration",null),El([(0,t.onChange2)(xl.prototype._onPropertyChange),ht("Loop",{limitedUi:!0}),Oe()],Cl.prototype,"loopAnimations",void 0),El([(0,t.onChange2)(xl.prototype._onPropertyChange),Oe()],Cl.prototype,"loopRepetitions",void 0),El([dt("Timescale",[-2,2],.01),Oe()],Cl.prototype,"timeScale",void 0),El([dt("Speed",[.1,4],.1,{limitedUi:!0}),Oe()],Cl.prototype,"animationSpeed",void 0),El([ht(),Oe()],Cl.prototype,"animateOnScroll",void 0),El([ht(),Oe()],Cl.prototype,"animateOnDrag",void 0),El([mt("Drag Axis",[{label:"x"},{label:"y"}]),Oe()],Cl.prototype,"dragAxis",void 0),El([ht(),Oe()],Cl.prototype,"autoplayOnLoad",void 0),El([(0,t.onChange)(xl.prototype.onStateChange)],Cl.prototype,"_animationState",void 0),El([gt("Play/Pause",(e=>({label:()=>"playing"===e.animationState?"Pause":"Play",limitedUi:!0})))],Cl.prototype,"playPauseAnimation",null),El([gt("Stop",{limitedUi:!0})],Cl.prototype,"stopAnimation",null),El([gt("Reset",{limitedUi:!0})],Cl.prototype,"resetAnimation",null),Cl=xl=El([wt("GLTF Animations")],Cl);class Sl{constructor(e,t){this.parser=e,this.name=Cl.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){let t=[];for(const e of this.parser.json.scenes||[]){if(!e.extensions)continue;const n=e.extensions[this.name];for(const e of n?.markers||[]){const n=void 0!==e.camera?await this.parser.getDependency("camera",e.camera):void 0;if(void 0===e.time){const t=30;e.time=e.frame/t,console.error("Update timeline markers plugin for correct times.")}t.push({name:e.name,frame:e.frame,time:e.time,camera:n})}}if(t.length<1)return;t=t.sort(((e,t)=>e.frame-t.frame));const r=e.scene??e.scenes[0];if(!r)return;r.userData.__markers=t;const i=this.plugin.timelineMarkers,s=t.map((e=>e.time));let o=i.length;const a=t.map((e=>o++)),l=Math.max(...s)+.01;i.push(...t);const c=new n.dUE(".currentTimelineMarker",s,a,2300),u=new n.m7l("animationTimelineMarker",l,[c]);u.__gltfExport=!1,e.animations.push(u)}}const Ml=e=>({afterParse(t){const n=e.json.scenes[e.json.scene||0];n.extensions=n.extensions||{};const r={markers:[]},i=[];if((Array.isArray(t)?t:[t]).forEach((e=>e.traverse((e=>{e.userData.__markers&&i.push(...e.userData.__markers)})))),i.sort(((e,t)=>e.frame-t.frame)),!(i.length<1)){for(const t of i){const n=t.camera;if(n){const i=e.nodeMap.get(n);if(void 0===i){console.warn("Camera not found in gltf export",n,e.nodeMap);continue}const s=e.json.nodes[i].camera;t.camera=s,r.markers.push(t)}}n.extensions[Cl.AnimationMarkersExtension]=r,e.extensionsUsed[Cl.AnimationMarkersExtension]=!0}}});var Tl="#ifndef BASIC_CAMERA_HELPERS\n#define BASIC_CAMERA_HELPERS \nuniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;\n#ifndef THREE_PACKING_INCLUDED\n#define THREE_PACKING_INCLUDED \n#include <packing>\n#endif\nfloat linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}\n#endif\n",Dl="#define PI  3.141592653589793\nmat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}",Il="#ifndef SSRT_PARS_SNIP\n#define SSRT_PARS_SNIP \n#define pow2(a)a*a\nfloat getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}\n#define LOD_DEPTH  1.0\n#define LOD_COLOR  5.0\nvoid _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;\n#pragma unroll_loop_start\nfor(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}\n#pragma unroll_loop_end\n}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}\n#endif\n",Pl="#ifndef BASIC_HELPERS\n#define BASIC_HELPERS \nfloat saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}\n#endif\n",Rl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Bl extends Gt{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,r,i,s=!1){super({vertexShader:jo,fragmentShader:`\n\n${Pl}\n${Tl}\n${zo}\n${Dl}\n${i}\n\n${Il}\n\nvarying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);\n#endif\nreturn vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!s},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new n.yGw},screenSize:{value:new n.FM8},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:s?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=this._target?.texture;const r=t.materialObject;let i=this.material.defines.SSGI_ENABLED;r.defines.SSGI_ENABLED!==i&&(r.defines.SSGI_ENABLED=i,r.needsUpdate=!0),i=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==i&&(this.materialExtension.extraUniforms.tSSGIMap.value=i,r.needsUpdate=!0);const s="vec3 totalDiffuse =";e.fragmentShader=e.fragmentShader.replace(s,`\n\n            \n            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0\nvec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);\n#endif\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\n#if !defined(SSR_ENABLED) || SSR_ENABLED < 1\nreflectedLight.indirectSpecular+=ssgiColor*material.specularColor;\n#endif\n#endif\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${s}`),e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",""),e.defines.USE_UV=""},onObjectRender:(e,t,n)=>{const r=t.materialObject,i=!r.transparent&&r.transmission<.001,s=this.enabled&&i&&(this.renderWithCamera||this._renderer.frameCount>1)&&!1!==n.userData.screenSpaceRendering&&!r.userData?.ssrtaoDisabled&&!r.userData?.ssaoDisabled?1:0;r.defines.SSRTAO_ENABLED!==s&&(r.defines.SSRTAO_ENABLED=s,r.needsUpdate=!0)},parsFragmentSnippet:e=>t.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${z("tSSGIMap",this._target?.texture,e.capabilities.isWebGL2)}

            ${Go}

        `,extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:e=>this.enabled?"1":"0"+this._target?.texture?.colorSpace+this._target?.texture?.uuid+this.material.defines.SSGI_ENABLED,isCompatible:e=>!e.materialObject.userData?.ssaoDisabled&&e.isMeshStandardMaterial2},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...bt(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=r,this.needsSwap=!0,this._giActivated=s,this.ssgiEnabled=s,this.bilateralPass=new No(this._target,i,"rgba")}render(e,t,n,r,i){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,i),this.smoothEnabled&&this.bilateralPass.render(e,t,n,r,i))}}Rl([Oe()],Bl.prototype,"bilateralPass",void 0),Rl([dt("Intensity",[0,4]),Oe(),Q()],Bl.prototype,"intensity",void 0),Rl([dt("Power",[0,3]),Oe(),Q()],Bl.prototype,"power",void 0),Rl([ht("Auto radius"),Oe(),Q()],Bl.prototype,"autoRadius",void 0),Rl([dt("Object Radius",[.01,10]),Oe(),Q()],Bl.prototype,"objectRadius",void 0),Rl([dt("Tolerance",[.1,5]),Oe(),Q()],Bl.prototype,"tolerance",void 0),Rl([dt("Bias",[-.3,.3]),Oe(),Q()],Bl.prototype,"bias",void 0),Rl([dt("Falloff",[1e-4,4]),Oe(),Q()],Bl.prototype,"falloff",void 0),Rl([dt("Ray Count",[1,5],1),Oe(),Q()],Bl.prototype,"rayCount",void 0),Rl([dt("Step count",[1,16],1),Oe(),W("RTAO_STEP_COUNT")],Bl.prototype,"stepCount",void 0),Rl([ht("Smooth Enabled"),Oe()],Bl.prototype,"smoothEnabled",void 0),Rl([ht("Render with Camera")],Bl.prototype,"renderWithCamera",void 0);class kl extends Fo{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[fo,$t,sa],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){await super.onAdded(e),this.enabled=this._initEnabled,this.uiConfig.uiRefresh?.("postFrame",!0)}get enabled(){return this.passes.ssrtgi?.passObject?.enabled||!1}set enabled(e){this.passes.ssrtgi?.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),this._viewer?.getPluginByType("debug"),[Xt(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Bl(e.renderer,this._rtgiTarget,e.getPlugin($t)?.getUnpackSnippet()??"",!0),update:()=>{const t=this.enabled;if(t){const e=this._viewer?.getPluginByType("SSAO");e?.enabled&&(e.enabled=!1)}t&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin($t)])}},(()=>[e.getPlugin($t),e.getPlugin(sa),e.scene.activeCamera,e.renderer]))]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){this._viewer?.setDirty()}get uiConfig(){const e=this.passes.ssrtgi?.passObject?.uiConfig??{};return e.children?.map((e=>(0,t.getOrCall)(e)))?.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),e}}kl.PluginType="SSGI";let Ol=class extends Vt{constructor(e,t,n){super(e,t,n??new Ll,new xe(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(e,t,n,r,i){this.enabled&&super.render(e,t,n,r,i)}};Ol=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("High precision Normal Buffer")],Ol);class Ll extends n.RSm{constructor(){super()}onBeforeRender(e,t,r,i,s){let o=s.material;Array.isArray(o)&&(o=o[0]),this.normalMap=o?.normalMap??null,this.bumpMap=o?.bumpMap??null,this.bumpScale=o?.bumpScale,o?.normalScale&&this.normalScale.copy(o?.normalScale),this.needsUpdate=!0,this.side=o.side??n.ehD}}class Fl extends Yt{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:n.cLu,minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,r=new Set,i=new Set;return new class extends Ol{render(e,n,s,o,a){const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel();this.scene&&(this.scene.traverse((({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(r.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(i.add([e,e.transmission]),e.transmission=0))})),Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(e,n,t,o,a))),r.forEach((e=>e.transparent=!e.transparent)),r.clear(),i.forEach((([e,t])=>e.transmission=t)),i.clear(),e.setRenderTarget(l,c,u))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){return e.renderer.disposeTarget(this._normalTarget?.dispose?.()),super.onRemove(e)}updateShaderProperties(e){return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?this.getNormalBuffer()?.texture??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){return this.pass?.passObject.uiConfig}}Fl.PluginType="NormalBufferPlugin";var Ul=function(e,t){return Ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ul(e,t)};function Nl(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ul(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var jl,zl=function(){function e(){}return e._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},e}(),Gl=function(e){function t(n){var r=e.call(this)||this;return r.a=t._xfnv1a(n)(),r}return Nl(t,e),t.prototype.next=function(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296},t}(zl),Vl=function(e){function t(n){var r=e.call(this)||this,i=t._xfnv1a(n);return r.a=i(),r.b=i(),r.c=i(),r.d=i(),r}return Nl(t,e),t.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var e=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,e=e+this.d|0,this.c=this.c+e|0,(e>>>0)/4294967296},t}(zl),Hl=function(e){function t(n){var r=e.call(this)||this,i=t._xfnv1a(n);return r.a=i(),r.b=i(),r.c=i(),r.d=i(),r}return Nl(t,e),t.prototype.next=function(){var e=this.b<<9,t=5*this.a;return t=t<<7|9*(t>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},t}(zl);!function(e){e.sfc32="sfc32",e.mulberry32="mulberry32",e.xoshiro128ss="xoshiro128ss"}(jl||(jl={}));var Ql=function(){function e(e,t){void 0===t&&(t=jl.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return e.prototype.next=function(){return this.generator.next()},e.prototype._initializeGenerator=function(){if(function(e){return null===e}(e=this.str)||function(e){return void 0===e}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new Vl(this.str);case"mulberry32":return new Gl(this.str);case"xoshiro128ss":return new Hl(this.str);default:return this.wrap()}},e.prototype.wrap=function(){return{next:function(){return Math.random()}}},e}(),Wl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class ql extends Lr{constructor(e,t,r,i){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new n.Pa4(10,10,10),normalDirection:new n.Pa4(.01,.98,.01).normalize(),direction:new n.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=r??{},this.randomParams=i??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach((t=>void 0===e[t]&&delete e[t])),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach((t=>void 0===e[t]&&delete e[t])),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,r=null){const i=new Ql(e.toString()),s=new n.FM8(i.next()*Math.PI*2,Math.asin(2*i.next()-1));let o=new n.Pa4(Math.cos(s.x)*Math.cos(s.y),Math.sin(s.y),Math.sin(s.x)*Math.cos(s.y));const a=new n.FM8;for(let e=0;e<5;e++){a.set(i.next(),i.next()),o=Xl(a,this._randomParams.normalDirection,.4),i.next()<Math.sqrt(t??this._randomParams.focus)&&(a.set(i.next(),i.next()),o=Xl(a,this._randomParams.direction,Math.pow((r??this._randomParams.spread)/2,2)));const e=o.dot(this._randomParams.normalDirection);if(e>0&&e<.4)break}o.normalize(),o.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(o.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=(new n.Pa4).subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function Xl(e,t,r){t=t.clone().normalize();const i=new n.Pa4(0,-t.z,t.y).normalize(),s=(new n.Pa4).crossVectors(t,i).normalize(),o=e;o.x=2*o.x*Math.PI,o.y=1-o.y*r;const a=Math.sqrt(1-o.y*o.y);return i.multiplyScalar(Math.cos(o.x)*a).add(s.multiplyScalar(Math.sin(o.x)*a)).add(t.multiplyScalar(o.y))}Wl([Oe("shadowParams")],ql.prototype,"_shadowParams",void 0),Wl([Oe("randomParams")],ql.prototype,"_randomParams",void 0);var Yl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Kl extends qt{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new ql("#cceeff",1),this.lightLayers=1,this._preRender=()=>{if(!this.enabled)return void(this.light.layers.mask=0);const e=this._viewer?.renderer.frameCount??0;this.light.randomizePosition(e<5?0:e),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),this._cameraHelper?.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new n.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){e?this._viewer?.scene.setDirty():this._viewer?.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Kl.PluginType="RandomizedDirectionalLight",Yl([Oe()],Kl.prototype,"enabled",void 0),Yl([Oe("rdLight")],Kl.prototype,"light",void 0),Yl([Oe()],Kl.prototype,"lightLayers",void 0);var Jl="uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}",Zl=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let $l=class extends Gt{constructor(e,t,r,i=!0){super({vertexShader:jo,fragmentShader:`\n\nvarying vec2 vUv;\n\n${Pl}\n${Tl}\n${zo}\n${Dl}\n${r}\n\n${Il}\n\n${Jl}\n\nuniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}\n#include <encodings_fragment>\n}\n\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new n.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new n.yGw},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:i?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,n)=>{let r=this.enabled&&!1!==n.userData.screenSpaceRendering&&!t.materialObject.userData?.ssreflDisabled?1:0;if(t.materialObject.defines.SSR_ENABLED!==r&&(t.materialObject.defines.SSR_ENABLED=r,t.materialObject.needsUpdate=!0),!e.defines.SSR_ENABLED)return;r=this.material.defines.SSR_STEP_COUNT,t.materialObject.defines.SSR_STEP_COUNT!==r&&(t.materialObject.defines.SSR_STEP_COUNT=r,t.materialObject.needsUpdate=!0),r=this.material.defines.SSR_LOW_QUALITY_FRAMES,t.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==r&&(t.materialObject.defines.SSR_LOW_QUALITY_FRAMES=r,t.materialObject.needsUpdate=!0),r=this.material.defines.PERSPECTIVE_CAMERA,t.materialObject.defines.PERSPECTIVE_CAMERA!==r&&(t.materialObject.defines.PERSPECTIVE_CAMERA=r,t.materialObject.needsUpdate=!0),r=this.material.defines.SSR_INLINE,t.materialObject.defines.SSR_INLINE!==r&&(t.materialObject.defines.SSR_INLINE=r,t.materialObject.needsUpdate=!0),r=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,t.materialObject.defines.SSR_MASK_FRONT_RAYS!==r&&(t.materialObject.defines.SSR_MASK_FRONT_RAYS=r,t.materialObject.needsUpdate=!0),r=t.materialObject.userData?.ssreflNonPhysical?"1":"0",t.materialObject.defines.SSR_NON_PHYSICAL!==r&&(t.materialObject.defines.SSR_NON_PHYSICAL=r,t.materialObject.needsUpdate=!0),r=this._target?.texture??null,this.materialExtension.extraUniforms.tSSRMap.value!==r&&(this.materialExtension.extraUniforms.tSSRMap.value=r,t.materialObject.needsUpdate=!0);const i="#glMarker beforeModulation";e.fragmentShader=e.fragmentShader.replace(i,`\n\n            \n            #if defined(SSR_ENABLED) && SSR_ENABLED > 0\nvec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;\n#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0\nalphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);\n#endif\n#ifdef USE_TRANSMISSION\nalphaModifier*=1.-transmission;\n#endif\nfloat vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){\n#if defined(SSR_INLINE) && SSR_INLINE > 0\nssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);\n#else\nssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));\n#endif \n}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);\n#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0\ndiffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);\n#else\nreflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${i}`)},onObjectRender:(e,t,n)=>{const r=this.enabled&&!1!==n.userData.screenSpaceRendering&&!t.materialObject.userData?.ssreflDisabled?1:0;t.materialObject.defines.SSR_ENABLED!==r&&(t.materialObject.defines.SSR_ENABLED=r,t.materialObject.needsUpdate=!0)},parsFragmentSnippet:(e,t)=>!this.enabled||!1===e.userData.screenSpaceRendering||t?.materialObject.userData?.ssreflDisabled?"":"\nuniform float ssrPower;\nuniform float ssrIntensity;\nuniform float ssrMaskFrontFactor;\nuniform vec3 ssrBoost;\nuniform sampler2D tSSRMap;\nuniform sampler2D tLastFrame;\n"+z("tSSRMap",this._target?.texture,e.capabilities.isWebGL2)+z("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,e.capabilities.isWebGL2)+(this._inline?`\n#if 1\n// #if SSR_INLINE\n    ${Pl}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Tl}\n    \n    ${zo}\n    ${Dl}\n    ${Wt}\n    \n    ${Il}\n    \n    ${Jl}\n// #endif // SSR_INLINE\n#endif\n`:"")+`\n${Go}\n        `,extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:e=>this.enabled?"1":"0"+this._target?.texture?.colorSpace+(this.enabled&&!e.materialObject.userData?.ssreflDisabled?1:0)+Object.values(this.material.defines).map((e=>e+"")).join(","),isCompatible:e=>!e.materialObject.userData?.ssreflDisabled&&e.isMeshStandardMaterial2},this.intensity=1,this.boost=new n.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=e,this._target=t,this.needsSwap=!1,this._inline=i}render(e,t,n,r,i){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,i),this.needsSwap=!1}}};Zl([dt("Intensity",[0,4]),Oe(),Q()],$l.prototype,"intensity",void 0),Zl([ft("Boost"),Oe(),Q()],$l.prototype,"boost",void 0),Zl([dt("Object Radius",[.01,2]),Oe(),Q()],$l.prototype,"objectRadius",void 0),Zl([ht("Auto radius"),Oe(),Q()],$l.prototype,"autoRadius",void 0),Zl([dt("Power",[0,3]),Oe(),Q()],$l.prototype,"power",void 0),Zl([dt("Tolerance",[.1,5]),Oe(),Q()],$l.prototype,"tolerance",void 0),Zl([dt("Step count",[1,32],1),Oe(),W("SSR_STEP_COUNT")],$l.prototype,"stepCount",void 0),Zl([dt("Low Quality Frames",[0,4],1),Oe(),W("SSR_LOW_QUALITY_FRAMES")],$l.prototype,"lowQualityFrames",void 0),Zl([ht("Ignore front rays"),Oe(),W("SSR_MASK_FRONT_RAYS")],$l.prototype,"maskFrontRays",void 0),Zl([dt("Mask front rays factor",[-1,1],.01,(e=>({hidden:()=>!e.maskFrontRays}))),Oe(),Q()],$l.prototype,"maskFrontFactor",void 0),$l=Zl([wt("Screen Space Reflections")],$l);class ec extends Fo{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[fo,$t,sa],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){return this.passes.ssr?.passObject?.enabled||!1}set enabled(e){this.passes.ssr?.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),this.uiConfig.uiRefresh?.("postFrame",!0)}createPasses(e){return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Xt(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new $l(e.renderer,this._ssrTarget,e.getPlugin($t)?.getUnpackSnippet()??"",this.inlineSSR)},(()=>[e.getPlugin($t),e.getPlugin(sa),e.scene.activeCamera,e.renderer,e.scene]))]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){this._viewer?.setDirty()}get uiConfig(){const e=this.passes.ssr?.passObject?.uiConfig??{};return e.children?.map((e=>(0,t.getOrCall)(e)))?.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),e}}ec.PluginType="SSReflection";var tc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let nc=class extends qt{makeAnisotropic(e){const t=e.materialObject?.userData;if(!t)return!1;if(void 0===t._isAnisotropic){const e=t.__appliedMeshes;let n=!0;if(e)for(const{geometry:t}of e)!t||t.index&&t.attributes.position&&t.attributes.normal&&t.attributes.uv||(n=!1),n&&!t.attributes.tangent&&t.computeTangents();if(!n)return!1}return t._isAnisotropic=!0,void 0===t._anisotropyFactor&&(t._anisotropyFactor=1),void 0===t._anisotropyNoise&&(t._anisotropyNoise=0),void 0===t._anisotropyDirectionMode&&(t._anisotropyDirectionMode="DIRECTION"),e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new rc(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(e,r,i)=>{if(!this.enabled||!r.materialObject.userData._isAnisotropic)return;const s=r.materialObject.userData?._anisotropyDirectionMap,o=t.glsl`
                //#if ANISOTROPY_ENABLED
                ${zo}
                ${"uniform float anisotropyFactor;uniform float anisotropyNoise;\n#if ANISOTROPY_TEX_MODE == 0\nuniform float anisotropyDirection;\n#else\nuniform sampler2D anisotropyDirectionMap;\n#endif\nconst float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}"}
            `+(s?z("anisotropyDirectionMap",s,i.capabilities.isWebGL2):"")+"\n";e.fragmentShader=Lt(e.fragmentShader,"#include <common>",o,{append:!0}),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",n.WdD.lights_fragment_begin),e.fragmentShader=Lt(Lt(e.fragmentShader,"IncidentLight directLight;","float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;\n#if ANISOTROPY_TEX_MODE < 2\n#if ANISOTROPY_TEX_MODE == 0 \nfloat rot=saturate(anisotropyDirection);\n#else \nfloat rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);\n#endif\nrot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));\n#else \nvec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);\n#endif\nvec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));",{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let a=Lt(n.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");a=Lt(a,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),e.fragmentShader=Lt(e.fragmentShader,"#include <lights_physical_pars_fragment>",a),e.fragmentShader=Lt(e.fragmentShader,"#include <normal_fragment_begin>",n.WdD.normal_fragment_begin),e.fragmentShader=Lt(e.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let l=t.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+n.WdD.lights_fragment_maps;l=Lt(l,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),l=Lt(l,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),e.fragmentShader=Lt(e.fragmentShader,"#include <lights_fragment_maps>",l),e.defines.USE_UV="",e.vertexTangents=!0},onObjectRender:(e,t)=>{const n=t.materialObject.userData;if(!n?._isAnisotropic)return;const r=e;if(!r.isMesh||!r.geometry)return;if(!r.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=n._anisotropyFactor,this._uniforms.anisotropyNoise.value=n._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=n._anisotropyDirectionMap?.isTexture?n._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=n._anisotropyDirection;let i=this.enabled?1:0;t.materialObject.defines.ANISOTROPY_ENABLED!==i&&(t.materialObject.defines.ANISOTROPY_ENABLED=i,t.materialObject.needsUpdate=!0),i=+this._defines.ANISOTROPY_DEBUG,t.materialObject.defines.ANISOTROPY_DEBUG!==i&&(t.materialObject.defines.ANISOTROPY_DEBUG=i,t.materialObject.needsUpdate=!0),i=n._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(i="CONSTANT"),i="DIRECTION"===i?2:"ROTATION"===i?1:0,t.materialObject.defines.ANISOTROPY_TEX_MODE!==i&&(t.materialObject.defines.ANISOTROPY_TEX_MODE=i,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._isAnisotropic?"1":"0")+e.materialObject.userData?._anisotropyDirectionMap?.uuid,isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[this._viewer?.renderer],getUiConfig:e=>{const t=this._viewer,n=this.makeAnisotropic,r={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._isAnisotropic||!1},set value(i){i!==e.materialObject.userData._isAnisotropic&&(i?n(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._isAnisotropic=!1,e.materialObject.needsUpdate=!0),r.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map((e=>({label:e}))),onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}}]};return r}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this.makeSelectedAnisotropic=()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject()?.material;return"material"===e?.assetType&&this.makeAnisotropic(e)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(ic)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};nc.PluginType="AnisotropyPlugin",nc.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",tc([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],nc.prototype,"enabled",void 0),tc([gt("Make Anisotropy",(e=>({hidden:()=>!e._viewer?.getPlugin(_l)})))],nc.prototype,"makeSelectedAnisotropic",void 0),nc=tc([wt("Anisotropy Materials")],nc);class rc{constructor(e){this.parser=e,this.name=nc.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=o.anisotropyFactor??0,t.userData._anisotropyNoise=o.anisotropyNoiseFactor??o.anisotropyNoise??0;let{anisotropyDirectionMode:a,anisotropyDirection:l}=o;return a||(a=o.anisotropyTextureMode),l||(l=o.anisotropyRotation),t.userData._anisotropyDirectionMode=a&&"number"==typeof l?.index?a:"CONSTANT","ROTATION"===a||"DIRECTION"===a?s.push(r.assignTexture(t.userData,"_anisotropyDirectionMap",l).then((e=>{e.colorSpace=n.KI_}))):t.userData._anisotropyDirection=l??0,Promise.all(s)}afterRoot(e){return e.scene?.traverse((e=>{const t=e.material?.userData?._isAnisotropic;if(!t)return;const n=e.geometry;n.attributes.tangent||(n.computeTangents(),n.attributes.tangent.needsUpdate=!0)})),null}}const ic=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._isAnisotropic)return;if((t.userData._anisotropyFactor||0)<.001)return;n.extensions=n.extensions||{};const r={};if(r.anisotropyFactor=t.userData._anisotropyFactor||1,r.anisotropyNoiseFactor=t.userData._anisotropyNoise||0,r.anisotropyDirectionMode=t.userData._anisotropyDirectionMode||"CONSTANT",t.userData._anisotropyDirectionMap&&"CONSTANT"!==r.anisotropyDirectionMode){const n={index:e.processTexture(t.userData._anisotropyDirectionMap)};e.applyTextureTransform(n,t.userData._anisotropyDirectionMap),r.anisotropyDirection=n}else r.anisotropyDirectionMode="CONSTANT",r.anisotropyDirection=t.userData._anisotropyDirection||0;n.extensions[nc.ANISOTROPY_GLTF_EXTENSION]=r,e.extensionsUsed[nc.ANISOTROPY_GLTF_EXTENSION]=!0}});var sc,oc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let ac=sc=class extends qt{static AddFragmentClipping(e,t,n,r,i){const s=e.materialObject?.userData;if(!s)return!1;s._fragmentClippingExt||(s._fragmentClippingExt={});const o=s._fragmentClippingExt;return o.clipEnabled=!0,void 0===o.clipPosition&&(o.clipPosition=t?.toArray()??[0,0,0,0]),void 0===o.clipParams&&(o.clipParams=n?.toArray()??[1,0,0,0]),void 0===o.clipMode&&(o.clipMode=r??lc.Circle),void 0===o.clipInvert&&(o.clipInvert=i??!1),e.materialObject.isMaterial&&(e.needsUpdate=!0),!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new cc(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo,$t],this._plane=new n.JOQ,this._viewNormalMatrix=new n.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new n.Ltg},fragClippingParams:{value:new n.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(e,n)=>this.enabled&&n?.materialObject.userData._fragmentClippingExt?.clipEnabled?Go+t.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${lc.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${lc.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${lc.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${lc.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${lc.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:"",shaderExtender:(e,n,r)=>{this.enabled&&n.materialObject.userData._fragmentClippingExt?.clipEnabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker mainStart",t.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${lc.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${lc.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${lc.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${lc.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${lc.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(e,t)=>{let r=t.materialObject.userData?._fragmentClippingExt;if(t.materialObject.userData.isGBufferMaterial&&e&&(r=e.material?.userData?._fragmentClippingExt),!r?.clipEnabled)return;if(this._uniforms.fragClippingPosition.value.fromArray(r.clipPosition),r.clipMode===lc.Plane){const e=this._viewer?.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(r.clipParams[0],r.clipParams[1],r.clipParams[2]),this._plane.constant=r.clipParams[3],this._viewNormalMatrix.getNormalMatrix(e),this._plane.applyMatrix4(e,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(r.clipParams);this._viewer?.scene.activeCamera.cameraObject instanceof n.cPb?this._uniforms.fragClippingCamAspect.value=this._viewer?.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let i=this.enabled?1:0;i=+this._defines.FRAG_CLIPPING_DEBUG,t.materialObject.defines.FRAG_CLIPPING_DEBUG!==i&&(t.materialObject.defines.FRAG_CLIPPING_DEBUG=i,t.materialObject.needsUpdate=!0),i=+r.clipMode,t.materialObject.defines.FRAG_CLIPPING_MODE!==i&&(t.materialObject.defines.FRAG_CLIPPING_MODE=i,t.materialObject.needsUpdate=!0),i=+r.clipInvert,t.materialObject.defines.FRAG_CLIPPING_INVERSE!==i&&(t.materialObject.defines.FRAG_CLIPPING_INVERSE=i,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._fragmentClippingExt?.clipEnabled?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2||e.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>e.materialObject.userData._fragmentClippingExt?.clipEnabled||!1,setValue:r=>{r!==e.materialObject.userData._fragmentClippingExt?.clipEnabled&&(r?sc.AddFragmentClipping(e.materialObject)||t.alert("Cannot add fragment clipping extension."):e.materialObject.userData._fragmentClippingExt&&(e.materialObject.userData._fragmentClippingExt.clipEnabled=!1,e.materialObject.needsUpdate=!0),n.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(lc).map((e=>({label:e[0],value:e[1]}))),hidden:()=>!e.materialObject.userData._fragmentClippingExt?.clipEnabled,property:[e.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>!e.materialObject.userData._fragmentClippingExt?.clipEnabled,property:[e.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>!e.materialObject.userData._fragmentClippingExt?.clipEnabled,property:[e.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>!e.materialObject.userData._fragmentClippingExt?.clipEnabled,property:[e.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(uc),e.getPlugin($t)?.material?.registerMaterialExtensions([this.materialExtension])}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};var lc;ac.PluginType="FragmentClippingExtensionPlugin1",ac.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",oc([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],ac.prototype,"enabled",void 0),ac=sc=oc([wt("FragmentClipping Materials")],ac),function(e){e[e.Circle=0]="Circle",e[e.Ellipse=1]="Ellipse",e[e.Rectangle=2]="Rectangle",e[e.Plane=3]="Plane",e[e.Sphere=4]="Sphere"}(lc||(lc={}));class cc{constructor(e){this.parser=e,this.name=ac.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),ac.AddFragmentClipping(t),t.userData._fragmentClippingExt=je(r,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const uc=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._fragmentClippingExt)return;if(!t.userData._fragmentClippingExt.clipEnabled)return;n.extensions=n.extensions||{};const r=Ne(t.userData._fragmentClippingExt,!1);n.extensions[ac.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=r,e.extensionsUsed[ac.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var hc,pc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let dc=hc=class extends qt{constructor(e=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new n.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=e,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){if(!this._viewer)return;const e=this._viewer.scene.background;if(this.enabled&&e!==this._viewer.scene.environment&&"environment"!==e)if(e&&e.isDataTexture)e.mapping=n.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const e=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");e?(e.envmapBg=!0,e.uiConfig.uiRefresh?.("postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const t=this._viewer.renderer.rendererObject.background.getBoxMesh2()?.material,r=t?.uniforms??n.Vj0.backgroundCube.uniforms;r.tripodHeight||(r.tripodHeight={value:1}),r.worldRadius||(r.worldRadius={value:1}),r.originPosition||(r.originPosition={value:new n.Pa4}),r.tripodHeight.value=this.tripodHeight,r.worldRadius.value=this.worldRadius,r.originPosition.value.copy(this.originPosition),t&&(!this.enabled&&t.defines.HDRi_GROUND_PROJ?delete t.defines.HDRi_GROUND_PROJ:this.enabled&&(t.defines.HDRi_GROUND_PROJ="1"),t.needsUpdate=!0),this._viewer.setDirty()}async onAdded(e){await super.onAdded(e),this._viewer?.renderer?.rendererObject?.background.getBoxMesh()&&e.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),n.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(n.Vj0.backgroundCube.fragmentShader=Lt(n.Vj0.backgroundCube.fragmentShader,"void main() {","#ifdef HDRi_GROUND_PROJ\nfloat intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}\n#define PI_HALF  1.5707963267948966\nuniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}\n#endif\n",{prepend:!0}),n.Vj0.backgroundCube.fragmentShader=Lt(n.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;","\nvec3 vReflect = \n#ifdef HDRi_GROUND_PROJ\nhdriProject()\n#else\nvWorldDirection\n#endif\n;\n")),e.scene.addEventListener("environmentChanged",this._paramsChanged)}};dc.PluginType="HDRiGroundPlugin",pc([Oe(),(0,t.onChange)(hc.prototype._paramsChanged),ht("Enabled")],dc.prototype,"enabled",void 0),pc([Oe(),(0,t.onChange)(hc.prototype._paramsChanged),dt("World Radius",[1,1e3],.01)],dc.prototype,"worldRadius",void 0),pc([Oe(),(0,t.onChange)(hc.prototype._paramsChanged),dt("Tripod height",[0,50],.01)],dc.prototype,"tripodHeight",void 0),pc([Oe(),(0,t.onChange)(hc.prototype._paramsChanged),ft("Origin Position",void 0,.001,(e=>({onChange:e._paramsChanged})))],dc.prototype,"originPosition",void 0),dc=hc=pc([wt("HDRi Ground")],dc);var fc,mc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let gc=fc=class extends qt{constructor(e=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[$t,fo],this.materialExtension={shaderExtender:(e,r,i)=>{if(!e.defines.SSCS_ENABLED)return;const s=t.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`\n#if SSCS_ENABLED\n\n    uniform float sscsIntensity;\n    uniform float sscsRadius;\n    uniform float sscsTolerance;\n\n    ${Pl}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Tl}\n    \n    ${Wt}\n    ${zo}\n    \n    ${Il}\n\n#endif\n            \n            `+n.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${s}\n`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",n.WdD.lights_fragment_begin),e.fragmentShader=Lt(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=Lt(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{const r=t.materialObject;let i=this.enabled&&!1!==n.userData.screenSpaceRendering&&!r.userData?.sscsDisabled?1:0;r.defines.SSCS_ENABLED!==i&&(r.defines.SSCS_ENABLED=i,r.needsUpdate=!0),i=this._defines.SSCS_STEP_COUNT,r.defines.SSCS_STEP_COUNT!==i&&(r.defines.SSCS_STEP_COUNT=i,r.needsUpdate=!0),i=+this._defines.SSCS_DEBUG,r.defines.SSCS_DEBUG!==i&&(r.defines.SSCS_DEBUG=i,r.needsUpdate=!0)},parsFragmentSnippet:()=>"\n",extraUniforms:{...fc._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[this._viewer?.getPlugin($t),this._viewer?.getPlugin(sa),this._viewer?.scene.activeCamera,this._viewer?.renderer,this._viewer?.scene]},this.enabled=e,this.userData={setDirty:()=>{this._viewer?.setDirty()}}}async onAdded(e){await super.onAdded(e),e.getPlugin(fo)?.materials?.registerMaterialExtension(this.materialExtension)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),super.onRemove(e)}};gc.PluginType="SSContactShadows",gc._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new n.yGw},cameraPositionWorld:{value:new n.Pa4},cameraNearFar:{value:new n.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},mc([ht("Enabled"),Oe()],gc.prototype,"enabled",void 0),mc([Q({uniforms:fc._uniforms,propKey:"sscsRadius"}),dt("Radius",[1e-4,.1],1e-4),Oe()],gc.prototype,"radius",void 0),mc([Q({uniforms:fc._uniforms,propKey:"sscsIntensity"}),dt("Intensity",[1e-4,1],1e-4),Oe()],gc.prototype,"intensity",void 0),mc([Q({uniforms:fc._uniforms,propKey:"sscsTolerance"}),dt("Tolerance",[.1,5]),Oe()],gc.prototype,"tolerance",void 0),mc([W("SSCS_DEBUG",void 0,!0),ht("Debug only SSCS"),Oe()],gc.prototype,"onlySSCSDebug",void 0),mc([W("SSCS_STEP_COUNT",void 0,!0),dt("Step count",[1,8],1),Oe()],gc.prototype,"stepCount",void 0),gc=fc=mc([wt("Screen Space Contact Shadows")],gc);class _c{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new n.xsS,this._mesh=new n.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new vc}dispose(){this._mesh.geometry?.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach((e=>this._normalsCache[e]?.dispose()))}disposeAllTargets(){Object.values(this._normalsCache).forEach((e=>e.dispose()))}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,t,r=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const i=t?.split(";").find((e=>this._normalsCache[e]));if(i){const n=this._normalsCache[i];return t?.split(";").forEach((e=>e!==i&&(this._normalsCache[e]=n))),n.width!==r&&console.warn("last cacheKey normalMapRes mismatch, check model",r),e.userData._normalsCaptureMap=n,!1}const s=this._renderer.createTargetCustom({width:r,height:r},{minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1,type:n.cLu},n.oAp);if(s.attachedGeometries=[],s.autoDispose=_c.AutoDisposeTargets,!s)throw"Unable to create render target";const o=()=>{const t=new n._am(1e-4,100,s);this._scene.add(t);const r=e.userData.normalsCaptureOffsets;void 0!==r.center&&this._mesh.material.uniforms.offsetCenter.value.fromArray(r.center),void 0!==r.offsetMatrixInv&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(r.offsetMatrixInv),void 0!==r.radius&&(this._mesh.material.uniforms.radius.value=r.radius),this._mesh.geometry=e,t.update(this._renderer.rendererObject,this._scene),this._scene.remove(t),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=s};return o(),this._renderer.addEventListener("contextRestored",o),s.attachedGeometries.push(e),e.addEventListener("dispose",(()=>{s.attachedGeometries=s.attachedGeometries?.filter((t=>t!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",o),s.autoDispose&&!s.attachedGeometries.length&&s.dispose()})),t?.split(";").forEach((e=>this._normalsCache[e]=s)),s.addEventListener("dispose",(()=>{t?.split(";").forEach((e=>delete this._normalsCache[e])),this._renderer.removeEventListener("contextRestored",o),delete e.userData._normalsCaptureMap})),!0}}_c.AutoDisposeTargets=!0;class vc extends n.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:n.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:(new n.yGw).identity()},offsetCenter:{value:new n.Pa4}}})}}var yc=__webpackgi_require__(654);function bc(e){const t=new n.Pa4(0,0,0),r=new n.Pa4(0,0,0),i=new n.Pa4(0,0,0),s=new n.Pa4(0,0,0),o=e.getAttribute("position"),a=e.index;if(a)for(let n=Math.max(0,e.drawRange.start),l=Math.min(a.count,e.drawRange.start+e.drawRange.count)-1;n<l/3;n+=3){const e=a.getX(n),l=a.getX(n+1),c=a.getX(n+2);r.set(o.getX(e),o.getY(e),o.getZ(e)),i.set(o.getX(l),o.getY(l),o.getZ(l)),s.set(o.getX(c),o.getY(c),o.getZ(c)),i.sub(r),s.sub(r),s.cross(i),s.normalize(),t.add(s)}else for(let e=0;e<o.count;e+=3)r.set(o.getX(e),o.getY(e),o.getZ(e)),i.set(o.getX(e+1),o.getY(e+1),o.getZ(e+1)),s.set(o.getX(e+2),o.getY(e+2),o.getZ(e+2)),i.sub(r),s.sub(r),s.cross(i),s.normalize(),t.add(s);t.normalize();let l=!1,c=0;for(;!l;){const e=c/3,n=a?a.getX(e):e,s=a?a.getX(e+1):e+1;r.set(o.getX(n),o.getY(n),o.getZ(n)),i.set(o.getX(s),o.getY(s),o.getZ(s)),r.sub(i),r.normalize();const u=t.dot(r);Math.abs(u-1)>.001&&r.length()>.5&&(l=!0),c+=3}i.crossVectors(r,t),i.normalize(),r.crossVectors(t,i),r.normalize();const u=new n.yGw;u.elements[0]=r.x,u.elements[1]=r.y,u.elements[2]=r.z,u.elements[3]=0,u.elements[4]=t.x,u.elements[5]=t.y,u.elements[6]=t.z,u.elements[7]=0,u.elements[8]=i.x,u.elements[9]=i.y,u.elements[10]=i.z,u.elements[11]=0,u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,e.computeBoundingSphere();const h=e.boundingSphere.radius,p=(new n.yGw).makeScale(h,h,h);return u.multiply(p),u}function Ac(e,t,r){const i=(new n.Pa4).copy(e),s=(new n.Pa4).copy(t),o=(new n.Pa4).copy(r);return i.dot(s.cross(o))/6}function wc(e,t,r){const i=(new n.Pa4).copy(e),s=(new n.Pa4).copy(t),o=(new n.Pa4).copy(r);return s.sub(i),o.sub(i),o.cross(s),.5*o.length()}function xc(e){const t=e.getAttribute("position"),r=e.getAttribute("normal");if(t.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",t.count/3),bc(e);const i=new n.Pa4(0,0,0),s=new n.Pa4(0,0,0),o=new n.Pa4(0,0,0),a=e.index,l=[];if(a)for(let n=Math.max(0,e.drawRange.start),r=Math.min(a.count,e.drawRange.start+e.drawRange.count)-1;n<r;n+=3){const e=a.getX(n),r=a.getX(n+1),c=a.getX(n+2);i.set(t.getX(e),t.getY(e),t.getZ(e)),s.set(t.getX(r),t.getY(r),t.getZ(r)),o.set(t.getX(c),t.getY(c),t.getZ(c)),l.push(i.toArray(),s.toArray(),o.toArray())}else for(let e=0;e<t.count;e++)i.set(t.getX(e),t.getY(e),t.getZ(e)),l.push(i.toArray());const c=function(e,t){const r=new n.Pa4;for(let t=0;t<e.length;t+=3)r.x+=e[t],r.y+=e[t+1],r.z+=e[t+2];r.multiplyScalar(1/(e.length/3));const i=new n.Pa4,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4;let c=0,u=0;for(let e=0;e<t.length;e+=3){i.set(t[e][0],t[e][1],t[e][2]),s.set(t[e+1][0],t[e+1][1],t[e+1][2]),o.set(t[e+2][0],t[e+2][1],t[e+2][2]),l.copy(i).add(s).add(o);const n=wc(i,s,o);l.multiplyScalar(n/3),a.add(l),c+=n,u+=Ac(i,s,o)}return a.multiplyScalar(1/c),{centre:r,com:a,volume:u,area:c}}(t.array,l);if(c.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let e=0;e<r.count;e++)r.setX(e,-r.getX(e)),r.setY(e,-r.getY(e)),r.setZ(e,-r.getZ(e));r.needsUpdate=!0}const u=[];for(let e=0;e<t.array.length;e+=3)u.push([t.array[e],t.array[e+1],t.array[e+2]]);const h=console.log;console.log=()=>{};const p=(0,yc.getEigenVectors)(u);console.log=h;const d=new n.yGw;d.elements[0]=p[0].vector[0],d.elements[1]=p[0].vector[1],d.elements[2]=p[0].vector[2],d.elements[3]=0,d.elements[4]=p[1].vector[0],d.elements[5]=p[1].vector[1],d.elements[6]=p[1].vector[2],d.elements[7]=0,d.elements[8]=p[2].vector[0],d.elements[9]=p[2].vector[1],d.elements[10]=p[2].vector[2],d.elements[11]=0,d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1;const f=new n.Pa4;f.copy(c.com).sub(c.centre),f.normalize();const m=new n.Pa4(p[2].vector[0],p[2].vector[1],p[2].vector[2]);f.dot(m)<0&&(d.elements[4]=-p[1].vector[0],d.elements[5]=-p[1].vector[1],d.elements[6]=-p[1].vector[2],d.elements[8]=-p[2].vector[0],d.elements[9]=-p[2].vector[1],d.elements[10]=-p[2].vector[2]),e.computeBoundingSphere();const g=e.boundingSphere.radius,_=(new n.yGw).makeScale(g,g,g);return d.multiply(_),d}const Ec={...on,color:new xe(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new n.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var Cc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Sc extends n.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,r,i){super.onBeforeRender(e,t,n,r,i),void 0===this.envMapIntensity||this.userData.separateEnvMapIntensity||void 0===t.envMapIntensity||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),void 0!==this.envMap&&void 0!==t.fixedEnvMapDirection&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):void 0!==this.defines.FIX_ENV_DIRECTION&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(this.envMap?.rotation||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(i.matrixWorld).invert();const s=r.userData.normalsCaptureOffsets;s&&(this.extraUniformsToUpload.centerOffset.value.fromArray(s.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(s.offsetMatrix).premultiply(i.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=s.radius);const o=r.userData._normalsCaptureMap?.texture;this.normalsCaptureMap!==o&&(this.normalsCaptureMap=o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}onAfterRender(e,t,n,r,i){super.onAfterRender(e,t,n,r,i),void 0!==this.userData.__envIntensity&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:i})}constructor(e){super({side:n.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:"#ifndef USE_ENVMAP\n#define USE_ENVMAP  \n#endif\nvarying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;\n#ifdef USE_INSTANCING\nuniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;\n#endif\nvoid main(){\n#ifdef USE_INSTANCING\nvWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;\n#else\nvWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;\n#endif\n#include <beginnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <project_vertex>\nvViewPosition=-mvPosition.xyz;vUv=uv;\n#include <worldpos_vertex>\nvWorldPosition=worldPosition.xyz;\n#ifdef USE_INSTANCING\nvModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);\n#endif\n}",fragmentShader:"varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;\n#ifdef USE_INSTANCING\nvarying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;\n#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix\n#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv\n#else\nuniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;\n#define MODEL_OFFSET_MATRIX  modelOffsetMatrix\n#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv\n#endif\n#define CENTER_OFFSET  (centerOffset) \nuniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;\n#if ENV_MAP_TYPE == 0\nuniform samplerCube envMap;\n#elif ENV_MAP_TYPE == 1\nuniform sampler2D envMap;\n#endif\nuniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){\n#if !defined(USE_ENVMAP)\nreturn vec4(direction,1);\n#else\nfloat cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;\n#if ENV_MAP_TYPE == 0\nreturn(textureCube(envMap,direction));\n#elif ENV_MAP_TYPE == 1\nreturn(texture2D(envMap,cartesianToPolar(direction)));\n#endif\nreturn vec4(1,0,1,1);\n#endif\n}vec4 SampleSpecularReflection(vec3 direction){\n#if defined(FIX_ENV_DIRECTION)\ndirection=(viewMatrix*vec4(direction,0.)).xyz;\n#endif\nreturn envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){\n#if DIA_ORIENT_ENVMAP < 1\ndirection=mat3(MODEL_OFFSET_MATRIX)*direction;\n#endif\n#if defined(FIX_ENV_DIRECTION)\ndirection=(viewMatrix*vec4(direction,0.)).xyz;\n#endif\ndirection=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);\n#glMarker beforeAccumulation\ngl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));\n#include <encodings_fragment>\n}",uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new n.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new n.Pa4(1,1,1)}}}),this.typeSlug=Sc.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new xe(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new n.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:(new n.yGw).identity()},radius:{value:1},centerOffset:{value:new n.Pa4(0,0,0)},modelOffsetMatrix:{value:(new n.yGw).identity()},modelOffsetMatrixInv:{value:(new n.yGw).identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=Ft.RegisterExtensions(this,e?.customMaterialExtensions??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ft.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Ft.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ft.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),this._uiConfig?.uiRefresh?.("postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=this.uniforms.envMap.value?.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=Sc.TYPE,t.userData={},Me(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map((e=>({label:"env"+(e+1),value:e})))},...bt(this),{type:"input",label:"Mesh count",get value(){return e.userData?.__appliedMeshes?.size??0},set value(e){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(e){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>0===this.transmission,get value(){return!0===e.userData.renderToDepth},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const n=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,t.downloadBlob)(n,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map((e=>e.getUiConfig?.(this)))].filter((e=>e)),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Sc.TYPE)return console.warn("Material type is not supported",e),this;const n={},r=Array.from(Object.keys(Ec));(0,t.copyProps)(e,n,r);const i=n.userData;return delete n.userData,this.setValues(n),Me(this.userData,i),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}Sc.TypeSlug="dmat",Sc.TYPE="DiamondMaterial",Cc([vt("Color",{limitedUi:!0}),Q()],Sc.prototype,"color",void 0),Cc([dt("Env Intensity",[0,5],.01,{limitedUi:!0}),Q()],Sc.prototype,"envMapIntensity",void 0),Cc([dt("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,t.onChange2)(Sc.prototype.setDirty)],Sc.prototype,"envMapRotationOffset",void 0),Cc([dt("Dispersion",[0,.1],1e-4,{limitedUi:!0}),Q({propKey:"rIndexDelta"})],Sc.prototype,"dispersion",void 0),Cc([dt("Absorption",[0,15],.01,{limitedUi:!0}),Q()],Sc.prototype,"absorptionFactor",void 0),Cc([dt("Refractive Index",[0,4],.01,{limitedUi:!0}),Q()],Sc.prototype,"refractiveIndex",void 0),Cc([Q()],Sc.prototype,"squashFactor",void 0),Cc([Q()],Sc.prototype,"geometryFactor",void 0),Cc([dt("Gamma",[.1,4],.01,{limitedUi:!0}),Q()],Sc.prototype,"gammaFactor",void 0),Cc([ft("RGB Boost",void 0,void 0,{limitedUi:!0}),Q()],Sc.prototype,"boostFactors",void 0),Cc([dt("Transmission",[0,1],.01,{limitedUi:!0}),Q()],Sc.prototype,"transmission",void 0),Cc([dt("Reflectivity",[0,2],.01,{limitedUi:!0}),Q()],Sc.prototype,"reflectivity",void 0),Cc([W("RAY_BOUNCES",void 0,!0),dt("Ray Bounces",[1,16],1)],Sc.prototype,"rayBounces",void 0),Cc([W("DIA_ORIENT_ENVMAP",void 0,!0),dt("Diamond Oriented Lighting",[0,1],1)],Sc.prototype,"diamondOrientedEnvMap",void 0),Cc([Q({propKey:"tCubeMapNormals"})],Sc.prototype,"normalsCaptureMap",void 0),Cc([(0,t.onChange)(Sc.prototype.refreshEnvUniform)],Sc.prototype,"envMapIndex",void 0);var Mc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Tc extends qt{get envMapRotation(){return this.envMap?.rotation??0}set envMapRotation(e){const t=[this.envMap,this.envMap2,this.envMap3];for(const n of t)n&&(n.rotation=e,this._viewer?.scene.setDirty())}refreshEnvMaps(){if(!this._viewer)return;const e=this.getEnvMaps(),t=this._viewer.getPlugin(fo)?.materials?.getMaterialsOfType(Sc.TypeSlug)||[];for(const n of t)n&&(n.envMaps=e);this._viewer?.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=this._viewer?.scene.getEnvironment()||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse((e=>{const t=e.userData?.gltfExtensions?.[Tc.DIAMOND_GLTF_EXTENSION];if(t&&e.geometry&&(this.prepareDiamondMesh(e,t),delete e.userData.gltfExtensions[Tc.DIAMOND_GLTF_EXTENSION]),e.material&&!n.includes(e.material)){const t=e.material.userData?.gltfExtensions?.[Tc.DIAMOND_GLTF_EXTENSION];t&&(e.material.materialObject||console.warn("material not processed",e.material),n.push(e.material))}})),n.forEach((e=>{const t=e.userData.gltfExtensions[Tc.DIAMOND_GLTF_EXTENSION];t&&this._convertToDiamondMaterial(e,t)})),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject()?.material;return!!Array.isArray(e)||e?.typeSlug!==cn.TypeSlug},value:async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject();if(!e?.material)return;const t=await(this._viewer?.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let n=parseInt(await(this._viewer?.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(n)||(n=512),n<64&&(n=64),e.material.userData?.__appliedMeshes.size>1&&await(this._viewer?.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:t||void 0,normalMapRes:n},{}):this.makeDiamondMesh(e,{cacheKey:t||void 0,normalMapRes:n},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject()?.material;return!!Array.isArray(e)||e?.typeSlug!==Sc.TypeSlug},value:async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject(),t=e?.material;if(!t)return;const n=t.userData._baseMaterial;let r=this._viewer?.getManager()?.materials?.findMaterial(n);if(r&&!r.isDiamondMaterial||(r=this._viewer?.createPhysicalMaterial({color:t.color})),r){const n=t.userData.__appliedMeshes.size>1&&await(this._viewer?.confirm("Convert all with this material?"))?Array.from(t.userData.__appliedMeshes):[e];for(const e of n)e?.setMaterial?.(r)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject()?.material;return!!Array.isArray(e)||e?.typeSlug!==Sc.TypeSlug||e.userData.__appliedMeshes?.size<2},value:async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject();if(!e)return;const t=e.material;t&&!Array.isArray(t)&&qe(t)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){this._viewer?.setDirty(),this.uiConfig?.uiRefresh?.("postFrame",!0)}async onAdded(e){this._normalCapture=new _c(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",(e=>{if(e.material?.isDiamondMaterial){const t=e.material,n=e.mesh||e.object;if(n.geometry&&!this._normalCapture?.hasCapturedNormalMap(n)){const e=t?.userData?.gltfExtensions?.[Tc.DIAMOND_GLTF_EXTENSION]??{};void 0===e.cacheKey&&!n.userData._diamondCacheKey&&t?.name&&(e.cacheKey=t.name),this.prepareDiamondMesh(n,e)}const r=this.getEnvMaps();t.envMaps=r}})),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const t=e.getPlugin(fo);t?.importer?.processors.add("model",this._modelProcessor),e.getPlugin(_l)?.addEventListener("selectedObjectChanged",this.refreshUi);const r=this.getEnvMaps,i=new _n(class extends An{async loadAsync(e,n){const i=await super.loadAsync(e,n);return i.type===Sc.TYPE||i.isDiamondMaterialParameters?(i.envMap=r(),t?.materials?.generateFromTemplate("diamond",i)):(console.error("Invalid material type for Diamond Material.",i),null)}},[Sc.TypeSlug],!1);return t?.importer?.Importers.push(i),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(Dc),t?.materials?.registerMaterialTemplate({name:"diamond",materialType:Sc.TYPE,isDiamondMaterialParameters:!0,generator:(e,t)=>{const r=!(t?.metadata||!t.isDiamondMaterialParameters)||t?.metadata&&t?.metadata.version<=4.5,i=t?.color;r&&"number"==typeof t.color&&(t.color=(new xe).setHex(t.color,n.GUF).getHex());const s=new Sc(e);return s.envMaps=this.getEnvMaps(),t&&s.copyProps(t),t.color=i,s}}),super.onAdded(e)}async onRemove(e){return this._normalCapture?.dispose(),this._normalCapture=void 0,this.offsetCache={},e.getPlugin(fo)?.importer?.processors.remove("model",this._modelProcessor),e.getPlugin(_l)?.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const r=this._normalCapture?.captureNormalMap(e.geometry,t,n)??[void 0,!1],i=this._viewer?.getPluginByType("debug");i&&r&&(i.counters.normalsCapture||(i.counters.normalsCapture=0),i.counters.normalsCapture++,i.counters.normalsCapture,i.addTexture("normal"+i.counters.normalsCapture,(()=>e.geometry?.userData._normalsCaptureMap?.texture),[40,110*i.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){Array.from(e?.userData.__appliedMeshes??[]).forEach((e=>{e?.isMesh&&e.geometry&&this.prepareDiamondMesh(e,t)})),this._convertToDiamondMaterial(e,n),this._viewer?.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const r=Array.isArray(e.material)?e.material[0]:e.material,i=this._convertToDiamondMaterial(r,n,!1);e.setMaterial(i)}_convertToDiamondMaterial(e,t={isDiamond:!0},r=!0){let i={...t??{}};i.isDiamond||i.isDiamondMaterialParameters?Array.isArray(i.boostFactors)&&(i.boostFactors=(new n.Pa4).fromArray(i.boostFactors)):i={isDiamondMaterialParameters:!0},i.color=i.color??e?.color??new xe(1,1,1),i.name=i.name??e?.name??"diamond";const s=this._viewer?.getManager()?.materials?.generateFromTemplate("diamond",i);if(s&&e&&!e.isDiamondMaterial&&(s.userData._baseMaterial=e.uuid),r){const n=e=>e.setMaterial??(t=>{e.material=t.materialObject});Array.from(e?.userData.__appliedMeshes??[]).forEach((e=>{n(e)(s),this.prepareDiamondMesh(e,t)}))}return s}_computeOffsets(e,r,i=!1){if(e.userData.normalsCaptureOffsets){if(null===(0,t.getUrlQueryParam)("recomputeOffsets"))return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const s=e.boundingBox.getCenter(new n.Pa4).toArray(),o=xc(e).toArray(),a=(new n.yGw).fromArray(o).invert(),l=(new n.Pa4).fromArray(s).applyMatrix4(a).toArray(),c={center:s,offsetMatrix:o,offsetMatrixInv:a.toArray(),radius:1,centerOffset:l};return e.userData.normalsCaptureOffsets=c,null!==(0,t.getUrlQueryParam)("recomputeOffsets")&&console.warn("recomputeOffsets",c),c}disposeCacheMap(e){this._normalCapture?.disposeTarget(e)}disposeAllCacheMaps(){this._normalCapture?.disposeAllTargets()}}Tc.PluginType="Diamond",Tc.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Mc([(0,t.onChange)(Tc.prototype.refreshEnvMaps),Oe()],Tc.prototype,"envMap",void 0),Mc([(0,t.onChange)(Tc.prototype.refreshEnvMaps),Oe()],Tc.prototype,"envMap2",void 0),Mc([(0,t.onChange)(Tc.prototype.refreshEnvMaps),Oe()],Tc.prototype,"envMap3",void 0),Mc([(0,t.onChange)(Tc.prototype.refreshEnvMaps),Oe()],Tc.prototype,"forceSceneEnvMap",void 0);const Dc=e=>({writeMaterial:(t,n)=>{t.isDiamondMaterial&&(n.extensions=n.extensions||{},n.extensions[Tc.DIAMOND_GLTF_EXTENSION]=t.toJSON(),e.extensionsUsed[Tc.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(t,n)=>{if(!t?.material.isDiamondMaterial)return;n.extensions=n.extensions||{};const r={};delete t.userData?.gltfExtensions?.[Tc.DIAMOND_GLTF_EXTENSION],t.userData._diamondNormalMapRes&&(r.normalMapRes=t.userData._diamondNormalMapRes),t.userData._diamondCacheKey&&(r.cacheKey=t.userData._diamondCacheKey),n.extensions[Tc.DIAMOND_GLTF_EXTENSION]=r,e.extensionsUsed[Tc.DIAMOND_GLTF_EXTENSION]=!0}});class Ic{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:r=1}){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=t.width*r*n,i.height=t.height*r*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const s=i.getContext("2d");if(!s)return console.error("snapshot: cannot create context"),i;const o=e.style.background||e.parentElement?.style.background||"";if(o.includes("url")){const r=/url\("(.*)"\)/gi.exec(o)?.[1];if(r){const o=new Image;o.src=r,await new Promise(((e,t)=>{o.onload=()=>e(),o.onerror=()=>t(),o.complete&&e()})),s.drawImage(o,o.width*t.x*n/e.width,o.height*t.y*n/e.height,o.width*t.width*n/e.width,o.height*t.height*n/e.height,0,0,i.width,i.height)}}else s.fillStyle=e.style.background||e.parentElement?.style.backgroundColor||"#00000000",s.fillRect(0,0,i.width,i.height);return s?.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,i.width,i.height),this.Debug&&(document.body.appendChild(i),i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.borderWidth="2px",i.style.borderColor="#ff00ff",setTimeout((()=>i.remove()),5e3)),i}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const r=await this.GetClonedCanvas(e,n),i=r.toDataURL(t);return this.Debug||r.remove(),i}static async GetImage(e,{mimeType:t="image/png",...n}={}){const r=await this.GetDataUrl(e,n);return new Promise(((e,t)=>{const n=new Image;n.onload=()=>{e(n)},n.src=r}))}static async GetBlob(e,t={}){const n=await this.GetClonedCanvas(e,t),r=await new Promise(((e,r)=>{n.toBlob((t=>{t?e(t):r()}),t.mimeType??"image/png")}));return this.Debug||n.remove(),r}static async GetFile(e,n="image.png",r={}){return r.getDataUrl?await this.GetDataUrl(e,r):new File([await this.GetBlob(e,r)],n,{type:r.mimeType??"image/png",lastModified:(0,t.now)()})}}Ic.Debug=!1;var Pc=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Rc=class extends qt{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(e,t={waitForProgressive:!0}){return t.getDataUrl=!1,await this._getFile(e||this.filename,t)}async getDataUrl(e={}){return e.getDataUrl=!0,await this._getFile("",e)??""}async _getFile(e,n={}){const r=this._viewer?.canvas;if(r){const i=this._viewer.renderer.displayCanvasScaling;void 0!==n.displayPixelRatio&&n.displayPixelRatio!==i&&(this._viewer.renderer.displayCanvasScaling=n.displayPixelRatio);const s=this._viewer?.getPlugin(sa);if(n.waitForProgressive&&s&&void 0===n.timeout)for(;!s.isConverged(!0);)await(0,t.timeout)(64);else await(0,t.timeout)(n.timeout??200);n.displayPixelRatio=1;const o=await Ic.GetFile(r,e,n);return n.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=i,o}}async downloadSnapshot(e,t={waitForProgressive:!0}){const n=await this.getFile(e,t);n&&await this._downloadBlob(n,n.name)}async _downloadBlob(e,t){const n=this._viewer?.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):this._viewer?.console.error("FileTransferPlugin required to export/download file")}};Rc.PluginType="CanvasSnipper",Pc([_t("Filename"),Oe()],Rc.prototype,"filename",void 0),Pc([gt("Download .png",{limitedUi:!0})],Rc.prototype,"downloadSnapshot",null),Rc=Pc([wt("Image Export")],Rc);var Bc=function(e){return function(t){return 1-e(1-t)}},kc=function(e){return function(t){return t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2}},Oc=function(e){return function(t){return Math.pow(t,e)}},Lc=function(e){return function(t){return t*t*((e+1)*t-e)}},Fc=function(e){var t=Lc(e);return function(e){return(e*=2)<1?.5*t(e):.5*(2-Math.pow(2,-10*(e-1)))}},Uc=function(e){return e},Nc=Oc(2),jc=Bc(Nc),zc=kc(Nc),Gc=function(e){return 1-Math.sin(Math.acos(e))},Vc=Bc(Gc),Hc=kc(Vc),Qc=Lc(1.525),Wc=Bc(Qc),qc=kc(Qc),Xc=Fc(1.525),Yc=function(e){if(1===e||0===e)return e;var t=e*e;return e<.36363636363636365?7.5625*t:e<.7272727272727273?9.075*t-9.9*e+3.4:e<.9?12.066481994459833*t-19.63545706371191*e+8.898060941828255:10.8*e*e-20.52*e+10.72},Kc=Bc(Yc),Jc=function(e){return e<.5?.5*(1-Yc(1-2*e)):.5*Yc(2*e-1)+.5},Zc=function(){return Zc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Zc.apply(this,arguments)};function $c(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create;var eu=function(){},tu=function(){},nu=function(e,t,n){return Math.min(Math.max(n,e),t)},ru=.001,iu=.01,su=10,ou=.05,au=1,lu=12;function cu(e,t){return e*Math.sqrt(1-t*t)}var uu=["duration","bounce"],hu=["stiffness","damping","mass"];function pu(e,t){return t.some((function(t){return void 0!==e[t]}))}function du(e){var t=e.from,n=void 0===t?0:t,r=e.to,i=void 0===r?1:r,s=e.restSpeed,o=void 0===s?2:s,a=e.restDelta,l=$c(e,["from","to","restSpeed","restDelta"]),c={done:!1,value:n},u=function(e){var t=Zc({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},e);if(!pu(e,hu)&&pu(e,uu)){var n=function(e){var t,n,r=e.duration,i=void 0===r?800:r,s=e.bounce,o=void 0===s?.25:s,a=e.velocity,l=void 0===a?0:a,c=e.mass,u=void 0===c?1:c;eu(i<=1e3*su,"Spring duration must be 10 seconds or less");var h=1-o;h=nu(ou,au,h),i=nu(iu,su,i/1e3),h<1?(t=function(e){var t=e*h,n=t*i,r=t-l,s=cu(e,h),o=Math.exp(-n);return ru-r/s*o},n=function(e){var n=e*h*i,r=n*l+l,s=Math.pow(h,2)*Math.pow(e,2)*i,o=Math.exp(-n),a=cu(Math.pow(e,2),h);return(-t(e)+ru>0?-1:1)*((r-s)*o)/a}):(t=function(e){return Math.exp(-e*i)*((e-l)*i+1)-ru},n=function(e){return Math.exp(-e*i)*(i*i*(l-e))});var p=function(e,t,n){for(var r=n,i=1;i<lu;i++)r-=e(r)/t(r);return r}(t,n,5/i);if(i*=1e3,isNaN(p))return{stiffness:100,damping:10,duration:i};var d=Math.pow(p,2)*u;return{stiffness:d,damping:2*h*Math.sqrt(u*d),duration:i}}(e);(t=Zc(Zc(Zc({},t),n),{velocity:0,mass:1})).isResolvedFromDuration=!0}return t}(l),h=u.stiffness,p=u.damping,d=u.mass,f=u.velocity,m=u.duration,g=u.isResolvedFromDuration,_=fu,v=fu;function y(){var e=f?-f/1e3:0,t=i-n,r=p/(2*Math.sqrt(h*d)),s=Math.sqrt(h/d)/1e3;if(null!=a||(a=Math.abs(i-n)<=1?.01:.4),r<1){var o=cu(s,r);_=function(n){var a=Math.exp(-r*s*n);return i-a*((e+r*s*t)/o*Math.sin(o*n)+t*Math.cos(o*n))},v=function(n){var i=Math.exp(-r*s*n);return r*s*i*(Math.sin(o*n)*(e+r*s*t)/o+t*Math.cos(o*n))-i*(Math.cos(o*n)*(e+r*s*t)-o*t*Math.sin(o*n))}}else if(1===r)_=function(n){return i-Math.exp(-s*n)*(t+(e+s*t)*n)};else{var l=s*Math.sqrt(r*r-1);_=function(n){var o=Math.exp(-r*s*n),a=Math.min(l*n,300);return i-o*((e+r*s*t)*Math.sinh(a)+l*t*Math.cosh(a))/l}}}return y(),{next:function(e){var t=_(e);if(g)c.done=e>=m;else{var n=1e3*v(e),r=Math.abs(n)<=o,s=Math.abs(i-t)<=a;c.done=r&&s}return c.value=c.done?i:t,c},flipTarget:function(){var e;f=-f,n=(e=[i,n])[0],i=e[1],y()}}}du.needsInterpolation=function(e,t){return"string"==typeof e||"string"==typeof t};var fu=function(e){return 0},mu=function(e,t,n){var r=t-e;return 0===r?1:(n-e)/r},gu=function(e,t,n){return-n*e+n*t+e},_u=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},vu=function(e){return e%1?Number(e.toFixed(5)):e},yu=/(-)?([\d]*\.?[\d])+/g,bu=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,Au=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function wu(e){return"string"==typeof e}var xu={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},Eu=Zc(Zc({},xu),{transform:_u(0,1)}),Cu=(Zc(Zc({},xu),{default:1}),function(e,t){return function(n){return Boolean(wu(n)&&Au.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t))}}),Su=function(e,t,n){return function(r){var i;if(!wu(r))return r;var s=r.match(yu),o=s[0],a=s[1],l=s[2],c=s[3];return(i={})[e]=parseFloat(o),i[t]=parseFloat(a),i[n]=parseFloat(l),i.alpha=void 0!==c?parseFloat(c):1,i}},Mu=_u(0,255),Tu=Zc(Zc({},xu),{transform:function(e){return Math.round(Mu(e))}}),Du={test:Cu("rgb","red"),parse:Su("red","green","blue"),transform:function(e){var t=e.red,n=e.green,r=e.blue,i=e.alpha,s=void 0===i?1:i;return"rgba("+Tu.transform(t)+", "+Tu.transform(n)+", "+Tu.transform(r)+", "+vu(Eu.transform(s))+")"}},Iu={test:Cu("#"),parse:function(e){var t="",n="",r="",i="";return e.length>5?(t=e.substr(1,2),n=e.substr(3,2),r=e.substr(5,2),i=e.substr(7,2)):(t=e.substr(1,1),n=e.substr(2,1),r=e.substr(3,1),i=e.substr(4,1),t+=t,n+=n,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:Du.transform},Pu=function(e){return{test:function(t){return wu(t)&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},Ru=(Pu("deg"),Pu("%")),Bu=(Pu("px"),Pu("vh"),Pu("vw"),Zc(Zc({},Ru),{parse:function(e){return Ru.parse(e)/100},transform:function(e){return Ru.transform(100*e)}}),{test:Cu("hsl","hue"),parse:Su("hue","saturation","lightness"),transform:function(e){var t=e.hue,n=e.saturation,r=e.lightness,i=e.alpha,s=void 0===i?1:i;return"hsla("+Math.round(t)+", "+Ru.transform(vu(n))+", "+Ru.transform(vu(r))+", "+vu(Eu.transform(s))+")"}}),ku=function(e,t,n){var r=e*e,i=t*t;return Math.sqrt(Math.max(0,n*(i-r)+r))},Ou=[Iu,Du,Bu],Lu=function(e){return Ou.find((function(t){return t.test(e)}))},Fu=function(e){return"'"+e+"' is not an animatable color. Use the equivalent color code instead."},Uu=function(e,t){var n=Lu(e),r=Lu(t);if(tu(!!n,Fu(e)),tu(!!r,Fu(t)),tu(n.transform===r.transform,"Both colors must be hex/RGBA, OR both must be HSLA."),!n||!r||n.transform!==r.transform)return function(n){return""+(n>0?t:e)};var i=n.parse(e),s=r.parse(t),o=Zc({},i),a=n===Bu?gu:ku;return function(e){for(var t in o)"alpha"!==t&&(o[t]=a(i[t],s[t],e));return o.alpha=gu(i.alpha,s.alpha,e),n.transform(o)}},Nu={test:function(e){return Du.test(e)||Iu.test(e)||Bu.test(e)},parse:function(e){return Du.test(e)?Du.parse(e):Bu.test(e)?Bu.parse(e):Iu.parse(e)},transform:function(e){return wu(e)?e:e.hasOwnProperty("red")?Du.transform(e):Bu.transform(e)}},ju="${c}",zu="${n}";function Gu(e){"number"==typeof e&&(e=""+e);var t=[],n=0,r=e.match(bu);r&&(n=r.length,e=e.replace(bu,ju),t.push.apply(t,r.map(Nu.parse)));var i=e.match(yu);return i&&(e=e.replace(yu,zu),t.push.apply(t,i.map(xu.parse))),{values:t,numColors:n,tokenised:e}}function Vu(e){return Gu(e).values}function Hu(e){var t=Gu(e),n=t.values,r=t.numColors,i=t.tokenised,s=n.length;return function(e){for(var t=i,n=0;n<s;n++)t=t.replace(n<r?ju:zu,n<r?Nu.transform(e[n]):vu(e[n]));return t}}var Qu=function(e){return"number"==typeof e?0:e},Wu={test:function(e){var t,n,r,i;return isNaN(e)&&wu(e)&&(null!==(n=null===(t=e.match(yu))||void 0===t?void 0:t.length)&&void 0!==n?n:0)+(null!==(i=null===(r=e.match(bu))||void 0===r?void 0:r.length)&&void 0!==i?i:0)>0},parse:Vu,createTransformer:Hu,getAnimatableNone:function(e){var t=Vu(e);return Hu(e)(t.map(Qu))}},qu={x:0,y:0,z:0},Xu=function(e){return"number"==typeof e},Yu=function(e,t){return function(n){return t(e(n))}},Ku=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(Yu)};function Ju(e,t){return Xu(e)?function(n){return gu(e,t,n)}:Nu.test(e)?Uu(e,t):th(e,t)}var Zu=function(e,t){var n=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],e),r=n.length,i=e.map((function(e,n){return Ju(e,t[n])}));return function(e){for(var t=0;t<r;t++)n[t]=i[t](e);return n}},$u=function(e,t){var n=Zc(Zc({},e),t),r={};for(var i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=Ju(e[i],t[i]));return function(e){for(var t in r)n[t]=r[t](e);return n}};function eh(e){for(var t=Wu.parse(e),n=t.length,r=0,i=0,s=0,o=0;o<n;o++)r||"number"==typeof t[o]?r++:void 0!==t[o].hue?s++:i++;return{parsed:t,numNumbers:r,numRGB:i,numHSL:s}}var th=function(e,t){var n=Wu.createTransformer(t),r=eh(e),i=eh(t);return r.numHSL===i.numHSL&&r.numRGB===i.numRGB&&r.numNumbers>=i.numNumbers?Ku(Zu(r.parsed,i.parsed),n):(eu(!0,"Complex values '"+e+"' and '"+t+"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition."),function(n){return""+(n>0?t:e)})},nh=function(e,t){return function(n){return gu(e,t,n)}};function rh(e,t,n){var r=void 0===n?{}:n,i=r.clamp,s=void 0===i||i,o=r.ease,a=r.mixer,l=e.length;tu(l===t.length,"Both input and output ranges must be the same length"),tu(!o||!Array.isArray(o)||o.length===l-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),e[0]>e[l-1]&&(e=[].concat(e),t=[].concat(t),e.reverse(),t.reverse());var c=function(e,t,n){for(var r=[],i=n||("number"==typeof(c=e[0])?nh:"string"==typeof c?Nu.test(c)?Uu:th:Array.isArray(c)?Zu:"object"==typeof c?$u:void 0),s=e.length-1,o=0;o<s;o++){var a=i(e[o],e[o+1]);if(t){var l=Array.isArray(t)?t[o]:t;a=Ku(l,a)}r.push(a)}var c;return r}(t,o,a),u=2===l?function(e,t){var n=e[0],r=e[1],i=t[0];return function(e){return i(mu(n,r,e))}}(e,c):function(e,t){var n=e.length,r=n-1;return function(i){var s=0,o=!1;if(i<=e[0]?o=!0:i>=e[r]&&(s=r-1,o=!0),!o){for(var a=1;a<n&&!(e[a]>i||a===r);a++);s=a-1}var l=mu(e[s],e[s+1],i);return t[s](l)}}(e,c);return s?function(t){return u(nu(e[0],e[l-1],t))}:u}function ih(e,t){return e.map((function(){return t||zc})).splice(0,e.length-1)}function sh(e){var t=e.from,n=void 0===t?0:t,r=e.to,i=void 0===r?1:r,s=e.ease,o=e.offset,a=e.duration,l=void 0===a?300:a,c={done:!1,value:n},u=Array.isArray(i)?i:[n,i],h=function(e,t){return e.map((function(e){return e*t}))}(o&&o.length===u.length?o:function(e){var t=e.length;return e.map((function(e,n){return 0!==n?n/(t-1):0}))}(u),l);function p(){return rh(h,u,{ease:Array.isArray(s)?s:ih(u,s)})}var d=p();return{next:function(e){return c.value=d(e),c.done=e>=l,c},flipTarget:function(){u.reverse(),d=p()}}}function oh(e){var t=e.velocity,n=void 0===t?0:t,r=e.from,i=void 0===r?0:r,s=e.power,o=void 0===s?.8:s,a=e.timeConstant,l=void 0===a?350:a,c=e.restDelta,u=void 0===c?.5:c,h=e.modifyTarget,p={done:!1,value:i},d=o*n,f=i+d,m=void 0===h?f:h(f);return m!==f&&(d=m-i),{next:function(e){var t=-d*Math.exp(-e/l);return p.done=!(t>u||t<-u),p.value=p.done?m:m+t,p},flipTarget:function(){}}}var ah={keyframes:sh,spring:du,decay:oh},lh=1/60*1e3,ch="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},uh="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout((function(){return e(ch())}),lh)},hh=!0,ph=!1,dh=!1,fh={delta:0,timestamp:0},mh=["read","update","preRender","render","postRender"],gh=mh.reduce((function(e,t){return e[t]=function(e){var t=[],n=[],r=0,i=!1,s=new WeakSet,o={schedule:function(e,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);var l=a&&i,c=l?t:n;return o&&s.add(e),-1===c.indexOf(e)&&(c.push(e),l&&i&&(r=t.length)),e},cancel:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1),s.delete(e)},process:function(e){var a;if(i=!0,t=(a=[n,t])[0],(n=a[1]).length=0,r=t.length)for(var l=0;l<r;l++){var c=t[l];c(e),s.has(c)&&(o.schedule(c),ph=!0)}i=!1}};return o}(),e}),{}),_h=mh.reduce((function(e,t){var n=gh[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),ph||Ah(),n.schedule(e,t,r)},e}),{}),vh=mh.reduce((function(e,t){return e[t]=gh[t].cancel,e}),{}),yh=function(e){return gh[e].process(fh)},bh=function(e){ph=!1,fh.delta=hh?lh:Math.max(Math.min(e-fh.timestamp,40),1),fh.timestamp=e,dh=!0,mh.forEach(yh),dh=!1,ph&&(hh=!1,uh(bh))},Ah=function(){ph=!0,hh=!0,dh||uh(bh)},wh=function(){return fh},xh=_h;function Eh(e,t,n){return void 0===n&&(n=0),e-t-n}var Ch=function(e){var t=function(t){var n=t.delta;return e(n)};return{start:function(){return xh.update(t,!0)},stop:function(){return vh.update(t)}}};function Sh(e){var t,n,r,i,s,o=e.from,a=e.autoplay,l=void 0===a||a,c=e.driver,u=void 0===c?Ch:c,h=e.elapsed,p=void 0===h?0:h,d=e.repeat,f=void 0===d?0:d,m=e.repeatType,g=void 0===m?"loop":m,_=e.repeatDelay,v=void 0===_?0:_,y=e.onPlay,b=e.onStop,A=e.onComplete,w=e.onRepeat,x=e.onUpdate,E=$c(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),C=E.to,S=0,M=E.duration,T=!1,D=!0,I=function(e){if(Array.isArray(e.to))return sh;if(ah[e.type])return ah[e.type];var t=new Set(Object.keys(e));return t.has("ease")||t.has("duration")&&!t.has("dampingRatio")?sh:t.has("dampingRatio")||t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta")?du:sh}(E);(null===(n=(t=I).needsInterpolation)||void 0===n?void 0:n.call(t,o,C))&&(s=rh([0,100],[o,C],{clamp:!1}),o=0,C=100);var P=I(Zc(Zc({},E),{from:o,to:C}));return l&&(null==y||y(),(r=u((function(e){if(D||(e=-e),p+=e,!T){var t=P.next(Math.max(0,p));i=t.value,s&&(i=s(i)),T=D?t.done:p<=0}null==x||x(i),T&&(0===S&&(null!=M||(M=p)),S<f?function(e,t,n,r){return r?e>=t+n:e<=-n}(p,M,v,D)&&(S++,"reverse"===g?p=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=!0),r?Eh(t+-e,t,n):t-(e-t)+n}(p,M,v,D=S%2==0):(p=Eh(p,M,v),"mirror"===g&&P.flipTarget()),T=!1,w&&w()):(r.stop(),A&&A()))}))).start()),{stop:function(){null==b||b(),r.stop()}}}const Mh={linear:Uc,easeIn:Nc,easeOut:jc,easeInOut:zc,circIn:Gc,circOut:Vc,circInOut:Hc,backIn:Qc,backOut:Wc,backInOut:qc,anticipate:Xc,bounceOut:Yc,bounceIn:Kc,bounceInOut:Jc,easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2}};function Th(e,t,n){const r=e[t],i=()=>{"function"==typeof e?.setDirty&&e.setDirty(),n?.()};return r.isVector3||r.isVector2||r.isVector4?e=>{r.copy(e),i()}:n=>{e[t]=n,i()}}function Dh(e){return"boolean"!=typeof e}async function Ih(e,n,r,i){n in e||console.error("invalid key",n,e);const s=Th(e,n),o=e[n],a=e=>{s(e),r.onUpdate?.(e)};if(Dh(o))return"function"==typeof r.to&&(r={...r,to:r.to(o,e)}),Ph({...r,from:o,onUpdate:a},i);{const{duration:e}=r;return(0,t.timeout)(e??0).then((()=>a(r.to)))}}async function Ph(e,t){const n=e.onComplete,r=e.onStop;return e={...e},new Promise(((i,s)=>{e.onComplete=()=>{try{n?.()}catch(e){return void s(e)}i()},e.onStop=()=>{try{r?.()}catch(e){return void s(e)}i()};const o=Sh(e);t&&t.push(o)}))}var Rh=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Bh=1,kh=class{constructor(e,t,r,i,s){this.position=new n.Pa4,this.target=new n.Pa4,this.quaternion=new n._fP,this.up=new n.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=At(this.name,this),e&&(this.position=e),t&&(this.target=t),r&&(this.up=r),i&&(this.quaternion=i),s&&(this.snap=s),this.name="#view"+Bh++}_nameChanged(){this.uiConfig&&(this.uiConfig.label=this.name,this.uiConfig.uiRefresh?.())}};Rh([Oe(),ft()],kh.prototype,"position",void 0),Rh([Oe(),ft()],kh.prototype,"target",void 0),Rh([Oe(),ft()],kh.prototype,"quaternion",void 0),Rh([Oe(),ft()],kh.prototype,"up",void 0),Rh([Oe(),_t()],kh.prototype,"name",void 0),Rh([yt()],kh.prototype,"snap",void 0),Rh([gt()],kh.prototype,"focusView",void 0),Rh([gt()],kh.prototype,"deleteView",void 0),kh=Rh([Ge("CameraView")],kh);class Oh extends qt{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex((t=>t.u===e)),1)}),this.focusNext=(e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2)return;let t=this._cameraViews.findIndex((e=>e===this._currentView));t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex((e=>e===this._currentView));t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map((e=>e.uiConfig))],...bt(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){if(this.enabled&&!this._animating&&this.seekOnScroll){const t=this._viewer?.scene.activeCamera;if(!t)return;const r=new n.$V,i=t.position,s=t.target,o=(new n._fP).setFromUnitVectors(t.cameraObject.up,new n.Pa4(0,1,0)),a=o.clone().invert(),l=i.clone().sub(s);l.applyQuaternion(o),r.setFromVector3(l),r.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,r.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,r.makeSafe(),l.setFromSpherical(r),l.applyQuaternion(a),i.copy(s).add(l),t.positionUpdated(!1),t.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",(e=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)})),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&(this._viewer.getPluginByType("FrameFade")?.enable(Oh.PluginType),this._fadeDisabled=!1));const e=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let n=e-this._lastFrameTime;this._lastFrameTime=e,n*=this.animateOnScroll?this._scrollAnimationState:1;const r=this._viewer.getPluginByType("Progressive")?.postFrameConvergedRecordingDelta();if(r&&r>0&&(n=r),0!==r&&(n*=1e3,!(n<=0||(this._updaters.forEach((e=>{let t=n;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)})),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(Oh.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(0===this._viewQueue.length){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,t.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,t.timeout)(2))}async recordAllViews(e,t=!0){if(!this.enabled)return;const n=this._viewer?.getPluginByType("CanvasRecorder");if(n&&n.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!n.isRecording())return new Promise(((r,i)=>{const s=()=>{n.removeEventListener("start",o),n.removeEventListener("stop",s),n.removeEventListener("error",a)},o=async()=>{s(),e?.(),await this.animateAllViews();const i=await n.stopRecording();if(t){const e=await(this._viewer?.prompt("Canvas Recorder: Save file as","recording.mp4"));null!==e&&i&&await this._downloadBlob(i,e||"recording.mp4")}r(i)},a=async()=>{s(),i()};n.addEventListener("start",o),n.addEventListener("stop",s),n.addEventListener("error",a),n.startRecording()||console.error("cannot start recording")}));console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){if(!this.enabled)return;const e=this._viewer?.scene.activeCamera;if(!e)return;const t=this.getCurrentCameraView(e);t.snap=await(this._viewer?.getPlugin(Rc)?.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(t)}addView(e){this._cameraViews.push(e),this.uiConfig.uiRefresh?.(),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0){if(e||(e=this._viewer?.scene.activeCamera),!e)return new kh;const r=new n.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const i=e.cameraObject.matrixWorld;r.x=i.elements[4],r.y=i.elements[5],r.z=i.elements[6],r.normalize();const s=e.target.clone(),o=e.position.clone(),a=e.cameraObject.parent;a&&(t?o.applyMatrix4(a.matrixWorld):r.transformDirection(a.matrixWorld.clone().invert()));const l=new kh(o,s,r,t?e.cameraObject.getWorldQuaternion(new n._fP):e.cameraObject.quaternion.clone(),"");return l.focusView=async()=>this.focusView(l),l.deleteView=()=>this.deleteView(l),l}setCurrentCameraView(e){const t=this._viewer?.scene.activeCamera;t&&(t.position.copy(e.position),t.target.copy(e.target),t.cameraObject.up.copy(e.up),t.cameraObject.quaternion.copy(e.quaternion),t.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){const t=this._cameraViews.indexOf(e);t>=0&&this._cameraViews.splice(t,1),this.uiConfig.uiRefresh?.(),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach((e=>e?.stop?.())),this._popAnimations=[];this._animating||this._animationLooping;)await(0,t.timeout)(100)}async animateToView(e,r,i,s=!1){const o=this._viewer?.scene.activeCamera;if(!o)return;if(this._animating){this._popAnimations.forEach((e=>e?.stop&&e.stop())),this._popAnimations=[];let e=0;for(;this._animating&&(await(0,t.timeout)(100),!(e++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),void 0===r&&(r=this.animDuration),r=Math.max(10,r);const a="function"==typeof i?i:Mh[i||this.animEase],l=this._driver,c=[];this._popAnimations=[];const u=this._popAnimations;if("spherical"===this.interpolateMode)c.push(async function(e,t,r,i,s,o){const a=e.target.clone(),l=new n.Pa4,c=new n.Pa4,u=e.cameraObject.parent,h=e.cameraObject.up.clone(),p=Lh({position:e.cameraObject.getWorldPosition(new n.Pa4),up:u?h.transformDirection(u.matrixWorld):h},a),d=Lh(t,t.target),f=new n.$V;function m(){e.position.copy(u?u.worldToLocal(c):c),e.target.copy(l),e.positionUpdated()}return Ph({from:0,to:1,duration:r,ease:i,driver:s,onUpdate:e=>{f.phi=Fh(p.phi,d.phi,e),f.theta=Fh(p.theta,d.theta,e),f.radius=g(p.radius,d.radius,e),l.copy(a).lerp(t.target,e),c.setFromSpherical(f),c.add(l),m()},onComplete:()=>{c.copy(t.position),l.copy(t.target),m()},onStop:()=>{throw new Error("Animation Stopped")}},o)}(o,e,r,a,l,u));else if("linear"===this.interpolateMode){c.push(Ph({from:o.position.clone(),to:e.position.clone(),duration:r,ease:a,driver:l,onUpdate:e=>o.position=e,onComplete:()=>o.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},u)),c.push(Ph({from:o.target.clone(),to:e.target.clone(),duration:r,ease:a,driver:l,onUpdate:e=>{o.target=e,o.targetUpdated()},onComplete:()=>{o.target=e.target,o.targetUpdated()}},u));const t=o.cameraObject.quaternion.clone(),i=new n._fP;c.push(Ph({from:0,to:1,duration:r,ease:a,driver:l,onUpdate:n=>{i.copy(t).slerp(e.quaternion,n),o.cameraObject.quaternion.copy(i),o.cameraObject.updateProjectionMatrix()},onComplete:()=>{o.cameraObject.quaternion.copy(e.quaternion),o.cameraObject.updateProjectionMatrix()}},u))}await Promise.allSettled(c).catch((e=>{if(s)throw e})),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,t.timeout)(10)}fromJSON(e,t){return this._cameraViews.forEach((e=>this.deleteView(e))),super.fromJSON(e,t)?(this._cameraViews.forEach((e=>e.focusView=async()=>this.focusView(e))),this._cameraViews.forEach((e=>e.deleteView=()=>this.deleteView(e))),this.uiConfig.uiRefresh?.(),this):null}async animateToObject(e,t=4,r,i,s={min:.5,max:5}){if(!this._viewer)return;const o=(new v).expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4).length()/2;await this.animateToTarget(Math.min(s.max,Math.max(s.min,l*t)),a,r,i)}async animateToFitObject(e,t=1.5,r=1e3,i,s={min:.5,max:50}){if(!this._viewer)return;const o=(new v).expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4);let c=this._viewer.scene.activeCamera.cameraObject,u=1;if(c.isPerspectiveCamera){const e=c.fov*(Math.PI/180),t=2*Math.atan(Math.tan(e/2)*c.aspect),n=l.z/2+Math.abs(l.x/2/Math.tan(t/2)),r=l.z/2+Math.abs(l.y/2/Math.tan(e/2));u=Math.max(n,r)}await this.animateToTarget(Math.min(s.max,Math.max(s.min,u*t)),a,r,i)}async animateToTarget(e,t,r,i){const s=this.getCurrentCameraView();s.target.copy(t);const o=(new n.Pa4).subVectors(s.target,s.position).normalize();s.position.copy(o.multiplyScalar(-e).add(s.target)),await this.animateToView(s,r,i)}async _downloadBlob(e,t){const n=this._viewer?.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):this._viewer?.console.error("FileTransferPlugin required to export/download file")}}function Lh(e,t){const r=e.position.clone();r.sub(t);const i=(new n.$V).setFromVector3(r);return i.makeSafe(),i}function Fh(e,t,n){const r=t-e;return r>=Math.PI?e+(r-2*Math.PI)*n:r<=-Math.PI?e+(r+2*Math.PI)*n:e+r*n}function Uh(e,t,n){const r=(1-n)*Math.cos(e)+n*Math.cos(t),i=(1-n)*Math.sin(e)+n*Math.sin(t);return Math.atan2(i,r)}Oh.PluginType="CameraViews",Rh([Oe("cameraViews")],Oh.prototype,"_cameraViews",void 0),Rh([(0,t.onChange)(Oh.prototype._animationLoop),Oe(),ht("Loop All Views",{limitedUi:!0})],Oh.prototype,"viewLooping",void 0),Rh([Oe(),_t("View Pause Time")],Oh.prototype,"viewPauseTime",void 0),Rh([Oe(),mt("Ease",Object.keys(Mh).map((e=>({label:e}))))],Oh.prototype,"animEase",void 0),Rh([Oe(),dt("Duration",[10,1e4],10,{limitedUi:!0})],Oh.prototype,"animDuration",void 0),Rh([Oe(),dt("RotationOffset",[.2,.75],.01)],Oh.prototype,"rotationOffset",void 0),Rh([Oe(),mt("Interpolation",["spherical","linear"].map((e=>({label:e}))))],Oh.prototype,"interpolateMode",void 0),Rh([ht(),Oe()],Oh.prototype,"seekOnScroll",void 0),Rh([gt("Animate All Views",{limitedUi:!0})],Oh.prototype,"animateAllViews",null),Rh([gt("Record All Views")],Oh.prototype,"recordAllViews",null),Rh([gt("Add Current View")],Oh.prototype,"addCurrentView",null),Rh([gt("Focus Next")],Oh.prototype,"focusNext",void 0),Rh([gt("Focus Previous")],Oh.prototype,"focusPrevious",void 0);const Nh=new n.Pa4;function jh(e,t,n){let r=e.dot(t);r=Math.min(Math.max(r,-1),1);const i=Math.acos(r)*n;return Nh.copy(e).multiplyScalar(r).sub(t).negate().normalize(),e.multiplyScalar(Math.cos(i)).add(Nh.multiplyScalar(Math.sin(i)))}var zh,Gh=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Vh=zh=class{constructor(e){this.enabled=!1,this.power=.5,this.bgcolor=new n.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new n.Ilk}},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=e.getPlugin(xo),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = Vignette(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,n){this.enabled&&(t.materialObject.uniforms.power.value=this.power,t.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this.__setDirty?.(),this._setDirty()}};Vh.PluginType="Vignette",Gh([(0,t.onChange)(zh.prototype._setDirty),ht("Enable"),Oe()],Vh.prototype,"enabled",void 0),Gh([(0,t.onChange)(zh.prototype._setDirty),dt("Power",[.1,4],.01,{limitedUi:!0}),Oe()],Vh.prototype,"power",void 0),Gh([(0,t.onChange)(zh.prototype._setDirty),vt("Color"),Oe()],Vh.prototype,"bgcolor",void 0),Vh=zh=Gh([wt("Vignette")],Vh);class Hh extends Co{constructor(){super()}generateExtension(e){return new Vh(e)}get power(){return this._extension?.power??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){return this._extension?.bgcolor??new n.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}Hh.PluginType="Vignette";var Qh=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Wh=class extends qt{constructor(){super(),this.enabled=!0,this.dependencies=[fo],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const e=await(0,t.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(e)}async loadScenes(e){const t=await Promise.all(e.map((async e=>await e.arrayBuffer())));for(let n=0;n<e.length;n++){const r=e[n];this.scenes.push({[r.name]:new Uint8Array(t[n])}),this.assets[r.name]={path:r.name,file:r}}this.uiConfig?.uiRefresh?.()}async play(){if(!this._viewer)return;if(this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e&&(e.enabled=!1);const n=this._viewer.getPluginByType("FrameFade"),r=this._viewer.getPluginByType("GLTFAnimation"),i=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const s of this.scenes){if(!this._isPlaying)break;const o=Object.keys(s);r?.stopAnimation(!1),await(i?.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const e of o){let t=this.assets[e];t||(t={path:e,file:new File([s[e]],e)},this.assets[e]=t),await(this._viewer.getManager()?.addAssetSingle(t,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),n&&(n.enabled=!0,await n.startTransition(1e3));const a=[(0,t.timeout)(this.minSceneTime)];r&&a.push(r.playAnimation()),i&&a.push(i.animateAllViews()),await Promise.all(a)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const e={};for(const t of this.scenes)for(const n of Object.keys(t)){const r=e[n]?n+"_":n;e[r]=t[r]}const n=to(e),r=new Blob([n],{type:"application/zip"});(0,t.downloadBlob)(r,"scenes.glbloop")}async onAdded(e){await super.onAdded(e);const n=this;e.getManager()?.importer?.Importers.push(new _n(class extends lo{load(e,r,i,s){super.load(e,(e=>{n.loadScenes([...e.values()]),r?.(null),(0,t.timeout)(100).then(n.play)}),i,s)}},["glbloop"],!0))}};Wh.PluginType="SceneLoopPlugin",Qh([pt("Loaded scenes")],Wh.prototype,"loadedScenes",null),Qh([gt("Load Scenes")],Wh.prototype,"promptLoadScenes",null),Qh([pt("Playing")],Wh.prototype,"_isPlaying",void 0),Qh([_t("Min Scene Time")],Wh.prototype,"minSceneTime",void 0),Qh([gt("Play")],Wh.prototype,"play",null),Qh([gt("Stop")],Wh.prototype,"stop",null),Qh([gt("Download Scenes")],Wh.prototype,"downloadScenes",null),Wh=Qh([wt("Scene Loop")],Wh);var qh=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Xh=class extends Vt{constructor(e,t,r){super(e,t,r??new Yh,new n.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(e,t,n,r,i){if(!this.enabled||!this.camera)return;const s=this.overrideMaterial;s.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(e,t,n,r,i),s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value)}};qh([ht("Enabled")],Xh.prototype,"enabled",void 0),Xh=qh([wt("Velocity Buffer (TAA)")],Xh);class Yh extends n.jyz{constructor(){super({vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){\n#include <uv_vertex>\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\nvec4 mvPosition=vec4(transformed,1.);\n#ifdef USE_INSTANCING\nmvPosition=instanceMatrix*mvPosition;\n#endif\nvWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n}",fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new n.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new n.Vkp},currentProjectionViewMatrix:{value:new n.yGw},lastProjectionViewMatrix:{value:new n.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:(new n.yGw).identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,r,i,s){const o=this._previousWorldMatrices[s.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(o??s.matrixWorld),o?o.copy(s.matrixWorld):this._previousWorldMatrices[s.uuid]=s.matrixWorld.clone();let a=s.material;Array.isArray(a)&&(a=a[0]),this.uniforms.alphaMap.value=a?.alphaMap??null,this.uniforms.alphaTest.value=!a||!a.alphaTest||a.alphaTest<1e-7?.001:a.alphaTest;let l=this.uniforms.alphaMap.value?1:void 0;l!==this.defines.USE_ALPHAMAP&&(void 0===l?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=l,this.needsUpdate=!0),l=a.userData.ALPHA_I_RGBA_PACKING?1:void 0,l!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===l?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=l,this.needsUpdate=!0),this.side=a.side??n.ehD}}class Kh extends Yt{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:n.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const r=new Set,i=new Set;return new class extends Xh{render(n,s,o,a,l){if(e.renderer.frameCount>0)return;const c=n.getRenderTarget(),u=n.getActiveCubeFace(),h=n.getActiveMipmapLevel();this.scene?.traverse((({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(r.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(i.add([e,e.transmission]),e.transmission=0))})),Y(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},(()=>super.render(n,s,t,a,l))),r.forEach((e=>e.transparent=!e.transparent)),r.clear(),i.forEach((([e,t])=>e.transmission=t)),i.clear(),n.setRenderTarget(c,u,h)}}}_update(e){if(!super._update(e))return!1;if(e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach((t=>e.renderer.disposeTarget(t?.dispose?.()))),super.onRemove(e)}updateShaderProperties(e){return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?this.getVelocityBuffer()?.texture??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){return this.pass?.passObject.uiConfig}}Kh.PluginType="VelocityBuffer";var Jh,Zh=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let $h=Jh=class{constructor(e){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?"#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)\nuniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;\n#if USE_3DTEXTURE == 1\nprecision highp sampler3D;\n#if USE_LUT == 1\nuniform sampler3D lut3d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler3D lut3d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler3D lut3d2;\n#endif\n#else\n#if USE_LUT == 1\nuniform sampler2D lut2d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler2D lut2d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler2D lut2d2;\n#endif\nvec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}\n#endif\nint getLUTBit(in int number){\n#ifdef WebGL2Context\nreturn number%2;\n#else\nreturn int(mod(float(number),2.));\n#endif\n}int getLUTIndex(in int number){\n#ifdef WebGL2Context\nreturn number%8;\n#else\nreturn int(mod(float(number),8.));\n#endif\n}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));\n#if USE_3DTEXTURE == 1\nif(lutIndex==0.){\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);\n#endif\n}else{\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}\n#else\nif(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);\n#endif\n}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}\n#endif\noutColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}\n#endif\n":"",this._viewer=e,this._combinedPostPlugin=e.getPlugin(xo),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const e=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let t=e?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,t,this.extraUniforms.lutSize,e),this.extraDefines.USE_LUT=this.lutMap?1:0,t=e?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,t,this.extraUniforms.lutSize1,e),this.extraDefines.USE_LUT1=this.lutMap1?1:0,t=e?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,t,this.extraUniforms.lutSize2,e),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=e,this._setDirty()}_updateLUTMap(e,t,n,r){if(e){let i=1;1==r?(t.value=e.texture3D,i=e.texture3D.image.width):e.texture&&(t.value=e.texture,i=e.texture.image.width),t.value.needsUpdate=!0,n.value=i}}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            #if USE_LUT == 1\n                bool isBackground = getDepth(vUv)>0.9999;\n                #if LUT_BACKGROUND == 1\n                    gl_FragColor = colorLookUp(gl_FragColor);\n                #else\n                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);\n                #endif\n            #endif\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this.__setDirty?.(),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function ep(e){const t=e?.userData;if(!t)return!1;t[tp.PluginType]||(t[tp.PluginType]={});const n=t[tp.PluginType];return n.enable=!0,void 0===n.index&&(n.index=0),e.isMaterial&&(e.needsUpdate=!0),!0}Zh([Oe(),(0,t.onChange)(Jh.prototype._updateParams),ht("Enable")],$h.prototype,"enabled",void 0),Zh([Oe(),(0,t.onChange)(Jh.prototype._updateParams),ht("LUT Background")],$h.prototype,"lutBackground",void 0),Zh([Oe(),(0,t.onChange)(Jh.prototype._updateParams),dt("Intensity")],$h.prototype,"intensity",void 0),Zh([(0,t.onChange)(Jh.prototype._updateParams),yt("LUT"),Oe()],$h.prototype,"lutMap",void 0),Zh([(0,t.onChange)(Jh.prototype._updateParams),yt("LUT1"),Oe()],$h.prototype,"lutMap1",void 0),Zh([(0,t.onChange)(Jh.prototype._updateParams),yt("LUT2"),Oe()],$h.prototype,"lutMap2",void 0),$h=Jh=Zh([wt("LUT")],$h);class tp extends Co{_getUiConfig(e){const t={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData[tp.PluginType]?.enable??!0},set value(n){const r=e.materialObject.userData[tp.PluginType];n!==r?.enable&&(r||ep(e.materialObject),e.materialObject.userData[tp.PluginType].enable=n,t.uiRefresh?.("postFrame",!0))},onChange:this._extension?.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map((e=>({label:e[0],value:e[1]}))),label:"index",hidden:()=>{const t=e.materialObject.userData[tp.PluginType];return!!t&&!t.enable},get value(){return e.materialObject.userData[tp.PluginType]?.index??0},set value(n){e.materialObject.userData[tp.PluginType]||ep(e.materialObject),e.materialObject.userData[tp.PluginType].index=n,t.uiRefresh?.("postFrame",!0)},onChange:this._extension?.setDirty}]};return t}constructor(){super(),this.materialExtension={uuid:lt(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData[tp.PluginType]?.enable?"1":"0"),isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){await super.onAdded(e),e.getPlugin($t)?.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new $h(e)}updateGBuffer(e,t){if(e instanceof n.Kj0&&e.material?.userData){const n=e.material?.userData[tp.PluginType];if(n){const e=!1===n.enable?0:1;t.w=So(t.w,0,e);for(let e=0;e<3;e++)t.y=Mo(t.y,e);let r=n.enable?n.index:0;r=Math.min(r,7),t.y=t.y|r}else t.w=So(t.w,0,1)}}}tp.PluginType="LUTPlugin1";class np{constructor(e){this._zee=new n.Pa4(0,0,1),this._euler=new n.USm,this._q0=new n._fP,this._q1=new n._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new n._fP,this._initQuaternionDest=new n._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new n.FM8;this.getQuaternion(e,this._q2);const t=new n.Pa4(0,0,1);return t.applyQuaternion(this._q2),new n.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new n._fP),!this.deviceOrientation)return t.identity();const r=this.deviceOrientation,i=null!==r.alpha?n.M8C.degToRad(r.alpha):0,s=null!==r.beta?n.M8C.degToRad(r.beta):0,o=null!==r.gamma?n.M8C.degToRad(r.gamma):0,a=this.screenOrientation?n.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,i,s,o,a,e),t}_toQuaternion(e,t,n,r,i,s){this._euler.set(n,t,-r,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const o=document.getElementById("debug");return o&&(o.textContent=i+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-i)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),s&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return void 0!==window.DeviceOrientationEvent&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),this._viewer?.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),"function"==typeof DeviceMotionEvent.requestPermission&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))})).catch((e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)})))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new n._fP)}}class rp{constructor(){this._mousePos=new n.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new n.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var ip,sp=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let op=ip=class extends qt{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new n.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new n.Pa4,this._center=new n.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{if(!this.enabled)return void this._object._updateProjectionMatrixParallax?.();const e=this._object,t=e.near;let r=t*Math.tan(.5*n.M8C.DEG2RAD*e.fov)/e.zoom,i=2*r,s=e.aspect*i,o=-.5*s;if(null!==e.view&&e.view.enabled){const t=e.view.fullWidth,n=e.view.fullHeight;o+=e.view.offsetX*s/t,r-=e.view.offsetY*i/n,s*=e.view.width/t,i*=e.view.height/n}o-=this._offX*t/this._focalDistance,r-=this._offY*t/this._focalDistance;const a=e.filmOffset;0!==a&&(o+=t*a/e.getFilmWidth()),e.projectionMatrix.makePerspective(o,o+s,r,r-i,t,e.far),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()},this._preFrame=e=>{this.update(e.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new t.Damper,this._yDamper=new t.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(e){await super.onAdded(e),np.IsCompatible()?this._input=new np(e):this._input=new rp,e.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),e.addEventListener("preFrame",this._preFrame),this._viewer?.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),this._viewer?.container.addEventListener("pointerup",this.onPointerUp.bind(this)),e.getPluginByType("Picking")?.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){this._object&&this._object?._updateProjectionMatrixParallax&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=this._viewer?.scene.activeCamera.cameraObject,this._object?.isOrthographicCamera?this._viewer?.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",this._viewer?.container.appendChild(this._indicator))}onPointerDown(e){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=e.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=e.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(e){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const t=this._object.matrixWorld.elements,r=new n.Pa4(t[0],t[1],t[2]),i=new n.Pa4(t[4],t[5],t[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let s=this.sensitivity;this.invert&&(s*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*s,e,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*s,e,1);const o=this._object;o.position.add(i.multiplyScalar(this._offY)).add(r.multiplyScalar(this._offX)),o.updateProjectionMatrix(),o.updateMatrixWorld(),this._dirty=!0}_onObjectHit(e){e.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(e.intersects.intersect.point),e.intersects.selectedObject=null,this.uiConfig?.uiRefresh?.("postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout((()=>{this._indicator.style.opacity="0",setTimeout((()=>this._indicator.style.display="none"),600),this.uiConfig?.uiRefresh?.("postFrame",!0)}),200)))}_updateFocalDistance(){if(!this._object)return;const e=this._object,t=new n.Pa4;e.getWorldDirection(t),t.normalize(),this._focalDistance=this.focalPointHit.clone().sub(e.position).dot(t)}_onEnabledChange(){if(this._viewer){if(this.enabled){if(this._input?.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const e=this._viewer.getPluginByType("CameraViews"),t=e?.camViews.find((e=>e.name===this.cameraView));e&&t&&e.setCurrentCameraView(t),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const e=this._object;e.updateProjectionMatrix(),e.updateMatrixWorld()}this.uiConfig?.uiRefresh?.("postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){this._input?.disconnect()}};op.PluginType="ParallaxCameraControllerPlugin",sp([(0,t.onChange)(ip.prototype._onEnabledChange),Oe(),ht("Enabled")],op.prototype,"enabled",void 0),sp([Oe(),ht("enableEdit")],op.prototype,"enableEdit",void 0),sp([Oe(),ht("Invert")],op.prototype,"invert",void 0),sp([Oe(),dt("Sensitivity",[.1,2],.01)],op.prototype,"sensitivity",void 0),sp([Oe("focalPoint"),ft("Focal Point Hit",void 0,.001)],op.prototype,"focalPointHit",void 0),sp([(0,t.onChange)(ip.prototype._onDampingChange),Oe(),dt("Damping",[0,1],.001)],op.prototype,"damping",void 0),sp([Oe(),_t("Camera View")],op.prototype,"cameraView",void 0),op=ip=sp([wt("Parallax Camera Controller")],op);var ap=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let lp=class extends qt{addNoiseBumpMaterial(e){return cp(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new up(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this._uniforms={noiseBumpParams:{value:new n.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new n.Ltg(0,1,3,0)},flakeFallOffParams:{value:new n.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&t?.materialObject.userData._noiseBumpMat?.hasBump?zo+"\n#ifndef VORONOI_HELPER\n#define VORONOI_HELPER \nfloat voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}\n#endif\n\nuniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n":"",shaderExtender:(e,t,n)=>{if(!this.enabled||!t.materialObject.userData._noiseBumpMat?.hasBump)return;const r="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(r,"vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\nvec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}\n#endif\n\n"+r),e.defines.USE_UV="",e.extensionDerivatives=!0},onObjectRender:(e,t)=>{const n=t.materialObject.userData?._noiseBumpMat;if(!n?.hasBump)return;this._uniforms.noiseBumpParams.value.fromArray(n.bumpNoiseParams),this._uniforms.noiseBumpScale.value=n.bumpScale,this._uniforms.noiseBumpFlakeScale.value=n.flakeScale,this._uniforms.noiseFlakeClamp.value=n.flakeClamp,this._uniforms.noiseFlakeRadius.value=n.flakeRadius,n.flakeParams&&this._uniforms.flakeParams.value.copy(n.flakeParams),n.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(n.flakeFallOffParams),this._uniforms.useColorFlakes.value=n.useColorFlakes;const r=this.enabled?1:0;t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==r&&(t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._noiseBumpMat?.hasBump?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._noiseBumpMat?.hasBump||!1},set value(r){r!==e.materialObject.userData._noiseBumpMat?.hasBump&&(r?cp(e.materialObject)||t.alert("Cannot add noise bump."):e.materialObject.userData._noiseBumpMat&&(e.materialObject.userData._noiseBumpMat.hasBump=!1,e.materialObject.needsUpdate=!0),n.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeParams,"x"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeParams,"y"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeParams,"z"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeParams,"w"],onChange:this.setDirty}),()=>({type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeFallOffParams,"x"],onChange:this.setDirty}),()=>({type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeFallOffParams,"y"],onChange:this.setDirty}),()=>({type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat?.flakeFallOffParams,"z"],onChange:this.setDirty}),()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>!e.materialObject.userData._noiseBumpMat?.hasBump,property:[e.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(hp)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function cp(e){const t=e?.userData;if(!t)return!1;t._noiseBumpMat||(t._noiseBumpMat={});const r=t._noiseBumpMat;return r.hasBump=!0,void 0===r.bumpNoiseParams&&(r.bumpNoiseParams=[.5,.5]),void 0===r.bumpScale&&(r.bumpScale=.05),void 0===r.flakeScale&&(r.flakeScale=.05),void 0===r.flakeClamp&&(r.flakeClamp=1),void 0===r.flakeRadius&&(r.flakeRadius=.3),void 0===r.useColorFlakes&&(r.useColorFlakes=!1),void 0===r.flakeParams&&(r.flakeParams=new n.Ltg(0,1,3,0)),void 0===r.flakeFallOffParams&&(r.flakeFallOffParams=new n.Pa4(0,1,0)),e.isMaterial&&(e.needsUpdate=!0),!0}lp.PluginType="NoiseBumpMaterialPlugin",lp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",ap([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],lp.prototype,"enabled",void 0),lp=ap([wt("NoiseBumpMaterial Materials")],lp);class up{constructor(e){this.parser=e,this.name=lp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),cp(t),t.userData._noiseBumpMat=je(r,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const hp=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._noiseBumpMat)return;if(!t.userData._noiseBumpMat.hasBump)return;n.extensions=n.extensions||{};const r=Ne(t.userData._noiseBumpMat,!1);n.extensions[lp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=r,e.extensionsUsed[lp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class pp extends Gt{constructor(e,t){super({vertexShader:r.vertexShader,fragmentShader:t+"\n"+Tl+"\n#include <common>\nvarying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;\n#if HAS_VELOCITY_BUFFER == 1\nuniform sampler2D tVelocity;\n#endif\nvec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}\n#if HAS_VELOCITY_BUFFER == 0\nvec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}\n#endif\nvec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;\n#if QUALITY == 1\nvec3 c_frag=find_closest_fragment_3x3(vUv);\n#else\nvec3 c_frag=find_closest_fragment_5tap(vUv);\n#endif\nif(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);\n#if HAS_VELOCITY_BUFFER == 0\nvec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);\n#else\nvec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));\n#endif\ngl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}\n#include <encodings_fragment>\n}",uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new n.FM8},cameraNearFar:{value:new n.FM8},lastProjectionViewMatrix:{value:new n.yGw},currentProjectionViewMatrix:{value:new n.yGw},projection:{value:new n.yGw},inverseViewMatrix:{value:new n.yGw},jitterSample:{value:new n.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new n.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,r,i){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const s=this.uniforms.tVelocity.value?1:0;s!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=s,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,r,i),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}!function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe(),Q()],pp.prototype,"feedBack",void 0);class dp extends Yt{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[$t],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(sa))throw"Add ProgressivePlugin before TAA";const t=new pp(e.getPlugin(sa).lastFrame,e.getPlugin($t).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){this._viewer?.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1,!n.taaEnabled)return!1;const r=e.scene.activeCamera;return n.updateShaderProperties([e.getPlugin($t),r,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(sa).lastFrame,n.updateCameraProperties(r?.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){return this._viewer?.renderer.stableNoise??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){const e=this.pass?.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}dp.PluginType="TAA";var fp=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let mp=class extends qt{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=e=>{if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const e=this._lastFsElement||this._viewer?.canvas;e&&(e.style.width=this._lastSize[0],e.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(e){if(this.isFullScreen())return;const t=e||this._viewer?.canvas;return t?(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(e){return this.isFullScreen()?this.exit():this.enter(e)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||void 0!==document.msFullscreenElement}};mp.PluginType="FullScreenPlugin",fp([gt("Enter FullScreen")],mp.prototype,"enter",null),fp([gt("Exit FullScreen")],mp.prototype,"exit",null),fp([gt("Toggle FullScreen")],mp.prototype,"toggle",null),mp=fp([wt("Full Screen")],mp);const gp=(e,t)=>{const n={};for(const r of e.mappings)for(const e of r.variants)n[t[e]]={material:null,gltfMaterialIndex:r.material};return n},_p="KHR_materials_variants";class vp{constructor(e){this.parser=e,this.name=_p}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const r=(e=>{const t=[],n=new Set;for(const r of e){let e=r,i=0;for(;n.has(e);)e=r+"."+ ++i;n.add(e),t.push(e)}return t})((n.extensions[this.name].variants||[]).map((e=>e.name)));for(const i of e.scenes)i.traverse((e=>{const i=t.associations.get(e);if(!i||void 0===i.meshes||void 0===i.primitives)return;const s=n.meshes[i.meshes].primitives[i.primitives].extensions;s&&s[this.name]&&(e.userData._variantMaterials=gp(s[this.name],r))}));await Promise.all(e.scenes.map((async e=>{const n=[];return e.traverse((e=>{return void 0!==(r=e).material&&r.userData&&r.userData._variantMaterials&&n.push((async e=>{const n=e.material,r=e.userData._variantMaterials,i=[];for(const n in r){const s=r[n];if(s.material)continue;const o=s.gltfMaterialIndex;i.push(t.getDependency("material",o).then((i=>{e.material=i,t.assignFinalMaterial(e),r[n].material=e.material})))}return Promise.all(i).then((()=>{e.material=n}))})(e));var r})),e.userData.__importData||(e.userData.__importData={}),e.userData.__importData[_p]={names:r},Promise.all(n)})))}}const yp=e=>void 0!==e.material&&e.userData&&e.userData._variantMaterials&&!!Object.values(e.userData._variantMaterials).filter((e=>bp(e?.material))),bp=e=>e&&e.isMaterial&&!Array.isArray(e);class Ap{constructor(e){this.writer=e,this.name=_p,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse((e=>{if(!yp(e))return;const n=e.userData._variantMaterials;for(const e in n){const r=n[e];bp(r.material)&&t.add(e)}}));t.forEach((e=>this.variantNames.push(e)))}writeMesh(e,t){if(!yp(e))return;const n=e.userData,r=n._variantMaterials,i={};for(const e in r){const t=r[e].material;if(!bp(t))continue;const n=this.variantNames.indexOf(e),s=this.writer.processMaterial(t);i[s]||(i[s]={material:s,variants:[]}),i[s].variants.push(n)}const s=Object.values(i).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===s.length)return;const o=bp(n._originalMaterial)?this.writer.processMaterial(n._originalMaterial)??-1:-1;for(const e of t.primitives)o>=0&&(e.material=o),e.extensions=e.extensions||{},e.extensions[this.name]={mappings:s}}afterParse(e){if(0===this.variantNames.length)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map((e=>({name:e})));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function wp(e){return new Ap(e)}class xp extends qt{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[fo],this.variants={},this.selectedVariant="",this._objectAdded=e=>{const t=e.object;"model"===t?.assetType&&t.modelObject&&this._viewer&&(t.modelObject.traverse((e=>{if(e.userData._variantMaterials)for(const t of Object.values(e.userData._variantMaterials))t?.material&&(t.material=this._viewer?.getManager()?.materials?.processMaterial(t.material,{})||t.material);const t=e.userData?.__importData?.[_p];if(!t)return;const n=t.names||[];for(const t of n)this.variants[t]||(this.variants[t]=[]),this.variants[t].push(e);delete e.userData.__importData[_p]})),this.uiConfig.uiRefresh?.())},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map((e=>e?{label:e}:{label:"none",value:""})),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(fo);t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(wp)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new vp(e)))}async onRemove(e){e.scene.removeEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(fo);t.importer?.removeEventListener("loaderCreate",this._loaderCreate);const n=t.exporter?.getExporter("gltf","glb")?.extensions?.indexOf(wp);return void 0!==n&&-1!==n&&t.exporter.getExporter("gltf","glb")?.extensions?.splice(n,1),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,r=!0){if(!t&&!n&&this.selectedVariant===e)return;if(!e)return;n||(this.selectedVariant=e);const i=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const t of i){const n=new Set,i=t=>{if(!t.userData._variantMaterials||n.has(t))return;const r=e?t.userData._variantMaterials[e]?.material:t.userData._originalMaterial;r&&(t.userData._originalMaterial||(t.userData._originalMaterial=t.material),t?.setMaterial?.(r)),n.add(t)};r?t.traverse(i):i(t)}}}function Ep(e){const t=e?.userData;if(!t)return!1;t._ssBevel||(t._ssBevel={});const n=t._ssBevel;return n.hasSSBevel=!0,void 0===n.radius&&(n.radius=0),e.isMaterial&&(e.needsUpdate=!0),!0}xp.PluginType="GLTFKHRMaterialVariantsPlugin",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([(0,t.onChange)(xp.prototype._variantChanged)],xp.prototype,"selectedVariant",void 0);let Cp=class extends Gt{constructor(e,r,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new n.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new n.Pa4(1,1,1)}},vertexShader:jo,fragmentShader:`\n\n            ${i}\n\n            ${zo}\n\n            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;\n#include <common>\nfloat getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}\n            \n            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,n)=>{this.enabled&&t.materialObject.userData?._ssBevel?.hasSSBevel&&(e.fragmentShader=Lt(e.fragmentShader,"#include <normal_fragment_maps>"," \n                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;\n                normal = normalize(normal);\n                //geometryNormal = normal;\n            "))},onObjectRender:(e,t,n)=>{if(!this.enabled||!t.materialObject.userData?._ssBevel?.hasSSBevel)return;const r=t.materialObject,i=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==i&&(this.materialExtension.extraUniforms.tSSBevelMap.value=i,r.needsUpdate=!0)},getUiConfig:e=>{const t={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._ssBevel?.hasSSBevel||!1},set value(n){n!==e.materialObject.userData._ssBevel?.hasSSBevel&&(n?Ep(e.materialObject)||alert("Cannot add screen space bevel."):e.materialObject.userData._ssBevel&&(e.materialObject.userData._ssBevel.hasSSBevel=!1,e.materialObject.needsUpdate=!0),t.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>!e.materialObject.userData._ssBevel?.hasSSBevel,property:[e.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return t},parsFragmentSnippet:(e,n)=>this.enabled&&n?.materialObject.userData?._ssBevel?.hasSSBevel?t.glsl`
            uniform sampler2D tSSBevelMap;
            ${Go}
            `:"",extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._ssBevel?.hasSSBevel?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2},this._target=r,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new Nt({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new n.FM8(1,1)},cameraPositionWorld:{value:new n.Pa4(1,1,1)}},vertexShader:jo,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new Nt({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new n.FM8(.5,.5)},direction:{value:new n.FM8(.5,.5)}},vertexShader:jo,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(e,t,r,i,s){if(!this.enabled)return;const o=e.baseRenderer,a={minFilter:n.wem,magFilter:n.wem,isAntialiased:!1,format:n.wk1,depthBuffer:!1,generateMipmaps:!1},l=o.getTempTarget(a);this._renderEdges(o,l),this._blurEdges(o,l),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),this._viewerApp.getPlugin($t)?.updateShaderProperties(this.material),this._viewerApp.getPlugin(Fl)?.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=l.texture,super.render(e,this._target,l,i,s),o.releaseTempTarget(l)}_initsamples(){const e=[],t=1/8;return e.push(new n.FM8(-8,0).multiplyScalar(t)),e.push(new n.FM8(-6,-4).multiplyScalar(t)),e.push(new n.FM8(-3,-2).multiplyScalar(t)),e.push(new n.FM8(-2,-6).multiplyScalar(t)),e.push(new n.FM8(1,-1).multiplyScalar(t)),e.push(new n.FM8(2,-5).multiplyScalar(t)),e.push(new n.FM8(6,-7).multiplyScalar(t)),e.push(new n.FM8(5,-3).multiplyScalar(t)),e.push(new n.FM8(4,1).multiplyScalar(t)),e.push(new n.FM8(7,4).multiplyScalar(t)),e.push(new n.FM8(3,5).multiplyScalar(t)),e.push(new n.FM8(0,7).multiplyScalar(t)),e.push(new n.FM8(-1,3).multiplyScalar(t)),e.push(new n.FM8(-4,6).multiplyScalar(t)),e.push(new n.FM8(-7,8).multiplyScalar(t)),e.push(new n.FM8(-5,2).multiplyScalar(t)),e}_blurEdges(e,t){const r={minFilter:n.wem,magFilter:n.wem,isAntialiased:!1,format:n.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},i=e.getTempTarget(r),s=t.texture.image?.width||1,o=t.texture.image?.height||1;this._separableBlurMaterial.uniforms.texSize.value=new n.FM8(s,o),this._separableBlurMaterial.uniforms.colorTexture.value=t.texture,this._separableBlurMaterial.uniforms.direction.value=new n.FM8(1,0),e.blit(void 0,i,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new n.FM8(s/2,o/2),this._separableBlurMaterial.uniforms.colorTexture.value=i.texture,this._separableBlurMaterial.uniforms.direction.value=new n.FM8(0,1),e.blit(void 0,t,{material:this._separableBlurMaterial}),e.releaseTempTarget(i)}_renderEdges(e,t){const r=t.texture.image?.width||1,i=t.texture.image?.height||1;this._edgeMaterial.uniforms.screenSize.value=new n.FM8(r,i),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),this._viewerApp.getPlugin($t)?.updateShaderProperties(this._edgeMaterial),this._viewerApp.getPlugin(Fl)?.updateShaderProperties(this._edgeMaterial),e.blit(void 0,t,{material:this._edgeMaterial})}};Cp=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("SSBevel")],Cp);class Sp extends Yt{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[fo,$t,Fl],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Mp(e)))}passCtor(e){this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:n.cLu,minFilter:n.TyD,magFilter:n.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const t=e.getPluginByType("debug");return t&&t.addTexture("tempBuffer",(()=>this._bevelTarget.texture),[440,50,400,200]),new Cp(e.renderer,this._bevelTarget,e.getPlugin($t)?.getUnpackSnippet()??"",e)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);return this.pass?.passObject.materialExtension&&t?.materials?.registerMaterialExtension(this.pass?.passObject.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(Tp),e.getPlugin($t)?.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){this._viewer?.setDirty(),this.pass?.passObject.materialExtension.setDirty?.()}_update(e){let t=this.enabled;if(t&&!this._lastEnabled){const e=this._viewer?.getPluginByType("NormalBufferPlugin");e&&!e.enabled&&(e.enabled=!0),e||this._viewer?.console.error("SSBevelPlugin needs NormalBufferPlugin")}return this._lastEnabled=t,t}get uiConfig(){const e=this.pass?.passObject?.uiConfig??{};return e.children?.map((e=>(0,t.getOrCall)(e)))?.flat(2).forEach((e=>e&&(e.onChange=this.setDirty))),e}updateGBuffer(e,t){if(e instanceof n.Kj0&&e.material?.userData){for(let e=3;e<8;e++)t.y=Mo(t.y,e);let n=e.material?.userData._ssBevel?e.material?.userData._ssBevel.radius:0;n=Math.min(n,31),n<<=3,t.y=t.y|n}}}Sp.PluginType="SSBevelPlugin",Sp.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class Mp{constructor(e){this.parser=e,this.name=Sp.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),Ep(t),t.userData._ssBevel=je(r,t.userData._ssBevel,!1,{}),Promise.resolve()}}const Tp=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._ssBevel)return;if(!t.userData._ssBevel.hasSSBevel)return;n.extensions=n.extensions||{};const r=Ne(t.userData._ssBevel,!1);n.extensions[Sp.SSBEVEL_GLTF_EXTENSION]=r,e.extensionsUsed[Sp.SSBEVEL_GLTF_EXTENSION]=!0}});class Dp{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = LinearTosRGB(gl_FragColor);\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class Ip extends Co{generateExtension(e){return new Dp}}Ip.PluginType="GammaCorrection";var Pp=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Rp=class extends qt{addTriplanarMapping(e){const t=e.materialObject?.userData;return!!t&&(t._triplanarMapping||(t._triplanarMapping={}),t._triplanarMapping.enable=!0,void 0===t._triplanarMapping.scaleFactor&&(t._triplanarMapping.scaleFactor=1),void 0===t._triplanarMapping.blendFactor&&(t._triplanarMapping.blendFactor=1),void 0===t._triplanarMapping.offsetFactor&&(t._triplanarMapping.offsetFactor=0),e.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Bp(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(e,r,i)=>{if(!this.enabled||!r.materialObject.userData?._triplanarMapping?.enable)return;const s=t.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;e.vertexShader=Lt(e.vertexShader,"#include <common>",s,{prepend:!0});const o=t.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;e.vertexShader=Lt(e.vertexShader,"#include <worldpos_vertex>",o,{append:!0});const a=t.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;e.fragmentShader=Lt(e.fragmentShader,"#include <common>",a,{prepend:!0});const l=t.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;e.fragmentShader=Lt(e.fragmentShader,"#include <bumpmap_pars_fragment>",l);let c=Lt(n.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");e.fragmentShader=Lt(e.fragmentShader,"#include <map_fragment>",c),c=Lt(n.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),e.fragmentShader=Lt(e.fragmentShader,"#include <roughnessmap_fragment>",c),c=Lt(n.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),e.fragmentShader=Lt(e.fragmentShader,"#include <metalnessmap_fragment>",c),c=Lt(n.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),e.fragmentShader=Lt(e.fragmentShader,"#include <normal_fragment_maps>",c),e.defines.USE_UV=""},onObjectRender:(e,t)=>{const n=t.materialObject.userData;if(!n?._triplanarMapping?.enable)return;const r=e;r.isMesh&&r.geometry&&(this._uniforms.triplanarScale.value=n._triplanarMapping?.scaleFactor,this._uniforms.triplanarBlend.value=n._triplanarMapping?.blendFactor,this._uniforms.triplanarOffset.value=n._triplanarMapping?.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._triplanarMapping?.enable?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[this._viewer?.renderer],getUiConfig:e=>{const t=this._viewer,n=this.addTriplanarMapping,r={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._triplanarMapping?.enable||!1},set value(i){i!==e.materialObject.userData._triplanarMapping?.enable&&(i?n(e)||t.alert("Cannot add Triplanar mapping."):e.materialObject.userData._triplanarMapping&&(e.materialObject.userData._triplanarMapping.enable=!1,e.materialObject.needsUpdate=!0),r.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>!e.materialObject.userData._triplanarMapping?.enable,property:[e.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>!e.materialObject.userData._triplanarMapping?.enable,property:[e.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>!e.materialObject.userData._triplanarMapping?.enable,property:[e.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return r}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(kp)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Rp.PluginType="TriplanarUVMappingPlugin",Rp.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",Pp([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],Rp.prototype,"enabled",void 0),Rp=Pp([wt("Triplanar Mapping")],Rp);class Bp{constructor(e){this.parser=e,this.name=Rp.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];t.userData||(t.userData={});const i=t.userData;return i._triplanarMapping||(i._triplanarMapping={}),i._triplanarMapping.enable=!0,void 0===i._triplanarMapping.scaleFactor&&(i._triplanarMapping.scaleFactor=1),void 0===i._triplanarMapping.blendFactor&&(i._triplanarMapping.blendFactor=1),void 0===i._triplanarMapping.offsetFactor&&(i._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=je(r,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const kp=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._triplanarMapping?.enable)return;n.extensions=n.extensions||{};const r=Ne(t.userData._triplanarMapping,!1);n.extensions[Rp.TRIPLANAR_GLTF_EXTENSION]=r,e.extensionsUsed[Rp.TRIPLANAR_GLTF_EXTENSION]=!0}});var Op=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Lp=class extends qt{addClearcoatTint(e){return Fp(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register((e=>new Up(e)))}constructor(){super(),this.enabled=!0,this.dependencies=[fo],this._defines={},this._uniforms={ccTintColor:{value:new xe},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&t?.materialObject.userData._clearcoatTint?.enableTint&&t.materialObject.clearcoat>0?"\nuniform vec3 ccTintColor;\nuniform float ccThickness;\nuniform float ccIor;\nvec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {\n    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.\n    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law\n    return mix(vec3(1.0), tint, clearcoat);\n}\n        ":"",shaderExtender:(e,t,n)=>{if(!(this.enabled&&t?.materialObject.userData._clearcoatTint?.enableTint&&t.materialObject.clearcoat>0))return;const r="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",i="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";e.fragmentShader.includes(i)&&e.fragmentShader.includes(r)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),e.fragmentShader=e.fragmentShader.replace(i,"\n            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );\n            "),e.fragmentShader=e.fragmentShader.replace(r,"\n            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);\n            "+r),e.defines.USE_UV=""},onObjectRender:(e,t)=>{const n=t.materialObject.userData?._clearcoatTint;if(!n?.enableTint)return;this._uniforms.ccTintColor.value.set(n.tintColor),this._uniforms.ccThickness.value=n.thickness,this._uniforms.ccIor.value=n.ior;const r=this.enabled?1:0;t.materialObject.defines.CLEARCOAT_TINT_ENABLED!==r&&(t.materialObject.defines.CLEARCOAT_TINT_ENABLED=r,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>(this.enabled?"1":"0")+(e.materialObject.userData?._clearcoatTint?.enableTint?"1":"0")+(e.materialObject.clearcoat>0?"1":"0"),isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,n={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._clearcoatTint?.enableTint||!1},set value(r){r!==e.materialObject.userData._clearcoatTint?.enableTint&&(r?Fp(e.materialObject)||t.alert("Cannot add clearcoat tint."):e.materialObject.userData._clearcoatTint&&(e.materialObject.userData._clearcoatTint.enableTint=!1,e.materialObject.needsUpdate=!0),n.uiRefresh?.("postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>!e.materialObject.userData._clearcoatTint?.enableTint,property:[e.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>!e.materialObject.userData._clearcoatTint?.enableTint,property:[e.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>!e.materialObject.userData._clearcoatTint?.enableTint,property:[e.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{this.materialExtension.setDirty?.(),this._viewer?.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){await super.onAdded(e);const t=e.getPlugin(fo);t?.materials?.registerMaterialExtension(this.materialExtension),t?.importer?.addEventListener("loaderCreate",this._loaderCreate),t?.exporter?.getExporter("gltf","glb")?.extensions?.push(Np)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this.materialExtension),e.getPlugin(fo)?.importer?.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function Fp(e){const t=e?.userData;if(!t)return!1;t._clearcoatTint||(t._clearcoatTint={});const n=t._clearcoatTint;return n.enableTint=!0,void 0===n.tintColor&&(n.tintColor=16777215),void 0===n.thickness&&(n.thickness=.1),void 0===n.ior&&(n.ior=1.5),e.isMaterial&&(e.needsUpdate=!0),!0}Lp.PluginType="ClearcoatTintPlugin",Lp.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",Op([ht("Enabled",(e=>({onChange:e.setDirty}))),Oe()],Lp.prototype,"enabled",void 0),Lp=Op([wt("ClearcoatTint Materials")],Lp);class Up{constructor(e){this.parser=e,this.name=Lp.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),Fp(t),je(r,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const Np=e=>({writeMaterial:(t,n)=>{if(!t.isMeshStandardMaterial||!t.userData._clearcoatTint)return;if(!t.userData._clearcoatTint.enableTint)return;n.extensions=n.extensions||{};const r=Ne(t.userData._clearcoatTint,!1);n.extensions[Lp.CLEARCOAT_TINT_GLTF_EXTENSION]=r,e.extensionsUsed[Lp.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class jp{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:r}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,r)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((n=>{const r=this._getIdleWorker();-1!==r?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class zp{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Gp{constructor(e,t,n,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}new Uint8Array([0]);const Vp=[171,75,84,88,32,50,48,187,13,10,26,10];function Hp(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let Qp,Wp,qp;const Xp={env:{emscripten_notify_memory_growth:function(e){qp=new Uint8Array(Wp.exports.memory.buffer)}}};class Yp{init(){return Qp||(Qp="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Kp).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Xp))).then(this._init):WebAssembly.instantiate(Buffer.from(Kp,"base64"),Xp).then(this._init),Qp)}_init(e){Wp=e.instance,Xp.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Wp)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=Wp.exports.malloc(n);qp.set(e,r),t=t||Number(Wp.exports.ZSTD_findDecompressedSize(r,n));const i=Wp.exports.malloc(t),s=Wp.exports.ZSTD_decompress(i,t,r,n),o=qp.slice(i,i+s);return Wp.exports.free(r),Wp.exports.free(i),o}}const Kp="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Jp=new WeakMap;let Zp,$p=0;class ed extends n.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new jp,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new n.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new n.hH6(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const i=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then((([e,t])=>{const n=ed.BasisWorker,r=["/* constants */","let _EngineFormat = "+JSON.stringify(ed.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ed.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ed.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),$p>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),$p++}return this.transcoderPending}load(e,t,r,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new n.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{if(Jp.has(e))return Jp.get(e).promise.then(t).catch(i);this.createTexture(e).then((e=>t?t(e):null)).catch(i)}),r,i)}_createTextureFrom(e,t){const{mipmaps:r,width:i,height:s,format:o,type:a,error:l,dfdTransferFn:c,dfdFlags:u}=e;if("error"===a)return Promise.reject(l);const h=t.layerCount>1?new n.Z_g(r,i,s,t.layerCount,o,n.ywz):new n.EB7(r,i,s,o,n.ywz);return h.minFilter=1===r.length?n.wem:n.D1R,h.magFilter=n.wem,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=2===c?n.KI_:n.aCh,h.premultiplyAlpha=!!(1&u),h}async createTexture(e,t={}){const r=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,Vp.length);if(t[0]!==Vp[0]||t[1]!==Vp[1]||t[2]!==Vp[2]||t[3]!==Vp[3]||t[4]!==Vp[4]||t[5]!==Vp[5]||t[6]!==Vp[6]||t[7]!==Vp[7]||t[8]!==Vp[8]||t[9]!==Vp[9]||t[10]!==Vp[10]||t[11]!==Vp[11])throw new Error("Missing KTX 2.0 identifier.");const n=new zp,r=17*Uint32Array.BYTES_PER_ELEMENT,i=new Gp(e,Vp.length,r,!0);n.vkFormat=i._nextUint32(),n.typeSize=i._nextUint32(),n.pixelWidth=i._nextUint32(),n.pixelHeight=i._nextUint32(),n.pixelDepth=i._nextUint32(),n.layerCount=i._nextUint32(),n.faceCount=i._nextUint32();const s=i._nextUint32();n.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),a=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),u=i._nextUint64(),h=i._nextUint64(),p=new Gp(e,Vp.length+r,3*s*8,!0);for(let t=0;t<s;t++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const d=new Gp(e,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){const t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),f.samples[e]=t}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const g=new Gp(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),r=Hp(t),i=g._scan(e-t.byteLength);n.keyValue[r]=r.match(/^ktx/i)?Hp(i):i,g._offset%4&&g._skip(4-g._offset%4)}if(h<=0)return n;const _=new Gp(e,u,h,!0),v=_._nextUint16(),y=_._nextUint16(),b=_._nextUint32(),A=_._nextUint32(),w=_._nextUint32(),x=_._nextUint32(),E=[];for(let e=0;e<s;e++)E.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const C=u+_._offset,S=C+b,M=S+A,T=M+w,D=new Uint8Array(e.buffer,e.byteOffset+C,b),I=new Uint8Array(e.buffer,e.byteOffset+S,A),P=new Uint8Array(e.buffer,e.byteOffset+M,w),R=new Uint8Array(e.buffer,e.byteOffset+T,x);return n.globalData={endpointCount:v,selectorCount:y,imageDescs:E,endpointsData:D,selectorsData:I,tablesData:P,extendedData:R},n}(new Uint8Array(e));if(0!==r.vkFormat)return async function(e){const{vkFormat:t,pixelWidth:r,pixelHeight:i,pixelDepth:s}=e;if(void 0===td[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const o=e.levels[0];let a,l;if(0===e.supercompressionScheme)a=o.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Zp||(Zp=new Promise((async e=>{const t=new Yp;await t.init(),e(t)}))),a=(await Zp).decode(o.levelData,o.uncompressedByteLength)}l=nd[t]===n.VzW?new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):nd[t]===n.cLu?new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):a;const c=0===s?new n.IEO(l,r,i):new n.JUT(l,r,i,s);return c.type=nd[t],c.format=td[t],c.colorSpace=rd[t]||n.aCh,c.needsUpdate=!0,Promise.resolve(c)}(r);const i=t,s=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e]))).then((e=>this._createTextureFrom(e.data,r)));return Jp.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),$p--,this}}ed.BasisFormat={ETC1S:0,UASTC_4x4:1},ed.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},ed.EngineFormat={RGBAFormat:n.wk1,RGBA_ASTC_4x4_Format:n.ptH,RGBA_BPTC_Format:n.bsb,RGBA_ETC2_EAC_Format:n.ekQ,RGBA_PVRTC_4BPPV1_Format:n.eaV,RGBA_S3TC_DXT5_Format:n.ILR,RGB_ETC1_Format:n.fto,RGB_ETC2_Format:n.l0P,RGB_PVRTC_4BPPV1_Format:n._AM,RGB_S3TC_DXT1_Format:n.wuA},ed.BasisWorker="function () {\n\n\tlet config;\n\tlet transcoderPending;\n\tlet BasisModule;\n\n\tconst EngineFormat = _EngineFormat; // eslint-disable-line no-undef\n\tconst TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef\n\tconst BasisFormat = _BasisFormat; // eslint-disable-line no-undef\n\n\tself.addEventListener( 'message', function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tconfig = message.config;\n\t\t\t\tinit( message.transcoderBinary );\n\t\t\t\tbreak;\n\n\t\t\tcase 'transcode':\n\t\t\t\ttranscoderPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );\n\n\t\t\t\t\t\tconst buffers = [];\n\n\t\t\t\t\t\tfor ( let i = 0; i < mipmaps.length; ++ i ) {\n\n\t\t\t\t\t\t\tbuffers.push( mipmaps[ i ].data.buffer );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\tfunction init( wasmBinary ) {\n\n\t\ttranscoderPending = new Promise( ( resolve ) => {\n\n\t\t\tBasisModule = { wasmBinary, onRuntimeInitialized: resolve };\n\t\t\tBASIS( BasisModule ); // eslint-disable-line no-undef\n\n\t\t} ).then( () => {\n\n\t\t\tBasisModule.initializeBasis();\n\n\t\t\tif ( BasisModule.KTX2File === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tfunction transcode( buffer ) {\n\n\t\tconst ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );\n\n\t\tfunction cleanup() {\n\n\t\t\tktx2File.close();\n\t\t\tktx2File.delete();\n\n\t\t}\n\n\t\tif ( ! ktx2File.isValid() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file' );\n\n\t\t}\n\n\t\tconst basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;\n\t\tconst width = ktx2File.getWidth();\n\t\tconst height = ktx2File.getHeight();\n\t\tconst layers = ktx2File.getLayers() || 1;\n\t\tconst levels = ktx2File.getLevels();\n\t\tconst hasAlpha = ktx2File.getHasAlpha();\n\t\tconst dfdTransferFn = ktx2File.getDFDTransferFunc();\n\t\tconst dfdFlags = ktx2File.getDFDFlags();\n\n\t\tconst { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );\n\n\t\tif ( ! width || ! height || ! levels ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid texture' );\n\n\t\t}\n\n\t\tif ( ! ktx2File.startTranscoding() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader: .startTranscoding failed' );\n\n\t\t}\n\n\t\tconst mipmaps = [];\n\n\t\tfor ( let mip = 0; mip < levels; mip ++ ) {\n\n\t\t\tconst layerMips = [];\n\n\t\t\tlet mipWidth, mipHeight;\n\n\t\t\tfor ( let layer = 0; layer < layers; layer ++ ) {\n\n\t\t\t\tconst levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );\n\t\t\t\tmipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;\n\t\t\t\tmipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;\n\t\t\t\tconst dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );\n\t\t\t\tconst status = ktx2File.transcodeImage(\n\t\t\t\t\tdst,\n\t\t\t\t\tmip,\n\t\t\t\t\tlayer,\n\t\t\t\t\t0,\n\t\t\t\t\ttranscoderFormat,\n\t\t\t\t\t0,\n\t\t\t\t\t- 1,\n\t\t\t\t\t- 1,\n\t\t\t\t);\n\n\t\t\t\tif ( ! status ) {\n\n\t\t\t\t\tcleanup();\n\t\t\t\t\tthrow new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );\n\n\t\t\t\t}\n\n\t\t\t\tlayerMips.push( dst );\n\n\t\t\t}\n\n\t\t\tmipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );\n\n\t\t}\n\n\t\tcleanup();\n\n\t\treturn { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };\n\n\t}\n\n\t//\n\n\t// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),\n\t// device capabilities, and texture dimensions. The list below ranks the formats separately\n\t// for ETC1S and UASTC.\n\t//\n\t// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at\n\t// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently\n\t// chooses RGBA32 only as a last resort and does not expose that option to the caller.\n\tconst FORMAT_OPTIONS = [\n\t\t{\n\t\t\tif: 'astcSupported',\n\t\t\tbasisFormat: [ BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],\n\t\t\tpriorityETC1S: Infinity,\n\t\t\tpriorityUASTC: 1,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'bptcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],\n\t\t\tpriorityETC1S: 3,\n\t\t\tpriorityUASTC: 2,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'dxtSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],\n\t\t\tpriorityETC1S: 4,\n\t\t\tpriorityUASTC: 5,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc2Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],\n\t\t\tpriorityETC1S: 1,\n\t\t\tpriorityUASTC: 3,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc1Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC1_Format ],\n\t\t\tpriorityETC1S: 2,\n\t\t\tpriorityUASTC: 4,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'pvrtcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],\n\t\t\tengineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],\n\t\t\tpriorityETC1S: 5,\n\t\t\tpriorityUASTC: 6,\n\t\t\tneedsPowerOfTwo: true,\n\t\t},\n\t];\n\n\tconst ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityETC1S - b.priorityETC1S;\n\n\t} );\n\tconst UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityUASTC - b.priorityUASTC;\n\n\t} );\n\n\tfunction getTranscoderFormat( basisFormat, width, height, hasAlpha ) {\n\n\t\tlet transcoderFormat;\n\t\tlet engineFormat;\n\n\t\tconst options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;\n\n\t\tfor ( let i = 0; i < options.length; i ++ ) {\n\n\t\t\tconst opt = options[ i ];\n\n\t\t\tif ( ! config[ opt.if ] ) continue;\n\t\t\tif ( ! opt.basisFormat.includes( basisFormat ) ) continue;\n\t\t\tif ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;\n\t\t\tif ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;\n\n\t\t\ttranscoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];\n\t\t\tengineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];\n\n\t\t\treturn { transcoderFormat, engineFormat };\n\n\t\t}\n\n\t\tconsole.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );\n\n\t\ttranscoderFormat = TranscoderFormat.RGBA32;\n\t\tengineFormat = EngineFormat.RGBAFormat;\n\n\t\treturn { transcoderFormat, engineFormat };\n\n\t}\n\n\tfunction isPowerOfTwo( value ) {\n\n\t\tif ( value <= 2 ) return true;\n\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n\t}\n\n\t/** Concatenates N byte arrays. */\n\tfunction concat( arrays ) {\n\n\t\tlet totalByteLength = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\ttotalByteLength += array.byteLength;\n\n\t\t}\n\n\t\tconst result = new Uint8Array( totalByteLength );\n\n\t\tlet byteOffset = 0;\n\n\t\tfor ( let i = 0; i < arrays.length; i ++ ) {\n\n\t\t\tconst array = arrays[ i ];\n\t\t\tresult.set( array, byteOffset );\n\n\t\t\tbyteOffset += array.byteLength;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}";const td={109:n.wk1,97:n.wk1,37:n.wk1,43:n.wk1,103:n.av9,83:n.av9,16:n.av9,22:n.av9,100:n.hEm,76:n.hEm,15:n.hEm,9:n.hEm},nd={109:n.VzW,97:n.cLu,37:n.ywz,43:n.ywz,103:n.VzW,83:n.cLu,16:n.ywz,22:n.ywz,100:n.VzW,76:n.cLu,15:n.ywz,9:n.ywz},rd={43:n.KI_,22:n.KI_,15:n.KI_},id="KHR_texture_basisu";class sd extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo]}async onAdded(e){this._importer||(this._importer=new _n(class extends ed{constructor(t){super(t),this.setTranscoderPath(sd.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(e,t){const n=new Uint8Array(e.slice(0)),r=await super.createTexture(e,t);return r.source._sourceImgBuffer=n,r.userData.mimeType="image/ktx2",r.toJSON=e=>Ve(r,e,r.name,"image/ktx2"),r.clone=()=>{throw new Error("ktx2 texture cloning not supported")},r}},["ktx2"],!1)),e.getManager()?.importer?.Importers.push(this._importer),e.getManager()?.exporter?.getExporter("gltf","glb")?.extensions?.push(od)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}sd.PluginType="KTX2LoadPlugin",sd.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const od=e=>({writeTexture:(t,n)=>{if("image/ktx2"!==t.userData.mimeType)return;if(void 0!==n.source&&null!==n.source)return void console.warn("ktx2 export: source already set");const r=t.source._sourceImgBuffer||t.userData.__sourceBuffer;if(!r)return void console.warn("ktx2 export: no source buffer for ktx2");n.extensions=n.extensions||{};const i={},s=new Blob([r],{type:"image/ktx2"});i.source=e.processImageBlob(s,t),n.extensions[id]=i,e.extensionsUsed[id]=!0}});var ad=__webpackgi_require__(701),ld=__webpackgi_require__.n(ad),cd=__webpackgi_require__(236),ud=__webpackgi_require__.n(cd),hd=__webpackgi_require__(850),pd=__webpackgi_require__.n(hd),dd=__webpackgi_require__(182),fd=__webpackgi_require__.n(dd),md=__webpackgi_require__(213),gd=__webpackgi_require__.n(md),_d=__webpackgi_require__(44),vd={};_d.Z&&_d.Z.locals&&(vd.locals=_d.Z.locals);var yd,bd=0,Ad={};Ad.styleTagTransform=gd(),Ad.setAttributes=pd(),Ad.insert=function(e,t){(t.target||document.head).appendChild(e)},Ad.domAPI=ud(),Ad.insertStyleElement=fd(),vd.use=function(e){return Ad.options=e||{},bd++||(yd=ld()(_d.Z,Ad)),vd},vd.unuse=function(){bd>0&&! --bd&&(yd(),yd=null)};var wd=vd;class xd extends qt{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[fo],this._mainDiv=(0,t.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,t.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){await super.onAdded(e),e.container.appendChild(this._mainDiv);const t=new Map;this._updateMainDiv(t),e.getManager()?.importer?.addEventListener("importFile",(e=>{"done"!==e.state?t.set(e.path,{state:e.state,progress:e.progress?100*e.progress:void 0}):t.delete(e.path),this._updateMainDiv(t)})),e.getManager()?.exporter?.addEventListener("exportFile",(e=>{"done"!==e.state?t.set(e.obj.name,{state:e.state,progress:e.progress?100*e.progress:void 0}):t.delete(e.obj.name),this._updateMainDiv(t)})),e.getPluginByType("FileTransferPlugin")?.addEventListener("transferFile",(e=>{"done"!==e.state?t.set(e.path,{state:e.state,progress:e.progress?100*e.progress:void 0}):t.delete(e.path),this._updateMainDiv(t)})),e.getPluginByType("MaterialConfiguratorPlugin")?.addEventListener("progress",(e=>{"done"!==e.state?t.set("MatpreviewGeneration",{state:e.state,progress:0}):t.delete("MatpreviewGeneration"),this._updateMainDiv(t)})),e.getPluginByType("SwitchNodePlugin")?.addEventListener("progress",(e=>{"done"!==e.state?t.set("SwitchNodeGeneration",{state:e.state,progress:0}):t.delete("SwitchNodeGeneration"),this._updateMainDiv(t)})),e.getPluginByType("ThemePlugin")?.addEventListener("progress",(e=>{"done"!==e.state?t.set("ThemeInit",{state:e.state,progress:0}):t.delete("ThemeInit"),this._updateMainDiv(t)}))}}!function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([ht("Enabled"),(0,t.onChange)(xd.prototype._onEnabledChange),Oe()],xd.prototype,"enabled",void 0);let Ed=class extends xd{constructor(e=!0){super("LoadingBar"),this.showText=e}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t=1,n=1;e.forEach(((e,r)=>{t+=e.progress??99,n+=100})),this._contentDiv.innerHTML=this.showText?(100*t/n).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*t/n).toFixed(0)+"%",0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){wd.use({target:e.container}),await super.onAdded(e)}};Ed.PluginType="AssetManagerLoadingBarPlugin",Ed=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("Asset manager loading bar")],Ed);var Cd=__webpackgi_require__(798),Sd={};Cd.Z&&Cd.Z.locals&&(Sd.locals=Cd.Z.locals);var Md,Td=0,Dd={};Dd.styleTagTransform=gd(),Dd.setAttributes=pd(),Dd.insert=function(e,t){(t.target||document.head).appendChild(e)},Dd.domAPI=ud(),Dd.insertStyleElement=fd(),Sd.use=function(e){return Dd.options=e||{},Td++||(Md=ld()(Cd.Z,Dd)),Sd},Sd.unuse=function(){Td>0&&! --Td&&(Md(),Md=null)};var Id=Sd;let Pd=class extends xd{constructor(){super("Popup");const e=(0,t.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});e.addEventListener("click",(()=>{this._mainDiv.style.display="none"})),this._mainDiv.appendChild(e)}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t="";e.forEach(((e,n)=>{t+=`<span class="processState">${e.state}</span>: ${(n||"").split("/").pop()} ${e.progress?" - "+e.progress.toFixed(0)+"%":""}<br>`})),this._contentDiv.innerHTML=t,0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){Id.use({target:e.container}),await super.onAdded(e)}};Pd.PluginType="AssetManagerBasicPopupPlugin",Pd=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("Asset manager popup")],Pd);class Rd extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,i,s,o,a="postRender",l=!1){this._generators.has(a)||this._generators.set(a,[]),this._generators.get(a)?.push({key:e,fn:t,rect:i?[...i]:void 0,frag:o||s||l?new n.jyz({vertexShader:r.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:o??`\n        #include <common>\n        #include <packing>\n        uniform float opacity;\n\t\tuniform ${l?"samplerCube":"sampler2D"} tDiffuse;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvec4 texel = ${l?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};\n\t\t\t${s??""}\n\t\t\tgl_FragColor = opacity * texel;\n\t\t}\n            `}):void 0})}removeTexture(e,t="postRender"){this._generators.set(t,this._generators.get(t)?.filter((t=>t.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){const t=this._viewer,n=t?.renderer;n&&t&&this._generators.get(e)?.forEach((({key:e,fn:r,rect:i,frag:s})=>{const o=r(t);if(o){if(o.image&&i){const e=o.image.width/o.image.height;i[2]<1&&i[3]<1&&(i[2]=200),i[2]<1&&(i[2]=i[3]*e),i[3]<1&&(i[3]=i[2]/e)}n.blit(o,void 0,{viewport:i,clear:!1,material:s})}}))}}Rd.PluginType="debug";class Bd extends n.aNw{constructor(e){super(e)}load(e,t,r,i){const s=this,o=""===this.path?n.Zp0.extractUrlBase(e):this.path,a=new n.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(s.parse(n,o))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),r,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split("\n");let r={};const i=/\s+/,s={};for(let e=0;e<n.length;e++){let t=n[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const o=t.indexOf(" ");let a=o>=0?t.substring(0,o):t;a=a.toLowerCase();let l=o>=0?t.substring(o+1):"";if(l=l.trim(),"newmtl"===a)r={name:l},s[l]=r;else if("ka"===a||"kd"===a||"ks"===a||"ke"===a){const e=l.split(i,3);r[a]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else r[a]=l}const o=new kd(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class kd{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:n.Wl3,this.wrap=void 0!==this.options.wrap?this.options.wrap:n.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],i={};t[n]=i;for(const e in r){let t=!0,n=r[e];const s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(i[s]=n)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return void 0===this.materials[e]&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,r=this.materialsInfo[e],i={name:e,side:this.side};async function s(e,r){if(i[e])return;const s=t.getTextureParams(r,i);return new Promise(((r,o)=>{let a=!1,l=()=>!a&&(a=!0)&&r();const c=t.loadTexture((u=t.baseUrl,"string"!=typeof(h=s.url)||""===h?"":/^https?:\/\//i.test(h)?h:u+h),void 0,(t=>{i[e]=t,l()}),void 0,l);var u,h;setTimeout(l,50),c.repeat.copy(s.scale),c.offset.copy(s.offset),c.wrapS=t.wrap,c.wrapT=t.wrap,"map"!==e&&"emissiveMap"!==e||(c.colorSpace=n.KI_)}))}const o=Array.from(Object.keys(r||{}));let a=o.includes("d")||o.includes("D");for(const e of o){const t=r[e];let o;if(""!==t)switch(e.toLowerCase()){case"kd":i.color=(new n.Ilk).fromArray(t).convertSRGBToLinear();break;case"ks":i.specular=(new n.Ilk).fromArray(t).convertSRGBToLinear();break;case"ke":i.emissive=(new n.Ilk).fromArray(t).convertSRGBToLinear();break;case"map_kd":await s("map",t);break;case"map_ks":await s("specularMap",t);break;case"map_ke":await s("emissiveMap",t);break;case"norm":await s("normalMap",t);break;case"map_bump":case"bump":await s("bumpMap",t);break;case"map_d":await s("alphaMap",t),i.transparent=!0;break;case"ns":i.shininess=parseFloat(t);break;case"d":o=parseFloat(t),o<1&&(i.opacity=o,i.transparent=!0);break;case"tr":if(a)break;o=parseFloat(t),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(i.opacity=1-o,i.transparent=!0)}}return this.materials[e]=new n.xoR(i),this.materials[e]}getTextureParams(e,t){const r={scale:new n.FM8(1,1),offset:new n.FM8(0,0)},i=e.split(/\s+/);let s;return s=i.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(r.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(r.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),r.url=i.join(" ").trim(),r}loadTexture(e,t,r,i,s){const o=void 0!==this.manager?this.manager:n.tEQ;let a=o.getHandler(e);null===a&&(a=new n.dpR(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,r,i,s);return void 0!==t&&(l.mapping=t),l}}const Od=/^[og]\s*(.+)?/,Ld=/^mtllib /,Fd=/^usemtl /,Ud=/^usemap /,Nd=/\s+/,jd=new n.Pa4,zd=new n.Pa4,Gd=new n.Pa4,Vd=new n.Pa4,Hd=new n.Pa4,Qd=new n.Ilk;function Wd(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,i=this.object.geometry.normals;jd.fromArray(r,e),zd.fromArray(r,t),Gd.fromArray(r,n),Hd.subVectors(Gd,zd),Vd.subVectors(jd,zd),Hd.cross(Vd),Hd.normalize(),i.push(Hd.x,Hd.y,Hd.z),i.push(Hd.x,Hd.y,Hd.z),i.push(Hd.x,Hd.y,Hd.z)},addColor:function(e,t,n){const r=this.colors,i=this.object.geometry.colors;void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,s,o,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),p=this.parseVertexIndex(n,c);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),h=this.parseNormalIndex(a,e),p=this.parseNormalIndex(l,e),this.addNormal(u,h,p)}else this.addFaceNormal(u,h,p);if(void 0!==r&&""!==r){const e=this.uvs.length;u=this.parseUVIndex(r,e),h=this.parseUVIndex(i,e),p=this.parseUVIndex(s,e),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let t=0,r=e.length;t<r;t++)this.addVertexLine(this.parseVertexIndex(e[t],n));for(let e=0,n=t.length;e<n;e++)this.addUVLine(this.parseUVIndex(t[e],r))}};return e.startObject("",!1),e}class qd extends n.aNw{constructor(e){super(e),this.materials=null}load(e,t,r,i){const s=this,o=new n.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(async function(n){try{t(await s.parse(n))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),r,i)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new Wd;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const r=e.split("\n");let i=[];for(let e=0,n=r.length;e<n;e++){const n=r[e].trimStart();if(0===n.length)continue;const s=n.charAt(0);if("#"!==s)if("v"===s){const e=n.split(Nd);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?(Qd.setRGB(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])).convertSRGBToLinear(),t.colors.push(Qd.r,Qd.g,Qd.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===s){const e=n.slice(1).trim().split(Nd),r=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];if(n.length>0){const e=n.split("/");r.push(e)}}const i=r[0];for(let e=1,n=r.length-1;e<n;e++){const n=r[e],s=r[e+1];t.addFace(i[0],n[0],s[0],i[1],n[1],s[1],i[2],n[2],s[2])}}else if("l"===s){const e=n.substring(1).trim().split(" ");let r=[];const i=[];if(-1===n.indexOf("/"))r=e;else for(let t=0,n=e.length;t<n;t++){const n=e[t].split("/");""!==n[0]&&r.push(n[0]),""!==n[1]&&i.push(n[1])}t.addLineGeometry(r,i)}else if("p"===s){const e=n.slice(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(i=Od.exec(n))){const e=(" "+i[0].slice(1).trim()).slice(1);t.startObject(e)}else if(Fd.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(Ld.test(n)){t.materialLibraries.push(n.substring(7).trim());const e=n.substring(7).trim(),r=this.manager.getHandler(e);if(r){const t=await r.loadAsync(e).catch((e=>{console.warn(e)}));t&&this.setMaterials(t)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(Ud.test(n))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if(i=n.split(" "),i.length>1){const e=i[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}}t.finalize();const s=new n.ZAu;if(s.materialLibraries=[].concat(t.materialLibraries),1==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,r=t.objects.length;e<r;e++){const r=t.objects[e],i=r.geometry,o=r.materials,a="Line"===i.type,l="Points"===i.type;let c=!1;if(0===i.vertices.length)continue;const u=new n.u9r;u.setAttribute("position",new n.a$l(i.vertices,3)),i.normals.length>0&&u.setAttribute("normal",new n.a$l(i.normals,3)),i.colors.length>0&&(c=!0,u.setAttribute("color",new n.a$l(i.colors,3))),!0===i.hasUVIndices&&u.setAttribute("uv",new n.a$l(i.uvs,2));const h=[];for(let e=0,r=o.length;e<r;e++){const r=o[e],i=r.name+"_"+r.smooth+"_"+c;let s=t.materials[i];if(null!==this.materials)if(s=await this.materials.create(r.name),!a||!s||s instanceof n.nls){if(l&&s&&!(s instanceof n.UY4)){const e=new n.UY4({size:10,sizeAttenuation:!1});n.F5T.prototype.copy.call(e,s),e.color.copy(s.color),e.map=s.map,s=e}}else{const e=new n.nls;n.F5T.prototype.copy.call(e,s),e.color.copy(s.color),s=e}void 0===s&&(s=a?new n.nls:l?new n.UY4({size:1,sizeAttenuation:!1}):new n.xoR,s.name=r.name,s.flatShading=!r.smooth,s.vertexColors=c,t.materials[i]=s),h.push(s)}let p;if(h.length>1){for(let e=0,t=o.length;e<t;e++){const t=o[e];u.addGroup(t.groupStart,t.groupCount,e)}p=a?new n.ejS(u,h):l?new n.woe(u,h):new n.Kj0(u,h)}else p=a?new n.ejS(u,h[0]):l?new n.woe(u,h[0]):new n.Kj0(u,h[0]);p.name=r.name,s.add(p)}else if(t.vertices.length>0){const e=new n.UY4({size:1,sizeAttenuation:!1}),r=new n.u9r;r.setAttribute("position",new n.a$l(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(r.setAttribute("color",new n.a$l(t.colors,3)),e.vertexColors=!0);const i=new n.woe(r,e);s.add(i)}return s}}class Xd extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo],this._importer1=new _n(qd,["obj"],!0),this._importer2=new _n(Bd,["mtl"],!1)}async onAdded(e){e.getManager()?.importer?.Importers.push(this._importer1),e.getManager()?.importer?.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){e.getManager()?.importer?.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}Xd.PluginType="ObjMtlLoadPlugin";var Yd=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(Yd(""))}catch(Hl){Yd=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Kd=Uint8Array,Jd=Uint16Array,Zd=Uint32Array,$d=new Kd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ef=new Kd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tf=new Kd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nf=function(e,t){for(var n=new Jd(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Zd(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},rf=nf($d,2),sf=rf[0],of=rf[1];sf[28]=258,of[258]=28;for(var af=nf(ef,0),lf=af[0],cf=af[1],uf=new Jd(32768),hf=0;hf<32768;++hf){var pf=(43690&hf)>>>1|(21845&hf)<<1;pf=(61680&(pf=(52428&pf)>>>2|(13107&pf)<<2))>>>4|(3855&pf)<<4,uf[hf]=((65280&pf)>>>8|(255&pf)<<8)>>>1}var df=function(e,t,n){for(var r=e.length,i=0,s=new Jd(t);i<r;++i)++s[e[i]-1];var o,a=new Jd(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;if(n){o=new Jd(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[uf[h]>>>l]=c}else for(o=new Jd(r),i=0;i<r;++i)e[i]&&(o[i]=uf[a[e[i]-1]++]>>>15-e[i]);return o},ff=new Kd(288);for(hf=0;hf<144;++hf)ff[hf]=8;for(hf=144;hf<256;++hf)ff[hf]=9;for(hf=256;hf<280;++hf)ff[hf]=7;for(hf=280;hf<288;++hf)ff[hf]=8;var mf=new Kd(32);for(hf=0;hf<32;++hf)mf[hf]=5;var gf=df(ff,9,0),_f=df(ff,9,1),vf=df(mf,5,0),yf=df(mf,5,1),bf=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Af=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},wf=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},xf=function(e){return(e/8|0)+(7&e&&1)},Ef=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Jd?Jd:e instanceof Zd?Zd:Kd)(n-t);return r.set(e.subarray(t,n)),r},Cf=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},Sf=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},Mf=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,s=n.slice();if(!i)return[kf,0];if(1==i){var o=new Kd(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var p=s[0].s;for(r=1;r<i;++r)s[r].s>p&&(p=s[r].s);var d=new Jd(p+1),f=Tf(n[u-1],d,0);if(f>t){r=0;var m=0,g=f-t,_=1<<g;for(s.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));r<i;++r){var v=s[r].s;if(!(d[v]>t))break;m+=_-(1<<f-d[v]),d[v]=t}for(m>>>=g;m>0;){var y=s[r].s;d[y]<t?m-=1<<t-d[y]++-1:++r}for(;r>=0&&m;--r){var b=s[r].s;d[b]==t&&(--d[b],++m)}f=t}return[new Kd(d),f]},Tf=function(e,t,n){return-1==e.s?Math.max(Tf(e.l,t,n+1),Tf(e.r,t,n+1)):t[e.s]=n},Df=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Jd(++t),r=0,i=e[0],s=1,o=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==i&&a!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=e[a]}return[n.subarray(0,r),t]},If=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Pf=function(e,t,n){var r=n.length,i=xf(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var s=0;s<r;++s)e[i+s+4]=n[s];return 8*(i+4+r)},Rf=function(e,t,n,r,i,s,o,a,l,c,u){Cf(t,u++,n),++i[256];for(var h=Mf(i,15),p=h[0],d=h[1],f=Mf(s,15),m=f[0],g=f[1],_=Df(p),v=_[0],y=_[1],b=Df(m),A=b[0],w=b[1],x=new Jd(19),E=0;E<v.length;++E)x[31&v[E]]++;for(E=0;E<A.length;++E)x[31&A[E]]++;for(var C=Mf(x,7),S=C[0],M=C[1],T=19;T>4&&!S[tf[T-1]];--T);var D,I,P,R,B=c+5<<3,k=If(i,ff)+If(s,mf)+o,O=If(i,p)+If(s,m)+o+14+3*T+If(x,S)+(2*x[16]+3*x[17]+7*x[18]);if(B<=k&&B<=O)return Pf(t,u,e.subarray(l,l+c));if(Cf(t,u,1+(O<k)),u+=2,O<k){D=df(p,d,0),I=p,P=df(m,g,0),R=m;var L=df(S,M,0);for(Cf(t,u,y-257),Cf(t,u+5,w-1),Cf(t,u+10,T-4),u+=14,E=0;E<T;++E)Cf(t,u+3*E,S[tf[E]]);u+=3*T;for(var F=[v,A],U=0;U<2;++U){var N=F[U];for(E=0;E<N.length;++E){var j=31&N[E];Cf(t,u,L[j]),u+=S[j],j>15&&(Cf(t,u,N[E]>>>5&127),u+=N[E]>>>12)}}}else D=gf,I=ff,P=vf,R=mf;for(E=0;E<a;++E)if(r[E]>255){j=r[E]>>>18&31,Sf(t,u,D[j+257]),u+=I[j+257],j>7&&(Cf(t,u,r[E]>>>23&31),u+=$d[j]);var z=31&r[E];Sf(t,u,P[z]),u+=R[z],z>3&&(Sf(t,u,r[E]>>>5&8191),u+=ef[z])}else Sf(t,u,D[r[E]]),u+=I[r[E]];return Sf(t,u,D[256]),u+I[256]},Bf=new Zd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),kf=new Kd(0);function Of(e,t){return function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Kd(0);var i=!t||n,s=!n||n.i;n||(n={}),t||(t=new Kd(3*r));var o=function(e){var n=t.length;if(e>n){var r=new Kd(Math.max(2*n,e));r.set(t),t=r}},a=n.f||0,l=n.p||0,c=n.b||0,u=n.l,h=n.d,p=n.m,d=n.n,f=8*r;do{if(!u){n.f=a=Af(e,l,1);var m=Af(e,l+1,3);if(l+=3,!m){var g=e[(M=xf(l)+4)-4]|e[M-3]<<8,_=M+g;if(_>r){if(s)throw"unexpected EOF";break}i&&o(c+g),t.set(e.subarray(M,_),c),n.b=c+=g,n.p=l=8*_;continue}if(1==m)u=_f,h=yf,p=9,d=5;else{if(2!=m)throw"invalid block type";var v=Af(e,l,31)+257,y=Af(e,l+10,15)+4,b=v+Af(e,l+5,31)+1;l+=14;for(var A=new Kd(b),w=new Kd(19),x=0;x<y;++x)w[tf[x]]=Af(e,l+3*x,7);l+=3*y;var E=bf(w),C=(1<<E)-1,S=df(w,E,1);for(x=0;x<b;){var M,T=S[Af(e,l,C)];if(l+=15&T,(M=T>>>4)<16)A[x++]=M;else{var D=0,I=0;for(16==M?(I=3+Af(e,l,3),l+=2,D=A[x-1]):17==M?(I=3+Af(e,l,7),l+=3):18==M&&(I=11+Af(e,l,127),l+=7);I--;)A[x++]=D}}var P=A.subarray(0,v),R=A.subarray(v);p=bf(P),d=bf(R),u=df(P,p,1),h=df(R,d,1)}if(l>f){if(s)throw"unexpected EOF";break}}i&&o(c+131072);for(var B=(1<<p)-1,k=(1<<d)-1,O=l;;O=l){var L=(D=u[wf(e,l)&B])>>>4;if((l+=15&D)>f){if(s)throw"unexpected EOF";break}if(!D)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){O=l,u=null;break}var F=L-254;if(L>264){var U=$d[x=L-257];F=Af(e,l,(1<<U)-1)+sf[x],l+=U}var N=h[wf(e,l)&k],j=N>>>4;if(!N)throw"invalid distance";if(l+=15&N,R=lf[j],j>3&&(U=ef[j],R+=wf(e,l)&(1<<U)-1,l+=U),l>f){if(s)throw"unexpected EOF";break}i&&o(c+131072);for(var z=c+F;c<z;c+=4)t[c]=t[c-R],t[c+1]=t[c+1-R],t[c+2]=t[c+2-R],t[c+3]=t[c+3-R];c=z}}n.l=u,n.p=O,n.b=c,u&&(a=1,n.m=p,n.d=h,n.n=d)}while(!a);return c==t.length?t:Ef(t,0,c)}((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var Lf="undefined"!=typeof TextDecoder&&new TextDecoder;try{Lf.decode(kf,{stream:!0})}catch(Hl){}function Ff(e,t,n){const r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;let i=e,s=r,o=Math.floor((i+s)/2);for(;t<n[o]||t>=n[o+1];)t<n[o]?s=o:i=o,o=Math.floor((i+s)/2);return o}function Uf(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let r=1;for(let e=2;e<=t;++e)r*=e;for(let n=2;n<=e-t;++n)r*=n;return n/r}class Nf extends n.Hyl{constructor(e,t,r,i,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let e=0;e<r.length;++e){const t=r[e];this.controlPoints[e]=new n.Ltg(t.x,t.y,t.z,t.w)}}getPoint(e,t=new n.Pa4){const r=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(e,t,r,i){const s=Ff(e,i,t),o=function(e,t,n,r){const i=[],s=[],o=[];i[0]=1;for(let a=1;a<=n;++a){s[a]=t-r[e+1-a],o[a]=r[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=o[e+1],r=s[a-e],l=i[e]/(t+r);i[e]=n+t*l,n=r*l}i[a]=n}return i}(s,i,e,t),a=new n.Ltg(0,0,0,0);for(let t=0;t<=e;++t){const n=r[s-e+t],i=o[t],l=n.w*i;a.x+=n.x*l,a.y+=n.y*l,a.z+=n.z*l,a.w+=n.w*i}return a}(this.degree,this.knots,this.controlPoints,i);return 1!==s.w&&s.divideScalar(s.w),r.set(s.x,s.y,s.z)}getTangent(e,t=new n.Pa4){const r=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(e,t,r,i,s){const o=function(e,t,r,i,s){const o=1<e?1:e,a=[],l=Ff(e,i,t),c=function(e,t,n,r,i){const s=[];for(let e=0;e<=n;++e)s[e]=0;const o=[];for(let e=0;e<=r;++e)o[e]=s.slice(0);const a=[];for(let e=0;e<=n;++e)a[e]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let r=1;r<=n;++r){l[r]=t-i[e+1-r],c[r]=i[e+r]-t;let n=0;for(let e=0;e<r;++e){const t=c[e+1],i=l[r-e];a[r][e]=t+i;const s=a[e][r-1]/a[r][e];a[e][r]=n+t*s,n=i*s}a[r][r]=n}for(let e=0;e<=n;++e)o[0][e]=a[e][n];for(let e=0;e<=n;++e){let t=0,i=1;const l=[];for(let e=0;e<=n;++e)l[e]=s.slice(0);l[0][0]=1;for(let s=1;s<=r;++s){let r=0;const c=e-s,u=n-s;e>=s&&(l[i][0]=l[t][0]/a[u+1][c],r=l[i][0]*a[c][u]);const h=e-1<=u?s-1:n-e;for(let e=c>=-1?1:-c;e<=h;++e)l[i][e]=(l[t][e]-l[t][e-1])/a[u+1][c+e],r+=l[i][e]*a[c+e][u];e<=u&&(l[i][s]=-l[t][s-1]/a[u+1][e],r+=l[i][s]*a[e][u]),o[s][e]=r;const p=t;t=i,i=p}}let u=n;for(let e=1;e<=r;++e){for(let t=0;t<=n;++t)o[e][t]*=u;u*=n-e}return o}(l,i,e,o,t),u=[];for(let e=0;e<r.length;++e){const t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,u[e]=t}for(let t=0;t<=o;++t){const n=u[l-e].clone().multiplyScalar(c[t][0]);for(let r=1;r<=e;++r)n.add(u[l-e+r].clone().multiplyScalar(c[t][r]));a[t]=n}for(let e=o+1;e<=2;++e)a[e]=new n.Ltg(0,0,0);return a}(e,t,r,i);return function(e){const t=e.length,r=[],i=[];for(let s=0;s<t;++s){const t=e[s];r[s]=new n.Pa4(t.x,t.y,t.z),i[s]=t.w}const s=[];for(let e=0;e<t;++e){const t=r[e].clone();for(let n=1;n<=e;++n)t.sub(s[e-n].clone().multiplyScalar(Uf(e,n)*i[n]));s[e]=t.divideScalar(i[0])}return s}(o)}(this.degree,this.knots,this.controlPoints,i);return r.copy(s[1]).normalize(),r}}let jf,zf,Gf;class Vf extends n.aNw{constructor(e){super(e)}load(e,t,r,i){const s=this,o=""===s.path?n.Zp0.extractUrlBase(e):s.path,a=new n.hH6(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,(function(n){try{t(s.parse(n,o))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),r,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===om(e,0,21)}(e))jf=(new Xf).parse(e);else{const t=om(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let e=0;e<t.length;++e)if(r(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Jf(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Jf(t));jf=(new qf).parse(t)}const r=new n.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),i=new Hf(r,this.manager).parse(jf);return jf=null,zf=null,Gf=null,i}}class Hf{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){zf=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=(new Qf).parse(r);return this.parseScene(r,i,n),Gf}parseConnections(){const e=new Map;return"Connections"in jf&&jf.Connections.connections.forEach((function(t){const n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:r,relationship:i};e.get(n).parents.push(s),e.has(r)||e.set(r,{parents:[],children:[]});const o={ID:n,relationship:i};e.get(r).children.push(o)})),e}parseImages(){const e={},t={};if("Video"in jf.Objects){const n=jf.Objects.Video;for(const r in n){const i=n[r];if(e[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){const e=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"==typeof i.Content&&""!==i.Content;if(e||s){const e=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=e}}}}for(const n in e){const r=e[n];void 0!==t[r]?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in jf.Objects){const n=jf.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const i=e.WrapModeU,s=e.WrapModeV,o=void 0!==i?i.value:0,a=void 0!==s?s.value:0;if(r.wrapS=0===o?n.rpg:n.uWy,r.wrapT=0===a?n.rpg:n.uWy,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){let r;const i=this.textureLoader.path,s=zf.get(e.id).children;let o;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(r=t[s[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new n.xEZ):(t.setPath(this.textureLoader.path),o=t.load(r))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new n.xEZ):o=this.textureLoader.load(r);return this.textureLoader.setPath(i),o}parseMaterials(e){const t=new Map;if("Material"in jf.Objects){const n=jf.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],e);null!==i&&t.set(parseInt(r),i)}}return t}parseMaterial(e,t){const r=e.id,i=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!zf.has(r))return null;const o=this.parseParameters(e,t,r);let a;switch(s.toLowerCase()){case"phong":a=new n.xoR;break;case"lambert":a=new n.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new n.xoR}return a.setValues(o),a.name=i,a}parseParameters(e,t,r){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new n.Ilk).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new n.Ilk).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new n.Ilk).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new n.Ilk).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new n.Ilk).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new n.Ilk).fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return zf.get(r).children.forEach((function(e){const r=e.relationship;switch(r){case"Bump":i.bumpMap=s.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(t,e.ID),void 0!==i.map&&(i.map.colorSpace=n.KI_);break;case"DisplacementColor":i.displacementMap=s.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=n.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=s.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=n.dSO,i.envMap.colorSpace=n.KI_);break;case"SpecularColor":i.specularMap=s.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=n.KI_);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),i}getTexture(e,t){return"LayeredTexture"in jf.Objects&&t in jf.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=zf.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in jf.Objects){const n=jf.Objects.Deformer;for(const r in n){const i=n[r],s=zf.get(parseInt(r));if("Skin"===i.attrType){const t=this.parseSkeleton(s,n);t.ID=r,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[r]=t}else if("BlendShape"===i.attrType){const e={id:r};e.rawTargets=this.parseMorphTargets(s,n),e.id=r,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const s={ID:e.ID,indices:[],weights:[],transformLink:(new n.yGw).fromArray(i.TransformLink.a)};"Indexes"in i&&(s.indices=i.Indexes.a,s.weights=i.Weights.a),r.push(s)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const i=e.children[r],s=t[i.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=zf.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(o)}return n}parseScene(e,t,r){Gf=new n.ZAu;const i=this.parseModels(e.skeletons,t,r),s=jf.Objects.Model,o=this;i.forEach((function(e){const t=s[e.ID];o.setLookAtProperties(e,t),zf.get(e.ID).parents.forEach((function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Gf.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Gf.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=rm(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new Wf).parse();1===Gf.children.length&&Gf.children[0].isGroup&&(Gf.children[0].animations=a,Gf=Gf.children[0]),Gf.animations=a}parseModels(e,t,r){const i=new Map,s=jf.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=zf.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,r);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new n.N$j;break;default:u=new n.ZAu}u.name=l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),i.set(a,u)}return i}buildSkeleton(e,t,r,i){let s=null;return e.parents.forEach((function(e){for(const o in t){const a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){const e=s;s=new n.N$j,s.matrixWorld.copy(t.transformLink),s.name=i?n.iUV.sanitizeNodeName(i):"",s.ID=r,a.bones[o]=s,null!==e&&s.add(e)}}))}})),s}createCamera(e){let t,r;if(e.children.forEach((function(e){const t=jf.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Tme;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let s=1e3;void 0!==r.FarPlane&&(s=r.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(o=r.AspectWidth.value,a=r.AspectHeight.value);const l=o/a;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new n.cPb(c,l,i,s),null!==u&&t.setFocalLength(u);break;case 1:t=new n.iKG(-o/2,o/2,a/2,-a/2,i,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new n.Tme}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){const t=jf.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Tme;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=16777215;void 0!==r.Color&&(i=(new n.Ilk).fromArray(r.Color.value).convertSRGBToLinear());let s=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(s=0);let o=0;void 0!==r.FarAttenuationEnd&&(o=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new n.cek(i,s,o,a);break;case 1:t=new n.Ox3(i,s);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=n.M8C.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=n.M8C.degToRad(r.OuterAngle.value),l=Math.max(l,1)),t=new n.PMe(i,s,o,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new n.cek(i,s)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i,s=null,o=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(s=t.get(e.ID)),r.has(e.ID)&&a.push(r.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new n.xoR({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach((function(e){e.vertexColors=!0})),s.FBX_Deformer?(i=new n.TUv(s,o),i.normalizeSkinWeights()):i=new n.Kj0(s,o),i}createCurve(e,t){const r=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new n.nls({color:3342591,linewidth:1});return new n.x12(r,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?im(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&zf.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const r=jf.Objects.Model[t.ID];if("Lcl_Translation"in r){const t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Gf.add(e.target)):e.lookAt((new n.Pa4).fromArray(t))}}}))}bindSkeleton(e,t,r){const i=this.parsePoseNodes();for(const s in e){const o=e[s];zf.get(parseInt(o.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;zf.get(t).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new n.OdW(o.bones),i[e.ID])}))}}))}}parsePoseNodes(){const e={};if("Pose"in jf.Objects){const t=jf.Objects.Pose;for(const r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){const i=t[r].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new n.yGw).fromArray(t.Matrix.a)})):e[i.Node]=(new n.yGw).fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in jf&&"AmbientColor"in jf.GlobalSettings){const e=jf.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){const e=new n.Ilk(t,r,i).convertSRGBToLinear();Gf.add(new n.Mig(e,1))}}}}class Qf{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in jf.Objects){const n=jf.Objects.Geometry;for(const r in n){const i=zf.get(parseInt(r)),s=this.parseGeometry(i,n[r],e);t.set(parseInt(r),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,i=[],s=e.parents.map((function(e){return jf.Objects.Model[e.ID]}));if(0===s.length)return;const o=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=im(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=rm(l);return this.genGeometry(t,o,i,c)}genGeometry(e,t,r,i){const s=new n.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new n.a$l(a.vertex,3);if(l.applyMatrix4(i),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new n.a$l(a.colors,3)),t&&(s.setAttribute("skinIndex",new n.qlB(a.weightsIndices,4)),s.setAttribute("skinWeight",new n.a$l(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const e=(new n.Vkp).getNormalMatrix(i),t=new n.a$l(a.normal,3);t.applyNormalMatrix(e),s.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){const r=0===t?"uv":`uv${t}`;s.setAttribute(r,new n.a$l(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,r){n!==e&&(s.addGroup(t,r-t,e),e=n,t=r)})),s.groups.length>0){const t=s.groups[s.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&s.addGroup(n,a.materialIndex.length-n,e)}0===s.groups.length&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,r,i),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,s=[],o=[],a=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(p,d){let f,m=!1;p<0&&(p^=-1,m=!0);let g=[],_=[];if(s.push(3*p,3*p+1,3*p+2),e.color){const t=em(d,n,p,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){_.push(e.weight),g.push(e.id)})),_.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];_.forEach((function(n,r){let i=n,s=g[r];t.forEach((function(t,n,r){if(i>t){r[n]=i,i=t;const o=e[n];e[n]=s,s=o}}))})),g=e,_=t}for(;_.length<4;)_.push(0),g.push(0);for(let e=0;e<4;++e)c.push(_[e]),u.push(g[e])}if(e.normal){const t=em(d,n,p,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=em(d,n,p,e.material)[0],f<0&&(h.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const r=em(d,n,p,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,m&&(r>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),h.genFace(t,e,s,f,o,a,l,c,u,r),n++,r=0,s=[],o=[],a=[],l=[],c=[],u=[])})),t}genFace(e,t,n,r,i,s,o,a,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(u-1)]),e.uvs[n].push(o[n][2*(u-1)+1]),e.uvs[n].push(o[n][2*u]),e.uvs[n].push(o[n][2*u+1])}))}addMorphTargets(e,t,n,r){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=jf.Objects.Geometry[n.geoID];void 0!==s&&i.genMorphGeometry(e,t,s,r,n.name)}))}))}genMorphGeometry(e,t,r,i,s){const o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let e=0;e<l.length;e++){const t=3*l[e];u[t]=a[3*e],u[t+1]=a[3*e+1],u[t+2]=a[3*e+2]}const h={vertexIndices:o,vertexPositions:u},p=this.genBuffers(h),d=new n.a$l(p.vertex,3);d.name=s||r.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a;let s=[];"IndexToDirect"===r&&(s=e.ColorIndex.a);for(let e=0,t=new n.Ilk;e<i.length;e+=4)t.fromArray(i,e).convertSRGBToLinear().toArray(i,e);return{dataSize:4,buffer:i,indices:s,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let e=0;e<r.length;++e)i.push(e);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.u9r;const r=t-1,i=e.KnotVector.a,s=[],o=e.Points.a;for(let e=0,t=o.length;e<t;e+=4)s.push((new n.Ltg).fromArray(o,e));let a,l;if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){a=r,l=i.length-1-a;for(let e=0;e<r;++e)s.push(s[e])}const c=new Nf(r,i,s,a,l).getPoints(12*s.length);return(new n.u9r).setFromPoints(c)}}class Wf{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(void 0===jf.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=jf.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=jf.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Zf),values:t[n].KeyValueFloat.a},i=zf.get(r.id);if(void 0!==i){const t=i.parents[0].ID,n=i.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=r:n.match(/Y/)?e.get(t).curves.y=r:n.match(/Z/)?e.get(t).curves.z=r:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=r)}}}parseAnimationLayers(e){const t=jf.Objects.AnimationLayer,r=new Map;for(const i in t){const t=[],s=zf.get(parseInt(i));void 0!==s&&(s.children.forEach((function(r,i){if(e.has(r.ID)){const s=e.get(r.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===t[i]){const e=zf.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const s=jf.Objects.Model[e.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const o={modelName:s.attrName?n.iUV.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Gf.traverse((function(e){e.ID===s.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new n.yGw),"PreRotation"in s&&(o.preRotation=s.PreRotation.value),"PostRotation"in s&&(o.postRotation=s.PostRotation.value),t[i]=o}}t[i]&&(t[i][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===t[i]){const e=zf.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,s=zf.get(e).parents[0].ID,o=zf.get(s).parents[0].ID,a=zf.get(o).parents[0].ID,l=jf.Objects.Model[a],c={modelName:l.attrName?n.iUV.sanitizeNodeName(l.attrName):"",morphName:jf.Objects.Deformer[e].attrName};t[i]=c}t[i][s.attr]=s}}})),r.set(parseInt(i),t))}return r}parseAnimStacks(e){const t=jf.Objects.AnimationStack,n={};for(const r in t){const i=zf.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:s}}return n}addClip(e){let t=[];const r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new n.m7l(e.name,-1,t)}generateTracks(e){const t=[];let r=new n.Pa4,i=new n._fP,s=new n.Pa4;if(e.transform&&e.transform.decompose(r,i,s),r=r.toArray(),i=(new n.USm).setFromQuaternion(i,e.eulerOrder).toArray(),s=s.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,r,i){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,r);return new n.yC1(e+"."+i,s,o)}generateRotationTrack(e,t,r,i,s,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(n.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(n.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(n.M8C.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,r);void 0!==i&&((i=i.map(n.M8C.degToRad)).push(o),i=(new n.USm).fromArray(i),i=(new n._fP).setFromEuler(i)),void 0!==s&&((s=s.map(n.M8C.degToRad)).push(o),s=(new n.USm).fromArray(s),s=(new n._fP).setFromEuler(s).invert());const c=new n._fP,u=new n.USm,h=[];for(let e=0;e<l.length;e+=3)u.set(l[e],l[e+1],l[e+2],o),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==s&&c.multiply(s),c.toArray(h,e/3*4);return new n.iLg(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=Gf.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.dUE(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let s=-1,o=-1,a=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==o){const e=t.y.values[o];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==a){const e=t.z.values[a];i.push(e),r[2]=e}else i.push(r[2])})),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const s=i/180,o=r/s;let a=n+o;const l=e.times[t-1],c=(e.times[t]-l)/s;let u=l+c;const h=[],p=[];for(;u<e.times[t];)h.push(u),u+=c,p.push(a),a+=o;e.times=am(e.times,t,h),e.values=am(e.values,t,p)}}}}class qf{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Kf,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){const i=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(i||s)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):a?t.parseNodeProperty(e,a,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},s=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=i)):"number"==typeof s.id?(o[n]={},o[n][s.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof s.id&&(i.id=s.id),""!==s.name&&(i.attrName=s.name),""!==s.type&&(i.attrType=s.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===r){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let o=i.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",i=[t,n],function(e,t){for(let n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i,o),void 0===s[r]&&(s[r]=[])}"Node"===r&&(s.id=i),r in s&&Array.isArray(s[r])?s[r].push(i):"a"!==r?s[r]=i:s.a=i,this.setCurrentProp(s,r),"a"===r&&","!==i.slice(-1)&&(s.a=sm(i))}else this.parseNodeSpecialProperty(e,r,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=sm(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],s=r[1],o=r[2],a=r[3];let l=r[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=sm(l)}this.getPrevNode()[i]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class Xf{parse(e){const t=new Yf(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Kf;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(0===r)return null;const a=[];for(let t=0;t<i;t++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(o,n,r)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==o&&(n.name=o),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],s=n.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),o="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:i,flag:s,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),i=e.getUint32(),s=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const o=Of(new Uint8Array(e.getArrayBuffer(s))),a=new Yf(o.buffer);switch(t){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Yf{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(n)}}class Kf{add(e,t){this[e]=t}}function Jf(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Zf(e){return e/46186158e3}const $f=[];function em(e,t,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const s=i*r.dataSize,o=s+r.dataSize;return function(e,t,n,r){for(let i=n,s=0;i<r;i++,s++)e[s]=t[i];return e}($f,r.buffer,s,o)}const tm=new n.USm,nm=new n.Pa4;function rm(e){const t=new n.yGw,r=new n.yGw,i=new n.yGw,s=new n.yGw,o=new n.yGw,a=new n.yGw,l=new n.yGw,c=new n.yGw,u=new n.yGw,h=new n.yGw,p=new n.yGw,d=new n.yGw,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(nm.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),r.makeRotationFromEuler(tm.fromArray(t))}if(e.rotation){const t=e.rotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),i.makeRotationFromEuler(tm.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(n.M8C.degToRad);t.push(e.eulerOrder||n.USm.DEFAULT_ORDER),s.makeRotationFromEuler(tm.fromArray(t)),s.invert()}e.scale&&o.scale(nm.fromArray(e.scale)),e.scalingOffset&&l.setPosition(nm.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(nm.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(nm.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(nm.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(p.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=r.clone().multiply(i).multiply(s),g=new n.yGw;g.extractRotation(h);const _=new n.yGw;_.copyPosition(h);const v=_.clone().invert().multiply(h),y=g.clone().invert().multiply(v),b=o,A=new n.yGw;if(0===f)A.copy(g).multiply(m).multiply(y).multiply(b);else if(1===f)A.copy(g).multiply(y).multiply(m).multiply(b);else{const e=(new n.yGw).scale((new n.Pa4).setFromMatrixScale(p)).clone().invert(),t=y.clone().multiply(e);A.copy(g).multiply(m).multiply(t).multiply(b)}const w=u.clone().invert(),x=a.clone().invert();let E=t.clone().multiply(c).multiply(u).multiply(r).multiply(i).multiply(s).multiply(w).multiply(l).multiply(a).multiply(o).multiply(x);const C=(new n.yGw).copyPosition(E),S=h.clone().multiply(C);return d.copyPosition(S),E=d.clone().multiply(A),E.premultiply(h.invert()),E}function im(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function sm(e){return e.split(",").map((function(e){return parseFloat(e)}))}function om(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}function am(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}class lm extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo],this._importer=new _n(Vf,["fbx"],!0)}async onAdded(e){e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){e.getManager()?.importer?.Importers&&e.getManager()?.importer?.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1)}}lm.PluginType="FBXLoadPlugin";const cm=new n.cPb(45,1,.1,1e3);function um(e,t,r,i=7,s=new n.Pa4(0,0,1.5)){r=r??e.scene.modelObject;const o=(new v).expandByObject(r??t,!0,!0),a=o.getCenter(new n.Pa4),l=o.getSize(new n.Pa4);cm.position.copy(a).add(s.clone().multiplyScalar(Math.max(l.x,l.y,l.z))),cm.lookAt(a),t&&t.traverseVisible((e=>{e.layers.enable(i)})),i>0?cm.layers.set(i):cm.layers.enableAll();const c=t?.visible;t&&(t.visible=!0),e.renderer.rendererObject.setRenderTarget(null),e.renderer.rendererObject.render(r,cm);const u=e.renderer.rendererObject.domElement.toDataURL("image/png");return t&&(t.visible=c,t.traverseVisible((e=>{e.layers.disable(i)})),cm.layers.enableAll()),e.setDirty(),u}class hm{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new n.Kj0(new n.xo$(1)),cube:new n.Kj0(new n.DvJ(1,1,1)),cylinder:new n.Kj0(new n.fHI(.5,.5,1))};const t=new n.xsS;this._channel=7;const r=new n.vmT(16777215,4473924,1);r.position.set(0,10,0),r.layers.set(this._channel),t.add(r),this._lights.push(r),this._scene=t}dispose(){[...this._lights].forEach((e=>e.dispose())),Object.values(this.shapes).forEach((e=>{e.geometry&&e.geometry.dispose()}))}generate(e,t="sphere"){const r=this.shapes[t]||new n.Kj0(new n.xo$(1));r.material=e.materialObject,r.geometry.attributes.tangent||r.geometry.computeTangents(),this._scene.add(r),this._scene.environment=this.viewer.scene.getEnvironment();const i=r.material.envMapIntensity;"number"==typeof i&&(r.material.envMapIntensity=Math.max(i,2));const s=um(this.viewer,r,this._scene,this._channel,new n.Pa4(0,0,1.5));return"number"==typeof i&&(r.material.envMapIntensity=i),this._scene.remove(r),r.material=void 0,s}}class pm extends qt{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{this.enabled&&this.uiConfig.uiRefresh?.()},this.dependencies=[fo],this.variations=[],this._selectedMaterial=()=>this._picking?.getSelectedObject()?.material||void 0,this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(an).filter((e=>e.endsWith("Map")))].map((e=>({label:e,value:e})))},...this.getSelectedVariation()?.materials.map((e=>e.uiConfig?Object.assign(e.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(e.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(e)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach((e=>this.applyVariation(e,e.materials[0].uuid)))}}]]}}async onAdded(e){await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=this._viewer?.getPluginByType("Picking"),this._previewGenerator=new hm(this._viewer),this._picking?.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){return this._previewGenerator?.dispose(),this._previewGenerator=void 0,this._picking?.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find((t=>t.uuid===e)):void 0}getSelectedVariation(){return this.findVariation(this._selectedMaterial()?.uuid)||this.findVariation(this._selectedMaterial()?.name)}applyVariation(e,t){const n=e.materials.find((e=>e.uuid===t)),r=this._viewer?.getManager()?.materials;return!!r&&!!n&&r.applyMaterial(n,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){const t=e?.clone?.();if(e&&t){let n=this.findVariation(e.uuid);!n&&e.name.length>0&&(n=this.findVariation(e.name)),n||this.variations.push(n={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),n.materials.push(t),this.refreshUi()}}}pm.PluginType="MaterialConfiguratorBasePlugin",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe()],pm.prototype,"variations",void 0);class dm{static _initialize(){this._inited=!0,(0,t.createStyles)(t.css`
  .customContextGrid {
    background: #28223C;
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,n,r,i,s,o,a){this._inited||this._initialize();const l=(0,t.mobileAndTabletCheck)(),c=l?.15:.25,u=l?1.5:2.5,h=(0,t.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`\n            <div class="customContextGridHeading"> ${n} </div>\n            `});h.style.top=s+"px",h.style.left=i+"px",h.style.gap=c+"rem",h.style.width=(u+c)*r-c+"rem",h.dataset.tag=e;for(const e of o){const n=(0,t.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`\n            <img src="${e.image}" class="customContextGridItemImage">\n            `});n.style.width=u+"rem",n.style.height=u+"rem",h.appendChild(n),n.onclick=()=>e.onClick?.(e.id),a(n,e)}return this.Elements?.push(h),h}static RemoveAll(e){if(e){const t=this.Elements.filter((t=>t.dataset.tag===e));for(const e of t)e.remove();this.Elements=this.Elements.filter((t=>t.dataset.tag!==e))}else{for(const e of this.Elements)e.remove();this.Elements=[]}}static RebuildUi(e){if(0===this.Elements.length)return;e||(e=(0,t.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const e of this.Elements)e.remove();this._container.innerHTML="";let n=20;e.appendChild(this._container);for(const e of this.Elements)e.style.top=n+"px",this._container.appendChild(e),n+=e.clientHeight+20}}function fm(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function mm(e){return e instanceof fm(e).Element||e instanceof Element}function gm(e){return e instanceof fm(e).HTMLElement||e instanceof HTMLElement}function _m(e){return"undefined"!=typeof ShadowRoot&&(e instanceof fm(e).ShadowRoot||e instanceof ShadowRoot)}dm.Elements=[],dm._inited=!1,dm._container=document.createElement("div");var vm=Math.max,ym=Math.min,bm=Math.round;function Am(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function wm(){return!/^((?!chrome|android).)*safari/i.test(Am())}function xm(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),i=1,s=1;t&&gm(e)&&(i=e.offsetWidth>0&&bm(r.width)/e.offsetWidth||1,s=e.offsetHeight>0&&bm(r.height)/e.offsetHeight||1);var o=(mm(e)?fm(e):window).visualViewport,a=!wm()&&n,l=(r.left+(a&&o?o.offsetLeft:0))/i,c=(r.top+(a&&o?o.offsetTop:0))/s,u=r.width/i,h=r.height/s;return{width:u,height:h,top:c,right:l+u,bottom:c+h,left:l,x:l,y:c}}function Em(e){var t=fm(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Cm(e){return e?(e.nodeName||"").toLowerCase():null}function Sm(e){return((mm(e)?e.ownerDocument:e.document)||window.document).documentElement}function Mm(e){return xm(Sm(e)).left+Em(e).scrollLeft}function Tm(e){return fm(e).getComputedStyle(e)}function Dm(e){var t=Tm(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function Im(e,t,n){void 0===n&&(n=!1);var r,i,s=gm(t),o=gm(t)&&function(e){var t=e.getBoundingClientRect(),n=bm(t.width)/e.offsetWidth||1,r=bm(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=Sm(t),l=xm(e,o,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!n)&&(("body"!==Cm(t)||Dm(a))&&(c=(r=t)!==fm(r)&&gm(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:Em(r)),gm(t)?((u=xm(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=Mm(a))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Pm(e){var t=xm(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function Rm(e){return"html"===Cm(e)?e:e.assignedSlot||e.parentNode||(_m(e)?e.host:null)||Sm(e)}function Bm(e){return["html","body","#document"].indexOf(Cm(e))>=0?e.ownerDocument.body:gm(e)&&Dm(e)?e:Bm(Rm(e))}function km(e,t){var n;void 0===t&&(t=[]);var r=Bm(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),s=fm(r),o=i?[s].concat(s.visualViewport||[],Dm(r)?r:[]):r,a=t.concat(o);return i?a:a.concat(km(Rm(o)))}function Om(e){return["table","td","th"].indexOf(Cm(e))>=0}function Lm(e){return gm(e)&&"fixed"!==Tm(e).position?e.offsetParent:null}function Fm(e){for(var t=fm(e),n=Lm(e);n&&Om(n)&&"static"===Tm(n).position;)n=Lm(n);return n&&("html"===Cm(n)||"body"===Cm(n)&&"static"===Tm(n).position)?t:n||function(e){var t=/firefox/i.test(Am());if(/Trident/i.test(Am())&&gm(e)&&"fixed"===Tm(e).position)return null;var n=Rm(e);for(_m(n)&&(n=n.host);gm(n)&&["html","body"].indexOf(Cm(n))<0;){var r=Tm(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}var Um="top",Nm="bottom",jm="right",zm="left",Gm="auto",Vm=[Um,Nm,jm,zm],Hm="start",Qm="end",Wm="clippingParents",qm="viewport",Xm="popper",Ym="reference",Km=Vm.reduce((function(e,t){return e.concat([t+"-"+Hm,t+"-"+Qm])}),[]),Jm=[].concat(Vm,[Gm]).reduce((function(e,t){return e.concat([t,t+"-"+Hm,t+"-"+Qm])}),[]),Zm="beforeRead",$m="read",eg="afterRead",tg="beforeMain",ng="main",rg="afterMain",ig="beforeWrite",sg="write",og="afterWrite",ag=[Zm,$m,eg,tg,ng,rg,ig,sg,og];function lg(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}var cg={placement:"bottom",modifiers:[],strategy:"absolute"};function ug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function hg(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,s=void 0===i?cg:i;return function(e,t,n){void 0===n&&(n=s);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},cg,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,u={state:a,setOptions:function(n){var i="function"==typeof n?n(a.options):n;h(),a.options=Object.assign({},s,a.options,i),a.scrollParents={reference:mm(e)?km(e):e.contextElement?km(e.contextElement):[],popper:km(t)};var o,c,p=function(e){var t=lg(e);return ag.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(r,a.options.modifiers),c=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(c).map((function(e){return c[e]}))));return a.orderedModifiers=p.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,i=e.effect;if("function"==typeof i){var s=i({state:a,name:t,instance:u,options:r});l.push(s||function(){})}})),u.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,n=e.popper;if(ug(t,n)){a.rects={reference:Im(t,Fm(n),"fixed"===a.options.strategy),popper:Pm(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<a.orderedModifiers.length;r++)if(!0!==a.reset){var i=a.orderedModifiers[r],s=i.fn,o=i.options,l=void 0===o?{}:o,h=i.name;"function"==typeof s&&(a=s({state:a,options:l,name:h,instance:u})||a)}else a.reset=!1,r=-1}}},update:(i=function(){return new Promise((function(e){u.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){h(),c=!0}};if(!ug(e,t))return u;function h(){l.forEach((function(e){return e()})),l=[]}return u.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var pg=hg(),dg={passive:!0},fg={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,s=void 0===i||i,o=r.resize,a=void 0===o||o,l=fm(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach((function(e){e.addEventListener("scroll",n.update,dg)})),a&&l.addEventListener("resize",n.update,dg),function(){s&&c.forEach((function(e){e.removeEventListener("scroll",n.update,dg)})),a&&l.removeEventListener("resize",n.update,dg)}},data:{}};function mg(e){return e.split("-")[0]}function gg(e){return e.split("-")[1]}function _g(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function vg(e){var t,n=e.reference,r=e.element,i=e.placement,s=i?mg(i):null,o=i?gg(i):null,a=n.x+n.width/2-r.width/2,l=n.y+n.height/2-r.height/2;switch(s){case Um:t={x:a,y:n.y-r.height};break;case Nm:t={x:a,y:n.y+n.height};break;case jm:t={x:n.x+n.width,y:l};break;case zm:t={x:n.x-r.width,y:l};break;default:t={x:n.x,y:n.y}}var c=s?_g(s):null;if(null!=c){var u="y"===c?"height":"width";switch(o){case Hm:t[c]=t[c]-(n[u]/2-r[u]/2);break;case Qm:t[c]=t[c]+(n[u]/2-r[u]/2)}}return t}var yg={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=vg({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},bg={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ag(e){var t,n=e.popper,r=e.popperRect,i=e.placement,s=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,h=e.isFixed,p=o.x,d=void 0===p?0:p,f=o.y,m=void 0===f?0:f,g="function"==typeof u?u({x:d,y:m}):{x:d,y:m};d=g.x,m=g.y;var _=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),y=zm,b=Um,A=window;if(c){var w=Fm(n),x="clientHeight",E="clientWidth";w===fm(n)&&"static"!==Tm(w=Sm(n)).position&&"absolute"===a&&(x="scrollHeight",E="scrollWidth"),(i===Um||(i===zm||i===jm)&&s===Qm)&&(b=Nm,m-=(h&&w===A&&A.visualViewport?A.visualViewport.height:w[x])-r.height,m*=l?1:-1),i!==zm&&(i!==Um&&i!==Nm||s!==Qm)||(y=jm,d-=(h&&w===A&&A.visualViewport?A.visualViewport.width:w[E])-r.width,d*=l?1:-1)}var C,S=Object.assign({position:a},c&&bg),M=!0===u?function(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:bm(t*r)/r||0,y:bm(n*r)/r||0}}({x:d,y:m}):{x:d,y:m};return d=M.x,m=M.y,l?Object.assign({},S,((C={})[b]=v?"0":"",C[y]=_?"0":"",C.transform=(A.devicePixelRatio||1)<=1?"translate("+d+"px, "+m+"px)":"translate3d("+d+"px, "+m+"px, 0)",C)):Object.assign({},S,((t={})[b]=v?m+"px":"",t[y]=_?d+"px":"",t.transform="",t))}var wg={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,l=void 0===a||a,c={placement:mg(t.placement),variation:gg(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Ag(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Ag(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},xg={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];gm(i)&&Cm(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});gm(r)&&Cm(r)&&(Object.assign(r.style,s),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},Eg={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,s=void 0===i?[0,0]:i,o=Jm.reduce((function(e,n){return e[n]=function(e,t,n){var r=mg(e),i=[zm,Um].indexOf(r)>=0?-1:1,s="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[zm,jm].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,s),e}),{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=o}},Cg={left:"right",right:"left",bottom:"top",top:"bottom"};function Sg(e){return e.replace(/left|right|bottom|top/g,(function(e){return Cg[e]}))}var Mg={start:"end",end:"start"};function Tg(e){return e.replace(/start|end/g,(function(e){return Mg[e]}))}function Dg(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&_m(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ig(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Pg(e,t,n){return t===qm?Ig(function(e,t){var n=fm(e),r=Sm(e),i=n.visualViewport,s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;var c=wm();(c||!c&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a+Mm(e),y:l}}(e,n)):mm(t)?function(e,t){var n=xm(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):Ig(function(e){var t,n=Sm(e),r=Em(e),i=null==(t=e.ownerDocument)?void 0:t.body,s=vm(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=vm(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+Mm(e),l=-r.scrollTop;return"rtl"===Tm(i||n).direction&&(a+=vm(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(Sm(e)))}function Rg(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Bg(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function kg(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,s=n.strategy,o=void 0===s?e.strategy:s,a=n.boundary,l=void 0===a?Wm:a,c=n.rootBoundary,u=void 0===c?qm:c,h=n.elementContext,p=void 0===h?Xm:h,d=n.altBoundary,f=void 0!==d&&d,m=n.padding,g=void 0===m?0:m,_=Rg("number"!=typeof g?g:Bg(g,Vm)),v=p===Xm?Ym:Xm,y=e.rects.popper,b=e.elements[f?v:p],A=function(e,t,n,r){var i="clippingParents"===t?function(e){var t=km(Rm(e)),n=["absolute","fixed"].indexOf(Tm(e).position)>=0&&gm(e)?Fm(e):e;return mm(n)?t.filter((function(e){return mm(e)&&Dg(e,n)&&"body"!==Cm(e)})):[]}(e):[].concat(t),s=[].concat(i,[n]),o=s[0],a=s.reduce((function(t,n){var i=Pg(e,n,r);return t.top=vm(i.top,t.top),t.right=ym(i.right,t.right),t.bottom=ym(i.bottom,t.bottom),t.left=vm(i.left,t.left),t}),Pg(e,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(mm(b)?b:b.contextElement||Sm(e.elements.popper),l,u,o),w=xm(e.elements.reference),x=vg({reference:w,element:y,strategy:"absolute",placement:i}),E=Ig(Object.assign({},y,x)),C=p===Xm?E:w,S={top:A.top-C.top+_.top,bottom:C.bottom-A.bottom+_.bottom,left:A.left-C.left+_.left,right:C.right-A.right+_.right},M=e.modifiersData.offset;if(p===Xm&&M){var T=M[i];Object.keys(S).forEach((function(e){var t=[jm,Nm].indexOf(e)>=0?1:-1,n=[Um,Nm].indexOf(e)>=0?"y":"x";S[e]+=T[n]*t}))}return S}var Og={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0===o||o,l=n.fallbackPlacements,c=n.padding,u=n.boundary,h=n.rootBoundary,p=n.altBoundary,d=n.flipVariations,f=void 0===d||d,m=n.allowedAutoPlacements,g=t.options.placement,_=mg(g),v=l||(_!==g&&f?function(e){if(mg(e)===Gm)return[];var t=Sg(e);return[Tg(e),t,Tg(t)]}(g):[Sg(g)]),y=[g].concat(v).reduce((function(e,n){return e.concat(mg(n)===Gm?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?Jm:l,u=gg(r),h=u?a?Km:Km.filter((function(e){return gg(e)===u})):Vm,p=h.filter((function(e){return c.indexOf(e)>=0}));0===p.length&&(p=h);var d=p.reduce((function(t,n){return t[n]=kg(e,{placement:n,boundary:i,rootBoundary:s,padding:o})[mg(n)],t}),{});return Object.keys(d).sort((function(e,t){return d[e]-d[t]}))}(t,{placement:n,boundary:u,rootBoundary:h,padding:c,flipVariations:f,allowedAutoPlacements:m}):n)}),[]),b=t.rects.reference,A=t.rects.popper,w=new Map,x=!0,E=y[0],C=0;C<y.length;C++){var S=y[C],M=mg(S),T=gg(S)===Hm,D=[Um,Nm].indexOf(M)>=0,I=D?"width":"height",P=kg(t,{placement:S,boundary:u,rootBoundary:h,altBoundary:p,padding:c}),R=D?T?jm:zm:T?Nm:Um;b[I]>A[I]&&(R=Sg(R));var B=Sg(R),k=[];if(s&&k.push(P[M]<=0),a&&k.push(P[R]<=0,P[B]<=0),k.every((function(e){return e}))){E=S,x=!1;break}w.set(S,k)}if(x)for(var O=function(e){var t=y.find((function(t){var n=w.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return E=t,"break"},L=f?3:1;L>0&&"break"!==O(L);L--);t.placement!==E&&(t.modifiersData[r]._skip=!0,t.placement=E,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Lg(e,t,n){return vm(e,ym(t,n))}var Fg={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,h=n.padding,p=n.tether,d=void 0===p||p,f=n.tetherOffset,m=void 0===f?0:f,g=kg(t,{boundary:l,rootBoundary:c,padding:h,altBoundary:u}),_=mg(t.placement),v=gg(t.placement),y=!v,b=_g(_),A="x"===b?"y":"x",w=t.modifiersData.popperOffsets,x=t.rects.reference,E=t.rects.popper,C="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,S="number"==typeof C?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),M=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,T={x:0,y:0};if(w){if(s){var D,I="y"===b?Um:zm,P="y"===b?Nm:jm,R="y"===b?"height":"width",B=w[b],k=B+g[I],O=B-g[P],L=d?-E[R]/2:0,F=v===Hm?x[R]:E[R],U=v===Hm?-E[R]:-x[R],N=t.elements.arrow,j=d&&N?Pm(N):{width:0,height:0},z=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},G=z[I],V=z[P],H=Lg(0,x[R],j[R]),Q=y?x[R]/2-L-H-G-S.mainAxis:F-H-G-S.mainAxis,W=y?-x[R]/2+L+H+V+S.mainAxis:U+H+V+S.mainAxis,q=t.elements.arrow&&Fm(t.elements.arrow),X=q?"y"===b?q.clientTop||0:q.clientLeft||0:0,Y=null!=(D=null==M?void 0:M[b])?D:0,K=B+W-Y,J=Lg(d?ym(k,B+Q-Y-X):k,B,d?vm(O,K):O);w[b]=J,T[b]=J-B}if(a){var Z,$="x"===b?Um:zm,ee="x"===b?Nm:jm,te=w[A],ne="y"===A?"height":"width",re=te+g[$],ie=te-g[ee],se=-1!==[Um,zm].indexOf(_),oe=null!=(Z=null==M?void 0:M[A])?Z:0,ae=se?re:te-x[ne]-E[ne]-oe+S.altAxis,le=se?te+x[ne]+E[ne]-oe-S.altAxis:ie,ce=d&&se?function(e,t,n){var r=Lg(e,t,n);return r>n?n:r}(ae,te,le):Lg(d?ae:re,te,d?le:ie);w[A]=ce,T[A]=ce-te}t.modifiersData[r]=T}},requiresIfExists:["offset"]},Ug={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=mg(n.placement),l=_g(a),c=[zm,jm].indexOf(a)>=0?"height":"width";if(s&&o){var u=function(e,t){return Rg("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Bg(e,Vm))}(i.padding,n),h=Pm(s),p="y"===l?Um:zm,d="y"===l?Nm:jm,f=n.rects.reference[c]+n.rects.reference[l]-o[l]-n.rects.popper[c],m=o[l]-n.rects.reference[l],g=Fm(s),_=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,v=f/2-m/2,y=u[p],b=_-h[c]-u[d],A=_/2-h[c]/2+v,w=Lg(y,A,b),x=l;n.modifiersData[r]=((t={})[x]=w,t.centerOffset=w-A,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&Dg(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ng(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function jg(e){return[Um,jm,Nm,zm].some((function(t){return e[t]>=0}))}var zg={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,s=t.modifiersData.preventOverflow,o=kg(t,{elementContext:"reference"}),a=kg(t,{altBoundary:!0}),l=Ng(o,r),c=Ng(a,i,s),u=jg(l),h=jg(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}},Gg=hg({defaultModifiers:[fg,yg,wg,xg,Eg,Og,Fg,Ug,zg]}),Vg="tippy-content",Hg="tippy-backdrop",Qg="tippy-arrow",Wg="tippy-svg-arrow",qg={passive:!0,capture:!0},Xg=function(){return document.body};function Yg(e,t,n){if(Array.isArray(e)){var r=e[t];return null==r?Array.isArray(n)?n[t]:n:r}return e}function Kg(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function Jg(e,t){return"function"==typeof e?e.apply(void 0,t):e}function Zg(e,t){return 0===t?e:function(r){clearTimeout(n),n=setTimeout((function(){e(r)}),t)};var n}function $g(e){return[].concat(e)}function e_(e,t){-1===e.indexOf(t)&&e.push(t)}function t_(e){return[].slice.call(e)}function n_(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function r_(){return document.createElement("div")}function i_(e){return["Element","Fragment"].some((function(t){return Kg(e,t)}))}function s_(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function o_(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function a_(e,t,n){var r=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[r](t,n)}))}function l_(e,t){for(var n=t;n;){var r;if(e.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var c_={isTouch:!1},u_=0;function h_(){c_.isTouch||(c_.isTouch=!0,window.performance&&document.addEventListener("mousemove",p_))}function p_(){var e=performance.now();e-u_<20&&(c_.isTouch=!1,document.removeEventListener("mousemove",p_)),u_=e}function d_(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var n=t._tippy;t.blur&&!n.state.isVisible&&t.blur()}}var f_=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),m_=Object.assign({appendTo:Xg,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),g_=Object.keys(m_);function __(e){var t=(e.plugins||[]).reduce((function(t,n){var r,i=n.name,s=n.defaultValue;return i&&(t[i]=void 0!==e[i]?e[i]:null!=(r=m_[i])?r:s),t}),{});return Object.assign({},e,t)}function v_(e,t){var n=Object.assign({},t,{content:Jg(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(__(Object.assign({},m_,{plugins:t}))):g_).reduce((function(t,n){var r=(e.getAttribute("data-tippy-"+n)||"").trim();if(!r)return t;if("content"===n)t[n]=r;else try{t[n]=JSON.parse(r)}catch(e){t[n]=r}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},m_.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}var y_=function(){return"innerHTML"};function b_(e,t){e[y_()]=t}function A_(e){var t=r_();return!0===e?t.className=Qg:(t.className=Wg,i_(e)?t.appendChild(e):b_(t,e)),t}function w_(e,t){i_(t.content)?(b_(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?b_(e,t.content):e.textContent=t.content)}function x_(e){var t=e.firstElementChild,n=t_(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(Vg)})),arrow:n.find((function(e){return e.classList.contains(Qg)||e.classList.contains(Wg)})),backdrop:n.find((function(e){return e.classList.contains(Hg)}))}}function E_(e){var t=r_(),n=r_();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=r_();function i(n,r){var i=x_(t),s=i.box,o=i.content,a=i.arrow;r.theme?s.setAttribute("data-theme",r.theme):s.removeAttribute("data-theme"),"string"==typeof r.animation?s.setAttribute("data-animation",r.animation):s.removeAttribute("data-animation"),r.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?s.setAttribute("role",r.role):s.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||w_(o,e.props),r.arrow?a?n.arrow!==r.arrow&&(s.removeChild(a),s.appendChild(A_(r.arrow))):s.appendChild(A_(r.arrow)):a&&s.removeChild(a)}return r.className=Vg,r.setAttribute("data-state","hidden"),w_(r,e.props),t.appendChild(n),n.appendChild(r),i(e.props,e.props),{popper:t,onUpdate:i}}E_.$$tippy=!0;var C_=1,S_=[],M_=[];function T_(e,t){void 0===t&&(t={});var n=m_.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",h_,qg),window.addEventListener("blur",d_);var r,i=Object.assign({},t,{plugins:n}),s=(r=e,i_(r)?[r]:function(e){return Kg(e,"NodeList")}(r)?t_(r):Array.isArray(r)?r:t_(document.querySelectorAll(r))).reduce((function(e,t){var n=t&&function(e,t){var n,r,i,s,o,a,l,c,u=v_(e,Object.assign({},m_,__(n_(t)))),h=!1,p=!1,d=!1,f=!1,m=[],g=Zg(q,u.interactiveDebounce),_=C_++,v=(c=u.plugins).filter((function(e,t){return c.indexOf(e)===t})),y={id:_,reference:e,popper:r_(),popperInstance:null,props:u,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(i)},setProps:function(t){if(!y.state.isDestroyed){B("onBeforeUpdate",[y,t]),Q();var n=y.props,r=v_(e,Object.assign({},n,n_(t),{ignoreAttributes:!0}));y.props=r,H(),n.interactiveDebounce!==r.interactiveDebounce&&(L(),g=Zg(q,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?$g(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):r.triggerTarget&&e.removeAttribute("aria-expanded"),O(),R(),w&&w(n,r),y.popperInstance&&(J(),$().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),B("onAfterUpdate",[y,t])}},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,r=c_.isTouch&&!y.props.touch,i=Yg(y.props.duration,0,m_.duration);if(!(e||t||n||r||T().hasAttribute("disabled")||(B("onShow",[y],!1),!1===y.props.onShow(y)))){if(y.state.isVisible=!0,M()&&(A.style.visibility="visible"),R(),j(),y.state.isMounted||(A.style.transition="none"),M()){var s=I();s_([s.box,s.content],0)}var o,l,c;a=function(){var e;if(y.state.isVisible&&!f){if(f=!0,A.offsetHeight,A.style.transition=y.props.moveTransition,M()&&y.props.animation){var t=I(),n=t.box,r=t.content;s_([n,r],i),o_([n,r],"visible")}k(),O(),e_(M_,y),null==(e=y.popperInstance)||e.forceUpdate(),B("onMount",[y]),y.props.animation&&M()&&function(e,t){G(e,(function(){y.state.isShown=!0,B("onShown",[y])}))}(i)}},l=y.props.appendTo,c=T(),(o=y.props.interactive&&l===Xg||"parent"===l?c.parentNode:Jg(l,[c])).contains(A)||o.appendChild(A),y.state.isMounted=!0,J()}},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,r=Yg(y.props.duration,1,m_.duration);if(!(e||t||n)&&(B("onHide",[y],!1),!1!==y.props.onHide(y))){if(y.state.isVisible=!1,y.state.isShown=!1,f=!1,h=!1,M()&&(A.style.visibility="hidden"),L(),z(),R(!0),M()){var i=I(),s=i.box,o=i.content;y.props.animation&&(s_([s,o],r),o_([s,o],"hidden"))}k(),O(),y.props.animation?M()&&function(e,t){G(e,(function(){!y.state.isVisible&&A.parentNode&&A.parentNode.contains(A)&&t()}))}(r,y.unmount):y.unmount()}},hideWithInteractivity:function(e){D().addEventListener("mousemove",g),e_(S_,g),g(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide(),y.state.isMounted&&(Z(),$().forEach((function(e){e._tippy.unmount()})),A.parentNode&&A.parentNode.removeChild(A),M_=M_.filter((function(e){return e!==y})),y.state.isMounted=!1,B("onHidden",[y]))},destroy:function(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),Q(),delete e._tippy,y.state.isDestroyed=!0,B("onDestroy",[y]))}};if(!u.render)return y;var b=u.render(y),A=b.popper,w=b.onUpdate;A.setAttribute("data-tippy-root",""),A.id="tippy-"+y.id,y.popper=A,e._tippy=y,A._tippy=y;var x=v.map((function(e){return e.fn(y)})),E=e.hasAttribute("aria-expanded");return H(),O(),R(),B("onCreate",[y]),u.showOnCreate&&ee(),A.addEventListener("mouseenter",(function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()})),A.addEventListener("mouseleave",(function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&D().addEventListener("mousemove",g)})),y;function C(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function S(){return"hold"===C()[0]}function M(){var e;return!(null==(e=y.props.render)||!e.$$tippy)}function T(){return l||e}function D(){var e,t,n=T().parentNode;return n&&null!=(t=$g(n)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document}function I(){return x_(A)}function P(e){return y.state.isMounted&&!y.state.isVisible||c_.isTouch||s&&"focus"===s.type?0:Yg(y.props.delay,e?0:1,m_.delay)}function R(e){void 0===e&&(e=!1),A.style.pointerEvents=y.props.interactive&&!e?"":"none",A.style.zIndex=""+y.props.zIndex}function B(e,t,n){var r;void 0===n&&(n=!0),x.forEach((function(n){n[e]&&n[e].apply(n,t)})),n&&(r=y.props)[e].apply(r,t)}function k(){var t=y.props.aria;if(t.content){var n="aria-"+t.content,r=A.id;$g(y.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(y.state.isVisible)e.setAttribute(n,t?t+" "+r:r);else{var i=t&&t.replace(r,"").trim();i?e.setAttribute(n,i):e.removeAttribute(n)}}))}}function O(){!E&&y.props.aria.expanded&&$g(y.props.triggerTarget||e).forEach((function(e){y.props.interactive?e.setAttribute("aria-expanded",y.state.isVisible&&e===T()?"true":"false"):e.removeAttribute("aria-expanded")}))}function L(){D().removeEventListener("mousemove",g),S_=S_.filter((function(e){return e!==g}))}function F(t){if(!c_.isTouch||!d&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!l_(A,n)){if($g(y.props.triggerTarget||e).some((function(e){return l_(e,n)}))){if(c_.isTouch)return;if(y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else B("onClickOutside",[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),p=!0,setTimeout((function(){p=!1})),y.state.isMounted||z())}}}function U(){d=!0}function N(){d=!1}function j(){var e=D();e.addEventListener("mousedown",F,!0),e.addEventListener("touchend",F,qg),e.addEventListener("touchstart",N,qg),e.addEventListener("touchmove",U,qg)}function z(){var e=D();e.removeEventListener("mousedown",F,!0),e.removeEventListener("touchend",F,qg),e.removeEventListener("touchstart",N,qg),e.removeEventListener("touchmove",U,qg)}function G(e,t){var n=I().box;function r(e){e.target===n&&(a_(n,"remove",r),t())}if(0===e)return t();a_(n,"remove",o),a_(n,"add",r),o=r}function V(t,n,r){void 0===r&&(r=!1),$g(y.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,r),m.push({node:e,eventType:t,handler:n,options:r})}))}function H(){var e;S()&&(V("touchstart",W,{passive:!0}),V("touchend",X,{passive:!0})),(e=y.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(V(e,W),e){case"mouseenter":V("mouseleave",X);break;case"focus":V(f_?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}}))}function Q(){m.forEach((function(e){var t=e.node,n=e.eventType,r=e.handler,i=e.options;t.removeEventListener(n,r,i)})),m=[]}function W(e){var t,n=!1;if(y.state.isEnabled&&!K(e)&&!p){var r="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,O(),!y.state.isVisible&&Kg(e,"MouseEvent")&&S_.forEach((function(t){return t(e)})),"click"===e.type&&(y.props.trigger.indexOf("mouseenter")<0||h)&&!1!==y.props.hideOnClick&&y.state.isVisible?n=!0:ee(e),"click"===e.type&&(h=!n),n&&!r&&te(e)}}function q(e){var t=e.target,n=T().contains(t)||A.contains(t);if("mousemove"!==e.type||!n){var r=$().concat(A).map((function(e){var t,n=null==(t=e._tippy.popperInstance)?void 0:t.state;return n?{popperRect:e.getBoundingClientRect(),popperState:n,props:u}:null})).filter(Boolean);(function(e,t){var n=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,i=e.popperState,s=e.props.interactiveBorder,o=i.placement.split("-")[0],a=i.modifiersData.offset;if(!a)return!0;var l="bottom"===o?a.top.y:0,c="top"===o?a.bottom.y:0,u="right"===o?a.left.x:0,h="left"===o?a.right.x:0,p=t.top-r+l>s,d=r-t.bottom-c>s,f=t.left-n+u>s,m=n-t.right-h>s;return p||d||f||m}))})(r,e)&&(L(),te(e))}}function X(e){K(e)||y.props.trigger.indexOf("click")>=0&&h||(y.props.interactive?y.hideWithInteractivity(e):te(e))}function Y(e){y.props.trigger.indexOf("focusin")<0&&e.target!==T()||y.props.interactive&&e.relatedTarget&&A.contains(e.relatedTarget)||te(e)}function K(e){return!!c_.isTouch&&S()!==e.type.indexOf("touch")>=0}function J(){Z();var t=y.props,n=t.popperOptions,r=t.placement,i=t.offset,s=t.getReferenceClientRect,o=t.moveTransition,l=M()?x_(A).arrow:null,c=s?{getBoundingClientRect:s,contextElement:s.contextElement||T()}:e,u=[{name:"offset",options:{offset:i}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(M()){var n=I().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?n.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?n.setAttribute("data-"+e,""):n.removeAttribute("data-"+e)})),t.attributes.popper={}}}}];M()&&l&&u.push({name:"arrow",options:{element:l,padding:3}}),u.push.apply(u,(null==n?void 0:n.modifiers)||[]),y.popperInstance=Gg(c,A,Object.assign({},n,{placement:r,onFirstUpdate:a,modifiers:u}))}function Z(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function $(){return t_(A.querySelectorAll("[data-tippy-root]"))}function ee(e){y.clearDelayTimeouts(),e&&B("onTrigger",[y,e]),j();var t=P(!0),r=C(),i=r[0],s=r[1];c_.isTouch&&"hold"===i&&s&&(t=s),t?n=setTimeout((function(){y.show()}),t):y.show()}function te(e){if(y.clearDelayTimeouts(),B("onUntrigger",[y,e]),y.state.isVisible){if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&h)){var t=P(!1);t?r=setTimeout((function(){y.state.isVisible&&y.hide()}),t):i=requestAnimationFrame((function(){y.hide()}))}}else z()}}(t,i);return n&&e.push(n),e}),[]);return i_(e)?s[0]:s}T_.defaultProps=m_,T_.setDefaultProps=function(e){Object.keys(e).forEach((function(t){m_[t]=e[t]}))},T_.currentInput=c_;var D_=Object.assign({},xg,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}}),I_=function(e,t){var n;void 0===t&&(t={});var r,i=e,s=[],o=[],a=t.overrides,l=[],c=!1;function u(){o=i.map((function(e){return $g(e.props.triggerTarget||e.reference)})).reduce((function(e,t){return e.concat(t)}),[])}function h(){s=i.map((function(e){return e.reference}))}function p(e){i.forEach((function(t){e?t.enable():t.disable()}))}function d(e){return i.map((function(t){var n=t.setProps;return t.setProps=function(i){n(i),t.reference===r&&e.setProps(i)},function(){t.setProps=n}}))}function f(e,t){var n=o.indexOf(t);if(t!==r){r=t;var l=(a||[]).concat("content").reduce((function(e,t){return e[t]=i[n].props[t],e}),{});e.setProps(Object.assign({},l,{getReferenceClientRect:"function"==typeof l.getReferenceClientRect?l.getReferenceClientRect:function(){var e;return null==(e=s[n])?void 0:e.getBoundingClientRect()}}))}}p(!1),h(),u();var m,g,_,v={fn:function(){return{onDestroy:function(){p(!0)},onHidden:function(){r=null},onClickOutside:function(e){e.props.showOnCreate&&!c&&(c=!0,r=null)},onShow:function(e){e.props.showOnCreate&&!c&&(c=!0,f(e,s[0]))},onTrigger:function(e,t){f(e,t.currentTarget)}}}},y=T_(r_(),Object.assign({},(m=t,g=["overrides"],_=Object.assign({},m),g.forEach((function(e){delete _[e]})),_),{plugins:[v].concat(t.plugins||[]),triggerTarget:o,popperOptions:Object.assign({},t.popperOptions,{modifiers:[].concat((null==(n=t.popperOptions)?void 0:n.modifiers)||[],[D_])})})),b=y.show;y.show=function(e){if(b(),!r&&null==e)return f(y,s[0]);if(!r||null!=e){if("number"==typeof e)return s[e]&&f(y,s[e]);if(i.indexOf(e)>=0){var t=e.reference;return f(y,t)}return s.indexOf(e)>=0?f(y,e):void 0}},y.showNext=function(){var e=s[0];if(!r)return y.show(0);var t=s.indexOf(r);y.show(s[t+1]||e)},y.showPrevious=function(){var e=s[s.length-1];if(!r)return y.show(e);var t=s.indexOf(r),n=s[t-1]||e;y.show(n)};var A=y.setProps;return y.setProps=function(e){a=e.overrides||a,A(e)},y.setInstances=function(e){p(!0),l.forEach((function(e){return e()})),i=e,p(!1),h(),u(),l=d(y),y.setProps({triggerTarget:o})},l=d(y),y};T_.setDefaultProps({render:E_});var P_=T_;class R_ extends pm{async _refreshUi(){if(!await super._refreshUi())return!1;dm.RemoveAll(R_.PluginType);for(const e of this.variations)dm.Create(R_.PluginType,e.title,5,20,0,e.materials.map((n=>{let r;if(e.preview.startsWith("generate:"))r=this._previewGenerator.generate(n,e.preview.split(":")[1]);else{const i=n[e.preview]||"#ff00ff";r=i.image?(0,t.imageBitmapToBase64)(i.image,100):void 0,r||(r=(0,t.makeColorSvgCircle)(i?.isColor?i.getHexString():i))}return{id:n.uuid,image:r,onClick:t=>this.applyVariation(e,t),tooltip:n.name||n.uuid}})),((e,t)=>P_(e,{placement:"bottom",content:t.tooltip})));return dm.RebuildUi(this._viewer?.container),!0}}R_.PluginType="MaterialConfiguratorPlugin";class B_ extends qt{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[fo],this.variations=[],this._selectedSwitchNode=()=>{const e=this._picking?.getSelectedObject();if(!e)return;const t=this.variations.map((e=>e.name));let n;return e.traverseAncestors((e=>{n||e.name&&t.includes(e.name)&&(n=e)})),n},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map((e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()})))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find((t=>t.name===e.name)),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map((e=>({label:e,value:e})))}]]}}async onAdded(e){await super.onAdded(e),this._picking=this._viewer?.getPluginByType("Picking"),this._picking?.addEventListener("selectedObjectChanged",(()=>{this.uiConfig.uiRefresh?.()})),e.addEventListener("postFrame",(()=>{this._uiNeedRefresh&&this._refreshUi()})),e.addEventListener("preRender",(()=>{if(this._viewer&&this.enabled){for(const e of this.variations){if(!e.name)continue;const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;e.selected||(e.selected=t.children[0].name||t.children[0].uuid);for(const n of t.children)n.userData.__oldVisible=n.visible,n.visible=(n.name||n.uuid)===e.selected}this._isVisibleChanged=!0}})),e.addEventListener("postRender",(()=>{if(this._viewer&&this._isVisibleChanged){for(const e of this.variations){if(!e.name)continue;const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;for(const e of t.children){if(void 0===e.userData.__oldVisible)return;e.visible=e.userData.__oldVisible,delete e.userData.__oldVisible}}this._isVisibleChanged=!1}})),this.addEventListener("deserialize",(async()=>{this.refreshUi()}))}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,this.uiConfig.uiRefresh?.(),!0)}}!function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe()],B_.prototype,"variations",void 0);class k_ extends B_{_refreshUi(){if(!super._refreshUi())return!1;dm.RemoveAll(k_.PluginType);for(const e of this.variations){const t=this._viewer.scene.getObjectByName(e.name);t?(t.children.length<1&&console.warn("SwitchNode does not have enough children",e),dm.Create(k_.PluginType,e.title,Math.min(5,t.children.length),20,0,t.children.map((t=>{const r=e.camView,i=new n.Pa4((r.includes("right")?1:0)-(r.includes("left")?1:0),(r.includes("top")?1:0)-(r.includes("bottom")?1:0),(r.includes("front")?1:0)-(r.includes("back")?1:0));e.camDistance||(e.camDistance=1);const s=um(this._viewer,t,void 0,7,i.multiplyScalar(.5*e.camDistance));return{id:t.uuid,image:s,onClick:()=>{e.selected=t.name||t.uuid,this._viewer?.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:t.name||t.uuid}})),((e,t)=>P_(e,{placement:"bottom",content:t.tooltip})))):console.warn("no object found for variation, skipping",e)}return dm.RebuildUi(this._viewer?.container),!0}}k_.PluginType="SwitchNodePlugin";class O_ extends qt{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{this.enabled&&this.uiConfig?.uiRefresh?.("postFrame",!0)},this.dependencies=[fo],this._selectedObject=()=>this._picking?.getSelectedObject()||void 0,this._selectedMaterial=()=>this._selectedObject()?.material||void 0}async onAdded(e){await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=this._viewer?.getPluginByType("Picking"),this._previewGenerator=new hm(this._viewer),this._picking?.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){return this._previewGenerator?.dispose(),this._previewGenerator=void 0,this._picking?.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}O_.PluginType="MaterialLibraryBasePlugin",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([ht("Enabled")],O_.prototype,"enabled",void 0);class L_ extends O_{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:lt(),children:[...bt(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(fo).materials.getAllMaterials().map((e=>({label:e.name||e.uuid,value:e.uuid})))||[]]],getValue:()=>this._selectedMaterial()?.uuid,setValue:e=>{const t=this._viewer?.getPlugin(fo)?.materials?.findMaterial(e);if(t)if(this.replaceMaterial)this._selectedObject()?.setMaterial?.(t);else{const e=this._selectedMaterial();if(e){const n=e.name,r=e.uuid;e.copyProps(t),e.name=n,e.uuid=r,e.userData.uuid&&(e.userData.uuid=r)}}this._refreshUi()}})]}}async _refreshUi(){if(!await super._refreshUi())return!1;const e=[cn.TypeSlug,Sc.TypeSlug],n=this._viewer?.getPlugin(fo)?.materials,r=e.map((e=>[e,n?.getMaterialsOfType(e)]));dm.RemoveAll(L_.PluginType);for(const[e,i]of r)dm.Create(L_.PluginType,e,5,20,0,i?.filter((e=>!e.userData.__runtimeMaterial)).map((e=>{let r;const i="generate:sphere";if(i.startsWith("generate:"))r=this._previewGenerator.generate(e,i.split(":")[1]);else{const n=e[i]||"#ff00ff";r=n.image?(0,t.imageBitmapToBase64)(n.image,100):void 0,r||(r=(0,t.makeColorSvg)(n))}return{id:e.uuid,image:r,onClick:e=>{const t=n?.findMaterial(e);if(t){const e=t.userData.__appliedMeshes;if(e?.size){const t=e.keys().next().value;t.dispatchEvent({type:"select",value:t})}}},tooltip:e.name||e.uuid}})),((e,t)=>P_(e,{placement:"bottom",content:t.tooltip})));return dm.RebuildUi(this._viewer?.container),!0}}L_.PluginType="MaterialLibraryPlugin",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([ht("Replace Material")],L_.prototype,"replaceMaterial",void 0);class F_ extends n.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,n){e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n#include <project_vertex>\ngl_Position = vec4(uv*2.-1., 0, 1.); \n        "),e.vertexShader=e.vertexShader.replace("void main() {","\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n        "),e.fragmentShader=e.fragmentShader.replace("void main() {","\nvarying vec2 vUv;\nuniform sampler2D tLastThis;\nvoid main() {\n        "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",t.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,n)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}!function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Q({propKey:"tLastThis"})],F_.prototype,"lastFrameTexture",void 0);var U_=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class N_ extends t.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(e,n)=>t.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(e,r,i)=>{"aoMap"===this.groundMapMode?e.fragmentShader=Lt(e.fragmentShader,"#include <aomap_fragment>",Lt(n.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):"map"===this.groundMapMode?e.fragmentShader=Lt(e.fragmentShader,"#include <map_fragment>",Lt(n.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):"alphaMap"===this.groundMapMode&&(e.fragmentShader=Lt(e.fragmentShader,"#include <alphamap_fragment>",Lt(n.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),e.fragmentShader=Lt(e.fragmentShader,"#include <output_fragment>",t.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&i.capabilities.isWebGL2&&(e.fragmentShader=Lt(e.fragmentShader,"#include <output_fragment>",t.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(e,t)=>{t.materialObject.userData.gMapMode!==this.groundMapMode&&(t.materialObject.userData.gMapMode=this.groundMapMode,t.materialObject.needsUpdate=!0)},isCompatible:e=>e.isMeshStandardMaterial2},this._viewer=e;const r=new ql(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new n.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new n.Pa4(10,10,10),normalDirection:new n.Pa4(0,1,0)});r.shadow.camera.updateProjectionMatrix(),r.layers.disableAll(),r.layers.set(this._lightLayer),this._light=r,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new F_({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:n.jFi}),this._shadowBlurMat=new Nt({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new n.FM8(.5,.5)},direction:{value:new n.FM8(.5,.5)}},vertexShader:jo,fragmentShader:"#include <packing>\nuniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}"})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),"alphaMap"===this.groundMapMode?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){this.materialExtension?.setDirty?.(),this._viewer?.setDirty()}fromJSON(e,t){return je(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e)return!1;if(++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:n.ywz,depthBuffer:!1,size:new n.FM8(t,t),sizeMultiplier:void 0,colorSpace:n.aCh,format:n.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const r=this._viewer.renderer.rendererObject,i=r.shadowMap,s=i.type,o=i.needsUpdate,a=i.autoUpdate;i.type=n._MY,i.needsUpdate=!0,i.autoUpdate=!1;const l=this._viewer.scene,c=new n.S9g;c.disableAll(),l.modelObject.traverse((e=>{e.isLight&&e!==this._light.lightObject&&(e.userData.__gp_layers=e.layers,e.layers=c)}));const u=l.activeCamera.cameraObject;if(0!=(u.layers.mask&1<<this._lightLayer))throw"Camera can render pseudo directional light, check layers";u.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Y(r,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},(()=>this._viewer.renderer.renderScene(l))),u.layers.disable(this._lightLayer);const h=u.layers.mask;u.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const p=this._viewer.renderer.getTempTarget({type:n.ywz,depthBuffer:!1,size:new n.FM8(t,t),colorSpace:n.aCh,format:n.wk1}),d=p.texture.colorSpace;p.texture.colorSpace=n.aCh,this._viewer.renderer.blit(this._target.texture,p,{clear:!0});{const t=e.material,n=e.frustumCulled,i=r.getRenderTarget(),s=r.getActiveCubeFace(),o=r.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,r.setRenderTarget(this._target);const a=!1;this._shadowMat.opacity=a?1/this.maxFrameNumber:Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=p.texture,this._shadowMat.needsUpdate=!0,Y(r,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},(()=>this._viewer.renderer.renderScene(l))),r.setRenderTarget(i,s,o),e.frustumCulled=n,e.material=t,this.smoothShadow&&this._applySmoothFilter(this._target,p)}return p.texture.colorSpace=d,this._viewer.renderer.releaseTempTarget(p),e.layers.disable(this._lightLayer),u.layers.mask=h,l.modelObject.traverse((e=>{e.isLight&&e!==this._light.lightObject&&(e.layers=e.userData.__gp_layers,delete e.userData.__gp_layers)})),i.type=s,i.needsUpdate=o,i.autoUpdate=a,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===this._target?.texture&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===this._target?.texture&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===this._target?.texture&&(this._attachedMesh.material.map=null)):this._target&&("alphaMap"===this.groundMapMode&&(this._attachedMesh.material.alphaMap=this._target.texture),"aoMap"===this.groundMapMode&&(this._attachedMesh.material.aoMap=this._target.texture),"map"===this.groundMapMode&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&"alphaMap"===this.groundMapMode,this._attachedMesh.material.alphaTest=e||"alphaMap"!==this.groundMapMode?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}U_([Oe("randomizedLight")],N_.prototype,"_light",void 0),U_([(0,t.onChange)(N_.prototype.reset),Oe()],N_.prototype,"maxFrameNumber",void 0),U_([(0,t.onChange)(N_.prototype.reset),Oe()],N_.prototype,"smoothShadow",void 0),U_([(0,t.onChange)(N_.prototype._groundMapModeChanged),Oe()],N_.prototype,"groundMapMode",void 0),U_([Oe(),(0,t.onChange)(N_.prototype._alphaVignetteChanged)],N_.prototype,"alphaVignette",void 0),U_([Oe(),(0,t.onChange)(N_.prototype._alphaVignetteChanged)],N_.prototype,"alphaVignetteAxis",void 0),U_([Oe()],N_.prototype,"maxBakeCount",void 0);var j_=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class z_ extends n.Kj0{_updateExtension(){this.transparentReflectionBackground=this.reflectorModePhysical,this.materialExtension?.setDirty?.()}constructor(e,t,r=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new n.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(e,t,n)=>{if(this.enabled){e.vertexShader=e.vertexShader.replace("void main() {","void main() {\nvRefUv = refTextureMatrix * vec4( position, 1.0 );");const t="#glMarker beforeModulation";e.fragmentShader=e.fragmentShader.replace(t,"\n                    if(roughnessFactor < 0.95) {\n                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;\n                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));\n                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);\n                        // refBaseColor.rgb = vec3(refBaseColor.a);\n                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);\n                        "+(this.reflectorModePhysical?"\n                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 \n                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);\n                        #endif\n                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);\n                        ":"\n                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);\n                        diffuseColor.a *= refBaseColor.a;\n                        ")+"}\n"+t)}},parsVertexSnippet:()=>this.enabled?"\n\t\tuniform mat4 refTextureMatrix;\n\t\tvarying vec4 vRefUv;\n":"",parsFragmentSnippet:()=>this.enabled?Jo+"\n"+zo+"\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvarying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}\n#pragma unroll_loop_end\nreturn vec4(colorSum/weightSum,1.);}":"",computeCacheKey:e=>this.enabled+" "+e.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(e,{materialObject:t})=>{t.userData.__lastTransparent!==t.transparent&&(t.needsUpdate=!0,t.userData.__lastTransparent=t.transparent)},isCompatible:e=>e.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const i=new n.JOQ,s=new n.Pa4,o=new n.Pa4,a=new n.Pa4,l=new n.yGw,c=new n.Pa4(0,0,-1),u=new n.Ltg,h=new n.Pa4,p=new n.Pa4,d=new n.Ltg,f=new n.yGw,m=new n.cPb;n.M8C.isPowerOfTwo(t.texture.image.width)&&n.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(e,t,n)=>{if(!this.enabled||!e.userData.mainRenderPass)return;if(!this.reflectionTargetNeedsUpdate)return;const g=n.view?Object.assign({},n.view):null;if(g&&n.clearViewOffset&&n.clearViewOffset(),o.setFromMatrixPosition(this.matrixWorld),a.setFromMatrixPosition(n.matrixWorld),l.extractRotation(this.matrixWorld),s.set(0,0,1),s.applyMatrix4(l),h.subVectors(o,a),h.dot(s)>0)return;h.reflect(s).negate(),h.add(o),l.extractRotation(n.matrixWorld),c.set(0,0,-1),c.applyMatrix4(l),c.add(a),p.subVectors(o,c),p.reflect(s).negate(),p.add(o),m.position.copy(h),m.up.set(0,1,0),m.up.applyMatrix4(l),m.up.reflect(s),m.lookAt(p),m.far=2,m.near=0,m.updateMatrixWorld(),m.projectionMatrix.copy(n.projectionMatrix),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(m.projectionMatrix),f.multiply(m.matrixWorldInverse),f.multiply(this.matrixWorld),i.setFromNormalAndCoplanarPoint(s,o),i.applyMatrix4(m.matrixWorldInverse),u.set(i.normal.x,i.normal.y,i.normal.z,i.constant);const _=m.projectionMatrix;d.x=(Math.sign(u.x)+_.elements[8])/_.elements[0],d.y=(Math.sign(u.y)+_.elements[9])/_.elements[5],d.z=-1,d.w=(1+_.elements[10])/_.elements[14],u.multiplyScalar(2/u.dot(d)),_.elements[2]=u.x,_.elements[6]=u.y,_.elements[10]=u.z+1-r,_.elements[14]=u.w,this.visible=!1;const v=e.getRenderTarget(),y=e.xr.enabled,b=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this._renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear();const A=t.background;this.transparentReflectionBackground&&(t.background=null);const w=!this.transparentReflectionBackground;A&&w&&(A.userData||(A.userData={}),A.userData.flipX=!A.userData.flipX),Y(e,{shadowMapRender:!1,backgroundRender:w,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},(()=>e.render(t,m))),A&&w&&(A.userData.flipX=!A.userData.flipX||void 0),this.transparentReflectionBackground&&(t.background=A),e.xr.enabled=y,e.shadowMap.autoUpdate=b,e.setRenderTarget(v),g?.enabled&&n.setViewOffset&&n.setViewOffset(g.fullWidth,g.fullHeight,g.offsetX,g.offsetY,g.width,g.height);const x=n.viewport;void 0!==x&&e.state.viewport(x),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=f,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new n.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=f}getRenderTarget(){return this._renderTarget}}j_([(0,t.onChange)(z_.prototype._updateExtension)],z_.prototype,"enabled",void 0),j_([(0,t.onChange)(z_.prototype._updateExtension)],z_.prototype,"reflectorModePhysical",void 0),z_.prototype.isReflector=!0;var G_=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class V_ extends qt{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[fo],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new n._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new n.Kj0(this._geometry)}async onAdded(e){await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(fo);const t=this._createMesh();t.userData.physicsMass=0,this._iMesh=await(this._manager?.addImportedSingle(t,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=this._iMesh?.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){return this._removeMaterial(),this._geometry.dispose(),this._material?.dispose(),this._iMesh?.dispose?.(),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){!1!==e?.geometryChanged&&!1!==e?.updateGround&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){const e=this._viewer?.scene.activeCamera.controls;e&&(void 0!==e.maxPolarAngle?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){if(!this._mesh)return;if(!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const t=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const r=t.getCenter(new n.Pa4).sub(new n.Pa4(0,t.getSize(new n.Pa4).y/2+this.yOffset,0));e=e||r.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(r)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new n.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,this._mesh.setDirty?.()),this._transformNeedRefresh=!1}else e&&this._viewer?.scene.setDirty()}_refreshMaterial(){if(!this._viewer)return!1;if(!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??this._manager?.materials?.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let t=!1;if(e!==this._material){this._removeMaterial(),e&&(this._material=e);const n=this._material?.uuid;n||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(this._mesh?.setMaterial??(e=>{this._mesh&&(this._mesh.material=e.materialObject)}))(this._material)),t=!0}return this._material&&(void 0===this._material.userData.__renderToDepth&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),void 0===this._material.userData.__postTonemap&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),t}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>this._material?.uiConfig]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}G_([Oe("material")],V_.prototype,"_material",void 0),G_([(0,t.onChange)(V_.prototype.refreshTransform),Oe()],V_.prototype,"visible",void 0),G_([(0,t.onChange2)(V_.prototype._onSceneUpdate),Oe()],V_.prototype,"size",void 0),G_([(0,t.onChange2)(V_.prototype._onSceneUpdate),Oe()],V_.prototype,"yOffset",void 0),G_([(0,t.onChange)(V_.prototype._refreshOptions2),Oe()],V_.prototype,"renderToDepth",void 0),G_([(0,t.onChange)(V_.prototype._refreshOptions2),Oe()],V_.prototype,"tonemapGround",void 0),G_([(0,t.onChange)(V_.prototype._refreshCameraLimits),Oe()],V_.prototype,"limitCameraAboveGround",void 0);var H_=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class Q_ extends V_{get shadowBaker(){return this._shadowBaker}bakeShadows(){this._shadowBaker?.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(Rd),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new z_(this._geometry,this._viewer.renderer.createTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:n.D1R,magFilter:n.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...e)=>{let n=this._viewer?.getPluginByType("SSReflection")?.passes.ssr.passObject;n&&!n.enabled&&(n=void 0),n&&(n.enabled=!1);let r=this._viewer?.getPluginByType("SSBevelPlugin")?.pass?.passObject;r&&!r.enabled&&(r=void 0),r&&(r.enabled=!1),t(...e),n&&(n.enabled=!0),r&&(r.enabled=!0)},e}async onAdded(e){await super.onAdded(e),this._showDebug&&(e.getPlugin(Rd)?.addTexture("bake_ground_1",(()=>this._shadowBaker?.light.shadow.map?.texture),[100,100,200,200]),e.getPlugin(Rd)?.addTexture("bake_ground_2",(()=>this._shadowBaker?.target?.texture),[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&(this._material.unregisterMaterialExtensions?.([this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const e=this._mesh.materialExtension;e||console.warn("unable to find the extension to unregister"),this._material.unregisterMaterialExtensions?.([e]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){super._onSceneUpdate(e),!1!==e.geometryChanged&&this.autoBakeShadows&&this._shadowBaker?.reset()}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new N_(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const e=this._mesh.materialExtension;e.updaters=[this._viewer.scene,this._viewer.renderer],this._material.registerMaterialExtensions?.([e]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&(this._material.registerMaterialExtensions?.([this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>!this._shadowBaker?.alphaVignette||!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map((e=>({label:e,value:e}))),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[this._shadowBaker?.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[this._shadowBaker?.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[this._shadowBaker?.light?.shadowParams,"enabled"],onChange:[this._shadowBaker?.light?.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[this._shadowBaker?.light?.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[this._shadowBaker?.light?.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[this._shadowBaker?.light?.randomParams,"distanceScale"],onChange:[this._shadowBaker?.light?.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[this._shadowBaker?.light?.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[this._shadowBaker?.light?.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[this._shadowBaker?.light?.shadowParams,"radius"],onChange:[this._shadowBaker?.light?.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[this._shadowBaker?.light?.shadowParams,"frustumSize"],onChange:[this._shadowBaker?.light?.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[this._shadowBaker?.light?.shadowParams,"bias"],onChange:[this._shadowBaker?.light?.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Q_.PluginType="Ground",H_([(0,t.onChange)(Q_.prototype.refreshOptions),Oe()],Q_.prototype,"bakedShadows",void 0),H_([(0,t.onChange)(Q_.prototype.refreshOptions),Oe()],Q_.prototype,"groundReflection",void 0),H_([(0,t.onChange)(Q_.prototype.refreshOptions),Oe()],Q_.prototype,"physicalReflections",void 0),H_([Oe("shadowBaker")],Q_.prototype,"_shadowBaker",void 0);class W_ extends n.yxD{constructor(e){super(e),this.type=n.cLu}parse(e){const t=65536,r=14,i=65537,s=1<<r,o=Math.pow(2.7182818,2.2),a={l:0,c:0,lc:0};function l(e,t,n,r,i){for(;n<e;)t=t<<8|N(r,i),n+=8;n-=e,a.l=t>>n&(1<<e)-1,a.c=t,a.lc=n}const c=new Array(59);function u(e){return 63&e}function h(e){return e>>6}const p={c:0,lc:0};function d(e,t,n,r){e=e<<8|N(n,r),t+=8,p.c=e,p.lc=t}const f={c:0,lc:0};function m(e,t,n,r,i,s,o,a,l){if(e==t){r<8&&(d(n,r,i,s),n=p.c,r=p.lc);let e=n>>(r-=8);if(e=new Uint8Array([e])[0],a.value+e>l)return!1;const t=o[a.value-1];for(;e-- >0;)o[a.value++]=t}else{if(!(a.value<l))return!1;o[a.value++]=e}f.c=n,f.lc=r}function g(e){return 65535&e}function _(e){const t=g(e);return t>32767?t-65536:t}const v={a:0,b:0};function y(e,t){const n=_(e),r=_(t),i=n+(1&r)+(r>>1),s=i,o=i-r;v.a=s,v.b=o}function b(e,t){const n=g(e),r=g(t),i=n-(r>>1)&65535,s=r+i-32768&65535;v.a=s,v.b=i}function A(e,t,n,r,i,s,o){const a=o<16384,l=n>i?i:n;let c,u,h=1;for(;h<=l;)h<<=1;for(h>>=1,c=h,h>>=1;h>=1;){u=0;const o=u+s*(i-c),l=s*h,p=s*c,d=r*h,f=r*c;let m,g,_,A;for(;u<=o;u+=p){let i=u;const s=u+r*(n-c);for(;i<=s;i+=f){const n=i+d,r=i+l,s=r+d;a?(y(e[i+t],e[r+t]),m=v.a,_=v.b,y(e[n+t],e[s+t]),g=v.a,A=v.b,y(m,g),e[i+t]=v.a,e[n+t]=v.b,y(_,A),e[r+t]=v.a,e[s+t]=v.b):(b(e[i+t],e[r+t]),m=v.a,_=v.b,b(e[n+t],e[s+t]),g=v.a,A=v.b,b(m,g),e[i+t]=v.a,e[n+t]=v.b,b(_,A),e[r+t]=v.a,e[s+t]=v.b)}if(n&h){const n=i+l;a?y(e[i+t],e[n+t]):b(e[i+t],e[n+t]),m=v.a,e[n+t]=v.b,e[i+t]=m}}if(i&h){let i=u;const s=u+r*(n-c);for(;i<=s;i+=f){const n=i+d;a?y(e[i+t],e[n+t]):b(e[i+t],e[n+t]),m=v.a,e[n+t]=v.b,e[i+t]=m}}c=h,h>>=1}return u}function w(e,t,n,o,g,_){const v=n.value,y=U(t,n),b=U(t,n);n.value+=4;const A=U(t,n);if(n.value+=4,y<0||y>=i||b<0||b>=i)throw new Error("Something wrong with HUF_ENCSIZE");const w=new Array(i),x=new Array(s);if(function(e){for(let t=0;t<s;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(x),function(e,t,n,r,s,o){const u=t;let h=0,p=0;for(;r<=s;r++){if(u.value-t.value>n)return!1;l(6,h,p,e,u);const i=a.l;if(h=a.c,p=a.lc,o[r]=i,63==i){if(u.value-t.value>n)throw new Error("Something wrong with hufUnpackEncTable");l(8,h,p,e,u);let i=a.l+6;if(h=a.c,p=a.lc,r+i>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;i--;)o[r++]=0;r--}else if(i>=59){let e=i-59+2;if(r+e>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)o[r++]=0;r--}}!function(e){for(let e=0;e<=58;++e)c[e]=0;for(let t=0;t<i;++t)c[e[t]]+=1;let t=0;for(let e=58;e>0;--e){const n=t+c[e]>>1;c[e]=t,t=n}for(let t=0;t<i;++t){const n=e[t];n>0&&(e[t]=n|c[n]++<<6)}}(o)}(e,n,o-(n.value-v),y,b,w),A>8*(o-(n.value-v)))throw new Error("Something wrong with hufUncompress");!function(e,t,n,i){for(;t<=n;t++){const n=h(e[t]),s=u(e[t]);if(n>>s)throw new Error("Invalid table entry");if(s>r){const e=i[n>>s-r];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(s){let e=0;for(let o=1<<r-s;o>0;o--){const o=i[(n<<r-s)+e];if(o.len||o.p)throw new Error("Invalid table entry");o.len=s,o.lit=t,e++}}}}(w,y,b,x),function(e,t,n,i,s,o,a,l,c){let g=0,_=0;const v=a,y=Math.trunc(i.value+(s+7)/8);for(;i.value<y;)for(d(g,_,n,i),g=p.c,_=p.lc;_>=r;){const s=t[g>>_-r&16383];if(s.len)_-=s.len,m(s.lit,o,g,_,n,i,l,c,v),g=f.c,_=f.lc;else{if(!s.p)throw new Error("hufDecode issues");let t;for(t=0;t<s.lit;t++){const r=u(e[s.p[t]]);for(;_<r&&i.value<y;)d(g,_,n,i),g=p.c,_=p.lc;if(_>=r&&h(e[s.p[t]])==(g>>_-r&(1<<r)-1)){_-=r,m(s.p[t],o,g,_,n,i,l,c,v),g=f.c,_=f.lc;break}}if(t==s.lit)throw new Error("hufDecode issues")}}const b=8-s&7;for(g>>=b,_-=b;_>0;){const e=t[g<<r-_&16383];if(!e.len)throw new Error("hufDecode issues");_-=e.len,m(e.lit,o,g,_,n,i,l,c,v),g=f.c,_=f.lc}}(w,x,e,n,A,b,_,g,{value:0})}function x(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function E(e,t){let n=0,r=Math.floor((e.length+1)/2),i=0;const s=e.length-1;for(;!(i>s||(t[i++]=e[n++],i>s));)t[i++]=e[r++]}function C(e){let t=e.byteLength;const n=new Array;let r=0;const i=new DataView(e);for(;t>0;){const e=i.getInt8(r++);if(e<0){const s=-e;t-=s+1;for(let e=0;e<s;e++)n.push(i.getUint8(r++))}else{const s=e;t-=2;const o=i.getUint8(r++);for(let e=0;e<s+1;e++)n.push(o)}}return n}function S(e,t,n){let r,i=1;for(;i<64;)r=t[e.value],65280==r?i=64:r>>8==255?i+=255&r:(n[i]=r,i++),e.value++}function M(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),c=new Array(4),u=new Array(4),h=new Array(4);for(let p=0;p<8;++p){const d=8*p;l[0]=r*e[d+2],l[1]=o*e[d+2],l[2]=r*e[d+6],l[3]=o*e[d+6],c[0]=n*e[d+1]+i*e[d+3]+s*e[d+5]+a*e[d+7],c[1]=i*e[d+1]-a*e[d+3]-n*e[d+5]-s*e[d+7],c[2]=s*e[d+1]-n*e[d+3]+a*e[d+5]+i*e[d+7],c[3]=a*e[d+1]-s*e[d+3]+i*e[d+5]-n*e[d+7],u[0]=t*(e[d+0]+e[d+4]),u[3]=t*(e[d+0]-e[d+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[d+0]=h[0]+c[0],e[d+1]=h[1]+c[1],e[d+2]=h[2]+c[2],e[d+3]=h[3]+c[3],e[d+4]=h[3]-c[3],e[d+5]=h[2]-c[2],e[d+6]=h[1]-c[1],e[d+7]=h[0]-c[0]}for(let p=0;p<8;++p)l[0]=r*e[16+p],l[1]=o*e[16+p],l[2]=r*e[48+p],l[3]=o*e[48+p],c[0]=n*e[8+p]+i*e[24+p]+s*e[40+p]+a*e[56+p],c[1]=i*e[8+p]-a*e[24+p]-n*e[40+p]-s*e[56+p],c[2]=s*e[8+p]-n*e[24+p]+a*e[40+p]+i*e[56+p],c[3]=a*e[8+p]-s*e[24+p]+i*e[40+p]-n*e[56+p],u[0]=t*(e[p]+e[32+p]),u[3]=t*(e[p]-e[32+p]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+p]=h[0]+c[0],e[8+p]=h[1]+c[1],e[16+p]=h[2]+c[2],e[24+p]=h[3]+c[3],e[32+p]=h[3]-c[3],e[40+p]=h[2]-c[2],e[48+p]=h[1]-c[1],e[56+p]=h[0]-c[0]}function T(e){for(let t=0;t<64;++t){const n=e[0][t],r=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*r-.4682*i,e[2][t]=n+1.8556*r}}function D(e,t,r){for(let s=0;s<64;++s)t[r+s]=n.A5E.toHalfFloat((i=e[s])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(o,Math.abs(i)-1));var i}function I(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function P(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(C(t)),r=new Uint8Array(n.length);return x(n),E(n,r),new DataView(r.buffer)}function R(e){const t=Of(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return x(t),E(t,n),new DataView(n.buffer)}function B(e){const n=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192);let o=0;const a=new Array(e.channels);for(let t=0;t<e.channels;t++)a[t]={},a[t].start=o,a[t].end=a[t].start,a[t].nx=e.width,a[t].ny=e.lines,a[t].size=e.type,o+=a[t].nx*a[t].ny*a[t].size;const l=Q(n,r),c=Q(n,r);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=c)for(let e=0;e<c-l+1;e++)s[e+l]=j(n,r);const u=new Uint16Array(t),h=function(e,n){let r=0;for(let i=0;i<t;++i)(0==i||e[i>>3]&1<<(7&i))&&(n[r++]=i);const i=r-1;for(;r<t;)n[r++]=0;return i}(s,u),p=U(n,r);w(e.array,n,r,p,i,o);for(let t=0;t<e.channels;++t){const e=a[t];for(let n=0;n<a[t].size;++n)A(i,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,h)}!function(e,t,n){for(let r=0;r<n;++r)t[r]=e[t[r]]}(u,i,o);let d=0;const f=new Uint8Array(i.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){const e=a[t],n=e.nx*e.size,r=new Uint8Array(i.buffer,2*e.end,2*n);f.set(r,d),d+=2*n,e.end+=n}return new DataView(f.buffer)}function k(e){const t=Of(e.array.slice(e.offset.value,e.offset.value+e.size)),n=e.lines*e.channels*e.width,r=1==e.type?new Uint16Array(n):new Uint32Array(n);let i=0,s=0;const o=new Array(4);for(let n=0;n<e.lines;n++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:o[0]=i,o[1]=o[0]+e.width,i=o[1]+e.width;for(let i=0;i<e.width;++i)n+=t[o[0]++]<<8|t[o[1]++],r[s]=n,s++;break;case 2:o[0]=i,o[1]=o[0]+e.width,o[2]=o[1]+e.width,i=o[2]+e.width;for(let i=0;i<e.width;++i)n+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,r[s]=n,s++}}return new DataView(r.buffer)}function O(e){const t=e.viewer,n={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:z(t,n),unknownUncompressedSize:z(t,n),unknownCompressedSize:z(t,n),acCompressedSize:z(t,n),dcCompressedSize:z(t,n),rleCompressedSize:z(t,n),rleUncompressedSize:z(t,n),rleRawSize:z(t,n),totalAcUncompressedCount:z(t,n),totalDcUncompressedCount:z(t,n),acCompression:z(t,n)};if(i.version<2)throw new Error("EXRLoader.parse: "+J.compression+" version "+i.version+" is unsupported");const s=new Array;let o=Q(t,n)-2;for(;o>0;){const e=L(t.buffer,n),r=j(t,n),i=r>>2&3,a=new Int8Array([(r>>4)-1])[0],l=j(t,n);s.push({name:e,index:a,type:l,compression:i}),o-=e.length+3}const a=J.channels,l=new Array(e.channels);for(let t=0;t<e.channels;++t){const n=l[t]={},r=a[t];n.name=r.name,n.compression=0,n.decoded=!1,n.type=r.pixelType,n.pLinear=r.pLinear,n.width=e.width,n.height=e.lines}const c={idx:new Array(3)};for(let t=0;t<e.channels;++t){const e=l[t];for(let n=0;n<s.length;++n){const r=s[n];e.name==r.name&&(e.compression=r.compression,r.index>=0&&(c.idx[r.index]=t),e.offset=t)}}let u,h,p;if(i.acCompressedSize>0)switch(i.acCompression){case 0:u=new Uint16Array(i.totalAcUncompressedCount),w(e.array,t,n,i.acCompressedSize,u,i.totalAcUncompressedCount);break;case 1:const r=Of(e.array.slice(n.value,n.value+i.totalAcUncompressedCount));u=new Uint16Array(r.buffer),n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){const t={array:e.array,offset:n,size:i.dcCompressedSize};h=new Uint16Array(R(t).buffer),n.value+=i.dcCompressedSize}i.rleRawSize>0&&(p=C(Of(e.array.slice(n.value,n.value+i.rleCompressedSize)).buffer),n.value+=i.rleCompressedSize);let d=0;const f=new Array(l.length);for(let e=0;e<f.length;++e)f[e]=new Array;for(let t=0;t<e.lines;++t)for(let t=0;t<l.length;++t)f[t].push(d),d+=l[t].width*e.type*2;!function(e,t,n,r,i,s){let o=new DataView(s.buffer);const a=n[e.idx[0]].width,l=n[e.idx[0]].height,c=Math.floor(a/8),u=Math.ceil(a/8),h=Math.ceil(l/8),p=a-8*(u-1),d=l-8*(h-1),f={value:0},m=new Array(3),g=new Array(3),_=new Array(3),v=new Array(3),y=new Array(3);for(let n=0;n<3;++n)y[n]=t[e.idx[n]],m[n]=n<1?0:m[n-1]+u*h,g[n]=new Float32Array(64),_[n]=new Uint16Array(64),v[n]=new Uint16Array(64*u);for(let t=0;t<h;++t){let s=8;t==h-1&&(s=d);let a=8;for(let e=0;e<u;++e){e==u-1&&(a=p);for(let e=0;e<3;++e)_[e].fill(0),_[e][0]=i[m[e]++],S(f,r,_[e]),b=_[e],(A=g[e])[0]=H(b[0]),A[1]=H(b[1]),A[2]=H(b[5]),A[3]=H(b[6]),A[4]=H(b[14]),A[5]=H(b[15]),A[6]=H(b[27]),A[7]=H(b[28]),A[8]=H(b[2]),A[9]=H(b[4]),A[10]=H(b[7]),A[11]=H(b[13]),A[12]=H(b[16]),A[13]=H(b[26]),A[14]=H(b[29]),A[15]=H(b[42]),A[16]=H(b[3]),A[17]=H(b[8]),A[18]=H(b[12]),A[19]=H(b[17]),A[20]=H(b[25]),A[21]=H(b[30]),A[22]=H(b[41]),A[23]=H(b[43]),A[24]=H(b[9]),A[25]=H(b[11]),A[26]=H(b[18]),A[27]=H(b[24]),A[28]=H(b[31]),A[29]=H(b[40]),A[30]=H(b[44]),A[31]=H(b[53]),A[32]=H(b[10]),A[33]=H(b[19]),A[34]=H(b[23]),A[35]=H(b[32]),A[36]=H(b[39]),A[37]=H(b[45]),A[38]=H(b[52]),A[39]=H(b[54]),A[40]=H(b[20]),A[41]=H(b[22]),A[42]=H(b[33]),A[43]=H(b[38]),A[44]=H(b[46]),A[45]=H(b[51]),A[46]=H(b[55]),A[47]=H(b[60]),A[48]=H(b[21]),A[49]=H(b[34]),A[50]=H(b[37]),A[51]=H(b[47]),A[52]=H(b[50]),A[53]=H(b[56]),A[54]=H(b[59]),A[55]=H(b[61]),A[56]=H(b[35]),A[57]=H(b[36]),A[58]=H(b[48]),A[59]=H(b[49]),A[60]=H(b[57]),A[61]=H(b[58]),A[62]=H(b[62]),A[63]=H(b[63]),M(g[e]);T(g);for(let t=0;t<3;++t)D(g[t],v[t],64*e)}let l=0;for(let r=0;r<3;++r){const i=n[e.idx[r]].type;for(let e=8*t;e<8*t+s;++e){l=y[r][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);o.setUint16(l+0*i,v[r][n+0],!0),o.setUint16(l+2*i,v[r][n+1],!0),o.setUint16(l+4*i,v[r][n+2],!0),o.setUint16(l+6*i,v[r][n+3],!0),o.setUint16(l+8*i,v[r][n+4],!0),o.setUint16(l+10*i,v[r][n+5],!0),o.setUint16(l+12*i,v[r][n+6],!0),o.setUint16(l+14*i,v[r][n+7],!0),l+=16*i}}if(c!=u)for(let e=8*t;e<8*t+s;++e){const t=y[r][e]+8*c*2*i,n=64*c+8*(7&e);for(let e=0;e<a;++e)o.setUint16(t+2*e*i,v[r][n+e],!0)}}}var b,A;const w=new Uint16Array(a);o=new DataView(s.buffer);for(let t=0;t<3;++t){n[e.idx[t]].decoded=!0;const r=n[e.idx[t]].type;if(2==n[t].type)for(let e=0;e<l;++e){const n=y[t][e];for(let e=0;e<a;++e)w[e]=o.getUint16(n+2*e*r,!0);for(let e=0;e<a;++e)o.setFloat32(n+2*e*r,H(w[e]),!0)}}}(c,f,l,u,h,r);for(let t=0;t<l.length;++t){const n=l[t];if(!n.decoded){if(2!==n.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let i=0,s=0;for(let o=0;o<e.lines;++o){let e=f[t][i];for(let t=0;t<n.width;++t){for(let t=0;t<2*n.type;++t)r[e++]=p[s+t*n.width*n.height];s++}i++}}}}return new DataView(r.buffer)}function L(e,t){const n=new Uint8Array(e);let r=0;for(;0!=n[t.value+r];)r+=1;const i=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,i}function F(e,t){const n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function U(e,t){const n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function N(e,t){const n=e[t.value];return t.value=t.value+1,n}function j(e,t){const n=e.getUint8(t.value);return t.value=t.value+1,n}const z=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function G(e,t){const n=e.getFloat32(t.value,!0);return t.value+=4,n}function V(e,t){return n.A5E.toHalfFloat(G(e,t))}function H(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function Q(e,t){const n=e.getUint16(t.value,!0);return t.value+=2,n}function W(e,t){return H(Q(e,t))}function q(e,t,n,r,i){return"string"===r||"stringvector"===r||"iccProfile"===r?function(e,t,n){const r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(t,n,i):"chlist"===r?function(e,t,n,r){const i=n.value,s=[];for(;n.value<i+r-1;){const r=L(t,n),i=F(e,n),o=j(e,n);n.value+=3;const a=F(e,n),l=F(e,n);s.push({name:r,pixelType:i,pLinear:o,xSampling:a,ySampling:l})}return n.value+=1,s}(e,t,n,i):"chromaticities"===r?function(e,t){return{redX:G(e,t),redY:G(e,t),greenX:G(e,t),greenY:G(e,t),blueX:G(e,t),blueY:G(e,t),whiteX:G(e,t),whiteY:G(e,t)}}(e,n):"compression"===r?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][j(e,t)]}(e,n):"box2i"===r?function(e,t){return{xMin:U(e,t),yMin:U(e,t),xMax:U(e,t),yMax:U(e,t)}}(e,n):"lineOrder"===r?function(e,t){return["INCREASING_Y"][j(e,t)]}(e,n):"float"===r?G(e,n):"v2f"===r?function(e,t){return[G(e,t),G(e,t)]}(e,n):"v3f"===r?function(e,t){return[G(e,t),G(e,t),G(e,t)]}(e,n):"int"===r?F(e,n):"rational"===r?function(e,t){return[F(e,t),U(e,t)]}(e,n):"timecode"===r?function(e,t){return[U(e,t),U(e,t)]}(e,n):"preview"===r?(n.value+=i,"skipped"):void(n.value+=i)}const X=new DataView(e),Y=new Uint8Array(e),K={value:0},J=function(e,t,n){const r={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");r.version=e.getUint8(4);const i=e.getUint8(5);r.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},n.value=8;let s=!0;for(;s;){const i=L(t,n);if(0==i)s=!1;else{const s=L(t,n),o=q(e,t,n,s,U(e,n));void 0===o?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):r[i]=o}}if(0!=(-5&i))throw console.error("EXRHeader:",r),new Error("THREE.EXRLoader: provided file is currently unsupported.");return r}(X,e,K),Z=function(e,t,r,i,s){const o={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:n.GUF};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=I;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=P;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=R;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=R;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=B;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=k;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=O;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=O;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,1==o.type)switch(s){case n.VzW:o.getter=W,o.inputSize=2;break;case n.cLu:o.getter=Q,o.inputSize=2}else{if(2!=o.type)throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");switch(s){case n.VzW:o.getter=G,o.inputSize=4;break;case n.cLu:o.getter=V,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(let e=0;e<o.blockCount;e++)z(t,i);o.outputChannels=3==o.channels?4:o.channels;const a=o.width*o.height*o.outputChannels;switch(s){case n.VzW:o.byteArray=new Float32Array(a),o.channels<o.outputChannels&&o.byteArray.fill(1,0,a);break;case n.cLu:o.byteArray=new Uint16Array(a),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",s)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=n.wk1,o.colorSpace=n.GUF):(o.format=n.hEm,o.colorSpace=n.aCh),o}(J,X,Y,K,this.type),$={value:0},ee={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<Z.height/Z.scanlineBlockSize;e++){const t=U(X,K);Z.size=U(X,K),Z.lines=t+Z.scanlineBlockSize>Z.height?Z.height-t:Z.scanlineBlockSize;const n=Z.size<Z.lines*Z.bytesPerLine?Z.uncompress(Z):I(Z);K.value+=Z.size;for(let t=0;t<Z.scanlineBlockSize;t++){const r=t+e*Z.scanlineBlockSize;if(r>=Z.height)break;for(let e=0;e<Z.channels;e++){const i=ee[J.channels[e].name];for(let s=0;s<Z.width;s++){$.value=(t*(Z.channels*Z.width)+e*Z.width+s)*Z.inputSize;const o=(Z.height-1-r)*(Z.width*Z.outputChannels)+s*Z.outputChannels+i;Z.byteArray[o]=Z.getter(n,$)}}}}return{header:J,width:Z.width,height:Z.height,data:Z.byteArray,format:Z.format,colorSpace:Z.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){e.colorSpace=r.colorSpace,e.minFilter=n.wem,e.magFilter=n.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)}),r,i)}}class q_ extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo]}async onAdded(e){this._importer||(this._importer=new _n(class extends W_{constructor(t){super(t),this.setDataType(uo(e.renderer.rendererObject))}},["exr"],!1)),e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}q_.PluginType="EXRLoadPlugin";const X_=new WeakMap;class Y_ extends n.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const s=new n.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,(n=>{if(X_.has(n))return X_.get(n).promise.then(t).catch(i);this.decodeObjects(n,e).then((e=>{e.userData.warnings=this.warnings,this.warnings=[],t(e)})).catch((e=>i(e)))}),r,i)}debug(){this.workerPool.map((e=>e._taskLoad))}decodeObjects(e,t){let n,r;const i=e.byteLength,s=this._getWorker(i).then((t=>(n=t,r=this.workerNextTaskID++,new Promise(((t,i)=>{n._callbacks[r]={resolve:t,reject:i},n.postMessage({type:"decode",id:r,buffer:e},[e])}))))).then((e=>this._createGeometry(e.data))).catch((e=>{throw e}));return s.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),X_.set(e,{url:t,promise:s}),s}parse(e,t,n){this.decodeObjects(e,"").then((e=>{e.userData.warnings=this.warnings,t(e)})).catch((e=>n(e)))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let e=0;e<this.materials.length;e++){const t=this.materials[e],r={};if(r.name=t.name,r.color={},r.color.r=t.color.r,r.color.g=t.color.g,r.color.b=t.color.b,r.type=t.type,JSON.stringify(r)===n)return t}return this.materials.push(e),e}_createMaterial(e){if(void 0===e)return new n.Wid({color:new n.Ilk(1,1,1),metalness:.8,name:"default",side:n.ehD});const t=e.diffuseColor,r=new n.Ilk(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(r.r=1,r.g=1,r.b=1);const i=new n.Wid({color:r,name:e.name,side:n.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),s=new n.dpR;for(let t=0;t<e.textures.length;t++){const r=e.textures[t];if(null!==r.image){const e=s.load(r.image);switch(r.type){case"Diffuse":i.map=e;break;case"Bump":i.bumpMap=e;break;case"Transparency":i.alphaMap=e,i.transparent=!0;break;case"Emap":i.envMap=e}e.wrapS=0===r.wrapU?n.rpg:n.uWy,e.wrapT=0===r.wrapV?n.rpg:n.uWy,e.repeat.set(r.repeat[0],r.repeat[1])}}return i}_createGeometry(e){const t=new n.Tme,r=[],i=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const a=e.materials;for(let n=0;n<o.length;n++){const l=o[n],c=l.attributes;switch(l.objectType){case"InstanceDefinition":i.push(l);break;case"InstanceReference":s.push(l);break;default:let n;if(c.materialIndex>=0){const e=a[c.materialIndex];let t=this._createMaterial(e);t=this._compareMaterials(t),n=this._createObject(l,t)}else{const e=this._createMaterial();n=this._createObject(l,e)}if(void 0===n)continue;const o=e.layers[c.layerIndex];n.visible=!o||o.visible,c.isInstanceDefinitionObject?r.push(n):t.add(n)}}for(let l=0;l<i.length;l++){const c=i[l];o=[];for(let e=0;e<c.attributes.objectIds.length;e++){const t=c.attributes.objectIds[e];for(let e=0;e<r.length;e++)t===r[e].userData.attributes.id&&o.push(r[e])}for(let r=0;r<s.length;r++){const i=s[r];if(i.geometry.parentIdefId===c.attributes.id){const r=i.geometry.xform.array,s=new n.yGw;if(s.set(...r),1===o.length){const n=o[0].clone(!0);if(n.name=i.attributes.name||n.name,n.applyMatrix4(s),i.attributes.materialIndex>=0&&i.attributes.materialIndex!==o[0].userData.attributes.materialIndex){const e=a[i.attributes.materialIndex],t=this._createMaterial(e);n.material=this._compareMaterials(t)}if(n.userData.defAttributes=n.userData.attributes,n.userData.defObjectType=n.userData.objectType,n.userData.attributes={...n.userData.attributes,...i.attributes},n.userData.objectType=i.objectType,void 0!==i.attributes.layerIndex){const t=e.layers[i.attributes.layerIndex];n.visible=t?t.visible:n.visible}t.add(n)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const e=new n.Tme;for(let t=0;t<o.length;t++)e.add(o[t].clone(!0));t.add(e)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const r=new n.s4_,i=e.attributes;let s,o,a,l;switch(e.objectType){case"Point":case"PointSet":s=r.parse(e.geometry),s.attributes.hasOwnProperty("color")?o=new n.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(a=i.drawColor,l=new n.Ilk(a.r/255,a.g/255,a.b/255),o=new n.UY4({color:l,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const c=new n.woe(s,o);return c.userData.attributes=i,c.userData.objectType=e.objectType,i.name&&(c.name=i.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;s=r.parse(e.geometry),s.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));const u=new n.Kj0(s,t);return u.castShadow=i.castsShadows,u.receiveShadow=i.receivesShadows,u.userData.attributes=i,u.userData.objectType=e.objectType,i.name&&(u.name=i.name,s.name=i.name),u;case"Curve":s=r.parse(e.geometry),a=i.drawColor,l=new n.Ilk(a.r/255,a.g/255,a.b/255),o=new n.nls({color:l}),o=this._compareMaterials(o);const h=new n.x12(s,o);return h.userData.attributes=i,h.userData.objectType=e.objectType,i.name&&(h.name=i.name),h;case"TextDot":s=e.geometry;const p=document.createElement("canvas").getContext("2d"),d=`${s.fontHeight}px ${s.fontFace}`;p.font=d;const f=p.measureText(s.text).width+10,m=s.fontHeight+10,g=window.devicePixelRatio;p.canvas.width=f*g,p.canvas.height=m*g,p.canvas.style.width=f+"px",p.canvas.style.height=m+"px",p.setTransform(g,0,0,g,0,0),p.font=d,p.textBaseline="middle",p.textAlign="center",l=i.drawColor,p.fillStyle=`rgba(${l.r},${l.g},${l.b},${l.a})`,p.fillRect(0,0,f,m),p.fillStyle="white",p.fillText(s.text,f/2,m/2);const _=new n.ROQ(p.canvas);_.minFilter=n.wem,_.wrapS=n.uWy,_.wrapT=n.uWy,o=new n.xeV({map:_,depthTest:!1});const v=new n.jyi(o);return v.position.set(s.point[0],s.point[1],s.point[2]),v.scale.set(f/10,m/10,1),v.userData.attributes=i,v.userData.objectType=e.objectType,i.name&&(v.name=i.name),v;case"Light":let y;switch(s=e.geometry,s.lightStyle.name){case"LightStyle_WorldPoint":y=new n.cek,y.castShadow=i.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":y=new n.PMe,y.castShadow=i.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.target.position.set(s.direction[0],s.direction[1],s.direction[2]),y.angle=s.spotAngleRadians,y.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":y=new n.T_f;const e=Math.abs(s.width[2]),t=Math.abs(s.length[0]);y.position.set(s.location[0]-t/2,s.location[1],s.location[2]-e/2),y.height=t,y.width=e,y.lookAt(s.direction[0],s.direction[1],s.direction[2]);break;case"LightStyle_WorldDirectional":y=new n.Ox3,y.castShadow=i.castsShadows,y.position.set(s.location[0],s.location[1],s.location[2]),y.target.position.set(s.direction[0],s.direction[1],s.direction[2]),y.shadow.normalBias=.1}return y&&(y.intensity=s.intensity,a=s.diffuse,l=new n.Ilk(a.r/255,a.g/255,a.b/255),y.color=l,y.userData.attributes=i,y.userData.objectType=e.objectType),y}}_initLibrary(){if(!this.libraryPending){const e=new n.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise(((t,n)=>{e.load("rhino3dm.js",t,void 0,n)})),r=new n.hH6(this.manager);r.setPath(this.libraryPath),r.setResponseType("arraybuffer");const i=new Promise(((e,t)=>{r.load("rhino3dm.wasm",e,void 0,t)}));this.libraryPending=Promise.all([t,i]).then((([e,t])=>{this.libraryConfig.wasmBinary=t;const n=K_,r=["/* rhino3dm.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))}))}return this.libraryPending}_getWorker(e){return this._initLibrary().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=t=>{const n=t.data;switch(n.type){case"warning":this.warnings.push(n.data),console.warn(n.data);break;case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const K_="\nfunction Rhino3dmWorker() {\n\n\tlet libraryPending;\n\tlet libraryConfig;\n\tlet rhino;\n\tlet taskID;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\n\t\t\t\t// console.log(message)\n\t\t\t\tlibraryConfig = message.libraryConfig;\n\t\t\t\tconst wasmBinary = libraryConfig.wasmBinary;\n\t\t\t\tlet RhinoModule;\n\t\t\t\tlibraryPending = new Promise( function ( resolve ) {\n\n\t\t\t\t\t/* Like Basis Loader */\n\t\t\t\t\tRhinoModule = { wasmBinary, onRuntimeInitialized: resolve };\n\n\t\t\t\t\trhino3dm( RhinoModule ); // eslint-disable-line no-undef\n\n\t\t\t\t } ).then( () => {\n\n\t\t\t\t\trhino = RhinoModule;\n\n\t\t\t\t } );\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\n\t\t\t\ttaskID = message.id;\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tlibraryPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst data = decodeObjects( rhino, buffer );\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, data } );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeObjects( rhino, buffer ) {\n\n\t\tconst arr = new Uint8Array( buffer );\n\t\tconst doc = rhino.File3dm.fromByteArray( arr );\n\n\t\tconst objects = [];\n\t\tconst materials = [];\n\t\tconst layers = [];\n\t\tconst views = [];\n\t\tconst namedViews = [];\n\t\tconst groups = [];\n\t\tconst strings = [];\n\n\t\t//Handle objects\n\n\t\tconst objs = doc.objects();\n\t\tconst cnt = objs.count;\n\n\t\tfor ( let i = 0; i < cnt; i ++ ) {\n\n\t\t\tconst _object = objs.get( i );\n\n\t\t\tconst object = extractObjectData( _object, doc );\n\n\t\t\t_object.delete();\n\n\t\t\tif ( object ) {\n\n\t\t\t\tobjects.push( object );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Handle instance definitions\n\t\t// console.log( `Instance Definitions Count: ${doc.instanceDefinitions().count()}` );\n\n\t\tfor ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {\n\n\t\t\tconst idef = doc.instanceDefinitions().get( i );\n\t\t\tconst idefAttributes = extractProperties( idef );\n\t\t\tidefAttributes.objectIds = idef.getObjectIds();\n\n\t\t\tobjects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );\n\n\t\t}\n\n\t\t// Handle materials\n\n\t\tconst textureTypes = [\n\t\t\t// rhino.TextureType.Bitmap,\n\t\t\trhino.TextureType.Diffuse,\n\t\t\trhino.TextureType.Bump,\n\t\t\trhino.TextureType.Transparency,\n\t\t\trhino.TextureType.Opacity,\n\t\t\trhino.TextureType.Emap\n\t\t];\n\n\t\tconst pbrTextureTypes = [\n\t\t\trhino.TextureType.PBR_BaseColor,\n\t\t\trhino.TextureType.PBR_Subsurface,\n\t\t\trhino.TextureType.PBR_SubsurfaceScattering,\n\t\t\trhino.TextureType.PBR_SubsurfaceScatteringRadius,\n\t\t\trhino.TextureType.PBR_Metallic,\n\t\t\trhino.TextureType.PBR_Specular,\n\t\t\trhino.TextureType.PBR_SpecularTint,\n\t\t\trhino.TextureType.PBR_Roughness,\n\t\t\trhino.TextureType.PBR_Anisotropic,\n\t\t\trhino.TextureType.PBR_Anisotropic_Rotation,\n\t\t\trhino.TextureType.PBR_Sheen,\n\t\t\trhino.TextureType.PBR_SheenTint,\n\t\t\trhino.TextureType.PBR_Clearcoat,\n\t\t\trhino.TextureType.PBR_ClearcoatBump,\n\t\t\trhino.TextureType.PBR_ClearcoatRoughness,\n\t\t\trhino.TextureType.PBR_OpacityIor,\n\t\t\trhino.TextureType.PBR_OpacityRoughness,\n\t\t\trhino.TextureType.PBR_Emission,\n\t\t\trhino.TextureType.PBR_AmbientOcclusion,\n\t\t\trhino.TextureType.PBR_Displacement\n\t\t];\n\n\t\tfor ( let i = 0; i < doc.materials().count(); i ++ ) {\n\n\t\t\tconst _material = doc.materials().get( i );\n\t\t\tconst _pbrMaterial = _material.physicallyBased();\n\n\t\t\tlet material = extractProperties( _material );\n\n\t\t\tconst textures = [];\n\n\t\t\tfor ( let j = 0; j < textureTypes.length; j ++ ) {\n\n\t\t\t\tconst _texture = _material.getTexture( textureTypes[ j ] );\n\t\t\t\tif ( _texture ) {\n\n\t\t\t\t\tlet textureType = textureTypes[ j ].constructor.name;\n\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\n\t\t\t\t\tconst texture = { type: textureType };\n\n\t\t\t\t\tconst image = doc.getEmbeddedFileAsBase64( _texture.fileName );\n\n\t\t\t\t\ttexture.wrapU = _texture.wrapU;\n\t\t\t\t\ttexture.wrapV = _texture.wrapV;\n\t\t\t\t\ttexture.wrapW = _texture.wrapW;\n\t\t\t\t\tconst uvw = _texture.uvwTransform.toFloatArray( true );\n\t\t\t\t\ttexture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];\n\n\t\t\t\t\tif ( image ) {\n\n\t\t\t\t\t\ttexture.image = 'data:image/png;base64,' + image;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\t\t\tmessage: `THREE.3DMLoader: Image for ${textureType} texture not embedded in file.`,\n\t\t\t\t\t\t\ttype: 'missing resource'\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\ttexture.image = null;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttextures.push( texture );\n\n\t\t\t\t\t_texture.delete();\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterial.textures = textures;\n\n\t\t\tif ( _pbrMaterial.supported ) {\n\n\t\t\t\tfor ( let j = 0; j < pbrTextureTypes.length; j ++ ) {\n\n\t\t\t\t\tconst _texture = _material.getTexture( pbrTextureTypes[ j ] );\n\t\t\t\t\tif ( _texture ) {\n\n\t\t\t\t\t\tconst image = doc.getEmbeddedFileAsBase64( _texture.fileName );\n\t\t\t\t\t\tlet textureType = pbrTextureTypes[ j ].constructor.name;\n\t\t\t\t\t\ttextureType = textureType.substring( 12, textureType.length );\n\t\t\t\t\t\tconst texture = { type: textureType, image: 'data:image/png;base64,' + image };\n\t\t\t\t\t\ttextures.push( texture );\n\n\t\t\t\t\t\t_texture.delete();\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tconst pbMaterialProperties = extractProperties( _material.physicallyBased() );\n\n\t\t\t\tmaterial = Object.assign( pbMaterialProperties, material );\n\n\t\t\t}\n\n\t\t\tmaterials.push( material );\n\n\t\t\t_material.delete();\n\t\t\t_pbrMaterial.delete();\n\n\t\t}\n\n\t\t// Handle layers\n\n\t\tfor ( let i = 0; i < doc.layers().count(); i ++ ) {\n\n\t\t\tconst _layer = doc.layers().get( i );\n\t\t\tconst layer = extractProperties( _layer );\n\n\t\t\tlayers.push( layer );\n\n\t\t\t_layer.delete();\n\n\t\t}\n\n\t\t// Handle views\n\n\t\tfor ( let i = 0; i < doc.views().count(); i ++ ) {\n\n\t\t\tconst _view = doc.views().get( i );\n\t\t\tconst view = extractProperties( _view );\n\n\t\t\tviews.push( view );\n\n\t\t\t_view.delete();\n\n\t\t}\n\n\t\t// Handle named views\n\n\t\tfor ( let i = 0; i < doc.namedViews().count(); i ++ ) {\n\n\t\t\tconst _namedView = doc.namedViews().get( i );\n\t\t\tconst namedView = extractProperties( _namedView );\n\n\t\t\tnamedViews.push( namedView );\n\n\t\t\t_namedView.delete();\n\n\t\t}\n\n\t\t// Handle groups\n\n\t\tfor ( let i = 0; i < doc.groups().count(); i ++ ) {\n\n\t\t\tconst _group = doc.groups().get( i );\n\t\t\tconst group = extractProperties( _group );\n\n\t\t\tgroups.push( group );\n\n\t\t\t_group.delete();\n\n\t\t}\n\n\t\t// Handle settings\n\n\t\tconst settings = extractProperties( doc.settings() );\n\n\t\t//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.\n\n\t\t// Handle dimstyles\n\t\t// console.log( `Dimstyle Count: ${doc.dimstyles().count()}` );\n\n\t\t// Handle bitmaps\n\t\t// console.log( `Bitmap Count: ${doc.bitmaps().count()}` );\n\n\t\t// Handle strings\n\t\t// console.log( `Document Strings Count: ${doc.strings().count()}` );\n\t\t// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section\n\t\t//console.log( `Document User Text Count: ${doc.strings().documentUserTextCount()}` );\n\n\t\tconst strings_count = doc.strings().count();\n\n\t\tfor ( let i = 0; i < strings_count; i ++ ) {\n\n\t\t\tstrings.push( doc.strings().get( i ) );\n\n\t\t}\n\n\t\tdoc.delete();\n\n\t\treturn { objects, materials, layers, views, namedViews, groups, strings, settings };\n\n\t}\n\n\tfunction extractObjectData( object, doc ) {\n\n\t\tconst _geometry = object.geometry();\n\t\tconst _attributes = object.attributes();\n\t\tlet objectType = _geometry.objectType;\n\t\tlet geometry, attributes, position, data, mesh;\n\n\t\t// skip instance definition objects\n\t\t//if( _attributes.isInstanceDefinitionObject ) { continue; }\n\n\t\t// TODO: handle other geometry types\n\t\tswitch ( objectType ) {\n\n\t\t\tcase rhino.ObjectType.Curve:\n\n\t\t\t\tconst pts = curveToPoints( _geometry, 100 );\n\n\t\t\t\tposition = {};\n\t\t\t\tattributes = {};\n\t\t\t\tdata = {};\n\n\t\t\t\tposition.itemSize = 3;\n\t\t\t\tposition.type = 'Float32Array';\n\t\t\t\tposition.array = [];\n\n\t\t\t\tfor ( let j = 0; j < pts.length; j ++ ) {\n\n\t\t\t\t\tposition.array.push( pts[ j ][ 0 ] );\n\t\t\t\t\tposition.array.push( pts[ j ][ 1 ] );\n\t\t\t\t\tposition.array.push( pts[ j ][ 2 ] );\n\n\t\t\t\t}\n\n\t\t\t\tattributes.position = position;\n\t\t\t\tdata.attributes = attributes;\n\n\t\t\t\tgeometry = { data };\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Point:\n\n\t\t\t\tconst pt = _geometry.location;\n\n\t\t\t\tposition = {};\n\t\t\t\tconst color = {};\n\t\t\t\tattributes = {};\n\t\t\t\tdata = {};\n\n\t\t\t\tposition.itemSize = 3;\n\t\t\t\tposition.type = 'Float32Array';\n\t\t\t\tposition.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];\n\n\t\t\t\tconst _color = _attributes.drawColor( doc );\n\n\t\t\t\tcolor.itemSize = 3;\n\t\t\t\tcolor.type = 'Float32Array';\n\t\t\t\tcolor.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];\n\n\t\t\t\tattributes.position = position;\n\t\t\t\tattributes.color = color;\n\t\t\t\tdata.attributes = attributes;\n\n\t\t\t\tgeometry = { data };\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.PointSet:\n\t\t\tcase rhino.ObjectType.Mesh:\n\n\t\t\t\tgeometry = _geometry.toThreejsJSON();\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Brep:\n\n\t\t\t\tconst faces = _geometry.faces();\n\t\t\t\tmesh = new rhino.Mesh();\n\n\t\t\t\tfor ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {\n\n\t\t\t\t\tconst face = faces.get( faceIndex );\n\t\t\t\t\tconst _mesh = face.getMesh( rhino.MeshType.Any );\n\n\t\t\t\t\tif ( _mesh ) {\n\n\t\t\t\t\t\tmesh.append( _mesh );\n\t\t\t\t\t\t_mesh.delete();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tface.delete();\n\n\t\t\t\t}\n\n\t\t\t\tif ( mesh.faces().count > 0 ) {\n\n\t\t\t\t\tmesh.compact();\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tfaces.delete();\n\n\t\t\t\t}\n\n\t\t\t\tmesh.delete();\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Extrusion:\n\n\t\t\t\tmesh = _geometry.getMesh( rhino.MeshType.Any );\n\n\t\t\t\tif ( mesh ) {\n\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tmesh.delete();\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.TextDot:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.Light:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\n\t\t\t\tif ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {\n\n\t\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\t\tmessage: `THREE.3DMLoader: No conversion exists for ${objectType.constructor.name} ${geometry.lightStyle.name}`,\n\t\t\t\t\t\ttype: 'no conversion',\n\t\t\t\t\t\tguid: _attributes.id\n\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.InstanceReference:\n\n\t\t\t\tgeometry = extractProperties( _geometry );\n\t\t\t\tgeometry.xform = extractProperties( _geometry.xform );\n\t\t\t\tgeometry.xform.array = _geometry.xform.toFloatArray( true );\n\n\t\t\t\tbreak;\n\n\t\t\tcase rhino.ObjectType.SubD:\n\n\t\t\t\t// TODO: precalculate resulting vertices and faces and warn on excessive results\n\t\t\t\t_geometry.subdivide( 3 );\n\t\t\t\tmesh = rhino.Mesh.createFromSubDControlNet( _geometry );\n\t\t\t\tif ( mesh ) {\n\n\t\t\t\t\tgeometry = mesh.toThreejsJSON();\n\t\t\t\t\tmesh.delete();\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\t\t/*\n\t\t\t\tcase rhino.ObjectType.Annotation:\n\t\t\t\tcase rhino.ObjectType.Hatch:\n\t\t\t\tcase rhino.ObjectType.ClipPlane:\n\t\t\t\t*/\n\n\t\t\tdefault:\n\n\t\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\t\tmessage: `THREE.3DMLoader: Conversion not implemented for ${objectType.constructor.name}`,\n\t\t\t\t\ttype: 'not implemented',\n\t\t\t\t\tguid: _attributes.id\n\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( geometry ) {\n\n\t\t\tattributes = extractProperties( _attributes );\n\t\t\tattributes.geometry = extractProperties( _geometry );\n\n\t\t\tif ( _attributes.groupCount > 0 ) {\n\n\t\t\t\tattributes.groupIds = _attributes.getGroupList();\n\n\t\t\t}\n\n\t\t\tif ( _attributes.userStringCount > 0 ) {\n\n\t\t\t\tattributes.userStrings = _attributes.getUserStrings();\n\n\t\t\t}\n\n\t\t\tif ( _geometry.userStringCount > 0 ) {\n\n\t\t\t\tattributes.geometry.userStrings = _geometry.getUserStrings();\n\n\t\t\t}\n\n\t\t\tattributes.drawColor = _attributes.drawColor( doc );\n\n\t\t\tobjectType = objectType.constructor.name;\n\t\t\tobjectType = objectType.substring( 11, objectType.length );\n\n\t\t\treturn { geometry, attributes, objectType };\n\n\t\t} else {\n\n\t\t\tself.postMessage( { type: 'warning', id: taskID, data: {\n\t\t\t\tmessage: `THREE.3DMLoader: ${objectType.constructor.name} has no associated mesh geometry.`,\n\t\t\t\ttype: 'missing mesh',\n\t\t\t\tguid: _attributes.id\n\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tfunction extractProperties( object ) {\n\n\t\tconst result = {};\n\n\t\tfor ( const property in object ) {\n\n\t\t\tconst value = object[ property ];\n\n\t\t\tif ( typeof value !== 'function' ) {\n\n\t\t\t\tif ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {\n\n\t\t\t\t\tresult[ property ] = { name: value.constructor.name, value: value.value };\n\n\t\t\t\t} else {\n\n\t\t\t\t\tresult[ property ] = value;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// these are functions that could be called to extract more data.\n\t\t\t\t//console.log( `${property}: ${object[ property ].constructor.name}` );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tfunction curveToPoints( curve, pointLimit ) {\n\n\t\tlet pointCount = pointLimit;\n\t\tlet rc = [];\n\t\tconst ts = [];\n\n\t\tif ( curve instanceof rhino.LineCurve ) {\n\n\t\t\treturn [ curve.pointAtStart, curve.pointAtEnd ];\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.PolylineCurve ) {\n\n\t\t\tpointCount = curve.pointCount;\n\t\t\tfor ( let i = 0; i < pointCount; i ++ ) {\n\n\t\t\t\trc.push( curve.point( i ) );\n\n\t\t\t}\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.PolyCurve ) {\n\n\t\t\tconst segmentCount = curve.segmentCount;\n\n\t\t\tfor ( let i = 0; i < segmentCount; i ++ ) {\n\n\t\t\t\tconst segment = curve.segmentCurve( i );\n\t\t\t\tconst segmentArray = curveToPoints( segment, pointCount );\n\t\t\t\trc = rc.concat( segmentArray );\n\t\t\t\tsegment.delete();\n\n\t\t\t}\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.ArcCurve ) {\n\n\t\t\tpointCount = Math.floor( curve.angleDegrees / 5 );\n\t\t\tpointCount = pointCount < 2 ? 2 : pointCount;\n\t\t\t// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399\n\n\t\t}\n\n\t\tif ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {\n\n\t\t\tconst pLine = curve.tryGetPolyline();\n\n\t\t\tfor ( let i = 0; i < pLine.count; i ++ ) {\n\n\t\t\t\trc.push( pLine.get( i ) );\n\n\t\t\t}\n\n\t\t\tpLine.delete();\n\n\t\t\treturn rc;\n\n\t\t}\n\n\t\tconst domain = curve.domain;\n\t\tconst divisions = pointCount - 1.0;\n\n\t\tfor ( let j = 0; j < pointCount; j ++ ) {\n\n\t\t\tconst t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );\n\n\t\t\tif ( t === domain[ 0 ] || t === domain[ 1 ] ) {\n\n\t\t\t\tts.push( t );\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tconst tan = curve.tangentAt( t );\n\t\t\tconst prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );\n\n\t\t\t// Duplicated from THREE.Vector3\n\t\t\t// How to pass imports to worker?\n\n\t\t\tconst tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];\n\t\t\tconst ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];\n\n\t\t\tconst denominator = Math.sqrt( tS * ptS );\n\n\t\t\tlet angle;\n\n\t\t\tif ( denominator === 0 ) {\n\n\t\t\t\tangle = Math.PI / 2;\n\n\t\t\t} else {\n\n\t\t\t\tconst theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;\n\t\t\t\tangle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );\n\n\t\t\t}\n\n\t\t\tif ( angle < 0.1 ) continue;\n\n\t\t\tts.push( t );\n\n\t\t}\n\n\t\trc = ts.map( t => curve.pointAt( t ) );\n\t\treturn rc;\n\n\t}\n\n}\n";class J_ extends Y_{constructor(e){super(e),this.materials=[],this.setLibraryPath(J_.LIBRARY_PATH)}_createMaterial(e){return J_.ImportMaterials?super._createMaterial(e):this.materials[0]||new n.Wid({color:new n.Ilk(1,1,1),metalness:.8,name:"default",side:n.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const r=n.userData.layers;return n.traverse((e=>{const t=e.userData.attributes?.castsShadows,i=e.userData.attributes?.receivesShadows;e.castShadow=t,e.receiveShadow=i;const s=e.userData.attributes?.layerIndex??e.userData.defAttributes?.layerIndex,o=r[s];o&&(e.userData.rhinoLayer=o),e.userData.rhino3dmRoot=n.uuid,this._useInstancedMesh(e),this._useMaterialSource(e,o)})),this.materials=[],n}_useMaterialSource(e,t){if(!J_.ImportMaterials)return;const n=e;if("default"===n.material?.name){const e=n.userData.attributes?.materialSource||n.userData.defAttributes?.materialSource,r=n.userData.attributes?.colorSource||n.userData.defAttributes?.colorSource;if(!e&&!r)return;0===e?.value||1===e?.value&&0===r?.value?t&&(n.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):3===e?.value||1===e?.value&&3===r?.value?n.traverseAncestors((e=>{e?.material&&(n.material=e.material)})):e&&1!==e.value&&console.warn("Unknown material source",e,n,n.userData.attributes)}}_useInstancedMesh(e){if(!J_.ReplaceWithInstancedMesh)return;if(e.children.length<=0)return;const t=e.children,r=t.map((e=>e.geometry)),i=r.filter(((e,t)=>r.indexOf(e)===t));i.forEach((r=>{const i=t.filter((e=>e.geometry===r)),s=i.length>0?i.filter((e=>e.material===i[0].material)):[];if(s.length>1){const t=new n.SPe(r,s[0].material,s.length);t.userData={...s[0].userData},t.userData.instanceUserData=[],t.userData.attributes=t.userData.defAttributes||t.userData.attributes,t.userData.defAttributes&&delete t.userData.defAttributes,t.name=t.userData.attributes?.name||s[0].name,s.forEach(((n,r)=>{t.setMatrixAt(r,n.matrix),e.remove(n),t.userData.instanceUserData.push(n.userData)})),e.add(t)}}))}}J_.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",J_.ImportMaterials=!0,J_.ReplaceWithInstancedMesh=!1;class Z_ extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo],this._importer=new _n(J_,["3dm"],!0)}async onAdded(e){e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1)}}Z_.PluginType="Rhino3dmLoadPlugin";class $_ extends n.aNw{constructor(e){super(e)}load(e,t,r,i){const s=this,o=new n.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(s.parse(n))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),r,i)}parse(e){function t(e,t,n){for(let r=0,i=e.length;r<i;r++)if(e[r]!==t.getUint8(n+r))return!1;return!0}const r=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}return e}(e);return function(e){const n=new DataView(e);if(84+50*n.getUint32(80,!0)===n.byteLength)return!0;const r=[115,111,108,105,100];for(let e=0;e<5;e++)if(t(r,n,e))return!1;return!0}(r)?function(e){const t=new DataView(e),r=t.getUint32(80,!0);let i,s,o,a,l,c,u,h,p=!1;for(let e=0;e<70;e++)1129270351==t.getUint32(e,!1)&&82==t.getUint8(e+4)&&61==t.getUint8(e+5)&&(p=!0,a=new Float32Array(3*r*3),l=t.getUint8(e+6)/255,c=t.getUint8(e+7)/255,u=t.getUint8(e+8)/255,h=t.getUint8(e+9)/255);const d=new n.u9r,f=new Float32Array(3*r*3),m=new Float32Array(3*r*3);for(let e=0;e<r;e++){const n=84+50*e,r=t.getFloat32(n,!0),h=t.getFloat32(n+4,!0),d=t.getFloat32(n+8,!0);if(p){const e=t.getUint16(n+48,!0);0==(32768&e)?(i=(31&e)/31,s=(e>>5&31)/31,o=(e>>10&31)/31):(i=l,s=c,o=u)}for(let l=1;l<=3;l++){const c=n+12*l,u=3*e*3+3*(l-1);f[u]=t.getFloat32(c,!0),f[u+1]=t.getFloat32(c+4,!0),f[u+2]=t.getFloat32(c+8,!0),m[u]=r,m[u+1]=h,m[u+2]=d,p&&(a[u]=i,a[u+1]=s,a[u+2]=o)}}return d.setAttribute("position",new n.TlE(f,3)),d.setAttribute("normal",new n.TlE(m,3)),p&&(d.setAttribute("color",new n.TlE(a,3)),d.hasColors=!0,d.alpha=h),d}(r):function(e){const t=new n.u9r,r=/solid([\s\S]*?)endsolid/g,i=/facet([\s\S]*?)endfacet/g;let s=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),c=[],u=[],h=new n.Pa4;let p,d=0,f=0,m=0;for(;null!==(p=r.exec(e));){f=m;const e=p[0];for(;null!==(p=i.exec(e));){let e=0,t=0;const n=p[0];for(;null!==(p=l.exec(n));)h.x=parseFloat(p[1]),h.y=parseFloat(p[2]),h.z=parseFloat(p[3]),t++;for(;null!==(p=a.exec(n));)c.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),u.push(h.x,h.y,h.z),e++,m++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}const n=f,r=m-f;t.addGroup(n,r,d),d++}return t.setAttribute("position",new n.a$l(c,3)),t.setAttribute("normal",new n.a$l(u,3)),t}("string"!=typeof(i=e)?(new TextDecoder).decode(i):i);var i}}class ev extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo]}async onAdded(e){this._importer||(this._importer=new _n($_,["stl"],!0)),e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}ev.PluginType="STLLoadPlugin";class tv extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML="\nimport { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'\nwindow.MeshoptDecoder = MeshoptDecoder\n",document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}tv.PluginType="GLTFMeshOptPlugin";class nv extends yo{constructor(e){super(e)}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:r=!0,enableDrop:i=!1,importPopup:s=!1,debug:o=!1}={}){return o&&await this.addPlugin(Rd),this.getPlugin(fo)||this.addPluginSync(fo,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(Ed,!0),await rv(this,{ground:t,bloom:n,depthTonemap:r,enableDrop:i,importPopup:s}),await this.addPlugin(Xd),await this.addPlugin(lm),await this.addPlugin(R_),await this.addPlugin(k_),await this.addPlugin(L_),this}}async function rv(e,{ground:t=!0,bloom:n=!0,depthTonemap:r=!0,enableDrop:i=!1,importPopup:s=!1}={}){await e.getOrAddPlugin(fo),s&&await e.getOrAddPlugin(Pd),await e.getOrAddPlugin($t),await e.getOrAddPlugin(mp),i&&await e.getOrAddPlugin(go),await e.addPlugin(new sa(32)),await e.getOrAddPlugin(xo),await e.getOrAddPlugin(Lo),await e.addPlugin(new Ro(r||!e.useRgbm)),await e.getOrAddPlugin(tp),await e.getOrAddPlugin(Hh),await e.getOrAddPlugin(Ca),await e.getOrAddPlugin(Ip),await e.getOrAddPlugin(ec),await e.getOrAddPlugin(Qo),await e.getOrAddPlugin(Tc),await e.getOrAddPlugin(oa),await e.getOrAddPlugin(Cl),await e.getOrAddPlugin(nc),await e.getOrAddPlugin(Rp),await e.getOrAddPlugin(ua),await e.getOrAddPlugin(ac),await e.getOrAddPlugin(lp),await e.getOrAddPlugin(bl),await e.getOrAddPlugin(Lp),await e.getOrAddPlugin(xp),await e.getOrAddPlugin(Kh,!1),await e.getOrAddPlugin(dp),await e.getOrAddPlugin(Oh),await e.getOrAddPlugin(Kl,!1),await e.getOrAddPlugin(dc,!1),await e.getOrAddPlugin(la,!1),await e.getOrAddPlugin(gc,!1),await e.getOrAddPlugin(kl,!1),await e.getOrAddPlugin(Fl,!1),await e.getOrAddPlugin(Sp,!1),await e.getOrAddPlugin(sd),await e.getOrAddPlugin(Xd),await e.getOrAddPlugin(lm),await e.getOrAddPlugin(Z_),await e.getOrAddPlugin(ev),await e.getOrAddPlugin(q_),await e.getOrAddPlugin(tv),await e.getOrAddPlugin(ba),await e.getOrAddPlugin(Wh),await e.getOrAddPlugin(op),n&&await e.getOrAddPlugin(Ko),t&&await e.getOrAddPlugin(Q_),e.renderer.refreshPipeline()}let iv=0;class sv extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=iv++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),n=document.createElement("style");n.textContent=t.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(n,this.wrapper),this._initialized=!0,this._initialize(e).then((async()=>this.refreshAll()))}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e?._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e?.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=e?.canvas||(0,t.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new nv({canvas:this.canvas,useRgbm:"true"===this._getAttr("rgbm","true"),useGBufferDepth:"true"===this._getAttr("depth-prepass","true"),assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:"true"===this._getAttr("debug","false"),ground:"baked"===this._getAttr("ground","baked"),bloom:"true"===this._getAttr("bloom","true"),depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){this.viewer&&("true"===this.getAttribute("disposeOnRemove")||"true"===this.getAttribute("disposeonremove")?(this.canvas?.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):"true"===this.getAttribute("autoManageViewers")||"true"===this.getAttribute("automanageviewers")?(this.canvas?.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){this.viewer?.scene.disposeSceneModels(),this.viewer?.scene.setEnvironment(null),Object.values(this._models).forEach((async e=>e.then((e=>e.forEach((e=>e.dispose&&e.dispose())))))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src)return;if(this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],r=[],i=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const e of t)!this._models[e]&&e&&(this._models[e]=this.viewer.getManager().importer.importPath(e,{autoScale:"true"===this._getAttr("auto-scale","true"),autoCenter:"true"===this._getAttr("auto-center","true"),processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const s=this.viewer.scene.environment;s?this._environmentFromSource=s:this.viewer.scene.environment=i;for(const[e,i]of Object.entries(this._models))t.includes(e)?n.push(i.then((t=>[e,t]))):r.push(i);await Promise.all([Promise.all(n).then((async e=>Promise.all(e.map((async e=>(this._models[e[0]]=this.viewer.getManager().importer.processImported(e[1]),this._models[e[0]])))))).then((e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&this.viewer.scene.addSceneObject(e)})),Promise.all(r).then((e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&e.modelObject.removeFromParent()}))]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src)return;if(this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&"texture"!==n.assetType||await this.viewer.scene.setEnvironment(n),t?.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),"initialized"===e&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",sv);class ov{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){this._basePath=e?.basePath??"",this._assets=e?.assets?.map((e=>this._resolveAsset(e)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,t.pathJoin)([this._basePath,e.path])}}}class av extends t.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find((t=>t&&(e.test(t.path)||e.test(t.file?.name??""))));if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const lv=new n.Pa4,cv=new n.Pa4,uv=new n.Ltg,hv=new n.Ltg,pv=new n.Ltg,dv=new n.Pa4,fv=new n.yGw,mv=new n.Zzh,gv=new n.Pa4,_v=new n.ZzF,vv=new n.aLr,yv=new n.Ltg;let bv,Av;function wv(e,t,n){return yv.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),yv.multiplyScalar(1/yv.w),yv.x=Av/n.width,yv.y=Av/n.height,yv.applyMatrix4(e.projectionMatrixInverse),yv.multiplyScalar(1/yv.w),Math.abs(Math.max(yv.x,yv.y))}class xv extends n.Kj0{constructor(e=new Da,t=new Pa({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let e=0,n=0,s=t.count;e<s;e++,n+=2)lv.fromBufferAttribute(t,e),cv.fromBufferAttribute(r,e),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+lv.distanceTo(cv);const s=new n.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new n.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new n.kB5(s,1,1)),this}raycast(e,t){const r=this.material.worldUnits,i=e.camera;null!==i||r||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=void 0!==e.params.Line2&&e.params.Line2.threshold||0;bv=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;let c,u;Av=l.linewidth+s,null===a.boundingSphere&&a.computeBoundingSphere(),vv.copy(a.boundingSphere).applyMatrix4(o),c=r?.5*Av:wv(i,Math.max(i.near,vv.distanceToPoint(bv.origin)),l.resolution),vv.radius+=c,!1!==bv.intersectsSphere(vv)&&(null===a.boundingBox&&a.computeBoundingBox(),_v.copy(a.boundingBox).applyMatrix4(o),u=r?.5*Av:wv(i,Math.max(i.near,_v.distanceToPoint(bv.origin)),l.resolution),_v.expandByScalar(u),!1!==bv.intersectsBox(_v)&&(r?function(e,t){const r=e.matrixWorld,i=e.geometry,s=i.attributes.instanceStart,o=i.attributes.instanceEnd;for(let a=0,l=Math.min(i.instanceCount,s.count);a<l;a++){mv.start.fromBufferAttribute(s,a),mv.end.fromBufferAttribute(o,a),mv.applyMatrix4(r);const i=new n.Pa4,l=new n.Pa4;bv.distanceSqToSegment(mv.start,mv.end,l,i),l.distanceTo(i)<.5*Av&&t.push({point:l,pointOnLine:i,distance:bv.origin.distanceTo(l),object:e,face:null,faceIndex:a,uv:null,uv1:null})}}(this,t):function(e,t,r){const i=t.projectionMatrix,s=e.material.resolution,o=e.matrixWorld,a=e.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,u=Math.min(a.instanceCount,l.count),h=-t.near;bv.at(1,pv),pv.w=1,pv.applyMatrix4(t.matrixWorldInverse),pv.applyMatrix4(i),pv.multiplyScalar(1/pv.w),pv.x*=s.x/2,pv.y*=s.y/2,pv.z=0,dv.copy(pv),fv.multiplyMatrices(t.matrixWorldInverse,o);for(let t=0,a=u;t<a;t++){if(uv.fromBufferAttribute(l,t),hv.fromBufferAttribute(c,t),uv.w=1,hv.w=1,uv.applyMatrix4(fv),hv.applyMatrix4(fv),uv.z>h&&hv.z>h)continue;if(uv.z>h){const e=uv.z-hv.z,t=(uv.z-h)/e;uv.lerp(hv,t)}else if(hv.z>h){const e=hv.z-uv.z,t=(hv.z-h)/e;hv.lerp(uv,t)}uv.applyMatrix4(i),hv.applyMatrix4(i),uv.multiplyScalar(1/uv.w),hv.multiplyScalar(1/hv.w),uv.x*=s.x/2,uv.y*=s.y/2,hv.x*=s.x/2,hv.y*=s.y/2,mv.start.copy(uv),mv.start.z=0,mv.end.copy(hv),mv.end.z=0;const a=mv.closestPointToPointParameter(dv,!0);mv.at(a,gv);const u=n.M8C.lerp(uv.z,hv.z,a),p=u>=-1&&u<=1,d=dv.distanceTo(gv)<.5*Av;if(p&&d){mv.start.fromBufferAttribute(l,t),mv.end.fromBufferAttribute(c,t),mv.start.applyMatrix4(o),mv.end.applyMatrix4(o);const i=new n.Pa4,s=new n.Pa4;bv.distanceSqToSegment(mv.start,mv.end,s,i),r.push({point:s,pointOnLine:i,distance:bv.origin.distanceTo(s),object:e,face:null,faceIndex:t,uv:null,uv1:null})}}}(this,i,t)))}}class Ev extends Da{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Cv extends xv{constructor(e=new Ev,t=new Pa({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class Sv extends n.DqL{constructor(e){super(e)}parse(e,t){const n=new Mv(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:6===n.numberOfFaces,mipmapCount:n.numberOfMipmapLevels}}}class Mv{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(171!==n[0]||75!==n[1]||84!==n[2]||88!==n[3]||32!==n[4]||49!==n[5]||49!==n[6]||187!==n[7]||13!==n[8]||10!==n[9]||26!==n[10]||10!==n[11])return void console.error("texture missing KTX identifier");const r=Uint32Array.BYTES_PER_ELEMENT,i=new DataView(this.arrayBuffer,12,13*r),s=67305985===i.getUint32(0,!0);this.glType=i.getUint32(1*r,s),this.glTypeSize=i.getUint32(2*r,s),this.glFormat=i.getUint32(3*r,s),this.glInternalFormat=i.getUint32(4*r,s),this.glBaseInternalFormat=i.getUint32(5*r,s),this.pixelWidth=i.getUint32(6*r,s),this.pixelHeight=i.getUint32(7*r,s),this.pixelDepth=i.getUint32(8*r,s),this.numberOfArrayElements=i.getUint32(9*r,s),this.numberOfFaces=i.getUint32(10*r,s),this.numberOfMipmapLevels=i.getUint32(11*r,s),this.bytesOfKeyValueData=i.getUint32(12*r,s),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,r=this.pixelWidth,i=this.pixelHeight;const s=e?this.numberOfMipmapLevels:1;for(let e=0;e<s;e++){const e=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let s=0;s<this.numberOfFaces;s++){const s=new Uint8Array(this.arrayBuffer,n,e);t.push({data:s,width:r,height:i}),n+=e,n+=3-(e+3)%4}r=Math.max(1,.5*r),i=Math.max(1,.5*i)}return t}}class Tv extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fo]}async onAdded(e){this._importer||(this._importer=new _n(Sv,["ktx"],!1)),e.getManager()?.importer?.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&e.getManager()?.importer?.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}Tv.PluginType="KTXLoadPlugin";class Dv extends n.hH6{constructor(e){super(e),this.responseType="blob"}}class Iv extends n.hH6{constructor(e){super(e),this.responseType="blob"}load(e,n,r,i){return super.load(e,(e=>{try{n?.((0,t.blobToDataURL)(e))}catch(e){i?.(e)}}),r,i)}}class Pv{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class Rv{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const Bv={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class kv{constructor(){this.pluginCallbacks=[],this.register((function(e){return new Yv(e)})),this.register((function(e){return new Kv(e)})),this.register((function(e){return new $v(e)})),this.register((function(e){return new ey(e)})),this.register((function(e){return new ty(e)})),this.register((function(e){return new ny(e)})),this.register((function(e){return new Jv(e)})),this.register((function(e){return new Zv(e)})),this.register((function(e){return new ry(e)})),this.register((function(e){return new iy(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,i){const s=i||new Xv,o=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)o.push(this.pluginCallbacks[e](s));s.setPlugins(o),s.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,r,i,t)}))}}const Ov=5120,Lv=5121,Fv=5122,Uv=5123,Nv="KHR_mesh_quantization",jv={};jv[n.TyD]=9728,jv[n.YLQ]=9984,jv[n.aH4]=9986,jv[n.wem]=9729,jv[n.qyh]=9985,jv[n.D1R]=9987,jv[n.uWy]=33071,jv[n.rpg]=10497,jv[n.OoA]=33648;const zv={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Gv=new n.Ilk;function Vv(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Hv(e){return 4*Math.ceil(e/4)}function Qv(e,t=0){const n=Hv(e.byteLength);if(n!==e.byteLength){const r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function Wv(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function qv(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class Xv{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,i=r.buffers,s=r.json;n=r.options;const o=r.extensionsUsed,a=r.extensionsRequired,l=new Blob(i,{type:"application/octet-stream"}),c=Object.keys(o),u=Object.keys(a);if(c.length>0&&(s.extensionsUsed=c),u.length>0&&(s.extensionsRequired=u),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===n.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const n=Qv(e.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,n.byteLength,!0),r.setUint32(4,5130562,!0);const i=Qv((o=JSON.stringify(s),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const u=12+a.byteLength+i.byteLength+r.byteLength+n.byteLength;c.setUint32(8,u,!0);const h=new Blob([l,a,i,r,n],{type:"application/octet-stream"}),p=new FileReader;p.readAsArrayBuffer(h),p.onloadend=function(){t(p.result)}}}else if(s.buffers&&s.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const n=e.result;s.buffers[0].uri=n,t(s)}}else t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,r=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],r[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message),console.warn({...e.userData})}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new n.Pa4;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),i=new n.Pa4;for(let e=0,t=r.count;e<t;e++)i.fromBufferAttribute(r,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),r.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let n=!1;const r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return e.colorSpace===n.KI_?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const i=e?e.image:null,s=t?t.image:null,o=Math.max(i?i.width:0,s?s.width:0),a=Math.max(i?i.height:0,s?s.height:0),l=Wv();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(i){c.drawImage(i,0,0,o,a);const t=r(e),n=c.getImageData(0,0,o,a).data;for(let e=2;e<n.length;e+=4)u.data[e]=256*t(n[e]/256)}if(s){c.drawImage(s,0,0,o,a);const e=r(t),n=c.getImageData(0,0,o,a).data;for(let t=1;t<n.length;t+=4)u.data[t]=256*e(n[t]/256)}c.putImageData(u,0,0);const h=(e||t).clone();return h.source=new n.Hw6(l),h.colorSpace=n.aCh,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,r,i,s){const o=this.json;let a;switch(o.bufferViews||(o.bufferViews=[]),t){case Ov:case Lv:a=1;break;case Fv:case Uv:a=2;break;default:a=4}const l=Hv(i*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let u=0;for(let s=r;s<r+i;s++)for(let r=0;r<e.itemSize;r++){let i;e.itemSize>4?i=e.array[s*e.itemSize+r]:(0===r?i=e.getX(s):1===r?i=e.getY(s):2===r?i=e.getZ(s):3===r&&(i=e.getW(s)),!0===e.normalized&&(i=n.M8C.normalize(i,e.array))),5126===t?c.setFloat32(u,i,!0):5124===t?c.setInt32(u,i,!0):5125===t?c.setUint32(u,i,!0):t===Fv?c.setInt16(u,i,!0):t===Uv?c.setUint16(u,i,!0):t===Ov?c.setInt8(u,i):t===Lv&&c.setUint8(u,i),u+=a}const h={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return void 0!==s&&(h.target=s),34962===s&&(h.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(h),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(r){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const e=Qv(i.result),s={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(n.bufferViews.push(s)-1)}}))}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=Qv(e);const r={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(r)-1}processAccessor(e,t,r,i){const s=this.json;let o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Int32Array)o=5124;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Int16Array)o=Fv;else if(e.array.constructor===Uint16Array)o=Uv;else if(e.array.constructor===Int8Array)o=Ov;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=Lv}if(void 0===r&&(r=0),void 0===i&&(i=e.count),0===i)return null;const a=function(e,t,r){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+r;s++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[s*e.itemSize+t]:(0===t?r=e.getX(s):1===t?r=e.getY(s):2===t?r=e.getZ(s):3===t&&(r=e.getW(s)),!0===e.normalized&&(r=n.M8C.normalize(r,e.array))),i.min[t]=Math.min(i.min[t],r),i.max[t]=Math.max(i.max[t],r)}return i}(e,r,i);let l;void 0!==t&&(l=e===t.index?34963:34962);const c=this.processBufferView(e,o,r,i,l),u={bufferView:c.id,byteOffset:c.byteOffset,componentType:o,count:i,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(u)-1}processImage(e,t,r,i="image/png",s=void 0,o=void 0){if(null!==e){const a=this,l=a.cache,c=a.json,u=a.options,h=a.pending;l.images.has(e)||l.images.set(e,{});const p=l.images.get(e),d=i+":flipY/"+r.toString()+(s||o?";"+s+";"+o:"");if(void 0!==p[d])return p[d];c.images||(c.images=[]);const f={mimeType:i},m=Wv();m.width=Math.min(s||e.width,u.maxTextureSize),m.height=Math.min(o||e.height,u.maxTextureSize);const g=m.getContext("2d");if(!0===r&&(g.translate(0,m.height),g.scale(1,-1)),void 0!==e.data){t!==n.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>u.maxTextureSize||e.height>u.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];g.putImageData(new ImageData(r,e.width,e.height),0,0)}else g.drawImage(e,0,0,m.width,m.height);!0===u.binary?h.push(qv(m,i).then((e=>a.processBufferViewImage(e))).then((e=>{f.bufferView=e}))):void 0!==m.toDataURL?f.uri=m.toDataURL(i):h.push(qv(m,i).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{f.uri=e})));const _=c.images.push(f)-1;return p[d]=_,_}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:jv[e.magFilter],minFilter:jv[e.minFilter],wrapS:jv[e.wrapS],wrapT:jv[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let r=e.userData.mimeType;"image/webp"===r&&(r="image/png"),"image/jpg"===r&&(r="image/jpeg");const i={sampler:this.processSampler(e),source:!r||["image/jpeg","image/png"].includes(r)?this.processImage(e.image,e.format,e.flipY,r):null};e.name&&(i.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,i)})),null===i.source&&console.error("GLTFExporter: Unsupported mime type: "+r+". Cannot export texture.",e);const s=n.textures.push(i)-1;return t.textures.set(e,s),s}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(Vv(s,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),i.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===n.ehD&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)}));const o=r.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,r=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,n=e.material.length;t<n;t++)i.push(e.material[t].uuid);else i.push(e.material.uuid);const s=i.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let a;a=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const l={},c={},u=[],h=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=o.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let f=null;for(let e in o.attributes){if("morph"===e.slice(0,5))continue;const r=o.attributes[e];if(e=p[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(r))){c[e]=t.attributes.get(this.getUID(r));continue}f=null;const i=r.array;"JOINTS_0"!==e||i instanceof Uint16Array||i instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new n.TlE(new Uint16Array(i),r.itemSize,r.normalized));const s=this.processAccessor(f||r,o);null!==s&&(e.startsWith("_")||this.detectMeshQuantization(e,r),c[e]=s,t.attributes.set(this.getUID(r),s))}if(void 0!==d&&o.setAttribute("normal",d),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],r=[],i={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)i[e.morphTargetDictionary[t]]=t;for(let s=0;s<e.morphTargetInfluences.length;++s){const a={};let l=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const n=o.morphAttributes[e][s],r=e.toUpperCase(),i=o.attributes[e];if(t.attributes.has(this.getUID(n,!0))){a[r]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!o.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let t=0;t<n.itemSize;t++)0===t&&c.setX(e,n.getX(e)-i.getX(e)),1===t&&c.setY(e,n.getY(e)-i.getY(e)),2===t&&c.setZ(e,n.getZ(e)-i.getZ(e)),3===t&&c.setW(e,n.getW(e)-i.getW(e));a[r]=this.processAccessor(c,o),t.attributes.set(this.getUID(i,!0),a[r])}h.push(a),n.push(e.morphTargetInfluences[s]),void 0!==e.morphTargetDictionary&&r.push(i[s])}l.weights=n,r.length>0&&(l.extras={},l.extras.targetNames=r)}const m=Array.isArray(e.material);if(m&&0===o.groups.length)return null;const g=m?e.material:[e.material],_=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,n=_.length;e<n;e++){const n={mode:a,attributes:c};if(this.serializeUserData(o,n),h.length>0&&(n.targets=h),null!==o.index){let r=this.getUID(o.index);void 0===_[e].start&&void 0===_[e].count||(r+=":"+_[e].start+":"+_[e].count),t.attributes.has(r)?n.indices=t.attributes.get(r):(n.indices=this.processAccessor(o.index,o,_[e].start,_[e].count),t.attributes.set(r,n.indices)),null===n.indices&&delete n.indices}const r=this.processMaterial(g[_[e].materialIndex]);null!==r&&(n.material=r),u.push(n)}l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,l)}));const v=r.meshes.push(l)-1;return t.meshes.set(s,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[Nv])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const r=e.split("_",1)[0];Bv[r]&&Bv[r].includes(n)&&(this.extensionsUsed[Nv]=!0,this.extensionsRequired[Nv]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e.isOrthographicCamera,i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:n.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const r=this.json,i=this.nodeMap;r.animations||(r.animations=[]);const s=(e=kv.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],a=[];for(let e=0;e<s.length;++e){const r=s[e],l=n.iUV.parseTrackName(r.name);let c=n.iUV.findNode(t,l.nodeName);const u=zv[l.propertyName];if("bones"===l.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(l.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',r.name),null;const h=1;let p,d=r.values.length/r.times.length;u===zv.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(p="CUBICSPLINE",d/=3):p=r.getInterpolation()===n.Syv?"STEP":"LINEAR",a.push({input:this.processAccessor(new n.TlE(r.times,h)),output:this.processAccessor(new n.TlE(r.values,d)),interpolation:p}),o.push({sampler:a.length-1,target:{node:i.get(c),path:u}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:a,channels:o}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap,i=t.nodes[r.get(e)],s=e.skeleton;if(void 0===s)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],l=new Float32Array(16*s.bones.length),c=new n.yGw;for(let t=0;t<s.bones.length;++t)a.push(r.get(s.bones[t])),c.copy(s.boneInverses[t]),c.multiply(e.bindMatrix).toArray(l,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new n.TlE(l,16)),joints:a,skeleton:r.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),r=e.scale.toArray();Vv(t,[0,0,0,1])||(i.rotation=t),Vv(n,[0,0,0])||(i.translation=n),Vv(r,[1,1,1])||(i.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Vv(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(i.mesh=t)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let r=0,i=e.children.length;r<i;r++){const i=e.children[r];if(i.visible||!1===n.onlyVisible){const e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)}));const s=t.nodes.push(i)-1;return r.set(e,s),s}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);const i=[];for(let t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.visible||!1===n.onlyVisible){const e=this.processNode(r);null!==e&&i.push(e)}}i.length>0&&(r.nodes=i),this.serializeUserData(e,r)}processObjects(e){const t=new n.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));const r=[];for(let t=0;t<e.length;t++)e[t]instanceof n.xsS?this.processScene(e[t]):r.push(e[t]);r.length>0&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class Yv{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,r=n.json,i=n.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);const o=r.extensions[this.name].lights;o.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class Kv{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Jv{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),i.clearcoatTexture=t}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(t,e.clearcoatNormalMap),i.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class Zv{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),i.iridescenceTexture=t}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class $v{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),i.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class ey{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){const t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),i.thicknessTexture=t}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class ty{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class ny{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Gv)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.specularIntensityMap){const t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),i.specularTexture=t}if(e.specularColorMap){const t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),i.specularColorTexture=t}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class ry{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.sheenRoughnessMap){const t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),i.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),i.sheenColorTexture=t}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,r[this.name]=!0}}class iy{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}kv.Utils={GLTFWriter:Xv,insertKeyframe:function(e,t){const n=.001,r=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+r),o=e.createInterpolant(new e.ValueBufferType(r));let a;if(0===e.times.length){i[0]=t;for(let e=0;e<r;e++)s[e]=0;a=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;i[0]=t,i.set(e.times,1),s.set(o.evaluate(t),0),s.set(e.values,r),a=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),s.set(e.values,0),s.set(o.evaluate(t),e.values.length),a=i.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){i.set(e.times.slice(0,l+1),0),i[l+1]=t,i.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*r),0),s.set(o.evaluate(t),(l+1)*r),s.set(e.values.slice((l+1)*r),(l+2)*r),a=l+1;break}}return e.times=i,e.values=s,a},mergeMorphTargetTracks:function(e,t){const r=[],i={},s=e.tracks;for(let e=0;e<s.length;++e){let o=s[e];const a=n.iUV.parseTrackName(o.name),l=n.iUV.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){r.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(n.NMF)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(void 0===u)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(void 0===i[l.uuid]){h=o.clone();const e=new h.ValueBufferType(c*h.times.length);for(let t=0;t<h.times.length;t++)e[t*c+u]=h.values[t];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=e,i[l.uuid]=h,r.push(h);continue}const p=o.createInterpolant(new o.ValueBufferType(1));h=i[l.uuid];for(let e=0;e<h.times.length;e++)h.values[e*c+u]=p.evaluate(h.times[e]);for(let e=0;e<o.times.length;e++){const t=this.insertKeyframe(h,o.times[e]);h.values[t*c+u]=o.values[e]}}return e.tracks=r,e}};class sy extends kv.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new n.Wid}serializeUserData(e,t){const n=e.userData,r={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach((([e,t])=>{(!t||"function"==typeof t||t.isObject3D||t.isTexture||t.isMaterial||null!=t.assetType||e.startsWith("_")||"uuid"!==e&&($e.includes(e)||et.includes(e)||Se.includes(e)))&&(r[e]=t,delete n[e])})),super.serializeUserData(e,t),Object.entries(r).forEach((([e,t])=>{n[e]=t,delete r[e]}))}processObjects(e){1===e.length&&e[0]?.userData.rootSceneModelRoot?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(null===n)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const r=JSON.stringify(this.json.materials[n]),i=JSON.parse(r);this.serializeUserData(e,i),this._invokeAll((t=>{t.writeMaterial&&t.writeMaterial(e,i)}));const s=this.json.materials.push(i)-1;return this.cache.materials.set(e,s),s}processImageBlob(e,n){if(!e)return-1;const r=this.cache,i=this.options,s=this.pending,o=this.json,a=n.image;r.images.has(a)||r.images.set(a,{});const l=r.images.get(a),c=e.type+":flipY/"+n.flipY.toString();if(void 0!==l[c])return l[c];o.images||(o.images=[]);const u={mimeType:e.type};!0===i.binary?s.push(new Promise((t=>{this.processBufferViewImage(e).then((e=>{u.bufferView=e,t()}))}))):s.push((0,t.blobToDataURL)(e).then((e=>{u.uri=e})));const h=o.images.push(u)-1;return l[c]=h,h}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const r=e.source.data,i=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const s=super.processTexture(e),o=n.textures[s];if(!o)return console.error("No texture def",s,e),s;const a=n.images?n.images[o.source]:null;if(a&&(a.extras||(a.extras={}),e.source&&(a.extras.uuid=e.source.uuid),a.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=r,e.userData.mimeType=i,!o)return console.error("textureDef is null",s,e),s;if(o.source>=0){const t=this.json.images[o.source];t.uri?console.warn("uri already set",t.uri):(t.uri=e.userData.rootPath,t.mimeType=i,t.extras||(t.extras={}),t.extras.flipY=e.flipY,t.extras.uri=e.userData.rootPath)}else o.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,i)}return o.source<0&&console.error("textureDef.source cannot be saved",o,e),s}processImage(e,t,n,r="image/png"){return e?super.processImage(e,t,n,r,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,r="image/png"){const i=this.cache,s=this.json;i.images.has(e)||i.images.set(e,{});const o=i.images.get(e),a=r+":flipY/"+n.toString();if(void 0!==o[a])return o[a];s.images||(s.images=[]);const l={mimeType:r,uri:t,extras:{flipY:n}},c=s.images.push(l)-1;return o[a]=c,c}}function oy(e,t){(t=t??document.createElement("script")).type=e.type||"text/javascript",t.text=e.text;for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n];t.setAttribute(r.name,r.value)}return t}function ay(e,t=0){const n=(r=e.byteLength,4*Math.ceil(r/4));var r;if(n!==e.byteLength){const r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){const n=new Uint8Array(this);null==t&&(t=n.length);const r=new ArrayBuffer(t-e),i=new Uint8Array(r);for(let t=0;t<i.length;t++)i[t]=n[t+e];return r});class ly extends kv{register(e){return super.register(e)}async parseAsync(e,n){if(!e)throw new Error("No object to export");const r=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise(((t,r)=>this.parse(e,t,r,n)));if(r&&"object"==typeof r&&!r.byteLength)return new Blob([JSON.stringify(r,((e,t)=>e.startsWith("__")?void 0:t),n.jsonSpaces??2)],{type:"model/gltf+json"});if(r){let e=null;return n.encrypt&&(!n.encryptKey&&window.prompt&&(n.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),n.encryptKey?e=function(e,t){const n=ay(e),r=new DataView(new ArrayBuffer(8));r.setUint32(0,n.byteLength,!0),r.setUint32(4,5130562,!0);const i=ay((new TextEncoder).encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}}||{})).buffer,32),s=new DataView(new ArrayBuffer(8));s.setUint32(0,i.byteLength,!0),s.setUint32(4,1313821514,!0);const o=new ArrayBuffer(12),a=new DataView(o);a.setUint32(0,1179937895,!0),a.setUint32(4,2,!0);const l=12+s.byteLength+i.byteLength+r.byteLength+n.byteLength;a.setUint32(8,l,!0);const c=new Blob([o,s,i,r,n],{type:"application/octet-stream"});return c.ext="glb",c}(await(0,t.aesGcmEncrypt)(new Uint8Array(r),n.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),e||(e=new Blob([r],{type:"model/gltf+binary"})),e}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,r={}){const i={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!r.embedUrlImages&&r.externalImagesInExtras||!1,embedUrlImages:r.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:r};return"glb"===r.exportExt&&(i.binary=!0),!1!==r.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{e.uuid&&(e.userData.gltfUUID=e.uuid)})))),(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{if(e.animations)for(const t of e.animations)!1===t.__gltfExport||i.animations.includes(t)||i.animations.push(...e.animations)})))),super.parse(e,(n=>{!1!==r.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach((e=>e.traverse((e=>{delete e.userData.gltfUUID})))),t(Object.assign(n,{__isGLTFOutput:!0}))}),n,i,new sy)}}function cy(e,t){const r=e.getPlugin(fo).exportViewerConfig();t.json.textures&&t.json.samplers&&t.json.images&&r.resources.textures&&[...Object.entries(r.resources.textures)].forEach((([e,n])=>{const i=t.json.textures.find((n=>n.extras?.uuid===e||t.json.samplers[n.sampler]?.extras?.uuid===e||t.json.images[n.source]?.extras?.t_uuid===e));i&&(n.image&&r.resources.images&&r.resources.images[n.image]&&delete r.resources.images[n.image],r.resources.textures[e]={})})),t.json.materials&&r.resources.materials&&[...Object.entries(r.resources.materials)].forEach((([e,n])=>{t.json.materials.find((t=>t.extras?.uuid===e))&&(r.resources.materials[e]={})}));const i=[];Object.values(r.resources).forEach((e=>{e&&Object.values(e).forEach((e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),i.push(e.url)):"Uint8Array"===e.url.type&&e.url.data&&(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),i.push(e.url)))}))}));for(const e of i){let r="application/octet-stream";if(e.mimeType&&(r=e.mimeType),t.options.exporterOptions.encodeUint16Rgbe&&"Uint16Array"===e.type&&e.width>0&&e.height>0){const t=uy(e.data,4),i=new ImageData(t,e.width,e.height),s=n.PpQ.getDataURL(i,!0).split(",")[1],o=2;if(r="image/png",1===o)e.data=atob(s);else{if(2!==o)throw new Error("Invalid encoding version");e.data=Uint8Array.from(atob(s),(e=>e.charCodeAt(0)))}e.encoding="rgbe",e.encodingVersion=o}t.json.images||(t.json.images=[]);const i={mimeType:r},s=t.json.images.push(i)-1,o=e.data;i.bufferView=t.processBufferViewImageBuffer(o),e.data={image:s}}return r}function uy(e,t=3,n){let r,i,s,o,a;const l=e.byteLength/(2*t)|0;n=n||new Uint8ClampedArray(4*l);for(let c=0;c<l;c++){r=e[c*t],i=e[c*t+1],s=e[c*t+2],o=Math.max(Math.max(r,i),s);const l=Math.ceil(Math.log2(o));a=Math.pow(2,l-8),n[4*c]=r/a|0,n[4*c+1]=i/a|0,n[4*c+2]=s/a|0,n[4*c+3]=l+128}return n}function hy(e,t,n=ly,r){if(!t)return;const i=e.Exporters.findIndex((e=>e.ext.includes("gltf")||e.ext.includes("glb"))),s=[];i>=0?(s.push(...e.Exporters[i].extensions??[]),e.Exporters.splice(i,1)):(s.push(fy),s.push(dy),s.push(py),s.push((e=>new Xe(e))),s.push((e=>new my(e))),s.push((e=>new gy(e))),s.push((e=>new _y(e))),s.push((e=>new vy(e)))),e.Exporters.push({ctor:()=>{const e=new n;return s.forEach((t=>e.register(t))),e.register((e=>({afterParse:n=>{if(n=Array.isArray(n)?n[0]:n,!n?.userData?.rootSceneModelRoot||!1===n?.userData?.__exportViewerConfig)return;const r=e.json.scenes[e.json.scene||0];r.extensions||(r.extensions={}),r.extensions[_r]=cy(t,e),e.extensionsUsed[_r]=!0}}))),r?.(e),e},ext:["gltf","glb"],extensions:s})}const py=e=>({writeNode:(t,n)=>{if(!t?.isLight)return;n.extensions||(n.extensions={});const r={};t.shadow&&(r.shadow=t.shadow.toJSON()),Object.keys(r).length>0&&(n.extensions[yr]=r,e.extensionsUsed[yr]=!0)}}),dy=e=>({writeNode:(t,n)=>{if(!t?.isObject3D)return;n.extensions||(n.extensions={});const r={};void 0!==t.castShadow&&(r.castShadow=t.castShadow),void 0!==t.receiveShadow&&(r.receiveShadow=t.receiveShadow),!1===t.visible&&(r.visible=!1),!1===t.frustumCulled&&(r.frustumCulled=!1),0!==t.renderOrder&&(r.renderOrder=t.renderOrder),1!==t.layers.mask&&(r.layers=t.layers.mask),!1===t.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),Object.keys(r).length>0&&(n.extensions[br]=r,e.extensionsUsed[br]=!0)}}),fy=e=>({writeMaterial(t,r){if(!t?.isMaterial)return;r.extensions||(r.extensions={});const i={};void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.side&&t.side!==n.ehD&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.normalScale&&(i.normalScale=[t.normalScale.x,t.normalScale.y]);const s=this.materialExternalResources[t.uuid];s&&Object.entries(s).forEach((([t,n])=>{t.startsWith("_")||(n?.userData&&(n.userData.__embedUrlImagePreviews=e.options.exporterOptions?.embedUrlImagePreviews),i[t]=Ne(n,!1,this.serializedMeta),n?.userData&&delete n.userData.__embedUrlImagePreviews)})),Object.keys(i).length>0&&(r.extensions[Ar]=i,e.extensionsUsed[Ar]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(t){if(this.materialExternalResources={},!e.options.externalImagesInExtras)return;const n=[];(Array.isArray(t)?t:[t]).forEach((e=>{e?.traverse((e=>{e&&e.material?.isMaterial&&n.push(e.material)}))})),n.forEach((e=>{e&&(this.materialExternalResources[e.uuid]||(this.materialExternalResources[e.uuid]={}),this.materialExternalResources[e.uuid].__materialRef=e,Object.entries(e).forEach((([t,n])=>{t.startsWith("_")||n&&n.isTexture&&n.userData.rootPath&&(n.userData.rootPath.startsWith("http")||n.userData.rootPath.startsWith("data:"))&&(e[t]=null,this.materialExternalResources[e.uuid][t]=n)})))}))},afterParse(t){const n=Object.values(this.materialExternalResources);if(n.length<1)return;n.forEach((e=>{const t=e.__materialRef;t&&(Object.entries(e).forEach((([e,n])=>{e.startsWith("_")||n&&(t[e]=n)})),delete this.materialExternalResources[t.uuid])}));const r=e.json.scenes[e.json.scene||0];r.extensions||(r.extensions={}),r.extensions[Ar]={resources:this.serializedMeta},e.extensionsUsed[Ar]=!0}});class my{constructor(e){this.writer=e,this.name=Sr}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.bumpScale)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.bumpScale=e.bumpScale,e.bumpMap){const t={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(t,e.bumpMap),i.bumpTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class gy{constructor(e){this.writer=e,this.name=Mr}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.displacementScale)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.displacementScale=e.displacementScale,i.displacementBias=e.displacementBias,e.displacementMap){const t={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(t,e.displacementMap),i.displacementTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class _y{constructor(e){this.writer=e,this.name=Dr}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.lightMapIntensity)return;const n=this.writer,r=n.extensionsUsed,i={};if(i.lightMapIntensity=e.lightMapIntensity,e.lightMap){const t={index:n.processTexture(e.lightMap)};n.applyTextureTransform(t,e.lightMap),i.lightMapTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}class vy{constructor(e){this.writer=e,this.name=Tr}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,r=n.extensionsUsed,i={};if(e.alphaMap){const t={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(t,e.alphaMap),i.alphaTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}const yy=new TextEncoder;class by{parse(e,t,r){if(!function(e,t){if(t.isWebGLRenderTarget&&(!e||!e.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!t||!t.isWebGLRenderTarget&&!t.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const r=t.isWebGLRenderTarget?t.texture:t;return r.type!==n.VzW&&r.type!==n.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):r.format===n.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const i=function(e,t={}){const r=e.isTexture?e:e.texture,i=e.isWebGLRenderTarget?e.width:e.image.width,s=e.isWebGLRenderTarget?e.height:e.image.height,o=r.type,a=r.format,l=r.colorSpace,c=void 0!==t.compression?t.compression:3,u=(void 0!==t.type?t.type:n.cLu)===n.VzW?2:1,h={0:1,2:1,3:16}[c];return{width:i,height:s,type:o,format:a,colorSpace:l,compression:c,blockLines:h,dataType:u,dataSize:2*u,numBlocks:Math.ceil(s/h),numInputChannels:4,numOutputChannels:4,flipY:e.isDataTexture&&e.flipY}}(t,r),s=function(e,t,r){if(t.isDataTexture)return t.image.data;let i;return i=r.type===n.VzW?new Float32Array(r.width*r.height*r.numInputChannels):new Uint16Array(r.width*r.height*r.numInputChannels),e.readRenderTargetPixels(t,0,0,r.width,r.height,i),i}(e,t,i),o=function(e,t){const r=t.width,i=t.height,s={r:0,g:0,b:0,a:0},o={value:0},a=4==t.numOutputChannels?1:0,l=t.type==n.VzW?Py:Iy,c=1==t.dataType?Sy:My,u=new Uint8Array(t.width*t.height*t.numOutputChannels*t.dataSize),h=new DataView(u.buffer);for(let n=0;n<i;++n)for(let u=0;u<r;++u){const p=n*r*4+4*u,d=l(e,p),f=l(e,p+1),m=l(e,p+2),g=l(e,p+3),_=(t.flipY?n:i-n-1)*r*(3+a)*t.dataSize;xy(s,d,f,m,g),o.value=_+u*t.dataSize,c(h,s.a,o),o.value=_+a*r*t.dataSize+u*t.dataSize,c(h,s.b,o),o.value=_+(1+a)*r*t.dataSize+u*t.dataSize,c(h,s.g,o),o.value=_+(2+a)*r*t.dataSize+u*t.dataSize,c(h,s.r,o)}return u}(s,i),a=function(e,t){let n,r,i=0;const s={data:new Array,totalSize:0},o=t.width*t.numOutputChannels*t.blockLines*t.dataSize;switch(t.compression){case 0:n=Ay;break;case 2:case 3:n=wy}0!==t.compression&&(r=new Uint8Array(o));for(let a=0;a<t.numBlocks;++a){const t=n(e.subarray(o*a,o*(a+1)),r);i+=t.length,s.data.push({dataChunk:t,size:t.length})}return s.totalSize=i,s}(o,i);return function(e,t){const n=8*t.numBlocks,r=259+18*t.numOutputChannels,i={value:r+n},s=new Uint8Array(r+n+e.totalSize+8*t.numBlocks),o=new DataView(s.buffer);!function(e,t,n){const r={value:0},i=new DataView(e.buffer);Cy(i,20000630,r),Cy(i,2,r),Dy(i,"compression",r),Dy(i,"compression",r),Cy(i,1,r),Ey(i,n.compression,r),Dy(i,"screenWindowCenter",r),Dy(i,"v2f",r),Cy(i,8,r),Cy(i,0,r),Cy(i,0,r),Dy(i,"screenWindowWidth",r),Dy(i,"float",r),Cy(i,4,r),My(i,1,r),Dy(i,"pixelAspectRatio",r),Dy(i,"float",r),Cy(i,4,r),My(i,1,r),Dy(i,"lineOrder",r),Dy(i,"lineOrder",r),Cy(i,1,r),Ey(i,0,r),Dy(i,"dataWindow",r),Dy(i,"box2i",r),Cy(i,16,r),Cy(i,0,r),Cy(i,0,r),Cy(i,n.width-1,r),Cy(i,n.height-1,r),Dy(i,"displayWindow",r),Dy(i,"box2i",r),Cy(i,16,r),Cy(i,0,r),Cy(i,0,r),Cy(i,n.width-1,r),Cy(i,n.height-1,r),Dy(i,"channels",r),Dy(i,"chlist",r),Cy(i,18*n.numOutputChannels+1,r),Dy(i,"A",r),Cy(i,n.dataType,r),r.value+=4,Cy(i,1,r),Cy(i,1,r),Dy(i,"B",r),Cy(i,n.dataType,r),r.value+=4,Cy(i,1,r),Cy(i,1,r),Dy(i,"G",r),Cy(i,n.dataType,r),r.value+=4,Cy(i,1,r),Cy(i,1,r),Dy(i,"R",r),Cy(i,n.dataType,r),r.value+=4,Cy(i,1,r),Cy(i,1,r),Ey(i,0,r),Ey(i,0,r);let s=r.value+8*n.numBlocks;for(let e=0;e<t.data.length;++e)Ty(i,s,r),s+=t.data[e].size+8}(s,e,t);for(let n=0;n<e.data.length;++n){const r=e.data[n].dataChunk,a=e.data[n].size;Cy(o,n*t.blockLines,i),Cy(o,a,i),s.set(r,i.value),i.value+=a}return s}(a,i)}}function Ay(e){return e}function wy(e,t){let n=0,r=Math.floor((e.length+1)/2),i=0;const s=e.length-1;for(;!(i>s||(t[n++]=e[i++],i>s));)t[r++]=e[i++];let o=t[0];for(let e=1;e<t.length;e++){const n=t[e]-o+384;o=t[e],t[e]=n}return function(e,t){t||(t={});var n=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)i+=r+=n[o];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}}();n.p(e);var r=function(e,t,n,r,i){return function(e,t,n,r,i,s){var o=e.length,a=new Kd(r+o+5*(1+Math.ceil(o/7e3))+i),l=a.subarray(r,a.length-i),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?c=Pf(l,c,e.subarray(u,h)):(l[u]=s,c=Pf(l,c,e.subarray(u,o)))}else{for(var p=Bf[t-1],d=p>>>13,f=8191&p,m=(1<<n)-1,g=new Jd(32768),_=new Jd(m+1),v=Math.ceil(n/3),y=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},A=new Zd(25e3),w=new Jd(288),x=new Jd(32),E=0,C=0,S=(u=0,0),M=0,T=0;u<o;++u){var D=b(u),I=32767&u,P=_[D];if(g[I]=P,_[D]=I,M<=u){var R=o-u;if((E>7e3||S>24576)&&R>423){c=Rf(e,l,0,A,w,x,C,S,T,u-T,c),S=E=C=0,T=u;for(var B=0;B<286;++B)w[B]=0;for(B=0;B<30;++B)x[B]=0}var k=2,O=0,L=f,F=I-P&32767;if(R>2&&D==b(u-F))for(var U=Math.min(d,R)-1,N=Math.min(32767,u),j=Math.min(258,R);F<=N&&--L&&I!=P;){if(e[u+k]==e[u+k-F]){for(var z=0;z<j&&e[u+z]==e[u+z-F];++z);if(z>k){if(k=z,O=F,z>U)break;var G=Math.min(F,z-2),V=0;for(B=0;B<G;++B){var H=u-F+B+32768&32767,Q=H-g[H]+32768&32767;Q>V&&(V=Q,P=H)}}}F+=(I=P)-(P=g[I])+32768&32767}if(O){A[S++]=268435456|of[k]<<18|cf[O];var W=31&of[k],q=31&cf[O];C+=$d[W]+ef[q],++w[257+W],++x[q],M=u+k,++E}else A[S++]=e[u],++w[e[u]]}}c=Rf(e,l,s,A,w,x,C,S,T,u-T,c),!s&&7&c&&(c=Pf(l,c+1,kf))}return Ef(a,0,r+xf(c)+i)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)}(e,t,2,4);return function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)}(r,t),function(e,t,n){for(;n;++t)e[t]=n,n>>>=8}(r,r.length-4,n.d()),r}(t)}function xy(e,t,n,r,i){e.r=t,e.g=n,e.b=r,e.a=i}function Ey(e,t,n){e.setUint8(n.value,t),n.value+=1}function Cy(e,t,n){e.setUint32(n.value,t,!0),n.value+=4}function Sy(e,t,r){e.setUint16(r.value,n.A5E.toHalfFloat(t),!0),r.value+=2}function My(e,t,n){e.setFloat32(n.value,t,!0),n.value+=4}function Ty(e,t,n){e.setBigUint64(n.value,BigInt(t),!0),n.value+=8}function Dy(e,t,n){const r=yy.encode(t+"\0");for(let t=0;t<r.length;++t)Ey(e,r[t],n)}function Iy(e,t){return function(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}(e[t])}function Py(e,t){return e[t]}class Ry extends by{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class By extends t.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find((t=>t.ext.some((t=>e.includes(t)))))}constructor(e,t={}){super(),this._processors=new bn,this.Exporters=[{ctor:()=>new Pv,ext:["json"]},{ctor:()=>new Rv,ext:["txt","text"]},{ctor:()=>new Ry,ext:["exr"]}],this._cachedParsers=[],hy(this,e)}async exportObject(e,t={}){if(!e?.assetType)return void console.error("Object has no asset type");e?.userData?.rootSceneModelRoot&&!1===t.viewerConfig&&(e.userData.__exportViewerConfig=!1);const n=[];"model"===e.assetType&&e.modelObject.traverse((e=>{e.userData.excludeFromExport&&e.visible&&(e.visible=!1,n.push(e))}));const r=await this._exportFile(e,t);return"model"===e.assetType&&n.forEach((e=>e.visible=!0)),e?.userData?.rootSceneModelRoot&&!1===t.viewerConfig&&delete e.userData.__exportViewerConfig,r}async _exportFile(e,t={}){let n;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const r=await this.processBeforeExport(e,t),i=t.exportExt??r?.typeExt??r?.ext;if(!r||!i)throw new Error(`Unable to preprocess before export ${i}`);const s=this._getParser(i);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const o=await s.parseAsync(r.obj,{exportExt:r.ext??i,...t});o.ext=r.ext,n=o}catch(t){return console.error("AssetExporter: Unable to Export file",e),console.error(t),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:t})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),n}_createParser(e){const t=this.Exporters.find((t=>t.ext.includes(e)));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t?.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){return this._cachedParsers.find((t=>t.ext.includes(e)))?.parser??this._createParser(e)}async processBeforeExport(e,t={}){if(null!=e.assetType&&"renderTarget"!==e.assetType&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){this._processors?.dispose()}}var ky;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(ky||(ky={}));class Oy extends qt{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:ky.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new By(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(e,t)=>(t.convertMeshToIndexed&&e.modelObject?.traverse((e=>{e.geometry&&(e.geometry.attributes.index||e.setGeometry?.(Z(e.geometry)))})),e)})}async onRemove(e){return super.onRemove(e)}async exportScene(e){return this.exporter?.exportObject(this._viewer?.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){const n=this._viewer?.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):this._viewer?.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",(e=>{"function"==typeof e.plugin?.toJSON&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")}));const n=Object.entries(e.plugins).filter((([e,t])=>"function"==typeof t?.toJSON&&!1!==t?.serializeWithViewer)).map((([e,t])=>({label:e,type:"checkbox",value:!0})));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(ky).map((([e,t])=>({label:e,value:t})))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map((e=>({label:e})))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map((e=>({type:"slider",label:e,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,e]})))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>this._uiConfig?.uiRefresh?.("postFrame",!0)},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:n},{type:"button",label:"Select none",value:()=>{n.forEach((e=>{e.value=!1,e.uiRefresh?.()}))}},{type:"button",label:"Select all",value:()=>{n.forEach((e=>{e.value=!0,e.uiRefresh?.()}))}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const r=new Blob([JSON.stringify(e.getPlugin(fo).exportPluginPresets(n.filter((e=>!!e.value)).map((e=>(0,t.getOrCall)(e.label)||""))),null,2)],{type:"application/json"});r&&await this._downloadBlob(r,this.exportOptions.name+"."+fo.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const t=new Blob([JSON.stringify(e.getPlugin(fo).exportViewerConfig(!1),null,2)],{type:"application/json"});t&&await this._downloadBlob(t,this.exportOptions.name+"."+fo.ViewerTypeSlug)}}]}]}}}Oy.PluginType="AssetExporterPlugin",function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);s>3&&o&&Object.defineProperty(t,n,o)}([Oe()],Oy.prototype,"exportOptions",void 0);class Ly{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Fy extends Ly{constructor(e,t,n,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=r,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Uy extends Ly{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter((e=>t(e.getParent())))),n.forEach((e=>e.dispose())),this}createEdge(e,t,n,r){return this._registerEdge(new Fy(e,t,n,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Ny(){return Ny=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ny.apply(this,arguments)}function jy(e){return e instanceof Fy}function zy(e){return Array.isArray(e)&&e[0]instanceof Fy}function Gy(e){return!!(function(e){return Boolean(e)&&Object.getPrototypeOf(e)===Object.prototype}(e)&&function(e){for(const t in e)return e[t]}(e)instanceof Fy)}const Vy=Symbol("attributes"),Hy=Symbol("immutableKeys");class Qy extends Ly{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Vy]=void 0,this[Hy]=void 0,this.graph=e,this[Hy]=new Set,this[Vy]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const r=e[n];if(r instanceof Qy){const e=this.graph.createEdge(n,this,r);e.addEventListener("dispose",(()=>r.dispose())),this[Hy].add(n),t[n]=e}else t[n]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[Vy]){const r=this[Vy][n];if(jy(r)){const i=r;i.getChild()===e&&this.setRef(n,t,i.getAttributes())}else if(zy(r)){const i=r.find((t=>t.getChild()===e));if(i){const r=i.getAttributes();this.removeRef(n,e).addRef(n,t,r)}}else if(Gy(r)){const i=r;for(const r in i){const s=i[r];s.getChild()===e&&this.setRefMap(n,r,t,s.getAttributes())}}}return this}get(e){return this[Vy][e]}set(e,t){return this[Vy][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[Vy][e];return t?t.getChild():null}setRef(e,t,n){if(this[Hy].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[Vy][e];if(r&&r.dispose(),!t)return this;const i=this.graph.createEdge(e,this,t,n);return i.addEventListener("dispose",(()=>{delete this[Vy][e],this.dispatchEvent({type:"change",attribute:e})})),this[Vy][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Vy][e].map((e=>e.getChild()))}addRef(e,t,n){const r=this.graph.createEdge(e,this,t,n),i=this[Vy][e];return i.push(r),r.addEventListener("dispose",(()=>{const t=i.filter((e=>e!==r));i.length=0;for(const e of t)i.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[Vy][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[Vy][e])}listRefMapValues(e){return Object.values(this[Vy][e]).map((e=>e.getChild()))}getRefMap(e,t){const n=this[Vy][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,r){const i=this[Vy][e],s=i[t];if(s&&s.dispose(),!n)return this;r=Object.assign(r||{},{key:t});const o=this.graph.createEdge(e,this,n,Ny({},r,{key:t}));return o.addEventListener("dispose",(()=>{delete i[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),i[t]=o,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(Ny({},e,{target:this})),this.graph.dispatchEvent(Ny({},e,{target:this,type:`node:${e.type}`})),this}}const Wy="@glb.bin";var qy,Xy,Yy,Ky,Jy;!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(qy||(qy={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(Xy||(Xy={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER",e.SPARSE="SPARSE"}(Yy||(Yy={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(Ky||(Ky={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(Jy||(Jy={}));const Zy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var $y,eb,tb="undefined"!=typeof Float32Array?Float32Array:Array;function nb(e){return Math.hypot(e[0],e[1],e[2])}function rb(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/(o=o||1),e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,e}function ib(e,t){const n={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const r of e.listPrimitives()){const e=r.getAttribute("POSITION");if(!e)continue;let i=[0,0,0],s=[0,0,0];for(let r=0;r<e.getCount();r++)i=e.getElement(r,i),s=rb(s,i,t),sb(s,n)}return n}function sb(e,t){for(let n=0;n<3;n++)t.min[n]=Math.min(e[n],t.min[n]),t.max[n]=Math.max(e[n],t.max[n])}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),$y=new tb(3),tb!=Float32Array&&($y[0]=0,$y[1]=0,$y[2]=0);class ob{static createBufferFromDataURI(e){if("undefined"==typeof Buffer){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const n of e)t+=n.byteLength;const n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const r=new Uint8Array(n);if(r.set(e),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class ab{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,r,i]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*r<<8^255*i<<0}static convertSRGBToLinear(e,t){const n=e,r=t;for(let e=0;e<3;e++)r[e]=n[e]<.04045?.0773993808*n[e]:Math.pow(.9478672986*n[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,r=t;for(let e=0;e<3;e++)r[e]=n[e]<.0031308?12.92*n[e]:1.055*Math.pow(n[e],.41666)-.055;return t}}class lb{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return ob.decodeText(e.slice(12,16))===lb.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}lb.PNG_FRIED_CHUNK_NAME="CgBI";class cb{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)n+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":e?`image/${e}`:""}}function ub(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}cb.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,n,r=new DataView(e.buffer,e.byteOffset+4);for(;r.byteLength;){if(t=r.getUint16(0,!1),ub(r,t),n=r.getUint8(t+1),192===n||193===n||194===n)return[r.getUint16(t+7,!1),r.getUint16(t+5,!1)];r=new DataView(e.buffer,r.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new lb};class hb{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return cb.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function pb(e){return"[object Object]"===Object.prototype.toString.call(e)}function db(e){if(!1===pb(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!1!==pb(n)&&!1!==Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")}!function(e){e[e.SILENT=4]="SILENT",e[e.ERROR=3]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=1]="INFO",e[e.DEBUG=0]="DEBUG"}(eb||(eb={}));class fb{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=fb.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=fb.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=fb.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=fb.Verbosity.ERROR&&console.error(e)}}function mb(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],A=n[2],w=n[3];return e[0]=y*r+b*a+A*h+w*m,e[1]=y*i+b*l+A*p+w*g,e[2]=y*s+b*c+A*d+w*_,e[3]=y*o+b*u+A*f+w*v,e[4]=(y=n[4])*r+(b=n[5])*a+(A=n[6])*h+(w=n[7])*m,e[5]=y*i+b*l+A*p+w*g,e[6]=y*s+b*c+A*d+w*_,e[7]=y*o+b*u+A*f+w*v,e[8]=(y=n[8])*r+(b=n[9])*a+(A=n[10])*h+(w=n[11])*m,e[9]=y*i+b*l+A*p+w*g,e[10]=y*s+b*c+A*d+w*_,e[11]=y*o+b*u+A*f+w*v,e[12]=(y=n[12])*r+(b=n[13])*a+(A=n[14])*h+(w=n[15])*m,e[13]=y*i+b*l+A*p+w*g,e[14]=y*s+b*c+A*d+w*_,e[15]=y*o+b*u+A*f+w*v,e}fb.Verbosity=eb,fb.DEFAULT_INSTANCE=new fb(fb.Verbosity.INFO);class gb{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return gb.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return gb.encodeNormalizedInt(e,t)}static decompose(e,t,n,r){let i=nb([e[0],e[1],e[2]]);const s=nb([e[4],e[5],e[6]]),o=nb([e[8],e[9],e[10]]);var a,l,c,u,h,p,d,f,m,g,_,v,y,b,A,w,x;((l=(a=e)[0])*(d=a[5])-(c=a[1])*(p=a[4]))*((v=a[10])*(x=a[15])-(y=a[11])*(w=a[14]))-(l*(f=a[6])-(u=a[2])*p)*((_=a[9])*x-y*(A=a[13]))+(l*(m=a[7])-(h=a[3])*p)*(_*w-v*A)+(c*f-u*d)*((g=a[8])*x-y*(b=a[12]))-(c*m-h*d)*(g*w-v*b)+(u*m-h*f)*(g*A-_*b)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14];const E=e.slice(),C=1/i,S=1/s,M=1/o;E[0]*=C,E[1]*=C,E[2]*=C,E[4]*=S,E[5]*=S,E[6]*=S,E[8]*=M,E[9]*=M,E[10]*=M,function(e,t){var n=new tb(3);!function(e,t){var n=t[4],r=t[5],i=t[6],s=t[8],o=t[9],a=t[10];e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,r,i),e[2]=Math.hypot(s,o,a)}(n,t);var r=1/n[0],i=1/n[1],s=1/n[2],o=t[0]*r,a=t[1]*i,l=t[2]*s,c=t[4]*r,u=t[5]*i,h=t[6]*s,p=t[8]*r,d=t[9]*i,f=t[10]*s,m=o+u+f,g=0;m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-d)/g,e[1]=(p-l)/g,e[2]=(a-c)/g):o>u&&o>f?(g=2*Math.sqrt(1+o-u-f),e[3]=(h-d)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(p+l)/g):u>f?(g=2*Math.sqrt(1+u-o-f),e[3]=(p-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(h+d)/g):(g=2*Math.sqrt(1+f-o-u),e[3]=(a-c)/g,e[0]=(p+l)/g,e[1]=(h+d)/g,e[2]=.25*g)}(n,E),r[0]=i,r[1]=s,r[2]=o}static compose(e,t,n,r){const i=r,s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,h=a+a,p=s*c,d=s*u,f=s*h,m=o*u,g=o*h,_=a*h,v=l*c,y=l*u,b=l*h,A=n[0],w=n[1],x=n[2];return i[0]=(1-(m+_))*A,i[1]=(d+b)*A,i[2]=(f-y)*A,i[3]=0,i[4]=(d-b)*w,i[5]=(1-(p+_))*w,i[6]=(g+v)*w,i[7]=0,i[8]=(f+y)*x,i[9]=(g-v)*x,i[10]=(1-(p+m))*x,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function _b(e,t){if(!!e!=!!t)return!1;const n=e.getChild(),r=t.getChild();return n===r||n.equals(r)}function vb(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r.getChild()!==i.getChild()&&!r.getChild().equals(i.getChild()))return!1}return!0}function yb(e,t){if(!!e!=!!t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const n in e){const r=e[n],i=t[n];if(!!r!=!!i)return!1;const s=r.getChild(),o=i.getChild();if(s!==o&&!s.equals(o))return!1}return!0}function bb(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ab(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!db(e)||!db(t))return e===t;const n=e,r=t;let i,s=0,o=0;for(i in n)s++;for(i in r)o++;if(s!==o)return!1;for(i in n){const e=n[i],t=r[i];if(wb(e)&&wb(t)){if(!bb(e,t))return!1}else if(db(e)&&db(t)){if(!Ab(e,t))return!1}else if(e!==t)return!1}return!0}function wb(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const xb="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",Eb=new Set,Cb=function(){let e="";for(let t=0;t<6;t++)e+=xb.charAt(Math.floor(42*Math.random()));return e};class Sb{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return hb.basename(new URL(e,"https://null.example").pathname)}static extension(e){return hb.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),r=t.split("/");n.pop();for(let e=0;e<r.length;e++)"."!==r[e]&&(".."===r[e]?n.pop():n.push(r[e]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Sb.DEFAULT_INIT={},Sb.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Mb=e=>e,Tb=new Set;class Db extends Qy{constructor(e,t=""){super(e),this[Vy].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,Mb)}copy(e,t=Mb){for(const e in this[Vy]){const t=this[Vy][e];if(t instanceof Fy)this[Hy].has(e)||t.dispose();else if(zy(t))for(const e of t)e.dispose();else if(Gy(t))for(const e in t)t[e].dispose()}for(const n in e[Vy]){const r=this[Vy][n],i=e[Vy][n];if(i instanceof Fy)this[Hy].has(n)?r.getChild().copy(t(i.getChild()),t):this.setRef(n,t(i.getChild()),i.getAttributes());else if(zy(i))for(const e of i)this.addRef(n,t(e.getChild()),e.getAttributes());else if(Gy(i))for(const e in i){const r=i[e];this.setRefMap(n,e,t(r.getChild()),r.getAttributes())}else this[Vy][n]=db(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(e,t=Tb){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Vy]){if(t.has(n))continue;const r=this[Vy][n],i=e[Vy][n];if(jy(r)||jy(i)){if(!_b(r,i))return!1}else if(zy(r)||zy(i)){if(!vb(r,i))return!1}else if(Gy(r)||Gy(i)){if(!yb(r,i))return!1}else if(db(r)||db(i)){if(!Ab(r,i))return!1}else if(wb(r)||wb(i)){if(!bb(r,i))return!1}else if(r!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class Ib extends Db{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Pb extends Ib{constructor(...e){super(...e),this.i=gb.identity,this.o=gb.identity}init(){this.propertyType=qy.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Pb.Type.SCALAR,componentType:Pb.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=Mb){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Pb.Type.SCALAR:return 1;case Pb.Type.VEC2:return 2;case Pb.Type.VEC3:return 3;case Pb.Type.VEC4:case Pb.Type.MAT2:return 4;case Pb.Type.MAT3:return 9;case Pb.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Pb.ComponentType.BYTE:case Pb.ComponentType.UNSIGNED_BYTE:return 1;case Pb.ComponentType.SHORT:case Pb.ComponentType.UNSIGNED_SHORT:return 2;case Pb.ComponentType.UNSIGNED_INT:case Pb.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let t=0;t<r;t++)e[t]=1/0;for(let i=0;i<n*r;i+=r)for(let n=0;n<r;n++){const r=t[i+n];Number.isFinite(r)&&(e[n]=Math.min(e[n],r))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let t=0;t<r;t++)e[t]=-1/0;for(let i=0;i<n*r;i+=r)for(let n=0;n<r;n++){const r=t[i+n];Number.isFinite(r)&&(e[n]=Math.max(e[n],r))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Pb.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>gb.decodeNormalizedInt(e,this.get("componentType")),this.i=e=>gb.encodeNormalizedInt(e,this.get("componentType"))):(this.o=gb.identity,this.i=gb.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let i=0;i<n;i++)t[i]=this.o(r[e*n+i]);return t}setElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let i=0;i<n;i++)r[e*n+i]=this.i(t[i]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return Pb.ComponentType.FLOAT;case Uint32Array:return Pb.ComponentType.UNSIGNED_INT;case Uint16Array:return Pb.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Pb.ComponentType.UNSIGNED_BYTE;case Int16Array:return Pb.ComponentType.SHORT;case Int8Array:return Pb.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Pb.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Pb.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Pb.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Rb extends Ib{init(){this.propertyType=qy.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Bb extends Ib{init(){this.propertyType=qy.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Bb.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class kb extends Ib{init(){this.propertyType=qy.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:kb.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Yy.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Yy.OTHER})}}kb.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Ob extends Ib{init(){this.propertyType=qy.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Lb extends Ib{init(){this.propertyType=qy.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Lb.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Lb.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Fb extends Db{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Fb.EXTENSION_NAME=void 0;class Ub extends Ib{init(){this.propertyType=qy.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ub.WrapMode.REPEAT,wrapT:Ub.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ub.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Ub.MagFilter={NEAREST:9728,LINEAR:9729},Ub.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Nb,G:jb,B:zb,A:Gb}=Ky;class Vb extends Ib{init(){this.propertyType=qy.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Vb.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ub(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ub(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ub(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ub(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ub(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return ab.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",ab.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Nb|jb|zb|Gb})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return ab.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",ab.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Nb|jb|zb})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Nb|jb|zb})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Nb})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:jb|zb})}}Vb.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Hb extends Ib{init(){this.propertyType=qy.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Qb extends Ib{constructor(...e){super(...e),this.u=null}init(){this.propertyType=qy.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Mb){if(t===Mb)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return gb.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),r=this.get("scale").slice();return gb.decompose(e,t,n,r),this.set("translation",t).set("rotation",n).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return gb.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return gb.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return gb.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;null!=t;t=t.u)e.push(t);let t;const n=e.pop().getMatrix();for(;t=e.pop();)mb(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[Vy].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find((e=>e.propertyType===qy.SCENE))||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Wb extends Ib{init(){this.propertyType=qy.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Wb.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Yy.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Yy.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Wb.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class qb extends Db{init(){this.propertyType=qy.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Yy.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Xb(){return(Xb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}class Yb extends Ib{init(){this.propertyType=qy.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Mb){if(t===Mb)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class Kb extends Ib{init(){this.propertyType=qy.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Yy.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Jb extends Ib{init(){this.propertyType=qy.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||cb.extensionToMimeType(hb.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=cb.extensionToMimeType(hb.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",ob.assertView(e))}getSize(){const e=this.get("image");return e?cb.getSize(e,this.getMimeType()):null}}class Zb extends Ib{init(){this.propertyType=qy.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Mb){if(t===Mb)throw new Error("Root cannot be copied.");this.set("asset",Xb({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Xb({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const r=e.getExtension(n);this.setExtension(n,t(r))}return this}l(e){return e instanceof Yb?this.addRef("scenes",e):e instanceof Qb?this.addRef("nodes",e):e instanceof Lb?this.addRef("cameras",e):e instanceof Kb?this.addRef("skins",e):e instanceof Hb?this.addRef("meshes",e):e instanceof Vb?this.addRef("materials",e):e instanceof Jb?this.addRef("textures",e):e instanceof Rb?this.addRef("animations",e):e instanceof Pb?this.addRef("accessors",e):e instanceof Ob&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class $b{static fromGraph(e){return $b.m.get(e)||null}constructor(){this.v=new Uy,this.T=new Zb(this.v),this.M=fb.DEFAULT_INSTANCE,$b.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return(new $b).setLogger(this.M).merge(this)}merge(e){for(const t of e.getRoot().listExtensionsUsed()){const e=this.createExtension(t.constructor);t.isRequired()&&e.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const r of e.v.listEdges())for(const e of[r.getParent(),r.getChild()]){if(t.has(e))continue;let r;r=e.propertyType===qy.TEXTURE_INFO?e:new(0,e.constructor)(this.v),n.set(e,r),t.add(e)}const r=e=>{const t=n.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const e of t){const t=n.get(e);if(!t)throw new Error("Could resolve property.");t.propertyType!==qy.TEXTURE_INFO&&t.copy(e,r)}return this}async transform(...e){const t=e.map((e=>e.name));for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new Yb(this.v,e)}createNode(e=""){return new Qb(this.v,e)}createCamera(e=""){return new Lb(this.v,e)}createSkin(e=""){return new Kb(this.v,e)}createMesh(e=""){return new Hb(this.v,e)}createPrimitive(){return new Wb(this.v)}createPrimitiveTarget(e=""){return new qb(this.v,e)}createMaterial(e=""){return new Vb(this.v,e)}createTexture(e=""){return new Jb(this.v,e)}createAnimation(e=""){return new Rb(this.v,e)}createAnimationChannel(e=""){return new Bb(this.v,e)}createAnimationSampler(e=""){return new kb(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Pb(this.v,e).setBuffer(t)}createBuffer(e=""){return new Ob(this.v,e)}}$b.m=new WeakMap;class eA{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,n=t.target;n instanceof Fb&&n.extensionName===this.extensionName&&("node:create"===t.type&&this.I(n),"node:dispose"===t.type&&this.N(n))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}eA.EXTENSION_NAME=void 0;class tA{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord),void 0!==t.extras&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(void 0===n.sampler)return;const r=this.jsonDoc.json.samplers[n.sampler];void 0!==r.magFilter&&e.setMagFilter(r.magFilter),void 0!==r.minFilter&&e.setMinFilter(r.minFilter),void 0!==r.wrapS&&e.setWrapS(r.wrapS),void 0!==r.wrapT&&e.setWrapT(r.wrapT)}}const nA={logger:fb.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function rA(e,t){const n=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],i=Zy[e.componentType],s=Pb.getElementSize(e.type),o=i.BYTES_PER_ELEMENT;if(void 0!==r.byteStride&&r.byteStride!==s*o)return function(e,t){const n=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],i=Zy[e.componentType],s=Pb.getElementSize(e.type),o=i.BYTES_PER_ELEMENT,a=e.byteOffset||0,l=new i(e.count*s),c=new DataView(n.buffer,n.byteOffset,n.byteLength),u=r.byteStride;for(let t=0;t<e.count;t++)for(let n=0;n<s;n++){const r=a+t*u+n*o;let i;switch(e.componentType){case Pb.ComponentType.FLOAT:i=c.getFloat32(r,!0);break;case Pb.ComponentType.UNSIGNED_INT:i=c.getUint32(r,!0);break;case Pb.ComponentType.UNSIGNED_SHORT:i=c.getUint16(r,!0);break;case Pb.ComponentType.UNSIGNED_BYTE:i=c.getUint8(r);break;case Pb.ComponentType.SHORT:i=c.getInt16(r,!0);break;case Pb.ComponentType.BYTE:i=c.getInt8(r);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}l[t*s+n]=i}return l}(e,t);const a=n.byteOffset+(e.byteOffset||0);return new i(n.buffer.slice(a,a+e.count*s*o))}var iA;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(iA||(iA={}));class sA{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const r=e.getRoot(),i=r.listBuffers().length,s=r.listTextures().length;this.bufferURIGenerator=new oA(i>1,(()=>n.basename||"buffer")),this.imageURIGenerator=new oA(s>1,(t=>function(e,t){const n=e.getGraph().listParentEdges(t).find((t=>t.getParent()!==e.getRoot()));return n?n.getName().replace(/texture$/i,""):""}(e,t)||n.basename||"texture")),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(n);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},s=JSON.stringify(i);this.textureDefIndexMap.has(s)||(this.textureDefIndexMap.set(s,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(s)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(o.extras=t.getExtras()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===Jy.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=cb.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Yy.SPARSE;for(const t of this.O.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==qy.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return Yy.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}sA.BufferViewTarget=iA,sA.BufferViewUsage=Yy,sA.USAGE_TO_TARGET={[Yy.ARRAY_BUFFER]:iA.ARRAY_BUFFER,[Yy.ELEMENT_ARRAY_BUFFER]:iA.ELEMENT_ARRAY_BUFFER};class oA{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:aA}=sA,{UNSIGNED_INT:lA,UNSIGNED_SHORT:cA,UNSIGNED_BYTE:uA}=Pb.ComponentType;var hA;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(hA||(hA={}));class pA{constructor(){this.M=fb.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=Xy.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=dA(t)?this.P(t):{json:JSON.parse(ob.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),class{static read(e,t=nA){const n=Xb({},nA,t),{json:r}=e,i=(new $b).setLogger(n.logger);this.validate(e,n);const s=new tA(e),o=r.asset,a=i.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==r.extras&&i.getRoot().setExtras(Xb({},r.extras));const l=r.extensionsUsed||[],c=r.extensionsRequired||[];for(const e of n.extensions)if(l.includes(e.EXTENSION_NAME)){const t=i.createExtension(e).setRequired(c.includes(e.EXTENSION_NAME));for(const e of t.readDependencies)t.install(e,n.dependencies[e])}const u=r.buffers||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(qy.BUFFER))).forEach((e=>e.preread(s,qy.BUFFER))),s.buffers=u.map((e=>{const t=i.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),s.bufferViewBuffers=(r.bufferViews||[]).map(((t,n)=>{if(!s.bufferViews[n]){const r=e.json.buffers[t.buffer];s.bufferViews[n]=ob.toView(r.uri?e.resources[r.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return s.buffers[t.buffer]}));const h=r.accessors||[];s.accessors=h.map((e=>{const t=i.createAccessor(e.name,s.bufferViewBuffers[e.bufferView]).setType(e.type);return e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView||t.setArray(rA(e,s)),t}));const p=r.images||[],d=r.textures||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(qy.TEXTURE))).forEach((e=>e.preread(s,qy.TEXTURE))),s.textures=p.map((t=>{const n=i.createTexture(t.name);if(t.extras&&n.setExtras(t.extras),void 0!==t.bufferView){const i=r.bufferViews[t.bufferView],s=e.json.buffers[i.buffer],o=i.byteOffset||0,a=(s.uri?e.resources[s.uri]:e.resources["@glb.bin"]).slice(o,o+i.byteLength);n.setImage(a)}else void 0!==t.uri&&(n.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&n.setURI(t.uri));if(void 0!==t.mimeType)n.setMimeType(t.mimeType);else if(t.uri){const e=hb.extension(t.uri);n.setMimeType(cb.extensionToMimeType(e))}return n})),s.materials=(r.materials||[]).map((e=>{const t=i.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const n=e.pbrMetallicRoughness||{};if(void 0!==n.baseColorFactor&&t.setBaseColorFactor(n.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==n.metallicFactor&&t.setMetallicFactor(n.metallicFactor),void 0!==n.roughnessFactor&&t.setRoughnessFactor(n.roughnessFactor),void 0!==n.baseColorTexture){const e=n.baseColorTexture;t.setBaseColorTexture(s.textures[d[e.index].source]),s.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const n=e.emissiveTexture;t.setEmissiveTexture(s.textures[d[n.index].source]),s.setTextureInfo(t.getEmissiveTextureInfo(),n)}if(void 0!==e.normalTexture){const n=e.normalTexture;t.setNormalTexture(s.textures[d[n.index].source]),s.setTextureInfo(t.getNormalTextureInfo(),n),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const n=e.occlusionTexture;t.setOcclusionTexture(s.textures[d[n.index].source]),s.setTextureInfo(t.getOcclusionTextureInfo(),n),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==n.metallicRoughnessTexture){const e=n.metallicRoughnessTexture;t.setMetallicRoughnessTexture(s.textures[d[e.index].source]),s.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const f=r.meshes||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(qy.PRIMITIVE))).forEach((e=>e.preread(s,qy.PRIMITIVE))),s.meshes=f.map((e=>{const t=i.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((n=>{const r=i.createPrimitive();n.extras&&r.setExtras(n.extras),void 0!==n.material&&r.setMaterial(s.materials[n.material]),void 0!==n.mode&&r.setMode(n.mode);for(const[e,t]of Object.entries(n.attributes||{}))r.setAttribute(e,s.accessors[t]);void 0!==n.indices&&r.setIndices(s.accessors[n.indices]);const o=e.extras&&e.extras.targetNames||[];(n.targets||[]).forEach(((e,t)=>{const n=o[t]||t.toString(),a=i.createPrimitiveTarget(n);for(const[t,n]of Object.entries(e))a.setAttribute(t,s.accessors[n]);r.addTarget(a)})),t.addPrimitive(r)})),t})),s.cameras=(r.cameras||[]).map((e=>{const t=i.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===Lb.Type.PERSPECTIVE){const n=e.perspective;t.setYFov(n.yfov),t.setZNear(n.znear),void 0!==n.zfar&&t.setZFar(n.zfar),void 0!==n.aspectRatio&&t.setAspectRatio(n.aspectRatio)}else{const n=e.orthographic;t.setZNear(n.znear).setZFar(n.zfar).setXMag(n.xmag).setYMag(n.ymag)}return t}));const m=r.nodes||[];i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(qy.NODE))).forEach((e=>e.preread(s,qy.NODE))),s.nodes=m.map((e=>{const t=i.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const n=[0,0,0],r=[0,0,0,1],i=[1,1,1];gb.decompose(e.matrix,n,r,i),t.setTranslation(n),t.setRotation(r),t.setScale(i)}return void 0!==e.weights&&t.setWeights(e.weights),t})),s.skins=(r.skins||[]).map((e=>{const t=i.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(s.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(s.nodes[e.skeleton]);for(const n of e.joints)t.addJoint(s.nodes[n]);return t})),m.map(((e,t)=>{const n=s.nodes[t];(e.children||[]).forEach((e=>n.addChild(s.nodes[e]))),void 0!==e.mesh&&n.setMesh(s.meshes[e.mesh]),void 0!==e.camera&&n.setCamera(s.cameras[e.camera]),void 0!==e.skin&&n.setSkin(s.skins[e.skin])})),s.animations=(r.animations||[]).map((e=>{const t=i.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const n=(e.samplers||[]).map((e=>{const n=i.createAnimationSampler().setInput(s.accessors[e.input]).setOutput(s.accessors[e.output]).setInterpolation(e.interpolation||kb.Interpolation.LINEAR);return e.extras&&n.setExtras(e.extras),t.addSampler(n),n}));return(e.channels||[]).forEach((e=>{const r=i.createAnimationChannel().setSampler(n[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&r.setTargetNode(s.nodes[e.target.node]),e.extras&&r.setExtras(e.extras),t.addChannel(r)})),t}));const g=r.scenes||[];return i.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(qy.SCENE))).forEach((e=>e.preread(s,qy.SCENE))),s.scenes=g.map((e=>{const t=i.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>s.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==r.scene&&i.getRoot().setDefaultScene(s.scenes[r.scene]),i.getRoot().listExtensionsUsed().forEach((e=>e.read(s))),h.forEach(((e,t)=>{const n=s.accessors[t],r=!!e.sparse,i=!e.bufferView&&!n.getArray();(r||i)&&n.setSparse(!0).setArray(function(e,t){const n=Zy[e.componentType],r=Pb.getElementSize(e.type);let i;i=void 0!==e.bufferView?rA(e,t):new n(e.count*r);const s=e.sparse;if(!s)return i;const o=s.count,a=Xb({},e,s.indices,{count:o,type:"SCALAR"}),l=Xb({},e,s.values,{count:o}),c=rA(a,t),u=rA(l,t);for(let e=0;e<a.count;e++)for(let t=0;t<r;t++)i[c[e]*r+t]=u[e*r+t];return i}(e,s))})),i}static validate(e,t){const n=e.json;if("2.0"!==n.asset.version)throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired)for(const e of n.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(n.extensionsUsed)for(const e of n.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(ob.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(ob.assertView(e)))}async writeJSON(e,t={}){if(t.format===Jy.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(e,t){const n=e.getRoot(),r={asset:Xb({generator:"glTF-Transform v3.2.1"},n.getAsset()),extras:Xb({},n.getExtras())},i={json:r,resources:{}},s=new sA(e,i,t),o=t.logger||fb.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),l=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),c=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));l.length<e.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const e of l)for(const n of e.writeDependencies)e.install(n,t.dependencies[n]);function u(e,t,n,i){const o=[];let a=0;for(const t of e){const e=s.createAccessorDef(t);e.bufferView=r.bufferViews.length;const n=t.getArray(),i=ob.pad(ob.toView(n));e.byteOffset=a,a+=i.byteLength,o.push(i),s.accessorIndexMap.set(t,r.accessors.length),r.accessors.push(e)}const l={buffer:t,byteOffset:n,byteLength:ob.concat(o).byteLength};return i&&(l.target=i),r.bufferViews.push(l),{buffers:o,byteLength:a}}function h(e,t,n){const i=e[0].getCount();let o=0;for(const t of e){const e=s.createAccessorDef(t);e.bufferView=r.bufferViews.length,e.byteOffset=o;const n=t.getElementSize(),i=t.getComponentSize();o+=ob.padNumber(n*i),s.accessorIndexMap.set(t,r.accessors.length),r.accessors.push(e)}const a=i*o,l=new ArrayBuffer(a),c=new DataView(l);for(let t=0;t<i;t++){let n=0;for(const r of e){const e=r.getElementSize(),i=r.getComponentSize(),s=r.getComponentType(),a=r.getArray();for(let r=0;r<e;r++){const l=t*o+n+r*i,u=a[t*e+r];switch(s){case Pb.ComponentType.FLOAT:c.setFloat32(l,u,!0);break;case Pb.ComponentType.BYTE:c.setInt8(l,u);break;case Pb.ComponentType.SHORT:c.setInt16(l,u,!0);break;case Pb.ComponentType.UNSIGNED_BYTE:c.setUint8(l,u);break;case Pb.ComponentType.UNSIGNED_SHORT:c.setUint16(l,u,!0);break;case Pb.ComponentType.UNSIGNED_INT:c.setUint32(l,u,!0);break;default:throw new Error("Unexpected component type: "+s)}}n+=ob.padNumber(e*i)}}return r.bufferViews.push({buffer:t,byteOffset:n,byteLength:a,byteStride:o,target:sA.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(l)]}}function p(e,t,n){const i=[];let a=0;const l=new Map;let c=-1/0;for(const t of e){const e=s.createAccessorDef(t);r.accessors.push(e),s.accessorIndexMap.set(t,r.accessors.length-1);const n=[],i=[],a=[],u=new Array(t.getElementSize()).fill(0);for(let e=0,r=t.getCount();e<r;e++)if(t.getElement(e,a),!gb.eq(a,u,0)){c=Math.max(e,c),n.push(e);for(let e=0;e<a.length;e++)i.push(a[e])}const h=n.length,p={accessorDef:e,count:h};if(l.set(t,p),0===h)continue;if(h>t.getCount()/3){const e=(100*n.length/t.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${e}%) may increase file size.`)}const d=Zy[t.getComponentType()];p.indices=n,p.values=new d(i)}if(!Number.isFinite(c))return{buffers:i,byteLength:a};const u=c<255?Uint8Array:c<65535?Uint16Array:Uint32Array,h=c<255?uA:c<65535?cA:lA,p={buffer:t,byteOffset:n+a,byteLength:0};for(const t of e){const e=l.get(t);if(0===e.count)continue;e.indicesByteOffset=p.byteLength;const n=ob.pad(ob.toView(new u(e.indices)));i.push(n),a+=n.byteLength,p.byteLength+=n.byteLength}r.bufferViews.push(p);const d=r.bufferViews.length-1,f={buffer:t,byteOffset:n+a,byteLength:0};for(const t of e){const e=l.get(t);if(0===e.count)continue;e.valuesByteOffset=f.byteLength;const n=ob.pad(ob.toView(e.values));i.push(n),a+=n.byteLength,f.byteLength+=n.byteLength}r.bufferViews.push(f);const m=r.bufferViews.length-1;for(const t of e){const e=l.get(t);0!==e.count&&(e.accessorDef.sparse={count:e.count,indices:{bufferView:d,byteOffset:e.indicesByteOffset,componentType:h},values:{bufferView:m,byteOffset:e.valuesByteOffset}})}return{buffers:i,byteLength:a}}const d=new Map;for(const t of e.getGraph().listEdges()){if(t.getParent()===n)continue;const e=t.getChild();if(e instanceof Pb){const n=d.get(e)||[];n.push(t),d.set(e,n)}}if(r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=n.listTextures().map(((e,t)=>{const n=s.createPropertyDef(e);e.getMimeType()&&(n.mimeType=e.getMimeType());const r=e.getImage();return r&&s.createImageData(n,r,e),s.imageIndexMap.set(e,t),n})),l.filter((e=>e.prewriteTypes.includes(qy.ACCESSOR))).forEach((e=>e.prewrite(s,qy.ACCESSOR))),n.listAccessors().forEach((e=>{const t=s.accessorUsageGroupedByParent,n=s.accessorParents;if(s.accessorIndexMap.has(e))return;const r=d.get(e)||[],i=s.getAccessorUsage(e);if(s.addAccessorToUsageGroup(e,i),t.has(i)){const t=r[0].getParent(),i=n.get(t)||new Set;i.add(e),n.set(t,i)}})),l.filter((e=>e.prewriteTypes.includes(qy.BUFFER))).forEach((e=>e.prewrite(s,qy.BUFFER))),(n.listAccessors().length>0||n.listTextures().length>0||s.otherBufferViews.size>0)&&0===n.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");r.buffers=[],n.listBuffers().forEach(((e,n)=>{const o=s.createPropertyDef(e),a=s.accessorUsageGroupedByParent,l=s.accessorParents,c=e.listParents().filter((e=>e instanceof Pb)),d=new Set(c),f=[],m=r.buffers.length;let g=0;const _=s.listAccessorUsageGroups();for(const e in _)if(a.has(e))for(const n of Array.from(l.values())){const r=Array.from(n).filter((e=>d.has(e))).filter((t=>s.getAccessorUsage(t)===e));if(r.length)if(e!==aA.ARRAY_BUFFER||t.vertexLayout===Xy.INTERLEAVED){const t=e===aA.ARRAY_BUFFER?h(r,m,g):u(r,m,g);g+=t.byteLength,f.push(...t.buffers)}else for(const e of r){const t=h([e],m,g);g+=t.byteLength,f.push(...t.buffers)}}else{const t=_[e].filter((e=>d.has(e)));if(!t.length)continue;const n=e===aA.ELEMENT_ARRAY_BUFFER?sA.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,r=e===aA.SPARSE?p(t,m,g):u(t,m,g,n);g+=r.byteLength,f.push(...r.buffers)}if(s.imageBufferViews.length&&0===n)for(let e=0;e<s.imageBufferViews.length;e++)if(r.bufferViews[r.images[e].bufferView].byteOffset=g,g+=s.imageBufferViews[e].byteLength,f.push(s.imageBufferViews[e]),g%8){const e=8-g%8;g+=e,f.push(new Uint8Array(e))}if(s.otherBufferViews.has(e))for(const t of s.otherBufferViews.get(e))r.bufferViews.push({buffer:m,byteOffset:g,byteLength:t.byteLength}),s.otherBufferViewsIndexMap.set(t,r.bufferViews.length-1),g+=t.byteLength,f.push(t);if(g){let n;t.format===Jy.GLB?n="@glb.bin":(n=s.bufferURIGenerator.createURI(e,"bin"),o.uri=n),o.byteLength=g,i.resources[n]=ob.concat(f)}r.buffers.push(o),s.bufferIndexMap.set(e,n)})),n.listAccessors().find((e=>!e.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),r.materials=n.listMaterials().map(((e,t)=>{const n=s.createPropertyDef(e);if(e.getAlphaMode()!==Vb.AlphaMode.OPAQUE&&(n.alphaMode=e.getAlphaMode()),e.getAlphaMode()===Vb.AlphaMode.MASK&&(n.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(n.doubleSided=!0),n.pbrMetallicRoughness={},gb.eq(e.getBaseColorFactor(),[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),gb.eq(e.getEmissiveFactor(),[0,0,0])||(n.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(n.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(n.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),r=e.getBaseColorTextureInfo();n.pbrMetallicRoughness.baseColorTexture=s.createTextureInfoDef(t,r)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),r=e.getEmissiveTextureInfo();n.emissiveTexture=s.createTextureInfoDef(t,r)}if(e.getNormalTexture()){const t=e.getNormalTexture(),r=e.getNormalTextureInfo(),i=s.createTextureInfoDef(t,r);1!==e.getNormalScale()&&(i.scale=e.getNormalScale()),n.normalTexture=i}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),r=e.getOcclusionTextureInfo(),i=s.createTextureInfoDef(t,r);1!==e.getOcclusionStrength()&&(i.strength=e.getOcclusionStrength()),n.occlusionTexture=i}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),r=e.getMetallicRoughnessTextureInfo();n.pbrMetallicRoughness.metallicRoughnessTexture=s.createTextureInfoDef(t,r)}return s.materialIndexMap.set(e,t),n})),r.meshes=n.listMeshes().map(((e,t)=>{const n=s.createPropertyDef(e);let r=null;return n.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const n=e.getMaterial();n&&(t.material=s.materialIndexMap.get(n)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const i=e.getIndices();i&&(t.indices=s.accessorIndexMap.get(i));for(const n of e.listSemantics())t.attributes[n]=s.accessorIndexMap.get(e.getAttribute(n));for(const n of e.listTargets()){const e={};for(const t of n.listSemantics())e[t]=s.accessorIndexMap.get(n.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!r&&(r=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(n.weights=e.getWeights()),r&&(n.extras=n.extras||{},n.extras.targetNames=r),s.meshIndexMap.set(e,t),n})),r.cameras=n.listCameras().map(((e,t)=>{const n=s.createPropertyDef(e);if(n.type=e.getType(),n.type===Lb.Type.PERSPECTIVE){n.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(n.perspective.aspectRatio=t)}else n.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return s.cameraIndexMap.set(e,t),n})),r.nodes=n.listNodes().map(((e,t)=>{const n=s.createPropertyDef(e);return gb.eq(e.getTranslation(),[0,0,0])||(n.translation=e.getTranslation()),gb.eq(e.getRotation(),[0,0,0,1])||(n.rotation=e.getRotation()),gb.eq(e.getScale(),[1,1,1])||(n.scale=e.getScale()),e.getWeights().length&&(n.weights=e.getWeights()),s.nodeIndexMap.set(e,t),n})),r.skins=n.listSkins().map(((e,t)=>{const n=s.createPropertyDef(e),r=e.getInverseBindMatrices();r&&(n.inverseBindMatrices=s.accessorIndexMap.get(r));const i=e.getSkeleton();return i&&(n.skeleton=s.nodeIndexMap.get(i)),n.joints=e.listJoints().map((e=>s.nodeIndexMap.get(e))),s.skinIndexMap.set(e,t),n})),n.listNodes().forEach(((e,t)=>{const n=r.nodes[t],i=e.getMesh();i&&(n.mesh=s.meshIndexMap.get(i));const o=e.getCamera();o&&(n.camera=s.cameraIndexMap.get(o));const a=e.getSkin();a&&(n.skin=s.skinIndexMap.get(a)),e.listChildren().length>0&&(n.children=e.listChildren().map((e=>s.nodeIndexMap.get(e))))})),r.animations=n.listAnimations().map(((e,t)=>{const n=s.createPropertyDef(e),r=new Map;return n.samplers=e.listSamplers().map(((e,t)=>{const n=s.createPropertyDef(e);return n.input=s.accessorIndexMap.get(e.getInput()),n.output=s.accessorIndexMap.get(e.getOutput()),n.interpolation=e.getInterpolation(),r.set(e,t),n})),n.channels=e.listChannels().map((e=>{const t=s.createPropertyDef(e);return t.sampler=r.get(e.getSampler()),t.target={node:s.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),s.animationIndexMap.set(e,t),n})),r.scenes=n.listScenes().map(((e,t)=>{const n=s.createPropertyDef(e);return n.nodes=e.listChildren().map((e=>s.nodeIndexMap.get(e))),s.sceneIndexMap.set(e,t),n}));const f=n.getDefaultScene();return f&&(r.scene=n.listScenes().indexOf(f)),r.extensionsUsed=l.map((e=>e.extensionName)),r.extensionsRequired=c.map((e=>e.extensionName)),l.forEach((e=>e.write(s))),function(e){const t=[];for(const n in e){const r=e[n];(Array.isArray(r)&&0===r.length||null===r||""===r||r&&"object"==typeof r&&0===Object.keys(r).length)&&t.push(n)}for(const n of t)delete e[n]}(r),i}}.write(e,{format:t.format||Jy.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Xb({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:Jy.GLB}),r=new Uint32Array([1179937895,2,12]),i=JSON.stringify(t),s=ob.pad(ob.encodeText(i),32),o=ob.toView(new Uint32Array([s.byteLength,1313821514])),a=ob.concat([o,s]);r[r.length-1]+=a.byteLength;const l=Object.values(n)[0];if(!l||!l.byteLength)return ob.concat([ob.toView(r),a]);const c=ob.pad(l,0),u=ob.toView(new Uint32Array([c.byteLength,5130562])),h=ob.concat([u,c]);return r[r.length-1]+=h.byteLength,ob.concat([ob.toView(r),a,h])}async L(e,t){var n=this;const r=[...e.json.images||[],...e.json.buffers||[]].map((async function(r){const i=r.uri;if(!i||i.match(/data:/))return Promise.resolve();e.resources[i]=await n.readURI(n.resolve(t,i),"view"),n.lastReadBytes+=e.resources[i].byteLength}));await Promise.all(r)}j(e){function t(t){if(t.uri)if(t.uri in e.resources)ob.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const n=`__${function(){for(let e=0;e<999;e++){const e=Cb();if(!Eb.has(e))return Eb.add(e),e}return""}()}.${hb.extension(t.uri)}`;e.resources[n]=ob.createBufferFromDataURI(t.uri),t.uri=n}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:Xb({},e.json),resources:Xb({},e.resources)},t&&(e.json.images=t.map((e=>Xb({},e)))),n&&(e.json.buffers=n.map((e=>Xb({},e)))),e}P(e){if(!dA(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==hA.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],r=ob.decodeText(ob.toView(e,20,n)),i=JSON.parse(r),s=20+n;if(e.byteLength<=s)return{json:i,resources:{}};const o=new Uint32Array(e.buffer,e.byteOffset+s,2);if(o[1]!==hA.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:i,resources:{"@glb.bin":ob.toView(e,s+8,o[0])}}}}function dA(e){if(e.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const t=new Uint32Array(e.buffer,e.byteOffset,3);return 1179937895===t[0]&&2===t[1]}class fA extends pA{constructor(e=Sb.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return Sb.resolve(e,t)}dirname(e){return Sb.dirname(e)}}class mA{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class gA{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}new Uint8Array([0]);const _A=[171,75,84,88,32,50,48,187,13,10,26,10];function vA(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function yA(e){const t=new Uint8Array(e.buffer,e.byteOffset,_A.length);if(t[0]!==_A[0]||t[1]!==_A[1]||t[2]!==_A[2]||t[3]!==_A[3]||t[4]!==_A[4]||t[5]!==_A[5]||t[6]!==_A[6]||t[7]!==_A[7]||t[8]!==_A[8]||t[9]!==_A[9]||t[10]!==_A[10]||t[11]!==_A[11])throw new Error("Missing KTX 2.0 identifier.");const n=new mA,r=17*Uint32Array.BYTES_PER_ELEMENT,i=new gA(e,_A.length,r,!0);n.vkFormat=i._nextUint32(),n.typeSize=i._nextUint32(),n.pixelWidth=i._nextUint32(),n.pixelHeight=i._nextUint32(),n.pixelDepth=i._nextUint32(),n.layerCount=i._nextUint32(),n.faceCount=i._nextUint32();const s=i._nextUint32();n.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),a=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),u=i._nextUint64(),h=i._nextUint64(),p=new gA(e,_A.length+r,3*s*8,!0);for(let t=0;t<s;t++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const d=new gA(e,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){const t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),f.samples[e]=t}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const g=new gA(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),r=vA(t),i=g._scan(e-t.byteLength);n.keyValue[r]=r.match(/^ktx/i)?vA(i):i,g._offset%4&&g._skip(4-g._offset%4)}if(h<=0)return n;const _=new gA(e,u,h,!0),v=_._nextUint16(),y=_._nextUint16(),b=_._nextUint32(),A=_._nextUint32(),w=_._nextUint32(),x=_._nextUint32(),E=[];for(let e=0;e<s;e++)E.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const C=u+_._offset,S=C+b,M=S+A,T=M+w,D=new Uint8Array(e.buffer,e.byteOffset+C,b),I=new Uint8Array(e.buffer,e.byteOffset+S,A),P=new Uint8Array(e.buffer,e.byteOffset+M,w),R=new Uint8Array(e.buffer,e.byteOffset+T,x);return n.globalData={endpointCount:v,selectorCount:y,imageDescs:E,endpointsData:D,selectorsData:I,tablesData:P,extendedData:R},n}class bA extends Fb{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[qy.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}bA.EXTENSION_NAME="EXT_mesh_gpu_instancing";const AA="EXT_mesh_gpu_instancing";class wA extends eA{constructor(...e){super(...e),this.extensionName=AA,this.provideTypes=[qy.NODE],this.prewriteTypes=[qy.ACCESSOR]}createInstancedMesh(){return new bA(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions[AA])return;const r=t.extensions[AA],i=this.createInstancedMesh();for(const t in r.attributes)i.setAttribute(t,e.accessors[r.attributes[t]]);e.nodes[n].setExtension(AA,i)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((n=>{const r=n.getExtension(AA);if(r){const i=e.nodeIndexMap.get(n),s=t.json.nodes[i],o={attributes:{}};r.listSemantics().forEach((t=>{const n=r.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(n)})),s.extensions=s.extensions||{},s.extensions[AA]=o}})),this}}function xA(){return(xA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var EA,CA,SA;wA.EXTENSION_NAME=AA,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(EA||(EA={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(CA||(CA={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(SA||(SA={}));const{BYTE:MA,SHORT:TA,FLOAT:DA}=Pb.ComponentType,{encodeNormalizedInt:IA,decodeNormalizedInt:PA}=gb;function RA(e,t,n,r){const{filter:i,bits:s}=r,o={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(n!==CA.ATTRIBUTES)return o;if(i!==SA.NONE){let n=e.getNormalized()?function(e){const t=e.getComponentType(),n=e.getArray(),r=new Float32Array(n.length);for(let e=0;e<n.length;e++)r[e]=PA(n[e],t);return r}(e):new Float32Array(o.array);switch(i){case SA.EXPONENTIAL:o.byteStride=4*e.getElementSize(),o.componentType=DA,o.normalized=!1,o.array=t.encodeFilterExp(n,e.getCount(),o.byteStride,s);break;case SA.OCTAHEDRAL:o.byteStride=s>8?8:4,o.componentType=s>8?TA:MA,o.normalized=!0,n=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let n=0,r=e.length/3;n<r;n++)t[4*n]=e[3*n],t[4*n+1]=e[3*n+1],t[4*n+2]=e[3*n+2];return t}(n):n,o.array=t.encodeFilterOct(n,e.getCount(),o.byteStride,s);break;case SA.QUATERNION:o.byteStride=8,o.componentType=TA,o.normalized=!0,o.array=t.encodeFilterQuat(n,e.getCount(),o.byteStride,s);break;default:throw new Error("Invalid filter.")}o.min=e.getMin([]),o.max=e.getMax([]),e.getNormalized()&&(o.min=o.min.map((t=>PA(t,e.getComponentType()))),o.max=o.max.map((t=>PA(t,e.getComponentType())))),o.normalized&&(o.min=o.min.map((e=>IA(e,o.componentType))),o.max=o.max.map((e=>IA(e,o.componentType))))}else o.byteStride%4&&(o.array=function(e,t){const n=ob.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,r=new e.constructor(e.length/t*n);for(let i=0;i*t<e.length;i++)for(let s=0;s<t;s++)r[i*n+s]=e[i*t+s];return r}(o.array,e.getElementSize()),o.byteStride=o.array.byteLength/e.getCount());return o}function BA(e,t){return t===sA.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof Wb&&e.getMode()===Wb.Mode.TRIANGLES))?CA.TRIANGLES:CA.INDICES:CA.ATTRIBUTES}function kA(e,t){const n=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof Zb)));for(const t of n){const n=t.getName(),r=t.getAttributes().key||"";if("indices"===n)return{filter:SA.NONE};if("attributes"===n){if("POSITION"===r)return{filter:SA.NONE};if("TEXCOORD_0"===r)return{filter:SA.NONE};if("NORMAL"===r)return{filter:SA.OCTAHEDRAL,bits:8};if("TANGENT"===r)return{filter:SA.OCTAHEDRAL,bits:8};if(r.startsWith("JOINTS_"))return{filter:SA.NONE};if(r.startsWith("WEIGHTS_"))return{filter:SA.NONE}}if("output"===n){const t=OA(e);return"rotation"===t?{filter:SA.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:SA.EXPONENTIAL,bits:12}:{filter:SA.NONE}}if("input"===n)return{filter:SA.NONE};if("inverseBindMatrices"===n)return{filter:SA.NONE}}return{filter:SA.NONE}}function OA(e){for(const t of e.listParents())if(t instanceof kb)for(const e of t.listParents())if(e instanceof Bb)return e.getTargetPath();return null}const LA="EXT_meshopt_compression",FA={method:EA.QUANTIZE};class UA extends eA{constructor(...e){super(...e),this.extensionName=LA,this.prereadTypes=[qy.BUFFER,qy.PRIMITIVE],this.prewriteTypes=[qy.BUFFER,qy.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=FA,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=xA({},FA,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${LA}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${LA}]: Missing WASM support.`)}return t===qy.BUFFER?this._prereadBuffers(e):t===qy.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((n,r)=>{if(!n.extensions||!n.extensions[LA])return;const i=n.extensions[LA],s=i.byteOffset||0,o=i.byteLength||0,a=i.count,l=i.byteStride,c=new Uint8Array(a*l),u=t.json.buffers[i.buffer],h=ob.toView(u.uri?t.resources[u.uri]:t.resources[Wy],s,o);this._decoder.decodeGltfBuffer(c,a,l,h,i.mode,i.filter),e.bufferViews[r]=c}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n=>{var r;n.extensions&&n.extensions[LA]&&(r=t.json.buffers[n.buffer]).extensions&&r.extensions.EXT_meshopt_compression&&r.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[LA].buffer])}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const n of e.listParents())n instanceof Pb&&n.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===qy.ACCESSOR?this._prewriteAccessors(e):t===qy.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,r=this._encoderOptions,i=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(i);this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const i of this.document.getRoot().listAccessors()){if("weights"===OA(i))continue;if(i.getSparse())continue;const o=e.getAccessorUsage(i),a=BA(i,o),l=r.method===EA.FILTER?kA(i,this.document):{filter:SA.NONE},c=RA(i,n,a,l),{array:u,byteStride:h}=c,p=i.getBuffer();if(!p)throw new Error(`${LA}: Missing buffer for accessor.`);const d=this.document.getRoot().listBuffers().indexOf(p),f=[o,a,l.filter,h,d].join(":");let m=this._encoderBufferViews[f],g=this._encoderBufferViewData[f],_=this._encoderBufferViewAccessors[f];m&&g||(_=this._encoderBufferViewAccessors[f]=[],g=this._encoderBufferViewData[f]=[],m=this._encoderBufferViews[f]={buffer:s,target:sA.USAGE_TO_TARGET[o],byteOffset:0,byteLength:0,byteStride:o===sA.BufferViewUsage.ARRAY_BUFFER?h:void 0,extensions:{[LA]:{buffer:d,byteOffset:0,byteLength:0,mode:a,filter:l.filter!==SA.NONE?l.filter:void 0,byteStride:h,count:0}}});const v=e.createAccessorDef(i);v.componentType=c.componentType,v.normalized=c.normalized,v.byteOffset=m.byteLength,v.min&&c.min&&(v.min=c.min),v.max&&c.max&&(v.max=c.max),e.accessorIndexMap.set(i,t.accessors.length),t.accessors.push(v),_.push(v),g.push(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),m.byteLength+=u.byteLength,m.extensions.EXT_meshopt_compression.count+=i.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const r=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],s=this.document.getRoot().listBuffers()[r.extensions[LA].buffer],o=e.otherBufferViews.get(s)||[],{count:a,byteStride:l,mode:c}=r.extensions[LA],u=ob.concat(i),h=t.encodeGltfBuffer(u,a,l,c),p=ob.pad(h);r.extensions[LA].byteLength=h.byteLength,i.length=0,i.push(p),o.push(p),e.otherBufferViews.set(s,o)}}write(e){let t=0;for(const n in this._encoderBufferViews){const r=this._encoderBufferViews[n],i=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[n][0]),s=this._encoderBufferViewAccessors[n];for(const e of s)e.bufferView=i;const o=e.jsonDoc.json.bufferViews[i],a=o.byteOffset||0;Object.assign(o,r),o.byteOffset=t,o.extensions[LA].byteOffset=a,t+=ob.padNumber(r.byteLength)}const n=this._encoderFallbackBuffer,r=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[r];return i.byteLength=t,i.extensions={[LA]:{fallback:!0}},n.dispose(),this}}UA.EXTENSION_NAME=LA,UA.EncoderMethod=EA;const NA="EXT_texture_avif";class jA{match(e){return e.length>=12&&"ftypavif"===ob.decodeText(e.slice(4,12))}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=GA(t,0);if(!n)return null;let r=n.end;for(;n=GA(t,r);)if("meta"===n.type)r=n.start+4;else if("iprp"===n.type||"ipco"===n.type)r=n.start;else{if("ispe"===n.type)return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if("mdat"===n.type)break;r=n.end}return null}getChannels(e){return 4}}class zA extends eA{constructor(...e){super(...e),this.extensionName=NA,this.prereadTypes=[qy.TEXTURE]}static register(){cb.registerFormat("image/avif",new jA)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[NA]&&(e.source=e.extensions[NA].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/avif"===n.getMimeType()){const r=e.imageIndexMap.get(n);(t.json.textures||[]).forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[NA]={source:e.source},delete e.source)}))}})),this}}function GA(e,t){if(e.byteLength<4+t)return null;const n=e.getUint32(t);return e.byteLength<n+t||n<8?null:{type:ob.decodeText(new Uint8Array(e.buffer,e.byteOffset+t+4,4)),start:t+8,end:t+n}}zA.EXTENSION_NAME=NA;const VA="EXT_texture_webp";class HA{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=ob.decodeText(e.slice(0,4)),n=ob.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==n)return null;const r=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<r.byteLength;){const e=ob.decodeText(new Uint8Array([r.getUint8(i),r.getUint8(i+1),r.getUint8(i+2),r.getUint8(i+3)])),t=r.getUint32(i+4,!0);if("VP8 "===e)return[16383&r.getInt16(i+14,!0),16383&r.getInt16(i+16,!0)];if("VP8L"===e){const e=r.getUint8(i+9),t=r.getUint8(i+10),n=r.getUint8(i+11);return[1+((63&t)<<8|e),1+((15&r.getUint8(i+12))<<10|n<<2|(192&t)>>6)]}i+=8+t+t%2}return null}getChannels(e){return 4}}class QA extends eA{constructor(...e){super(...e),this.extensionName=VA,this.prereadTypes=[qy.TEXTURE]}static register(){cb.registerFormat("image/webp",new HA)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[VA]&&(e.source=e.extensions[VA].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/webp"===n.getMimeType()){const r=e.imageIndexMap.get(n);(t.json.textures||[]).forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[VA]={source:e.source},delete e.source)}))}})),this}}QA.EXTENSION_NAME=VA;const WA="KHR_draco_mesh_compression";let qA,XA,YA,KA;function JA(e,t){const n=new qA.DecoderBuffer;try{if(n.Init(t,t.length),e.GetEncodedGeometryType(n)!==qA.TRIANGULAR_MESH)throw new Error(`[${WA}] Unknown geometry type.`);const r=new qA.Mesh;if(!e.DecodeBufferToMesh(n,r).ok()||0===r.ptr)throw new Error(`[${WA}] Decoding failure.`);return r}finally{qA.destroy(n)}}function ZA(e,t){const n=3*t.num_faces();let r,i;if(t.num_points()<=65534){const s=n*Uint16Array.BYTES_PER_ELEMENT;r=qA._malloc(s),e.GetTrianglesUInt16Array(t,s,r),i=new Uint16Array(qA.HEAPU16.buffer,r,n).slice()}else{const s=n*Uint32Array.BYTES_PER_ELEMENT;r=qA._malloc(s),e.GetTrianglesUInt32Array(t,s,r),i=new Uint32Array(qA.HEAPU32.buffer,r,n).slice()}return qA._free(r),i}function $A(e,t,n,r){const i=YA[r.componentType],s=XA[r.componentType],o=n.num_components(),a=t.num_points()*o,l=a*s.BYTES_PER_ELEMENT,c=qA._malloc(l);e.GetAttributeDataArrayForAllPoints(t,n,i,l,c);const u=new s(qA.HEAPF32.buffer,c,a).slice();return qA._free(c),u}var ew,tw;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(ew||(ew={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(tw||(tw={}));const nw={[tw.POSITION]:14,[tw.NORMAL]:10,[tw.COLOR]:8,[tw.TEX_COORD]:12,[tw.GENERIC]:12},rw={decodeSpeed:5,encodeSpeed:5,method:ew.EDGEBREAKER,quantizationBits:nw,quantizationVolume:"mesh"};function iw(e,t=rw){const n=xA({},rw,t);n.quantizationBits=xA({},nw,t.quantizationBits);const r=new KA.Encoder,i=new KA.MeshBuilder,s=new KA.Mesh,o={},a=new KA.DracoInt8Array,l=e.listTargets().length>0;let c=!1;for(const t of e.listSemantics()){const a=e.getAttribute(t);if(a.getSparse()){c=!0;continue}const l=sw(t),u=ow(i,a.getComponentType(),s,KA[l],a.getCount(),a.getElementSize(),a.getArray());if(-1===u)throw new Error(`Error compressing "${t}" attribute.`);if(o[t]=u,"mesh"===n.quantizationVolume||"POSITION"!==t)r.SetAttributeQuantization(KA[l],n.quantizationBits[l]);else{if("object"!=typeof n.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=n,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);r.SetAttributeExplicitQuantization(KA[l],n.quantizationBits[l],a.getElementSize(),e.min,t)}}}const u=e.getIndices();if(!u)throw new aw("Primitive must have indices.");i.AddFacesToMesh(s,u.getCount()/3,u.getArray()),r.SetSpeedOptions(n.encodeSpeed,n.decodeSpeed),r.SetTrackEncodedProperties(!0),r.SetEncodingMethod(n.method===ew.SEQUENTIAL||l||c?KA.MESH_SEQUENTIAL_ENCODING:KA.MESH_EDGEBREAKER_ENCODING);const h=r.EncodeMeshToDracoBuffer(s,a);if(h<=0)throw new aw("Error applying Draco compression.");const p=new Uint8Array(h);for(let e=0;e<h;++e)p[e]=a.GetValue(e);const d=e.getAttribute("POSITION").getCount(),f=r.GetNumberOfEncodedPoints(),m=3*r.GetNumberOfEncodedFaces();if((l||c)&&f!==d)throw new aw('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return KA.destroy(a),KA.destroy(s),KA.destroy(i),KA.destroy(r),{numVertices:f,numIndices:m,data:p,attributeIDs:o}}function sw(e){return"POSITION"===e?tw.POSITION:"NORMAL"===e?tw.NORMAL:e.startsWith("COLOR_")?tw.COLOR:e.startsWith("TEXCOORD_")?tw.TEX_COORD:tw.GENERIC}function ow(e,t,n,r,i,s,o){switch(t){case Pb.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(n,r,i,s,o);case Pb.ComponentType.BYTE:return e.AddInt8Attribute(n,r,i,s,o);case Pb.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(n,r,i,s,o);case Pb.ComponentType.SHORT:return e.AddInt16Attribute(n,r,i,s,o);case Pb.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(n,r,i,s,o);case Pb.ComponentType.FLOAT:return e.AddFloatAttribute(n,r,i,s,o);default:throw new Error(`Unexpected component type, "${t}".`)}}class aw extends Error{}const lw="KHR_draco_mesh_compression";class cw extends eA{constructor(...e){super(...e),this.extensionName=lw,this.prereadTypes=[qy.PRIMITIVE],this.prewriteTypes=[qy.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,qA=this._decoderModule,XA={[Pb.ComponentType.FLOAT]:Float32Array,[Pb.ComponentType.UNSIGNED_INT]:Uint32Array,[Pb.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Pb.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Pb.ComponentType.SHORT]:Int16Array,[Pb.ComponentType.BYTE]:Int8Array},YA={[Pb.ComponentType.FLOAT]:qA.DT_FLOAT32,[Pb.ComponentType.UNSIGNED_INT]:qA.DT_UINT32,[Pb.ComponentType.UNSIGNED_SHORT]:qA.DT_UINT16,[Pb.ComponentType.UNSIGNED_BYTE]:qA.DT_UINT8,[Pb.ComponentType.SHORT]:qA.DT_INT16,[Pb.ComponentType.BYTE]:qA.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,KA=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${lw}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,r=new Map;try{const i=n.json.meshes||[];for(const s of i)for(const i of s.primitives){if(!i.extensions||!i.extensions[lw])continue;const s=i.extensions[lw];let[o,a]=r.get(s.bufferView)||[];if(!a||!o){const e=n.json.bufferViews[s.bufferView],i=n.json.buffers[e.buffer],l=ob.toView(i.uri?n.resources[i.uri]:n.resources[Wy],e.byteOffset||0,e.byteLength);o=new this._decoderModule.Decoder,a=JA(o,l),r.set(s.bufferView,[o,a]),t.debug(`[${lw}] Decompressed ${l.byteLength} bytes.`)}for(const t in i.attributes){const n=e.jsonDoc.json.accessors[i.attributes[t]],r=o.GetAttributeByUniqueId(a,s.attributes[t]),l=$A(o,a,r,n);e.accessors[i.attributes[t]].setArray(l)}void 0!==i.indices&&e.accessors[i.indices].setArray(ZA(o,a))}}finally{for(const[e,t]of Array.from(r.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${lw}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${lw}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const r=function(e){const t=e.getLogger(),n=new Set,r=new Set;for(const i of e.getRoot().listMeshes())for(const e of i.listPrimitives())e.getIndices()?e.getMode()!==Wb.Mode.TRIANGLES?(r.add(e),t.warn(`[${lw}] Skipping Draco compression on non-TRIANGLES primitive.`)):n.add(e):(r.add(e),t.warn(`[${lw}] Skipping Draco compression on non-indexed primitive.`));const i=e.getRoot().listAccessors(),s=new Map;for(let e=0;e<i.length;e++)s.set(i[e],e);const o=new Map,a=new Set,l=new Map;for(const t of Array.from(n)){let n=uw(t,s);if(a.has(n))l.set(t,n);else{if(o.has(t.getIndices())){const n=t.getIndices(),r=n.clone();s.set(r,e.getRoot().listAccessors().length-1),t.swap(n,r)}for(const n of t.listAttributes())if(o.has(n)){const r=n.clone();s.set(r,e.getRoot().listAccessors().length-1),t.swap(n,r)}n=uw(t,s),a.add(n),l.set(t,n),o.set(t.getIndices(),n);for(const e of t.listAttributes())o.set(e,n)}}for(const e of Array.from(o.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(qy.PRIMITIVE)||!t.has(qy.ROOT))throw new Error(`[${lw}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(n)){const t=l.get(e),n=e.getIndices();if(o.get(n)!==t||e.listAttributes().some((e=>o.get(e)!==t)))throw new Error(`[${lw}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(r)){const t=e.getIndices();if(o.has(t)||e.listAttributes().some((e=>o.has(e))))throw new Error(`[${lw}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return l}(this.document),i=new Map;let s="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?n.warn(`[${lw}]: quantizationVolume=scene requires exactly 1 scene.`):s=function(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},n=e.propertyType===qy.NODE?[e]:e.listChildren();for(const e of n)e.traverse((e=>{const n=e.getMesh();if(!n)return;const r=ib(n,e.getWorldMatrix());sb(r.min,t),sb(r.max,t)}));return t}(this.document.getRoot().listScenes().pop()));for(const t of Array.from(r.keys())){const o=r.get(t);if(!o)throw new Error("Unexpected primitive.");if(i.has(o)){i.set(o,i.get(o));continue}const a=t.getIndices(),l=e.jsonDoc.json.accessors;let c;try{c=iw(t,xA({},this._encoderOptions,{quantizationVolume:s}))}catch(e){if(e instanceof aw){n.warn(`[${lw}]: ${e.message} Skipping primitive compression.`);continue}throw e}i.set(o,c);const u=e.createAccessorDef(a);u.count=c.numIndices,e.accessorIndexMap.set(a,l.length),l.push(u);for(const n of t.listSemantics()){const r=t.getAttribute(n);if(void 0===c.attributeIDs[n])continue;const i=e.createAccessorDef(r);i.count=c.numVertices,e.accessorIndexMap.set(r,l.length),l.push(i)}const h=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(h)||e.otherBufferViews.set(h,[]),e.otherBufferViews.get(h).push(c.data)}return n.debug(`[${lw}] Compressed ${r.size} primitives.`),e.extensionData[lw]={primitiveHashMap:r,primitiveEncodingMap:i},this}write(e){const t=e.extensionData[lw];for(const n of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const s=n.listPrimitives()[i],o=r.primitives[i],a=t.primitiveHashMap.get(s);if(!a)continue;const l=t.primitiveEncodingMap.get(a);l&&(o.extensions=o.extensions||{},o.extensions[lw]={bufferView:e.otherBufferViewsIndexMap.get(l.data),attributes:l.attributeIDs})}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==lw)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==lw))}return this}}function uw(e,t){const n=[],r=e.getIndices();n.push(t.get(r));for(const r of e.listAttributes())n.push(t.get(r));return n.sort().join("|")}cw.EXTENSION_NAME=lw,cw.EncoderMethod=ew;class hw extends Fb{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[qy.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:hw.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return ab.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return ab.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}hw.EXTENSION_NAME="KHR_lights_punctual",hw.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const pw="KHR_lights_punctual";class dw extends eA{constructor(...e){super(...e),this.extensionName=pw}createLight(e=""){return new hw(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[pw])return this;const n=(t.json.extensions[pw].lights||[]).map((e=>{var t,n;const r=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&r.setColor(e.color),void 0!==e.intensity&&r.setIntensity(e.intensity),void 0!==e.range&&r.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&r.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(n=e.spot)?void 0:n.outerConeAngle)&&r.setOuterConeAngle(e.spot.outerConeAngle),r}));return t.json.nodes.forEach(((t,r)=>{t.extensions&&t.extensions[pw]&&e.nodes[r].setExtension(pw,n[t.extensions[pw].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const n=[],r=new Map;for(const e of this.properties){const t=e,i={type:t.getType()};gb.eq(t.getColor(),[1,1,1])||(i.color=t.getColor()),1!==t.getIntensity()&&(i.intensity=t.getIntensity()),null!=t.getRange()&&(i.range=t.getRange()),t.getName()&&(i.name=t.getName()),t.getType()===hw.Type.SPOT&&(i.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),n.push(i),r.set(t,n.length-1)}return this.document.getRoot().listNodes().forEach((n=>{const i=n.getExtension(pw);if(i){const s=e.nodeIndexMap.get(n),o=t.json.nodes[s];o.extensions=o.extensions||{},o.extensions[pw]={light:r.get(i)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[pw]={lights:n},this}}dw.EXTENSION_NAME=pw;const{R:fw,G:mw}=Ky;class gw extends Fb{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Ub(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:fw|mw})}}gw.EXTENSION_NAME="KHR_materials_anisotropy";const _w="KHR_materials_anisotropy";class vw extends eA{constructor(...e){super(...e),this.extensionName=_w}createAnisotropy(){return new gw(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[_w]){const i=this.createAnisotropy();e.materials[r].setExtension(_w,i);const s=t.extensions[_w];if(void 0!==s.anisotropyStrength&&i.setAnisotropyStrength(s.anisotropyStrength),void 0!==s.anisotropyRotation&&i.setAnisotropyRotation(s.anisotropyRotation),void 0!==s.anisotropyTexture){const t=s.anisotropyTexture;i.setAnisotropyTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getAnisotropyTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(_w);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[_w]={};if(r.getAnisotropyStrength()>0&&(o.anisotropyStrength=r.getAnisotropyStrength()),0!==r.getAnisotropyRotation()&&(o.anisotropyRotation=r.getAnisotropyRotation()),r.getAnisotropyTexture()){const t=r.getAnisotropyTexture(),n=r.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(t,n)}}})),this}}vw.EXTENSION_NAME=_w;const{R:yw,G:bw,B:Aw}=Ky;class ww extends Fb{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Ub(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Ub(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Ub(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:yw})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:bw})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:yw|bw|Aw})}}ww.EXTENSION_NAME="KHR_materials_clearcoat";const xw="KHR_materials_clearcoat";class Ew extends eA{constructor(...e){super(...e),this.extensionName=xw}createClearcoat(){return new ww(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[xw]){const i=this.createClearcoat();e.materials[r].setExtension(xw,i);const s=t.extensions[xw];if(void 0!==s.clearcoatFactor&&i.setClearcoatFactor(s.clearcoatFactor),void 0!==s.clearcoatRoughnessFactor&&i.setClearcoatRoughnessFactor(s.clearcoatRoughnessFactor),void 0!==s.clearcoatTexture){const t=s.clearcoatTexture;i.setClearcoatTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getClearcoatTextureInfo(),t)}if(void 0!==s.clearcoatRoughnessTexture){const t=s.clearcoatRoughnessTexture;i.setClearcoatRoughnessTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==s.clearcoatNormalTexture){const t=s.clearcoatNormalTexture;i.setClearcoatNormalTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&i.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(xw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[xw]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const t=r.getClearcoatTexture(),n=r.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,n)}if(r.getClearcoatRoughnessTexture()){const t=r.getClearcoatRoughnessTexture(),n=r.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,n)}if(r.getClearcoatNormalTexture()){const t=r.getClearcoatNormalTexture(),n=r.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,n),1!==r.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}})),this}}Ew.EXTENSION_NAME=xw;class Cw extends Fb{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Cw.EXTENSION_NAME="KHR_materials_emissive_strength";const Sw="KHR_materials_emissive_strength";class Mw extends eA{constructor(...e){super(...e),this.extensionName=Sw}createEmissiveStrength(){return new Cw(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[Sw]){const r=this.createEmissiveStrength();e.materials[n].setExtension(Sw,r);const i=t.extensions[Sw];void 0!==i.emissiveStrength&&r.setEmissiveStrength(i.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(Sw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{},s.extensions[Sw]={emissiveStrength:r.getEmissiveStrength()}}})),this}}Mw.EXTENSION_NAME=Sw;class Tw extends Fb{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Tw.EXTENSION_NAME="KHR_materials_ior";const Dw="KHR_materials_ior";class Iw extends eA{constructor(...e){super(...e),this.extensionName=Dw}createIOR(){return new Tw(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[Dw]){const r=this.createIOR();e.materials[n].setExtension(Dw,r);const i=t.extensions[Dw];void 0!==i.ior&&r.setIOR(i.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(Dw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{},s.extensions[Dw]={ior:r.getIOR()}}})),this}}Iw.EXTENSION_NAME=Dw;const{R:Pw,G:Rw}=Ky;class Bw extends Fb{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Ub(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Ub(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Pw})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Rw})}}Bw.EXTENSION_NAME="KHR_materials_iridescence";const kw="KHR_materials_iridescence";class Ow extends eA{constructor(...e){super(...e),this.extensionName=kw}createIridescence(){return new Bw(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[kw]){const i=this.createIridescence();e.materials[r].setExtension(kw,i);const s=t.extensions[kw];if(void 0!==s.iridescenceFactor&&i.setIridescenceFactor(s.iridescenceFactor),void 0!==s.iridescenceIor&&i.setIridescenceIOR(s.iridescenceIor),void 0!==s.iridescenceThicknessMinimum&&i.setIridescenceThicknessMinimum(s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&i.setIridescenceThicknessMaximum(s.iridescenceThicknessMaximum),void 0!==s.iridescenceTexture){const t=s.iridescenceTexture;i.setIridescenceTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getIridescenceTextureInfo(),t)}if(void 0!==s.iridescenceThicknessTexture){const t=s.iridescenceThicknessTexture;i.setIridescenceThicknessTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getIridescenceThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(kw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[kw]={};if(r.getIridescenceFactor()>0&&(o.iridescenceFactor=r.getIridescenceFactor()),1.3!==r.getIridescenceIOR()&&(o.iridescenceIor=r.getIridescenceIOR()),100!==r.getIridescenceThicknessMinimum()&&(o.iridescenceThicknessMinimum=r.getIridescenceThicknessMinimum()),400!==r.getIridescenceThicknessMaximum()&&(o.iridescenceThicknessMaximum=r.getIridescenceThicknessMaximum()),r.getIridescenceTexture()){const t=r.getIridescenceTexture(),n=r.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(t,n)}if(r.getIridescenceThicknessTexture()){const t=r.getIridescenceThicknessTexture(),n=r.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(t,n)}}})),this}}Ow.EXTENSION_NAME=kw;const{R:Lw,G:Fw,B:Uw,A:Nw}=Ky;class jw extends Fb{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Ub(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Ub(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return ab.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(ab.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Lw|Fw|Uw|Nw})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Lw|Fw|Uw|Nw})}}jw.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const zw="KHR_materials_pbrSpecularGlossiness";class Gw extends eA{constructor(...e){super(...e),this.extensionName=zw}createPBRSpecularGlossiness(){return new jw(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[zw]){const i=this.createPBRSpecularGlossiness();e.materials[r].setExtension(zw,i);const s=t.extensions[zw];if(void 0!==s.diffuseFactor&&i.setDiffuseFactor(s.diffuseFactor),void 0!==s.specularFactor&&i.setSpecularFactor(s.specularFactor),void 0!==s.glossinessFactor&&i.setGlossinessFactor(s.glossinessFactor),void 0!==s.diffuseTexture){const t=s.diffuseTexture;i.setDiffuseTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getDiffuseTextureInfo(),t)}if(void 0!==s.specularGlossinessTexture){const t=s.specularGlossinessTexture;i.setSpecularGlossinessTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(zw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[zw]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const t=r.getDiffuseTexture(),n=r.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,n)}if(r.getSpecularGlossinessTexture()){const t=r.getSpecularGlossinessTexture(),n=r.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,n)}}})),this}}Gw.EXTENSION_NAME=zw;const{R:Vw,G:Hw,B:Qw,A:Ww}=Ky;class qw extends Fb{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Ub(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Ub(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return ab.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",ab.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Vw|Hw|Qw})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Ww})}}qw.EXTENSION_NAME="KHR_materials_sheen";const Xw="KHR_materials_sheen";class Yw extends eA{constructor(...e){super(...e),this.extensionName=Xw}createSheen(){return new qw(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Xw]){const i=this.createSheen();e.materials[r].setExtension(Xw,i);const s=t.extensions[Xw];if(void 0!==s.sheenColorFactor&&i.setSheenColorFactor(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&i.setSheenRoughnessFactor(s.sheenRoughnessFactor),void 0!==s.sheenColorTexture){const t=s.sheenColorTexture;i.setSheenColorTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getSheenColorTextureInfo(),t)}if(void 0!==s.sheenRoughnessTexture){const t=s.sheenRoughnessTexture;i.setSheenRoughnessTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(Xw);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[Xw]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const t=r.getSheenColorTexture(),n=r.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,n)}if(r.getSheenRoughnessTexture()){const t=r.getSheenRoughnessTexture(),n=r.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,n)}}})),this}}Yw.EXTENSION_NAME=Xw;const{R:Kw,G:Jw,B:Zw,A:$w}=Ky;class ex extends Fb{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Ub(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Ub(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return ab.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",ab.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:$w})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Kw|Jw|Zw})}}ex.EXTENSION_NAME="KHR_materials_specular";const tx="KHR_materials_specular";class nx extends eA{constructor(...e){super(...e),this.extensionName=tx}createSpecular(){return new ex(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[tx]){const i=this.createSpecular();e.materials[r].setExtension(tx,i);const s=t.extensions[tx];if(void 0!==s.specularFactor&&i.setSpecularFactor(s.specularFactor),void 0!==s.specularColorFactor&&i.setSpecularColorFactor(s.specularColorFactor),void 0!==s.specularTexture){const t=s.specularTexture;i.setSpecularTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getSpecularTextureInfo(),t)}if(void 0!==s.specularColorTexture){const t=s.specularColorTexture;i.setSpecularColorTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(tx);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[tx]={};if(1!==r.getSpecularFactor()&&(o.specularFactor=r.getSpecularFactor()),gb.eq(r.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=r.getSpecularColorFactor()),r.getSpecularTexture()){const t=r.getSpecularTexture(),n=r.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(t,n)}if(r.getSpecularColorTexture()){const t=r.getSpecularColorTexture(),n=r.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(t,n)}}})),this}}nx.EXTENSION_NAME=tx;const{R:rx}=Ky;class ix extends Fb{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Ub(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:rx})}}ix.EXTENSION_NAME="KHR_materials_transmission";const sx="KHR_materials_transmission";class ox extends eA{constructor(...e){super(...e),this.extensionName=sx}createTransmission(){return new ix(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[sx]){const i=this.createTransmission();e.materials[r].setExtension(sx,i);const s=t.extensions[sx];if(void 0!==s.transmissionFactor&&i.setTransmissionFactor(s.transmissionFactor),void 0!==s.transmissionTexture){const t=s.transmissionTexture;i.setTransmissionTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(sx);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[sx]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const t=r.getTransmissionTexture(),n=r.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,n)}}})),this}}ox.EXTENSION_NAME=sx;class ax extends Fb{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[qy.MATERIAL]}}ax.EXTENSION_NAME="KHR_materials_unlit";const lx="KHR_materials_unlit";class cx extends eA{constructor(...e){super(...e),this.extensionName=lx}createUnlit(){return new ax(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,n)=>{t.extensions&&t.extensions[lx]&&e.materials[n].setExtension(lx,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{if(n.getExtension(lx)){const r=e.materialIndexMap.get(n),i=t.json.materials[r];i.extensions=i.extensions||{},i.extensions[lx]={}}})),this}}cx.EXTENSION_NAME=lx;class ux extends Fb{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}ux.EXTENSION_NAME="KHR_materials_variants";class hx extends Fb{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[qy.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}hx.EXTENSION_NAME="KHR_materials_variants";class px extends Fb{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}px.EXTENSION_NAME="KHR_materials_variants";const dx="KHR_materials_variants";class fx extends eA{constructor(...e){super(...e),this.extensionName=dx}createMappingList(){return new hx(this.document.getGraph())}createVariant(e=""){return new px(this.document.getGraph(),e)}createMapping(){return new ux(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof px))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[dx])return this;const n=(t.json.extensions[dx].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,r)=>{const i=e.meshes[r];(t.primitives||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[dx])return;const s=this.createMappingList(),o=t.extensions[dx];for(const t of o.mappings){const r=this.createMapping();void 0!==t.material&&r.setMaterial(e.materials[t.material]);for(const e of t.variants||[])r.addVariant(n[e]);s.addMapping(r)}i.listPrimitives()[r].setExtension(dx,s)}))})),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const r=[],i=new Map;for(const t of n)i.set(t,r.length),r.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const n=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,r)=>{const s=t.getExtension(dx);if(!s)return;const o=e.jsonDoc.json.meshes[n].primitives[r],a=s.listMappings().map((t=>{const n=e.createPropertyDef(t),r=t.getMaterial();return r&&(n.material=e.materialIndexMap.get(r)),n.variants=t.listVariants().map((e=>i.get(e))),n}));o.extensions=o.extensions||{},o.extensions[dx]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[dx]={variants:r},this}}fx.EXTENSION_NAME=dx;const{G:mx}=Ky;class gx extends Fb{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[qy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Ub(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:mx})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return ab.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",ab.hexToFactor(e,t))}}gx.EXTENSION_NAME="KHR_materials_volume";const _x="KHR_materials_volume";class vx extends eA{constructor(...e){super(...e),this.extensionName=_x}createVolume(){return new gx(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[_x]){const i=this.createVolume();e.materials[r].setExtension(_x,i);const s=t.extensions[_x];if(void 0!==s.thicknessFactor&&i.setThicknessFactor(s.thicknessFactor),void 0!==s.attenuationDistance&&i.setAttenuationDistance(s.attenuationDistance),void 0!==s.attenuationColor&&i.setAttenuationColor(s.attenuationColor),void 0!==s.thicknessTexture){const t=s.thicknessTexture;i.setThicknessTexture(e.textures[n[t.index].source]),e.setTextureInfo(i.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(_x);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o=s.extensions[_x]={};if(r.getThicknessFactor()>0&&(o.thicknessFactor=r.getThicknessFactor()),Number.isFinite(r.getAttenuationDistance())&&(o.attenuationDistance=r.getAttenuationDistance()),gb.eq(r.getAttenuationColor(),[1,1,1])||(o.attenuationColor=r.getAttenuationColor()),r.getThicknessTexture()){const t=r.getThicknessTexture(),n=r.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(t,n)}}})),this}}vx.EXTENSION_NAME=_x;const yx="KHR_mesh_quantization";class bx extends eA{constructor(...e){super(...e),this.extensionName=yx}read(e){return this}write(e){return this}}bx.EXTENSION_NAME=yx;const Ax="KHR_texture_basisu";class wx{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=yA(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=yA(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2===t.samples.length&&15==(15&t.samples[1].channelType)?4:3;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=yA(e),n=this.getChannels(e)>3;let r=0;for(let e=0;e<t.levels.length;e++){const i=t.levels[e];r+=i.uncompressedByteLength?i.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(n?16:8)}return r}}class xx extends eA{constructor(...e){super(...e),this.extensionName=Ax,this.prereadTypes=[qy.TEXTURE]}static register(){cb.registerFormat("image/ktx2",new wx)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[Ax]&&(e.source=e.extensions[Ax].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((n=>{if("image/ktx2"===n.getMimeType()){const r=e.imageIndexMap.get(n);t.json.textures.forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[Ax]={source:e.source},delete e.source)}))}})),this}}xx.EXTENSION_NAME=Ax;class Ex extends Fb{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[qy.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Ex.EXTENSION_NAME="KHR_texture_transform";const Cx="KHR_texture_transform";class Sx extends eA{constructor(...e){super(...e),this.extensionName=Cx}createTransform(){return new Ex(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Cx])continue;const e=this.createTransform(),r=n.extensions[Cx];void 0!==r.offset&&e.setOffset(r.offset),void 0!==r.rotation&&e.setRotation(r.rotation),void 0!==r.scale&&e.setScale(r.scale),void 0!==r.texCoord&&e.setTexCoord(r.texCoord),t.setExtension(Cx,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,n]of t){const t=e.getExtension(Cx);if(!t)continue;n.extensions=n.extensions||{};const r={},i=gb.eq;i(t.getOffset(),[0,0])||(r.offset=t.getOffset()),0!==t.getRotation()&&(r.rotation=t.getRotation()),i(t.getScale(),[1,1])||(r.scale=t.getScale()),null!=t.getTexCoord()&&(r.texCoord=t.getTexCoord()),n.extensions[Cx]=r}return this}}Sx.EXTENSION_NAME=Cx;const Mx=[qy.ROOT,qy.SCENE,qy.NODE,qy.MESH,qy.MATERIAL,qy.TEXTURE,qy.ANIMATION];class Tx extends Fb{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=Mx}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",xA({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=xA({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return xA({"@context":Dx(this.get("context"))},Dx(this.get("properties")))}fromJSONLD(e){const t=(e=Dx(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function Dx(e){return JSON.parse(JSON.stringify(e))}Tx.EXTENSION_NAME="KHR_xmp_json_ld";const Ix="KHR_xmp_json_ld";class Px extends eA{constructor(...e){super(...e),this.extensionName=Ix}createPacket(){return new Tx(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=null==(t=e.jsonDoc.json.extensions)?void 0:t[Ix];if(!n||!n.packets)return this;const r=e.jsonDoc.json,i=this.document.getRoot(),s=n.packets.map((e=>this.createPacket().fromJSONLD(e))),o=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],a=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let e=0;e<o.length;e++){const t=o[e]||[];for(let n=0;n<t.length;n++){const r=t[n];r.extensions&&r.extensions[Ix]&&a[e][n].setExtension(Ix,s[r.extensions[Ix].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const r of this.properties){n.push(r.toJSONLD());for(const i of r.listParents()){let r;switch(i.propertyType){case qy.ROOT:r=t.asset;break;case qy.SCENE:r=t.scenes[e.sceneIndexMap.get(i)];break;case qy.NODE:r=t.nodes[e.nodeIndexMap.get(i)];break;case qy.MESH:r=t.meshes[e.meshIndexMap.get(i)];break;case qy.MATERIAL:r=t.materials[e.materialIndexMap.get(i)];break;case qy.TEXTURE:r=t.images[e.imageIndexMap.get(i)];break;case qy.ANIMATION:r=t.animations[e.animationIndexMap.get(i)];break;default:r=null,this.document.getLogger().warn(`[${Ix}]: Unsupported parent property, "${i.propertyType}"`)}r&&(r.extensions=r.extensions||{},r.extensions[Ix]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Ix]={packets:n}),this}}Px.EXTENSION_NAME=Ix;const Rx=[wA,UA,zA,QA,cw,dw,vw,Ew,Mw,Iw,Ow,Gw,nx,Yw,ox,cx,fx,vx,bx,xx,Sx,Px];class Bx extends ly{constructor(e){super(),this._loadedLibs=!1,e=e||{method:cw.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=(new fA).registerExtensions(Rx).registerExtensions([Lx,Vx,Nx,jx,zx,Hx,Qx,Wx,qx,Xx,Yx,Kx,Jx,$x,Zx,eE,Gx]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...r}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,r);await this._loadLibs();const i={...r};t&&(i.externalImagesInExtras=!0);const s=await new Promise(((t,n)=>this.parse(e,t,n,i))),o=await super.parseAsync(s,i);if(!t)return o;if(!s)throw new Error("GLTFDracoExporter: gltf is null");let a=s;const l=a.byteLength||1/0,c=await("object"!=typeof a||a.byteLength?this._io.readBinary(new Uint8Array(a)):this._io.readJSON({json:a,resources:{}}));if(c.createExtension(cw).setRequired(!0).setEncoderOptions({...this._encoderOptions,...n??{}}),"glb"===i.exportExt)a=await this._io.writeBinary(c),isFinite(l)&&(a.byteLength/l).toFixed(5);else{const e=await this._io.writeJSON(c);a=e.json,Object.values(e.resources).filter((e=>e)).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),a.resources=e.resources)}a.__isGLTFOutput=!0;const u=await super.parseAsync(a,i);if(!u)throw new Error("GLTFDracoExporter: blob is null");return u.ext="glb",u.__uncompressed=o,u}}class kx extends qt{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[fo,Oy]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");!function(e,t,n){hy(e,t,Bx,(e=>{const t=lt()+".drc",r=e;r.loader=n.registerFile(t),r.loader.setDecoderConfig({type:"js"}),r.loader.preload(!0,!0)}))}(n,e,t)}}kx.PluginType="GLTFDracoExportPlugin";class Ox extends Fb{constructor(){super(...arguments),this.extensionName=_r,this.parentTypes=[qy.SCENE],this.propertyType="ViewerJSON"}init(){}}class Lx extends eA{constructor(){super(...arguments),this.extensionName=_r,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){return this._viewerConfig={},e.jsonDoc.json.scenes?.forEach(((t,n)=>{if(t.extensions&&t.extensions[_r]){const r=new Ox(this.document.getGraph());e.scenes[n].setExtension(_r,r),this._viewerConfig=t.extensions[_r]}})),this}write(e){return this.document.getRoot().listScenes().forEach((t=>{if(t.getExtension(_r)){const t=e.jsonDoc.json.scenes?.[e.jsonDoc.json.scene||0];t&&Object.keys(this._viewerConfig).length>0&&(t.extensions=t.extensions||{},t.extensions[_r]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}})),this}}Lx.EXTENSION_NAME=_r;class Fx extends Fb{addTexture(e,t,n,r=4369){this.setRef(e,n,{channels:r}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[qy.MATERIAL,qy.MESH,qy.NODE,qy.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class Ux extends eA{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],r=t.json.textures||[];return n.forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new Fx(this.document.getGraph(),"",this.extensionName);e.materials[n].setExtension(this.extensionName,i);const s={...t.extensions[this.extensionName]};for(const[t,n]of Object.entries(s))if("number"==typeof n?.index){const o=n,a=r[o.index]?.source;if("number"!=typeof a){console.warn("GLTF Pipeline: source texture not found for texture info",o);continue}const l=e.textures[a],c=new Ub(this.document.getGraph()),u=this.textureChannels[t]??4369;i.addTexture(t,c,l,u),e.setTextureInfo(c,o),delete s[t]}i.setExtras(s)}})),(t.json.meshes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new Fx(this.document.getGraph(),"",this.extensionName);e.meshes[n].setExtension(this.extensionName,r);const i=t.extensions[this.extensionName];r.setExtras(i)}})),(t.json.nodes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new Fx(this.document.getGraph(),"",this.extensionName);e.nodes[n].setExtension(this.extensionName,r);const i=t.extensions[this.extensionName];r.setExtras(i)}})),(t.json.scenes||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[this.extensionName]){const r=new Fx(this.document.getGraph(),"",this.extensionName);e.scenes[n].setExtension(this.extensionName,r);const i=t.extensions[this.extensionName];r.setExtras(i)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((n=>{const r=n.getExtension(this.extensionName);if(r){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{};const o={...r.getExtras()};for(const[t,n]of Object.entries(r.textures)){const r=n[0],i=n[1];i&&(o[t]=e.createTextureInfoDef(i,r))}s.extensions[this.extensionName]=o}})),this.document.getRoot().listMeshes().forEach((n=>{const r=n.getExtension(this.extensionName);if(r){const i=e.meshIndexMap.get(n),s=t.json.meshes[i];s.extensions=s.extensions||{},s.extensions[this.extensionName]=r.getExtras()}})),this.document.getRoot().listNodes().forEach((n=>{const r=n.getExtension(this.extensionName);if(r){const i=e.nodeIndexMap.get(n),s=t.json.nodes[i];s.extensions=s.extensions||{},s.extensions[this.extensionName]=r.getExtras()}})),this.document.getRoot().listScenes().forEach((n=>{const r=n.getExtension(this.extensionName);if(r){const n=e.jsonDoc.json.scene||0,i=t.json.scenes[n];if(!i)return;i.extensions=i.extensions||{},i.extensions[this.extensionName]=r.getExtras()}})),this}}class Nx extends Ux{constructor(){super(...arguments),this.extensionName=Nx.EXTENSION_NAME,this.textureChannels={bumpTexture:Ky.R}}}Nx.EXTENSION_NAME=Sr;class jx extends Ux{constructor(){super(...arguments),this.extensionName=jx.EXTENSION_NAME,this.textureChannels={lightMapTexture:Ky.R|Ky.G|Ky.B}}}jx.EXTENSION_NAME=Dr;class zx extends Ux{constructor(){super(...arguments),this.extensionName=zx.EXTENSION_NAME,this.textureChannels={alphaTexture:Ky.G}}}zx.EXTENSION_NAME=Tr;class Gx extends Ux{constructor(){super(...arguments),this.extensionName=Gx.EXTENSION_NAME,this.textureChannels={displacementTexture:Ky.R}}}Gx.EXTENSION_NAME=Mr;class Vx extends Ux{constructor(){super(...arguments),this.extensionName=Vx.EXTENSION_NAME}}Vx.EXTENSION_NAME=Tc.DIAMOND_GLTF_EXTENSION;class Hx extends Ux{constructor(){super(...arguments),this.extensionName=Hx.EXTENSION_NAME}}Hx.EXTENSION_NAME=Cl.AnimationMarkersExtension;class Qx extends Ux{constructor(){super(...arguments),this.extensionName=Qx.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Ky.R|Ky.G|Ky.B}}}Qx.EXTENSION_NAME=nc.ANISOTROPY_GLTF_EXTENSION;class Wx extends Ux{constructor(){super(...arguments),this.extensionName=Wx.EXTENSION_NAME,this.textureChannels={customBumpMap:Ky.R|Ky.G|Ky.B}}}Wx.EXTENSION_NAME=bl.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class qx extends Ux{constructor(){super(...arguments),this.extensionName=qx.EXTENSION_NAME}}qx.EXTENSION_NAME=yr;class Xx extends Ux{constructor(){super(...arguments),this.extensionName=Xx.EXTENSION_NAME}}Xx.EXTENSION_NAME=br;class Yx extends Ux{constructor(){super(...arguments),this.extensionName=Yx.EXTENSION_NAME}}Yx.EXTENSION_NAME=Ar;class Kx extends Ux{constructor(){super(...arguments),this.extensionName=Kx.EXTENSION_NAME}}Kx.EXTENSION_NAME=Lp.CLEARCOAT_TINT_GLTF_EXTENSION;class Jx extends Ux{constructor(){super(...arguments),this.extensionName=Jx.EXTENSION_NAME}}Jx.EXTENSION_NAME=ua.THIN_FILM_LAYER_GLTF_EXTENSION;class Zx extends Ux{constructor(){super(...arguments),this.extensionName=Zx.EXTENSION_NAME}}Zx.EXTENSION_NAME=Rp.TRIPLANAR_GLTF_EXTENSION;class $x extends Ux{constructor(){super(...arguments),this.extensionName=$x.EXTENSION_NAME}}$x.EXTENSION_NAME=Sp.SSBEVEL_GLTF_EXTENSION;class eE extends Ux{constructor(){super(...arguments),this.extensionName=eE.EXTENSION_NAME}}eE.EXTENSION_NAME=lp.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class tE extends t.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}tE.PluginType="PMREMGenerator";const nE=new n.Pa4,rE=new n._fP,iE=new n.Pa4;class sE extends n.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const oE=new n.yGw,aE=new n.yGw;class lE{constructor(e={}){const t=this;let n,r,i,s;const o={camera:{fov:0,style:""},objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",a.appendChild(l);const c=document.createElement("div");function u(e){return Math.abs(e)<1e-10?0:e}function h(e){const t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function p(e){const t=e.elements;return"translate(-50%,-50%)matrix3d("+u(t[0])+","+u(t[1])+","+u(t[2])+","+u(t[3])+","+u(-t[4])+","+u(-t[5])+","+u(-t[6])+","+u(-t[7])+","+u(t[8])+","+u(t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(t[13])+","+u(t[14])+","+u(t[15])+")"}function d(e,n,r,i){if(e.isCSS3DObject){const i=!0===e.visible&&!0===e.layers.test(r.layers);if(e.element.style.display=!0===i?"":"none",!0===i){let i;e.onBeforeRender(t,n,r),e.isCSS3DSprite?(oE.copy(r.matrixWorldInverse),oE.transpose(),0!==e.rotation2D&&oE.multiply(aE.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(nE,rE,iE),oE.setPosition(nE),oE.scale(iE),oE.elements[3]=0,oE.elements[7]=0,oE.elements[11]=0,oE.elements[15]=1,i=p(oE)):i=p(e.matrixWorld);const s=e.element,a=o.objects.get(e);if(void 0===a||a.style!==i){s.style.transform=i;const t={style:i};o.objects.set(e,t)}s.parentNode!==c&&c.appendChild(s),e.onAfterRender(t,n,r)}}for(let t=0,s=e.children.length;t<s;t++)d(e.children[t],n,r,i)}c.style.transformStyle="preserve-3d",l.appendChild(c),this.getSize=function(){return{width:n,height:r}},this.render=function(e,t){const a=t.projectionMatrix.elements[5]*s;let p,f;o.camera.fov!==a&&(l.style.perspective=t.isPerspectiveCamera?a+"px":"",o.camera.fov=a),t.view&&t.view.enabled?(l.style.transform=`translate( ${-t.view.offsetX*(n/t.view.width)}px, ${-t.view.offsetY*(r/t.view.height)}px )`,l.style.transform+=`scale( ${t.view.fullWidth/t.view.width}, ${t.view.fullHeight/t.view.height} )`):l.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(p=-(t.right+t.left)/2,f=(t.top+t.bottom)/2);const m=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,g=t.isOrthographicCamera?`scale( ${m} )scale(`+a+")translate("+u(p)+"px,"+u(f)+"px)"+h(t.matrixWorldInverse):`scale( ${m} )translateZ(`+a+"px)"+h(t.matrixWorldInverse),_=g+"translate("+i+"px,"+s+"px)";o.camera.style!==_&&(c.style.transform=_,o.camera.style=_),d(e,e,t,g)},this.setSize=function(e,t){n=e,r=t,i=n/2,s=r/2,a.style.width=e+"px",a.style.height=t+"px",l.style.width=e+"px",l.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px"}}}var cE,uE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let hE=cE=class extends qt{constructor(e=!0){super(),this._scene=new n.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject();if(!e?.geometry)return void await(this._viewer?.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const t=await(this._viewer?.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!t)return;const n=await(this._viewer?.prompt("Width: Enter the width for the object.","512",!1))||"512";n&&this.attachIFrame(e,t,parseInt(n))},this._resizeObserver=new ResizeObserver((()=>{this.enabled&&this._viewer?.scene.setDirty({sceneUpdate:!0})})),this.enabled=e,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const e=this._viewer;e&&this._renderer&&(e.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",e.canvas):this._renderer.domElement.appendChild(e.canvas))}_initialize(){if(this._renderer)return;if(!this._viewer)return;this._renderer=new lE;const e=this._viewer.renderer.rendererObject.getSize(new n.FM8);this._renderer.setSize(e.width,e.height);const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.zIndex="0",t.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(t),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",(()=>{if(!this._viewer||!this._renderer)return;const e=this._viewer.renderer.rendererObject.getSize(new n.FM8);this._renderer.setSize(e.width,e.height)}))}async onAdded(e){await super.onAdded(e);let t=!0,r=!0;e.addEventListener("postFrame",(i=>{t&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(r&&this._trackers.forEach((e=>{let t=!0;const r=e.modelObj.material.side;if(r!==n.ehD){const i=new n.Pa4(0,0,1).applyQuaternion(e.cssObj.quaternion),s=this._viewer?.scene.activeCamera?.cameraObject,o=i.dot(s.getWorldDirection(new n.Pa4));t=r===n._Li?o>0:o<0}e.cssObj.element.style.visibility=t?"visible":"hidden"})),this._trackers.filter((e=>e.dirty)).forEach((e=>this._syncProperties(e))),this._renderer?.render(this._scene,e.scene.activeCamera?.cameraObject),t=!1))})),e.addEventListener("update",(e=>{this.enabled&&(t=this._trackers.length>0)})),e.scene.addEventListener("sceneUpdate",(e=>{this.enabled&&(this._trackers.forEach((e=>e.dirty=!0)),t=this._trackers.length>0)})),e.scene.addEventListener("activeCameraUpdate",(e=>{this.enabled&&(t=this._trackers.length>0,r=!0)}));let i=!1;const s=new n.iMs;e.container.addEventListener("mousemove",(e=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const t=this._viewer.canvas.getBoundingClientRect(),n=(e.clientX-t.x)/t.width*2-1,r=-(e.clientY-t.y)/t.height*2+1;s.setFromCamera({x:n,y:r},this._viewer.scene.activeCamera.cameraObject);const o=this._trackers.map((e=>e.modelObj)),a=s.intersectObjects(o,!1);if(a.length)return this._viewer.canvas.style.pointerEvents="none",i=!0,void this._viewer.canvas.style.pointerEvents;i&&(this._viewer.canvas.style.pointerEvents="auto",i=!1)}))}attachIFrame(e,t,n){const r=mE(e.modelObject),i=pE(t,n,n*r.y/r.x,(()=>e.setDirty?.()));return this.attachCSS3DObject(i,e),i}attachCSS3DObject(e,t){if(this._trackers.push({cssObj:e,modelObj:t.modelObject,dirty:!0}),e.element&&(this._resizeObserver.observe(e.element),e.element.__isCSS3DObjectElement=!0,e.element,e.element.__isCSS3DObjectElement),t.userData.__oldMaterial=t.material,!t.setMaterial)throw"model not processed?";const r=this._viewer?.createMaterial("basic",{opacity:0,color:new n.Ilk("black"),blending:n.jFi,side:n.Wl3});if(!r)throw"cannot create mat";r.userData.forcedLinearDepth=0,t.setMaterial?.(r),dE(t.modelObject),fE(t.modelObject),mE(t.modelObject),this._scene.add(e),this.uiConfig?.uiRefresh?.(),t.setDirty?.()}_syncProperties(e){const t=e.modelObj,r=e.cssObj;t.updateMatrixWorld();const i=e.cssObj.element.clientWidth<1.5?0:(e.cssObj.element.clientWidth-1.5)/mE(t).x,s=dE(t);r.quaternion.setFromUnitVectors(new n.Pa4(0,0,1),s),r.position.copy(fE(t)),r.scale.set(1,1,1).multiplyScalar(1/i),r.updateMatrixWorld(),r.applyMatrix4(t.matrixWorld),e.dirty=!1}async onDispose(e){return this._resizeObserver.disconnect(),super.onDispose(e)}};function pE(e,t,n,r){const i=document.createElement("div");i.style.width=t.toString()+"px",i.style.height=n.toString()+"px",i.style.backgroundColor="transparent";const s=document.createElement("iframe",{is:"x-frame-bypass"});s.style.width="100%",s.style.height="100%",s.style.border="0px";const o=()=>{try{s.contentWindow.name}catch(e){("string"==typeof e?e:e?.toString?.()??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(e)}r(),s.removeEventListener("load",o)};return s.addEventListener("load",o),s.src=e,i.appendChild(s),new sE(i)}function dE(e){if(e.geometry.userData.geometryNormal)return e.geometry.userData.geometryNormal;const t=e.geometry.attributes.normal,r=new n.Pa4,i=new n.Pa4;for(let e=0,n=t.count;e<n;e++)r.fromBufferAttribute(t,e),i.add(r);return i.normalize(),e.geometry.userData.geometryNormal=i,i}function fE(e){if(e.geometry.userData.geometryCenter)return e.geometry.userData.geometryCenter;const t=e.geometry;if(!t)return new n.Pa4(0,0,0);t.boundingBox||t.computeBoundingBox();const r=t.boundingBox.getCenter(new n.Pa4);return e.geometry.userData.geometryCenter=r,r}function mE(e,t=new n.Pa4(0,0,1)){if(e.geometry.userData.geometrySize)return e.geometry.userData.geometrySize;const r=e.geometry;if(!r)return new n.Pa4(0,0,0);const i=r.clone();i.applyMatrix4((new n.yGw).makeRotationFromQuaternion((new n._fP).setFromUnitVectors(t,dE(e)).invert())),i.computeBoundingBox();const s=i.boundingBox.getSize(new n.Pa4);return e.geometry.userData.geometrySize=s,i.dispose(),s}hE.PluginType="CSS3DRenderer",uE([ht("Enabled"),(0,t.onChange)(cE.prototype._refreshEnabled),Oe()],hE.prototype,"enabled",void 0),uE([ht("Over canvas"),(0,t.onChange)(cE.prototype._refreshCanvasInDOM),Oe()],hE.prototype,"overCanvas",void 0),uE([gt("Attach iframe")],hE.prototype,"attachIFrameToSelected",void 0),hE=cE=uE([wt("CSS3D Renderer")],hE);class gE extends Vt{constructor(e,t,r,i=new n.Ilk(1,1,1),s=1){super(void 0,void 0,r,i,s),this.target=t,this._getSelectedObject=e}render(e,t,r,i,s){const o=e.getRenderTarget(),a=e.getActiveCubeFace(),l=e.getActiveMipmapLevel(),c=this._getSelectedObject();if(c)this._renderSelectedObject(e,c,t,i,s);else{e.setRenderTarget(this.target);const t=new n.Ilk;e.getClearColor(t),e.setClearColor(new n.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(t)}e.setRenderTarget(o,a,l)}_renderSelectedObject(e,t,n,r,i){if(!this.camera)return;t.traverse((e=>{e.layers.enable(6)}));const s=this.camera.layers.mask;this.camera.layers.set(6);const o=e.userData;o||console.error("threejs is not patched?"),o.transmissionRenderTarget=n,Y(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},(()=>super.render(e,n,this.target,r,i))),o.transmissionRenderTarget=void 0,t.traverse((e=>{e.layers.disable(6)})),this.camera.layers.mask=s}}var _E,vE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let yE=_E=class{constructor(e,r){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new n.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new n.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new n.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(e,n)=>this.enabled?t.glsl`
            ${Wt}
            ${"uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;\n#if DEBUG_OUTLINE > 0\ncolor=vec4(0.,0.,0.,1.);\n#endif\nvec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}"}
        `:"",this._combinedPostPlugin=e.getPlugin(xo),this._pickingPlugin=e.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),r&&(this.extraUniforms.outlineBuffer.value=r.texture),this._enable()}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = outline(gl_FragColor);\n            #glMarker\n        "))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){this.__setDirty?.(),this._setDirty()}_enable(){this._pickingPlugin?.enableWidget(!this.enabled),this._setDirty()}};yE.PluginType="Outline",vE([(0,t.onChange)(_E.prototype._enable),ht("Enable"),Oe()],yE.prototype,"enabled",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),ht("Highlight"),Oe()],yE.prototype,"enableHighlight",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),ht("DynamicSelection"),Oe()],yE.prototype,"enableDynamicSelection",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),dt("Intensity",[0,2],.001,{limitedUi:!0}),Oe()],yE.prototype,"outlineIntensity",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),dt("Transparency",[0,1],.01,{limitedUi:!0}),Oe()],yE.prototype,"highlightTransparency",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),vt("Color"),Oe()],yE.prototype,"outlineColor",void 0),vE([(0,t.onChange)(_E.prototype._setDirty),ht("Debug")],yE.prototype,"debugOutline",void 0),yE=_E=vE([wt("Outline")],yE);class bE extends Co{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new yE(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e?.getPluginByType("Picking"),r=new n.jyz({uniforms:{cameraNearFar:{value:new n.FM8(.1,100)}},vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vViewPosition;void main(){\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:n.ehD}),i=Xt(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new gE((()=>t?.getSelectedObject()),this._outlineTarget,r),update(){e.scene.activeCamera.updateShaderProperties(this.passObject.overrideMaterial)}});e.renderer.registerPass(i),i.passObject.scene=e.scene.modelObject,i.passObject.camera=e.scene.activeCamera.cameraObject,e.scene.addEventListener("activeCameraChange",(()=>{i.passObject.camera=e.scene.activeCamera.cameraObject})),t?.addEventListener("selectedObjectChanged",(()=>{!this._animationCallBack&&this._extension&&(t?.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)})),document.addEventListener("mousemove",(n=>{if(!this._extension)return;if(!this.mouseInOutAnimationEnabled)return;const r=t?.getSelectedObject();r&&this._extension.enableDynamicSelection?n.target!==e.canvas?this._animationCallBack||"in"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||"out"!==this._state||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=r?this._extension.highlightTransparency:1}))}async _startTransparencyAnimation(e,t,n){return Ih(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}bE.PluginType="Outline";const AE=.2,wE=Math.PI/24,xE=new n.FM8,EE=(e,t,n)=>{let r=t>0?n>0?0:-Math.PI/2:n>0?Math.PI/2:Math.PI;for(let i=0;i<=12;++i)e.push(t+.17*Math.cos(r),n+.17*Math.sin(r),0,t+AE*Math.cos(r),n+AE*Math.sin(r),0),r+=wE};class CE extends n.Kj0{constructor(e,t,r=!1){super(((e,t)=>{const r=new n.u9r,i=[],s=[],o=e.getSize(new n.Pa4),a=o.x/2,l=(t?o.y:o.z)/2;EE(s,a,l),EE(s,-a,l),EE(s,-a,-l),EE(s,a,-l);const c=s.length/3;for(let e=0;e<c-2;e+=2)i.push(e,e+1,e+3,e,e+3,e+2);const u=c-2;return i.push(u,u+1,1,u,1,0),r.setAttribute("position",new n.a$l(s,3)),r.setIndex(i),r})(e,r)),this.boundingSize=new n.Pa4,this._raycaster=new n.iMs,this._camera=t,this._placeOnWall=r;const i=this.material;i.side=n.Wl3,i.color=new xe(16711935),i.opacity=0,this.userData.bboxVisible=!1;const s=e.getSize(this.boundingSize),o=s.x/2,a=(r?s.y:s.z)/2;this.hitPlane=new n.Kj0(new n._12(2*(o+AE),2*(a+AE))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),r?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){xE.set(t,-n),this.hitPlane.visible=!0;const r=this._positionAndNormalFromPoint(xE,this.hitPlane);return this.hitPlane.visible=!1,null==r?null:r.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const r=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),r}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.geometry.dispose(),this.material.dispose(),this.parent?.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const r=this._raycaster.intersectObject(t,!0);if(0===r.length)return null;const i=r[0];return null==i.face?null:null==i.uv?{position:i.point,normal:i.face.normal,uv:null}:(i.face.normal.applyNormalMatrix((new n.Vkp).getNormalMatrix(i.object.matrixWorld)),{position:i.point,normal:i.face.normal,uv:i.uv})}}const SE=new n.Pa4;class ME{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new n.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new n.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new n.Pa4,this._hitMatrix=new n.yGw,this.xDamper=new t.Damper,this.yDamper=new t.Damper,this.zDamper=new t.Damper,this.yawDamper=new t.Damper,this.scaleDamper=new t.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const n=this.frame.getHitTestResultsForTransientInput(t),r=this.presentedScene,i=this.placementBox;if(1===n.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad||{axes:[0,0]},n=i.getHit(r,t[0],t[1]);i.show=!0,null!=n?(this.isTranslating=!0,this.lastDragPosition.copy(n),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===n.length){i.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(n);this.firstRatio=e/r.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){this.transientHitTestSource=await(e.requestHitTestSourceForTransientInput?.({profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){const t=this.xr?.getReferenceSpace(),n=t?e.getPose(t):null;return n?(this._hitMatrix.fromArray(n.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,r=t.rotation.y,i=this.placementBox,s=Math.max(i.boundingSize.x,i.boundingSize.y,i.boundingSize.z)/2,o=this.goalPosition,a=t.scale.x;if(!o.equals(n)||this.goalScale!==a){let{x:r,y:l,z:c}=n;r=this.xDamper.update(r,o.x,e,s),l=this.yDamper.update(l,o.y,e,s),c=this.zDamper.update(c,o.z,e,s),n.set(r,l,c);const u=this.scaleDamper.update(a,this.goalScale,e,1);if(t.scale.set(u,u,u),!this.isTranslating){const e=o.y-l;this.placementComplete&&!this.placeOnWall?i.offsetHeight=e/u:0===e&&(this.placementComplete=!0,i.show=!1)}}i.updateOpacity(e),t.rotation.y=this.yawDamper.update(r,this.goalYaw,e,Math.PI)}processInput(e){this.frame=e;const t=this.transientHitTestSource;if(!t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),r=this.presentedScene,i=r.scale.x;if(this.isTwoFingering)if(n.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(n);if(this.placeOnWall||(this.goalYaw+=t),!r.userData.__scaleDisabled){const t=e/this.firstRatio;this.goalScale=t<1.3&&t>.7692307692307692?1:t}}else if(2!==n.length)if(this.isRotating&&this.inputSource?.gamepad){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&n.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/i;const n=SE.copy(this.xr.getCamera().position),r=-e/(n.y-t.y);n.multiplyScalar(r),t.multiplyScalar(1-r).add(n)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(n);this.firstRatio=e/i}}getTouchLocation(){const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(SE.copy(t).sub(this.xr?.getCamera().position),SE.length()>10)?null:t}fingerPolar(e){const t=e[0].inputSource?.gamepad?.axes??[0,0],n=e[1].inputSource?.gamepad?.axes??[0,0],r=n[0]-t[0],i=n[1]-t[1],s=Math.atan2(i,r);let o=this.lastAngle-s;return o>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),this.lastAngle=s,{separation:Math.sqrt(r*r+i*i),deltaYaw:o}}}class TE{constructor(e,t,r,i,s){this.xrLight=e,this.renderer=t,this.lightProbe=r,this.xrWebGLBinding=null,this.estimationStartCallback=s,this.frameCallback=this.onXRFrame.bind(this);const o=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const r=new n.oAp(16);e.environment=r.texture;const i=t.getContext();switch(o.preferredReflectionFormat){case"srgba8":i.getExtension("EXT_sRGB");break;case"rgba16f":i.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,i),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/e,n.primaryLightIntensity.y/e,n.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class DE extends n.ZAu{constructor(e,t=!0){super(),this.lightProbe=new n.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new n.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let r=null,i=!1;e.xr.addEventListener("sessionstart",(()=>{const n=e.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then((n=>{r=new TE(this,e,n,t,(()=>{i=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{r&&(r.dispose(),r=null),i&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{r&&(r.dispose(),r=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var IE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let PE=class extends qt{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new ME,this.dependencies=[$t],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):(this._xrManager?.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=e.cameras[0]||e,n=this._viewer.scene.activeCamera;n.cameraObject.projectionMatrix.copy(t.projectionMatrix),n.cameraObject.projectionMatrixInverse.copy(n.cameraObject.projectionMatrix).invert()},this._postRender=()=>{if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const e=this._viewer.renderer,t=this._xrManager?.getCamera()?.cameras[0].viewport;t?e.rendererObject.setViewport(t):console.warn("no viewport for ar camera"),this._viewer.getPlugin($t).updateShaderProperties(RE.material),RE.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,Y(e.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},(()=>{RE.render(e.rendererObject,null,e.composer.readBuffer,0,!1)})),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:e,deltaTime:t})=>{if(this.dirty=!!e&&this._xrManager?.isPresenting||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting,this._frameCount++;const n=this._xrManager.getReferenceSpace(),r=e.getViewerPose(n);if(null==r&&this._frameCount,null==r||0===this._viewer?.scene.modelRoot.children.length)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const i=this._viewer.scene.activeCamera;this._xrManager.updateCamera(i.cameraObject),i.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(t),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new n.Pa4(1,1,1),modelPosition:new n.Pa4,modelRotation:new n._fP,cameraPosition:new n.Pa4(0,0,5),cameraTarget:new n.Pa4,cameraUp:new n.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new n.yGw,cameraAutoNearFar:void 0,groundOffset:new n.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new n.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far,this._preXRState.cameraAutoNearFar=t.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(t.cameraObject.projectionMatrix);const n=this._viewer.getPluginByType("Ground");n?.mesh&&(this._preXRState.groundOffset.subVectors(e.position,n.mesh.modelObject.position),this._preXRState.groundScale=n.mesh.modelObject.scale.x,this._preXRState.groundRotation=n.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=n.renderToDepth,this._preXRState.groundShadowBaker=n.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;const e=20*Math.PI/180,t=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const e=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await(this._xrSession.requestHitTestSource?.({space:e,offsetRay:t}))}})()},this._xrRenderingEnd=()=>{this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async e=>{e.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new DE(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",(()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))}))),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(e),this._xrSession=e},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;if(t.enabled=!0,t.cameraAutoUpdate=!1,this._xrManager=t,this._touchInputHelper.xr=t,!this.domOverlay){const e=document.getElementById("tweakpaneUiContainer");this.domOverlay=e?{root:e}:void 0}if(e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return e.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(t.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then((e=>{if(!e)throw new Error("AR not supported")})).catch((n=>{e.console.error("AR not supported:",n),t.enabled=!1,this.enabled=!1})):(t.enabled=!1,this.enabled=!1)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,t=this._viewer.getPluginByType("Ground")?.mesh?.modelObject;t&&(t.rotation.z=this._viewer.scene.modelRoot.rotation.y,t.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),t.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const t=e.getHitTestResults(this._hitTestSource);if(!t.length)return;const n=t[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const r=this._touchInputHelper.getHitPoint(n);if(!r)return;this._placementBox.show=!0;const i=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(r),i.position.copy(r),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera,r=this._xrManager?.getCamera(),i=r.cameras[0]||r;this._removePlacementBox();const s=this._viewer.scene.getBounds(!0,!0);s.getSize(new n.Pa4).length()>.01&&(this._placementBox=new CE(s,r,this.placeOnWall),e.add(this._placementBox),this._placementBox.show=!1);const o=r.getWorldDirection(new n.Pa4);e.rotation.y=Math.atan2(-o.x,-o.z)-0,t.cameraObject.zoom=i.zoom,t.cameraObject.near=i.near,t.cameraObject.far=i.far,t.cameraObject.userData.autoNearFar=!1,t.cameraObject.isPerspectiveCamera?(t.cameraObject.fov=i.fov,t.cameraObject.aspect=i.viewport.width/i.viewport.height):console.warn("Perspective camera required."),t.cameraObject.updateProjectionMatrix();const a=e.userData.arScale||1;e.scale.set(a,a,a),e.position.copy(r.position).add(o.multiplyScalar(5)),e.visible=!0;const l=this._viewer?.getPluginByType("Ground");l?.mesh&&(l.shadowBaker.enabled=!1,l.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,t.cameraObject.isPerspectiveCamera&&(void 0!==this._preXRState.cameraFov&&(t.cameraObject.fov=this._preXRState.cameraFov),void 0!==this._preXRState.cameraAspect&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),t.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix();const n=this._viewer.getPluginByType("Ground");n?.mesh&&(n.mesh.modelObject.position.subVectors(e.position,this._preXRState.groundOffset),n.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),n.mesh.modelObject.rotation.z=this._preXRState.groundRotation,n.renderToDepth=this._preXRState.groundRenderToDepth,n.shadowBaker.enabled=this._preXRState.groundShadowBaker,n.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};PE.PluginType="WEBXR_ARPlugin",IE([ht("Light Estimate")],PE.prototype,"estimateLighting",void 0),IE([ht("Place on Wall")],PE.prototype,"placeOnWall",void 0),IE([dt("Resilution scale",[.1,1],.1)],PE.prototype,"xrResolutionScale",void 0),IE([gt("Enter AR")],PE.prototype,"enterAR",void 0),IE([gt("Exit AR")],PE.prototype,"exitAR",void 0),PE=IE([wt("WebXR AR")],PE);const RE=new Gt({vertexShader:r.vertexShader,fragmentShader:`\n        ${Wt}\n        \n        uniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tTransparentMap;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\n            float depth = getDepth(vUv);\n            vec4 texel;\n            if(depth>0.9999) {\n\t\t\t    texel = texture2D( tTransparentMap, vUv );\n                if(texel.a < 0.01) discard; // background\n                // transparent objects with render to depth = false\n            }else {\n                texel = texture2D( tDiffuse, vUv );\n\t\t\t}\n            gl_FragColor = texel;\n            \n\t\t}\n\t\t`,uniforms:{...r.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});RE.renderToScreen=!1,RE.useExistingRenderTarget=!0,RE.clear=!1;class BE extends t.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=e=>{e.data&&e.data.size>0&&this._currentRecording.push(e.data)},this._canvas=e,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return"recording"===this._state}requestFrame(){return"recording"===this._state&&(this._frameCount++,!0)}dispose(){(this.isRecording()||"paused"===this._state)&&this.stop((e=>{this._console.warn("disposed with blob",e),this.dispose()}))}}class kE extends BE{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if("recording"!==this.state){if("error"===this.state&&this._console.warn("Resetting from error state."),"paused"===this.state)return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then((async e=>{const t=await(e?.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")})).catch((e=>{this._onerror({detail:e})}))}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob((t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])}),e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){"paused"!==this.state&&"stopped"!==this.state&&this.setState("paused")}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const n=[];for(const r of e){const e=await this._imgDirectory.getFileHandle(r[0],{create:!0});n.push((0,t.writeFile)(e,r[1]))}await Promise.all(n)}}class OE extends BE{_setOptions(e){super._setOptions(e),this.options.mimeType&&"auto"!==this.options.mimeType||(this.options.mimeType=OE.GetSupportedMimeTypes([],["h264"],!0)??OE.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!this.options.mimeType?.startsWith("video/")||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,n){super(e,n),this._resumeSyncTime=0,this._onstop=e=>{if(this._recorder&&this._currentRecording.length>0){const e=new Blob(this._currentRecording,{type:this.options.mimeType});this._recordingCallback?.(e)}this._recorder=void 0,this.setState("stopped")},this._onstart=e=>{this._frameCount=0,this.options.stepMode&&this._recorder?.pause(),this.setState("recording")},this._onresume=e=>{if("paused"!==this.state&&"starting"!==this.state&&"stopped"!==this.state||this.setState("recording"),!this.options.stepMode)return;const n=()=>{"recording"===this.state&&this._recorder?.pause()},r=Math.min(this._resumeSyncTime-(0,t.now)(),0)+1e3/this.options.frameRate;r>0?(0,t.timeout)(r).then(n):n()},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e),this._recorder=void 0}}start(){if("recording"===this.state)return void this._console.log("Already recording canvas");if("error"===this.state&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return"paused"===this.state?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,e.mimeType?.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const t=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),n=t.getVideoTracks()?.[0];this._track=n,this._recorder=new window.MediaRecorder(t,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&this._recorder?.start()}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,t.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){"paused"!==this.state&&"stopped"!==this.state&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter((t=>!e||e.length<1||e.includes(t))),i=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter((e=>!t||t.length<1||t.includes(e))),s=[];return r.forEach((e=>{const t=`video/${e}`;i.forEach((e=>{[`${t};codecs=${e}`,`${t};codecs:${e}`,`${t};codecs=${e.toUpperCase()}`,`${t};codecs:${e.toUpperCase()}`,`${t}`].forEach((e=>{MediaRecorder.isTypeSupported(e)&&s.push(e)}))}))})),n?s.length>0?s[0]:void 0:s}}class LE extends BE{constructor(e,n){super(e,n),this._workerRunning=!1,this.worker=new Worker((0,t.remoteWorkerURL)(LE.LIBRARY_PATH+"ffmpeg-worker-mp4.js",LE.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm"));let r=0;this.worker.onmessage=e=>{const t=e.data;switch(t.type){case"stdout":case"stderr":if(0===t.data.indexOf("frame=")){const e=parseInt(t.data.split("frame=")[1].split("fps")[0].trim()),n=this._frameCount,r=Math.round(e/n*100);this.dispatchEvent({type:"encode-progress",progress:r,frame:e,totalFrames:n})}t.data;break;case"exit":t.data,r=parseInt(t.data);break;case"done":if(void 0===t.data.MEMFS[0].data)return;this._workerRunning=!1,this._recordingCallback?.(new Blob([t.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){"recording"!==this.state&&("error"===this.state&&console.warn("Resetting from error state."),"paused"!==this.state&&(this._frameCount=0),this.setState("starting"),this.setState("recording"))}stop(e){"stopped"!==this.state&&("error"!==this.state?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob((t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})}),"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){"paused"!==this.state&&"stopped"!==this.state&&this.setState("paused")}}LE.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var FE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class UE extends qt{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{if(this.convergeMode&&this._recorder?.isRecording()){const e=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=this._viewer?.getPluginByType("Progressive")?.isConverged()||!1,e&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{if(this._recorder?.isRecording()&&(!this.convergeMode||this._viewer?.getPluginByType("Progressive")?.isConverged(!0))){const e=()=>this._recorder?.requestFrame();if(this.convergeMode){const n=1;(0,t.timeout)(n).then(e)}else e()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{this.uiConfig.children?.map((e=>(0,t.getOrCall)(e))).flat(2).forEach((e=>e?.uiRefresh?.()))},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map((e=>({label:e[0],value:e[1]})))},{type:"input",disabled:!0,label:"State",getValue:()=>this.recorder?.state??"not initialized"},{type:"button",label:()=>this.recorder?.isRecording()?"Stop Recording":"Start Recording",value:()=>{this.recorder?.isRecording()?this.stopRecording().then((async e=>{if(e){const t=e.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(e,t)}})):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>!!this.recorder?.isRecording()||!this._viewer?.getPluginByType("CameraViews"),value:()=>{this._viewer?.getPluginByType("CameraViews")?.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>!!this.recorder?.isRecording()||!this._viewer?.getPluginByType("CameraViews")||!this._viewer?.getPluginByType("GLTFAnimation")?.animations.length,value:()=>{const e="playing"===this._viewer?.getPluginByType("GLTFAnimation")?.animationState;this._viewer?.getPluginByType("CameraViews")?.recordAllViews((()=>{this._viewer?.getPluginByType("GLTFAnimation")?.playAnimation()})).then((()=>{e||this._viewer?.getPluginByType("GLTFAnimation")?.stopAnimation()}))}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>!!this.recorder?.isRecording()||!this._viewer?.getPluginByType("GLTFAnimation")?.animations.length,value:async()=>{if(this.recorder?.isRecording())return;const e=this._viewer?.getPluginByType("GLTFAnimation");if(!e)return;let t=!1;e.loopAnimations&&(t=!0),t&&(e.loopAnimations=!1);const n=await this.record((async()=>e.playAnimation()));if(t&&(e.loopAnimations=!0),n){const e=n.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(n,e)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>!!this.recorder?.isRecording(),value:async()=>{if(this.recorder?.isRecording())return;if(!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(null===e)return;const t=parseFloat(e||"5");if(!isFinite(t)||t<=0)return;const r=this._viewer.scene.activeCamera,i=r.interactionsEnabled;i&&(r.interactionsEnabled=!1);const s=r.position.clone(),o=await this._viewer.getPluginByType("PopmotionPlugin");if(!o)return void console.error("Popmotion plugin not found");const a=(new n.$V).setFromVector3(s);r.position.setFromSpherical(a),r.positionUpdated(!0);const l=await this.record((async()=>o.animate({from:a.theta,to:a.theta+2*Math.PI,duration:1e3*t,ease:Mh.linear,onUpdate:e=>{a.theta=e,r.position.setFromSpherical(a),r.positionUpdated(!0)}}).promise));if(r.position.copy(s),r.positionUpdated(!0),i&&(r.interactionsEnabled=!0),l){const e=l.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(l,e)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){return this._recorder?.isRecording()??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";"video/mp4"===this.mimeType?e="ffmpeg.js":"auto"===this.mimeType?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",e.canvas.parentElement?.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){this.dirty=e,this._viewer?.setDirty(),this.uiConfig.children?.map((e=>(0,t.getOrCall)(e))).flat(2).forEach((e=>e?.uiRefresh?.()))}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),this._recorder?.dispose(),Object.values(this._recorders).forEach((e=>{e?.dispose()})),super.onRemove(e)}async record(e,t){if(this.enabled&&!this._recorder?.isRecording())return await new Promise(((n,r)=>{const i=()=>{this.removeEventListener("start",s),this.removeEventListener("stop",i),this.removeEventListener("error",o)},s=async()=>{i(),t?.(),await e(),n()},o=async()=>{i(),r()};this.addEventListener("start",s),this.addEventListener("stop",i),this.addEventListener("error",o),this.startRecording()})),await this.stopRecording()}startRecording(){return!!this.enabled&&!1===this.recorder?.isRecording()&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){if(this.recorder?.isRecording())return new Promise(((e,t)=>this.recorder?.stop(e)))}async _downloadBlob(e,t){const n=await(this._viewer?.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),r=this._viewer?.getPluginByType("FileTransferPlugin");r?await r.exportFile(e,n||"recording.mp4"):this._viewer?.console.error("FileTransferPlugin required to export/download file")}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t="canvas-media"===e?new OE(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):"ffmpeg.js"===e?new LE(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new kE(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",(()=>this._stateChange(!1))),t.addEventListener("recording",(()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)})),t.addEventListener("error",(()=>{this.dispatchEvent({type:"error"})})),t.addEventListener("paused",(()=>this._stateChange(!1))),t.addEventListener("stopped",(()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)})),t.addEventListener("encode-progress",(e=>{this.dispatchEvent({...e})})),this._recorders[e]=t,t}}UE.PluginType="CanvasRecorder",FE([(0,t.onChange)(UE.prototype.refreshRecorderOptions),Oe()],UE.prototype,"convergeMode",void 0),FE([(0,t.onChange)(UE.prototype.refreshRecorderOptions),Oe()],UE.prototype,"mimeType",void 0),FE([(0,t.onChange)(UE.prototype.refreshRecorderOptions),Oe()],UE.prototype,"videoFrameRate",void 0);var NE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const jE=new n.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});jE.depthTest=!1;const zE=new n.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});zE.depthTest=!1;class GE extends V_{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new n.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Rd)}async onAdded(e){const t=e.renderer.createTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:n.wem,magFilter:n.wem});t.texture.name="groundContactDepthTexture";const r=new n.lRF({depthPacking:n.z81});r.onBeforeCompile=function(e){e.uniforms.opacity.value=1,e.fragmentShader=`\n\t\t\t\t\t\t${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}\n\t\t\t\t\t`};const i=new Zt(t,r,new n.Ilk(0,0,0),0);this._depthPass=i,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer)return;if(!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:n.ywz,format:n.wk1,colorSpace:n.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:n.wem,magFilter:n.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(jE.uniforms.h.value=t*this.blurAmount/256,zE.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:jE,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:zE,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new n.Pa4)),this.shadowCamera.setRotationFromEuler(new n.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){this._viewer?.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material?(this._material.alphaMap=this._depthPass?.target.texture||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1),e):e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function VE(e,t,r,i){e.traverse((e=>{e&&(e.userData.cloneRotI=t,e.userData.rotationCount=r,e.userData.rotationAxis=i,e.addEventListener("beforeRender",(t=>function(e,t){t&&t.map?.isTexture&&(t.extraUniformsToUpload||(t.extraUniformsToUpload={}),t.extraUniformsToUpload.uvTransform||(t.extraUniformsToUpload.uvTransform={value:new n.Vkp}),t.extraUniformsToUpload.uvTransform.value.setUvTransform(t.map.offset.x*t.map.repeat.x*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.offset.y*t.map.repeat.y*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.repeat.x,t.map.repeat.y,t.map.rotation,t.map.center.x,t.map.center.y))}(e,t.material))))}))}function HE(e,t,n,r="x"){if(e.userData.rotationCount>1&&!e.userData.rotationRoot)return e;const i=e.parent;if(!i)throw new Error("No parent");if(e.userData.cloneParent){const t=e.userData.cloneParent;if(!(e=i.children.find((e=>t===e.uuid))))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",t,i),e}let s=i.children.filter((t=>t.userData?.cloneParent===e.uuid)).sort(((e,t)=>e.userData.cloneRotI-t.userData.cloneRotI));if(e.userData.rotationCount===t&&t===s.length&&void 0===n&&e.userData.rotationAxis===r)return e;if(null==n&&(n=e.userData.rotationSkips??[]),n!==e.userData.rotationSkips&&(e.userData.rotationSkips=[...n]),VE(e,0,t,r),e.userData.rotationRoot=!0,e.visible=!0,t<=s.length){for(let e=t-1;e<s.length;e++)i.remove(s[e]),s[e].traverse((e=>e.userData={__disposed:!0}));s=s.slice(0,t)}for(let o=1;o<t;o++){const a=o<=s.length?s[o-1]:e.clone();a.rotation.copy(e.rotation),a.rotation[r]+=o/t*Math.PI*2,VE(a,o,t,r),o>s.length&&i.add(a),a.visible=!n.includes(o)}return e.visible=!n.includes(0),e}GE.PluginType="ContactShadowGroundPlugin",NE([(0,t.onChange)(GE.prototype.refreshOptions),Oe()],GE.prototype,"contactShadows",void 0),NE([Oe(),(0,t.onChange)(GE.prototype._setDirty)],GE.prototype,"blurAmount",void 0),NE([Oe(),(0,t.onChange)(GE.prototype._refreshShadowCameraFrustum)],GE.prototype,"shadowScale",void 0),NE([Oe(),(0,t.onChange)(GE.prototype._refreshShadowCameraFrustum)],GE.prototype,"shadowHeight",void 0);var QE,WE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let qE=QE=class extends qt{async onAdded(e){await super.onAdded(e),e.getPluginByType("Picking")?.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){if(!this.enabled)return;const e=this._viewer?.getPluginByType("Picking")?.getSelectedObject();if(!e)return void this.uiConfig.uiRefresh?.("postFrame",!0);const t=e.userData.rotationRoot?e.userData.rotationCount??1:1;this.rotations=t,this.skips=e.userData.rotationSkips?.join(",")??"",this.axis=e.userData.rotationAxis||"x",this.uiConfig.uiRefresh?.("postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const e=this._viewer?.getPluginByType("Picking")?.getSelectedObject();if(e){if(this.rotations>1||e.userData.rotationCount){const t=e.userData.rotationCount,r=HE(e,this.rotations,this.skips.split(",").map((e=>parseInt(e))).filter((e=>isFinite(e))),this.axis),i=r?.userData.rotationCount;if(i&&i!==t){const e=[];r?.traverseAncestors((t=>{e.push(t)}));for(const t of e)if(t.userData.autoScaled){J(t),this._viewer?.resetCamera({rootObject:t,centerOffset:new n.Pa4(4,4,4)});break}}e.parent&&!e.userData.__disposed||this._viewer?.getPluginByType("Picking")?.setSelectedObject(r,!0)}this._viewer?.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};qE.PluginType="ObjectRotationPlugin",WE([Oe(),ht("Enabled"),(0,t.onChange)(QE.prototype._paramsChanged)],qE.prototype,"enabled",void 0),WE([dt("Rotation Count",[1,100],1,(e=>({hidden:()=>!e._viewer?.getPluginByType("Picking")?.getSelectedObject()||!e.rotations}))),(0,t.onChange)(QE.prototype._paramsChanged)],qE.prototype,"rotations",void 0),WE([mt("Axis",["x","y","z"].map((e=>({label:e}))),(e=>({hidden:()=>!e._viewer?.getPluginByType("Picking")?.getSelectedObject()||!e.rotations}))),(0,t.onChange)(QE.prototype._paramsChanged)],qE.prototype,"axis",void 0),WE([_t("Rotation Skips",(e=>({hidden:()=>!e._viewer?.getPluginByType("Picking")?.getSelectedObject()||!e.rotations}))),(0,t.onChange)(QE.prototype._paramsChanged)],qE.prototype,"skips",void 0),qE=QE=WE([wt("Object Rotations")],qE);var XE,YE=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let KE=XE=class extends qt{constructor(e=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,r)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <map_fragment>");for(const t of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=Lt(e.fragmentShader,`#include <${t}>`,n.WdD[t].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=Lt(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=Lt(e.fragmentShader,"#include <normal_fragment_maps>",Lt(Lt(n.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?"#ifdef USE_BUMPMAP\nmat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){\n#if defined( TANGENTSPACE_NORMALMAP ) && 0 \nvec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);\n#else\nvec2 texOffs=1./bumpMapSize;\n#if PARALLAX_NORMAL_MAP_QUALITY > 0\nfloat hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);\n#else\nfloat h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);\n#endif\nreturn normalize(vec3(deltaH/texOffs,1.));\n#endif\n}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}\n#pragma unroll_loop_end\nbestBumpHeight+=bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}\n#pragma unroll_loop_end\nbestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);\n#ifdef FLIP_SIDED\nnormal=-normal;\n#endif\nreturn parallaxUv;}\n#endif \n\n".replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>this.enabled+" "+e.materialObject.bumpMap?.uuid+" "+this.debugNormals+" "+this.debugHitHeight+"  ",onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[e,n]of Object.entries(this._defines)){const r="number"==typeof n?n:n?1:0;t.defines[e]!==r&&(t.defines[e]=r,t.needsUpdate=!0)}}},this.dependencies=[fo],this.enabled=e,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){this._bumpMapExtension?.setDirty?.(),this._viewer?.setDirty()}async onAdded(e){return e.getPlugin(fo)?.materials?.registerMaterialExtension(this._bumpMapExtension),super.onAdded(e)}async onRemove(e){return e.getPlugin(fo)?.materials?.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(e)}};KE.PluginType="ReliefParallaxMapping",YE([(0,t.onChange)(XE.prototype._updateExtension),Oe(),ht("Enabled")],KE.prototype,"enabled",void 0),YE([(0,t.onChange)(XE.prototype._updateExtension),ht("Debug Normals")],KE.prototype,"debugNormals",void 0),YE([(0,t.onChange)(XE.prototype._updateExtension),ht("Debug Hit Height")],KE.prototype,"debugHitHeight",void 0),YE([W("PARALLAX_MAP_STEPS",void 0,!0,XE.prototype._updateExtension),dt("Step count",[1,32],1),Oe()],KE.prototype,"stepCount",void 0),YE([W("PARALLAX_MAP_B_STEPS",void 0,!0,XE.prototype._updateExtension),dt("Binary search steps",[1,8],1),Oe()],KE.prototype,"binaryStepCount",void 0),KE=XE=YE([wt("Parallax Mapping")],KE);class JE extends n.u9r{constructor(e,t,r=32,i=64,s=!1,o=new n.FM8(1,1),a="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:r,tubularSegments:i,closed:s,primary:a,shapeScale:o.clone()};const l=t.computeFrenetFrames(i,s);this.frames=l;const c=new n.Pa4,u=new n.Pa4,h=new n.Pa4,p=new n.FM8;let d=new n.Pa4;const f=[],m=[],g=[],_=e.getSpacedPoints(r);for(const e of _)e.multiply(o);!function(){for(let e=0;e<i;e++)y(e);y(!1===s?i:0),function(){for(let e=0;e<=i;e++)for(let t=0;t<=r;t++)p.x=e/i,p.y=t/r,m.push(p.x,p.y)}(),function(){const e="shape"===a,t=e?r:i,n=e?i:r;for(let i=1;i<=t;i++)for(let t=1;t<=n;t++){const[n,s]=e?[t,i]:[i,t],o=(r+1)*(n-1)+(s-1),a=(r+1)*n+(s-1),l=(r+1)*n+s,c=(r+1)*(n-1)+s;g.push(o,a,c),g.push(a,l,c)}}()}(),this.setIndex(g),this.setAttribute("position",new n.a$l(f,3)),this.setAttribute("uv",new n.a$l(m,2)),this.computeVertexNormals();const v=this.attributes.normal;function y(e){d=t.getPointAt(e/i,d);const n=l.normals[e],s=l.binormals[e];for(let e=0;e<=r;e++){const t=_[e%r];u.set(0,0,0).addScaledVector(n,t.x).addScaledVector(s,t.y),c.copy(d).add(u),f.push(c.x,c.y,c.z)}}!function(){for(let e=1;e<r;e++){const t=e+i*(r+1);u.fromBufferAttribute(v,e),h.fromBufferAttribute(v,t),u.add(h).normalize(),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(t,u.x,u.y,u.z)}for(let e=1;e<i;e++){const t=e*(r+1),n=t+r;u.fromBufferAttribute(v,t),h.fromBufferAttribute(v,n),u.add(h).normalize(),v.setXYZ(t,u.x,u.y,u.z),v.setXYZ(n,u.x,u.y,u.z)}u.fromBufferAttribute(v,0),h.fromBufferAttribute(v,r),u.add(h);const e=i*(r+1);h.fromBufferAttribute(v,e),u.add(h),h.fromBufferAttribute(v,e+r),u.add(h),u.normalize(),v.setXYZ(0,u.x,u.y,u.z),v.setXYZ(r,u.x,u.y,u.z),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(e+r,u.x,u.y,u.z),v.needsUpdate=!0}()}createSplits(e){this.clearGroups();const t="shape"===this.parameters.primary?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,r=[...e,1].sort(((e,t)=>e-t));let i=0,s=0;for(const e of r){const r=Math.round(t*e)*n/t;this.addGroup(i,r-i,s++),i=r}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var ZE,$E=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let eC=ZE=class extends qt{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new n.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject();if(!e)return;let t=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!t)return;t=parseFloat(t);const n=new tC(0,0,t,t,0,2*Math.PI,!0,0);await this.extrudeObject(e,n)}}async onAdded(e){await super.onAdded(e)}static CreateCurve(e,t){if("circle"===e)return new tC(0,0,t.radius??1,t.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(e,t,r=this.shapeSegments,i=this.tubularSegments,s=this.shapeScale,o=this.materialSplits.split(",").map((e=>parseFloat(e.trim()))),a=this.horizontalSplits){if(e.userData.isExtrudedTube,e.userData._extrudeSource){const t=e.userData._extrudeSource;if(e=e.parent?.children.find((e=>t===e.uuid)),!e)return void console.warn("Could not find extrude source with uuid",t)}if(e.userData.extrudedObject){const t=e.userData.extrudedObject,n=e.parent?.children.find((e=>t===e.uuid));n&&(n.removeFromParent(),n.geometry.dispose(),n.geometry=null,n.material=null),delete e.userData.extrudedObject}const l=e.geometry;if(!l)return void this._viewer?.alert("Extrude: No geometry to extrude");const c=[e.material];let u;try{const e=ZE.ConvertGeometryToFlatShape(l);u=new JE(e,t,r,i,!0,s,a?"shape":"path"),u.computeBoundingBox(),u.createSplits(o)}catch(e){return void this._viewer?.alert("string"==typeof e?e:e?.message)}c[0].color.set(16777215);for(let e=c.length;e<u.groups.length;e++){const e=c[0].clone();c.push(e),e.color.set(16777215*Math.random())}const h=new n.Kj0(u,c);h.userData._extrudeSource=e.uuid,h.userData.isExtrudedTube=!0,e.visible=!1,e.userData.bboxVisible=!1,h.name=e.name+"_extruded";const p=await(this._viewer?.getManager()?.importer?.processImportedSingle(h,{autoCenter:!1,autoScale:!1}));p&&(e.parent?.add(p.modelObject),e.userData.extrudedObject=p.modelObject.uuid,p.dispatchEvent({type:"select",ui:!0,value:p}))}static ExtrudeShape(e,t,r,i,s,o,a,l){const c=new JE(e,i,t,r,!0,new n.FM8(s,o),l?"shape":"path");c.computeBoundingBox(),c.createSplits(a);const u=new n.Kj0(c,[]);return u.userData.isExtrudedTube=!0,u}static ConvertGeometryToFlatShape(e,t=!0){if(e.userData.__planarShape)return e.userData.__planarShape;let r=e.attributes.position;if(!r)throw"no position attribute";if(r.count>500)throw"too large to extrude";const i=e;r=i.attributes.position,i.boundingBox||i.computeBoundingBox();const s=i.boundingBox.getSize(new n.Pa4),o=s.x<.001?"x":s.y<.001?"y":s.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let e=0;e<r.count;e++){const t=new n.FM8;"x"===o?t.set(r.getY(e),r.getZ(e)):"y"===o?t.set(r.getX(e),r.getZ(e)):t.set(r.getX(e),r.getY(e)),a.push(t)}if(t){let e=0;for(let t=0;t<a.length;t++)(a[t].x<a[e].x||a[t].x===a[e].x&&a[t].y<a[e].y)&&(e=t);0!==e&&(a=a.slice(e).concat(a.slice(0,e)))}const l=new n.bnF(a);return e.userData.__planarShape=l,l}};eC.PluginType="ShapeTubeExtrudePlugin",$E([ht("Enabled")],eC.prototype,"enabled",void 0),$E([dt("Shape Segments (X)",[1,100],1,(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"shapeSegments",void 0),$E([dt("Tube Segments (Y)",[1,100],1,(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"tubularSegments",void 0),$E([ft("Shape scale",[.01,10],.01,(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"shapeScale",void 0),$E([_t("Material Splits",(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"materialSplits",void 0),$E([ht("Horizontal Splits",(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"horizontalSplits",void 0),$E([gt("Extrude Circle Tube",(e=>({hidden:()=>!e._viewer?.getPlugin(_l)?.getSelectedObject()})))],eC.prototype,"extrudeCirceTube",void 0),eC=ZE=$E([wt("Extrude Tube Shapes")],eC);class tC extends n.Ny0{getPoint(e,t){return super.getPoint(e,t||new n.Pa4)}}class nC extends qt{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&(this._viewer.getPluginByType("FrameFade")?.enable(nC.PluginType),this._fadeDisabled=!1));const e=(0,t.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let n=e-this._lastFrameTime;this._lastFrameTime=e;const r=this._viewer.getPluginByType("Progressive")?.postFrameConvergedRecordingDelta();if(r&&r>0&&(n=r),0!==r&&(n*=1e3,!(n<=.001)&&(this._updaters.forEach((e=>{let t=n;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)})),!this._fadeDisabled&&this.disableFrameFade))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(nC.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex((t=>t.u===e)),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=lt(),n={id:t,options:e,stop:()=>{this.animations[t]?._stop?this.animations[t]?._stop?.():console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise(((n,r)=>{const i={driver:this.defaultDriver,...e,onComplete:()=>{try{e.onComplete?.()}catch(e){return void r(e)}n()},onStop:()=>{try{e.onStop?.()}catch(e){return void r(e)}n()}},s=Sh(i);this.animations[t]._stop=s.stop,this.animations[t].options=i})).then((()=>(delete this.animations[t],t))),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}nC.PluginType="PopmotionPlugin";var rC,iC,sC=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const oC=e=>({onChange:t=>{t.last&&e.onChange()}});let aC=rC=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(e){Object.assign(this,e)}reset(){const e=this.onChange;Object.assign(this,new rC),this.onChange=e}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};sC([_t("Text",oC)],aC.prototype,"text",void 0),sC([dt("Font Size",[2,400],1,oC)],aC.prototype,"fontSize",void 0),sC([dt("Width",[2,4096],1,oC)],aC.prototype,"width",void 0),sC([dt("Height",[2,4096],1,oC)],aC.prototype,"height",void 0),sC([dt("X Offset",[-1024,1024],1,oC)],aC.prototype,"xOffset",void 0),sC([dt("Y Offset",[-1024,1024],1,oC)],aC.prototype,"yOffset",void 0),sC([dt("V-Width",[2,4096],1,oC)],aC.prototype,"boxWidth",void 0),sC([dt("V-Height",[2,4096],1,oC)],aC.prototype,"boxHeight",void 0),sC([mt("Text Anchor",["start","middle","end"].map((e=>({label:e}))),oC)],aC.prototype,"textAnchor",void 0),sC([_t("Font",oC)],aC.prototype,"fontFamily",void 0),sC([_t("Font Url",oC)],aC.prototype,"fontPath",void 0),sC([ht("Mask Text",oC)],aC.prototype,"maskText",void 0),sC([ht("Inner Shadow",oC)],aC.prototype,"innerShadow",void 0),sC([vt("Text Color",oC)],aC.prototype,"textColor",void 0),sC([vt("BG Fill",oC)],aC.prototype,"bgFillColor",void 0),sC([vt("SVG BG",oC)],aC.prototype,"svgBackground",void 0),aC=rC=sC([wt("Text SVG Options")],aC);const lC={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},cC=e=>({hidden:()=>{const t=e.getSelected();return!t||!t.userData[uC.PluginType]}});let uC=iC=class extends qt{async onAdded(e){await super.onAdded(e),e.getPluginByType("Picking")?.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>this._viewer?.getPluginByType("Picking")?.getSelectedObject(),this.options=new aC,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){if(!this.enabled)return;const e=this.getSelected();if(!e)return void this.uiConfig.uiRefresh?.("postFrame",!0);const t=e.userData[iC.PluginType];if(!t)return this.options.reset(),this._lastMeta=void 0,void this.uiConfig.uiRefresh?.("postFrame",!0);this._lastMeta!==t&&(this.options.set(t),this._lastMeta=t),this.uiConfig.uiRefresh?.("postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const e=this.getSelected();e&&e.isMesh&&e.userData[iC.PluginType]&&this.updateText(e,this.options.toJSON())}async addTextToSelected(){const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[iC.PluginType]||!e.material.map||await(this._viewer?.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(e,t){return this.updateText(e,Object.assign(this.options.toJSON(),t))}async updateText(e,t){if(!e.isMesh)return;if(!e.material)return void console.error("updateText: no material on mesh");let n=e.userData[iC.PluginType];n||(e.userData[iC.PluginType]=n={}),Object.assign(n,t);const r=e.material;r.map&&(r.map._isSimpleTextTexture&&r.map.dispose(),r.map=void 0),r.alphaMap&&(r.alphaMap._isSimpleTextTexture&&r.alphaMap.dispose(),r.alphaMap=void 0),r.bumpMap&&(r.bumpMap._isSimpleTextTexture&&r.bumpMap.dispose(),r.bumpMap=void 0);const i=await this.makeTextSvg(n);this.applyToMap&&(r.map=i),this.applyToAlphaMap&&(r.alphaMap=i,r.transparent=!0),this.applyToBumpMap&&(r.bumpMap=i),r.userData.inverseAlphaMap=this.inverseAlphaMap,r.setDirty(),r.needsUpdate=!0,this.uiConfig.uiRefresh?.("postFrame",!0)}async makeTextSvg(e){const r=e.fontFamily||"Arial",i=e.fontPath||this.fonts[r]||"";let s=e.style;if(i.length>0){const e=i.split("?")[0].split(".").pop()||"woff";s+="\n"+(i.length>0?`\n            @font-face {\n                font-family: ${r};\n                src: url(${i}) format(${lC[e]||e});\n            }`:"")}let o=function({text:e="Custom Text",svgBackground:t="#ffffff",xOffset:n=0,yOffset:r=0,width:i=1024,height:s=1024,boxWidth:o=1024,boxHeight:a=1024,fontFamily:l="",fontSize:c=32,maskText:u=!0,innerShadow:h=!0,bgFillColor:p="#000000",textColor:d="#ffffff",textAnchor:f="middle",style:m=""}){return`\n<svg style="background-color:${t}" width="${i}" height="${s}" viewBox="0 0 ${o} ${a}"\n xmlns="http://www.w3.org/2000/svg"\n xmlns:xlink="http://www.w3.org/1999/xlink">\n     <defs>\n        <style>\n        ${m}\n        </style>\n    </defs>\n\n    <g style="overflow:hidden; text-anchor: ${f}; font-size: ${c}px; font-family: ${l||"Arial"}">\n        <defs>\n\n`+(u?`\n<mask id="textMask">\n<text style="fill:white; font-size: ${c}px;" x="${n+o/2}" y="${a/2+r+c/4}" > ${e} </text>\n</mask>\n`:"")+"\n\n"+(h?'\n<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">\n<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>\n<feOffset in="blur" dx="1.5" dy="1.5"/>\n</filter>\n':"")+"\n\n        </defs>\n\n"+(u?'\n        <g mask="url(#textMask)">\n':"")+`\n\n        <rect x="0" y="0" width="${o}" height="${a}" style="fill:${p}"/>\n        <text style="${h?"filter: url(#innerShadow);":""} fill:${d};" x="${n+o/2}" y="${a/2+r+c/4}"> ${e} </text>\n\n`+(u?"\n        </g>\n":"")+"\n\n    </g>\n</svg>\n"}({...e,fontFamily:r,style:s});o=await(0,t.embedUrlRefs)(o,(async e=>this._getAssetData(e))),o=(0,t.svgUrl)(o);const a=await this._viewer.getManager().importer.importSinglePath(o,{generateMipmaps:!1,minFilter:n.wem});return a._isSimpleTextTexture=!0,a.flipY=!1,a.needsUpdate=!0,a}async _getAssetData(e){if(e.startsWith("http://www.w3.org"))return e;const t=this._viewer?.getManager()?.importer;if(!t)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new Iv(t.loadingManager),processImported:!1};try{return await t.importPath(e,this._assetLoadOptions)}catch(e){return console.error(e),""}}};uC.PluginType="SimpleTextPlugin",sC([ut(void 0,{params:cC})],uC.prototype,"options",void 0),sC([ht("Apply Map",cC),(0,t.onChange)(iC.prototype._paramsChanged)],uC.prototype,"applyToMap",void 0),sC([ht("Apply Bump Map",cC),(0,t.onChange)(iC.prototype._paramsChanged)],uC.prototype,"applyToBumpMap",void 0),sC([ht("Apply Alpha Map",cC),(0,t.onChange)(iC.prototype._paramsChanged)],uC.prototype,"applyToAlphaMap",void 0),sC([ht("Invert Alpha Map",cC),(0,t.onChange)(iC.prototype._paramsChanged)],uC.prototype,"inverseAlphaMap",void 0),sC([gt("Add Text",(e=>({hidden:()=>!e.getSelected()})))],uC.prototype,"addTextToSelected",null),uC=iC=sC([wt("Simple Text")],uC);class hC{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class pC{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class dC{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new dC;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map((e=>e.clone())),e}invert(){for(let e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new dC),this.front.build(t)),n.length&&(this.back||(this.back=new dC),this.back.build(n))}}class fC{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new fC(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add((new fC).copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new n.Pa4(this.x,this.y,this.z)}}class mC{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new mC(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,r,i){let s=0;const o=[];for(let t=0;t<e.vertices.length;t++){const n=this.normal.dot(e.vertices[t].pos)-this.w,r=n<-mC.EPSILON?2:n>mC.EPSILON?1:0;s|=r,o.push(r)}switch(s){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:r.push(e);break;case 2:i.push(e);break;case 3:{const t=[],n=[];for(let r=0;r<e.vertices.length;r++){const i=(r+1)%e.vertices.length,s=o[r],a=o[i],l=e.vertices[r],c=e.vertices[i];if(2!=s&&t.push(l),1!=s&&n.push(2!=s?l.clone():l),3==(s|a)){const e=(this.w-this.normal.dot(l.pos))/this.normal.dot((new fC).copy(c.pos).sub(l.pos)),r=l.interpolate(c,e);t.push(r),n.push(r.clone())}}t.length>=3&&r.push(new gC(t,e.shared)),n.length>=3&&i.push(new gC(n,e.shared));break}}}static fromPoints(e,t,n){const r=(new fC).copy(t).sub(e).cross((new fC).copy(n).sub(e)).normalize();return new mC(r.clone(),r.dot(e))}}mC.EPSILON=1e-5;class gC{constructor(e,t){this.vertices=e,this.shared=t,this.plane=mC.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new gC(this.vertices.map((e=>e.clone())),this.shared)}flip(){this.vertices.reverse().map((e=>e.flip())),this.plane.flip()}}class _C{constructor(e,t,n,r){this.pos=(new fC).copy(e),this.normal=(new fC).copy(t),this.uv=(new fC).copy(n),this.uv.z=0,r&&(this.color=(new fC).copy(r))}clone(){return new _C(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new _C(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class vC{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new vC;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const r=e.attributes.position,i=e.attributes.normal,s=e.attributes.uv,o=e.attributes.color,a=e.groups;let l;if(e.index)l=e.index.array;else{l=new Array(r.array.length/r.itemSize|0);for(let e=0;e<l.length;e++)l[e]=e}const c=l.length/3|0;n=new Array(c);for(let e=0,c=0,u=l.length;e<u;e+=3,c++){const u=new Array(3);for(let t=0;t<3;t++){const n=l[e+t],a=3*n,c=2*n,h=r.array[a],p=r.array[a+1],d=r.array[a+2],f=i.array[a],m=i.array[a+1],g=i.array[a+2],_=null==s?void 0:s.array[c],v=null==s?void 0:s.array[c+1];u[t]=new _C(new fC(h,p,d),new fC(f,m,g),new fC(_,v,0),o&&new fC(o.array[c],o.array[c+1],o.array[c+2]))}if(void 0===t&&a&&a.length>0)for(const t of a)e>=t.start&&e<t.start+t.count&&(n[c]=new gC(u,t.materialIndex));else n[c]=new gC(u,t)}return vC.fromPolygons(n.filter((e=>!isNaN(e.plane.normal.x))))}static toGeometry(e,t){let r=0;const i=e.polygons;for(const e of i)r+=e.vertices.length-2;const s=new n.u9r,o=new hC(3*r*3),a=new hC(3*r*3),l=new pC(2*r*3);let c;const u=[],h=[];for(const e of i){const t=e.vertices,n=t.length;void 0!==e.shared&&(u[e.shared]||(u[e.shared]=[])),n&&void 0!==t[0].color&&(c||(c=new hC(3*r*3)));for(let r=3;r<=n;r++)(void 0===e.shared?h:u[e.shared]).push(o.top/3,o.top/3+1,o.top/3+2),o.write(t[0].pos),o.write(t[r-2].pos),o.write(t[r-1].pos),a.write(t[0].normal),a.write(t[r-2].normal),a.write(t[r-1].normal),l&&(l.write(t[0].uv),l.write(t[r-2].uv),l.write(t[r-1].uv)),c&&(c.write(t[0].color),c.write(t[r-2].color),c.write(t[r-1].color))}s.setAttribute("position",new n.TlE(o.array,3)),s.setAttribute("normal",new n.TlE(a.array,3)),l&&s.setAttribute("uv",new n.TlE(l.array,2)),c&&s.setAttribute("color",new n.TlE(c.array,3));for(let e=0;e<u.length;e++)void 0===u[e]&&(u[e]=[]);if(u.length){let e=[],t=0;for(let n=0;n<u.length;n++)s.addGroup(t,u[n].length,n),t+=u[n].length,e=e.concat(u[n]);s.addGroup(t,h.length,u.length),e=e.concat(h),s.setIndex(e)}const p=(new n.yGw).copy(t).invert();return s.applyMatrix4(p),s.computeBoundingSphere(),s.computeBoundingBox(),s}static fromMesh(e,t){const r=vC.fromGeometry(e.geometry,t),i=new n.Pa4,s=new n.Vkp;s.getNormalMatrix(e.matrix);for(let t=0;t<r.polygons.length;t++){const n=r.polygons[t];for(let t=0;t<n.vertices.length;t++){const r=n.vertices[t];r.pos.copy(i.copy(r.pos.toVector3()).applyMatrix4(e.matrix)),r.normal.copy(i.copy(r.normal.toVector3()).applyMatrix3(s))}}return r}static toMesh(e,t,r){const i=vC.toGeometry(e,t),s=new n.Kj0(i,r);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}static union(e,t){const n=vC.fromMesh(e),r=vC.fromMesh(t);return vC.toMesh(n.union(r),e.matrix,e.material)}static subtract(e,t){const n=vC.fromMesh(e),r=vC.fromMesh(t);return vC.toMesh(n.subtract(r),e.matrix,e.material)}static intersect(e,t){const n=vC.fromMesh(e),r=vC.fromMesh(t);return vC.toMesh(n.intersect(r),e.matrix,e.material)}clone(){const e=new vC;return e.polygons=this.polygons.map((e=>e.clone())).filter((e=>Number.isFinite(e.plane.w))),e}toPolygons(){return this.polygons}union(e){const t=new dC(this.clone().polygons),n=new dC(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),vC.fromPolygons(t.allPolygons())}subtract(e){const t=new dC(this.clone().polygons),n=new dC(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),vC.fromPolygons(t.allPolygons())}intersect(e){const t=new dC(this.clone().polygons),n=new dC(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),vC.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return vC.toMesh(this,e,t)}toGeometry(e){return vC.toGeometry(this,e)}}var yC=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const bC=["union","subtract","intersect"];class AC extends qt{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[_l],this.rootMesh=new n.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),e.getPlugin(_l)?.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){const e=this._viewer?.getPlugin(_l)?.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,t.downloadBlob)(e,"csg."+e.ext)}async exportObject(){const e=this._viewer?.getPluginByType("AssetExporterPlugin")?.exporter;if(!e||!this.rootObject)return;const t=this.rootMesh.visible;this.rootMesh.visible=!0;const n=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=t,n}_updateSelectedProperties(){const e=this._viewer?.getPlugin(_l)?.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){const e=this._viewer?.getPlugin(_l)?.getSelectedObject();e&&(this.csgSelectedEnabled=e.userData.csgBrush?.enabled??!1,this.csgSelectedOperation=e.userData.csgBrush?.operation??"union"),this.uiConfig?.uiRefresh?.("postFrame",!0)}_preFrame(){if(!this.rootObject)return;if(!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,this.rootObject?.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&this.rootObject?.modelObject.add(this.rootMesh),this.showResult?(e.forEach((e=>{e[0].visible=!1})),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach((e=>{e[0].visible=!0})),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){const e=[];return this._viewer?.scene.traverse((t=>{t.isMesh&&t.geometry&&t.userData.csgBrush?.enabled&&e.push([t,t.userData.csgBrush.operation])})),e}_sceneUpdate(e){e?.object?.userData?._isCSGMesh||(this._csgNeedsUpdate=!0)}}function wC(e,t){let r=new vC;const i=e.map((e=>e[0].material)).flatMap((e=>e));e.forEach((([e,t])=>{if(!bC.includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const n=e.matrix;e.matrix=e.matrixWorld;let s=0;s=Array.isArray(e.material)?void 0:i.indexOf(e.material),r=r[t](vC.fromMesh(e,s)),e.matrix=n}));const s=r.toMesh(t??(new n.yGw).identity(),i);return s.userData._isCSGMesh=!0,s.geometry.groups=s.geometry.groups.filter((e=>e.count>0)),s}yC([ht("Show Result",(e=>({onChange:()=>e._viewer?.setDirty()})))],AC.prototype,"showResult",void 0),yC([gt("Make CSG Brush",(e=>({hidden:()=>{const t=e._viewer?.getPlugin(_l)?.getSelectedObject();return!t?.userData||!!t.userData.csgBrush||t.userData._isCSGMesh}})))],AC.prototype,"makeSelectedCSGBrush",null),yC([ht("Enabled",(e=>({hidden:()=>{const t=e._viewer?.getPlugin(_l)?.getSelectedObject();return!t||!t.userData.csgBrush},onChange:e._updateSelectedProperties})))],AC.prototype,"csgSelectedEnabled",void 0),yC([mt("Operation",bC.map((e=>({label:e}))),(e=>({hidden:()=>{const t=e._viewer?.getPlugin(_l)?.getSelectedObject();return!t||!t.userData.csgBrush},onChange:e._updateSelectedProperties})))],AC.prototype,"csgSelectedOperation",void 0),yC([gt("Refresh CSG")],AC.prototype,"refreshCSG",null),yC([gt("Export Result",(e=>({hidden:()=>!e._viewer?.getPluginByType("AssetExporterPlugin")})))],AC.prototype,"downloadObject",null);let xC=class extends AC{_buildCSGMesh(e){return wC(e)}};xC.PluginType="CSGPluginBSP",xC=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("CSG Plugin (BSP)")],xC);const EC=0,CC=1,SC=3,MC=4;class TC{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let i=0,s=e.length;i<s;i++){const s=e[i][t];n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=e.dot(s);n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}TC.prototype.setFromBox=function(){const e=new n.Pa4;return function(t,n){const r=n.min,i=n.max;let s=1/0,o=-1/0;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){e.x=r.x*n+i.x*(1-n),e.y=r.y*a+i.y*(1-a),e.z=r.z*l+i.z*(1-l);const c=t.dot(e);s=Math.min(c,s),o=Math.max(c,o)}this.min=s,this.max=o}}(),new TC;const DC=function(){const e=new n.Pa4,t=new n.Pa4,r=new n.Pa4;return function(n,i,s){const o=n.start,a=e,l=i.start,c=t;r.subVectors(o,l),e.subVectors(n.end,n.start),t.subVectors(i.end,i.start);const u=r.dot(c),h=c.dot(a),p=c.dot(c),d=r.dot(a),f=a.dot(a)*p-h*h;let m,g;m=0!==f?(u*h-d*p)/f:0,g=(u+m*h)/p,s.x=m,s.y=g}}(),IC=function(){const e=new n.FM8,t=new n.Pa4,r=new n.Pa4;return function(n,i,s,o){DC(n,i,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return n.at(a,s),void i.at(l,o);if(a>=0&&a<=1)return l<0?i.at(0,o):i.at(1,o),void n.closestPointToPoint(o,!0,s);if(l>=0&&l<=1)return a<0?n.at(0,s):n.at(1,s),void i.closestPointToPoint(s,!0,o);{let e,c;e=a<0?n.start:n.end,c=l<0?i.start:i.end;const u=t,h=r;return n.closestPointToPoint(c,!0,t),i.closestPointToPoint(e,!0,r),u.distanceToSquared(c)<=h.distanceToSquared(e)?(s.copy(u),void o.copy(c)):(s.copy(e),void o.copy(h))}}}(),PC=function(){const e=new n.Pa4,t=new n.Pa4,r=new n.JOQ,i=new n.Zzh;return function(n,s){const{radius:o,center:a}=n,{a:l,b:c,c:u}=s;if(i.start=l,i.end=c,i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(i.start=l,i.end=u,i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(i.start=c,i.end=u,i.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;const h=s.getPlane(r);if(Math.abs(h.distanceToPoint(a))<=o){const e=h.projectPoint(a,t);if(s.containsPoint(e))return!0}return!1}}();function RC(e){return Math.abs(e)<1e-15}class BC extends n.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new n.Pa4)),this.satBounds=new Array(4).fill().map((()=>new TC)),this.points=[this.a,this.b,this.c],this.sphere=new n.aLr,this.plane=new n.JOQ,this.needsUpdate=!0}intersectsSphere(e){return PC(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,i=this.satAxes,s=this.satBounds,o=i[0],a=s[0];this.getNormal(o),a.setFromPoints(o,r);const l=i[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);const u=i[2],h=s[2];u.subVectors(t,n),h.setFromPoints(u,r);const p=i[3],d=s[3];p.subVectors(n,e),d.setFromPoints(p,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}BC.prototype.closestPointToSegment=function(){const e=new n.Pa4,t=new n.Pa4,r=new n.Zzh;return function(n,i=null,s=null){const{start:o,end:a}=n,l=this.points;let c,u=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;r.start.copy(l[o]),r.end.copy(l[a]),IC(r,n,e,t),c=e.distanceToSquared(t),c<u&&(u=c,i&&i.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,i&&i.copy(e),s&&s.copy(a)),Math.sqrt(u)}}(),BC.prototype.intersectsTriangle=function(){const e=new BC,t=new Array(3),r=new Array(3),i=new TC,s=new TC,o=new n.Pa4,a=new n.Pa4,l=new n.Pa4,c=new n.Pa4,u=new n.Zzh,h=new n.Zzh,p=new n.Zzh;return function(n,d=null,f=!1){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(e.copy(n),e.update(),n=e);const m=this.plane,g=n.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,a=this.satAxes;r[0]=n.a,r[1]=n.b,r[2]=n.c;for(let t=0;t<4;t++){const n=e[t],s=a[t];if(i.setFromPoints(s,r),n.isSeparated(i))return!1}const l=n.satBounds,c=n.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){const n=l[e],r=c[e];if(i.setFromPoints(r,t),n.isSeparated(i))return!1}for(let e=0;e<4;e++){const n=a[e];for(let e=0;e<4;e++){const a=c[e];if(o.crossVectors(n,a),i.setFromPoints(o,t),s.setFromPoints(o,r),i.isSeparated(s))return!1}}return d&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),d.start.set(0,0,0),d.end.set(0,0,0)),!0}{const e=this.points;let t=!1,r=0;for(let n=0;n<3;n++){const i=e[n],s=e[(n+1)%3];u.start.copy(i),u.end.copy(s),u.delta(a);const o=t?h.start:h.end,l=RC(g.distanceToPoint(i));if(RC(g.normal.dot(a))&&l){h.copy(u),r=2;break}if((g.intersectLine(u,o)||l)&&!RC(o.distanceTo(s))){if(r++,t)break;t=!0}}if(1===r&&n.containsPoint(h.end))return d&&(d.start.copy(h.end),d.end.copy(h.end)),!0;if(2!==r)return!1;const i=n.points;let s=!1,o=0;for(let e=0;e<3;e++){const t=i[e],n=i[(e+1)%3];u.start.copy(t),u.end.copy(n),u.delta(l);const r=s?p.start:p.end,a=RC(m.distanceToPoint(t));if(RC(m.normal.dot(l))&&a){p.copy(u),o=2;break}if((m.intersectLine(u,r)||a)&&!RC(r.distanceTo(n))){if(o++,s)break;s=!0}}if(1===o&&this.containsPoint(p.end))return d&&(d.start.copy(p.end),d.end.copy(p.end)),!0;if(2!==o)return!1;if(h.delta(a),p.delta(l),a.dot(l)<0){let e=p.start;p.start=p.end,p.end=e}const f=h.start.dot(a),_=h.end.dot(a),v=p.start.dot(a),y=p.end.dot(a);return(f===y||v===_||_<v!=f<y)&&(d&&(c.subVectors(h.start,p.start),c.dot(a)>0?d.start.copy(h.start):d.start.copy(p.start),c.subVectors(h.end,p.end),c.dot(a)<0?d.end.copy(h.end):d.end.copy(p.end)),!0)}}}(),BC.prototype.distanceToPoint=function(){const e=new n.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),BC.prototype.distanceToTriangle=function(){const e=new n.Pa4,t=new n.Pa4,r=["a","b","c"],i=new n.Zzh,s=new n.Zzh;return function(n,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(n,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let t=0;t<3;t++){let i;const s=r[t],l=n[s];this.closestPointToPoint(l,e),i=l.distanceToSquared(e),i<c&&(c=i,o&&o.copy(e),a&&a.copy(l));const u=this[s];n.closestPointToPoint(u,e),i=u.distanceToSquared(e),i<c&&(c=i,o&&o.copy(u),a&&a.copy(e))}for(let l=0;l<3;l++){const u=r[l],h=r[(l+1)%3];i.set(this[u],this[h]);for(let l=0;l<3;l++){const u=r[l],h=r[(l+1)%3];s.set(n[u],n[h]),IC(i,s,e,t);const p=e.distanceToSquared(t);p<c&&(c=p,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();const kC=1e-14,OC=1e-10,LC=new n.Zzh,FC=new n.Zzh,UC=new n.Pa4,NC=new n.Pa4,jC=new n.JOQ,zC=new BC;function GC(e){return e.a.distanceToSquared(e.b)<kC||e.a.distanceToSquared(e.c)<kC||e.b.distanceToSquared(e.c)<kC}class VC{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new n.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class HC{constructor(){this.trianglePool=new VC,this.triangles=[],this.normal=new n.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:r}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i];if(0===i)s.getNormal(r);else if(Math.abs(1-s.getNormal(UC).dot(r))>kC)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const o=n.getTriangle();o.copy(s),t.push(o)}else{e.getNormal(r);const i=n.getTriangle();i.copy(e),t.push(i)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(jC),Math.abs(1-Math.abs(jC.normal.dot(t)))<OC){const r=[e.a,e.b,e.c];for(let n=0;n<3;n++){const i=(n+1)%3,s=r[n],o=r[i];UC.subVectors(o,s).normalize(),NC.crossVectors(t,UC),jC.setFromNormalAndCoplanarPoint(NC,s),this.splitByPlane(jC,e,n)}for(let e=0,t=n.length;e<t;e++)n[e].coplanarCount=0}else this.splitByPlane(jC,e)}splitByPlane(e,t=null,n=-1){const{triangles:r,trianglePool:i}=this;let s=null;null!==t&&(s=zC,s.copy(t),s.needsUpdate=!0);for(let t=0,n=r.length;t<n;t++){const o=r[t],{a,b:l,c}=o;if(s&&!s.intersectsTriangle(o,LC,!0))continue;let u=0,h=-1,p=0,d=!1;const f=[a,l,c];for(let t=0;t<3;t++){const n=(t+1)%3;LC.start.copy(f[t]),LC.end.copy(f[n]);const r=e.distanceToPoint(LC.start),i=e.distanceToPoint(LC.end);if(Math.abs(r)<OC&&Math.abs(i)<OC){d=!0;break}if(Math.abs(r)<OC)continue;r>0&&p++;let s=!!e.intersectLine(LC,UC);!s&&Math.abs(i)<OC&&(UC.copy(LC.end),s=!0),!s||UC.distanceTo(LC.start)<kC||(UC.distanceTo(LC.end)<kC&&(h=t),0===u?FC.start.copy(UC):FC.end.copy(UC),u++)}if(!d)if(2===u&&FC.distance()>OC)if(-1!==h){h=(h+1)%3;let e=0;e===h&&(e=(e+1)%3);let s=e+1;s===h&&(s=(s+1)%3);const a=i.getTriangle();a.a.copy(f[s]),a.b.copy(FC.end),a.c.copy(FC.start),GC(a)||r.push(a),o.a.copy(f[e]),o.b.copy(FC.start),o.c.copy(FC.end),GC(o)&&(r.splice(t,1),t--,n--)}else{const s=f.findIndex((t=>p>=2?e.distanceToPoint(t)<0:e.distanceToPoint(t)>0));if(0===s){let e=FC.start;FC.start=FC.end,FC.end=e}else if(-1===s)continue;const a=(s+1)%3,l=(s+2)%3,c=i.getTriangle(),u=i.getTriangle();f[a].distanceToSquared(FC.start)<f[l].distanceToSquared(FC.end)?(c.a.copy(f[a]),c.b.copy(FC.start),c.c.copy(FC.end),u.a.copy(f[a]),u.b.copy(f[l]),u.c.copy(FC.start)):(c.a.copy(f[l]),c.b.copy(FC.start),c.c.copy(FC.end),u.a.copy(f[a]),u.b.copy(f[l]),u.c.copy(FC.end)),o.a.copy(f[s]),o.b.copy(FC.end),o.c.copy(FC.start),GC(c)||r.push(c),GC(u)||r.push(u),GC(o)&&(r.splice(t,1),t--,n--)}else 3===u&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function QC(){return"undefined"!=typeof SharedArrayBuffer}function WC(e){if(e.buffer instanceof SharedArrayBuffer)return e;const t=e.constructor,n=e.buffer,r=new SharedArrayBuffer(n.byteLength),i=new Uint8Array(n);return new Uint8Array(r).set(i,0),new t(r)}class qC{constructor(e,t=500){const n=QC()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:r}=this;null===e&&(e=~~(n.length*r));const i=new t(e);i.set(n,0),this.array=i}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,i=e.length;r<i;r++)t[n+r]=e[r];this.length+=e.length}clear(){this.length=0}}class XC{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let r=0;for(let i=0;i<t;i++)r+=n[i][e].length;return r}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const e={};t.push(e);for(const t in n)e[t]=new qC(n[t].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,r=n[0][e];if(r){if(r.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let r=0,i=n.length;r<i;r++)n[r][e]=new qC(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach((e=>{for(const t in e)e[t].clear()}))}delete(e){this.groupAttributes.forEach((t=>{delete t[e]}))}reset(){this.groupAttributes=[]}}class YC{constructor(e){this.triangle=(new n.CJI).copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=(new n.CJI).copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class KC{constructor(){this.data={}}addTriangleIntersection(e,t,n,r){const{data:i}=this;i[e]||(i[e]=new YC(t)),i[e].addTriangle(n,r)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(null!==e)e in t&&n.push(t[e].triangle);else for(const e in t)n.push(t[e].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map((e=>parseInt(e)))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map((e=>parseInt(e))):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,r=new Set,i=[],s=e=>{if(n[e])if(null!==t)n[e].intersects[t]&&i.push(n[e].intersects[t]);else{const t=n[e].intersects;for(const e in t)r.has(e)||(r.add(e),i.push(t[e]))}};if(null!==e)s(e);else for(const e in n)s(e);return i}reset(){this.data={}}}class JC{constructor(){this.enabled=!1,this.triangleIntersectsA=new KC,this.triangleIntersectsB=new KC,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,r){const{triangleIntersectsA:i,triangleIntersectsB:s}=this;i.addTriangleIntersection(e,t,n,r),s.addTriangleIntersection(n,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class ZC{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:r}=this;n[e]||(n[e]=[],r.push(e)),n[e].push(t)}}const $C=new n.zHn,eS=new n.yGw,tS=new n.CJI,nS=new n.Pa4,rS=new n.Ltg,iS=new n.Ltg,sS=new n.Ltg,oS=new n.Ltg,aS=new n.Ltg,lS=new n.Ltg,cS=new n.Zzh,uS=new n.Pa4,hS=1e-8,pS=1e-15,dS=-1,fS=1,mS=-2,gS=2,_S=0,vS=1,yS=2;let bS=null;function AS(e){bS=e}function wS(e,t){function r(){return Math.random()-.5}e.getNormal(uS),$C.direction.copy(uS),e.getMidpoint($C.origin);let i=0,s=1/0;for(let e=0;e<3;e++){$C.direction.x+=r()*hS,$C.direction.y+=r()*hS,$C.direction.z+=r()*hS,$C.direction.multiplyScalar(-1);const o=t.raycastFirst($C,n.ehD);if(Boolean(o&&$C.direction.dot(o.face.normal)>0)&&i++,null!==o&&(s=Math.min(s,o.distance)),s<=pS)return o.face.normal.dot(uS)>0?gS:mS;if(i/3>.5||(e-i+1)/3>.5)break}return i/3>.5?dS:fS}function xS(e,t,n,r,i,s,o=!1){const a=n.attributes,l=n.index,c=3*e,u=l.getX(c+0),h=l.getX(c+1),p=l.getX(c+2);for(const e in s){const n=a[e],l=s[e];if(!(e in a))throw new Error(`CSG Operations: Attribute ${e} not available on geometry.`);const c=n.itemSize;"position"===e?(tS.a.fromBufferAttribute(n,u).applyMatrix4(r),tS.b.fromBufferAttribute(n,h).applyMatrix4(r),tS.c.fromBufferAttribute(n,p).applyMatrix4(r),SS(tS.a,tS.b,tS.c,t,3,l,o)):"normal"===e?(tS.a.fromBufferAttribute(n,u).applyNormalMatrix(i),tS.b.fromBufferAttribute(n,h).applyNormalMatrix(i),tS.c.fromBufferAttribute(n,p).applyNormalMatrix(i),o&&(tS.a.multiplyScalar(-1),tS.b.multiplyScalar(-1),tS.c.multiplyScalar(-1)),SS(tS.a,tS.b,tS.c,t,3,l,o,!0)):(rS.fromBufferAttribute(n,u),iS.fromBufferAttribute(n,h),sS.fromBufferAttribute(n,p),SS(rS,iS,sS,t,c,l,o))}}function ES(e,t,n,r,i,s,o,a=!1){MS(e,r,i,s,o,a),MS(a?n:t,r,i,s,o,a),MS(a?t:n,r,i,s,o,a)}function CS(e,t,n=!1){switch(e){case EC:if(t===fS||t===gS&&!n)return vS;break;case CC:if(n){if(t===dS)return _S}else if(t===fS||t===mS)return vS;break;case SC:if(t===dS)return _S;if(t===fS)return vS;break;case MC:if(t===dS||t===gS&&!n)return vS;break;default:throw new Error(`Unrecognized CSG operation enum "${e}".`)}return yS}function SS(e,t,n,r,i,s,o=!1,a=!1){const l=e=>{s.push(e.x),i>1&&s.push(e.y),i>2&&s.push(e.z),i>3&&s.push(e.w)};oS.set(0,0,0,0).addScaledVector(e,r.a.x).addScaledVector(t,r.a.y).addScaledVector(n,r.a.z),aS.set(0,0,0,0).addScaledVector(e,r.b.x).addScaledVector(t,r.b.y).addScaledVector(n,r.b.z),lS.set(0,0,0,0).addScaledVector(e,r.c.x).addScaledVector(t,r.c.y).addScaledVector(n,r.c.z),a&&(oS.normalize(),aS.normalize(),lS.normalize()),l(oS),o?(l(lS),l(aS)):(l(aS),l(lS))}function MS(e,t,n,r,i,s=!1){for(const o in i){const a=t[o],l=i[o];if(!(o in t))throw new Error(`CSG Operations: Attribute ${o} no available on geometry.`);const c=a.itemSize;"position"===o?(nS.fromBufferAttribute(a,e).applyMatrix4(n),l.push(nS.x,nS.y,nS.z)):"normal"===o?(nS.fromBufferAttribute(a,e).applyNormalMatrix(r),s&&nS.multiplyScalar(-1),l.push(nS.x,nS.y,nS.z)):(l.push(a.getX(e)),c>1&&l.push(a.getY(e)),c>2&&l.push(a.getZ(e)),c>3&&l.push(a.getW(e)))}}const TS=new n.yGw,DS=new n.Vkp,IS=new n.CJI,PS=new n.CJI,RS=new n.CJI,BS=new n.CJI;function kS(e){for(const t of e)return t}function OS(e,t,n,r,i,s,o,a=0){const l=e.matrixWorld.determinant()<0;TS.copy(t.matrixWorld).invert().multiply(e.matrixWorld),DS.getNormalMatrix(e.matrixWorld).multiplyScalar(l?-1:1);const c=e.geometry.groupIndices,u=e.geometry.index,h=e.geometry.attributes.position,p=t.geometry.boundsTree,d=t.geometry.index,f=t.geometry.attributes.position,m=n.ids,g=n.intersectionSet;for(let t=0,n=m.length;t<n;t++){const n=m[t],_=-1===a?0:c[n]+a,v=o.getGroupSet(_),y=3*n,b=u.getX(y+0),A=u.getX(y+1),w=u.getX(y+2);IS.a.fromBufferAttribute(h,b).applyMatrix4(TS),IS.b.fromBufferAttribute(h,A).applyMatrix4(TS),IS.c.fromBufferAttribute(h,w).applyMatrix4(TS),s.initialize(IS);const x=g[n];for(let e=0,t=x.length;e<t;e++){const t=3*x[e],n=d.getX(t+0),r=d.getX(t+1),i=d.getX(t+2);PS.a.fromBufferAttribute(f,n),PS.b.fromBufferAttribute(f,r),PS.c.fromBufferAttribute(f,i),s.splitByTriangle(PS)}const E=s.triangles;for(let t=0,s=E.length;t<s;t++){const s=E[t],o=CS(r,wS(s,p),i);if(o!==yS){IS.getBarycoord(s.a,BS.a),IS.getBarycoord(s.b,BS.b),IS.getBarycoord(s.c,BS.c);const t=o===_S;xS(n,BS,e.geometry,e.matrixWorld,DS,v,l!==t)}}}return m.length}function LS(e,t,n,r,i,s,o=0){const a=e.matrixWorld.determinant()<0;TS.copy(t.matrixWorld).invert().multiply(e.matrixWorld),DS.getNormalMatrix(e.matrixWorld).multiplyScalar(a?-1:1);const l=t.geometry.boundsTree,c=e.geometry.groupIndices,u=e.geometry.index,h=e.geometry.attributes,p=h.position,d=[],f=e.geometry.halfEdges,m=new Set;for(let e=0,t=u.count/3;e<t;e++)e in n.intersectionSet||m.add(e);for(;m.size>0;){const t=kS(m);m.delete(t),d.push(t);const n=3*t,g=u.getX(n+0),_=u.getX(n+1),v=u.getX(n+2);RS.a.fromBufferAttribute(p,g).applyMatrix4(TS),RS.b.fromBufferAttribute(p,_).applyMatrix4(TS),RS.c.fromBufferAttribute(p,v).applyMatrix4(TS);const y=CS(r,wS(RS,l),i);for(;d.length>0;){const t=d.pop(),n=-1===o?0:c[t]+o,r=s.getGroupSet(n);for(let e=0;e<3;e++){const n=f.getSiblingTriangleIndex(t,e);-1!==n&&m.has(n)&&(d.push(n),m.delete(n))}if(y===yS)continue;const i=3*t,l=u.getX(i+0),p=u.getX(i+1),g=u.getX(i+2),_=y===_S;ES(l,p,g,h,e.matrixWorld,DS,r,_!==a)}}}const FS=1.25,US=65535,NS=Math.pow(2,-24);class jS{constructor(){}}function zS(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function GS(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){const i=e[r+3]-e[r];i>n&&(n=i,t=r)}return t}function VS(e,t){t.set(e)}function HS(e,t,n){let r,i;for(let s=0;s<3;s++){const o=s+3;r=e[s],i=t[s],n[s]=r<i?r:i,r=e[o],i=t[o],n[o]=r>i?r:i}}function QS(e,t,n){for(let r=0;r<3;r++){const i=t[e+2*r],s=t[e+2*r+1],o=i-s,a=i+s;o<n[r]&&(n[r]=o),a>n[r+3]&&(n[r+3]=a)}}function WS(e){const t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}function qS(e,t,n,r,i=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,p=1/0,d=1/0,f=-1/0,m=-1/0,g=-1/0;const _=null!==i;for(let r=6*t,i=6*(t+n);r<i;r+=6){const t=e[r+0],n=e[r+1],i=t-n,v=t+n;i<s&&(s=i),v>l&&(l=v),_&&t<h&&(h=t),_&&t>f&&(f=t);const y=e[r+2],b=e[r+3],A=y-b,w=y+b;A<o&&(o=A),w>c&&(c=w),_&&y<p&&(p=y),_&&y>m&&(m=y);const x=e[r+4],E=e[r+5],C=x-E,S=x+E;C<a&&(a=C),S>u&&(u=S),_&&x<d&&(d=x),_&&x>g&&(g=x)}r[0]=s,r[1]=o,r[2]=a,r[3]=l,r[4]=c,r[5]=u,_&&(i[0]=h,i[1]=p,i[2]=d,i[3]=f,i[4]=m,i[5]=g)}const XS=32,YS=(e,t)=>e.candidate-t.candidate,KS=new Array(XS).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),JS=new Float32Array(6);class ZS{constructor(e,t,r){this.isOrientedBox=!0,this.min=new n.Pa4,this.max=new n.Pa4,this.matrix=new n.yGw,this.invMatrix=new n.yGw,this.points=new Array(8).fill().map((()=>new n.Pa4)),this.satAxes=new Array(3).fill().map((()=>new n.Pa4)),this.satBounds=new Array(3).fill().map((()=>new TC)),this.alignedSatBounds=new Array(3).fill().map((()=>new TC)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}ZS.prototype.update=function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let i=0;i<=1;i++)for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){const a=r[1*i|2*s|4*o];a.x=i?n.x:t.x,a.y=s?n.y:t.y,a.z=o?n.z:t.z,a.applyMatrix4(e)}const i=this.satBounds,s=this.satAxes,o=r[0];for(let e=0;e<3;e++){const t=s[e],n=i[e],a=r[1<<e];t.subVectors(o,a),n.setFromPoints(t,r)}const a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},ZS.prototype.intersectsBox=function(){const e=new TC;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,i=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,o[0].isSeparated(e))return!1;if(e.min=n.y,e.max=r.y,o[1].isSeparated(e))return!1;if(e.min=n.z,e.max=r.z,o[2].isSeparated(e))return!1;for(let n=0;n<3;n++){const r=s[n],o=i[n];if(e.setFromBox(r,t),o.isSeparated(e))return!1}return!0}}(),ZS.prototype.intersectsTriangle=function(){const e=new BC,t=new Array(3),r=new TC,i=new TC,s=new n.Pa4;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(e.copy(n),e.update(),n=e);const o=this.satBounds,a=this.satAxes;t[0]=n.a,t[1]=n.b,t[2]=n.c;for(let e=0;e<3;e++){const n=o[e],i=a[e];if(r.setFromPoints(i,t),n.isSeparated(r))return!1}const l=n.satBounds,c=n.satAxes,u=this.points;for(let e=0;e<3;e++){const t=l[e],n=c[e];if(r.setFromPoints(n,u),t.isSeparated(r))return!1}for(let e=0;e<3;e++){const n=a[e];for(let e=0;e<4;e++){const o=c[e];if(s.crossVectors(n,o),r.setFromPoints(s,t),i.setFromPoints(s,u),r.isSeparated(i))return!1}}return!0}}(),ZS.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},ZS.prototype.distanceToPoint=function(){const e=new n.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),ZS.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map((()=>new n.Zzh)),r=new Array(12).fill().map((()=>new n.Zzh)),i=new n.Pa4,s=new n.Pa4;return function(n,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(a||l)&&(n.getCenter(s),this.closestPointToPoint(s,i),n.closestPointToPoint(i,s),a&&a.copy(i),l&&l.copy(s)),0;const c=o*o,u=n.min,h=n.max,p=this.points;let d=1/0;for(let e=0;e<8;e++){const t=p[e];s.copy(t).clamp(u,h);const n=t.distanceToSquared(s);if(n<d&&(d=n,a&&a.copy(t),l&&l.copy(s),n<c))return Math.sqrt(n)}let f=0;for(let n=0;n<3;n++)for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){const o=(n+1)%3,a=(n+2)%3,l=1<<n|i<<o|s<<a,c=p[i<<o|s<<a],d=p[l];t[f].set(c,d);const m=e[n],g=e[o],_=e[a],v=r[f],y=v.start,b=v.end;y[m]=u[m],y[g]=i?u[g]:h[g],y[_]=s?u[_]:h[g],b[m]=h[m],b[g]=i?u[g]:h[g],b[_]=s?u[_]:h[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){s.x=e?h.x:u.x,s.y=t?h.y:u.y,s.z=n?h.z:u.z,this.closestPointToPoint(s,i);const r=s.distanceToSquared(i);if(r<d&&(d=r,a&&a.copy(i),l&&l.copy(s),r<c))return Math.sqrt(r)}for(let e=0;e<12;e++){const n=t[e];for(let e=0;e<12;e++){const t=r[e];IC(n,t,i,s);const o=i.distanceToSquared(s);if(o<d&&(d=o,a&&a.copy(i),l&&l.copy(s),o<c))return Math.sqrt(o)}}return Math.sqrt(d)}}();const $S=new n.Pa4,eM=new n.Pa4,tM=new n.Pa4,nM=new n.FM8,rM=new n.FM8,iM=new n.FM8,sM=new n.Pa4;function oM(e,t,r,i,s){const o=3*i,a=e.index.getX(o),l=e.index.getX(o+1),c=e.index.getX(o+2),u=function(e,t,r,i,s,o,a){$S.fromBufferAttribute(t,i),eM.fromBufferAttribute(t,s),tM.fromBufferAttribute(t,o);const l=function(e,t,r,i,s,o){let a;return a=o===n._Li?e.intersectTriangle(i,r,t,!0,s):e.intersectTriangle(t,r,i,o!==n.ehD,s),null===a?null:{distance:e.origin.distanceTo(s),point:s.clone()}}(e,$S,eM,tM,sM,a);if(l){r&&(nM.fromBufferAttribute(r,i),rM.fromBufferAttribute(r,s),iM.fromBufferAttribute(r,o),l.uv=n.CJI.getUV(sM,$S,eM,tM,nM,rM,iM,new n.FM8));const e={a:i,b:s,c:o,normal:new n.Pa4,materialIndex:0};n.CJI.getNormal($S,eM,tM,e.normal),l.face=e,l.faceIndex=i}return l}(r,e.attributes.position,e.attributes.uv,a,l,c,t);return u?(u.faceIndex=i,s&&s.push(u),u):null}function aM(e,t,n,r){const i=e.a,s=e.b,o=e.c;let a=t,l=t+1,c=t+2;n&&(a=n.getX(t),l=n.getX(t+1),c=n.getX(t+2)),i.x=r.getX(a),i.y=r.getY(a),i.z=r.getZ(a),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c)}function lM(e,t,n,r,i,s,o){const a=n.index,l=n.attributes.position;for(let n=e,c=t+e;n<c;n++)if(aM(o,3*n,a,l),o.needsUpdate=!0,r(o,n,i,s))return!0;return!1}class cM{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function uM(e,t){return 65535===t[e+15]}function hM(e,t){return t[e+6]}function pM(e,t){return t[e+14]}function dM(e){return e+8}function fM(e,t){return t[e+6]}const mM=new n.ZzF,gM=new n.Pa4,_M=["x","y","z"];function vM(e,t,n,r,i){let s=2*e,o=CM,a=SM,l=MM;if(uM(s,a))!function(e,t,n,r,i,s){for(let o=r,a=r+i;o<a;o++)oM(e,t,n,o,s)}(t,n,r,hM(e,l),pM(s,a),i);else{const s=dM(e);wM(s,o,r,gM)&&vM(s,t,n,r,i);const a=fM(e,l);wM(a,o,r,gM)&&vM(a,t,n,r,i)}}function yM(e,t,n,r){let i=2*e,s=CM,o=SM,a=MM;if(uM(i,o))return function(e,t,n,r,i){let s=1/0,o=null;for(let a=r,l=r+i;a<l;a++){const r=oM(e,t,n,a);r&&r.distance<s&&(o=r,s=r.distance)}return o}(t,n,r,hM(e,a),pM(i,o));{const i=function(e,t){return t[e+7]}(e,a),o=_M[i],l=r.direction[o]>=0;let c,u;l?(c=dM(e),u=fM(e,a)):(c=fM(e,a),u=dM(e));const h=wM(c,s,r,gM)?yM(c,t,n,r):null;if(h){const e=h.point[o];if(l?e<=s[u+i]:e>=s[u+i+3])return h}const p=wM(u,s,r,gM)?yM(u,t,n,r):null;return h&&p?h.distance<=p.distance?h:p:h||p||null}}const bM=function(){let e,t;const r=[],i=new cM((()=>new n.ZzF));return function(...n){e=i.getPrimitive(),t=i.getPrimitive(),r.push(e,t);const o=s(...n);i.releasePrimitive(e),i.releasePrimitive(t),r.pop(),r.pop();const a=r.length;return a>0&&(t=r[a-1],e=r[a-2]),o};function s(n,r,i,o,a=null,l=0,c=0){function u(e){let t=2*e,n=SM,r=MM;for(;!uM(t,n);)t=2*(e=dM(e));return hM(e,r)}function h(e){let t=2*e,n=SM,r=MM;for(;!uM(t,n);)t=2*(e=fM(e,r));return hM(e,r)+pM(t,n)}let p=2*n,d=CM,f=SM,m=MM;if(uM(p,f)){const t=hM(n,m),r=pM(p,f);return zS(n,d,e),o(t,r,!1,c,l+n,e)}{const p=dM(n),g=fM(n,m);let _,v,y,b,A=p,w=g;if(a&&(y=e,b=t,zS(A,d,y),zS(w,d,b),_=a(y),v=a(b),v<_)){A=g,w=p;const e=_;_=v,v=e,y=b}y||(y=e,zS(A,d,y));const x=i(y,uM(2*A,f),_,c+1,l+A);let E;if(2===x){const e=u(A);E=o(e,h(A)-e,!0,c+1,l+A,y)}else E=x&&s(A,r,i,o,a,l,c+1);if(E)return!0;b=t,zS(w,d,b);const C=i(b,uM(2*w,f),v,c+1,l+w);let S;if(2===C){const e=u(w);S=o(e,h(w)-e,!0,c+1,l+w,b)}else S=C&&s(w,r,i,o,a,l,c+1);return!!S}}}(),AM=function(){const e=new BC,t=new BC,r=new n.yGw,i=new ZS,s=new ZS;return function n(o,a,l,c,u=null){let h=2*o,p=CM,d=SM,f=MM;if(null===u&&(l.boundingBox||l.computeBoundingBox(),i.set(l.boundingBox.min,l.boundingBox.max,c),u=i),!uM(h,d)){const e=o+8,t=f[o+6];return zS(e,p,mM),!(!u.intersectsBox(mM)||!n(e,a,l,c,u))||(zS(t,p,mM),!(!u.intersectsBox(mM)||!n(t,a,l,c,u)))}{const n=a,i=n.index,u=n.attributes.position,m=l.index,g=l.attributes.position,_=hM(o,f),v=pM(h,d);if(r.copy(c).invert(),l.boundsTree){zS(o,p,s),s.matrix.copy(r),s.needsUpdate=!0;const e=l.boundsTree.shapecast({intersectsBounds:e=>s.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let n=3*_,r=3*(v+_);n<r;n+=3)if(aM(t,n,i,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});return e}for(let n=3*_,s=v+3*_;n<s;n+=3){aM(e,n,i,u),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let n=0,r=m.count;n<r;n+=3)if(aM(t,n,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function wM(e,t,n,r){return zS(e,t,mM),n.intersectBox(mM,r)}const xM=[];let EM,CM,SM,MM;function TM(e){EM&&xM.push(EM),EM=e,CM=new Float32Array(e),SM=new Uint16Array(e),MM=new Uint32Array(e)}function DM(){EM=null,CM=null,SM=null,MM=null,xM.length&&TM(xM.pop())}const IM=Symbol("skip tree generation"),PM=new n.ZzF,RM=new n.ZzF,BM=new n.yGw,kM=new ZS,OM=new ZS,LM=new n.Pa4,FM=new n.Pa4,UM=new n.Pa4,NM=new n.Pa4,jM=new n.Pa4,zM=new n.ZzF,GM=new cM((()=>new BC));class VM{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),VM.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,i=n.getIndex();let s;return s=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:i.array.slice()}:{roots:r,index:i.array},s}static deserialize(e,t,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),VM.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};const{index:i,roots:s}=e,o=new VM(t,{...r,[IM]:!0});if(o._roots=s,r.setIndex){const r=t.getIndex();if(null===r){const r=new n.TlE(e.index,1,!1);t.setIndex(r)}else r.array!==i&&(r.array.set(i),r.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[IM]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[IM]||(this._roots=function(e,t){const r=function(e,t){function r(e){d&&d(e/f)}function i(t,n,s,d=null,f=0){if(!m&&f>=c&&(m=!0,u&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),s<=h||f>=c)return r(n+s),t.offset=n,t.count=s,t;const g=function(e,t,n,r,i,s){let o=-1,a=0;if(0===s)o=GS(t),-1!==o&&(a=(t[o]+t[o+3])/2);else if(1===s)o=GS(e),-1!==o&&(a=function(e,t,n,r){let i=0;for(let s=t,o=t+n;s<o;s++)i+=e[6*s+2*r];return i/n}(n,r,i,o));else if(2===s){const s=WS(e);let l=FS*i;const c=6*r,u=6*(r+i);for(let e=0;e<3;e++){const r=t[e],h=(t[e+3]-r)/XS;if(i<8){const t=[...KS];t.length=i;let r=0;for(let i=c;i<u;i+=6,r++){const s=t[r];s.candidate=n[i+2*e],s.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;QS(i,n,o)}t.sort(YS);let h=i;for(let e=0;e<h;e++){const n=t[e];for(;e+1<h&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),h--}for(let r=c;r<u;r+=6){const i=n[r+2*e];for(let e=0;e<h;e++){const s=t[e];i>=s.candidate?QS(r,n,s.rightCacheBounds):(QS(r,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<h;n++){const r=t[n],c=r.count,u=i-r.count,h=r.leftCacheBounds,p=r.rightCacheBounds;let d=0;0!==c&&(d=WS(h)/s);let f=0;0!==u&&(f=WS(p)/s);const m=1+FS*(d*c+f*u);m<l&&(o=e,l=m,a=r.candidate)}}else{for(let e=0;e<XS;e++){const t=KS[e];t.count=0,t.candidate=r+h+e*h;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let t=c;t<u;t+=6){let i=~~((n[t+2*e]-r)/h);i>=XS&&(i=31);const s=KS[i];s.count++,QS(t,n,s.bounds)}const t=KS[31];VS(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=KS[e],n=KS[e+1];HS(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let p=0;for(let t=0;t<31;t++){const n=KS[t],r=n.count,c=n.bounds,u=KS[t+1].rightCacheBounds;0!==r&&(0===p?VS(c,JS):HS(c,JS,JS)),p+=r;let h=0,d=0;0!==p&&(h=WS(JS)/s);const f=i-p;0!==f&&(d=WS(u)/s);const m=1+FS*(h*p+d*f);m<l&&(o=e,l=m,a=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(t.boundingData,d,a,n,s,p);if(-1===g.axis)return r(n+s),t.offset=n,t.count=s,t;const _=function(e,t,n,r,i){let s=n,o=n+r-1;const a=i.pos,l=2*i.axis;for(;;){for(;s<=o&&t[6*s+l]<a;)s++;for(;s<=o&&t[6*o+l]>=a;)o--;if(!(s<o))return s;for(let n=0;n<3;n++){let r=e[3*s+n];e[3*s+n]=e[3*o+n],e[3*o+n]=r;let i=t[6*s+2*n+0];t[6*s+2*n+0]=t[6*o+2*n+0],t[6*o+2*n+0]=i;let a=t[6*s+2*n+1];t[6*s+2*n+1]=t[6*o+2*n+1],t[6*o+2*n+1]=a}s++,o--}}(l,a,n,s,g);if(_===n||_===n+s)r(n+s),t.offset=n,t.count=s;else{t.splitAxis=g.axis;const e=new jS,r=n,l=_-n;t.left=e,e.boundingData=new Float32Array(6),qS(a,r,l,e.boundingData,o),i(e,r,l,o,f+1);const c=new jS,u=_,h=s-l;t.right=c,c.boundingData=new Float32Array(6),qS(a,u,h,c.boundingData,o),i(c,u,h,o,f+1)}return t}!function(e,t){if(!e.index){const r=e.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let s;s=r>65535?new Uint32Array(new i(4*r)):new Uint16Array(new i(2*r)),e.setIndex(new n.TlE(s,1));for(let e=0;e<r;e++)s[e]=e}}(e,t);const s=new Float32Array(6),o=new Float32Array(6),a=function(e,t){const n=e.attributes.position,r=e.index.array,i=r.length/3,s=new Float32Array(6*i),o=n.normalized,a=n.array,l=n.offset||0;let c=3;n.isInterleavedBufferAttribute&&(c=n.data.stride);const u=["getX","getY","getZ"];for(let e=0;e<i;e++){const i=3*e,h=6*e;let p,d,f;o?(p=r[i+0],d=r[i+1],f=r[i+2]):(p=r[i+0]*c+l,d=r[i+1]*c+l,f=r[i+2]*c+l);for(let e=0;e<3;e++){let r,i,l;o?(r=n[u[e]](p),i=n[u[e]](d),l=n[u[e]](f)):(r=a[p+e],i=a[d+e],l=a[f+e]);let c=r;i<c&&(c=i),l<c&&(c=l);let m=r;i>m&&(m=i),l>m&&(m=l);const g=(m-c)/2,_=2*e;s[h+_+0]=c+g,s[h+_+1]=g+(Math.abs(c)+g)*NS,c<t[e]&&(t[e]=c),m>t[e+3]&&(t[e+3]=m)}}return s}(e,s),l=e.index.array,c=t.maxDepth,u=t.verbose,h=t.maxLeafTris,p=t.strategy,d=t.onProgress,f=e.index.count/3;let m=!1;const g=[],_=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],n=new Set;for(const t of e.groups)n.add(t.start),n.add(t.start+t.count);const r=Array.from(n.values()).sort(((e,t)=>e-t));for(let e=0;e<r.length-1;e++){const n=r[e],i=r[e+1];t.push({offset:n/3,count:(i-n)/3})}return t}(e);if(1===_.length){const e=_[0],t=new jS;t.boundingData=s,function(e,t,n,r){let i=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let r=6*t,u=6*(t+n);r<u;r+=6){const t=e[r+0];t<i&&(i=t),t>a&&(a=t);const n=e[r+2];n<s&&(s=n),n>l&&(l=n);const u=e[r+4];u<o&&(o=u),u>c&&(c=u)}r[0]=i,r[1]=s,r[2]=o,r[3]=a,r[4]=l,r[5]=c}(a,e.offset,e.count,o),i(t,e.offset,e.count,o),g.push(t)}else for(let e of _){const t=new jS;t.boundingData=new Float32Array(6),qS(a,e.offset,e.count,t.boundingData,o),i(t,e.offset,e.count,o),g.push(t)}return g}(e,t);let i,s,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<r.length;e++){const t=r[e],n=new l(32*c(t));i=new Float32Array(n),s=new Uint32Array(n),o=new Uint16Array(n),u(0,t),a.push(n)}return a;function c(e){return e.count?1:1+c(e.left)+c(e.right)}function u(e,t){const n=e/4,r=e/2,a=!!t.count,l=t.boundingData;for(let e=0;e<6;e++)i[n+e]=l[e];if(a){const i=t.offset,a=t.count;return s[n+6]=i,o[r+14]=a,o[r+15]=US,e+32}{const r=t.left,i=t.right,o=t.splitAxis;let a;if(a=u(e+32,r),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[n+6]=a/4,a=u(a,i),s[n+7]=o,a}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new n.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,r=t.attributes.position;let i,s,o,a,l=0;const c=this._roots;for(let e=0,t=c.length;e<t;e++)i=c[e],s=new Uint32Array(i),o=new Uint16Array(i),a=new Float32Array(i),u(0,l),l+=i.byteLength;function u(t,i,l=!1){const c=2*t;if(o[c+15]===US){const e=s[t+6];let i=1/0,l=1/0,u=1/0,h=-1/0,p=-1/0,d=-1/0;for(let t=3*e,s=3*(e+o[c+14]);t<s;t++){const e=n[t],s=r.getX(e),o=r.getY(e),a=r.getZ(e);s<i&&(i=s),s>h&&(h=s),o<l&&(l=o),o>p&&(p=o),a<u&&(u=a),a>d&&(d=a)}return(a[t+0]!==i||a[t+1]!==l||a[t+2]!==u||a[t+3]!==h||a[t+4]!==p||a[t+5]!==d)&&(a[t+0]=i,a[t+1]=l,a[t+2]=u,a[t+3]=h,a[t+4]=p,a[t+5]=d,!0)}{const n=t+8,r=s[t+6],o=n+i,c=r+i;let h=l,p=!1,d=!1;e?h||(p=e.has(o),d=e.has(c),h=!p&&!d):(p=!0,d=!0);const f=h||d;let m=!1;(h||p)&&(m=u(n,i,h));let g=!1;f&&(g=u(r,i,h));const _=m||g;if(_)for(let e=0;e<3;e++){const i=n+e,s=r+e,o=a[i],l=a[i+3],c=a[s],u=a[s+3];a[t+e]=o<c?o:c,a[t+e+3]=l>u?l:u}return _}}}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),i=new Uint16Array(n);!function t(s,o=0){const a=2*s,l=i[a+15]===US;if(l){const t=r[s+6],c=i[a+14];e(o,l,new Float32Array(n,4*s,6),t,c)}else{const i=s+8,a=r[s+6],c=r[s+7];e(o,l,new Float32Array(n,4*s,6),c)||(t(i,o+1),t(a,o+1))}}(0)}raycast(e,t=n.Wl3){const r=this._roots,i=this.geometry,s=[],o=t.isMaterial,a=Array.isArray(t),l=i.groups,c=o?t.side:t;for(let n=0,o=r.length;n<o;n++){const o=a?t[l[n].materialIndex].side:c,u=s.length;if(TM(r[n]),vM(0,i,o,e,s),DM(),a){const e=l[n].materialIndex;for(let t=u,n=s.length;t<n;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=n.Wl3){const r=this._roots,i=this.geometry,s=t.isMaterial,o=Array.isArray(t);let a=null;const l=i.groups,c=s?t.side:t;for(let n=0,s=r.length;n<s;n++){const s=o?t[l[n].materialIndex].side:c;TM(r[n]);const u=yM(0,i,s,e);DM(),null!=u&&(null==a||u.distance<a.distance)&&(a=u,o&&(u.face.materialIndex=l[n].materialIndex))}return a}intersectsGeometry(e,t){const n=this.geometry;let r=!1;for(const i of this._roots)if(TM(i),r=AM(0,n,e,t),DM(),r)break;return r}shapecast(e,t,n){const r=this.geometry;if(e instanceof Function){if(t){const e=t;t=(t,n,r,i)=>{const s=3*n;return e(t,s,s+1,s+2,r,i)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const i=GM.getPrimitive();let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const e=a;a=(t,n,s,o,a)=>!!e(t,n,s,o,a)||lM(t,n,r,l,s,o,i)}else a||(a=l?(e,t,n,s)=>lM(e,t,r,l,n,s,i):(e,t,n)=>n);let c=!1,u=0;for(const e of this._roots){if(TM(e),c=bM(0,r,o,a,s,u),DM(),c)break;u+=e.byteLength}return GM.releasePrimitive(i),c}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:i}=n;const s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;BM.copy(t).invert();const c=GM.getPrimitive(),u=GM.getPrimitive();if(i){function p(e,n,r,h,p,d,f,m){for(let g=r,_=r+h;g<_;g++){aM(u,3*g,a,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(aM(c,3*t,s,o),c.needsUpdate=!0,i(c,u,t,g,p,d,f,m))return!0}return!1}if(r){const d=r;r=function(e,t,n,r,i,s,o,a){return!!d(e,t,n,r,i,s,o,a)||p(e,t,n,r,i,s,o,a)}}else r=p}e.getBoundingBox(RM),RM.applyMatrix4(t);const h=this.shapecast({intersectsBounds:e=>RM.intersectsBox(e),intersectsRange:(t,n,i,s,o,a)=>(PM.copy(a),PM.applyMatrix4(BM),e.shapecast({intersectsBounds:e=>PM.intersectsBox(e),intersectsRange:(e,i,a,l,c)=>r(t,n,e,i,s,o,l,c)}))});return GM.releasePrimitive(c),GM.releasePrimitive(u),h}intersectsBox(e,t){return kM.set(e.min,e.max,t),kM.needsUpdate=!0,this.shapecast({intersectsBounds:e=>kM.intersectsBox(e),intersectsTriangle:e=>kM.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},i=0,s=1/0){e.boundingBox||e.computeBoundingBox(),kM.set(e.boundingBox.min,e.boundingBox.max,t),kM.needsUpdate=!0;const o=this.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,u=e.index,h=GM.getPrimitive(),p=GM.getPrimitive();let d=FM,f=UM,m=null,g=null;r&&(m=NM,g=jM);let _=1/0,v=null,y=null;return BM.copy(t).invert(),OM.matrix.copy(BM),this.shapecast({boundsTraverseOrder:e=>kM.distanceToBox(e),intersectsBounds:(e,t,n)=>n<_&&n<s&&(t&&(OM.min.copy(e.min),OM.max.copy(e.max),OM.needsUpdate=!0),!0),intersectsRange:(n,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>OM.distanceToBox(e),intersectsBounds:(e,t,n)=>n<_&&n<s,intersectsRange:(e,s)=>{for(let o=3*e,b=3*(e+s);o<b;o+=3){aM(p,o,u,c),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let e=3*n,t=3*(n+r);e<t;e+=3){aM(h,e,l,a),h.needsUpdate=!0;const t=h.distanceToTriangle(p,d,m);if(t<_&&(f.copy(d),g&&g.copy(m),_=t,v=e/3,y=o/3),t<i)return!0}}}});for(let e=0,s=u?u.count:c.count;e<s;e+=3){aM(p,e,u,c),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let t=3*n,s=3*(n+r);t<s;t+=3){aM(h,t,l,a),h.needsUpdate=!0;const n=h.distanceToTriangle(p,d,m);if(n<_&&(f.copy(d),g&&g.copy(m),_=n,v=t/3,y=e/3),n<i)return!0}}}}),GM.releasePrimitive(h),GM.releasePrimitive(p),_===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=_,n.faceIndex=v,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(BM),f.applyMatrix4(BM),r.distance=f.sub(r.point).length(),r.faceIndex=y),n)}closestPointToPoint(e,t={},n=0,r=1/0){const i=n*n,s=r*r;let o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(LM.copy(e).clamp(t.min,t.max),LM.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<o&&n<s,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,LM);const r=e.distanceToSquared(LM);return r<o&&(FM.copy(LM),o=r,a=n),r<i}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(FM):t.point=FM.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{zS(0,new Float32Array(t),zM),e.union(zM)})),e}}const HM=1e6*(1+1e-7);function QM(e){return~~(e*HM)}function WM(e){return`${QM(e.x)},${QM(e.y)},${QM(e.z)}`}const qM=[new n.Pa4,new n.Pa4,new n.Pa4];class XM{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return-1===n?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return-1===n?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,r=e.index,i=n.position;let s=r?r.count/3:i.count/3;const o=s;let a=0;this.useDrawRange&&(a=e.drawRange.start,e.drawRange.count!==1/0&&(s=~~(e.drawRange.count/3)));let l=this.data;(!l||l.length<3*o)&&(l=new Int32Array(3*o)),l.fill(-1);let c=0,u=0;for(let e=0;e<s;e++){const n=3*e+a;for(let e=0;e<3;e++){let t=n+e;r&&(t=r.getX(t)),qM[e].fromBufferAttribute(i,t)}for(let e=0;e<3;e++){const r=(e+1)%3,i=qM[e],s=qM[r],o=WM(i),a=WM(s),h=`${a}_${o}`;if(t.has(h)){const r=t.get(h);l[n+e]=r,l[r]=n+e,t.delete(h),c--,u++}else{const r=`${o}_${a}`;t.set(r,n+e),c++}}}this.matchedEdges=u,this.unmatchedEdges=c,this.data=l}}class YM extends n.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new n.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,r=t.elements;for(let e=0;e<16;e++)if(n[e]!==r[e])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(QC())for(const e in t){const n=t[e];if(n.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");n.array=WC(n.array)}if(e.boundsTree||(e.boundsTree=new VM(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new XM(e)),!e.groupIndices){const t=e.index.count/3,n=new Uint16Array(t),r=e.groups;for(let e=0,t=r.length;e<t;e++){const{start:t,count:i}=r[e];for(let r=t/3,s=(t+i)/3;r<s;r++)n[r]=e}e.groupIndices=n}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function KM(e,t){let n=t;return Array.isArray(t)||(n=[],e.forEach((e=>{n[e.materialIndex]=t}))),n}class JM{constructor(){this.triangleSplitter=new HC,this.attributeData=new XC,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new JC}evaluate(e,t,r,i=new YM){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:s,attributeData:o,attributes:a,useGroups:l,debug:c}=this,u=i.geometry,h=e.geometry.attributes;for(let e=0,t=a.length;e<t;e++){const t=a[e],n=h[t];o.initializeArray(t,n.array.constructor)}for(const e in o.attributes)a.includes(e)||o.delete(e);for(const e in u.attributes)a.includes(e)||(u.deleteAttribute(e),u.dispose());o.clear(),c.enabled&&(c.reset(),AS(c)),function(e,t,n,r,i,s){const{useGroups:o=!0}=s,{aIntersections:a,bIntersections:l}=function(e,t){const n=new ZC,r=new ZC;return eS.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,eS,{intersectsTriangles(e,t,i,s){if(e.intersectsTriangle(t,cS,!0)){if(0===cS.distanceSq()&&e.plane.normal.dot(t.plane.normal)<1-1e-10)return!1;n.add(i,s),r.add(s,i),bS&&(bS.addEdge(cS),bS.addIntersectingTriangles(i,e,s,t))}return!1}}),{aIntersections:n,bIntersections:r}}(e,t);let c;c=o?0:-1,LS(e,t,a,n,!1,i,c),OS(e,t,a,n,!1,r,i,c),c=o?e.geometry.groups.length||1:-1,LS(t,e,l,n,!0,i,c),OS(t,e,l,n,!0,r,i,c)}(e,t,r,s,o,{useGroups:l}),c.enabled&&AS(null);const p=l&&0!==e.geometry.groups.length?e.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],d=l&&0!==t.geometry.groups.length?t.geometry.groups.map((e=>({...e}))):[{start:0,count:1/0,materialIndex:0}],f=KM(p,e.material),m=KM(d,t.material);d.forEach((e=>{e.materialIndex+=f.length})),function(e,t,r,i){let s=!1,o=-1;const a=i.groupCount,l=e.attributes,c=i.groupAttributes[0];for(const r in c){const u=i.getTotalLength(r,a),h=c[r].type;let p=l[r];if(!p||p.array.length<u){const i=t.attributes[r];p=new n.TlE(new h(u),i.itemSize,i.normalized),e.setAttribute(r,p),s=!0}let d=0;for(let e=0;e<a;e++){const{array:t,type:n,length:s}=i.groupAttributes[e][r],o=new n(t.buffer,0,s);p.array.set(o,d),d+=o.length}p.needsUpdate=!0,o=u/p.itemSize}e.setDrawRange(0,o),e.clearGroups();let u=0;for(let t=0;t<a;t++){const n=i.getGroupArray("position",t).length/3;if(0!==n){const i=r[t];e.addGroup(u,n,i.materialIndex),u+=n}}if(e.index){const t=e.index.array;if(t.length<o)e.index=null,s=!0;else for(let e=0,n=t.length;e<n;e++)t[e]=e}e.boundsTree=null,s&&e.dispose()}(u,e.geometry,[...p,...d],o);const g=u.groups;if(l){const e=new Map,t=[...f,...m];let n=0;for(let r=0,i=t.length;r<i;r++)Boolean(g.find((e=>e.materialIndex===r)))?(e.set(r,n),n++):t[r]=null;for(let t=0,n=g.length;t<n;t++){const n=g[t];n.materialIndex=e.get(n.materialIndex)}i.material=t.filter((e=>e))}return i}evaluateHierarchy(e,t=new YM){e.updateMatrixWorld(!0);const n=(e,t)=>{const r=e.children;for(let e=0,i=r.length;e<i;e++){const i=r[e];i.isOperationGroup?n(i,t):t(i)}},r=e=>{const t=e.children;let i=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];i=r(n)||i}const s=e.isDirty();if(s&&e.markUpdated(),i&&!e.isOperationGroup){let t;return n(e,(n=>{t=t?this.evaluate(t,n,n.operation):this.evaluate(e,n,n.operation)})),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}return i||s};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const ZM={union:EC,subtract:CC,intersect:MC,difference:SC};function $M(e,t){const r=new JM;r.useGroups=!0,r.attributes=["position","normal","uv"],e.forEach((e=>{for(const t of[...r.attributes])e[0].geometry.getAttribute(t)||r.attributes.splice(r.attributes.indexOf(t),1)}));let i=new YM(new n._12(.01,.01,2,2));e.forEach((([e,t])=>{if(!Object.keys(ZM).includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const n=new YM;n.geometry=e.geometry,n.material=e.material,e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.updateMatrix(),n.updateMatrixWorld(),i=r.evaluate(i,n,ZM[t])}));const s=i;return s.userData._isCSGMesh=!0,s}let eT=class extends AC{_buildCSGMesh(e){return $M(e)}};eT.PluginType="CSGPluginBVH",eT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}([wt("CSG Plugin (BVH)")],eT);class tT extends qt{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{e.lastCamera?.removeControlsCtor?.(this.controlsKey),e.camera?.setControlsCtor?.(this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var nT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const rT=new n.Pa4(0,0,1),iT=new n.USm,sT=new n._fP,oT=new n._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),aT=new n._fP,lT={type:"change"};let cT=class extends t.SimpleEventDispatcher{constructor(e){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new n._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new n._fP,this._initQuaternionInvert=new n._fP,this._initQuaternionDest=new n._fP,this._lastTime=-1,!1===window.isSecureContext&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=e,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))})).catch((e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new n._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const e=this.deviceOrientation;if(e){const t=null!==e.alpha?n.M8C.degToRad(e.alpha):0,r=null!==e.beta?n.M8C.degToRad(e.beta):0,i=null!==e.gamma?n.M8C.degToRad(e.gamma):0,s=this.screenOrientation?n.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(t,r,i,s),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(lT))}}dispose(){this.disconnect()}setObjectQuaternion(e,n,r,i){const s=(0,t.now)()/1e3;iT.set(n,e,-r,"YXZ"),aT.setFromEuler(iT),aT.multiply(oT),aT.multiply(sT.setFromAxisAngle(rT,-i)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(aT).invert(),this._initQuaternionDest.__init=!0),aT.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(aT,this.dampingFactor/(Math.min(1,s-this._lastTime)/(1/60))),this._lastTime=s}};nT([Oe(),dt("Damping",[0,1],.01)],cT.prototype,"dampingFactor",void 0),cT=nT([xt("Device Orientation Controls")],cT);class uT extends tT{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new cT(e)}}uT.PluginType="DeviceOrientationControlsPlugin";var hT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const pT=new n.Pa4,dT=new n.$V,fT=new n.Pa4,mT={type:"change"};let gT=class extends t.SimpleEventDispatcher{constructor(e,t){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new n.Pa4,this._lastTime=-1,this.object=e,this.domElement=t,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const e=this.object.quaternion;pT.set(0,0,-1).applyQuaternion(e),dT.setFromVector3(pT),this.lat=90-n.M8C.radToDeg(dT.phi),this.lon=n.M8C.radToDeg(dT.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(e){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(e){this.domElement===document?(this.pointerX=e.pageX-this.viewHalfX,this.pointerY=e.pageY-this.viewHalfY):(this.pointerX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(e,t,n){return e.isVector3?fT.copy(e):void 0===t||void 0===n?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):fT.set(e,t,n),this.object.lookAt(fT),this.setOrientation(),this}update(){const e=(0,t.now)(),r=(this._lastTime<0?16:Math.min(e-this._lastTime,1e3))/1e3;if(this._lastTime=e,!this.enabled)return;if(this.heightSpeed){const e=n.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=r*(e*this.heightCoef)}else this.autoSpeedFactor=0;const i=r*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=r*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*s,this.lookVertical&&(this.lat-=this.pointerY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=n.M8C.degToRad(90-this.lat);const l=n.M8C.degToRad(this.lon);this.constrainVertical&&(a=n.M8C.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;this.targetPosition.setFromSphericalCoords(1,a,l).add(c),this.object.lookAt(this.targetPosition),this.dispatchEvent(mT)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(e){this.enableKeys&&e.preventDefault()}};hT([Oe(),ht()],gT.prototype,"enabled",void 0),hT([Oe(),ht()],gT.prototype,"enableKeys",void 0),hT([Oe(),_t()],gT.prototype,"movementSpeed",void 0),hT([Oe(),_t()],gT.prototype,"lookSpeed",void 0),hT([Oe(),ht()],gT.prototype,"lookVertical",void 0),hT([Oe(),ht()],gT.prototype,"autoForward",void 0),hT([Oe(),ht()],gT.prototype,"activeLook",void 0),hT([Oe(),ht()],gT.prototype,"heightSpeed",void 0),hT([Oe(),_t()],gT.prototype,"heightCoef",void 0),hT([Oe(),_t()],gT.prototype,"heightMin",void 0),hT([Oe(),_t()],gT.prototype,"heightMax",void 0),hT([Oe(),ht()],gT.prototype,"constrainVertical",void 0),hT([Oe(),_t()],gT.prototype,"verticalMin",void 0),hT([Oe(),_t()],gT.prototype,"verticalMax",void 0),hT([Oe(),ht()],gT.prototype,"mouseDragOn",void 0),gT=hT([wt("First Person Controls")],gT);class _T extends tT{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new gT(e,t)}}_T.PluginType="FirstPersonControlsPlugin";var vT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};const yT=new n.USm(0,0,0,"YXZ"),bT=new n.Pa4,AT={type:"change"},wT={type:"lock"},xT={type:"unlock"},ET=Math.PI/2;let CT=class extends t.SimpleEventDispatcher{constructor(e,t){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new n.Pa4(0,0,-1),this.domElement=t,this.object=e,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(e){this.isLocked||this.autoLockOnClick&&(e.preventDefault(),this.lock())}onMouseMove(e){this.isLocked&&(this._movementX+=e.movementX||e.mozMovementX||e.webkitMovementX||0,this._movementY+=e.movementY||e.mozMovementY||e.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(wT),this.isLocked=!0):(this.dispatchEvent(xT),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(e){return e.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(e){bT.setFromMatrixColumn(this.object.matrix,0),bT.crossVectors(this.object.up,bT),this.object.position.addScaledVector(bT,e)}moveRight(e){bT.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(bT,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(yT.setFromQuaternion(this.object.quaternion),yT.y-=.002*this._movementX*this.pointerSpeed,yT.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,yT.x=Math.max(ET-this.maxPolarAngle,Math.min(ET-this.minPolarAngle,yT.x)),this.object.quaternion.setFromEuler(yT),this.dispatchEvent(AT))}};vT([ht(),Oe()],CT.prototype,"enabled",void 0),vT([_t(),Oe()],CT.prototype,"minPolarAngle",void 0),vT([_t(),Oe()],CT.prototype,"maxPolarAngle",void 0),vT([_t(),Oe()],CT.prototype,"pointerSpeed",void 0),vT([ht(),Oe()],CT.prototype,"autoLockOnClick",void 0),CT=vT([xt("Pointer Lock Controls")],CT);class ST extends tT{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new CT(e,t.ownerDocument?t:t.documentElement)}}ST.PluginType="PointerLockControlsPlugin";class MT{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new n.SUY}loadModel(e){this._model=e,this.mixer=new n.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){const t=[];this._animations?.forEach((n=>{t.push(this.playClip(n,e))})),await Promise.all(t)}async reverseAllAnimation(e){const t=[];this._animations?.forEach((n=>{t.push(this.playClip(n,e,1,!0))})),await Promise.all(t)}async playClip(e,t,r=1,i=!1,s=!1){if(!this.mixer)return;const o=this.mixer.clipAction(e);return this._playingAnimations.has(o)&&this.mixer.dispatchEvent({type:"canceled",action:o}),s&&(this.mixer.setTime(0),this.mixer.stopAllAction()),i?(o.paused=!1,o.timeScale=-r):(o.reset(),o.timeScale=r),o.loop=t?n.YKA:n.jAl,o.clampWhenFinished=!0,new Promise((e=>{const t=async n=>{n.action===o&&(this.mixer.removeEventListener("finished",t),this.mixer.removeEventListener("canceled",t),this._playingAnimations.delete(o),e())};this.mixer.addEventListener("finished",t),this.mixer.addEventListener("canceled",t),this._playingAnimations.add(o),o.play()}))}playClipByName(e,t,n=1,r=!1){let i;this._animations.forEach((t=>{t.name===e&&(i=t)})),i&&this.playClip(i,t,n,r)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class TT extends qt{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){await super.onAdded(e),this._viewer?.addEventListener("postFrame",(()=>{this.helperIdentities.forEach((e=>{e.update()&&this._viewer?.setDirty()}))}))}createHelper(e,t){if(this.helperIdentities.has(e))this._viewer?.console.warn("Helper with this id already exists");else{const n=new MT;n.loadModel(t),this.helperIdentities.set(e,n)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,r=1,i=!1,s=!1){if(this.helperIdentities.has(e)){const o=this.helperIdentities.get(e);await o.playClip(t,n,r,i,s)}}async playAllAnimations(e,t){if(this.helperIdentities.has(e)){const n=this.helperIdentities.get(e);await n.playAllAnimations(t)}}async playAllAnimationsInReverse(e,t){if(this.helperIdentities.has(e)){const n=this.helperIdentities.get(e);await n.reverseAllAnimation(t)}}async playAnimationByName(e,t,n,r=1,i=!1){if(this.helperIdentities.has(e)){const s=this.helperIdentities.get(e);await s.playClipByName(t,n,r,i)}}}TT.PluginType="AnimationHelperPlugin";class DT extends qt{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,n,r)=>{(0,t.downloadBlob)(e,n)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,(({state:e,progress:n})=>{this.dispatchEvent({type:"transferFile",path:t,state:e??"exporting",progress:n})})),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}DT.PluginType="FileTransferPlugin";var IT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};class PT extends qt{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:n.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[Oh],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=e=>{this._preFrame(e)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){return this._viewer?.getPlugin(Oh)?.camViews??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){if(!this.enabled)return;const t=this._cameraViews;if(t.length<=1)return;if(!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=n.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=n.M8C.clamp(this._oldState,0,t.length-1.001);const r=Math.floor(this._oldState),i=this._overrideStartView||t[r],s=this._overrideEndView||t[r+1];let o,a=this._overrideStartView?this._overrideTime:this._oldState-r;a=Mh[this.animEase](a),o="spherical"===this.interpolateMode?this._lerpViewsSpherical(i,s,a):this._lerpViewsLinear(i,s,a);const l=this._viewer?.scene.activeCamera;l&&(l.position.copy(o[0]),l.target.copy(o[1]),l.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,r){const i=new n.Pa4,s=new n.Pa4;return s.lerpVectors(e.position,t.position,r),i.lerpVectors(e.target,t.target,r),[s,i]}_lerpViewsSpherical(e,t,r){const i=e.target.clone(),s=new n.Pa4,o=new n.Pa4,a=Lh(e,e.target),l=Lh(t,t.target),c=new n.$V;return c.phi=Fh(a.phi,l.phi,r),c.theta=Fh(a.theta,l.theta,r),c.radius=n.M8C.lerp(a.radius,l.radius,r),s.copy(i).lerp(t.target,r),o.setFromSpherical(c),o.add(s),[o,s]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new kh(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let r;r="spherical"===this.interpolateMode?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new kh(r[0],r[1]),this._overrideTime=0}}PT.PluginType="CameraViewControlPlugin",IT([ht("Enabled"),(0,t.onChange)(PT.prototype._onEnabledChanged1),Oe()],PT.prototype,"enabled",void 0),IT([Oe(),mt("Ease",Object.keys(Mh).map((e=>({label:e}))))],PT.prototype,"animEase",void 0),IT([Oe(),mt("Interpolation",["spherical","linear"].map((e=>({label:e}))))],PT.prototype,"interpolateMode",void 0),IT([ht("Enable Damping"),Oe()],PT.prototype,"enableDamping",void 0),IT([dt("Damping",[.01,1],.001),Oe()],PT.prototype,"damping",void 0),IT([dt("Init Anim Time",[.01,5],.001),Oe()],PT.prototype,"initAnimationTime",void 0);class RT extends PT{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...bt(this)]},"string"==typeof e?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled)return;if(this._cameraViews.length<=1)return;const t=this._findActiveView(),n=this._getScroll(t);this.setState(n+t),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],r=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],i=this.parent.getBoundingClientRect();if(!t||!r)return 0;const s=t.getBoundingClientRect(),o=r.getBoundingClientRect(),a=this.parent===document.body?0:i.top;return n.M8C.clamp((a-s.top)/Math.max(o.top-s.top,1e-4),0,1)}_findActiveView(){for(let e=this._cameraViews.length-1;e>=0;e--){const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],n=this.parent.getBoundingClientRect();if(t){if(t.getBoundingClientRect().top<(this.parent===document.body?0:n.top))return e}else this._cameraViews[e].name?.startsWith("#")&&console.error("section with id "+this._cameraViews[e].name+" doesn't exist!")}return 0}}RT.PluginType="ScrollableCameraViewPlugin";var BT,kT=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let OT=BT=class extends RT{generateCode(){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="200";const t=document.createElement("textarea");t.rows=20,t.style.border="3px solid #27223a",t.style.borderRadius="5px",t.style.width="30%",t.style.padding="5px",t.style.zIndex="1000";const n=document.createElement("div");n.textContent="X",n.style.color="red",n.style.width="20px",n.style.height="20px",n.style.padding="2",n.style.textAlign="center",n.style.backgroundColor="white",n.style.borderRadius="100%",n.style.border="2px solid #27223a",n.style.cursor="pointer",n.addEventListener("click",(()=>{this._viewer?.container.removeChild(e)}));const r=document.createElement("div");r.textContent="Update",r.style.marginTop="10px",r.style.color="white",r.style.padding="4px 10px 4px 10px",r.style.justifyContent="center",r.style.alignItems="center",r.style.backgroundColor="green",r.style.borderRadius="10px",r.style.border="2px solid #fff",r.style.cursor="pointer",r.addEventListener("click",(()=>{const e=this.parent.innerHTML;this.parent.innerHTML=t.value;let n=0;for(;n<this._cameraViews.length;n++){const e=this.parent.querySelector(this._cameraViews[n].name)??this.parent.getElementsByTagName("section")[n];if(!e&&n<2){alert("you need to add 2 sections at least");break}if(!e){const e=(this._cameraViews[n].name?.startsWith("#"),this._cameraViews[n].name.replace(/^#/,""));t.value+=e,t.value=this._format(t.value)}}n<2?this.parent.innerHTML=e:async function(e,t){e.innerHTML=t;const n=e.getElementsByTagName("script");for(let e=0;e<n.length;e++){const t=n[e],r=oy(t);let i=!1;await new Promise((e=>{r.onload=e,r.onerror=()=>{i=!0,e(void 0)}})),i||t.parentNode?.replaceChild(r,t)}}(this.parent,t.value)})),e.appendChild(n),e.appendChild(t),e.appendChild(r),t.value=this._format(this.parent.innerHTML),this._viewer?.container.appendChild(e)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(e=document.body,t=!1){super(e,t),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(e){this.parent=this.wrapper,await super.onAdded(e),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),this._viewer?.getPlugin(Oh)?.addEventListener("viewDelete",this.deleteView),this._viewer?.getPlugin(Oh)?.addEventListener("deserialize",this.deserialize),this._viewer?.getPlugin(Oh)?.addEventListener("viewAdd",this.addView)}deserialize(e){this._cameraViews.forEach((e=>{this._createSection(e.name)}))}_addWrapper(){this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",this._viewer?.container.appendChild(this.wrapper)}_createSection(e){const t=document.createElement("section");t.style.width="100%",t.style.height="100%",t.style.opacity="50%",t.style.backgroundColor="black",t.style.zIndex="100",t.style.top="0",t.textContent=e,t.style.color="white",t.style.fontSize="100px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.id=e,this.parent.appendChild(t)}addView(e){this._cameraViews.forEach(((e,t)=>{if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t])){const t=`<section id="${e.name?.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">\n                    ${e.name}\n                    </section>`;this.parent.innerHTML+=t}}))}deleteView(e){const t=this.parent.querySelector(e.view.name)??this.parent.getElementsByTagName("section").namedItem(e.view.name);t?.remove()}_format(e){let t="",n="";return e.split(/>\s*</).forEach((function(e){e.match(/^\/\w/)&&(n=n.substring(1)),t+=n+"<"+e+">\r\n",e.match(/^<?\w[^>]*[^/]$/)&&!e.startsWith("input")&&(n+="\t")})),t.substring(1,t.length-3)}};kT([gt("Show/Edit Code")],OT.prototype,"generateCode",null),kT([ht("Canvas on top"),(0,t.onChange)(BT.prototype._togglePreview)],OT.prototype,"canvasUp",void 0),OT=BT=kT([wt("Scrollable Camera View Preview (Dev)")],OT);var LT={d:(e,t)=>{for(var n in t)LT.o(t,n)&&!LT.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},FT={};LT.d(FT,{Q:()=>rD});var UT=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};const NT=Symbol("Comlink.proxy"),jT=Symbol("Comlink.endpoint"),zT=Symbol("Comlink.releaseProxy"),GT=Symbol("Comlink.thrown"),VT=e=>"object"==typeof e&&null!==e||"function"==typeof e,HT=new Map([["proxy",{canHandle:e=>VT(e)&&e[NT],serialize(e){const{port1:t,port2:n}=new MessageChannel;return QT(e,t),[n,[n]]},deserialize:e=>(e.start(),qT(e))}],["throw",{canHandle:e=>VT(e)&&GT in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function QT(e,t=self){t.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:i,type:s,path:o}=Object.assign({path:[]},r.data),a=(r.data.argumentList||[]).map(eD);let l;try{const t=o.slice(0,-1).reduce(((e,t)=>e[t]),e),n=o.reduce(((e,t)=>e[t]),e);switch(s){case"GET":l=n;break;case"SET":t[o.slice(-1)[0]]=eD(r.data.value),l=!0;break;case"APPLY":l=n.apply(t,a);break;case"CONSTRUCT":l=ZT(new n(...a));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;QT(e,n),l=function(e,t){return JT.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[GT]:0}}Promise.resolve(l).catch((e=>({value:e,[GT]:0}))).then((e=>{const[r,o]=$T(e);t.postMessage(Object.assign(Object.assign({},r),{id:i}),o),"RELEASE"===s&&(t.removeEventListener("message",n),WT(t))}))})),t.start&&t.start()}function WT(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function qT(e,t){return YT(e,[],t)}function XT(e){if(e)throw new Error("Proxy has been released and is not useable")}function YT(e,t=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(n,s){if(XT(r),s===zT)return()=>tD(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{WT(e),r=!0}));if("then"===s){if(0===t.length)return{then:()=>i};const n=tD(e,{type:"GET",path:t.map((e=>e.toString()))}).then(eD);return n.then.bind(n)}return YT(e,[...t,s])},set(n,i,s){XT(r);const[o,a]=$T(s);return tD(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:o},a).then(eD)},apply(n,i,s){XT(r);const o=t[t.length-1];if(o===jT)return tD(e,{type:"ENDPOINT"}).then(eD);if("bind"===o)return YT(e,t.slice(0,-1));const[a,l]=KT(s);return tD(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:a},l).then(eD)},construct(n,i){XT(r);const[s,o]=KT(i);return tD(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},o).then(eD)}});return i}function KT(e){const t=e.map($T);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const JT=new WeakMap;function ZT(e){return Object.assign(e,{[NT]:!0})}function $T(e){for(const[t,n]of HT)if(n.canHandle(e)){const[r,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},i]}return[{type:"RAW",value:e},JT.get(e)||[]]}function eD(e){switch(e.type){case"HANDLER":return HT.get(e.name).deserialize(e.value);case"RAW":return e.value}}function tD(e,t,n){return new Promise((r=>{const i=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===i&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),n)}))}class nD extends class{}{init(e,t,n,r){if(!this.api){if(!r)throw new Error("workerFilePath is required");(()=>{var i,s,o;i=this,o=function*(){const i=yield fetch(r).then((e=>e.blob())),s=URL.createObjectURL(i),o=new Worker(s,{type:"module"});this.api=yield new(qT(o))(ZT((()=>{e(),URL.revokeObjectURL(s)})),ZT(((e,t)=>"xatlas_web.wasm"===e?n:e+t)),ZT(t))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{a(o.next(e))}catch(e){t(e)}}function r(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,r)}a((o=o.apply(i,[])).next())}))})()}}}class rD extends class{constructor(e,t={resolution:2048},n={},r=!1,i=!1,s=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=r,this.timeUnwrap=i,this.logProgress=s,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return UT(this,void 0,void 0,(function*(){if(!this._libraryLoaded){for(yield new Promise(((r,i)=>{try{this.xAtlas.init((()=>{r()}),e,t,n)}catch(e){i(e)}}));!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise((e=>setTimeout(e,100)));this._libraryLoaded=!0}}))}packAtlas(e,t="uv2",n="uv"){return UT(this,void 0,void 0,(function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const r=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)yield new Promise((e=>setTimeout(e,100)));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let i=[],s="";for(let t of e){let{uuid:e,index:n,attributes:o}=t;const a=t.userData.worldScale||1;i.push(e),n&&o.position&&3===o.position.itemSize?(s="Mesh"+i.length+" added to atlas: "+e,this.timeUnwrap&&console.time(s),yield this.xAtlas.api.addMesh(n.array,o.position.array,o.normal?o.normal.array:void 0,o.uv?o.uv.array:void 0,e,this.useNormals,r,a),this.timeUnwrap&&console.timeEnd(s)):console.warn("xatlas-three: Geometry not supported: ",t)}s="Generated atlas with "+i.length+" meshes",this.timeUnwrap&&console.time(s);let o=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(s);let a=[];for(let r of o){let i=e.find((e=>e.uuid===r.mesh));i?(r.vertex.vertices&&i.setAttribute("position",new this.THREE.BufferAttribute(r.vertex.vertices,3,!1)),r.vertex.normals&&i.setAttribute("normal",new this.THREE.BufferAttribute(r.vertex.normals,3,!0)),r.vertex.coords1&&i.setAttribute(t,new this.THREE.BufferAttribute(r.vertex.coords1,2,!1)),r.vertex.coords&&t!==n&&i.setAttribute(n,new this.THREE.BufferAttribute(r.vertex.coords,2,!1)),r.index&&i.setIndex(new this.THREE.BufferAttribute(r.index,1,!1)),a.push(i)):console.error("xatlas-three: Mesh not found: ",r.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,a}))}unwrapGeometry(e,t="uv",n="uv2"){return UT(this,void 0,void 0,(function*(){return this.packAtlas([e],t,n)}))}}{_createXAtlas(){return new nD}}var iD,sD=FT.Q,oD=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let aD=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};oD([Oe()],aD.prototype,"fixWinding",void 0),oD([Oe()],aD.prototype,"maxBoundaryLength",void 0),oD([Oe()],aD.prototype,"maxChartArea",void 0),oD([Oe()],aD.prototype,"maxCost",void 0),oD([Oe()],aD.prototype,"maxIterations",void 0),oD([Oe()],aD.prototype,"normalDeviationWeight",void 0),oD([Oe()],aD.prototype,"normalSeamWeight",void 0),oD([Oe()],aD.prototype,"roundnessWeight",void 0),oD([Oe()],aD.prototype,"straightnessWeight",void 0),oD([Oe()],aD.prototype,"textureSeamWeight",void 0),oD([Oe()],aD.prototype,"useInputMeshUvs",void 0),aD=oD([wt("Chart Options"),Ge("UChartOptions")],aD);let lD=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};oD([Oe()],lD.prototype,"bilinear",void 0),oD([Oe()],lD.prototype,"blockAlign",void 0),oD([Oe()],lD.prototype,"bruteForce",void 0),oD([Oe()],lD.prototype,"createImage",void 0),oD([Oe()],lD.prototype,"maxChartSize",void 0),oD([Oe()],lD.prototype,"padding",void 0),oD([Oe()],lD.prototype,"resolution",void 0),oD([Oe()],lD.prototype,"rotateCharts",void 0),oD([Oe()],lD.prototype,"rotateChartsToAxis",void 0),oD([Oe()],lD.prototype,"texelsPerUnit",void 0),lD=oD([wt("Pack Options"),Ge("UPackOptions")],lD);let cD=iD=class extends qt{constructor(e=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new aD,this.packOptions=new lD,this._loaded=!1,this._unwrapProgress=(e,t)=>{},this.unwrapSelected=async()=>{const e=this._viewer?.getPlugin(_l)?.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await(this._viewer?.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else this._viewer?.alert("Unwrap: Selected object has no geometry");else this._viewer?.alert("Unwrap: No object selected")},e&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,t.timeout)(100);else this._unwrapper=new sD({BufferAttribute:n.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,iD.LIBRARY_PATH+"xatlas.wasm",iD.LIBRARY_PATH+"xatlas.js"),this._loaded=!0}async unwrapGeometry(e,t="uv",n="uv"){await this.loadLibrary(),await(this._unwrapper?.unwrapGeometry(e,t,n))}async packAtlas(e,t=!0,n="uv2",r="uv"){await this.loadLibrary(),Array.isArray(e)||(e=[e]);const i=[];t?e.forEach((e=>e.traverse((e=>{e.geometry&&i.push(e.geometry)})))):e.forEach((e=>{e.geometry&&i.push(e.geometry)})),await(this._unwrapper?.packAtlas(i,n,r))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};cD.PluginType="XAtlasPlugin",cD.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",oD([(0,t.onChange)(iD.prototype._useNormalsChanged),Oe()],cD.prototype,"useNormals",void 0),oD([Oe()],cD.prototype,"chartOptions",void 0),oD([Oe()],cD.prototype,"packOptions",void 0),oD([gt("Unwrap Selected Geometry")],cD.prototype,"unwrapSelected",void 0),cD=iD=oD([wt("UV Unwrapping (xAtlas)")],cD);class uD extends qt{constructor(){super(...arguments),this.dependencies=[fo],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,n)=>{let r=e.icon;return(r&&/^(\w+)\(([^)]*)\)/.exec(r)||/^#([A-Fa-f\d]+)$/.exec(r))&&(r=(0,t.makeColorSvg)(r)),r&&r.startsWith("http")&&r.startsWith("data:")||(r=this.utils.pathToIcon(this.baseUrl+n+"/"+e.prefix+(r||""))),r},getItemIcon:(e,n,r)=>{const i=e.iconFiles[n];if(i)return URL.createObjectURL(i);let s=e.icons[n];return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,t.makeColorSvg)(s)),s||(s=this.utils.pathToIcon(e.items[n])),!s||s.startsWith("http")||s.startsWith("data:")||(s=this.baseUrl+r+"/"+e.prefix+s),s},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,r=!1){if(!this._viewer)return;const i=this._getVariationId(e);"number"==typeof t&&(t=e.items[t]);const s=e.items.indexOf(t);if(-1===s)return void this._viewer.console.warn(`Item ${t} not found`);const o=e.itemFiles[s],a=e.selected;if(!r&&a===s)return;e.selected=s;const l=this._viewer.getManager(),c=this.utils.getItemPath(e,s,n);if("objects"===n){let e=this._viewer.scene.findObjectsByName(i).map((e=>e.modelObject));0===e.length&&(e=[(await this._viewer.createObject3D()).modelObject],e[0].name=i),this._viewer.renderEnabled=!1;for(const t of e)[...t.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));const t=await this._loadObject(c,o);if(!t.length)return void(c.endsWith("json")||this._viewer.console.warn(`Object ${c} not found`));let n=!1;for(const r of e){[...r.children].forEach((e=>e.dispose&&this.autoDispose?e.dispose():e.removeFromParent()));for(const e of t)n?r.add(e.modelObject.clone()):r.add(e.modelObject);n=!0}const r=[],s=this.variations.materials.filter((e=>e&&"number"==typeof e.selected));for(const e of s)r.push(this.applyVariation(e,e.selected,"materials",!0));await Promise.all(r),this._viewer.renderEnabled=!0}if("materials"===n){const t=await this._loadMaterial(c,o);if(!t)return void this._viewer.console.warn(`Material ${c} not found`);t.userData.__isVariation=!0;const n=this._viewer.scene.findObjectsByName(i),r=n=>{n.material&&(Array.isArray(n.material)?0!==n.material.length&&e.data?.matType!==n.material[0].typeSlug:e.data?.matType!==n.material.typeSlug)||n?.setMaterial?.(t)};for(const t of n)e.data?.traverse?t.traverse(r):r(t);l.materials?.applyMaterial(t,i)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const e=this._getVariationId(t),n=this._viewer.scene.findObjectsByName(e);for(const e of n)[...e.children].forEach((e=>(e.dispose??e.removeFromParent)()))}}async _loadMaterial(e,t){return this._viewer?.getManager()?.importer?.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){return this._viewer?.getManager()?.importer?.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){"string"==typeof e&&(e=JSON.parse(e)),void 0!==e.baseUrl&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t="object"==typeof e.folder?e.folder:"string"==typeof e.folder?ao(zs(e.folder)):ao(e.folder));for(const n of this._ty)if(e[n])for(const r of e[n]){const e={items:r.items,prefix:r.prefix,name:r.name,title:r.title||"",icon:r.icon||"",icons:r.icons??r.items.map((()=>"")),titles:r.titles??r.items.map((()=>"")),itemFiles:[],iconFiles:[],data:{...r.data}};if(t)for(let i=0;i<r.items.length;i++){const s=r.items[i],o=t[n+"/"+r.prefix+s];e.itemFiles[i]=o?new File([o],s):void 0;const a=r.icons[i];if(!a)continue;const l=t[n+"/"+r.prefix+a];e.iconFiles[i]=l?new File([l],a):void 0}this.variations[n].push(e)}}async importPath(e){if(e.endsWith(".json")){const t=await(this._viewer?.getManager().importer?.importSinglePath(e,{processImported:!1})),n=e.split("?")[0];return this.baseUrl||(this.baseUrl=n.substring(0,n.lastIndexOf("/")+1)),this.importConfig(t)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){return this.variations.materials.find((t=>this.utils.getName(t)===e))?.items||[]}getObjects(e){return this.variations.objects.find((t=>this.utils.getName(t)===e))?.items||[]}getMaterialVariations(){return this.variations.materials.map((e=>this.utils.getName(e)))}getObjectVariations(){return this.variations.objects.map((e=>this.utils.getName(e)))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){let e={objects:{},materials:{}};const t={objects:[],materials:[],type:uD.PluginType};this.baseUrl&&(t.baseUrl=this.baseUrl);let n=!1;for(const r of this._ty)for(const i of this.variations[r]){const s={...i};s.data={...s.data},delete s.itemFiles,delete s.iconFiles,t[r].push(s);const o=i.prefix.replace(/^\//,""),a=o.trimEnd().endsWith("/")?"":o.split("/").pop()||"",l=o.replace(a,"").trimEnd().replace(/\/$/,""),c={};let u=!1;for(let e=0;e<i.items.length;e++){const t=i.items[e],n=i.itemFiles[e],r=i.iconFiles[e],s=i.icons[e];n?(c[a+t]=new Uint8Array(await n.arrayBuffer()),r&&!s&&this._viewer?.console.error("Icon file without icon name"),r&&s&&(c[a+s]=new Uint8Array(await r.arrayBuffer())),u=!0):r&&alert("Icon file without model/material file not supported")}if(!u)continue;n=!0;const h=l.split("/");let p=e[r];for(const e of h){p[e]||(p[e]={});const t=p[e];if("object"!=typeof t)throw new Error("Invalid prefix: "+i.prefix);p=t}Object.assign(p,c)}return n||(e=void 0),{folder:e,config:t}}}uD.PluginType="VariationConfiguratorPlugin";class hD extends uD{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled)return!1;if(!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,dm.RemoveAll(hD.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])dm.Create(hD.PluginType,this.utils.getTitle(t),5,20,0,t.items.map(((n,r)=>({id:n,image:this.utils.getItemIcon(t,r,e),onClick:async n=>this.applyVariation(t,n,e,!1),tooltip:this.utils.getItemTitle(t,r)}))),((e,t)=>P_(e,{placement:"bottom",content:t.tooltip})));return dm.RebuildUi(this._viewer.container),!0}}hD.PluginType="VariationConfiguratorPlugin";class pD extends hD{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map((e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map((n=>({type:"folder",expanded:this._uiExpandedState[n.name],onExpand:()=>this._uiExpandedState[n.name]=!0,onCollapse:()=>this._uiExpandedState[n.name]=!1,label:()=>this.utils.getName(n),children:[{type:"input",placeholder:()=>this.utils.getName(n),property:[n,"name"]},{type:"input",property:[n,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(n)),property:[n,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+n.prefix),property:[n,"icon"]},{type:"folder",label:"items",children:n.items.map(((r,i)=>({type:"folder",label:()=>n.items[i],children:[{type:"input",label:"File/URL",isMonitor:!n.itemFiles[i],getValue:()=>n.items[i],setValue:e=>{n.items[i]=e}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(n.items[i]),getValue:()=>n.icons[i],setValue:e=>{n.icons[i]=e}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(n.items[i]),getValue:()=>n.titles[i],setValue:e=>{n.titles[i]=e}},{type:"button",label:"Apply",value:async()=>this.applyVariation(n,i,e)},n.itemFiles[i]?[{type:"button",label:"Remove",value:()=>{n.items.splice(i,1),n.itemFiles.splice(i,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const e=await(0,t.uploadFile)(!1,!1);0!==e.length&&(n.itemFiles[i]=e[0],n.items[i]=e[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const e=n.itemFiles[i];(0,t.downloadBlob)(e,e.name)}}]:{}]})))},{type:"button",label:"Add item (local)",value:async()=>{const r=await(0,t.uploadFile)(!0,!1);if(0!==r.length){for(const t of r){if(!this._extForType[e].includes(t.name.split(".").pop()??"")){await(this._viewer?.alert(`Invalid file: ${t.name} is not a valid ${e} file`));continue}if(n.items.includes(t.name)){await(this._viewer?.alert(`Already exists: Item with name ${t.name} already exists`));continue}const r=n.items.push(t.name)-1;n.icons[r]="",n.titles[r]="",n.itemFiles[r]=t}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{const t=await(this._viewer?.prompt("URL: Enter the url of the object/material"));if(!t)return;if(!t.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await(this._viewer?.alert(`Invalid url: ${t} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(t.split(".").pop()??""))return void await(this._viewer?.alert(`Invalid url: ${t} should be of a material ending with mat`));n.items.includes(t)&&await(this._viewer?.alert(`Already exists: Item with url ${t} already exists`)),n.items.push(t);const r=n.items.length-1;n.icons[r]="",n.titles[r]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(n),value:async()=>{await(this._viewer?.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(n)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(n),1),this.refreshUi())}}]}))),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{const t=await(this._viewer?.prompt("Name: Enter the name of the object/material"));t&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:t+"/",name:t,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{const n=await(0,t.uploadFile)(!1,!0);if(0===n.length)return;const r=[],i=[],s=[],o=[];for(const t of n){if(t.name.startsWith("."))continue;const n=t.name.split(".").pop()??"";n?this._extForType[e].includes(n)?(r.push(t.webkitRelativePath.replace(/^\//,"")),i.push(t)):this._extForType.images.includes(n)?(s.push(t.webkitRelativePath.replace(/^\//,"")),o.push(t)):await(this._viewer?.alert(`Invalid file: ${t.name} is not a valid ${e} file`)):await(this._viewer?.alert(`Invalid file: ${t.name} has no extension`))}const a=(0,t.longestCommonPrefix)(r),l=this.utils.getName({prefix:a});let c=await(this._viewer?.prompt("Name: Enter the name of the object/material",l,!0));if(null===c)return;c=c||l;const u=r.map((e=>{const t=e.replace(a,""),n=t.split(".").pop()??"",r=t.replace("."+n,"")+".",i=s.findIndex((e=>e.replace(a,"").startsWith(r)));return i<0?["",void 0]:[s[i].replace(a,""),o[i]||void 0]}));this.variations[e].push({items:r.map((e=>e.replace(a,""))),icons:u.map((e=>e[0])),iconFiles:u.map((e=>e[1])),titles:r.map((()=>"")),itemFiles:i,prefix:a,name:c,icon:"",title:""}),this.refreshUi()}}]}))),{type:"button",label:"Download JSON/Zip",value:async()=>{try{const{folder:e,config:n}=await this._exportConfiguratorState(),r=JSON.stringify(n,null,4);if(e){e["config.json"]=zs(r);const n=await to(e),i=new Blob([n],{type:"application/zip"});(0,t.downloadBlob)(i,"configurator.zip")}else{const e=new Blob([r],{type:"application/json"});(0,t.downloadBlob)(e,"config.json")}}catch(e){return this._viewer?.console.error(e),void await(this._viewer?.alert("Error: "+(e?.message||e)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{const e=await(0,t.uploadFile)(!1,!1,"application/zip,application/json");if(0===e.length)return;const n=e[0];if(n.name.endsWith(".zip")){const e=ao(new Uint8Array(await n.arrayBuffer()));if(!e["config.json"])return void await(this._viewer?.alert("Invalid zip: config.json not found"));const t=JSON.parse(Gs(e["config.json"]));this.importConfig(t,e)}else{if(!n.name.endsWith(".json"))return void await(this._viewer?.alert("Invalid file: "+n.name));{const e=JSON.parse(await n.text());this.importConfig(e)}}await(this._viewer?.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{const e=await(this._viewer?.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await(this._viewer?.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{await(this._viewer?.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){this.uiConfig?.uiRefresh?.("postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const e of n)(e.modelObject||e).userData.excludeFromExport=!0;return n}}pD.PluginType="VariationConfiguratorPlugin";class dD{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new mD);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new mD);const n=this.elements,r=e.x,i=e.y,s=e.z;return t.x=n[0]*r+n[1]*i+n[2]*s,t.y=n[3]*r+n[4]*i+n[5]*s,t.z=n[6]*r+n[7]*i+n[8]*s,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new dD);const n=this.elements,r=e.elements,i=t.elements,s=n[0],o=n[1],a=n[2],l=n[3],c=n[4],u=n[5],h=n[6],p=n[7],d=n[8],f=r[0],m=r[1],g=r[2],_=r[3],v=r[4],y=r[5],b=r[6],A=r[7],w=r[8];return i[0]=s*f+o*_+a*b,i[1]=s*m+o*v+a*A,i[2]=s*g+o*y+a*w,i[3]=l*f+c*_+u*b,i[4]=l*m+c*v+u*A,i[5]=l*g+c*y+u*w,i[6]=h*f+p*_+d*b,i[7]=h*m+p*v+d*A,i[8]=h*g+p*y+d*w,t}scale(e,t){void 0===t&&(t=new dD);const n=this.elements,r=t.elements;for(let t=0;3!==t;t++)r[3*t+0]=e.x*n[3*t+0],r[3*t+1]=e.y*n[3*t+1],r[3*t+2]=e.z*n[3*t+2];return t}solve(e,t){void 0===t&&(t=new mD);const n=[];let r,i;for(r=0;r<12;r++)n.push(0);for(r=0;r<3;r++)for(i=0;i<3;i++)n[r+4*i]=this.elements[r+3*i];n[3]=e.x,n[7]=e.y,n[11]=e.z;let s=3;const o=s;let a,l;do{if(r=o-s,0===n[r+4*r])for(i=r+1;i<o;i++)if(0!==n[r+4*i]){a=4;do{l=4-a,n[l+4*r]+=n[l+4*i]}while(--a);break}if(0!==n[r+4*r])for(i=r+1;i<o;i++){const e=n[r+4*i]/n[r+4*r];a=4;do{l=4-a,n[l+4*i]=l<=r?0:n[l+4*i]-n[l+4*r]*e}while(--a)}}while(--s);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){void 0===e&&(e=new dD);const t=fD;let n,r;for(n=0;n<3;n++)for(r=0;r<3;r++)t[n+6*r]=this.elements[n+3*r];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let i=3;const s=i;let o,a;do{if(n=s-i,0===t[n+6*n])for(r=n+1;r<s;r++)if(0!==t[n+6*r]){o=6;do{a=6-o,t[a+6*n]+=t[a+6*r]}while(--o);break}if(0!==t[n+6*n])for(r=n+1;r<s;r++){const e=t[n+6*r]/t[n+6*n];o=6;do{a=6-o,t[a+6*r]=a<=n?0:t[a+6*r]-t[a+6*n]*e}while(--o)}}while(--i);n=2;do{r=n-1;do{const e=t[n+6*r]/t[n+6*n];o=6;do{a=6-o,t[a+6*r]=t[a+6*r]-t[a+6*n]*e}while(--o)}while(r--)}while(--n);n=2;do{const e=1/t[n+6*n];o=6;do{a=6-o,t[a+6*n]=t[a+6*n]*e}while(--o)}while(n--);n=2;do{r=2;do{if(a=t[3+r+6*n],isNaN(a)||a===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,r,a)}while(r--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,r=e.z,i=e.w,s=t+t,o=n+n,a=r+r,l=t*s,c=t*o,u=t*a,h=n*o,p=n*a,d=r*a,f=i*s,m=i*o,g=i*a,_=this.elements;return _[0]=1-(h+d),_[1]=c-g,_[2]=u+m,_[3]=c+g,_[4]=1-(l+d),_[5]=p-f,_[6]=u-m,_[7]=p+f,_[8]=1-(l+h),this}transpose(e){void 0===e&&(e=new dD);const t=this.elements,n=e.elements;let r;return n[0]=t[0],n[4]=t[4],n[8]=t[8],r=t[1],n[1]=t[3],n[3]=r,r=t[2],n[2]=t[6],n[6]=r,r=t[5],n[5]=t[7],n[7]=r,e}}const fD=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class mD{constructor(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){void 0===t&&(t=new mD);const n=e.x,r=e.y,i=e.z,s=this.x,o=this.y,a=this.z;return t.x=o*i-a*r,t.y=a*n-s*i,t.z=s*r-o*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new mD(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new mD(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new dD([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,r=Math.sqrt(e*e+t*t+n*n);if(r>0){const e=1/r;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return r}unit(e){void 0===e&&(e=new mD);const t=this.x,n=this.y,r=this.z;let i=Math.sqrt(t*t+n*n+r*r);return i>0?(i=1/i,e.x=t*i,e.y=n*i,e.z=r*i):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z;return Math.sqrt((i-t)*(i-t)+(s-n)*(s-n)+(o-r)*(o-r))}distanceSquared(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z;return(i-t)*(i-t)+(s-n)*(s-n)+(o-r)*(o-r)}scale(e,t){void 0===t&&(t=new mD);const n=this.x,r=this.y,i=this.z;return t.x=e*n,t.y=e*r,t.z=e*i,t}vmul(e,t){return void 0===t&&(t=new mD),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return void 0===n&&(n=new mD),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new mD),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const r=gD,i=1/n;r.set(this.x*i,this.y*i,this.z*i);const s=_D;Math.abs(r.x)<.9?(s.set(1,0,0),r.cross(s,e)):(s.set(0,1,0),r.cross(s,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const r=this.x,i=this.y,s=this.z;n.x=r+(e.x-r)*t,n.y=i+(e.y-i)*t,n.z=s+(e.z-s)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(vD),vD.almostEquals(e,t)}clone(){return new mD(this.x,this.y,this.z)}}mD.ZERO=new mD(0,0,0),mD.UNIT_X=new mD(1,0,0),mD.UNIT_Y=new mD(0,1,0),mD.UNIT_Z=new mD(0,0,1);const gD=new mD,_D=new mD,vD=new mD;class yD{constructor(e){void 0===e&&(e={}),this.lowerBound=new mD,this.upperBound=new mD,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,r){const i=this.lowerBound,s=this.upperBound,o=n;i.copy(e[0]),o&&o.vmult(i,i),s.copy(i);for(let t=1;t<e.length;t++){let n=e[t];o&&(o.vmult(n,bD),n=bD),n.x>s.x&&(s.x=n.x),n.x<i.x&&(i.x=n.x),n.y>s.y&&(s.y=n.y),n.y<i.y&&(i.y=n.y),n.z>s.z&&(s.z=n.z),n.z<i.z&&(i.z=n.z)}return t&&(t.vadd(i,i),t.vadd(s,s)),r&&(i.x-=r,i.y-=r,i.z-=r,s.x+=r,s.y+=r,s.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new yD).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,i=e.upperBound,s=r.x<=n.x&&n.x<=i.x||t.x<=i.x&&i.x<=n.x,o=r.y<=n.y&&n.y<=i.y||t.y<=i.y&&i.y<=n.y,a=r.z<=n.z&&n.z<=i.z||t.z<=i.z&&i.z<=n.z;return s&&o&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,r=e.lowerBound,i=e.upperBound;return t.x<=r.x&&n.x>=i.x&&t.y<=r.y&&n.y>=i.y&&t.z<=r.z&&n.z>=i.z}getCorners(e,t,n,r,i,s,o,a){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),r.set(l.x,c.y,c.z),i.set(c.x,l.y,c.z),s.set(l.x,c.y,l.z),o.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(e,t){const n=AD,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(r,i,s,o,a,l,c,u);for(let t=0;8!==t;t++){const r=n[t];e.pointToLocal(r,r)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=AD,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7];this.getCorners(r,i,s,o,a,l,c,u);for(let t=0;8!==t;t++){const r=n[t];e.pointToWorld(r,r)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,r=1/t.x,i=1/t.y,s=1/t.z,o=(this.lowerBound.x-n.x)*r,a=(this.upperBound.x-n.x)*r,l=(this.lowerBound.y-n.y)*i,c=(this.upperBound.y-n.y)*i,u=(this.lowerBound.z-n.z)*s,h=(this.upperBound.z-n.z)*s,p=Math.max(Math.max(Math.min(o,a),Math.min(l,c)),Math.min(u,h)),d=Math.min(Math.min(Math.max(o,a),Math.max(l,c)),Math.max(u,h));return!(d<0||p>d)}}const bD=new mD,AD=[new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD];class wD{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:r}=t;if(r>n){const e=r;r=n,n=e}return this.matrix[(n*(n+1)>>1)+r-1]}set(e,t,n){let{index:r}=e,{index:i}=t;if(i>r){const e=i;i=r,r=e}this.matrix[(r*(r+1)>>1)+i-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class xD{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}hasAnyEventListener(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[e])return this;const r=n[e].indexOf(t);return-1!==r&&n[e].splice(r,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let n=0,r=t.length;n<r;n++)t[n].call(this,e)}return this}}class ED{constructor(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new mD),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=CD,n=SD;e.tangents(t,n),this.setFromAxisAngle(t,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new ED);const n=this.x,r=this.y,i=this.z,s=this.w,o=e.x,a=e.y,l=e.z,c=e.w;return t.x=n*c+s*o+r*l-i*a,t.y=r*c+s*a+i*o-n*l,t.z=i*c+s*l+n*a-r*o,t.w=s*c-n*o-r*a-i*l,t}inverse(e){void 0===e&&(e=new ED);const t=this.x,n=this.y,r=this.z,i=this.w;this.conjugate(e);const s=1/(t*t+n*n+r*r+i*i);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return void 0===e&&(e=new ED),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new mD);const n=e.x,r=e.y,i=e.z,s=this.x,o=this.y,a=this.z,l=this.w,c=l*n+o*i-a*r,u=l*r+a*n-s*i,h=l*i+s*r-o*n,p=-s*n-o*r-a*i;return t.x=c*l+p*-s+u*-a-h*-o,t.y=u*l+p*-o+h*-s-c*-a,t.z=h*l+p*-a+c*-o-u*-s,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,r,i;void 0===t&&(t="YZX");const s=this.x,o=this.y,a=this.z,l=this.w;if("YZX"!==t)throw new Error(`Euler order ${t} not supported yet.`);{const e=s*o+a*l;if(e>.499&&(n=2*Math.atan2(s,l),r=Math.PI/2,i=0),e<-.499&&(n=-2*Math.atan2(s,l),r=-Math.PI/2,i=0),void 0===n){const t=s*s,c=o*o,u=a*a;n=Math.atan2(2*o*l-2*s*a,1-2*c-2*u),r=Math.asin(2*e),i=Math.atan2(2*s*l-2*o*a,1-2*t-2*u)}}e.y=n,e.z=r,e.x=i}setFromEuler(e,t,n,r){void 0===r&&(r="XYZ");const i=Math.cos(e/2),s=Math.cos(t/2),o=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(n/2);return"XYZ"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o-a*l*c):"YXZ"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o+a*l*c):"ZXY"===r?(this.x=a*s*o-i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o-a*l*c):"ZYX"===r?(this.x=a*s*o-i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o+a*l*c):"YZX"===r?(this.x=a*s*o+i*l*c,this.y=i*l*o+a*s*c,this.z=i*s*c-a*l*o,this.w=i*s*o-a*l*c):"XZY"===r&&(this.x=a*s*o-i*l*c,this.y=i*l*o-a*s*c,this.z=i*s*c+a*l*o,this.w=i*s*o+a*l*c),this}clone(){return new ED(this.x,this.y,this.z,this.w)}slerp(e,t,n){void 0===n&&(n=new ED);const r=this.x,i=this.y,s=this.z,o=this.w;let a,l,c,u,h,p=e.x,d=e.y,f=e.z,m=e.w;return l=r*p+i*d+s*f+o*m,l<0&&(l=-l,p=-p,d=-d,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),u=Math.sin((1-t)*a)/c,h=Math.sin(t*a)/c):(u=1-t,h=t),n.x=u*r+h*p,n.y=u*i+h*d,n.z=u*s+h*f,n.w=u*o+h*m,n}integrate(e,t,n,r){void 0===r&&(r=new ED);const i=e.x*n.x,s=e.y*n.y,o=e.z*n.z,a=this.x,l=this.y,c=this.z,u=this.w,h=.5*t;return r.x+=h*(i*u+s*c-o*l),r.y+=h*(s*u+o*a-i*c),r.z+=h*(o*u+i*l-s*a),r.w+=h*(-i*a-s*l-o*c),r}}const CD=new mD,SD=new mD;class MD{constructor(e){void 0===e&&(e={}),this.id=MD.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}MD.idCounter=0,MD.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class TD{constructor(e){void 0===e&&(e={}),this.position=new mD,this.quaternion=new ED,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return TD.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return TD.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new mD),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,r){return void 0===r&&(r=new mD),n.vsub(e,r),t.conjugate(DD),DD.vmult(r,r),r}static pointToWorldFrame(e,t,n,r){return void 0===r&&(r=new mD),t.vmult(n,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,n){return void 0===n&&(n=new mD),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,r){return void 0===r&&(r=new mD),t.w*=-1,t.vmult(n,r),t.w*=-1,r}}const DD=new ED;class ID extends MD{constructor(e){void 0===e&&(e={});const{vertices:t=[],faces:n=[],normals:r=[],axes:i,boundingSphereRadius:s}=e;super({type:MD.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=r,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=i?i.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const r=new mD;for(let i=0;i!==e.length;i++){const s=e[i],o=s.length;for(let e=0;e!==o;e++){const i=(e+1)%o;t[s[e]].vsub(t[s[i]],r),r.normalize();let a=!1;for(let e=0;e!==n.length;e++)if(n[e].almostEquals(r)||n[e].almostEquals(r)){a=!0;break}a||n.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error(`Vertex ${this.faces[e][t]} not found!`);const t=this.faceNormals[e]||new mD;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let t=0;t<this.faces[e].length;t++)console.warn(`.vertices[${this.faces[e][t]}] = Vec3(${this.vertices[this.faces[e][t]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],r=this.vertices[n[0]],i=this.vertices[n[1]],s=this.vertices[n[2]];ID.computeNormal(r,i,s,t)}static computeNormal(e,t,n,r){const i=new mD,s=new mD;t.vsub(e,s),n.vsub(t,i),i.cross(s,r),r.isZero()||r.normalize()}clipAgainstHull(e,t,n,r,i,s,o,a,l){const c=new mD;let u=-1,h=-Number.MAX_VALUE;for(let e=0;e<n.faces.length;e++){c.copy(n.faceNormals[e]),i.vmult(c,c);const t=c.dot(s);t>h&&(h=t,u=e)}const p=[];for(let e=0;e<n.faces[u].length;e++){const t=n.vertices[n.faces[u][e]],s=new mD;s.copy(t),i.vmult(s,s),r.vadd(s,s),p.push(s)}u>=0&&this.clipFaceAgainstHull(s,e,t,p,o,a,l)}findSeparatingAxis(e,t,n,r,i,s,o,a){const l=new mD,c=new mD,u=new mD,h=new mD,p=new mD,d=new mD;let f=Number.MAX_VALUE;const m=this;if(m.uniqueAxes)for(let o=0;o!==m.uniqueAxes.length;o++){n.vmult(m.uniqueAxes[o],l);const a=m.testSepAxis(l,e,t,n,r,i);if(!1===a)return!1;a<f&&(f=a,s.copy(l))}else{const a=o?o.length:m.faces.length;for(let c=0;c<a;c++){const a=o?o[c]:c;l.copy(m.faceNormals[a]),n.vmult(l,l);const u=m.testSepAxis(l,e,t,n,r,i);if(!1===u)return!1;u<f&&(f=u,s.copy(l))}}if(e.uniqueAxes)for(let o=0;o!==e.uniqueAxes.length;o++){i.vmult(e.uniqueAxes[o],c);const a=m.testSepAxis(c,e,t,n,r,i);if(!1===a)return!1;a<f&&(f=a,s.copy(c))}else{const o=a?a.length:e.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;c.copy(e.faceNormals[o]),i.vmult(c,c);const u=m.testSepAxis(c,e,t,n,r,i);if(!1===u)return!1;u<f&&(f=u,s.copy(c))}}for(let o=0;o!==m.uniqueEdges.length;o++){n.vmult(m.uniqueEdges[o],h);for(let o=0;o!==e.uniqueEdges.length;o++)if(i.vmult(e.uniqueEdges[o],p),h.cross(p,d),!d.almostZero()){d.normalize();const o=m.testSepAxis(d,e,t,n,r,i);if(!1===o)return!1;o<f&&(f=o,s.copy(d))}}return r.vsub(t,u),u.dot(s)>0&&s.negate(s),!0}testSepAxis(e,t,n,r,i,s){ID.project(this,e,n,r,PD),ID.project(t,e,i,s,RD);const o=PD[0],a=PD[1],l=RD[0],c=RD[1];if(o<c||l<a)return!1;const u=o-c,h=l-a;return u<h?u:h}calculateLocalInertia(e,t){const n=new mD,r=new mD;this.computeLocalAABB(r,n);const i=n.x-r.x,s=n.y-r.y,o=n.z-r.z;t.x=1/12*e*(2*s*2*s+2*o*2*o),t.y=1/12*e*(2*i*2*i+2*o*2*o),t.z=1/12*e*(2*s*2*s+2*i*2*i)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],r=this.vertices[t[0]];return-n.dot(r)}clipFaceAgainstHull(e,t,n,r,i,s,o){const a=new mD,l=new mD,c=new mD,u=new mD,h=new mD,p=new mD,d=new mD,f=new mD,m=this,g=r,_=[];let v=-1,y=Number.MAX_VALUE;for(let t=0;t<m.faces.length;t++){a.copy(m.faceNormals[t]),n.vmult(a,a);const r=a.dot(e);r<y&&(y=r,v=t)}if(v<0)return;const b=m.faces[v];b.connectedFaces=[];for(let e=0;e<m.faces.length;e++)for(let t=0;t<m.faces[e].length;t++)-1!==b.indexOf(m.faces[e][t])&&e!==v&&-1===b.connectedFaces.indexOf(e)&&b.connectedFaces.push(e);const A=b.length;for(let e=0;e<A;e++){const r=m.vertices[b[e]],i=m.vertices[b[(e+1)%A]];r.vsub(i,l),c.copy(l),n.vmult(c,c),t.vadd(c,c),u.copy(this.faceNormals[v]),n.vmult(u,u),t.vadd(u,u),c.cross(u,h),h.negate(h),p.copy(r),n.vmult(p,p),t.vadd(p,p);const s=b.connectedFaces[e];d.copy(this.faceNormals[s]);const o=this.getPlaneConstantOfFace(s);f.copy(d),n.vmult(f,f);const a=o-f.dot(t);for(this.clipFaceAgainstPlane(g,_,f,a);g.length;)g.shift();for(;_.length;)g.push(_.shift())}d.copy(this.faceNormals[v]);const w=this.getPlaneConstantOfFace(v);f.copy(d),n.vmult(f,f);const x=w-f.dot(t);for(let e=0;e<g.length;e++){let t=f.dot(g[e])+x;if(t<=i&&(t=i),t<=s){const n=g[e];if(t<=1e-6){const e={point:n,normal:f,depth:t};o.push(e)}}}}clipFaceAgainstPlane(e,t,n,r){let i,s;const o=e.length;if(o<2)return t;let a=e[e.length-1],l=e[0];i=n.dot(a)+r;for(let c=0;c<o;c++){if(l=e[c],s=n.dot(l)+r,i<0)if(s<0){const e=new mD;e.copy(l),t.push(e)}else{const e=new mD;a.lerp(l,i/(i-s),e),t.push(e)}else if(s<0){const e=new mD;a.lerp(l,i/(i-s),e),t.push(e),t.push(l)}a=l,i=s}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new mD);const n=this.vertices,r=this.worldVertices;for(let i=0;i!==this.vertices.length;i++)t.vmult(n[i],r[i]),e.vadd(r[i],r[i]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const i=n[r];i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y),i.z<e.z?e.z=i.z:i.z>t.z&&(t.z=i.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new mD);const n=this.faceNormals,r=this.worldFaceNormals;for(let i=0;i!==t;i++)e.vmult(n[i],r[i]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const r=t[n].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,r){const i=this.vertices;let s,o,a,l,c,u,h=new mD;for(let n=0;n<i.length;n++){h.copy(i[n]),t.vmult(h,h),e.vadd(h,h);const r=h;(void 0===s||r.x<s)&&(s=r.x),(void 0===l||r.x>l)&&(l=r.x),(void 0===o||r.y<o)&&(o=r.y),(void 0===c||r.y>c)&&(c=r.y),(void 0===a||r.z<a)&&(a=r.z),(void 0===u||r.z>u)&&(u=r.z)}n.set(s,o,a),r.set(l,c,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new mD);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,r=this.vertices;if(t){for(let e=0;e<n;e++){const n=r[e];t.vmult(n,n)}for(let e=0;e<this.faceNormals.length;e++){const n=this.faceNormals[e];t.vmult(n,n)}}if(e)for(let t=0;t<n;t++){const n=r[t];n.vadd(e,n)}}pointIsInside(e){const t=this.vertices,n=this.faces,r=this.faceNormals,i=new mD;this.getAveragePointLocal(i);for(let s=0;s<this.faces.length;s++){let o=r[s];const a=t[n[s][0]],l=new mD;e.vsub(a,l);const c=o.dot(l),u=new mD;i.vsub(a,u);const h=o.dot(u);if(c<0&&h>0||c>0&&h<0)return!1}return-1}static project(e,t,n,r,i){const s=e.vertices.length,o=BD;let a=0,l=0;const c=kD,u=e.vertices;c.setZero(),TD.vectorToLocalFrame(n,r,t,o),TD.pointToLocalFrame(n,r,c,c);const h=c.dot(o);l=a=u[0].dot(o);for(let e=1;e<s;e++){const t=u[e].dot(o);t>a&&(a=t),t<l&&(l=t)}if(l-=h,a-=h,l>a){const e=l;l=a,a=e}i[0]=a,i[1]=l}}const PD=[],RD=[],BD=(new mD,new mD),kD=new mD;class OD extends MD{constructor(e){super({type:MD.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,r=mD,i=[new r(-e,-t,-n),new r(e,-t,-n),new r(e,t,-n),new r(-e,t,-n),new r(-e,-t,n),new r(e,-t,n),new r(e,t,n),new r(-e,t,n)],s=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],o=new ID({vertices:i,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=o,o.material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new mD),OD.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const r=e;n.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,t){const n=e,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),void 0!==t)for(let e=0;e!==n.length;e++)t.vmult(n[e],n[e]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const r=this.halfExtents,i=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let r=0;r<i.length;r++)LD.set(i[r][0],i[r][1],i[r][2]),t.vmult(LD,LD),e.vadd(LD,LD),n(LD.x,LD.y,LD.z)}calculateWorldAABB(e,t,n,r){const i=this.halfExtents;FD[0].set(i.x,i.y,i.z),FD[1].set(-i.x,i.y,i.z),FD[2].set(-i.x,-i.y,i.z),FD[3].set(-i.x,-i.y,-i.z),FD[4].set(i.x,-i.y,-i.z),FD[5].set(i.x,i.y,-i.z),FD[6].set(-i.x,i.y,-i.z),FD[7].set(i.x,-i.y,i.z);const s=FD[0];t.vmult(s,s),e.vadd(s,s),r.copy(s),n.copy(s);for(let i=1;i<8;i++){const s=FD[i];t.vmult(s,s),e.vadd(s,s);const o=s.x,a=s.y,l=s.z;o>r.x&&(r.x=o),a>r.y&&(r.y=a),l>r.z&&(r.z=l),o<n.x&&(n.x=o),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const LD=new mD,FD=[new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD];class UD extends xD{constructor(e){void 0===e&&(e={}),super(),this.id=UD.idCounter++,this.index=-1,this.world=null,this.vlambda=new mD,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new mD,this.previousPosition=new mD,this.interpolatedPosition=new mD,this.initPosition=new mD,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new mD,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new mD,this.force=new mD;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?UD.STATIC:UD.DYNAMIC,typeof e.type==typeof UD.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=UD.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new mD,this.quaternion=new ED,this.initQuaternion=new ED,this.previousQuaternion=new ED,this.interpolatedQuaternion=new ED,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new mD,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new mD,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new mD,this.invInertia=new mD,this.invInertiaWorld=new dD,this.invMassSolve=0,this.invInertiaSolve=new mD,this.invInertiaWorldSolve=new dD,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new mD(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new mD(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new yD,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new mD,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=UD.AWAKE,this.wakeUpAfterNarrowphase=!1,e===UD.SLEEPING&&this.dispatchEvent(UD.wakeupEvent)}sleep(){this.sleepState=UD.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;t===UD.AWAKE&&n<r?(this.sleepState=UD.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(UD.sleepyEvent)):t===UD.SLEEPY&&n>r?this.wakeUp():t===UD.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(UD.sleepEvent))}}updateSolveMassProperties(){this.sleepState===UD.SLEEPING||this.type===UD.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new mD),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new mD),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new mD),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new mD),this.quaternion.vmult(e,t),t}addShape(e,t,n){const r=new mD,i=new ED;return t&&r.copy(t),n&&i.copy(n),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let r=0;for(let i=0;i!==n;i++){const n=e[i];n.updateBoundingSphereRadius();const s=t[i].length(),o=n.boundingSphereRadius;s+o>r&&(r=s+o)}this.boundingRadius=r}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,r=e.length,i=ND,s=jD,o=this.quaternion,a=this.aabb,l=zD;for(let c=0;c!==r;c++){const r=e[c];o.vmult(t[c],i),i.vadd(this.position,i),o.mult(n[c],s),r.calculateWorldAABB(i,s,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=GD,n=VD;e.setRotationFromQuaternion(this.quaternion),e.transpose(n),e.scale(t,e),e.mmult(n,this.invInertiaWorld)}}applyForce(e,t){if(void 0===t&&(t=new mD),this.type!==UD.DYNAMIC)return;this.sleepState===UD.SLEEPING&&this.wakeUp();const n=HD;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(void 0===t&&(t=new mD),this.type!==UD.DYNAMIC)return;const n=QD,r=WD;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,r),this.applyForce(n,r)}applyTorque(e){this.type===UD.DYNAMIC&&(this.sleepState===UD.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new mD),this.type!==UD.DYNAMIC)return;this.sleepState===UD.SLEEPING&&this.wakeUp();const n=t,r=qD;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const i=XD;n.cross(e,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}applyLocalImpulse(e,t){if(void 0===t&&(t=new mD),this.type!==UD.DYNAMIC)return;const n=YD,r=KD;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,r),this.applyImpulse(n,r)}updateMassProperties(){const e=JD;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),OD.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new mD;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==UD.DYNAMIC&&this.type!==UD.KINEMATIC||this.sleepState===UD.SLEEPING)return;const r=this.velocity,i=this.angularVelocity,s=this.position,o=this.force,a=this.torque,l=this.quaternion,c=this.invMass,u=this.invInertiaWorld,h=this.linearFactor,p=c*e;r.x+=o.x*p*h.x,r.y+=o.y*p*h.y,r.z+=o.z*p*h.z;const d=u.elements,f=this.angularFactor,m=a.x*f.x,g=a.y*f.y,_=a.z*f.z;i.x+=e*(d[0]*m+d[1]*g+d[2]*_),i.y+=e*(d[3]*m+d[4]*g+d[5]*_),i.z+=e*(d[6]*m+d[7]*g+d[8]*_),s.x+=r.x*e,s.y+=r.y*e,s.z+=r.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}UD.idCounter=0,UD.COLLIDE_EVENT_NAME="collide",UD.DYNAMIC=1,UD.STATIC=2,UD.KINEMATIC=4,UD.AWAKE=0,UD.SLEEPY=1,UD.SLEEPING=2,UD.wakeupEvent={type:"wakeup"},UD.sleepyEvent={type:"sleepy"},UD.sleepEvent={type:"sleep"};const ND=new mD,jD=new ED,zD=new yD,GD=new dD,VD=new dD,HD=(new dD,new mD),QD=new mD,WD=new mD,qD=new mD,XD=new mD,YD=new mD,KD=new mD,JD=new mD;class ZD{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&UD.STATIC)&&e.sleepState!==UD.SLEEPING||0==(t.type&UD.STATIC)&&t.sleepState!==UD.SLEEPING)}intersectionTest(e,t,n,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,r):this.doBoundingSphereBroadphase(e,t,n,r)}doBoundingSphereBroadphase(e,t,n,r){const i=$D;t.position.vsub(e.position,i);const s=(e.boundingRadius+t.boundingRadius)**2;i.lengthSquared()<s&&(n.push(e),r.push(t))}doBoundingBoxBroadphase(e,t,n,r){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),r.push(t))}makePairsUnique(e,t){const n=eI,r=tI,i=nI,s=e.length;for(let n=0;n!==s;n++)r[n]=e[n],i[n]=t[n];e.length=0,t.length=0;for(let e=0;e!==s;e++){const t=r[e].id,s=i[e].id,o=t<s?`${t},${s}`:`${s},${t}`;n[o]=e,n.keys.push(o)}for(let s=0;s!==n.keys.length;s++){const s=n.keys.pop(),o=n[s];e.push(r[o]),t.push(i[o]),delete n[s]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new mD;e.position.vsub(t.position,n);const r=e.shapes[0],i=t.shapes[0];return Math.pow(r.boundingSphereRadius+i.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const $D=new mD;new mD,new ED,new mD;const eI={keys:[]},tI=[],nI=[];new mD,new mD,new mD;class rI extends ZD{constructor(){super()}collisionPairs(e,t,n){const r=e.bodies,i=r.length;let s,o;for(let e=0;e!==i;e++)for(let i=0;i!==e;i++)s=r[e],o=r[i],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,t,n)}aabbQuery(e,t,n){void 0===n&&(n=[]);for(let r=0;r<e.bodies.length;r++){const i=e.bodies[r];i.aabbNeedsUpdate&&i.updateAABB(),i.aabb.overlaps(t)&&n.push(i)}return n}}class iI{constructor(){this.rayFromWorld=new mD,this.rayToWorld=new mD,this.hitNormalWorld=new mD,this.hitPointWorld=new mD,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,r,i,s,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=i,this.body=s,this.distance=o}}let sI,oI,aI,lI,cI,uI,hI;sI=MD.types.SPHERE,oI=MD.types.PLANE,aI=MD.types.BOX,lI=MD.types.CYLINDER,cI=MD.types.CONVEXPOLYHEDRON,uI=MD.types.HEIGHTFIELD,hI=MD.types.TRIMESH;class pI{get[sI](){return this._intersectSphere}get[oI](){return this._intersectPlane}get[aI](){return this._intersectBox}get[lI](){return this._intersectConvex}get[cI](){return this._intersectConvex}get[uI](){return this._intersectHeightfield}get[hI](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new mD),void 0===t&&(t=new mD),this.from=e.clone(),this.to=t.clone(),this.direction=new mD,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=pI.ANY,this.result=new iI,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||pI.ANY,this.result=t.result||new iI,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(dI),fI.length=0,e.broadphase.aabbQuery(e,dI,fI),this.intersectBodies(fI),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse)return;if(0==(this.collisionFilterGroup&e.collisionFilterMask)||0==(e.collisionFilterGroup&this.collisionFilterMask))return;const r=_I,i=vI;for(let t=0,s=e.shapes.length;t<s;t++){const s=e.shapes[t];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[t],i),e.quaternion.vmult(e.shapeOffsets[t],r),r.vadd(e.position,r),this.intersectShape(s,i,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let t=0,n=e.length;!this.result.shouldStop&&t<n;t++)this.intersectBody(e[t])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,r){const i=function(e,t,n){n.vsub(e,NI);const r=NI.dot(t);return t.scale(r,jI),jI.vadd(e,jI),n.distanceTo(jI)}(this.from,this.direction,n);if(i>e.boundingSphereRadius)return;const s=this[e.type];s&&s.call(this,e,t,n,r,e)}_intersectBox(e,t,n,r,i){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,r,i)}_intersectPlane(e,t,n,r,i){const s=this.from,o=this.to,a=this.direction,l=new mD(0,0,1);t.vmult(l,l);const c=new mD;s.vsub(n,c);const u=c.dot(l);if(o.vsub(n,c),u*c.dot(l)>0)return;if(s.distanceTo(o)<u)return;const h=l.dot(a);if(Math.abs(h)<this.precision)return;const p=new mD,d=new mD,f=new mD;s.vsub(n,p);const m=-l.dot(p)/h;a.scale(m,d),s.vadd(d,f),this.reportIntersection(l,f,i,r,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,r=this.to,i=this.from;t.x=Math.min(r.x,i.x),t.y=Math.min(r.y,i.y),t.z=Math.min(r.z,i.z),n.x=Math.max(r.x,i.x),n.y=Math.max(r.y,i.y),n.z=Math.max(r.z,i.z)}_intersectHeightfield(e,t,n,r,i){e.data,e.elementSize;const s=CI;s.from.copy(this.from),s.to.copy(this.to),TD.pointToLocalFrame(n,t,s.from,s.from),TD.pointToLocalFrame(n,t,s.to,s.to),s.updateDirection();const o=SI;let a,l,c,u;a=l=0,c=u=e.data.length-1;const h=new yD;s.getAABB(h),e.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,o,!0),a=Math.max(a,o[0]),l=Math.max(l,o[1]),e.getIndexOfPosition(h.upperBound.x,h.upperBound.y,o,!0),c=Math.min(c,o[0]+1),u=Math.min(u,o[1]+1);for(let o=a;o<c;o++)for(let a=l;a<u;a++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(o,a,h),h.overlapsRay(s)){if(e.getConvexTrianglePillar(o,a,!1),TD.pointToWorldFrame(n,t,e.pillarOffset,EI),this._intersectConvex(e.pillarConvex,t,EI,r,i,xI),this.result.shouldStop)return;e.getConvexTrianglePillar(o,a,!0),TD.pointToWorldFrame(n,t,e.pillarOffset,EI),this._intersectConvex(e.pillarConvex,t,EI,r,i,xI)}}}_intersectSphere(e,t,n,r,i){const s=this.from,o=this.to,a=e.radius,l=(o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2,c=2*((o.x-s.x)*(s.x-n.x)+(o.y-s.y)*(s.y-n.y)+(o.z-s.z)*(s.z-n.z)),u=c**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-a**2),h=MI,p=TI;if(!(u<0))if(0===u)s.lerp(o,u,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1);else{const e=(-c-Math.sqrt(u))/(2*l),t=(-c+Math.sqrt(u))/(2*l);if(e>=0&&e<=1&&(s.lerp(o,e,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(s.lerp(o,t,h),h.vsub(n,p),p.normalize(),this.reportIntersection(p,h,i,r,-1))}}_intersectConvex(e,t,n,r,i,s){const o=DI,a=II,l=s&&s.faceList||null,c=e.faces,u=e.vertices,h=e.faceNormals,p=this.direction,d=this.from,f=this.to,m=d.distanceTo(f),g=l?l.length:c.length,_=this.result;for(let e=0;!_.shouldStop&&e<g;e++){const s=l?l[e]:e,f=c[s],g=h[s],v=t,y=n;a.copy(u[f[0]]),v.vmult(a,a),a.vadd(y,a),a.vsub(d,a),v.vmult(g,o);const b=p.dot(o);if(Math.abs(b)<this.precision)continue;const A=o.dot(a)/b;if(!(A<0)){p.scale(A,yI),yI.vadd(d,yI),bI.copy(u[f[0]]),v.vmult(bI,bI),y.vadd(bI,bI);for(let e=1;!_.shouldStop&&e<f.length-1;e++){AI.copy(u[f[e]]),wI.copy(u[f[e+1]]),v.vmult(AI,AI),v.vmult(wI,wI),y.vadd(AI,AI),y.vadd(wI,wI);const t=yI.distanceTo(d);!pI.pointInTriangle(yI,bI,AI,wI)&&!pI.pointInTriangle(yI,AI,bI,wI)||t>m||this.reportIntersection(o,yI,i,r,s)}}}}_intersectTrimesh(e,t,n,r,i,s){const o=PI,a=FI,l=UI,c=II,u=RI,h=BI,p=kI,d=LI,f=OI,m=e.indices;e.vertices;const g=this.from,_=this.to,v=this.direction;l.position.copy(n),l.quaternion.copy(t),TD.vectorToLocalFrame(n,t,v,u),TD.pointToLocalFrame(n,t,g,h),TD.pointToLocalFrame(n,t,_,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,p.vsub(h,u),u.normalize();const y=h.distanceSquared(p);e.tree.rayQuery(this,l,a);for(let s=0,l=a.length;!this.result.shouldStop&&s!==l;s++){const l=a[s];e.getNormal(l,o),e.getVertex(m[3*l],bI),bI.vsub(h,c);const p=u.dot(o),g=o.dot(c)/p;if(g<0)continue;u.scale(g,yI),yI.vadd(h,yI),e.getVertex(m[3*l+1],AI),e.getVertex(m[3*l+2],wI);const _=yI.distanceSquared(h);!pI.pointInTriangle(yI,AI,bI,wI)&&!pI.pointInTriangle(yI,bI,AI,wI)||_>y||(TD.vectorToWorldFrame(t,o,f),TD.pointToWorldFrame(n,t,yI,d),this.reportIntersection(f,d,i,r,l))}a.length=0}reportIntersection(e,t,n,r,i){const s=this.from,o=this.to,a=s.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==i?i:-1,this.mode){case pI.ALL:this.hasHit=!0,l.set(s,o,e,t,n,r,a),l.hasHit=!0,this.callback(l);break;case pI.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,e,t,n,r,a));break;case pI.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,e,t,n,r,a),l.shouldStop=!0}}static pointInTriangle(e,t,n,r){r.vsub(t,NI),n.vsub(t,mI),e.vsub(t,gI);const i=NI.dot(NI),s=NI.dot(mI),o=NI.dot(gI),a=mI.dot(mI),l=mI.dot(gI);let c,u;return(c=a*o-s*l)>=0&&(u=i*l-s*o)>=0&&c+u<i*a-s*s}}pI.CLOSEST=1,pI.ANY=2,pI.ALL=4;const dI=new yD,fI=[],mI=new mD,gI=new mD,_I=new mD,vI=new ED,yI=new mD,bI=new mD,AI=new mD,wI=new mD;new mD,new iI;const xI={faceList:[0]},EI=new mD,CI=new pI,SI=[],MI=new mD,TI=new mD,DI=new mD,II=(new mD,new mD,new mD),PI=new mD,RI=new mD,BI=new mD,kI=new mD,OI=new mD,LI=new mD;new yD;const FI=[],UI=new TD,NI=new mD,jI=new mD;class zI{static defaults(e,t){void 0===e&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class GI{constructor(e,t,n){void 0===n&&(n={}),n=zI.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=GI.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}GI.idCounter=0;class VI{constructor(){this.spatial=new mD,this.rotational=new mD}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class HI{constructor(e,t,n,r){void 0===n&&(n=-1e6),void 0===r&&(r=1e6),this.id=HI.idCounter++,this.minForce=n,this.maxForce=r,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new VI,this.jacobianElementB=new VI,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const r=t,i=e,s=n;this.a=4/(s*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(s*s*i*(1+4*r))}computeB(e,t,n){const r=this.computeGW();return-this.computeGq()*e-r*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,r=this.bj,i=n.position,s=r.position;return e.spatial.dot(i)+t.spatial.dot(s)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,r=this.bj,i=n.velocity,s=r.velocity,o=n.angularVelocity,a=r.angularVelocity;return e.multiplyVectors(i,o)+t.multiplyVectors(s,a)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,r=this.bj,i=n.vlambda,s=r.vlambda,o=n.wlambda,a=r.wlambda;return e.multiplyVectors(i,o)+t.multiplyVectors(s,a)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,r=this.bj,i=n.force,s=n.torque,o=r.force,a=r.torque,l=n.invMassSolve,c=r.invMassSolve;return i.scale(l,QI),o.scale(c,WI),n.invInertiaWorldSolve.vmult(s,qI),r.invInertiaWorldSolve.vmult(a,XI),e.multiplyVectors(QI,qI)+t.multiplyVectors(WI,XI)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,r=this.bj,i=n.invMassSolve,s=r.invMassSolve,o=n.invInertiaWorldSolve,a=r.invInertiaWorldSolve;let l=i+s;return o.vmult(e.rotational,YI),l+=YI.dot(e.rotational),a.vmult(t.rotational,YI),l+=YI.dot(t.rotational),l}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,i=this.bj,s=KI;r.vlambda.addScaledVector(r.invMassSolve*e,t.spatial,r.vlambda),i.vlambda.addScaledVector(i.invMassSolve*e,n.spatial,i.vlambda),r.invInertiaWorldSolve.vmult(t.rotational,s),r.wlambda.addScaledVector(e,s,r.wlambda),i.invInertiaWorldSolve.vmult(n.rotational,s),i.wlambda.addScaledVector(e,s,i.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}HI.idCounter=0;const QI=new mD,WI=new mD,qI=new mD,XI=new mD,YI=new mD,KI=new mD;class JI extends HI{constructor(e,t,n){void 0===n&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new mD,this.rj=new mD,this.ni=new mD}computeB(e){const t=this.a,n=this.b,r=this.bi,i=this.bj,s=this.ri,o=this.rj,a=ZI,l=$I,c=r.velocity,u=r.angularVelocity;r.force,r.torque;const h=i.velocity,p=i.angularVelocity;i.force,i.torque;const d=eP,f=this.jacobianElementA,m=this.jacobianElementB,g=this.ni;s.cross(g,a),o.cross(g,l),g.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(g),m.rotational.copy(l),d.copy(i.position),d.vadd(o,d),d.vsub(r.position,d),d.vsub(s,d);const _=g.dot(d),v=this.restitution+1;return-_*t-(v*h.dot(g)-v*c.dot(g)+p.dot(l)-u.dot(a))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=tP,t=nP,n=rP,r=iP,i=sP;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(r,t),e.vsub(t,i),this.ni.dot(i)}}const ZI=new mD,$I=new mD,eP=new mD,tP=new mD,nP=new mD,rP=new mD,iP=new mD,sP=new mD;class oP extends GI{constructor(e,t,n,r,i){void 0===t&&(t=new mD),void 0===r&&(r=new mD),void 0===i&&(i=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=r.clone();const s=this.equationX=new JI(e,n),o=this.equationY=new JI(e,n),a=this.equationZ=new JI(e,n);this.equations.push(s,o,a),s.minForce=o.minForce=a.minForce=-i,s.maxForce=o.maxForce=a.maxForce=i,s.ni.set(1,0,0),o.ni.set(0,1,0),a.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,r=this.equationY,i=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj)}}new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD;class aP extends HI{constructor(e,t,n){super(e,t,-n,n),this.ri=new mD,this.rj=new mD,this.t=new mD}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,r=this.rj,i=lP,s=cP,o=this.t;n.cross(o,i),r.cross(o,s);const a=this.jacobianElementA,l=this.jacobianElementB;return o.negate(a.spatial),i.negate(a.rotational),l.spatial.copy(o),l.rotational.copy(s),-this.computeGW()*t-e*this.computeGiMf()}}const lP=new mD,cP=new mD;class uP{constructor(e,t,n){n=zI.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=uP.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}uP.idCounter=0;class hP{constructor(e){void 0===e&&(e={});let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=hP.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}hP.idCounter=0,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new pI,new mD,new mD,new mD,new mD(1,0,0),new mD(0,1,0),new mD(0,0,1),new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD;class pP extends MD{constructor(e){if(super({type:MD.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){void 0===t&&(t=new mD);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,r){const i=this.radius,s=["x","y","z"];for(let t=0;t<s.length;t++){const o=s[t];n[o]=e[o]-i,r[o]=e[o]+i}}}new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD;class dP extends ID{constructor(e,t,n,r){if(void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const i=r,s=[],o=[],a=[],l=[],c=[],u=Math.cos,h=Math.sin;s.push(new mD(-t*h(0),.5*-n,t*u(0))),l.push(0),s.push(new mD(-e*h(0),.5*n,e*u(0))),c.push(1);for(let r=0;r<i;r++){const p=2*Math.PI/i*(r+1),d=2*Math.PI/i*(r+.5);r<i-1?(s.push(new mD(-t*h(p),.5*-n,t*u(p))),l.push(2*r+2),s.push(new mD(-e*h(p),.5*n,e*u(p))),c.push(2*r+3),a.push([2*r,2*r+1,2*r+3,2*r+2])):a.push([2*r,2*r+1,1,0]),(i%2==1||r<i/2)&&o.push(new mD(-h(d),0,u(d)))}a.push(l),o.push(new mD(0,1,0));const p=[];for(let e=0;e<c.length;e++)p.push(c[c.length-e-1]);a.push(p),super({vertices:s,faces:a,axes:o}),this.type=MD.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=r}}class fP extends MD{constructor(){super({type:MD.types.PLANE}),this.worldNormal=new mD,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return void 0===t&&(t=new mD),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,r){mP.set(0,0,1),t.vmult(mP,mP);const i=Number.MAX_VALUE;n.set(-i,-i,-i),r.set(i,i,i),1===mP.x?r.x=e.x:-1===mP.x&&(n.x=e.x),1===mP.y?r.y=e.y:-1===mP.y&&(n.y=e.y),1===mP.z?r.z=e.z:-1===mP.z&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const mP=new mD;new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD,new mD;class gP{constructor(e){void 0===e&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new yD,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){void 0===n&&(n=0);const r=this.data;if(!this.aabb.contains(e))return!1;const i=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let r=!1;i.length||(this.subdivide(),r=!0);for(let r=0;8!==r;r++)if(i[r].insert(e,t,n+1))return!0;r&&(i.length=0)}return r.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,r=this.children;r.push(new gP({aabb:new yD({lowerBound:new mD(0,0,0)})}),new gP({aabb:new yD({lowerBound:new mD(1,0,0)})}),new gP({aabb:new yD({lowerBound:new mD(1,1,0)})}),new gP({aabb:new yD({lowerBound:new mD(1,1,1)})}),new gP({aabb:new yD({lowerBound:new mD(0,1,1)})}),new gP({aabb:new yD({lowerBound:new mD(0,0,1)})}),new gP({aabb:new yD({lowerBound:new mD(1,0,1)})}),new gP({aabb:new yD({lowerBound:new mD(0,1,0)})})),n.vsub(t,vP),vP.scale(.5,vP);const i=this.root||this;for(let e=0;8!==e;e++){const n=r[e];n.root=i;const s=n.aabb.lowerBound;s.x*=vP.x,s.y*=vP.y,s.z*=vP.z,s.vadd(t,s),s.vadd(vP,n.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const r=n.pop();r.aabb.overlaps(e)&&Array.prototype.push.apply(t,r.data),Array.prototype.push.apply(n,r.children)}return t}rayQuery(e,t,n){return e.getAABB(yP),yP.toLocalFrame(t,yP),this.aabbQuery(yP,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class _P extends gP{constructor(e,t){void 0===t&&(t={}),super({root:null,aabb:e}),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}const vP=new mD,yP=new yD;class bP extends MD{constructor(e,t){super({type:MD.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new yD,this.edges=null,this.scale=new mD(1,1,1),this.tree=new _P,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new yD,r=new mD,i=new mD,s=new mD,o=[r,i,s];for(let t=0;t<this.indices.length/3;t++){const a=3*t;this._getUnscaledVertex(this.indices[a],r),this._getUnscaledVertex(this.indices[a+1],i),this._getUnscaledVertex(this.indices[a+2],s),n.setFromPoints(o),e.insert(n,t)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){wP.copy(e);const n=this.scale,r=n.x,i=n.y,s=n.z,o=wP.lowerBound,a=wP.upperBound;return o.x/=r,o.y/=i,o.z/=s,a.x/=r,a.y/=i,a.z/=s,this.tree.aabbQuery(wP,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=AP,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const r=3*n,i=this.indices[r],s=this.indices[r+1],o=this.indices[r+2];this.getVertex(i,MP),this.getVertex(s,TP),this.getVertex(o,DP),bP.computeNormal(TP,MP,DP,e),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z}}updateEdges(){const e={},t=(t,n)=>{e[t<n?`${t}_${n}`:`${n}_${t}`]=!0};for(let e=0;e<this.indices.length/3;e++){const n=3*e,r=this.indices[n],i=this.indices[n+1],s=this.indices[n+2];t(r,i),t(i,s),t(s,r)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let e=0;e<n.length;e++){const t=n[e].split("_");this.edges[2*e]=parseInt(t[0],10),this.edges[2*e+1]=parseInt(t[1],10)}}getEdgeVertex(e,t,n){const r=this.edges[2*e+(t?1:0)];this.getVertex(r,n)}getEdgeVector(e,t){const n=xP,r=EP;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,r),r.vsub(n,t)}static computeNormal(e,t,n,r){t.vsub(e,SP),n.vsub(t,CP),CP.cross(SP,r),r.isZero()||r.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,r=this.vertices;return t.set(r[n],r[n+1],r[n+2])}getWorldVertex(e,t,n,r){return this.getVertex(e,r),TD.pointToWorldFrame(t,n,r,r),r}getTriangleVertices(e,t,n,r){const i=3*e;this.getVertex(this.indices[i],t),this.getVertex(this.indices[i+1],n),this.getVertex(this.indices[i+2],r)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(IP);const n=IP.upperBound.x-IP.lowerBound.x,r=IP.upperBound.y-IP.lowerBound.y,i=IP.upperBound.z-IP.lowerBound.z;return t.set(1/12*e*(2*r*2*r+2*i*2*i),1/12*e*(2*n*2*n+2*i*2*i),1/12*e*(2*r*2*r+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,r=this.vertices.length;this.vertices;const i=PP;this.getVertex(0,i),t.copy(i),n.copy(i);for(let e=0;e!==r;e++)this.getVertex(e,i),i.x<t.x?t.x=i.x:i.x>n.x&&(n.x=i.x),i.y<t.y?t.y=i.y:i.y>n.y&&(n.y=i.y),i.z<t.z?t.z=i.z:i.z>n.z&&(n.z=i.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new mD;for(let r=0,i=t.length/3;r!==i;r++){this.getVertex(r,n);const t=n.lengthSquared();t>e&&(e=t)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,r){const i=RP,s=BP;i.position=e,i.quaternion=t,this.aabb.toWorldFrame(i,s),n.copy(s.lowerBound),r.copy(s.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,r,i){void 0===e&&(e=1),void 0===t&&(t=.5),void 0===n&&(n=8),void 0===r&&(r=6),void 0===i&&(i=2*Math.PI);const s=[],o=[];for(let o=0;o<=n;o++)for(let a=0;a<=r;a++){const l=a/r*i,c=o/n*Math.PI*2,u=(e+t*Math.cos(c))*Math.cos(l),h=(e+t*Math.cos(c))*Math.sin(l),p=t*Math.sin(c);s.push(u,h,p)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,a=(r+1)*e+t;o.push(n,i,a),o.push(i,s,a)}return new bP(s,o)}}const AP=new mD,wP=new yD,xP=new mD,EP=new mD,CP=new mD,SP=new mD,MP=new mD,TP=new mD,DP=new mD,IP=new yD,PP=new mD,RP=new TD,BP=new yD;class kP{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);-1!==n&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class OP extends kP{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const r=this.iterations,i=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=t.bodies,l=a.length,c=e;let u,h,p,d,f,m;if(0!==o)for(let e=0;e!==l;e++)a[e].updateSolveMassProperties();const g=FP,_=UP,v=LP;g.length=o,_.length=o,v.length=o;for(let e=0;e!==o;e++){const t=s[e];v[e]=0,_[e]=t.computeB(c),g[e]=1/t.computeC()}if(0!==o){for(let e=0;e!==l;e++){const t=a[e],n=t.vlambda,r=t.wlambda;n.set(0,0,0),r.set(0,0,0)}for(n=0;n!==r;n++){d=0;for(let e=0;e!==o;e++){const t=s[e];u=_[e],h=g[e],m=v[e],f=t.computeGWlambda(),p=h*(u-f-t.eps*m),m+p<t.minForce?p=t.minForce-m:m+p>t.maxForce&&(p=t.maxForce-m),v[e]+=p,d+=p>0?p:-p,t.addToWlambda(p)}if(d*d<i)break}for(let e=0;e!==l;e++){const t=a[e],n=t.velocity,r=t.angularVelocity;t.vlambda.vmul(t.linearFactor,t.vlambda),n.vadd(t.vlambda,n),t.wlambda.vmul(t.angularFactor,t.wlambda),r.vadd(t.wlambda,r)}let e=s.length;const t=1/c;for(;e--;)s[e].multiplier=v[e]*t}return n}}const LP=[],FP=[],UP=[];UD.STATIC;class NP{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class jP extends NP{constructor(){super(...arguments),this.type=mD}constructObject(){return new mD}}const zP=MD.types.SPHERE,GP=MD.types.SPHERE|MD.types.PLANE,VP=MD.types.BOX|MD.types.BOX,HP=MD.types.SPHERE|MD.types.BOX,QP=MD.types.PLANE|MD.types.BOX,WP=MD.types.CONVEXPOLYHEDRON,qP=MD.types.SPHERE|MD.types.CONVEXPOLYHEDRON,XP=MD.types.PLANE|MD.types.CONVEXPOLYHEDRON,YP=MD.types.BOX|MD.types.CONVEXPOLYHEDRON,KP=MD.types.SPHERE|MD.types.HEIGHTFIELD,JP=MD.types.BOX|MD.types.HEIGHTFIELD,ZP=MD.types.CONVEXPOLYHEDRON|MD.types.HEIGHTFIELD,$P=MD.types.PARTICLE|MD.types.SPHERE,eR=MD.types.PLANE|MD.types.PARTICLE,tR=MD.types.BOX|MD.types.PARTICLE,nR=MD.types.PARTICLE|MD.types.CONVEXPOLYHEDRON,rR=MD.types.CYLINDER,iR=MD.types.SPHERE|MD.types.CYLINDER,sR=MD.types.PLANE|MD.types.CYLINDER,oR=MD.types.BOX|MD.types.CYLINDER,aR=MD.types.CONVEXPOLYHEDRON|MD.types.CYLINDER,lR=MD.types.HEIGHTFIELD|MD.types.CYLINDER,cR=MD.types.PARTICLE|MD.types.CYLINDER,uR=MD.types.SPHERE|MD.types.TRIMESH,hR=MD.types.PLANE|MD.types.TRIMESH;class pR{get[zP](){return this.sphereSphere}get[GP](){return this.spherePlane}get[VP](){return this.boxBox}get[HP](){return this.sphereBox}get[QP](){return this.planeBox}get[WP](){return this.convexConvex}get[qP](){return this.sphereConvex}get[XP](){return this.planeConvex}get[YP](){return this.boxConvex}get[KP](){return this.sphereHeightfield}get[JP](){return this.boxHeightfield}get[ZP](){return this.convexHeightfield}get[$P](){return this.sphereParticle}get[eR](){return this.planeParticle}get[tR](){return this.boxParticle}get[nR](){return this.convexParticle}get[rR](){return this.convexConvex}get[iR](){return this.sphereConvex}get[sR](){return this.planeConvex}get[oR](){return this.boxConvex}get[aR](){return this.convexConvex}get[lR](){return this.heightfieldCylinder}get[cR](){return this.particleCylinder}get[uR](){return this.sphereTrimesh}get[hR](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new jP,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,r,i,s){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=e,o.bj=t):o=new JI(e,t),o.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&r.collisionResponse;const a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||e.material,c=r.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(o.restitution=l.restitution*c.restitution),o.si=i||n,o.sj=s||r,o}createFrictionEquationsFromContact(e,t){const n=e.bi,r=e.bj,i=e.si,s=e.sj,o=this.world,a=this.currentContactMaterial;let l=a.friction;const c=i.material||n.material,u=s.material||r.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(l=c.friction*u.friction),l>0){const i=l*o.gravity.length();let s=n.invMass+r.invMass;s>0&&(s=1/s);const c=this.frictionEquationPool,u=c.length?c.pop():new aP(n,r,i*s),h=c.length?c.pop():new aP(n,r,i*s);return u.bi=h.bi=n,u.bj=h.bj=r,u.minForce=h.minForce=-i*s,u.maxForce=h.maxForce=i*s,u.ri.copy(e.ri),u.rj.copy(e.rj),h.ri.copy(e.ri),h.rj.copy(e.rj),e.ni.tangents(u.t,h.t),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),u.enabled=h.enabled=e.enabled,t.push(u,h),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;const n=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];dR.setZero(),fR.setZero(),mR.setZero();const i=t.bi;t.bj;for(let n=0;n!==e;n++)t=this.result[this.result.length-1-n],t.bi!==i?(dR.vadd(t.ni,dR),fR.vadd(t.ri,fR),mR.vadd(t.rj,mR)):(dR.vsub(t.ni,dR),fR.vadd(t.rj,fR),mR.vadd(t.ri,mR));const s=1/e;fR.scale(s,n.ri),mR.scale(s,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),dR.normalize(),dR.tangents(n.t,r.t)}getContacts(e,t,n,r,i,s,o){this.contactPointPool=i,this.frictionEquationPool=o,this.result=r,this.frictionResult=s;const a=vR,l=yR,c=gR,u=_R;for(let r=0,i=e.length;r!==i;r++){const i=e[r],s=t[r];let o=null;i.material&&s.material&&(o=n.getContactMaterial(i.material,s.material)||null);const h=i.type&UD.KINEMATIC&&s.type&UD.STATIC||i.type&UD.STATIC&&s.type&UD.KINEMATIC||i.type&UD.KINEMATIC&&s.type&UD.KINEMATIC;for(let e=0;e<i.shapes.length;e++){i.quaternion.mult(i.shapeOrientations[e],a),i.quaternion.vmult(i.shapeOffsets[e],c),c.vadd(i.position,c);const t=i.shapes[e];for(let e=0;e<s.shapes.length;e++){s.quaternion.mult(s.shapeOrientations[e],l),s.quaternion.vmult(s.shapeOffsets[e],u),u.vadd(s.position,u);const r=s.shapes[e];if(!(t.collisionFilterMask&r.collisionFilterGroup&&r.collisionFilterMask&t.collisionFilterGroup))continue;if(c.distanceTo(u)>t.boundingSphereRadius+r.boundingSphereRadius)continue;let p=null;t.material&&r.material&&(p=n.getContactMaterial(t.material,r.material)||null),this.currentContactMaterial=p||o||n.defaultContactMaterial;const d=this[t.type|r.type];if(d){let e=!1;e=t.type<r.type?d.call(this,t,r,c,u,a,l,i,s,t,r,h):d.call(this,r,t,u,c,l,a,s,i,t,r,h),e&&h&&(n.shapeOverlapKeeper.set(t.id,r.id),n.bodyOverlapKeeper.set(i.id,s.id))}}}}}sphereSphere(e,t,n,r,i,s,o,a,l,c,u){if(u)return n.distanceSquared(r)<(e.radius+t.radius)**2;const h=this.createContactEquation(o,a,e,t,l,c);r.vsub(n,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.scale(e.radius,h.ri),h.rj.scale(-t.radius,h.rj),h.ri.vadd(n,h.ri),h.ri.vsub(o.position,h.ri),h.rj.vadd(r,h.rj),h.rj.vsub(a.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}spherePlane(e,t,n,r,i,s,o,a,l,c,u){const h=this.createContactEquation(o,a,e,t,l,c);if(h.ni.set(0,0,1),s.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.scale(e.radius,h.ri),n.vsub(r,UR),h.ni.scale(h.ni.dot(UR),NR),UR.vsub(NR,h.rj),-UR.dot(h.ni)<=e.radius){if(u)return!0;const e=h.ri,t=h.rj;e.vadd(n,e),e.vsub(o.position,e),t.vadd(r,t),t.vsub(a.position,t),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(e,t,n,r,i,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,r,i,s,o,a,e,t,u)}sphereBox(e,t,n,r,i,s,o,a,l,c,u){const h=this.v3pool,p=XR;n.vsub(r,HR),t.getSideNormals(p,s);const d=e.radius;let f=!1;const m=KR,g=JR,_=ZR;let v=null,y=0,b=0,A=0,w=null;for(let e=0,t=p.length;e!==t&&!1===f;e++){const t=QR;t.copy(p[e]);const n=t.length();t.normalize();const r=HR.dot(t);if(r<n+d&&r>0){const i=WR,s=qR;i.copy(p[(e+1)%3]),s.copy(p[(e+2)%3]);const o=i.length(),a=s.length();i.normalize(),s.normalize();const l=HR.dot(i),c=HR.dot(s);if(l<o&&l>-o&&c<a&&c>-a){const e=Math.abs(r-n-d);if((null===w||e<w)&&(w=e,b=l,A=c,v=n,m.copy(t),g.copy(i),_.copy(s),y++,u))return!0}}}if(y){f=!0;const i=this.createContactEquation(o,a,e,t,l,c);m.scale(-d,i.ri),i.ni.copy(m),i.ni.negate(i.ni),m.scale(v,m),g.scale(b,g),m.vadd(g,m),_.scale(A,_),m.vadd(_,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}let x=h.get();const E=YR;for(let i=0;2!==i&&!f;i++)for(let s=0;2!==s&&!f;s++)for(let h=0;2!==h&&!f;h++)if(x.set(0,0,0),i?x.vadd(p[0],x):x.vsub(p[0],x),s?x.vadd(p[1],x):x.vsub(p[1],x),h?x.vadd(p[2],x):x.vsub(p[2],x),r.vadd(x,E),E.vsub(n,E),E.lengthSquared()<d*d){if(u)return!0;f=!0;const i=this.createContactEquation(o,a,e,t,l,c);i.ri.copy(E),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(d,i.ri),i.rj.copy(x),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}h.release(x),x=null;const C=h.get(),S=h.get(),M=h.get(),T=h.get(),D=h.get(),I=p.length;for(let i=0;i!==I&&!f;i++)for(let s=0;s!==I&&!f;s++)if(i%3!=s%3){p[s].cross(p[i],C),C.normalize(),p[i].vadd(p[s],S),M.copy(n),M.vsub(S,M),M.vsub(r,M);const h=M.dot(C);C.scale(h,T);let m=0;for(;m===i%3||m===s%3;)m++;D.copy(n),D.vsub(T,D),D.vsub(S,D),D.vsub(r,D);const g=Math.abs(h),_=D.length();if(g<p[m].length()&&_<d){if(u)return!0;f=!0;const i=this.createContactEquation(o,a,e,t,l,c);S.vadd(T,i.rj),i.rj.copy(i.rj),D.negate(i.ni),i.ni.normalize(),i.ri.copy(i.rj),i.ri.vadd(r,i.ri),i.ri.vsub(n,i.ri),i.ri.normalize(),i.ri.scale(d,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}h.release(C,S,M,T,D)}planeBox(e,t,n,r,i,s,o,a,l,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,r,i,s,o,a,e,t,u)}convexConvex(e,t,n,r,i,s,o,a,l,c,u,h,p){const d=dB;if(!(n.distanceTo(r)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,i,r,s,d,h,p)){const h=[],p=fB;e.clipAgainstHull(n,i,t,r,s,d,-100,100,h);let f=0;for(let i=0;i!==h.length;i++){if(u)return!0;const s=this.createContactEquation(o,a,e,t,l,c),m=s.ri,g=s.rj;d.negate(s.ni),h[i].normal.negate(p),p.scale(h[i].depth,p),h[i].point.vadd(p,m),g.copy(h[i].point),m.vsub(n,m),g.vsub(r,g),m.vadd(n,m),m.vsub(o.position,m),g.vadd(r,g),g.vsub(a.position,g),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(e,t,n,r,i,s,o,a,l,c,u){const h=this.v3pool;n.vsub(r,$R);const p=t.faceNormals,d=t.faces,f=t.vertices,m=e.radius;let g=!1;for(let i=0;i!==f.length;i++){const h=f[i],p=rB;s.vmult(h,p),r.vadd(p,p);const d=nB;if(p.vsub(n,d),d.lengthSquared()<m*m){if(u)return!0;g=!0;const i=this.createContactEquation(o,a,e,t,l,c);return i.ri.copy(d),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(m,i.ri),p.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),void this.createFrictionEquationsFromContact(i,this.frictionResult)}}for(let i=0,_=d.length;i!==_&&!1===g;i++){const _=p[i],v=d[i],y=iB;s.vmult(_,y);const b=sB;s.vmult(f[v[0]],b),b.vadd(r,b);const A=oB;y.scale(-m,A),n.vadd(A,A);const w=aB;A.vsub(b,w);const x=w.dot(y),E=lB;if(n.vsub(b,E),x<0&&E.dot(y)>0){const i=[];for(let e=0,t=v.length;e!==t;e++){const t=h.get();s.vmult(f[v[e]],t),r.vadd(t,t),i.push(t)}if(VR(i,y,n)){if(u)return!0;g=!0;const s=this.createContactEquation(o,a,e,t,l,c);y.scale(-m,s.ri),y.negate(s.ni);const p=h.get();y.scale(-x,p);const d=h.get();y.scale(-m,d),n.vsub(r,s.rj),s.rj.vadd(d,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(r,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),h.release(p),h.release(d),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=i.length;e!==t;e++)h.release(i[e]);return}for(let p=0;p!==v.length;p++){const d=h.get(),g=h.get();s.vmult(f[v[(p+1)%v.length]],d),s.vmult(f[v[(p+2)%v.length]],g),r.vadd(d,d),r.vadd(g,g);const _=eB;g.vsub(d,_);const y=tB;_.unit(y);const b=h.get(),A=h.get();n.vsub(d,A);const w=A.dot(y);y.scale(w,b),b.vadd(d,b);const x=h.get();if(b.vsub(n,x),w>0&&w*w<_.lengthSquared()&&x.lengthSquared()<m*m){if(u)return!0;const s=this.createContactEquation(o,a,e,t,l,c);b.vsub(r,s.rj),b.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(r,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let e=0,t=i.length;e!==t;e++)h.release(i[e]);return h.release(d),h.release(g),h.release(b),h.release(x),void h.release(A)}h.release(d),h.release(g),h.release(b),h.release(x),h.release(A)}for(let e=0,t=i.length;e!==t;e++)h.release(i[e])}}}planeConvex(e,t,n,r,i,s,o,a,l,c,u){const h=cB,p=uB;p.set(0,0,1),i.vmult(p,p);let d=0;const f=hB;for(let i=0;i!==t.vertices.length;i++)if(h.copy(t.vertices[i]),s.vmult(h,h),r.vadd(h,h),h.vsub(n,f),p.dot(f)<=0){if(u)return!0;const i=this.createContactEquation(o,a,e,t,l,c),s=pB;p.scale(p.dot(f),s),h.vsub(s,s),s.vsub(n,i.ri),i.ni.copy(p),h.vsub(r,i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.vadd(r,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(i,this.frictionResult)}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}boxConvex(e,t,n,r,i,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,r,i,s,o,a,e,t,u)}sphereHeightfield(e,t,n,r,i,s,o,a,l,c,u){const h=t.data,p=e.radius,d=t.elementSize,f=TB,m=MB;TD.pointToLocalFrame(r,s,n,m);let g=Math.floor((m.x-p)/d)-1,_=Math.ceil((m.x+p)/d)+1,v=Math.floor((m.y-p)/d)-1,y=Math.ceil((m.y+p)/d)+1;if(_<0||y<0||g>h.length||v>h[0].length)return;g<0&&(g=0),_<0&&(_=0),v<0&&(v=0),y<0&&(y=0),g>=h.length&&(g=h.length-1),_>=h.length&&(_=h.length-1),y>=h[0].length&&(y=h[0].length-1),v>=h[0].length&&(v=h[0].length-1);const b=[];t.getRectMinMax(g,v,_,y,b);const A=b[0],w=b[1];if(m.z-p>w||m.z+p<A)return;const x=this.result;for(let l=g;l<_;l++)for(let c=v;c<y;c++){const h=x.length;let p=!1;if(t.getConvexTrianglePillar(l,c,!1),TD.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(p=this.sphereConvex(e,t.pillarConvex,n,f,i,s,o,a,e,t,u)),u&&p)return!0;if(t.getConvexTrianglePillar(l,c,!0),TD.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(p=this.sphereConvex(e,t.pillarConvex,n,f,i,s,o,a,e,t,u)),u&&p)return!0;if(x.length-h>2)return}}boxHeightfield(e,t,n,r,i,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,r,i,s,o,a,e,t,u)}convexHeightfield(e,t,n,r,i,s,o,a,l,c,u){const h=t.data,p=t.elementSize,d=e.boundingSphereRadius,f=CB,m=SB,g=EB;TD.pointToLocalFrame(r,s,n,g);let _=Math.floor((g.x-d)/p)-1,v=Math.ceil((g.x+d)/p)+1,y=Math.floor((g.y-d)/p)-1,b=Math.ceil((g.y+d)/p)+1;if(v<0||b<0||_>h.length||y>h[0].length)return;_<0&&(_=0),v<0&&(v=0),y<0&&(y=0),b<0&&(b=0),_>=h.length&&(_=h.length-1),v>=h.length&&(v=h.length-1),b>=h[0].length&&(b=h[0].length-1),y>=h[0].length&&(y=h[0].length-1);const A=[];t.getRectMinMax(_,y,v,b,A);const w=A[0],x=A[1];if(!(g.z-d>x||g.z+d<w))for(let l=_;l<v;l++)for(let c=y;c<b;c++){let h=!1;if(t.getConvexTrianglePillar(l,c,!1),TD.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(h=this.convexConvex(e,t.pillarConvex,n,f,i,s,o,a,null,null,u,m,null)),u&&h)return!0;if(t.getConvexTrianglePillar(l,c,!0),TD.pointToWorldFrame(r,s,t.pillarOffset,f),n.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(h=this.convexConvex(e,t.pillarConvex,n,f,i,s,o,a,null,null,u,m,null)),u&&h)return!0}}sphereParticle(e,t,n,r,i,s,o,a,l,c,u){const h=vB;if(h.set(0,0,1),r.vsub(n,h),h.lengthSquared()<=e.radius*e.radius){if(u)return!0;const n=this.createContactEquation(a,o,t,e,l,c);h.normalize(),n.rj.copy(h),n.rj.scale(e.radius,n.rj),n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(e,t,n,r,i,s,o,a,l,c,u){const h=mB;h.set(0,0,1),o.quaternion.vmult(h,h);const p=gB;if(r.vsub(o.position,p),h.dot(p)<=0){if(u)return!0;const n=this.createContactEquation(a,o,t,e,l,c);n.ni.copy(h),n.ni.negate(n.ni),n.ri.set(0,0,0);const i=_B;h.scale(h.dot(r),i),r.vsub(i,i),n.rj.copy(i),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(e,t,n,r,i,s,o,a,l,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,r,i,s,o,a,e,t,u)}convexParticle(e,t,n,r,i,s,o,a,l,c,u){let h=-1;const p=AB,d=xB;let f=null;const m=bB;if(m.copy(r),m.vsub(n,m),i.conjugate(yB),yB.vmult(m,m),e.pointIsInside(m)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,i),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(i);for(let t=0,n=e.faces.length;t!==n;t++){const n=[e.worldVertices[e.faces[t][0]]],i=e.worldFaceNormals[t];r.vsub(n[0],wB);const s=-i.dot(wB);if(null===f||Math.abs(s)<Math.abs(f)){if(u)return!0;f=s,h=t,p.copy(i)}}if(-1!==h){const i=this.createContactEquation(a,o,t,e,l,c);p.scale(f,d),d.vadd(r,d),d.vsub(n,d),i.rj.copy(d),p.negate(i.ni),i.ri.set(0,0,0);const s=i.ri,u=i.rj;s.vadd(r,s),s.vsub(a.position,s),u.vadd(n,u),u.vsub(o.position,u),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,r,i,s,o,a,l,c,u){return this.convexHeightfield(t,e,r,n,s,i,a,o,l,c,u)}particleCylinder(e,t,n,r,i,s,o,a,l,c,u){return this.convexParticle(t,e,r,n,s,i,a,o,l,c,u)}sphereTrimesh(e,t,n,r,i,s,o,a,l,c,u){const h=MR,p=TR,d=DR,f=IR,m=PR,g=RR,_=LR,v=SR,y=ER,b=FR;TD.pointToLocalFrame(r,s,n,m);const A=e.radius;_.lowerBound.set(m.x-A,m.y-A,m.z-A),_.upperBound.set(m.x+A,m.y+A,m.z+A),t.getTrianglesInAABB(_,b);const w=CR,x=e.radius*e.radius;for(let i=0;i<b.length;i++)for(let h=0;h<3;h++)if(t.getVertex(t.indices[3*b[i]+h],w),w.vsub(m,y),y.lengthSquared()<=x){if(v.copy(w),TD.pointToWorldFrame(r,s,v,w),w.vsub(n,y),u)return!0;let i=this.createContactEquation(o,a,e,t,l,c);i.ni.copy(y),i.ni.normalize(),i.ri.copy(i.ni),i.ri.scale(e.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),i.rj.copy(w),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}for(let i=0;i<b.length;i++)for(let _=0;_<3;_++){t.getVertex(t.indices[3*b[i]+_],h),t.getVertex(t.indices[3*b[i]+(_+1)%3],p),p.vsub(h,d),m.vsub(p,g);const v=g.dot(d);m.vsub(h,g);let y=g.dot(d);if(y>0&&v<0&&(m.vsub(h,g),f.copy(d),f.normalize(),y=g.dot(f),f.scale(y,g),g.vadd(h,g),g.distanceTo(m)<e.radius)){if(u)return!0;const i=this.createContactEquation(o,a,e,t,l,c);g.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(e.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),TD.pointToWorldFrame(r,s,g,g),g.vsub(a.position,i.rj),TD.vectorToWorldFrame(s,i.ni,i.ni),TD.vectorToWorldFrame(s,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}const E=BR,C=kR,S=OR,M=xR;for(let i=0,h=b.length;i!==h;i++){t.getTriangleVertices(b[i],E,C,S),t.getNormal(b[i],M),m.vsub(E,g);let h=g.dot(M);if(M.scale(h,g),m.vsub(g,g),h=g.distanceTo(m),pI.pointInTriangle(g,E,C,S)&&h<e.radius){if(u)return!0;let i=this.createContactEquation(o,a,e,t,l,c);g.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(e.radius,i.ri),i.ri.vadd(n,i.ri),i.ri.vsub(o.position,i.ri),TD.pointToWorldFrame(r,s,g,g),g.vsub(a.position,i.rj),TD.vectorToWorldFrame(s,i.ni,i.ni),TD.vectorToWorldFrame(s,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}b.length=0}planeTrimesh(e,t,n,r,i,s,o,a,l,c,u){const h=new mD,p=bR;p.set(0,0,1),i.vmult(p,p);for(let i=0;i<t.vertices.length/3;i++){t.getVertex(i,h);const d=new mD;d.copy(h),TD.pointToWorldFrame(r,s,d,h);const f=AR;if(h.vsub(n,f),p.dot(f)<=0){if(u)return!0;const n=this.createContactEquation(o,a,e,t,l,c);n.ni.copy(p);const r=wR;p.scale(f.dot(p),r),h.vsub(r,r),n.ri.copy(r),n.ri.vsub(o.position,n.ri),n.rj.copy(h),n.rj.vsub(a.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const dR=new mD,fR=new mD,mR=new mD,gR=new mD,_R=new mD,vR=new ED,yR=new ED,bR=new mD,AR=new mD,wR=new mD,xR=new mD,ER=new mD;new mD;const CR=new mD,SR=new mD,MR=new mD,TR=new mD,DR=new mD,IR=new mD,PR=new mD,RR=new mD,BR=new mD,kR=new mD,OR=new mD,LR=new yD,FR=[],UR=new mD,NR=new mD,jR=new mD,zR=new mD,GR=new mD;function VR(e,t,n){let r=null;const i=e.length;for(let s=0;s!==i;s++){const o=e[s],a=jR;e[(s+1)%i].vsub(o,a);const l=zR;a.cross(t,l);const c=GR;n.vsub(o,c);const u=l.dot(c);if(!(null===r||u>0&&!0===r||u<=0&&!1===r))return!1;null===r&&(r=u>0)}return!0}const HR=new mD,QR=new mD,WR=new mD,qR=new mD,XR=[new mD,new mD,new mD,new mD,new mD,new mD],YR=new mD,KR=new mD,JR=new mD,ZR=new mD,$R=new mD,eB=new mD,tB=new mD,nB=new mD,rB=new mD,iB=new mD,sB=new mD,oB=new mD,aB=new mD,lB=new mD;new mD,new mD;const cB=new mD,uB=new mD,hB=new mD,pB=new mD,dB=new mD,fB=new mD,mB=new mD,gB=new mD,_B=new mD,vB=new mD,yB=new ED,bB=new mD;new mD;const AB=new mD,wB=new mD,xB=new mD,EB=new mD,CB=new mD,SB=[0],MB=new mD,TB=new mD;class DB{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),r=this.current;let i=0;for(;n>r[i];)i++;if(n!==r[i]){for(let e=r.length-1;e>=i;e--)r[e+1]=r[e];r[i]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,r=this.previous,i=n.length,s=r.length;let o=0;for(let t=0;t<i;t++){let i=!1;const s=n[t];for(;s>r[o];)o++;i=s===r[o],i||IB(e,s)}o=0;for(let e=0;e<s;e++){let i=!1;const s=r[e];for(;s>n[o];)o++;i=n[o]===s,i||IB(t,s)}}}function IB(e,t){e.push((4294901760&t)>>16,65535&t)}const PB=(e,t)=>e<t?`${e}-${t}`:`${t}-${e}`;class RB{constructor(){this.data={keys:[]}}get(e,t){const n=PB(e,t);return this.data[n]}set(e,t,n){const r=PB(e,t);this.get(e,t)||this.data.keys.push(r),this.data[r]=n}delete(e,t){const n=PB(e,t),r=this.data.keys.indexOf(n);-1!==r&&this.data.keys.splice(r,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class BB extends xD{constructor(e){void 0===e&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new mD,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=void 0!==e.broadphase?e.broadphase:new rI,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new OP,this.constraints=[],this.narrowphase=new pR(this),this.collisionMatrix=new wD,this.collisionMatrixPrevious=new wD,this.bodyOverlapKeeper=new DB,this.shapeOverlapKeeper=new DB,this.contactmaterials=[],this.contactMaterialTable=new RB,this.defaultMaterial=new hP("default"),this.defaultContactMaterial=new uP(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof iI?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,r){return void 0===n&&(n={}),n.mode=pI.ALL,n.from=e,n.to=t,n.callback=r,kB.intersectWorld(this,n)}raycastAny(e,t,n,r){return void 0===n&&(n={}),n.mode=pI.ANY,n.from=e,n.to=t,n.result=r,kB.intersectWorld(this,n)}raycastClosest(e,t,n,r){return void 0===n&&(n={}),n.mode=pI.CLOSEST,n.from=e,n.to=t,n.result=r,kB.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof UD&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,r=n.indexOf(e);if(-1!==r){n.splice(r,1);for(let e=0;e!==n.length;e++)n[e].index=e;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const r=t[n].shapes;for(let t=0;t<r.length;t++){const n=r[t];if(n.id===e)return n}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);-1!==t&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){void 0===e&&(e=1/60),void 0===t&&(t=10);const n=OB.now()/1e3;if(this.lastCallTime){const r=n-this.lastCallTime;this.step(e,r,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(void 0===n&&(n=10),void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const r=OB.now();let i=0;for(;this.accumulator>=e&&i<n&&(this.internalStep(e),this.accumulator-=e,i++,!(OB.now()-r>1e3*e)););this.accumulator=this.accumulator%e;const s=this.accumulator/e;for(let e=0;e!==this.bodies.length;e++){const t=this.bodies[e];t.previousPosition.lerp(t.position,s,t.interpolatedPosition),t.previousQuaternion.slerp(t.quaternion,s,t.interpolatedQuaternion),t.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=zB,r=GB,i=this.bodies.length,s=this.bodies,o=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,u=UD.DYNAMIC;let h=-1/0;const p=this.constraints,d=jB;a.length();const f=a.x,m=a.y,g=a.z;let _=0;for(l&&(h=OB.now()),_=0;_!==i;_++){const e=s[_];if(e.type===u){const t=e.force,n=e.mass;t.x+=n*f,t.y+=n*m,t.z+=n*g}}for(let e=0,t=this.subsystems.length;e!==t;e++)this.subsystems[e].update();l&&(h=OB.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),l&&(c.broadphase=OB.now()-h);let v=p.length;for(_=0;_!==v;_++){const e=p[_];if(!e.collideConnected)for(let t=n.length-1;t>=0;t-=1)(e.bodyA===n[t]&&e.bodyB===r[t]||e.bodyB===n[t]&&e.bodyA===r[t])&&(n.splice(t,1),r.splice(t,1))}this.collisionMatrixTick(),l&&(h=OB.now());const y=NB,b=t.length;for(_=0;_!==b;_++)y.push(t[_]);t.length=0;const A=this.frictionEquations.length;for(_=0;_!==A;_++)d.push(this.frictionEquations[_]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,t,y,this.frictionEquations,d),l&&(c.narrowphase=OB.now()-h),l&&(h=OB.now()),_=0;_<this.frictionEquations.length;_++)o.addEquation(this.frictionEquations[_]);const w=t.length;for(let e=0;e!==w;e++){const n=t[e],r=n.bi,i=n.bj,s=n.si,a=n.sj;let l;l=r.material&&i.material&&this.getContactMaterial(r.material,i.material)||this.defaultContactMaterial,l.friction,r.material&&i.material&&(r.material.friction>=0&&i.material.friction>=0&&(r.material.friction,i.material.friction),r.material.restitution>=0&&i.material.restitution>=0&&(n.restitution=r.material.restitution*i.material.restitution)),o.addEquation(n),r.allowSleep&&r.type===UD.DYNAMIC&&r.sleepState===UD.SLEEPING&&i.sleepState===UD.AWAKE&&i.type!==UD.STATIC&&i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(r.wakeUpAfterNarrowphase=!0),i.allowSleep&&i.type===UD.DYNAMIC&&i.sleepState===UD.SLEEPING&&r.sleepState===UD.AWAKE&&r.type!==UD.STATIC&&r.velocity.lengthSquared()+r.angularVelocity.lengthSquared()>=2*r.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(r,i,!0),this.collisionMatrixPrevious.get(r,i)||(UB.body=i,UB.contact=n,r.dispatchEvent(UB),UB.body=r,i.dispatchEvent(UB)),this.bodyOverlapKeeper.set(r.id,i.id),this.shapeOverlapKeeper.set(s.id,a.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=OB.now()-h,h=OB.now()),_=0;_!==i;_++){const e=s[_];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(v=p.length,_=0;_!==v;_++){const e=p[_];e.update();for(let t=0,n=e.equations.length;t!==n;t++){const n=e.equations[t];o.addEquation(n)}}o.solve(e,this),l&&(c.solve=OB.now()-h),o.removeAllEquations();const x=Math.pow;for(_=0;_!==i;_++){const t=s[_];if(t.type&u){const n=x(1-t.linearDamping,e),r=t.velocity;r.scale(n,r);const i=t.angularVelocity;if(i){const n=x(1-t.angularDamping,e);i.scale(n,i)}}}this.dispatchEvent(FB),l&&(h=OB.now());const E=this.stepnumber%(this.quatNormalizeSkip+1)==0,C=this.quatNormalizeFast;for(_=0;_!==i;_++)s[_].integrate(e,E,C);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=OB.now()-h),this.stepnumber+=1,this.dispatchEvent(LB);let S=!0;if(this.allowSleep)for(S=!1,_=0;_!==i;_++){const e=s[_];e.sleepTick(this.time),e.sleepState!==UD.SLEEPING&&(S=!0)}this.hasActiveBodies=S}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(VB,HB),e){for(let e=0,t=VB.length;e<t;e+=2)QB.bodyA=this.getBodyById(VB[e]),QB.bodyB=this.getBodyById(VB[e+1]),this.dispatchEvent(QB);QB.bodyA=QB.bodyB=null}if(t){for(let e=0,t=HB.length;e<t;e+=2)WB.bodyA=this.getBodyById(HB[e]),WB.bodyB=this.getBodyById(HB[e+1]),this.dispatchEvent(WB);WB.bodyA=WB.bodyB=null}VB.length=HB.length=0;const n=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((n||r)&&this.shapeOverlapKeeper.getDiff(VB,HB),n){for(let e=0,t=VB.length;e<t;e+=2){const t=this.getShapeById(VB[e]),n=this.getShapeById(VB[e+1]);qB.shapeA=t,qB.shapeB=n,t&&(qB.bodyA=t.body),n&&(qB.bodyB=n.body),this.dispatchEvent(qB)}qB.bodyA=qB.bodyB=qB.shapeA=qB.shapeB=null}if(r){for(let e=0,t=HB.length;e<t;e+=2){const t=this.getShapeById(HB[e]),n=this.getShapeById(HB[e+1]);XB.shapeA=t,XB.shapeB=n,t&&(XB.bodyA=t.body),n&&(XB.bodyB=n.body),this.dispatchEvent(XB)}XB.bodyA=XB.bodyB=XB.shapeA=XB.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const t=e[n];t.force,t.torque,t.force.set(0,0,0),t.torque.set(0,0,0)}}}new yD;const kB=new pI,OB=globalThis.performance||{};if(!OB.now){let e=Date.now();OB.timing&&OB.timing.navigationStart&&(e=OB.timing.navigationStart),OB.now=()=>Date.now()-e}new mD;const LB={type:"postStep"},FB={type:"preStep"},UB={type:UD.COLLIDE_EVENT_NAME,body:null,contact:null},NB=[],jB=[],zB=[],GB=[],VB=[],HB=[],QB={type:"beginContact",bodyA:null,bodyB:null},WB={type:"endContact",bodyA:null,bodyB:null},qB={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},XB={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var YB=function(){var e,t,r,i,s=new n.Pa4;function o(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new u,this.unassigned=new u,this.vertices=[]}function a(){this.normal=new n.Pa4,this.midpoint=new n.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function l(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function c(e,t){this.point=e,this.index=t,this.prev=null,this.next=null,this.face=null}function u(){this.head=null,this.tail=null}return Object.assign(o.prototype,{toJSON:function(){const e=this.faces.map((e=>e.toArray())),t=Array.from(new Set(e.flat())).sort(),n=[];for(let e=0;e<t.length;e++)n.push(this.vertices[t[e]].point.x,this.vertices[t[e]].point.y,this.vertices[t[e]].point.z);const r=new Map;for(let e=0;e<t.length;e++)r.set(t[e],e);const i=[];for(let t=0;t<e.length;t++)i.push([r.get(e[t][0]),r.get(e[t][1]),r.get(e[t][2])]);return[n,i]},setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.vertices.push(new c(e[t],t));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var r,i,s,o=e.geometry;if(void 0!==o&&(o.isGeometry&&(o=o.toBufferGeometry?o.toBufferGeometry():(new BufferGeometry).fromGeometry(o)),o.isBufferGeometry)){var a=o.attributes.position;if(void 0!==a)for(r=0,i=a.count;r<i;r++)(s=new n.Pa4).fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),t.push(s)}})),this.setFromPoints(t)},containsPoint:function(e){for(var t=this.faces,n=0,r=t.length;n<r;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var n=this.faces,r=-1/0,i=1/0,s=0,o=n.length;s<o;s++){var a=n[s],l=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(l>0&&c>=0)return null;var u=0!==c?-l/c:0;if(!(u<=0)&&(c>0?i=Math.min(u,i):r=Math.max(u,r),r>i))return null}return r!==-1/0?e.at(r,t):e.at(i,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,s)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,n=e.outside;null!==n.next&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{var r=n;do{var i=r.next;t.distanceToPoint(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unassigned.append(r),r=i}while(null!==r)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var n=t.next,r=this.tolerance,i=null,s=0;s<e.length;s++){var o=e[s];if(0===o.mark){var a=o.distanceToPoint(t.point);if(a>r&&(r=a,i=o),r>1e3*this.tolerance)break}}null!==i&&this.addVertexToFace(t,i),t=n}while(null!==t)}return this},computeExtremes:function(){var e,t,r,i=new n.Pa4,s=new n.Pa4,o=[],a=[];for(e=0;e<3;e++)o[e]=a[e]=this.vertices[0];for(i.copy(this.vertices[0].point),s.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var l=this.vertices[e],c=l.point;for(r=0;r<3;r++)c.getComponent(r)<i.getComponent(r)&&(i.setComponent(r,c.getComponent(r)),o[r]=l);for(r=0;r<3;r++)c.getComponent(r)>s.getComponent(r)&&(s.setComponent(r,c.getComponent(r)),a[r]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(i.x),Math.abs(s.x))+Math.max(Math.abs(i.y),Math.abs(s.y))+Math.max(Math.abs(i.z),Math.abs(s.z))),{min:o,max:a}},computeInitialHull:function(){void 0===e&&(e=new n.Zzh,t=new n.JOQ,r=new n.Pa4);var i,s,o,l,c,u,h,p,d,f=this.vertices,m=this.computeExtremes(),g=m.min,_=m.max,v=0,y=0;for(u=0;u<3;u++)(d=_[u].point.getComponent(u)-g[u].point.getComponent(u))>v&&(v=d,y=u);for(s=g[y],o=_[y],v=0,e.set(s.point,o.point),u=0,h=this.vertices.length;u<h;u++)(i=f[u])!==s&&i!==o&&(e.closestPointToPoint(i.point,!0,r),(d=r.distanceToSquared(i.point))>v&&(v=d,l=i));for(v=-1,t.setFromCoplanarPoints(s.point,o.point,l.point),u=0,h=this.vertices.length;u<h;u++)(i=f[u])!==s&&i!==o&&i!==l&&(d=Math.abs(t.distanceToPoint(i.point)))>v&&(v=d,c=i);var b=[];if(t.distanceToPoint(c.point)<0)for(b.push(a.create(s,o,l),a.create(c,o,s),a.create(c,l,o),a.create(c,s,l)),u=0;u<3;u++)p=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge(p)),b[u+1].getEdge(1).setTwin(b[p+1].getEdge(0));else for(b.push(a.create(s,l,o),a.create(c,s,o),a.create(c,o,l),a.create(c,l,s)),u=0;u<3;u++)p=(u+1)%3,b[u+1].getEdge(2).setTwin(b[0].getEdge((3-u)%3)),b[u+1].getEdge(0).setTwin(b[p+1].getEdge(1));for(u=0;u<4;u++)this.faces.push(b[u]);for(u=0,h=f.length;u<h;u++)if((i=f[u])!==s&&i!==o&&i!==l&&i!==c){v=this.tolerance;var A=null;for(p=0;p<4;p++)(d=this.faces[p].distanceToPoint(i.point))>v&&(v=d,A=this.faces[p]);null!==A&&this.addVertexToFace(i,A)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var n=this.faces[t];0===n.mark&&e.push(n)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,n=this.assigned.first().face,r=n.outside;do{var i=n.distanceToPoint(r.point);i>t&&(t=i,e=r),r=r.next}while(null!==r&&r.face===n);return e}},computeHorizon:function(e,t,n,r){var i;this.deleteFaceVertices(n),n.mark=1,i=null===t?t=n.getEdge(0):t.next;do{var s=i.twin,o=s.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,s,o,r):r.push(i)),i=i.next}while(i!==t);return this},addAdjoiningFace:function(e,t){var n=a.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var n=null,r=null,i=0;i<t.length;i++){var s=t[i],o=this.addAdjoiningFace(e,s);null===n?n=o:o.next.setTwin(r),this.newFaces.push(o.face),r=o}return n.next.setTwin(r),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(a,{create:function(e,t,n){var r=new a,i=new l(e,r),s=new l(t,r),o=new l(n,r);return i.next=o.prev=s,s.next=i.prev=o,o.next=s.prev=i,r.edge=i,r.compute()}}),Object.assign(a.prototype,{toArray:function(){const e=[];let t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e},getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===i&&(i=new n.CJI);var e=this.edge.tail(),t=this.edge.head(),r=this.edge.next.head();return i.set(e.point,t.point,r.point),i.getNormal(this.normal),i.getMidpoint(this.midpoint),this.area=i.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(l.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(u.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),o}();const KB=new n.Pa4,JB=new n.Pa4,ZB=new n._fP;function $B(e){const t=function(e){const t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t}(e);if(0===t.length)return null;if(1===t.length)return ek(t[0]);let r;const i=[];for(;r=t.pop();)i.push(rk(ek(r)));return function(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n].attributes.position;r&&3===r.itemSize&&(t+=r.count)}const r=new Float32Array(3*t);let i=0;for(let t=0;t<e.length;t++){const n=e[t].attributes.position;if(n&&3===n.itemSize)for(let e=0;e<n.count;e++)r[i++]=n.getX(e),r[i++]=n.getY(e),r[i++]=n.getZ(e)}return(new n.u9r).setAttribute("position",new n.TlE(r,3))}(i)}function ek(e){let t=e.geometry;return t=t.toBufferGeometry?t.toBufferGeometry():t.clone(),e.updateMatrixWorld(),e.matrixWorld.decompose(KB,ZB,JB),t.scale(JB.x,JB.y,JB.z),t}function tk(e){const t=e.attributes.position,n=new Float32Array(3*t.count);for(let e=0;e<t.count;e++)n[3*e]=t.getX(e),n[3*e+1]=t.getY(e),n[3*e+2]=t.getZ(e);return n}function nk(e,t){switch(t){case"x":return e.x;case"y":return e.y;case"z":return e.z}throw new Error(`Unexpected component ${t}`)}function rk(e,t=1e-4){t=Math.max(t,Number.EPSILON);const r={},i=e.getIndex(),s=e.getAttribute("position"),o=i?i.count:s.count;let a=0;const l=[],c=[],u=Math.log10(1/t),h=Math.pow(10,u);for(let e=0;e<o;e++){const t=i?i.getX(e):e;let n="";n+=~~(s.getX(t)*h)+",",n+=~~(s.getY(t)*h)+",",n+=~~(s.getZ(t)*h)+",",n in r?l.push(r[n]):(c.push(s.getX(t)),c.push(s.getY(t)),c.push(s.getZ(t)),r[n]=a,l.push(a),a++)}const p=new n.TlE(new Float32Array(c),s.itemSize,s.normalized),d=new n.u9r;return d.setAttribute("position",p),d.setIndex(l),d}const ik=Math.PI/2;var sk;!function(e){e.BOX="Box",e.CYLINDER="Cylinder",e.SPHERE="Sphere",e.HULL="ConvexPolyhedron",e.MESH="Trimesh"}(sk||(sk={}));const ok=function(e,t={}){const r=function(e,t={}){let r;if(t.type===sk.BOX)return lk(e);if(t.type===sk.CYLINDER)return function(e,t){const r=["x","y","z"],i=t.cylinderAxis||"y",s=r.splice(r.indexOf(i),1)&&r,o=(new n.ZzF).setFromObject(e);if(!isFinite(o.min.lengthSq()))return null;const a=o.max[i]-o.min[i],l=.5*Math.max(nk(o.max,s[0])-nk(o.min,s[0]),nk(o.max,s[1])-nk(o.min,s[1])),c="y"===i?ik:0,u="z"===i?ik:0;return{type:sk.CYLINDER,params:{radiusTop:l,radiusBottom:l,height:a,segments:12},orientation:(new ED).setFromEuler(c,u,0,"XYZ").normalize()}}(e,t);if(t.type===sk.SPHERE)return function(e,t){if(t.sphereRadius)return{type:sk.SPHERE,params:{radius:t.sphereRadius}};const n=$B(e);return n?(n.computeBoundingSphere(),{type:sk.SPHERE,params:{radius:n.boundingSphere.radius}}):null}(e,t);if(t.type===sk.HULL)return function(e){const t=$B(e);if(!t)return null;const r=1e-4;for(let e=0;e<t.attributes.position.count;e++)t.attributes.position.setXYZ(e,t.attributes.position.getX(e)+(Math.random()-.5)*r,t.attributes.position.getY(e)+(Math.random()-.5)*r,t.attributes.position.getZ(e)+(Math.random()-.5)*r);const[i,s]=(new YB).setFromObject(new n.Kj0(t)).toJSON();return{type:sk.HULL,params:{vertices:new Float32Array(i),faces:s}}}(e);if(t.type===sk.MESH)return r=$B(e),r?function(e){const t=tk(e);if(!t.length)return null;const n=new Uint32Array(t.length);for(let e=0;e<t.length;e++)n[e]=e;return{type:sk.MESH,params:{vertices:t,indices:n}}}(r):null;if(t.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${t.type}".`);if(r=$B(e),!r)return null;switch(r.type){case"BoxGeometry":case"BoxBufferGeometry":return ak(r);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){const t=e.parameters;return{type:sk.CYLINDER,params:{radiusTop:t.radiusTop,radiusBottom:t.radiusBottom,height:t.height,segments:t.radialSegments},orientation:(new ED).setFromEuler(n.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(r);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();const t=e.boundingBox;return{type:sk.BOX,params:{x:(t.max.x-t.min.x)/2||.1,y:(t.max.y-t.min.y)/2||.1,z:(t.max.z-t.min.z)/2||.1}}}(r);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return{type:sk.SPHERE,params:{radius:e.parameters.radius}}}(r);case"TubeGeometry":case"BufferGeometry":return lk(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',r.type),ak(r)}}(e,t);if(!r)return null;const{type:i,params:s,offset:o,orientation:a}=r;let l;return l=i===sk.BOX?function(e){const{x:t,y:n,z:r}=e;return new OD(new mD(t,n,r))}(s):i===sk.CYLINDER?function(e){const{radiusTop:t,radiusBottom:n,height:r,segments:i}=e,s=new dP(t,n,r,i);return s.radiusTop=n,s.radiusBottom=n,s.height=r,s.numSegments=i,s}(s):i===sk.SPHERE?function(e){return new pP(e.radius)}(s):i===sk.HULL?function(e){const{faces:t,vertices:n}=e,r=[];for(let e=0;e<n.length;e+=3)r.push(new mD(n[e],n[e+1],n[e+2]));return new ID({faces:t,vertices:r})}(s):function(e){const{vertices:t,indices:n}=e;return new bP(t,n)}(s),{shape:l,offset:o,orientation:a}};function ak(e){if(!tk(e).length)return null;e.computeBoundingBox();const t=e.boundingBox;return{type:sk.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2}}}function lk(e){const t=e.clone();t.quaternion.set(0,0,0,1),t.updateMatrixWorld();const r=(new n.ZzF).setFromObject(t);if(!isFinite(r.min.lengthSq()))return null;const i=r.translate(t.position.negate()).getCenter(new n.Pa4);return{type:sk.BOX,params:{x:(r.max.x-r.min.x)/2,y:(r.max.y-r.min.y)/2,z:(r.max.z-r.min.z)/2},offset:i.lengthSq()?new mD(i.x,i.y,i.z):void 0}}var ck,uk=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let hk=ck=class extends qt{constructor(e=!1){super(),this._world=new BB,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{this._viewer?.scene.modelRoot.children.forEach((e=>{this.makeBody(e)}))},this._bodyMeshMap=new Map,this._movementPlane=new n.Kj0(new n._12(100,100),new n.vBJ({color:65280,side:n.ehD})),this.enabled=e,this._world.gravity.set(0,-9.81,0);const t=new fP,r=new UD({mass:0,position:new mD(0,-2,0)});r.addShape(t),r.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=r,this._world.addBody(r);const i=new pP(.1);this._jointBody=new UD({mass:0}),this._jointBody.addShape(i),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(e){await super.onAdded(e);const t=new n.Pa4,r=new n.Pa4,i=new n.Pa4,s=new n._fP,o=new n._fP,a=new n.yGw,l=new n.yGw;let c=!1,u=!1;function h(t){const r=e.canvas.getBoundingClientRect(),i=new n.FM8;return i.x=(t.clientX-r.x)/r.width*2-1,i.y=-(t.clientY-r.y)/r.height*2+1,i}e.addEventListener("preFrame",(()=>{const n=e.getPlugin(Q_),h=e.getPlugin(oa);if(!this.enabled){if(!(this.nextSteps>0))return n&&c&&(n.enableRefreshTransform=!0,c=!1),h&&u&&(h.enable(ck.PluginType),u=!1),void(this._dirty=!1);this.enabled=!0}if(n&&n.enableRefreshTransform&&!c&&(n.enableRefreshTransform=!1,c=!0),h&&!u&&h.disable(ck.PluginType),this.nextSteps>0)for(let e=0;e<this.stepPhysics.stepCount;e++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let p=!1;for(const e of this._world.bodies){if(0===e.mass)continue;const n=this._bodyMeshMap.get(e);if(n&&(n.updateMatrixWorld(),n.getWorldPosition(r),n.getWorldQuaternion(o),n.getWorldScale(i),r.manhattanDistanceTo(t.copy(e.position))>0&&(p=!0),o.angleTo(s.copy(e.quaternion))>0&&(p=!0),p)){if(a.compose(t,s,i),!n.parent)throw new Error("no parent");l.copy(n.parent.matrixWorld).invert(),l.multiply(a),l.decompose(t,s,i),n.position.copy(t),n.quaternion.copy(s)}}this._dirty=p,e.setDirty(),e.renderer.resetShadows(),n?.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)})),e.scene.addEventListener("update",(e=>{this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0)}))})),e.scene.addEventListener("addSceneObject",(e=>{const t=e.object?.modelObject;t&&t.traverse((e=>{const t=e.uiConfig;t&&Array.isArray(t.children)&&(t.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(e)},{type:"number",label:"Mass",hidden:()=>!e._physicsBody,getValue:()=>e._physicsBody?.mass??0,setValue:t=>{e._physicsBody&&(e._physicsBody.mass=t)}}]}),void 0!==e.userData.physicsMass&&this.makeBody(e))}))})),e.canvas.addEventListener("pointerdown",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;e.getPlugin(_l).enabled=!1;const r=h(t),i=new n.iMs;i.setFromCamera(r,e.scene.activeCamera.cameraObject);const s=i.intersectObjects([...this._bodyMeshMap.values()],!0);if(!s.length)return;let o,a=null,l=s[0];for(const e of s){for(a=e.object,l=e;!(null==a||a.visible&&a.material);)a=a.parent;if(a)break}if(!a)return;for(;a.parent&&!o;){for(const[e,t]of this._bodyMeshMap.entries())if(t===a){e.mass>0&&(o=e);break}a=a.parent}if(!o)return;e.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(l.point),this._movementPlane.lookAt(e.scene.activeCamera.cameraObject.getWorldPosition(new n.Pa4));const c=(new mD).copy(l.point).vsub(o.position),u=o.quaternion.inverse().vmult(c);this._jointBody.position.copy(l.point),this._jointConstraint=new oP(o,u,this._jointBody,new mD(0,0,0)),this._world.addConstraint(this._jointConstraint)})),e.canvas.addEventListener("pointermove",(t=>{if(!this.enabled)return;if(!t.isPrimary)return;if(!this._jointConstraint)return;const r=h(t),i=new n.iMs;i.setFromCamera(r,e.scene.activeCamera.cameraObject);const s=i.intersectObject(this._movementPlane);if(!s.length)return;const o=s[0];this._jointBody.position.copy(o.point),this._jointConstraint.update()})),e.canvas.addEventListener("pointerup",(t=>{this.enabled&&t.isPrimary&&(e.getPlugin(_l).enabled=!0,e.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))}))}makeBody(e){if(e.isLight)return;if(e._physicsBody)return;const t=[];let r=0;if(e.updateMatrixWorld(),e.traverse((e=>{const n=e;if(!n.isMesh)return;if(n._physicsShape)return void t.push(n._physicsShape);if(r+=n.userData.physicsMass??1,n.addEventListener("objectUpdate",(()=>{0===n.userData.physicsMass&&(this._ground.position.y=n.position.y,this._bodyMeshMap.forEach(((e,t)=>{t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0),t.force.set(0,0,0),t.torque.set(0,0,0)})))})),0===n.userData.physicsMass)return;const i=ok(n,{type:sk.HULL});i?(t.push([i.shape,n]),n._physicsShape=i.shape):console.warn("Failed to convert mesh to cannon shape",n)})),!t.length)return;const i=new UD({mass:r,angularVelocity:new mD(0,0,0),velocity:new mD(0,0,0)}),s=new n.Pa4,o=new n._fP,a=new n.Pa4,l=new n.yGw;for(const[n,r]of t)r!==e?(r.updateMatrixWorld(),l.copy(e.matrixWorld).invert(),l.multiply(r.matrixWorld),l.decompose(s,o,a),i.addShape(n,new mD(...s.toArray()),new ED(...o.toArray()))):i.addShape(n);i.position.set(...e.getWorldPosition(s).toArray()),i.quaternion.set(...e.getWorldQuaternion(o).toArray()),i.angularVelocity.set(0,0,0),i.velocity.set(0,0,0),e.addEventListener("objectUpdate",(()=>{i.position.set(...e.getWorldPosition(s).toArray()),i.quaternion.set(...e.getWorldQuaternion(o).toArray()),i.angularVelocity.set(0,0,0),i.velocity.set(0,0,0)})),this._world.addBody(i),this._bodyMeshMap.set(i,e),e._physicsBody=i,e.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};hk.PluginType="CannonPhysics",uk([ht("Enabled",(e=>({onChange:()=>{}}))),Oe()],hk.prototype,"enabled",void 0),uk([ut()],hk.prototype,"stepPhysics",void 0),uk([gt("Make Root Bodies")],hk.prototype,"makeRootBodies",void 0),hk=ck=uk([wt("Physics (dev)")],hk);var pk=__webpackgi_require__(819);class dk{static _initialize(){this._inited=!0,(0,t.createStyles)(t.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",(e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()}))}static Create(e,n,r){this._inited||this._initialize(),this.Element&&this.Remove();const i=(0,t.createDiv)({id:"customContextMenu",addToBody:!1});i.style.top=r+"px",i.style.left=n+"px";for(const[n,r]of Object.entries(e)){const e=(0,t.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:n});i.appendChild(e),e.onclick=r}return this.Element=i,i}static Remove(){this.Element?.remove(),this.Element=void 0}}dk.Element=void 0,dk._inited=!1;var fk=__webpackgi_require__(665);const mk=(e,t,n)=>{const r=e.controller_,i=r.parent?.children?.indexOf(r),s=((e,t)=>t.controller_.rackController.rack===e.controller_.parent)(e,t);return!(s&&i===n||(t.add(e,n),0))},gk=(e,n,r,i)=>{let s=n.uiRef;s?.controller_.viewProps.get("disposed")&&(s=void 0);const o=s?.expanded;if(!s){const r=e.addFolder({title:""});s=r,s.on("fold",(e=>{let i=r.expanded;(0,t.safeSetProperty)(n,"expanded",i,!0),i=(0,t.getOrCall)(n.expanded)??i,i!==r.expanded&&(r.expanded=i),n.uiRefresh?.("postFrame",!0,10),i?n.onExpand?.(n):n.onCollapse?.(n)}))}if(!s)return s;s.expanded=(0,t.getOrCall)(n.expanded)??o??!1;const a=(n.children??[]).map((e=>e&&(0,t.getOrCall)(e))).flat(2).filter((e=>e));let l=0;for(const e of a){if(Array.isArray(e)||"object"!=typeof e){console.error("child is not an object",e);continue}let t=e.uiRef;t&&t.controller_.viewProps.get("disposed")&&(e.uiRef=void 0,e.uiRefresh=void 0),t=e.uiRef,t||(r.appendUiObject({uiConfig:e},s),t=e.uiRef),t&&mk(t,s,l++)&&r.appendUiObject({uiConfig:e},s)}let c=s.children;for(;c.length>l;){const e=c[c.length-1];s.remove(e),e.dispose(),c=s.children}s.controller_.props.set("title",(0,t.getOrCall)(n.label)??"");const u=s.controller_.view.containerElement,h=(0,t.getOrCall)(n.domChildren,[]);if(void 0!==h?.length){const e=[];for(let t=0;t<u.children.length;t++){const n=u.children[t];n.dataset?.tpCustomDOM&&e.push(n)}for(const t of e)u.removeChild(t);for(const e of h)e.parentElement!==u&&(u.appendChild(e),e.dataset.tpCustomDOM="true");s.controller_.foldable.cleanUpTransition()}return s},_k=(e,n,r,i)=>{const[s,o]=n.property??[void 0,void 0],a=(0,t.getOrCall)(n.label)??o;let l=n.uiRef;return l?.controller_.viewProps.get("disposed")&&(l=void 0),l||(l=e.addButton({title:""}),l.on("click",(async()=>{const e=[];n.prompt&&e.push(await r.prompt(...n.prompt));const t=(s&&o?s[o]:void 0)??n.value;if("function"==typeof t){const i=()=>{r.removeEventListener("postFrame",i),t.call(n,...e)};r.addEventListener("postFrame",i)}else console.warn("Invalid action type for button")}))),l&&(l.title=(a??"click me")+""),l},vk=(e,n,r,i)=>{const s=Object.fromEntries(((0,t.getOrCall)(n.children)??[]).map((e=>(0,t.getOrCall)(e))).flat(2).filter((e=>e)).map((e=>{const n=(0,t.getOrCall)(e.label);return[n,e.value??n]})));return wk(e,n,r,{options:s,...i??{}})},yk=(e,n,r,i)=>{const s=(0,t.getOrCall)(n.bounds),o=(s?.length??0)>=2?s[1]:1,a=(s?.length??0)>=1?s[0]:0,l=n.stepSize||void 0;return wk(e,n,r,{min:a,max:o,step:l,...i??{}})},bk=(e,r,i,s)=>{const o=(0,t.getOrCall)(r.bounds);if(!o||o.length<1)return wk(e,r,i,{...s??{}});const a=(o.length??0)>=2?o[1]:1,l=(o.length??0)>=1?o[0]:0,c={min:l,max:a,step:r.stepSize??(a-l)/100},u={x:c,y:c};"vec3"!==r.type&&"vec4"!==r.type||(u.z=c),"vec4"===r.type&&(u.w=c);const h=r.property;if(void 0===r.value&&h&&h[0]&&"object"==typeof h[0]&&h[0][h[1]]&&Array.isArray(h[0][h[1]])){const[e,t]=h,i=e[t],s=i.length,o=(new(2===s?n.FM8:3===s?n.Pa4:n.Ltg)).fromArray(i);r.value=o,r.property=void 0,r.onChange=[()=>{e[t]=o.toArray()},...Array.isArray(r.onChange)?r.onChange:[r.onChange]].filter((e=>e)),void 0===r.label&&(r.label=t)}return wk(e,r,i,{...u,...s??{}})},Ak=(e,r,i,s)=>{const o=r.property;if(void 0===r.value&&o&&"object"==typeof o[0]&&o[0][o[1]]?.isColor){const[e,t]=o,i=n.KI_;Object.defineProperty(r,"value",{get:()=>{const n=e[t];return n?new xe(n).getHex(i):0},set:n=>{const r=e[t],s=(new xe).setHex(n,i);r.isColor?r.copy(s):"number"==typeof r?e[t]=s.getHex():"string"==typeof r&&(e[t]="#"+s.getHexString()),"function"==typeof e?.setDirty&&e.setDirty()}}),r.property=void 0,r.onChange=[...Array.isArray(r.onChange)?r.onChange:[r.onChange]].filter((e=>e)),void 0===r.label&&(r.label=t+"")}return(s=s??{}).view="color",(0,t.getOrCall)(r.inlinePicker)&&(s.picker="inline"),wk(e,r,i,s)},wk=(e,n,r,i)=>{let s=(0,t.getOrCall)(n.property);if((n.getValue||n.setValue)&&s&&console.error("specify either property or value, or getValue and setValue",n),s)n.value&&console.warn("Both property and value are defined, value will be ignored",n);else if((Object.hasOwn?Object.hasOwn(n,"value"):n.hasOwnProperty("value"))||void 0!==n.value||!n.getValue&&!n.setValue||(Object.defineProperty(n,"value",{get:()=>n.getValue?.(),set:e=>n.setValue?.(e)}),s=[n,"value"]),s||void 0===n.value||(s=[n,"value"]),!s)return void console.error("cannot determine property",n);i=i??{};const o={label:(0,t.getOrCall)(n.label)??s[1],...i};let a=n.uiRef;if(a?.controller_.viewProps.get("disposed")&&(a=void 0),!a&&"object"==typeof s[0]&&s[0]){const[t,r]=s;try{a=n.isMonitor?e.addMonitor(t,r,o):e.addInput(t,r,o).on("change",(e=>{[n.onChange].flat().forEach((t=>"function"==typeof t&&t?.(e))),"function"==typeof t?.setDirty&&t.setDirty(e)}))}catch(e){if(!e.message.startsWith("No matching controller for"))throw e;a=void 0}}if(a){for(const[e,t]of Object.entries(o)){const n=a.controller_.props.value(e);void 0!==n&&n.rawValue!==t&&a.controller_.props.set(e,t)}"slider"===n.type&&(void 0!==o.min&&a.controller_.valueController.sliderController.props.set("minValue",o.min),void 0!==o.max&&a.controller_.valueController.sliderController.props.set("maxValue",o.max)),a?.controller_.valueController.view.inputElement?.setAttribute("placeholder",(0,t.getOrCall)(n.placeholder)??""),a.refresh()}return a};class xk extends t.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,r=!0,i=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:gk,folder:gk,input:wk,number:wk,slider:yk,dropdown:vk,checkbox:wk,color:Ak,vec:bk,vec2:bk,vec3:bk,vec4:bk,button:_k,monitor:(e,t,n,r)=>(t.isMonitor=!0,wk(e,t,n,r)),dummy:(e,t,n,r)=>wk(e,t,n,r)},this.alert=async e=>alert(e),this.confirm=async e=>confirm(e),this.prompt=async(e,t,n=!0)=>prompt(e,t),this._expand=e,this._limitedOptions=n;const s=this._createUiContainer();i.appendChild(s),this._pane=new fk.Pane({title:"Configuration",container:s}),this._pane.expanded=this._expand,r&&(this.addEventListener("postFrame",(()=>this.refreshQueue("postFrame"))),setTimeout((()=>{this.dispatchEvent({type:"postFrame"})}),32))}refreshQueue(e){const n=this._refreshQueue[e],r=[],i=(0,t.now)(),s=i-this._lastModeTime[e];n.forEach((e=>{e[2]>.001?(e[2]-=s,r.push(e)):this._refreshUiObject(e[0],e[1],e[2])})),this._refreshQueue[e]=r,this._lastModeTime[e]=i}addToRefreshQueue(e,t){const n=t[0]?.uiConfig,r=n?.uuid,i=this._refreshQueue[e],s=i.find((e=>e[3]===r));s?s[2]=Math.max(s[2],t[2]):i.push([...t,r]),this._refreshQueue[e]=i}dispose(){this._pane?.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,n){const{uiConfig:r}=e??{};if(r&&(!this._limitedOptions||r.limitedUi)&&(n=n??this._pane,r.type)){r.uuid||(r.uuid=lt()),r.uiRef&&r.uiRefType!==r.type&&this.removeUiConfig(r);const i=this._typeGenerators[r.type]?.(n,r,this);i&&(i.hidden=(0,t.getOrCall)(r.hidden)??!1,i.disabled=(0,t.getOrCall)(r.disabled)??!1),r.uiRef=i,r.uiRefType=i?r.type:void 0,r.uiRefresh=(t="postFrame",i=!1,s=0)=>this._uiObjectRefresh(t,e?.uiConfig??r,n,i,s),i?.controller_.viewProps.handleDispose((()=>{r.uiRef=void 0,r.uiRefType=void 0,r.uiRefresh=void 0}))}}removeUiObject(e){this.removeUiConfig(e?.uiConfig)}removeUiConfig(e){e&&e.uiRef&&(e.uiRef.dispose?.(),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,r,i){(r?Ek(t,n):[{uiConfig:t,parentFolder:n}]).forEach((t=>{const n=[{uiConfig:t.uiConfig},t.parentFolder,i];"immediate"===e?this._refreshUiObject(...n):this.addToRefreshQueue(e,n)}))}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,t.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,t.createStyles)(t.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function Ek(e,t,n){return n=n??[],e&&e.uiRef?(n.push({uiConfig:e,parentFolder:t}),[...e.children||[]].forEach((t=>{"function"!=typeof t&&t&&(Array.isArray(t)?t.forEach((t=>n=Ek(t,e.uiRef,n))):n=Ek(t,e.uiRef,n))})),n):n}class Ck{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}function Sk(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const Mk={};function Tk(e){e in Mk||(Mk[e]=!0,console.warn(e))}let Dk;class Ik{static getDataURL(e,t=!1){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===Dk&&(Dk=Sk("canvas")),Dk.width=e.width,Dk.height=e.height;const t=Dk.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=Dk}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Sk("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*pe(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*pe(t[e]/255)):t[e]=pe(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Pk{constructor(e=null){this.isSource=!0,this.uuid=f(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Rk(r[t].image)):e.push(Rk(r[t]))}else e=Rk(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Rk(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return Ik.getDataURL(e);if(e.data){let t=[];try{t=Array.from(e.data)}catch(n){n.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(n),t=e.data}return{data:t,width:e.width,height:e.height,type:e.data.constructor.name}}return void 0!==e.url?e.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Bk=0;class kk extends Ck{constructor(e=kk.DEFAULT_IMAGE,t=kk.DEFAULT_MAPPING,n=1001,r=1001,i=se,s=1008,o=1023,a=1009,l=kk.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Bk++}),this.uuid=f(),this.name="",this.source=new Pk(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new _(0,0),this.repeat=new _(1,1),this.center=new _(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ue,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(Tk("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===oe?ae:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===ae?oe:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return Tk("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ae?oe:3e3}set encoding(e){Tk("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===oe?ae:""}}kk.DEFAULT_IMAGE=null,kk.DEFAULT_MAPPING=300,kk.DEFAULT_ANISOTROPY=1;var Ok=__webpackgi_require__(898),Lk={};Ok.Z&&Ok.Z.locals&&(Lk.locals=Ok.Z.locals);var Fk,Uk=0,Nk={};Nk.styleTagTransform=gd(),Nk.setAttributes=pd(),Nk.insert=function(e,t){(t.target||document.head).appendChild(e)},Nk.domAPI=ud(),Nk.insertStyleElement=fd(),Lk.use=function(e){return Nk.options=e||{},Uk++||(Fk=ld()(Ok.Z,Nk)),Lk},Lk.unuse=function(){Uk>0&&! --Uk&&(Fk(),Fk=null)};var jk=Lk;class zk extends xk{constructor(e=!1,t=!1,n=!1,r=document.body){super(e,t,n,!1),this.dependencies=[fo],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=e=>{this.dispatchEvent(e),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async e=>this._viewer?this._viewer.alert(e):super.alert(e),this.confirm=async e=>this._viewer?this._viewer.confirm(e):super.confirm(e),this.prompt=async(e,t,n=!0)=>this._viewer?this._viewer.prompt(e,t,n):super.prompt(e,t,n),this._pane.registerPlugin(pk),jk.use({target:r})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(e=>(r,i,s,o)=>{let a=i.property||i.__property;const l="placeholder";if(void 0===i.value&&(i.getValue||i.setValue)&&(Object.defineProperty(i,"_value",{get:()=>i.getValue?.(),set:e=>i.setValue?.(e)}),a=[i,"_value"]),(!(Object.hasOwn?Object.hasOwn(i,"value"):i.hasOwnProperty("value"))||void 0===i.value)&&a&&"object"==typeof a[0]){const[r,s]=a,o=(0,t.makeTextSvg)("Render Target"),c=(0,t.makeTextSvg)("Data Texture"),u=(0,t.makeTextSvg)("CUBE Texture"),h=(0,t.makeTextSvg)("Compressed Texture"),p={},d={};Object.defineProperty(i,"value",{get:()=>{let n,i=r[s];if(i?.get&&(i=i.get()),!i)return l;if(i.isCompressedTexture&&!i.image.tp_src&&(i.image.tp_src=h),i.isTexture?(i.image&&!i.image.tp_src&&(i.image instanceof ImageBitmap||i.image instanceof HTMLImageElement||i.image instanceof HTMLVideoElement)?i.image.tp_src=(0,t.imageBitmapToBase64)(i.image,160):i.image&&i.isRenderTargetTexture&&!i.image.tp_src?i.__target&&(i.image.tp_src=e.renderer.renderTargetToDataUrl(i.__target)):i.image&&!i.image.tp_src&&(i.image.tp_src=Pe(i,160,!1).toDataURL("image/png",90)),i.isRenderTargetTexture&&!i.image.tp_src&&(i.image.tp_src=o),i.isDataTexture&&!i.image.tp_src&&(i.image.tp_src=c),i.image&&(n=i.image.tp_src_uuid,n=n?p[n]:void 0,n||(n=i.image.tp_src||i.image.src))):"string"==typeof i?n=i:i.domainMin?(n=i.texture,i.texture.image&&!i.texture.image.tp_src&&(i.texture.image.tp_src=u),i.texture.image&&(n=i.texture.image.tp_src_uuid,n=n?p[n]:void 0,n||(n=i.texture.image.tp_src||i.texture.image.src))):i&&console.error("unknown value",i),n||(n=l),i.image&&!i.image.tp_src_uuid){const e=lt();i.image.tp_src_uuid=e,d[n]=e}return"string"==typeof n&&(n=p[n]??n),n},set:t=>{const o=r[s],a=e=>{r[s]=e,e?.isTexture&&(e.flipY=e.isDataTexture?e.flipY:o?.flipY??!0)};if("string"==typeof t)return void("string"==typeof o&&a(t));if(!t)return void(i.value=l);if(t.isPlaceholder)return void(o&&(a("string"==typeof o?"":null),"function"==typeof r?.setDirty&&r.setDirty()));let c=t.tp_src_uuid;if(c||(c=t.src??t.tp_src,c=d[c]??c,delete d[c],t.tp_src_uuid=c),c&&(p[c]=t),"string"!=typeof o){if(!(o?.image===t||o?.image?.src===t.src||o?.image?.tp_src===t.tp_src&&null!=t.tp_src||o?.image?.tp_src===t.src&&null!=t.src||o?.image?.src===t.tp_src&&null!=t.tp_src))if(t instanceof File){const n=e?.getPlugin(fo);if(!n)throw"Viewer or AssetManagerPlugin not found";n.importer?.importSingle({file:t,path:t.src}).then((e=>{if(e){e.isDataTexture&&(e.needsUpdate=!0);const n=t.src?.split("?")?.[0]?.split(".").pop();e.userData&&(e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(n)?"jpeg":"png"))),a(e),[i.onChange].flat().forEach((e=>"function"==typeof e&&e?.())),"function"==typeof r?.setDirty&&r.setDirty(),i.uiRefresh?.("postFrame",!1)}}))}else{const e=new kk(t);e.assetType="texture",e.needsUpdate=!0;const o=t.src?.split("?")?.[0]?.split(".").pop();e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(o)?"jpeg":"png"));const l=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(s);e.colorSpace=l?n.GUF:n.KI_,e.wrapS=n.rpg,e.wrapT=n.rpg,a(e),[i.onChange].flat().forEach((e=>"function"==typeof e&&e?.())),"function"==typeof r?.setDirty&&r.setDirty(),i.uiRefresh?.("postFrame",!1)}}else a(c)}}),i.__property=i.property,i.property=void 0,void 0===i.label&&(i.label=s)}return(o=o??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],void 0===o.imageFit&&(o.imageFit="contain"),void 0===o.clickCallback&&(o.clickCallback=(r,o)=>{const a=r?.target,c=a?.getBoundingClientRect();if(!c)return void o.click();const u=i.uiRef.controller_.valueController.value.rawValue,h=u===l||u?.isPlaceholder?{}:{"remove image":()=>{i.uiRef.controller_.valueController.value.setRawValue("");const[e,t]=i.property||i.__property||[i,"value"],n="string"==typeof e[t];e[t]=n?"":null,[i.onChange].flat().forEach((e=>"function"==typeof e&&e?.())),"function"==typeof e?.setDirty&&e.setDirty(),i.uiRefresh?.("postFrame",!1),dk.Remove()},"download image":async()=>{dk.Remove();const[r,s]=i.property||i.__property||[i,"value"],o=r[s];if(!o)return;const a=o?.image??i.uiRef.controller_.valueController.value.rawValue;let l=o.__rootBlob?o.__rootBlob.objectUrl||URL.createObjectURL(o.__rootBlob):o.userData.rootPath||a?.src;a&&(a instanceof ImageBitmap||a instanceof HTMLImageElement||a instanceof HTMLVideoElement)&&!l&&(l=(0,t.imageBitmapToBase64)(a));let c=o.__rootBlob?o.__rootBlob.name||"image."+(o.__rootBlob.ext||"png"):null;if(!l&&o.isRenderTargetTexture){const t=o.__target;if(o.type===n.ywz)l=e.renderer.renderTargetToDataUrl(t,"image/png",90),c="renderTarget.png";else{const n=(new Ry).parse(e.renderer.rendererObject,t),o=new Blob([n],{type:"image/x-exr"});if(!o)return void console.error("cannot export render target",a,r[s],r,s,i);c="renderTarget.exr",l=URL.createObjectURL(o)}}if(!l&&o.isDataTexture){const e=(new Ry).parse(void 0,o),t=new Blob([e],{type:"image/x-exr"});if(!t)return void console.error("cannot export data texture",a,r[s],r,s,i);c="dataTexture.exr",l=URL.createObjectURL(t)}if(!l)return void console.error("cannot export image",a,r[s],r,s,i);const u=document.createElement("a");document.body.appendChild(u),u.style.display="none",u.href=l,u.download=c||(l.startsWith("data:")?"image.png":l.split("/").pop()??"image.png"),u.target="_blank",u.click(),document.body.removeChild(u)}},p=dk.Create({...h,"set/replace image":()=>{o.click(),dk.Remove()},"from url":async()=>{let t="";if(t=await s.prompt("Load texture: Enter Image/Texture URL",t,!0),!t||!t.startsWith("http")&&!t.startsWith("data:image"))return null!==t&&await s.alert("Loading Image: Invalid URL"),void dk.Remove();t=t.trim();const[r,o]=i.property||i.__property||[i,"value"],a=r[o];if("string"==typeof a)r[o]=t,[i.onChange].flat().forEach((e=>"function"==typeof e&&e?.())),"function"==typeof r?.setDirty&&r.setDirty(),i.uiRefresh?.("postFrame",!1);else{const s=e?.getPlugin(fo);if(!s)throw"Viewer or AssetManagerPlugin not found";s.importer?.importSinglePath(t).then((e=>{if(e){e.isDataTexture?e.needsUpdate=!0:e&&void 0!==a?.flipY&&(e.flipY=a.flipY);const t=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(o);e.colorSpace=t?n.GUF:n.KI_,r[o]=e,[i.onChange].flat().forEach((e=>"function"==typeof e&&e?.())),"function"==typeof r?.setDirty&&r.setDirty(),i.uiRefresh?.("postFrame",!1)}else console.warn("Failed to load texture",t)}))}dk.Remove()},cancel:()=>{dk.Remove()}},2,c.height+8);a.parentElement?.appendChild(p),c.y>.7*document.body.clientHeight&&(p.style.top="auto",p.style.bottom=c.height+8+"px")}),o.view="input-image",wk(r,i,s,o)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){const n=this._viewer?.getPlugin(e);if(!n)return void console.warn("plugin not found:",e);this._plugins.push(n),n.uiConfig&&(n.uiConfig.limitedUi=!0),n.uiConfig&&void 0===n.uiConfig.hidden&&(n.uiConfig.hidden=!1),this._appendUiObject(n);const r=n.uiConfig;if(r?.uiRef&&n.toJSON){const e="function"==typeof n.toJSON?n.toJSON():null;n.resetDefaults=async()=>{await(n.fromJSON?.(e)),r.uiRefresh?.("postFrame",!0)};const i=r.uiRef.controller_.view.element,s=(0,t.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});s.onclick=s=>{const o={};"function"==typeof n.toJSON&&(o["download preset"]=async()=>{const e=this._viewer?.getPlugin(fo)?.exportPluginPreset(n);await(0,t.downloadBlob)(new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),"preset."+n.constructor.PluginType+".json"),dk.Remove()}),"function"==typeof n.fromJSON&&(o["upload preset"]=async()=>{dk.Remove();const e=await(0,t.uploadFile)(!1,!1);if(0===e.length)return;const i=e[0],s=await i.text(),o=JSON.parse(s);await(this._viewer?.getPlugin(fo)?.importPluginPreset(o,n)),r.uiRefresh?.("postFrame",!0)},e&&(o["reset defaults"]=async()=>{dk.Remove(),await(n.resetDefaults?.())}));const a=dk.Create(o,i.clientWidth-120,12);i.append(a),s.preventDefault()},i.appendChild(s)}return r}setupPlugins(...e){e.forEach((e=>this.setupPluginUi(e)))}refreshPluginsEnabled(){this._plugins.forEach((e=>{const n=e.uiConfig;n&&(!0!==(0,t.getOrCall)(n.hidden)?n.uiRefresh?.("postFrame",!0):n.uiRef&&(n.uiRef.hidden=!0))}))}}zk.PluginType="TweakpaneUi";class Gk extends qt{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>this._viewer?.scene.backgroundIntensity??1,setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>this._viewer?.renderer.useLegacyLights??!0,setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){const e=this._viewer?.scene.backgroundColor?.getHex(n.KI_);return void 0!==e&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new xe),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){const e=this._viewer?.scene.background;return e&&(e.isTexture||"texture"===e.assetType)?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){return this._viewer?.scene.environment||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){return this._viewer?.scene.environment?.rotation??0}set sceneEnvironmentRotation(e){const t=this._viewer?.scene.environment;t&&(t.rotation=e,this._viewer?.scene.setDirty())}get sceneEnvironmentIntensity(){return this._viewer?.scene.envMapIntensity??1}set sceneEnvironmentIntensity(e){this._viewer?.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){return this._viewer?.scene.fixedEnvMapDirection??!1}set sceneEnvironmentFixedDirection(e){this._viewer?.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){return"environment"===this._viewer?.scene.background||this._viewer?.scene.background===this._viewer?.scene.environment}set envmapBg(e){if(this._viewer)if(e){const e=this._viewer.scene.background;e&&e!==this._viewer.scene.environment&&"environment"!==e&&(this.lastBgVal=e),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&"environment"!==this._viewer.scene.background||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",(()=>{this.uiConfig.uiRefresh?.("postFrame",!0)})),e.scene.addEventListener("environmentChanged",(()=>{this.uiConfig.uiRefresh?.("postFrame",!0)}))}}Gk.PluginType="SimpleBackgroundEnvUiPlugin1";class Vk extends qt{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{this._uiConfig.uiRefresh?.("postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{this._viewer?.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){this._viewer?.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...this._viewer?.scene.modelRoot.modelObject.children?.map((e=>"light"===e.assetType?null:e.uiConfig)).filter((e=>null!=e))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){this._uiConfig?.uiRefresh?.("postFrame",!0)}}Vk.PluginType="SimpleUi";var Hk=__webpackgi_require__(1),Qk=__webpackgi_require__.n(Hk)();class Wk extends qt{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,t.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(e,t)=>(e.push({text:t.name||"unnamed",id:t.uuid,children:t.children.reduce(this._buildData,[])}),e),this._findVisible=(e,t)=>t.visible?(t.children.length<1?e.push(t.uuid):e.push(...t.children.reduce(this._findVisible,[])),e):e,this._setVisible=e=>{this._viewer?.doOnce("postFrame",(()=>{const t=this._viewer?.scene.modelRoot;if(!t||null==e)return;const n=new Set;t.traverse((r=>{r!==t&&(r.visible=e.includes(r.uuid),r.visible&&r.traverseAncestors((e=>n.add(e))))})),n.forEach((e=>e.visible=!0)),this._viewer?.scene?.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})}))},this.enabled=e,this.reset=this.reset.bind(this),(0,t.createStyles)(t.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){if(e?.fromHierarchyPlugin)return;if(!e?.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const n=this._viewer?.scene.modelRoot;if(!n)return;const r=n.children.reduce(this._buildData,[]),i=n.children.reduce(this._findVisible,[]);let s=!1;return new Promise(((e,o)=>{this.treeView=new Qk(this.hierarchyDiv,{closeDepth:1,data:r,loaded:function(){this.values=i,e()},onChange:()=>{s?(0,t.timeout)(200).then((()=>{this.treeView&&this._setVisible(this.treeView.values)})):s=!0},onItemLabelClick:e=>{const t=this._viewer?.scene.modelRoot.modelObject.getObjectByProperty("uuid",e);t&&n.visible&&t.dispatchEvent({type:"select",value:t,ui:!0})}})}))}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Wk.PluginType="HierarchyUiPlugin";class qk extends qt{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Lr;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[fo],this._sceneUpdate=e=>{if(!e.hierarchyChanged)return;const t=[];this._viewer?.traverseSceneObjects((e=>{if(!e.lightObject)return;const n=e.uiConfig;n&&!t.includes(n)&&t.push(n)})),[...this.uiConfig.children].forEach((e=>{"button"===e?.type||t.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),t.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),this.uiConfig.uiRefresh?.("postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}qk.PluginType="SimpleLightsUi";class Xk extends qt{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[fo],this._sceneUpdate=e=>{if(!e.hierarchyChanged)return;const t=[];this._viewer?.traverseSceneObjects((e=>{if(!e.cameraObject)return;const n=e.uiConfig;n&&!t.includes(n)&&t.push(n)})),[...this.uiConfig.children].forEach((e=>{"button"===e?.type||t.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)})),t.forEach((e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)})),this.uiConfig.uiRefresh?.("postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Xk.PluginType="SimpleSceneCamerasUi";var Yk,Kk=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let Jk=Yk=class extends qt{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(e=!0){if(!this._viewer)return;if("full"===this.mode)return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const t={width:Math.floor(this.width),height:Math.floor(this.height)},n=this._viewer.container.getBoundingClientRect(),r={width:Math.floor(n.width),height:Math.floor(n.height)};let i=1;if(t.width>r.width){const e=t.width;t.width=r.width;const n=t.width/e;if(t.height=Math.floor(t.height*n),i/=n,i>Yk.MaxCanvasScale)return this.width=r.width*Yk.MaxCanvasScale,this.width,void this._sizeChanged()}if(t.height>r.height){const e=t.height;t.height=r.height;const n=t.height/e;if(t.width=Math.floor(t.width*n),i/=n,i>Yk.MaxCanvasScale)return this.height=r.height*Yk.MaxCanvasScale,this.width,this.height,void this._sizeChanged()}(t.width>=r.width||t.width<1)&&delete t.width,(t.height>=r.height||t.height<1)&&delete t.height,this._viewer.setSize(t),this._setScale(i),e&&(this.scale=i),this._refresh()}_setScale(e){this._viewer&&(this._viewer.renderer.displayCanvasScaling=e)}_scaleChanged(){if(!this._viewer)return;const e=this.scale;if(Math.abs(e-this._viewer.renderer.displayCanvasScaling)<.01)return;if("full"===this.mode)return void this._sizeChanged();const t=this.width/this.height,n=this._viewer.container.getBoundingClientRect(),r=Math.floor(n.width*e),i=Math.floor(r/t);this.width=r,this.height=i,this._sizeChanged(!1)}async onAdded(e){await super.onAdded(e);const t=e.canvas.clientWidth,n=e.canvas.clientHeight,r=e.renderer.displayCanvasScaling;this.width=t,this.height=n,this.scale=r,e.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",(()=>this._sizeChanged(!0))),this._refresh()}async onRemove(e){return e.renderer.removeEventListener("resize",this._refresh),super.onRemove(e)}_refresh(){this.uiConfig?.uiRefresh?.("postFrame",!0)}fromJSON(e,t){if(!e.mode)if(e.width||e.height){const t=this._viewer.container.getBoundingClientRect();e.width||(e.width=t.width),e.height||(e.height=t.height),e.scale&&(e.width*=e.scale,e.height*=e.scale,delete e.scale),e.width=Math.round(e.width),e.height=Math.round(e.height),e.mode="custom"}else e.mode="full";return super.fromJSON(e,t)}toJSON(e){const t=super.toJSON(e);return"full"===t.mode&&(delete t.width,delete t.height),"custom"===t.mode&&delete t.scale,t}};Jk.PluginType="RendererParamsUiPlugin",Jk.MaxCanvasScale=4,Kk([Oe("version")],Jk.prototype,"_serializeVersion",void 0),Kk([Oe(),mt("Mode",["full","custom"].map((e=>({label:e})))),(0,t.onChange2)(Yk.prototype._sizeChanged)],Jk.prototype,"mode",void 0),Kk([Oe(),dt("Width",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>[10,Math.pow(2,Math.ceil(Math.log2(e._viewer?.container.getBoundingClientRect().width||1024)+2))]})))],Jk.prototype,"width",void 0),Kk([Oe(),dt("Height",void 0,1,(e=>({onChange:()=>e._sizeChanged(),hidden:()=>"full"===e.mode,bounds:()=>[10,Math.pow(2,Math.ceil(Math.log2(e._viewer?.container.getBoundingClientRect().height||1024)+2))]})))],Jk.prototype,"height",void 0),Kk([Oe(),(0,t.onChange)(Yk.prototype._scaleChanged),dt("Scale",[.25,Yk.MaxCanvasScale],.001,(e=>({disabled:()=>"custom"===e.mode})))],Jk.prototype,"scale",void 0),Jk=Yk=Kk([wt("Renderer")],Jk);class Zk extends qt{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){const t=super.toJSON(e);return t.activeCamera=this._viewer?.scene.activeCamera.toJSON(),t}fromJSON(e,t){return e.activeCamera&&(this._viewer?.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){this._viewer&&this.uiConfig.uiRefresh?.("postFrame",!0)}get uiConfig(){return this._viewer?.scene.activeCamera.uiConfig||{}}}Zk.PluginType="CameraUiPlugin";let $k={create:e=>{let t="button"+(e.type?" "+e.type:""),n=nO.createDiv(t,e.text);return n.addEventListener("click",e.onClick),n}};var eO=$k;let tO={createElement:(e,t,n,r)=>{let i=document.createElement(e);if(t&&(i.className=t),n&&(i.innerHTML=n),r)for(let e in r)i.setAttribute(e,r[e]);return i},createDiv:(e,t,n)=>tO.createElement("div",e,t,n),createDomTree:e=>{if(!e||!e.hasOwnProperty("dom"))return e;let t=e.dom;if(e.children)for(let n in e.children)e.children[n]&&t.appendChild(tO.createDomTree(e.children[n]));return t},removeElement:e=>{null!=e&&e.parentNode.removeChild(e)},appendToBody:e=>{document.body.appendChild(e)},makeIconHTML:e=>{let t="";return"ok"==e&&(t="#tick"),"error"==e&&(t="#cancel"),"info"==e&&(t="#info-button"),"caution"==e&&(t="#danger"),"min"==e&&(t="#line"),"close"==e&&(t="#close"),`<svg class="icon ${e}"><use xlink:href="${t}" /></svg>`},makeNftContent:e=>{let t=null;if(e.type){let n=null;n="string"==typeof e.content?tO.createDiv("inner-content",e.content):tO.createDomTree({dom:tO.createDiv("inner-content"),children:[e.content]}),t="text"==e.type?tO.createDomTree({dom:tO.createDiv("content text"),children:[n]}):tO.createDomTree({dom:tO.createDiv("content"),children:[tO.createDiv("state",tO.makeIconHTML(e.type)),n]})}else"string"==typeof e.content&&(t=tO.createDiv("content",e.content));return t},standardizeButtons:(e,t)=>{let n=[];if(void 0===t.buttons)return"caution"!=t.type&&"info"!=t.type||n.push({key:27,text:"Cancel",onClick:e.close.bind(e,"cancel")}),n.push({key:13,text:"OK",type:"main",onClick:e.close.bind(e,"ok")}),n;n=t.buttons,n.constructor!==Array&&(n=[n]);for(let t in n)!n[t].onClick&&(n[t].onClick=e.close.bind(e,n[t].id));return n},makeButtons:e=>{let t=[];if(e)for(let n in e)t.push(eO.create({text:e[n].text?e[n].text:"OK",type:e[n].normal?null:"main",onClick:e[n].onClick}));return tO.createDomTree({dom:tO.createDiv("button-wrapper"),children:t})},bindButtonKeyEvents:e=>{let t=t=>{for(let n in e)if(e[n].key===t.keyCode)return void e[n].onClick()};return window.addEventListener("keydown",t),t},unbindButtonKeyEvents:e=>{window.removeEventListener("keydown",e)}};var nO=tO,rO=__webpackgi_require__(476),iO={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let sO={};sO.overlay_in=[new rO.Frame(iO["wwise-overlay-in-1"],0),new rO.Frame(iO["wwise-overlay-in-2"],400)],sO.overlay_out=[new rO.Frame(iO["wwise-overlay-out-1"],300)],sO.pop_in=[new rO.Frame(iO["wwise-pop-in-1"],0),new rO.Frame(iO["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new rO.Frame(iO["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new rO.Frame(iO["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],sO.pop_out=[new rO.Frame(iO["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],sO.flip_in=[new rO.Frame(iO["wwise-flip-in-1"],0),new rO.Frame(iO["wwise-flip-in-2"],500)],sO.flip_out=[new rO.Frame(iO["wwise-flip-out-1"],400)],sO.min_in=[new rO.Frame(iO["wwise-min-in-1"],0),new rO.Frame(iO["wwise-min-in-2"],350)],sO.min_out=[new rO.Frame(iO["wwise-min-out-1"],400)];let oO=["top","bottom","left","right"];for(let e in oO){let t=oO[e];sO[t+"_in"]=[new rO.Frame(iO["wwise-"+t+"-in-1"],0),new rO.Frame(iO["wwise-"+t+"-in-2"],{duration:400,"timing-function":"ease-out"})],sO[t+"_out"]=[new rO.Frame(iO["wwise-"+t+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var aO=sO;let lO={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class cO{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let r=e.getElementsByClassName("content")[0];return r&&(r=r.innerHTML),nO.removeElement(e),t.title=n,t.content=r,new cO(t)}constructor(e){this.options=JSON.parse(JSON.stringify(lO));for(let t in e)null!=e[t]&&(this.options[t]=e[t]);let t=this.options.position;if(-1==t.indexOf(" ")&&("left"==t||"right"==t?t+=" center":t="top"==t||"bottom"==t?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let e=document.getElementsByClassName("wwise-overlay");e.length?(this.overlay=e[0],this.hasOverlay=!0):(this.overlay=nO.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let e=[];this.options.topbar.showMin&&(e.push(nO.createDiv(null,nO.makeIconHTML("min"))),e[e.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(e.push(nO.createDiv(null,nO.makeIconHTML("close"))),e[e.length-1].addEventListener("click",this.close.bind(this,void 0)));let t=null;t="string"==typeof this.options.title?nO.createDiv("title",this.options.title):nO.createDomTree({dom:nO.createDiv("title"),children:[this.options.title]}),this.topbar=nO.createDomTree({dom:nO.createDiv("topbar"),children:[{dom:nO.createDiv("control"),children:e.map((e=>({dom:e})))},{dom:t},{dom:nO.createDiv("clear")}]})}else n+=" no-topbar";"string"==typeof this.options.content?this.content=nO.createDomTree({dom:nO.createDiv(n,this.options.content)}):this.content=nO.createDomTree({dom:nO.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=nO.createDomTree({dom:nO.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let r=nO.createDiv("wwise-wrapper");this.options.zIndex&&(r.style.zIndex=this.options.zIndex),this.wrapper=nO.createDomTree({dom:r,children:[this.window]}),this.dom=nO.createDomTree({dom:nO.createDiv(),children:[this.wrapper]});let i=this.options.position.split(" "),s=-50,o=-50;if("left"==i[0]?(s=0,this.wrapper.classList.add("left")):"right"==i[0]?(s=-100,this.wrapper.classList.add("right")):"center"==i[0]?this.wrapper.classList.add("h-center"):this.wrapper.style.left=i[0],"top"==i[1]?(o=0,this.wrapper.classList.add("top")):"bottom"==i[1]?(o=-100,this.wrapper.classList.add("bottom")):"center"==i[1]?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${s}%, ${o}%)`,this.options.style)for(let e in this.options.style)this.window.style[e]=this.options.style[e];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise((e=>{this.promiseResolve=e})),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new rO.Queue(this.wrapper,aO[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&e.push(new rO.Queue(this.overlay,aO.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then((()=>{this.dom.classList.remove("wwise-perspective")}))}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new rO.Queue(this.wrapper,aO[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&e.push(new rO.Queue(this.overlay,aO.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then((()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()}))}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(nO.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",(e=>{e.preventDefault()}))),nO.appendToBody(this.dom)}removeDoms(){nO.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(nO.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),r=this.options.draggable,i=parseFloat(n.left),s=parseFloat(n.top);if(-1!=n.left.indexOf("%")){i=n.left,i=i.substr(0,i.length-1),i=parseInt(i);let e=window,t=document,r=t.documentElement,s=t.getElementsByTagName("body")[0];i=i*(e.innerWidth||r.clientWidth||s.clientWidth)/100}if(-1!=n.top.indexOf("%")){s=n.top,s=s.substr(0,s.length-1),s=parseInt(s);let e=window,t=document,r=t.documentElement,i=t.getElementsByTagName("body")[0];s=s*(e.innerHeight||r.clientHeight||i.clientHeight)/100}1!=r&&"horizontal"!=r||(this.wrapper.style.left=i+t.x+"px"),1!=r&&"vertical"!=r||(this.wrapper.style.top=s+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&"HTML"!=t.nodeName||(this.inDragging=!1)}}var uO=cO,hO=class{constructor(e){let t=this.options=e;!t.type&&(t.type="ok");let n={topbar:!1};n.content=this.constructContent({type:t.type,title:t.title,text:t.text,content:t.content,buttons:t.buttons}),n.overlay=!0,n.keepOverlay=t.keepOverlay,n.clickOverlayToClose=!1,n.animation=t.animation,n.zIndex=t.zIndex,this.wwise=new uO(n)}constructContent(e){let t=nO.createDiv("modal"),n=nO.createDomTree({dom:nO.createDiv("main "+e.type),children:[nO.createDiv(null,nO.makeIconHTML(e.type)),nO.createDiv("title",e.title),nO.createDiv("text",e.text)]});this.buttonArr=nO.standardizeButtons(this,e);let r=nO.makeButtons(this.buttonArr),i=null;e.content&&(i="string"==typeof e.content?nO.createDiv(null,e.content):e.content);let s=null;return r.innerHTML&&(s=nO.createDomTree({dom:nO.createDiv("operation "+e.type),children:[r]})),i||s||n.classList.add("no-op"),nO.createDomTree({dom:t,children:[n,i,s]})}open(){if(this.wwise.opened)return;let e=this.wwise.open();return this.value=void 0,this.promise=new Promise((e=>{this.promiseResolve=e})),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=nO.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout((()=>{this.close("timer")}),this.options.closeAfter),e}close(e){if(this.wwise.opened)return this.value=e,nO.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let pO={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},dO={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var fO=__webpackgi_require__(513),mO={};fO.Z&&fO.Z.locals&&(mO.locals=fO.Z.locals);var gO,_O=0,vO={};vO.styleTagTransform=gd(),vO.setAttributes=pd(),vO.insert=function(e,t){(t.target||document.head).appendChild(e)},vO.domAPI=ud(),vO.insertStyleElement=fd(),mO.use=function(e){return vO.options=e||{},_O++||(gO=ld()(fO.Z,vO)),mO},mO.unuse=function(){_O>0&&! --_O&&(gO(),gO=null)};var yO=mO;class bO extends qt{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},nO.appendToBody=t=>{e.container.appendChild(t)},nO.makeIconHTML=e=>"",yO.use({target:e.container}),e.alert=async e=>{const t=e?.split(":")[0],n=new hO({type:"info",title:t??"&ndsp;",text:e?.replace(t+":","")||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return n.open(),n.getPromise()},e.confirm=async e=>{const t=e?.split(":")[0],n=new hO({type:"info",title:t??"&ndsp;",text:e?.replace(t||"","").replace(":","")||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return n.open(),"yes"===await n.getPromise()},e.prompt=async(e,t,n=!0)=>{const r=e?.split(":")[0],i=new class{constructor(e){this.options=JSON.parse(JSON.stringify(pO));for(let t in e)null!=e[t]&&(this.options[t]=e[t]);let t=this.options,n=JSON.parse(JSON.stringify(dO));for(let e in n)t.hasOwnProperty(e)&&(n[e]=t[e]);let r=[];t.showCancel&&r.push({key:27,text:t.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),r.push({key:13,text:t.okText,onClick:this.handleOk.bind(this)}),n.buttons=r,this.input=nO.createElement("input","input",null,{placeholder:t.placeholder}),this.error=nO.createDiv("error"),n.content=nO.createDomTree({dom:nO.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new hO(n)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then((()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))}),(e=>{this.error.innerText=e})):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let e=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise(((e,t)=>{this.promiseResolve=e,this.promiseReject=t})),e}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:r??"&ndsp;",placeholder:t??"",showCancel:n,animation:"overlay",text:e?.replace(r||"","").replace(":","")||""});return i.open(),await i.getPromise().catch((async()=>null))}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}bO.PluginType="WindowiseDialogPlugin";class AO extends qt{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",n._MY],["PCF",n._iA],["PCFSoft",$],["VSM",ee]].map((e=>({label:e[0],value:e[1]}))),getValue:()=>this._viewer?.renderer.rendererObject.shadowMap.type,setValue:e=>{this._viewer?.doOnce("postFrame",(()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())}))}}),()=>({label:(this._viewer?.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("rgbm",this._viewer?.useRgbm?"no":"yes",!0)}}),()=>({label:(this._viewer?.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("msaa",this._viewer?.isAntialiased?"no":"yes",!0)}}),()=>({label:(this._viewer?.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("depthPrepass",this._viewer?.useGBufferDepth?"no":"yes",!0)}}),()=>({label:(this._viewer?.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,t.setUrlQueryParam)("debug",this._viewer?.getPluginByType("debug")?null:"true",!0)}}),{label:"Clear local storage",type:"button",value:async()=>{await(this._viewer?.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{const e=this._viewer?.getPlugin(fo)?.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const t=await e.keys();await Promise.all(t.map((async t=>e.delete(t))))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{const e=new Set;this._viewer?.scene.modelRoot.traverse((t=>t.geometry&&e.add(t.geometry))),e.forEach((e=>qe(e)))}},{label:"Auto Center All Geometries",type:"button",value:()=>{const e=new Set;this._viewer?.scene.modelRoot.traverse((t=>t.geometry&&e.add(t.geometry))),e.forEach((e=>{const t=new n.Pa4;e.center(t),e.userData.__appliedMeshes.forEach((e=>{e.position.sub(t),e.setDirty&&e.setDirty()}))}))}}]}}}AO.PluginType="ExtrasUiPlugin1";var wO=__webpackgi_require__(729),xO={};wO.Z&&wO.Z.locals&&(xO.locals=wO.Z.locals);var EO,CO=0,SO={};SO.styleTagTransform=gd(),SO.setAttributes=pd(),SO.insert=function(e,t){(t.target||document.head).appendChild(e)},SO.domAPI=ud(),SO.insertStyleElement=fd(),xO.use=function(e){return SO.options=e||{},CO++||(EO=ld()(wO.Z,SO)),xO},xO.unuse=function(){CO>0&&! --CO&&(EO(),EO=null)};var MO=xO,TO=__webpackgi_require__(109),DO={};TO.Z&&TO.Z.locals&&(DO.locals=TO.Z.locals);var IO,PO=0,RO={};RO.styleTagTransform=gd(),RO.setAttributes=pd(),RO.insert=function(e,t){(t.target||document.head).appendChild(e)},RO.domAPI=ud(),RO.insertStyleElement=fd(),DO.use=function(e){return RO.options=e||{},PO++||(IO=ld()(TO.Z,RO)),DO},DO.unuse=function(){PO>0&&! --PO&&(IO(),IO=null)};var BO=DO;const kO=new TextEncoder,OO={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},LO=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class FO{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:r,region:i,cache:s,retries:o,initRetryMs:a}){if(null==e)throw new TypeError("accessKeyId is a required option");if(null==t)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=r,this.region=i,this.cache=s||new Map,this.retries=null!=o?o:10,this.initRetryMs=a||50}async sign(e,t){if(e instanceof Request){const{method:n,url:r,headers:i,body:s}=e;null==(t=Object.assign({method:n,url:r,headers:i},t)).body&&i.has("Content-Type")&&(t.body=null!=s&&i.has("X-Amz-Content-Sha256")?s:await e.clone().arrayBuffer()),e=r}const n=new UO(Object.assign({url:e},t,this,t&&t.aws)),r=Object.assign({},t,await n.sign());delete r.aws;try{return new Request(r.url.toString(),r)}catch(e){if(e instanceof TypeError)return new Request(r.url.toString(),Object.assign({duplex:"half"},r));throw e}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const r=fetch(await this.sign(e,t));if(n===this.retries)return r;const i=await r;if(i.status<500&&429!==i.status)return i;await new Promise((e=>setTimeout(e,Math.random()*this.initRetryMs*Math.pow(2,n))))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class UO{constructor({method:e,url:t,headers:n,body:r,accessKeyId:i,secretAccessKey:s,sessionToken:o,service:a,region:l,cache:c,datetime:u,signQuery:h,appendSessionToken:p,allHeaders:d,singleEncode:f}){if(null==t)throw new TypeError("url is a required option");if(null==i)throw new TypeError("accessKeyId is a required option");if(null==s)throw new TypeError("secretAccessKey is a required option");let m,g;this.method=e||(r?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=r,this.accessKeyId=i,this.secretAccessKey=s,this.sessionToken=o,a&&l||([m,g]=function(e,t){const{hostname:n,pathname:r}=e;if(n.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(n.endsWith(".backblazeb2.com")){const e=n.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return null!=e?["s3",e[1]]:["",""]}const i=n.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[s,o]=(i||["",""]).slice(1,3);if("us-gov"===o)o="us-gov-west-1";else if("s3"===o||"s3-accelerate"===o)o="us-east-1",s="s3";else if("iot"===s)s=n.startsWith("iot.")?"execute-api":n.startsWith("data.jobs.iot.")?"iot-jobs-data":"/mqtt"===r?"iotdevicegateway":"iotdata";else if("autoscaling"===s){const e=(t.get("X-Amz-Target")||"").split(".")[0];"AnyScaleFrontendService"===e?s="application-autoscaling":"AnyScaleScalingPlannerFrontendService"===e&&(s="autoscaling-plans")}else null==o&&s.startsWith("s3-")?(o=s.slice(3).replace(/^fips-|^external-1/,""),s="s3"):s.endsWith("-fips")?s=s.slice(0,-5):o&&/-\d$/.test(s)&&!/-\d$/.test(o)&&([s,o]=[o,s]);return[OO[s]||s,o]}(this.url,this.headers)),this.service=a||m||"",this.region=l||g||"us-east-1",this.cache=c||new Map,this.datetime=u||(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=h,this.appendSessionToken=p||"iotdevicegateway"===this.service,this.headers.delete("Host"),"s3"!==this.service||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const _=this.signQuery?this.url.searchParams:this.headers;if(_.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&_.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter((e=>d||!LO.has(e))).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map((e=>e+":"+("host"===e?this.url.host:(this.headers.get(e)||"").replace(/\s+/g," ")))).join("\n"),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&("s3"!==this.service||_.has("X-Amz-Expires")||_.set("X-Amz-Expires","86400"),_.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),_.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),_.set("X-Amz-SignedHeaders",this.signedHeaders)),"s3"===this.service)try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch(e){this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");f||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=GO(this.encodedPath);const v=new Set;this.encodedSearch=[...this.url.searchParams].filter((([e])=>{if(!e)return!1;if("s3"===this.service){if(v.has(e))return!1;v.add(e)}return!0})).map((e=>e.map((e=>GO(encodeURIComponent(e)))))).sort((([e,t],[n,r])=>e<n?-1:e>n?1:t<r?-1:t>r?1:0)).map((e=>e.join("="))).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const r=await NO("AWS4"+this.secretAccessKey,e),i=await NO(r,this.region),s=await NO(i,this.service);n=await NO(s,"aws4_request"),this.cache.set(t,n)}return zO(await NO(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,zO(await jO(await this.canonicalString()))].join("\n")}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+"\n",this.signedHeaders,await this.hexBodyHash()].join("\n")}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||("s3"===this.service&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(null==e){if(this.body&&"string"!=typeof this.body&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=zO(await jO(this.body||""))}return e}}async function NO(e,t){const n=await crypto.subtle.importKey("raw","string"==typeof e?kO.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",n,kO.encode(t))}async function jO(e){return crypto.subtle.digest("SHA-256","string"==typeof e?kO.encode(e):e)}function zO(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("0"+e.toString(16)).slice(-2))).join("")}function GO(e){return e.replace(/[!'()*]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()))}var VO=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};let HO=class extends qt{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[DT],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new FO({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){this.uiConfig?.uiRefresh?.("postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(e){return this.serializeSettings?super.toJSON(e):{type:this.constructor.PluginType}}async onAdded(e){await super.onAdded(e);const n=e.getPlugin(DT);n.actions.exportFile=async(r,i,s)=>{if(!this._connected)return void await n.defaultActions.exportFile(r,i);const o=(0,t.pathJoin)([this.endpointURL,this.pathPrefix,i]),a=await this._fetch(o,{method:"PUT",body:r},s);if(!a.ok)return e.console.error("Error uploading file",a),void await n.defaultActions.exportFile(r,i);this.dispatchEvent({type:"fileUpload",name:i,blob:r,response:a,path:o}),e.console.log("File uploaded",a)}}async _fetch(e,n,r){if(!this._client)throw new Error("Not connected");for(let r=0;r<=this._client.retries;r++){const i=fetch(await this._client.sign(e,n));if(r===this._client.retries)return i;const s=await i;if(s.status<500&&429!==s.status)return s;await(0,t.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,r))}throw new Error("An unknown error occurred, ensure retries is not negative")}};function QO(){MO.use(),BO.use()}async function WO(e,n={}){P_.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>e.container});const r=(0,t.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),i=(0,t.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,t.getUrlQueryParam)("logo-img")&&(i.style.backgroundImage=`url(${(0,t.getUrlQueryParam)("logo-img")})`),i.onclick=()=>{window.open((0,t.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const s='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />\n</svg>';e.container.appendChild(i),P_(i,{placement:"right",content:"Powered by WebGi SDK"});const o=(0,t.createDiv)({innerHTML:s,id:"fsToggle",classList:["round-button"],addToBody:!1});o.dataset.tippyContent="Full-Screen",e.getPlugin(mp)?.addEventListener("enter",(()=>{o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',o.dataset.tippyContent="Exit Full-Screen"})),e.getPlugin(mp)?.addEventListener("exit",(()=>{o.innerHTML=s,o.dataset.tippyContent="Full-Screen"})),o.onclick=()=>{e.getPlugin(mp)?.toggle(e.container)},e.container.appendChild(o),P_(o,{placement:"left"});const a=(0,t.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});e.container.appendChild(a);const l=[{id:"reset-settings",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Reset All Settings",onclick:async()=>{if(!await e.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const t=d.map((t=>e.getPlugin(t)));for(const e of t)await(e?.resetDefaults?.())}},{id:"clear-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n</svg>',tooltip:"Clear Scene",onclick:async()=>{await e.confirm("Clear scene: Are you sure you want to clear the scene?")&&e.scene.disposeSceneModels()}},{id:"fit-scene",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">\n    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />\n</svg>',tooltip:"Fit Object/Scene",onclick:async()=>{await e.fitToView(e.getPlugin(_l)?.getSelectedObject())}},{id:"loop-cam-views",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />\n</svg>',tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{e.getPlugin(Oh)&&(e.getPlugin(Oh).viewLooping=!e.getPlugin(Oh).viewLooping)}},{id:"play-gltf",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>',tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{e.getPlugin(Cl)?.playPauseAnimation()}},{id:"auto-rotate-cc",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">\n <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />\n</svg>',tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const t=e.scene.activeCamera.controls;t&&void 0!==t.autoRotate&&(t.autoRotate=!t.autoRotate)}},{id:"snapshot",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />\n  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />\n</svg>',tooltip:"Capture Snapshot",onclick:async()=>{const t=e.getPlugin(Rc);t?await t.downloadSnapshot():e.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:'<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />\n</svg>',tooltip:"Export GLB",onclick:async()=>{const t=e.getPlugin(Oy);t?await(t?.downloadSceneGlb()):e.console.error("AssetExporterPlugin not added")}}];for(const e of l){const n=(0,t.createDiv)({innerHTML:e.icon,id:e.id,classList:["button-bar-button","util-button"],addToBody:!1});n.dataset.tippyContent=e.tooltip,n.onclick=()=>{e.toggle&&n.classList.toggle("button-bar-selected-box"),e.onclick()},a.appendChild(n)}I_(P_(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const c=e.getPlugin(_l),u=[{title:"Viewer",plugins:[Jk,Zk,ba,go]},{title:"Picking",plugins:[Wk,_l,Tc,L_,cD]},{title:"Scene",plugins:[Gk,Q_,Vk,qk,Xk,Kl,dc,GE]},{title:"Anti-aliasing",plugins:[sa,dp,Kh]},{title:"Post Processing",plugins:[Ro,bE,tp,Lo,Ca,Hh,ec,Qo,Ko,la,kl,gc]},{title:"Export",plugins:[Oy,Rc,UE,HO]},{title:"Animations",plugins:[Cl,Oh,Wh,OT,hk]},{title:"Modifiers",plugins:[qE,eC,uC,KE,xC,eT,op]},{title:"Configurators",plugins:[k_,R_,xp,pD]},{title:"Plugins",plugins:[nc,mp,bl,oa,Lp,ua,ac,Sp,Fl,lp,Pd,hE]},{title:"Extras",plugins:[AO]}];for(const[e,t]of Object.entries(n)){const n=u.find((t=>t.title===e));n?n.plugins.push(...t):u.push({title:e,plugins:[...t]})}let h=u[2],p=[];const d=u.reduce(((e,t)=>e.concat(t.plugins)),[]);function f(n){h=n,c&&(c.enabled=!0),p=[];for(const r of d){const i=e.getPlugin(r);if(!i?.uiConfig)continue;const s=n.plugins.includes(r);(0,t.safeSetProperty)(i.uiConfig,"hidden",!s,!0),s&&p.push(i)}for(const e of u)e.div?.classList[h!==e?"remove":"add"]("mode-button-selected","button-bar-selected");e.getPlugin(zk).refreshPluginsEnabled()}for(const e of u){const n=(0,t.createDiv)({innerHTML:e.title,classList:["mode-button","button-bar-button"]});n.onclick=()=>{f(e)},e.div=n,r.appendChild(n)}f(u[0]),c?.addEventListener("selectedObjectChanged",(()=>{c?.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(h.title)&&f(u.find((e=>e.plugins.includes(_l))))}))}HO.PluginType="AWSClientPlugin1",VO([Oe(),_t("Access Key ID",(e=>({disabled:()=>!e.enabled||e._connected})))],HO.prototype,"accessKeyId",void 0),VO([Oe(),_t("Access Key Secret",(e=>({disabled:()=>!e.enabled||e._connected})))],HO.prototype,"accessKeySecret",void 0),VO([Oe(),_t("Endpoint URL",(e=>({disabled:()=>!e.enabled||e._connected})))],HO.prototype,"endpointURL",void 0),VO([Oe(),_t("Path Prefix",(e=>({disabled:()=>!e.enabled})))],HO.prototype,"pathPrefix",void 0),VO([Oe(),ht("Remember",(e=>({disabled:()=>!e.enabled||e._connected})))],HO.prototype,"serializeSettings",void 0),VO([gt(void 0,(e=>({label:()=>e._connected?"Disconnect":"Connect"})))],HO.prototype,"toggleConnection",void 0),HO=VO([wt("S3 Connection")],HO);var qO=hg({defaultModifiers:[fg,yg,wg,xg]}),XO=__webpackgi_require__(388),YO=__webpackgi_require__.n(XO);function KO(e){const t=[];e.traverse((e=>{e.geometry&&t.push(e)}));const n={},r={};t.forEach((e=>{if(!n[e.geometry.uuid]){const t=e.geometry.toJSON().data,r=t?YO()({a:t.attributes||{},b:t.index||[]}):"";n[e.geometry.uuid]=r}const t=n[e.geometry.uuid],i=r[t]??(r[t]=[]);i.includes(e)||i.push(e)})),Object.values(r).forEach((e=>{if(e.length<2)return;const t=e[0].geometry;e.forEach(((e,n)=>{n<1||(e.geometry.dispose(),e.geometry=t)}))}))}const JO=new n.Pa4,ZO=new n.Pa4,$O=new n.Pa4,eL=new n.Pa4,tL=new n.Pa4,nL=new n.Pa4;let rL=1;const iL=new n.Pa4(0,1,0);class sL extends Tt{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new n.Pa4(0,0,0);const r=this.update;this.update=()=>this._update(r)}_update(e){this.target.add(this.targetOffset),JO.copy(this.object.position).sub(this.target),rL=JO.length(),nL.copy(this.target);const t=e();return nL.sub(this.target),JO.copy(this.object.position).sub(this.target),rL/=JO.length(),this.target.add(nL),this.object.position.copy(this.target).add(JO),JO.normalize(),ZO.crossVectors(iL,JO).normalize(),$O.crossVectors(JO,ZO).normalize(),eL.crossVectors(ZO,$O).normalize().negate(),ZO.length()>.1&&this.object.up.crossVectors(JO.clone().normalize(),ZO),this.enablePan&&(tL.set(0,0,0).addScaledVector(ZO,nL.x).addScaledVector($O,nL.y).addScaledVector(eL,nL.z),this.targetOffset.add(tL),this.targetOffset.multiplyScalar(1/rL)),tL.set(0,0,0).addScaledVector(ZO,-this.targetOffset.x).addScaledVector($O,-this.targetOffset.y).addScaledVector(eL,-this.targetOffset.z),this.object.lookAt(tL.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class oL extends t.SimpleEventDispatcher{_setOptions(e){Object.assign(this._options,e),this._options.mimeType&&"auto"!==this._options.mimeType||(this._options.mimeType=oL.GetSupportedMimeTypes([],["h264"],!0)??oL.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!this._options.mimeType?.startsWith("video/")||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,n){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=e=>{if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const e=new Blob(this._currentRecording,{type:this._options.mimeType});this._recordingCallback?.(e)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=e=>{this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&this._recorder?.pause()},this._onresume=e=>{if(!this.stepMode)return;const n=()=>{"recording"===this._state&&this._recorder?.pause()},r=Math.min(this._resumeSyncTime-(0,t.now)(),0)+1e3/this._options.frameRate;r>0?(0,t.timeout)(r).then(n):n()},this._onpause=e=>{},this._ondataavailable=e=>{e.data&&e.data.size>0&&this._currentRecording.push(e.data)},this._onerror=e=>{this._state="error",this._console.error(e),this.dispatchEvent({type:"error",error:e}),this._recorder=void 0},this._canvas=e;const r=n?.mimeType;this._options={mimeType:r||"auto",frameRate:30,stepMode:!1},this._setOptions(n||this._options)}isRecording(){return"recording"===this._state}start(){if("recording"===this._state)return void this._console.log("Already recording canvas");if("error"===this._state&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return"paused"===this._state?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if("paused"===this._state)return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,e.mimeType?.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const t=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),n=t.getVideoTracks()?.[0];this._track=n,this._recorder=new window.MediaRecorder(t,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",this._recorder?.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then((async e=>{const t=await(e?.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._state="recording",this._onstart({})})).catch((e=>{this._onerror({detail:e})}))}async requestFrame(){if("recording"!==this._state)return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,t.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){"paused"!==this._state&&"stopped"!==this._state&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){"stopped"!==this._state&&("error"!==this._state?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&"error"!==this._state?this.stop((e=>{this._console.warn("disposed with blob",e),this.dispose()})):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const n=await Promise.all(e.map((async([e,t])=>await(await fetch(t)).blob()))),r=[];for(let i=0;i<e.length;i++){const s=await this._imgDirectory.getFileHandle(e[i][0],{create:!0});r.push((0,t.writeFile)(s,n[i]))}await Promise.all(r)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter((t=>!e||e.length<1||e.includes(t))),i=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter((e=>!t||t.length<1||t.includes(e))),s=[];return r.forEach((e=>{const t=`video/${e}`;i.forEach((e=>{[`${t};codecs=${e}`,`${t};codecs:${e}`,`${t};codecs=${e.toUpperCase()}`,`${t};codecs:${e.toUpperCase()}`,`${t}`].forEach((e=>{MediaRecorder.isTypeSupported(e)&&s.push(e)}))}))})),n?s.length>0?s[0]:void 0:s}}class aL extends Oa{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new n.cJO(1,0))}}function lL(e,n){const r=Array.from((e.access??"").split(".")),i=r.pop();let s=e.targetObject??n;if(!i||0===i.length)return{key:void 0,tar:s};if(s=(0,t.deepAccessObject)(r,s),s&&!(i in s))throw console.error("invalid key",i,s,n,e),"";return{key:i,tar:s}}function cL(e,t,n,r){const{key:i,tar:s}=lL(e,t);return i&&s?Th(s,i,(()=>{n&&e.updater?.length&&e.updater.forEach((e=>n[e]())),r?.()})):n=>console.warn("Unable to set ",n,i,s,e,t)}async function uL(e,n,r){const{key:i,tar:s}=lL(n,e),o=n.animSet?[hL(s,n.animSet,r,n.animSetParallel??!1)]:[];if(i&&s){const e=n.updater??[],a=async()=>Ih(s,i,{...n,onUpdate:t=>{n.onUpdate?.(t),e.forEach((e=>r[e]?.()))}});n.delay?o.push((0,t.timeout)(n.delay).then(a)):o.push(a())}else(n.duration||n.delay)&&o.push((0,t.timeout)((n.delay??0)+(n.duration??0)));return 1===o.length?o[0]:Promise.all(o)}async function hL(e,t,n,r=!1){if(r)return Promise.all(t.map((async t=>uL(e,t,n))));for(const r of t)await uL(e,r,n)}function pL(e,n,r,i){if(!e)return;n||(n=[]);const s=i??{},o=e;for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a.uiRef){const t=o?.indexOf(a.uiRef)??-1;t!==e&&(t>=0&&o?.splice(t,1),o?.splice(e,0,a.uiRef))}else{a.uiRef={type:"folder",label:a.name??"Animation "+e,children:[]};const t=[{type:"button",label:"animate",value:()=>{uL(r,a,s).then((()=>console.log(a.uiRef?.label+" finished")))}}];void 0!==a.access&&t.push({type:"input",property:[a,"access"]}),void 0!==a.from&&t.push({type:a.uiObjectType??"input",property:[a,"from"],onChange:()=>{cL(a,r)(a.from),a.updater?.forEach((e=>e in s&&s[e]()))}}),void 0!==a.to&&t.push({type:a.uiObjectType??"input",property:[a,"to"],onChange:()=>{cL(a,r)(a.to),a.updater?.forEach((e=>e in s&&s[e]()))}}),void 0!==a.duration&&t.push({type:"input",property:[a,"duration"]}),a.animSet&&(a.animSetParallel||(a.animSetParallel=!1),t.push({type:"input",label:"run parallel",property:[a,"animSetParallel"]})),a.animSet&&t.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),a.uiRef.children?.push(...t),o?.splice(e,0,a.uiRef)}const l=a.uiRef.children?.map((e=>(0,t.getOrCall)(e))).flat(2).find((e=>e?.animSetContainer));a.animSet&&l&&pL(l.children,a.animSet,a.targetObject??r,i)}}const dL={Background:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map((e=>({path:e})))}).assets,Environment:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map((e=>({path:e})))}).assets,GemEnvironment:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map((e=>({path:e})))}).assets,Ground:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map((e=>({path:e})))}).assets,CameraViews:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map((e=>({path:e})))}).assets,MaterialConfiguration:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map((e=>({path:e})))}).assets,MaterialLibraries:new ov({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map((e=>({path:e})))}).assets};function fL(e,t){return t?e*(1e3/t):0}function mL(e){var t,n=e.from,r=void 0===n?0:n,i=e.velocity,s=void 0===i?0:i,o=e.min,a=e.max,l=e.power,c=void 0===l?.8:l,u=e.timeConstant,h=void 0===u?750:u,p=e.bounceStiffness,d=void 0===p?500:p,f=e.bounceDamping,m=void 0===f?10:f,g=e.restDelta,_=void 0===g?1:g,v=e.modifyTarget,y=e.driver,b=e.onUpdate,A=e.onComplete,w=e.onStop;function x(e){return void 0!==o&&e<o||void 0!==a&&e>a}function E(e){return void 0===o?a:void 0===a||Math.abs(o-e)<Math.abs(a-e)?o:a}function C(e){null==t||t.stop(),t=Sh(Zc(Zc({},e),{driver:y,onUpdate:function(t){var n;null==b||b(t),null===(n=e.onUpdate)||void 0===n||n.call(e,t)},onComplete:A,onStop:w}))}function S(e){C(Zc({type:"spring",stiffness:d,damping:m,restDelta:_},e))}if(x(r))S({from:r,velocity:s,to:E(r)});else{var M=c*s+r;void 0!==v&&(M=v(M));var T,D,I=E(M),P=I===o?-1:1;C({type:"decay",from:r,velocity:s,timeConstant:h,power:c,restDelta:_,modifyTarget:v,onUpdate:x(M)?function(e){T=D,D=e,s=fL(e-T,wh().delta),(1===P&&e>I||-1===P&&e<I)&&S({from:e,to:I,velocity:s})}:void 0})}return{stop:function(){return null==t?void 0:t.stop()}}}var gL=function(e){return 180*e/Math.PI},_L=function(e,t){return void 0===t&&(t=qu),gL(Math.atan2(t.y-e.y,t.x-e.x))},vL=function(e,t){var n=!0;return void 0===t&&(t=e,n=!1),function(r){return n?r-e+t:(e=r,n=!0,t)}},yL=function(e){return e},bL=function(e){return void 0===e&&(e=yL),function(t,n,r){var i=n-r,s=-(0-t+1)*(0-e(Math.abs(i)));return i<=0?n+s:n-s}},AL=bL(),wL=bL(Math.sqrt),xL=function(e){return e*Math.PI/180},EL=function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")},CL=function(e){return EL(e)&&e.hasOwnProperty("z")},SL=function(e,t){return Math.abs(e-t)};function ML(e,t){if(Xu(e)&&Xu(t))return SL(e,t);if(EL(e)&&EL(t)){var n=SL(e.x,t.x),r=SL(e.y,t.y),i=CL(e)&&CL(t)?SL(e.z,t.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2))}}var TL=function(e,t,n){return t=xL(t),{x:n*Math.cos(t)+e.x,y:n*Math.sin(t)+e.y}},DL=function(e,t){return void 0===t&&(t=2),t=Math.pow(10,t),Math.round(e*t)/t},IL=function(e,t,n,r){return void 0===r&&(r=0),DL(e+n*(t-e)/Math.max(r,n))},PL=function(e){void 0===e&&(e=50);var t=0,n=0;return function(r){var i=wh().timestamp,s=i!==n?i-n:0,o=s?IL(t,r,s,e):t;return n=i,t=o,o}},RL=function(e){if("number"==typeof e)return function(t){return Math.round(t/e)*e};var t=0,n=e.length;return function(r){var i=Math.abs(e[0]-r);for(t=1;t<n;t++){var s=e[t],o=Math.abs(s-r);if(0===o)return s;if(o>i)return e[t-1];if(t===n-1)return s;i=o}}};function BL(e,t){return e/(1e3/t)}var kL=function(e,t,n){var r=t-e;return((n-e)%r+r)%r+e},OL=function(e,t){return 1-3*t+3*e},LL=function(e,t){return 3*t-6*e},FL=function(e){return 3*e},UL=function(e,t,n){return((OL(t,n)*e+LL(t,n))*e+FL(t))*e},NL=function(e,t,n){return 3*OL(t,n)*e*e+2*LL(t,n)*e+FL(t)},jL=1e-7,zL=10,GL=8,VL=.001,HL=11,QL=1/(HL-1);function WL(e,t,n,r){if(e===t&&n===r)return Uc;for(var i=new Float32Array(HL),s=0;s<HL;++s)i[s]=UL(s*QL,e,n);return function(s){return 0===s||1===s?s:UL(function(t){for(var r=0,s=1,o=HL-1;s!==o&&i[s]<=t;++s)r+=QL;--s;var a=r+(t-i[s])/(i[s+1]-i[s])*QL,l=NL(a,e,n);return l>=VL?function(e,t,n,r){for(var i=0;i<GL;++i){var s=NL(t,n,r);if(0===s)return t;t-=(UL(t,n,r)-e)/s}return t}(t,a,e,n):0===l?a:function(e,t,n,r,i){var s,o,a=0;do{(s=UL(o=t+(n-t)/2,r,i)-e)>0?n=o:t=o}while(Math.abs(s)>jL&&++a<zL);return o}(t,r,r+QL,e,n)}(s),t,r)}}var qL=function(e,t){return void 0===t&&(t="end"),function(n){var r=(n="end"===t?Math.min(n,.999):Math.max(n,.001))*e,i="end"===t?Math.floor(r):Math.ceil(r);return nu(0,1,i/e)}};class XL extends yo{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,QO()}async setupUi(e){await WO(this,e),this._editorInitialized=!0}}async function YL(e,{debug:n=!1,ground:r=!0,bloom:i=!0,depthTonemap:s=!1,importPopup:o=!0,caching:a=!0}){e.enabled=!1,n&&await e.addPlugin(Rd),e.getPlugin(fo)||await e.addPlugin(fo,void 0,void 0,{storage:a&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await e.addPlugin(Oy),await e.addPlugin(kx),await e.addPlugin(DT),o&&await e.addPlugin(Pd),await e.addPlugin(Ed,!1),await e.addPlugin(bO),await e.addPlugin(Tv),await e.addPlugin(nC),await e.addPlugin(go),await e.addPlugin(hk),await e.addPlugin(_l,La,!1,!0),await rv(e,{ground:r,bloom:i,depthTonemap:s}),await e.addPlugin(bE),await e.addPlugin(KE,!1),await e.addPlugin(uT),await e.addPlugin(_T),await e.addPlugin(ST),await e.addPlugin(hE,!1),await e.addPlugin(qE),await e.addPlugin(eC),await e.addPlugin(uC),await e.addPlugin(R_),await e.addPlugin(k_),await e.addPlugin(pD),await e.addPlugin(L_),await e.addPlugin(UE),await e.addPlugin(Rc),await e.addPlugin(Wk),await e.addPlugin(Vk),await e.addPlugin(qk),await e.addPlugin(Xk),await e.addPlugin(Jk),await e.addPlugin(Zk),await e.addPlugin(Gk),await e.addPlugin(cD),await e.addPlugin(OT,e.container,!1),await e.addPlugin(HO);const l=await e.addPlugin(new zk(!(0,t.mobileAndTabletCheck)()));return e.renderer.refreshPipeline(),e.scene.addEventListener("textureAdded",(t=>{t.texture&&e.scene.setEnvironment(t.texture)})),l.setupPluginUi(mp),l.setupPluginUi(Jk),l.setupPluginUi(Zk),l.setupPluginUi(go),l.setupPluginUi(Gk),l.setupPluginUi(Oy),l.setupPluginUi(Cl),l.setupPluginUi(Kl),l.setupPluginUi(k_),l.setupPluginUi(R_),l.setupPluginUi(hk),l.setupPluginUi(Wk),l.setupPluginUi(L_),l.setupPluginUi(Tc),l.setupPluginUi(_l),r&&l.setupPluginUi(Q_),r&&l.setupPluginUi(GE),l.setupPluginUi(ec),l.setupPluginUi(Oh),l.setupPluginUi(UE),l.setupPluginUi(Ro),l.setupPluginUi(bE),l.setupPluginUi(Lo),l.setupPluginUi(Ca),l.setupPluginUi(tp),l.setupPluginUi(Hh),l.setupPluginUi(la),l.setupPluginUi(Qo),l.setupPluginUi(Fl),l.setupPluginUi(Sp),l.setupPluginUi(Vk),l.setupPluginUi(qE),l.setupPluginUi(eC),l.setupPluginUi(sa),l.setupPluginUi(qk),l.setupPluginUi(Xk),l.setupPluginUi(ua),l.setupPluginUi(ac),l.setupPluginUi(lp),i&&l.setupPluginUi(Ko),l.setupPluginUi(Rc),l.setupPluginUi(nc),l.setupPluginUi(dp),l.setupPluginUi(dc),l.setupPluginUi(kl),l.setupPluginUi(gc),l.setupPluginUi(uC),l.setupPluginUi(oa),l.setupPluginUi(Kh),l.setupPluginUi(ba),l.setupPluginUi(xp),l.setupPluginUi(bl),l.setupPluginUi(KE),l.setupPluginUi(Pd),l.setupPluginUi(Wh),l.setupPluginUi(hE),l.setupPluginUi(HO),l.setupPluginUi(OT),l.setupPluginUi(cD),l.setupPluginUi(pD),l.setupPluginUi(op),e.enabled=!0,e}async function KL(e,{debug:t=!1,ground:n=!0,bloom:r=!0,depthTonemap:i=!1,importPopup:s=!0,caching:o=!0}){const a=new yo(e);return await YL(a,{debug:t,ground:n,bloom:r,depthTonemap:i,importPopup:s,caching:o}),a}async function JL(e,{debug:t=!1,ground:n=!0,bloom:r=!0,depthTonemap:i=!0,importPopup:s=!1,enableDrop:o=!1,caching:a=!0}={}){const l=new yo(e);return t&&await l.addPlugin(Rd),l.getPlugin(fo)||l.addPluginSync(fo,void 0,void 0,{storage:a&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await l.addPlugin(Ed,!0),await rv(l,{ground:n,bloom:r,depthTonemap:i,enableDrop:o,importPopup:s}),l}}();var __webpackgi_exports__AAssetManagerProcessStatePlugin=__webpackgi_exports__.MWW,__webpackgi_exports__ACESFilmicToneMapping=__webpackgi_exports__.LY2,__webpackgi_exports__ACameraControlsPlugin=__webpackgi_exports__.GYo,__webpackgi_exports__ACanvasRecorder=__webpackgi_exports__.GPz,__webpackgi_exports__AMaterialManager=__webpackgi_exports__.HRj,__webpackgi_exports__ARPlacementBox=__webpackgi_exports__.li4,__webpackgi_exports__ARPlugin=__webpackgi_exports__.FO5,__webpackgi_exports__ARTouchInputHelper=__webpackgi_exports__.Nlh,__webpackgi_exports__AShaderMaterial2=__webpackgi_exports__.Mp4,__webpackgi_exports__AViewerPlugin=__webpackgi_exports__.QvI,__webpackgi_exports__AWSClientPlugin=__webpackgi_exports__.PrA,__webpackgi_exports__AddBlendPass=__webpackgi_exports__.JHp,__webpackgi_exports__AddEquation=__webpackgi_exports__.bGH,__webpackgi_exports__AddOperation=__webpackgi_exports__.NDo,__webpackgi_exports__AdditiveAnimationBlendMode=__webpackgi_exports__.gSk,__webpackgi_exports__AdditiveBlending=__webpackgi_exports__.WMw,__webpackgi_exports__AlphaFormat=__webpackgi_exports__.OTo,__webpackgi_exports__AlwaysDepth=__webpackgi_exports__.Se2,__webpackgi_exports__AlwaysStencilFunc=__webpackgi_exports__.cum,__webpackgi_exports__AmbientLight=__webpackgi_exports__.Mig,__webpackgi_exports__AmbientLight2=__webpackgi_exports__.B$7,__webpackgi_exports__AmbientLightProbe=__webpackgi_exports__.i_9,__webpackgi_exports__AnimationAction=__webpackgi_exports__.bBp,__webpackgi_exports__AnimationClip=__webpackgi_exports__.m7l,__webpackgi_exports__AnimationLoader=__webpackgi_exports__.sYA,__webpackgi_exports__AnimationMixer=__webpackgi_exports__.Xcj,__webpackgi_exports__AnimationObjectGroup=__webpackgi_exports__.mzJ,__webpackgi_exports__AnimationUtils=__webpackgi_exports__.ZZA,__webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.$Ph,__webpackgi_exports__ArcCurve=__webpackgi_exports__.T__,__webpackgi_exports__ArrayCamera=__webpackgi_exports__.HkE,__webpackgi_exports__ArrowHelper=__webpackgi_exports__.tGC,__webpackgi_exports__AssetExporter=__webpackgi_exports__.g1S,__webpackgi_exports__AssetExporterPlugin=__webpackgi_exports__.I$C,__webpackgi_exports__AssetImporter=__webpackgi_exports__.QIH,__webpackgi_exports__AssetManagerBasicPopupPlugin=__webpackgi_exports__._JE,__webpackgi_exports__AssetManagerLoadingBarPlugin=__webpackgi_exports__.SwW,__webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm,__webpackgi_exports__AsyncCompress=__webpackgi_exports__.jl_,__webpackgi_exports__AsyncDecompress=__webpackgi_exports__.b7R,__webpackgi_exports__AsyncDeflate=__webpackgi_exports__.BDV,__webpackgi_exports__AsyncGunzip=__webpackgi_exports__.Ea_,__webpackgi_exports__AsyncGzip=__webpackgi_exports__.qff,__webpackgi_exports__AsyncInflate=__webpackgi_exports__.tmC,__webpackgi_exports__AsyncUnzipInflate=__webpackgi_exports__.BON,__webpackgi_exports__AsyncUnzlib=__webpackgi_exports__.P40,__webpackgi_exports__AsyncZipDeflate=__webpackgi_exports__.wLL,__webpackgi_exports__AsyncZlib=__webpackgi_exports__.iHO,__webpackgi_exports__Audio=__webpackgi_exports__.BbS,__webpackgi_exports__AudioAnalyser=__webpackgi_exports__.kqm,__webpackgi_exports__AudioContext=__webpackgi_exports__.Hmr,__webpackgi_exports__AudioListener=__webpackgi_exports__.SJI,__webpackgi_exports__AudioLoader=__webpackgi_exports__.mTL,__webpackgi_exports__AxesHelper=__webpackgi_exports__.y8_,__webpackgi_exports__BackSide=__webpackgi_exports__._Li,__webpackgi_exports__BackgroundPresetGroup=__webpackgi_exports__.w7U,__webpackgi_exports__BaseGroundPlugin=__webpackgi_exports__.g56,__webpackgi_exports__BaseRenderer=__webpackgi_exports__.bj3,__webpackgi_exports__BasicDepthPacking=__webpackgi_exports__.z81,__webpackgi_exports__BasicShadowMap=__webpackgi_exports__._MY,__webpackgi_exports__BlobLoader=__webpackgi_exports__.yEv,__webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ,__webpackgi_exports__Bone=__webpackgi_exports__.N$j,__webpackgi_exports__BooleanKeyframeTrack=__webpackgi_exports__._YM,__webpackgi_exports__Box2=__webpackgi_exports__.TUj,__webpackgi_exports__Box3=__webpackgi_exports__.ZzF,__webpackgi_exports__Box3B=__webpackgi_exports__.qzb,__webpackgi_exports__Box3Helper=__webpackgi_exports__.GQ,__webpackgi_exports__BoxBufferGeometry=__webpackgi_exports__.nvb,__webpackgi_exports__BoxGeometry=__webpackgi_exports__.DvJ,__webpackgi_exports__BoxHelper=__webpackgi_exports__.fQA,__webpackgi_exports__BoxSelectionWidget=__webpackgi_exports__.cPz,__webpackgi_exports__BufferAttribute=__webpackgi_exports__.TlE,__webpackgi_exports__BufferGeometry=__webpackgi_exports__.u9r,__webpackgi_exports__BufferGeometryLoader=__webpackgi_exports__.s4_,__webpackgi_exports__ByteType=__webpackgi_exports__.T95,__webpackgi_exports__CSGPluginBSP=__webpackgi_exports__.F5w,__webpackgi_exports__CSGPluginBVH=__webpackgi_exports__.NlP,__webpackgi_exports__CSGPluginBase=__webpackgi_exports__.$8Z,__webpackgi_exports__CSS3DRendererPlugin=__webpackgi_exports__.YYN,__webpackgi_exports__Cache=__webpackgi_exports__.CtF,__webpackgi_exports__Camera=__webpackgi_exports__.V1s,__webpackgi_exports__CameraController=__webpackgi_exports__.jOv,__webpackgi_exports__CameraHelper=__webpackgi_exports__.Rki,__webpackgi_exports__CameraUiPlugin=__webpackgi_exports__.pzV,__webpackgi_exports__CameraView=__webpackgi_exports__.itZ,__webpackgi_exports__CameraViewControlPlugin=__webpackgi_exports__.MMq,__webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx,__webpackgi_exports__CannonPhysicsPlugin=__webpackgi_exports__.Hmi,__webpackgi_exports__CanvasMediaRecorder=__webpackgi_exports__.X4S,__webpackgi_exports__CanvasRecorder=__webpackgi_exports__.vlJ,__webpackgi_exports__CanvasRecorderPlugin=__webpackgi_exports__.nPO,__webpackgi_exports__CanvasSnipper=__webpackgi_exports__.zcQ,__webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.GH1,__webpackgi_exports__CanvasTexture=__webpackgi_exports__.ROQ,__webpackgi_exports__CapsuleBufferGeometry=__webpackgi_exports__.YN5,__webpackgi_exports__CapsuleGeometry=__webpackgi_exports__.BVQ,__webpackgi_exports__CatmullRomCurve3=__webpackgi_exports__.YT8,__webpackgi_exports__ChromaticAberrationPlugin=__webpackgi_exports__._DE,__webpackgi_exports__CineonToneMapping=__webpackgi_exports__.YGz,__webpackgi_exports__CircleBufferGeometry=__webpackgi_exports__.trn,__webpackgi_exports__CircleGeometry=__webpackgi_exports__.zf8,__webpackgi_exports__ClampToEdgeWrapping=__webpackgi_exports__.uWy,__webpackgi_exports__ClearcoatTintPlugin=__webpackgi_exports__.wYQ,__webpackgi_exports__Clock=__webpackgi_exports__.SUY,__webpackgi_exports__Color=__webpackgi_exports__.Ilk,__webpackgi_exports__ColorKeyframeTrack=__webpackgi_exports__.R2R,__webpackgi_exports__ColorManagement=__webpackgi_exports__.epp,__webpackgi_exports__CombinedPostPlugin=__webpackgi_exports__.xmJ,__webpackgi_exports__Compress=__webpackgi_exports__.GD$,__webpackgi_exports__CompressedArrayTexture=__webpackgi_exports__.Z_g,__webpackgi_exports__CompressedTexture=__webpackgi_exports__.EB7,__webpackgi_exports__CompressedTextureLoader=__webpackgi_exports__.DqL,__webpackgi_exports__ConeBufferGeometry=__webpackgi_exports__._3,__webpackgi_exports__ConeGeometry=__webpackgi_exports__.b_z,__webpackgi_exports__ContactShadowGroundPlugin=__webpackgi_exports__.OCn,__webpackgi_exports__CoreEditorApp=__webpackgi_exports__.N_j,__webpackgi_exports__CoreViewerApp=__webpackgi_exports__.hNv,__webpackgi_exports__CubeCamera=__webpackgi_exports__._am,__webpackgi_exports__CubeNormalsCaptureHelper=__webpackgi_exports__.kB7,__webpackgi_exports__CubeReflectionMapping=__webpackgi_exports__.fY$,__webpackgi_exports__CubeRefractionMapping=__webpackgi_exports__.vxC,__webpackgi_exports__CubeTexture=__webpackgi_exports__.BtG,__webpackgi_exports__CubeTextureLoader=__webpackgi_exports__.cBK,__webpackgi_exports__CubeUVReflectionMapping=__webpackgi_exports__.g8_,__webpackgi_exports__CubicBezierCurve=__webpackgi_exports__.AXT,__webpackgi_exports__CubicBezierCurve3=__webpackgi_exports__.yj7,__webpackgi_exports__CubicInterpolant=__webpackgi_exports__.dYG,__webpackgi_exports__CullFaceBack=__webpackgi_exports__.tm_,__webpackgi_exports__CullFaceFront=__webpackgi_exports__.S2y,__webpackgi_exports__CullFaceFrontBack=__webpackgi_exports__.B02,__webpackgi_exports__CullFaceNone=__webpackgi_exports__.PeU,__webpackgi_exports__Curve=__webpackgi_exports__.Hyl,__webpackgi_exports__CurvePath=__webpackgi_exports__.Wqd,__webpackgi_exports__CustomAnimationHelper=__webpackgi_exports__.c0Q,__webpackgi_exports__CustomAnimationHelperPlugin=__webpackgi_exports__.re0,__webpackgi_exports__CustomBlending=__webpackgi_exports__.Xaj,__webpackgi_exports__CustomBumpMapPlugin=__webpackgi_exports__.DUb,__webpackgi_exports__CustomToneMapping=__webpackgi_exports__.dZ3,__webpackgi_exports__CylinderBufferGeometry=__webpackgi_exports__.m_w,__webpackgi_exports__CylinderGeometry=__webpackgi_exports__.fHI,__webpackgi_exports__Cylindrical=__webpackgi_exports__.LBq,__webpackgi_exports__DRACOLoader2=__webpackgi_exports__.Qww,__webpackgi_exports__Damper=__webpackgi_exports__.CGV,__webpackgi_exports__Data3DTexture=__webpackgi_exports__.JUT,__webpackgi_exports__DataArrayTexture=__webpackgi_exports__.p3g,__webpackgi_exports__DataTexture=__webpackgi_exports__.IEO,__webpackgi_exports__DataTextureLoader=__webpackgi_exports__.yxD,__webpackgi_exports__DataUrlLoader=__webpackgi_exports__.CUS,__webpackgi_exports__DataUtils=__webpackgi_exports__.A5E,__webpackgi_exports__DebugPlugin=__webpackgi_exports__.zqG,__webpackgi_exports__DecodeUTF8=__webpackgi_exports__.PfX,__webpackgi_exports__Decompress=__webpackgi_exports__.Q1o,__webpackgi_exports__DecrementStencilOp=__webpackgi_exports__.jfJ,__webpackgi_exports__DecrementWrapStencilOp=__webpackgi_exports__.T_J,__webpackgi_exports__DefaultLoadingManager=__webpackgi_exports__.tEQ,__webpackgi_exports__Deflate=__webpackgi_exports__.gb4,__webpackgi_exports__DepthFormat=__webpackgi_exports__.qkB,__webpackgi_exports__DepthOfFieldPass=__webpackgi_exports__.cvk,__webpackgi_exports__DepthOfFieldPlugin=__webpackgi_exports__.HWo,__webpackgi_exports__DepthStencilFormat=__webpackgi_exports__.brP,__webpackgi_exports__DepthTexture=__webpackgi_exports__.$YQ,__webpackgi_exports__DeviceOrientationControls2=__webpackgi_exports__.X8d,__webpackgi_exports__DeviceOrientationControlsPlugin=__webpackgi_exports__.Zdt,__webpackgi_exports__DiamondMaterial=__webpackgi_exports__.yNB,__webpackgi_exports__DiamondPlugin=__webpackgi_exports__.h7x,__webpackgi_exports__DirectionalLight=__webpackgi_exports__.Ox3,__webpackgi_exports__DirectionalLight2=__webpackgi_exports__.qtn,__webpackgi_exports__DirectionalLightHelper=__webpackgi_exports__.cBI,__webpackgi_exports__DiscreteInterpolant=__webpackgi_exports__.cU9,__webpackgi_exports__DisplayP3ColorSpace=__webpackgi_exports__.ntt,__webpackgi_exports__DodecahedronBufferGeometry=__webpackgi_exports__.DT1,__webpackgi_exports__DodecahedronGeometry=__webpackgi_exports__.Kgo,__webpackgi_exports__DoubleSide=__webpackgi_exports__.ehD,__webpackgi_exports__Dropzone=__webpackgi_exports__.fhJ,__webpackgi_exports__DropzonePlugin=__webpackgi_exports__.y1s,__webpackgi_exports__DstAlphaFactor=__webpackgi_exports__.fSK,__webpackgi_exports__DstColorFactor=__webpackgi_exports__.Vdb,__webpackgi_exports__DynamicCopyUsage=__webpackgi_exports__.l8J,__webpackgi_exports__DynamicDrawUsage=__webpackgi_exports__.dj0,__webpackgi_exports__DynamicReadUsage=__webpackgi_exports__.QM0,__webpackgi_exports__EXRExporter2=__webpackgi_exports__.n94,__webpackgi_exports__EXRLoadPlugin=__webpackgi_exports__.OIS,__webpackgi_exports__EasingFunctions=__webpackgi_exports__.q8b,__webpackgi_exports__EdgesGeometry=__webpackgi_exports__.TOt,__webpackgi_exports__EffectComposer2=__webpackgi_exports__.xaN,__webpackgi_exports__EllipseCurve=__webpackgi_exports__.Ny0,__webpackgi_exports__EllipseCurve3D=__webpackgi_exports__.NeD,__webpackgi_exports__EncodeUTF8=__webpackgi_exports__.Zof,__webpackgi_exports__EncoderMethod=__webpackgi_exports__.N1Y,__webpackgi_exports__EnvironmentPresetGroup=__webpackgi_exports__.itK,__webpackgi_exports__EqualDepth=__webpackgi_exports__.eD,__webpackgi_exports__EqualStencilFunc=__webpackgi_exports__.jwo,__webpackgi_exports__EquirectangularReflectionMapping=__webpackgi_exports__.dSO,__webpackgi_exports__EquirectangularRefractionMapping=__webpackgi_exports__.Bf4,__webpackgi_exports__Euler=__webpackgi_exports__.USm,__webpackgi_exports__EventDispatcher=__webpackgi_exports__.pBf,__webpackgi_exports__ExtrasUiPlugin=__webpackgi_exports__.eBg,__webpackgi_exports__ExtrudeBufferGeometry=__webpackgi_exports__.$Vf,__webpackgi_exports__ExtrudeGeometry=__webpackgi_exports__.O7d,__webpackgi_exports__FBXLoadPlugin=__webpackgi_exports__.ksq,__webpackgi_exports__FFMPEGRecorder=__webpackgi_exports__.hFL,__webpackgi_exports__FSShadowMaterial=__webpackgi_exports__.gXf,__webpackgi_exports__FileLoader=__webpackgi_exports__.hH6,__webpackgi_exports__FileTransferPlugin=__webpackgi_exports__.izP,__webpackgi_exports__FilmicGrainPlugin=__webpackgi_exports__.kpi,__webpackgi_exports__FirstPersonControls2=__webpackgi_exports__.DwZ,__webpackgi_exports__FirstPersonControlsPlugin=__webpackgi_exports__.kN3,__webpackgi_exports__Float16BufferAttribute=__webpackgi_exports__.e62,__webpackgi_exports__Float32BufferAttribute=__webpackgi_exports__.a$l,__webpackgi_exports__Float64BufferAttribute=__webpackgi_exports__.OM3,__webpackgi_exports__FloatType=__webpackgi_exports__.VzW,__webpackgi_exports__Fog=__webpackgi_exports__.ybr,__webpackgi_exports__FogExp2=__webpackgi_exports__.yo9,__webpackgi_exports__FragmentClippingExtensionPlugin=__webpackgi_exports__.Dzq,__webpackgi_exports__FragmentClippingMode=__webpackgi_exports__.zCA,__webpackgi_exports__FrameFadePlugin=__webpackgi_exports__.$Bt,__webpackgi_exports__FramebufferTexture=__webpackgi_exports__.Wzm,__webpackgi_exports__FrontSide=__webpackgi_exports__.Wl3,__webpackgi_exports__Frustum=__webpackgi_exports__.iWj,__webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.DNz,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M,__webpackgi_exports__GLBufferAttribute=__webpackgi_exports__.ylh,__webpackgi_exports__GLSL1=__webpackgi_exports__.v9Y,__webpackgi_exports__GLSL3=__webpackgi_exports__.LSk,__webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.LHE,__webpackgi_exports__GLTFDracoExportPlugin=__webpackgi_exports__.KE0,__webpackgi_exports__GLTFDracoExporter=__webpackgi_exports__.KCF,__webpackgi_exports__GLTFExporter2=__webpackgi_exports__.a4n,__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.NKC,__webpackgi_exports__GLTFKHRMaterialVariantsPlugin=__webpackgi_exports__.jrv,__webpackgi_exports__GLTFLoader2=__webpackgi_exports__.zIH,__webpackgi_exports__GLTFMaterialsAlphaMapExtensionName=__webpackgi_exports__.Hfk,__webpackgi_exports__GLTFMaterialsBumpMapExtensionName=__webpackgi_exports__.png,__webpackgi_exports__GLTFMaterialsDisplacementMapExtensionName=__webpackgi_exports__.tAj,__webpackgi_exports__GLTFMaterialsLightMapExtensionName=__webpackgi_exports__.Eb_,__webpackgi_exports__GLTFMaterialsVariantsExtensionImport=__webpackgi_exports__.SJj,__webpackgi_exports__GLTFMeshGpuInstancingExporter=__webpackgi_exports__.cF0,__webpackgi_exports__GLTFMeshOptPlugin=__webpackgi_exports__.BT2,__webpackgi_exports__GLTFWriter2=__webpackgi_exports__._8p,__webpackgi_exports__GammaCorrectionExtension=__webpackgi_exports__.V5Z,__webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b,__webpackgi_exports__GemEnvironmentPresetGroup=__webpackgi_exports__.BHZ,__webpackgi_exports__GenericBlendTexturePass=__webpackgi_exports__.hkn,__webpackgi_exports__GenericFilterPlugin=__webpackgi_exports__.GFY,__webpackgi_exports__GreaterDepth=__webpackgi_exports__.w$m,__webpackgi_exports__GreaterEqualDepth=__webpackgi_exports__.ksN,__webpackgi_exports__GreaterEqualStencilFunc=__webpackgi_exports__.j4z,__webpackgi_exports__GreaterStencilFunc=__webpackgi_exports__.OAl,__webpackgi_exports__GridHelper=__webpackgi_exports__.VLJ,__webpackgi_exports__GroundPlugin=__webpackgi_exports__.C73,__webpackgi_exports__Group=__webpackgi_exports__.ZAu,__webpackgi_exports__Gunzip=__webpackgi_exports__.ibP,__webpackgi_exports__GyroInputDevice=__webpackgi_exports__.lth,__webpackgi_exports__Gzip=__webpackgi_exports__._fI,__webpackgi_exports__HDRiGroundPlugin=__webpackgi_exports__.hUN,__webpackgi_exports__HalfFloatType=__webpackgi_exports__.cLu,__webpackgi_exports__HemisphereLight=__webpackgi_exports__.vmT,__webpackgi_exports__HemisphereLightHelper=__webpackgi_exports__.Qpg,__webpackgi_exports__HemisphereLightProbe=__webpackgi_exports__.So8,__webpackgi_exports__HierarchyUiPlugin=__webpackgi_exports__.eOv,__webpackgi_exports__IcosahedronBufferGeometry=__webpackgi_exports__.Wjw,__webpackgi_exports__IcosahedronGeometry=__webpackgi_exports__.cJO,__webpackgi_exports__ImageBitmapLoader=__webpackgi_exports__.QRU,__webpackgi_exports__ImageLoader=__webpackgi_exports__.S3k,__webpackgi_exports__ImageSequenceRecorder=__webpackgi_exports__.OPJ,__webpackgi_exports__ImageUtils=__webpackgi_exports__.PpQ,__webpackgi_exports__Importer=__webpackgi_exports__.q_9,__webpackgi_exports__IncrementStencilOp=__webpackgi_exports__.ZRs,__webpackgi_exports__IncrementWrapStencilOp=__webpackgi_exports__.oqc,__webpackgi_exports__Inflate=__webpackgi_exports__.T_x,__webpackgi_exports__InstancedBufferAttribute=__webpackgi_exports__.lb7,__webpackgi_exports__InstancedBufferGeometry=__webpackgi_exports__.L5s,__webpackgi_exports__InstancedInterleavedBuffer=__webpackgi_exports__.$TI,__webpackgi_exports__InstancedMesh=__webpackgi_exports__.SPe,__webpackgi_exports__Int16BufferAttribute=__webpackgi_exports__.aVm,__webpackgi_exports__Int32BufferAttribute=__webpackgi_exports__.j87,__webpackgi_exports__Int8BufferAttribute=__webpackgi_exports__.RNb,__webpackgi_exports__IntType=__webpackgi_exports__.Kz5,__webpackgi_exports__InterleavedBuffer=__webpackgi_exports__.vpT,__webpackgi_exports__InterleavedBufferAttribute=__webpackgi_exports__.kB5,__webpackgi_exports__Interpolant=__webpackgi_exports__._C8,__webpackgi_exports__InterpolateDiscrete=__webpackgi_exports__.Syv,__webpackgi_exports__InterpolateLinear=__webpackgi_exports__.NMF,__webpackgi_exports__InterpolateSmooth=__webpackgi_exports__.pIN,__webpackgi_exports__InvertStencilOp=__webpackgi_exports__.eMJ,__webpackgi_exports__KHR_TEXTURE_BASISU=__webpackgi_exports__.rN7,__webpackgi_exports__KTX2LoadPlugin=__webpackgi_exports__.iUp,__webpackgi_exports__KTXLoadPlugin=__webpackgi_exports__.GFd,__webpackgi_exports__KeepStencilOp=__webpackgi_exports__.x5V,__webpackgi_exports__KeyframeTrack=__webpackgi_exports__.tUh,__webpackgi_exports__LOD=__webpackgi_exports__.z8B,__webpackgi_exports__LUTPlugin=__webpackgi_exports__.vcl,__webpackgi_exports__LatheBufferGeometry=__webpackgi_exports__.GZb,__webpackgi_exports__LatheGeometry=__webpackgi_exports__.p7y,__webpackgi_exports__Layers=__webpackgi_exports__.S9g,__webpackgi_exports__LessDepth=__webpackgi_exports__.Zr5,__webpackgi_exports__LessEqualDepth=__webpackgi_exports__.vCF,__webpackgi_exports__LessEqualStencilFunc=__webpackgi_exports__.yt0,__webpackgi_exports__LessStencilFunc=__webpackgi_exports__.uXU,__webpackgi_exports__Light=__webpackgi_exports__._kC,__webpackgi_exports__LightProbe=__webpackgi_exports__.lk7,__webpackgi_exports__LightsUiPlugin=__webpackgi_exports__.USc,__webpackgi_exports__Line=__webpackgi_exports__.x12,__webpackgi_exports__Line2=__webpackgi_exports__.w_R,__webpackgi_exports__Line3=__webpackgi_exports__.Zzh,__webpackgi_exports__LineBasicMaterial=__webpackgi_exports__.nls,__webpackgi_exports__LineCurve=__webpackgi_exports__.g_z,__webpackgi_exports__LineCurve3=__webpackgi_exports__.U7,__webpackgi_exports__LineDashedMaterial=__webpackgi_exports__.FT0,__webpackgi_exports__LineGeometry=__webpackgi_exports__.L1_,__webpackgi_exports__LineLoop=__webpackgi_exports__.blk,__webpackgi_exports__LineMaterial=__webpackgi_exports__.YRm,__webpackgi_exports__LineSegments=__webpackgi_exports__.ejS,__webpackgi_exports__LineSegments2=__webpackgi_exports__.wUb,__webpackgi_exports__LineSegmentsGeometry=__webpackgi_exports__.zOz,__webpackgi_exports__LinearEncoding=__webpackgi_exports__.rnI,__webpackgi_exports__LinearFilter=__webpackgi_exports__.wem,__webpackgi_exports__LinearInterpolant=__webpackgi_exports__.lfu,__webpackgi_exports__LinearMipMapLinearFilter=__webpackgi_exports__.FDw,__webpackgi_exports__LinearMipMapNearestFilter=__webpackgi_exports__.lRj,__webpackgi_exports__LinearMipmapLinearFilter=__webpackgi_exports__.D1R,__webpackgi_exports__LinearMipmapNearestFilter=__webpackgi_exports__.qyh,__webpackgi_exports__LinearSRGBColorSpace=__webpackgi_exports__.GUF,__webpackgi_exports__LinearToneMapping=__webpackgi_exports__.EoG,__webpackgi_exports__Loader=__webpackgi_exports__.aNw,__webpackgi_exports__LoaderUtils=__webpackgi_exports__.Zp0,__webpackgi_exports__LoadingManager=__webpackgi_exports__.lLk,__webpackgi_exports__LoopOnce=__webpackgi_exports__.jAl,__webpackgi_exports__LoopPingPong=__webpackgi_exports__.uEv,__webpackgi_exports__LoopRepeat=__webpackgi_exports__.YKA,__webpackgi_exports__LuminanceAlphaFormat=__webpackgi_exports__.cRx,__webpackgi_exports__LuminanceFormat=__webpackgi_exports__.Y8D,__webpackgi_exports__MOUSE=__webpackgi_exports__.RsA,__webpackgi_exports__MTLLoader2=__webpackgi_exports__.Y0m,__webpackgi_exports__Material=__webpackgi_exports__.F5T,__webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.EDU,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q,__webpackgi_exports__MaterialExtender=__webpackgi_exports__.KA8,__webpackgi_exports__MaterialLibPresetGroupPresetGroup=__webpackgi_exports__.ZqF,__webpackgi_exports__MaterialLibraryBasePlugin=__webpackgi_exports__.XUj,__webpackgi_exports__MaterialLibraryPlugin=__webpackgi_exports__.Me$,__webpackgi_exports__MaterialLoader=__webpackgi_exports__.u7G,__webpackgi_exports__MaterialManager=__webpackgi_exports__.PEk,__webpackgi_exports__MaterialPreviewGenerator=__webpackgi_exports__.BG4,__webpackgi_exports__MathUtils=__webpackgi_exports__.M8C,__webpackgi_exports__Matrix3=__webpackgi_exports__.Vkp,__webpackgi_exports__Matrix4=__webpackgi_exports__.yGw,__webpackgi_exports__MaxEquation=__webpackgi_exports__.Sm8,__webpackgi_exports__Mesh=__webpackgi_exports__.Kj0,__webpackgi_exports__MeshBasicMaterial=__webpackgi_exports__.vBJ,__webpackgi_exports__MeshBasicMaterial2=__webpackgi_exports__.QfV,__webpackgi_exports__MeshDepthMaterial=__webpackgi_exports__.lRF,__webpackgi_exports__MeshDistanceMaterial=__webpackgi_exports__.Lun,__webpackgi_exports__MeshLambertMaterial=__webpackgi_exports__.YBo,__webpackgi_exports__MeshMatcapMaterial=__webpackgi_exports__.kaV,__webpackgi_exports__MeshNormalMaterial=__webpackgi_exports__.RSm,__webpackgi_exports__MeshPhongMaterial=__webpackgi_exports__.xoR,__webpackgi_exports__MeshPhysicalMaterial=__webpackgi_exports__.EJi,__webpackgi_exports__MeshStandardMaterial=__webpackgi_exports__.Wid,__webpackgi_exports__MeshStandardMaterial2=__webpackgi_exports__.iuj,__webpackgi_exports__MeshToonMaterial=__webpackgi_exports__.IKL,__webpackgi_exports__MinEquation=__webpackgi_exports__.r_,__webpackgi_exports__MirroredRepeatWrapping=__webpackgi_exports__.OoA,__webpackgi_exports__MixOperation=__webpackgi_exports__.qhX,__webpackgi_exports__MouseInputDevice=__webpackgi_exports__.CRe,__webpackgi_exports__MultiFilterPlugin=__webpackgi_exports__.qPT,__webpackgi_exports__MultiplyBlending=__webpackgi_exports__.M5h,__webpackgi_exports__MultiplyOperation=__webpackgi_exports__.Ns1,__webpackgi_exports__NearestFilter=__webpackgi_exports__.TyD,__webpackgi_exports__NearestMipMapLinearFilter=__webpackgi_exports__.vZf,__webpackgi_exports__NearestMipMapNearestFilter=__webpackgi_exports__.HTd,__webpackgi_exports__NearestMipmapLinearFilter=__webpackgi_exports__.aH4,__webpackgi_exports__NearestMipmapNearestFilter=__webpackgi_exports__.YLQ,__webpackgi_exports__NeverDepth=__webpackgi_exports__.BVF,__webpackgi_exports__NeverStencilFunc=__webpackgi_exports__.MyG,__webpackgi_exports__NoBlending=__webpackgi_exports__.jFi,__webpackgi_exports__NoColorSpace=__webpackgi_exports__.aCh,__webpackgi_exports__NoToneMapping=__webpackgi_exports__.uL9,__webpackgi_exports__NoiseBumpMaterialPlugin=__webpackgi_exports__.TNj,__webpackgi_exports__NormalAnimationBlendMode=__webpackgi_exports__.IFH,__webpackgi_exports__NormalBlending=__webpackgi_exports__.bdR,__webpackgi_exports__NormalBufferPlugin=__webpackgi_exports__.RPs,__webpackgi_exports__NormalCaptureMaterial=__webpackgi_exports__.kM_,__webpackgi_exports__NotEqualDepth=__webpackgi_exports__.M6v,__webpackgi_exports__NotEqualStencilFunc=__webpackgi_exports__.RvT,__webpackgi_exports__NumberKeyframeTrack=__webpackgi_exports__.dUE,__webpackgi_exports__OBJLoader2=__webpackgi_exports__.oe_,__webpackgi_exports__ObjMtlLoadPlugin=__webpackgi_exports__.BuN,__webpackgi_exports__Object3D=__webpackgi_exports__.Tme,__webpackgi_exports__Object3DModel=__webpackgi_exports__.N9P,__webpackgi_exports__ObjectLoader=__webpackgi_exports__.Gql,__webpackgi_exports__ObjectLoader2=__webpackgi_exports__.$XY,__webpackgi_exports__ObjectPicker=__webpackgi_exports__.O9d,__webpackgi_exports__ObjectProcessorMap=__webpackgi_exports__.zEO,__webpackgi_exports__ObjectRotationPlugin=__webpackgi_exports__.qfx,__webpackgi_exports__ObjectSpaceNormalMap=__webpackgi_exports__.PA7,__webpackgi_exports__OctahedronBufferGeometry=__webpackgi_exports__.REq,__webpackgi_exports__OctahedronGeometry=__webpackgi_exports__.pQR,__webpackgi_exports__OneFactor=__webpackgi_exports__.ghN,__webpackgi_exports__OneMinusDstAlphaFactor=__webpackgi_exports__.Hy8,__webpackgi_exports__OneMinusDstColorFactor=__webpackgi_exports__.Wpd,__webpackgi_exports__OneMinusSrcAlphaFactor=__webpackgi_exports__.LgZ,__webpackgi_exports__OneMinusSrcColorFactor=__webpackgi_exports__.iWC,__webpackgi_exports__OrbitControls2=__webpackgi_exports__.mqn,__webpackgi_exports__OrbitControls3=__webpackgi_exports__.SKe,__webpackgi_exports__OrthographicCamera=__webpackgi_exports__.iKG,__webpackgi_exports__OutlinePlugin=__webpackgi_exports__.rCq,__webpackgi_exports__PCFShadowMap=__webpackgi_exports__._iA,__webpackgi_exports__PCFSoftShadowMap=__webpackgi_exports__.ntZ,__webpackgi_exports__PMREMGenerator=__webpackgi_exports__.anP,__webpackgi_exports__PMREMGeneratorPlugin=__webpackgi_exports__.X2e,__webpackgi_exports__ParallaxCameraControllerPlugin=__webpackgi_exports__.oxT,__webpackgi_exports__ParallaxMappingPlugin=__webpackgi_exports__.FCo,__webpackgi_exports__Path=__webpackgi_exports__.y$t,__webpackgi_exports__PerspectiveCamera=__webpackgi_exports__.cPb,__webpackgi_exports__PickingPlugin=__webpackgi_exports__.lmx,__webpackgi_exports__Plane=__webpackgi_exports__.JOQ,__webpackgi_exports__PlaneBufferGeometry=__webpackgi_exports__.BKK,__webpackgi_exports__PlaneGeometry=__webpackgi_exports__._12,__webpackgi_exports__PlaneHelper=__webpackgi_exports__.tJx,__webpackgi_exports__PluginPresetGroup=__webpackgi_exports__.mjX,__webpackgi_exports__PointLight=__webpackgi_exports__.cek,__webpackgi_exports__PointLight2=__webpackgi_exports__.qD0,__webpackgi_exports__PointLightHelper=__webpackgi_exports__.xG9,__webpackgi_exports__PointerDragHelper=__webpackgi_exports__.eqi,__webpackgi_exports__PointerLockControls2=__webpackgi_exports__.wI8,__webpackgi_exports__PointerLockControlsPlugin=__webpackgi_exports__.Sgv,__webpackgi_exports__Points=__webpackgi_exports__.woe,__webpackgi_exports__PointsMaterial=__webpackgi_exports__.UY4,__webpackgi_exports__PolarGridHelper=__webpackgi_exports__.aq0,__webpackgi_exports__PolyhedronBufferGeometry=__webpackgi_exports__.ujx,__webpackgi_exports__PolyhedronGeometry=__webpackgi_exports__.Uol,__webpackgi_exports__PopmotionPlugin=__webpackgi_exports__.JiH,__webpackgi_exports__PositionalAudio=__webpackgi_exports__.VYz,__webpackgi_exports__PresetGroup=__webpackgi_exports__.B2H,__webpackgi_exports__PresetLibraryPlugin=__webpackgi_exports__._Pm,__webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW,__webpackgi_exports__PropertyBinding=__webpackgi_exports__.iUV,__webpackgi_exports__PropertyMixer=__webpackgi_exports__.tf,__webpackgi_exports__QuadraticBezierCurve=__webpackgi_exports__.ZQ6,__webpackgi_exports__QuadraticBezierCurve3=__webpackgi_exports__.mXe,__webpackgi_exports__Quaternion=__webpackgi_exports__._fP,__webpackgi_exports__QuaternionKeyframeTrack=__webpackgi_exports__.iLg,__webpackgi_exports__QuaternionLinearInterpolant=__webpackgi_exports__.zbs,__webpackgi_exports__RED_GREEN_RGTC2_Format=__webpackgi_exports__.ZTh,__webpackgi_exports__RED_RGTC1_Format=__webpackgi_exports__.HdW,__webpackgi_exports__REVISION=__webpackgi_exports__.UZH,__webpackgi_exports__RGBADepthPacking=__webpackgi_exports__.mSO,__webpackgi_exports__RGBAFormat=__webpackgi_exports__.wk1,__webpackgi_exports__RGBAIntegerFormat=__webpackgi_exports__.E2K,__webpackgi_exports__RGBA_ASTC_10x10_Format=__webpackgi_exports__.FUD,__webpackgi_exports__RGBA_ASTC_10x5_Format=__webpackgi_exports__.pKu,__webpackgi_exports__RGBA_ASTC_10x6_Format=__webpackgi_exports__.GG6,__webpackgi_exports__RGBA_ASTC_10x8_Format=__webpackgi_exports__.Gih,__webpackgi_exports__RGBA_ASTC_12x10_Format=__webpackgi_exports__.iiP,__webpackgi_exports__RGBA_ASTC_12x12_Format=__webpackgi_exports__.SvJ,__webpackgi_exports__RGBA_ASTC_4x4_Format=__webpackgi_exports__.ptH,__webpackgi_exports__RGBA_ASTC_5x4_Format=__webpackgi_exports__.jZA,__webpackgi_exports__RGBA_ASTC_5x5_Format=__webpackgi_exports__.y2t,__webpackgi_exports__RGBA_ASTC_6x5_Format=__webpackgi_exports__.gi4,__webpackgi_exports__RGBA_ASTC_6x6_Format=__webpackgi_exports__.Djp,__webpackgi_exports__RGBA_ASTC_8x5_Format=__webpackgi_exports__.BG$,__webpackgi_exports__RGBA_ASTC_8x6_Format=__webpackgi_exports__.NYV,__webpackgi_exports__RGBA_ASTC_8x8_Format=__webpackgi_exports__.xJs,__webpackgi_exports__RGBA_BPTC_Format=__webpackgi_exports__.bsb,__webpackgi_exports__RGBA_ETC2_EAC_Format=__webpackgi_exports__.ekQ,__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__.CaW,__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__.eaV,__webpackgi_exports__RGBA_S3TC_DXT1_Format=__webpackgi_exports__.BFQ,__webpackgi_exports__RGBA_S3TC_DXT3_Format=__webpackgi_exports__.v3W,__webpackgi_exports__RGBA_S3TC_DXT5_Format=__webpackgi_exports__.ILR,__webpackgi_exports__RGBM16ColorSpace=__webpackgi_exports__.G_r,__webpackgi_exports__RGBM16ColorSpace_=__webpackgi_exports__.N3F,__webpackgi_exports__RGB_ETC1_Format=__webpackgi_exports__.fto,__webpackgi_exports__RGB_ETC2_Format=__webpackgi_exports__.l0P,__webpackgi_exports__RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__.vCx,__webpackgi_exports__RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__._AM,__webpackgi_exports__RGB_S3TC_DXT1_Format=__webpackgi_exports__.wuA,__webpackgi_exports__RGFormat=__webpackgi_exports__.av9,__webpackgi_exports__RGIntegerFormat=__webpackgi_exports__.CtA,__webpackgi_exports__RandomizedDirectionalLight=__webpackgi_exports__.BvQ,__webpackgi_exports__RandomizedDirectionalLightPlugin=__webpackgi_exports__.FZJ,__webpackgi_exports__RawShaderMaterial=__webpackgi_exports__.FIo,__webpackgi_exports__Ray=__webpackgi_exports__.zHn,__webpackgi_exports__Raycaster=__webpackgi_exports__.iMs,__webpackgi_exports__RectAreaLight=__webpackgi_exports__.T_f,__webpackgi_exports__RedFormat=__webpackgi_exports__.hEm,__webpackgi_exports__RedIntegerFormat=__webpackgi_exports__.D9w,__webpackgi_exports__Reflector2=__webpackgi_exports__.sHH,__webpackgi_exports__ReinhardToneMapping=__webpackgi_exports__.CdI,__webpackgi_exports__RendererUiPlugin=__webpackgi_exports__.rkc,__webpackgi_exports__RepeatWrapping=__webpackgi_exports__.rpg,__webpackgi_exports__ReplaceStencilOp=__webpackgi_exports__.ce8,__webpackgi_exports__ReverseSubtractEquation=__webpackgi_exports__.rOj,__webpackgi_exports__Rhino3dmLoadPlugin=__webpackgi_exports__.P6m,__webpackgi_exports__Rhino3dmLoader2=__webpackgi_exports__.JA6,__webpackgi_exports__RingBufferGeometry=__webpackgi_exports__.V4E,__webpackgi_exports__RingGeometry=__webpackgi_exports__.o8S,__webpackgi_exports__RootScene=__webpackgi_exports__.flB,__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format=__webpackgi_exports__.lGU,__webpackgi_exports__SIGNED_RED_RGTC1_Format=__webpackgi_exports__.vuL,__webpackgi_exports__SRGBColorSpace=__webpackgi_exports__.KI_,__webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN,__webpackgi_exports__SSBevelPass=__webpackgi_exports__.X6w,__webpackgi_exports__SSBevelPlugin=__webpackgi_exports__.rz_,__webpackgi_exports__SSContactShadows=__webpackgi_exports__.jsw,__webpackgi_exports__SSGIPlugin=__webpackgi_exports__.srG,__webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z,__webpackgi_exports__STLLoadPlugin=__webpackgi_exports__.vfv,__webpackgi_exports__Scene=__webpackgi_exports__.xsS,__webpackgi_exports__SceneCamerasUiPlugin=__webpackgi_exports__.or,__webpackgi_exports__SceneLoopPlugin=__webpackgi_exports__.EQj,__webpackgi_exports__ScrollableCameraViewPlugin=__webpackgi_exports__.Rnn,__webpackgi_exports__ScrollableCameraViewPreviewPlugin=__webpackgi_exports__.TyN,__webpackgi_exports__SelectionWidget=__webpackgi_exports__.ov0,__webpackgi_exports__ShaderChunk=__webpackgi_exports__.WdD,__webpackgi_exports__ShaderLib=__webpackgi_exports__.Vj0,__webpackgi_exports__ShaderMaterial=__webpackgi_exports__.jyz,__webpackgi_exports__ShaderMaterial2=__webpackgi_exports__.mTM,__webpackgi_exports__ShaderMaterialEncodingSupport=__webpackgi_exports__.Mn1,__webpackgi_exports__ShaderPass2=__webpackgi_exports__.Hlq,__webpackgi_exports__ShadowMapBaker=__webpackgi_exports__.Fi7,__webpackgi_exports__ShadowMaterial=__webpackgi_exports__.Tn7,__webpackgi_exports__Shape=__webpackgi_exports__.bnF,__webpackgi_exports__ShapeBufferGeometry=__webpackgi_exports__.HW6,__webpackgi_exports__ShapeGeometry=__webpackgi_exports__.oa8,__webpackgi_exports__ShapePath=__webpackgi_exports__.T_1,__webpackgi_exports__ShapeTubeExtrudePlugin=__webpackgi_exports__.zHJ,__webpackgi_exports__ShapeUtils=__webpackgi_exports__.iDF,__webpackgi_exports__ShortType=__webpackgi_exports__.iAb,__webpackgi_exports__SimpleAssetList=__webpackgi_exports__.d4E,__webpackgi_exports__SimpleBackgroundEnvUiPlugin=__webpackgi_exports__.lBg,__webpackgi_exports__SimpleDataSource=__webpackgi_exports__.JeJ,__webpackgi_exports__SimpleEventDispatcher=__webpackgi_exports__.FKY,__webpackgi_exports__SimpleJSONExporter=__webpackgi_exports__.zlZ,__webpackgi_exports__SimpleJSONLoader=__webpackgi_exports__.vkg,__webpackgi_exports__SimpleTextExporter=__webpackgi_exports__.brh,__webpackgi_exports__SimpleTextPlugin=__webpackgi_exports__.kZK,__webpackgi_exports__SimpleViewerUi=__webpackgi_exports__.puG,__webpackgi_exports__Skeleton=__webpackgi_exports__.OdW,__webpackgi_exports__SkeletonHelper=__webpackgi_exports__._YX,__webpackgi_exports__SkinnedMesh=__webpackgi_exports__.TUv,__webpackgi_exports__Source=__webpackgi_exports__.Hw6,__webpackgi_exports__Sphere=__webpackgi_exports__.aLr,__webpackgi_exports__SphereBufferGeometry=__webpackgi_exports__.Aip,__webpackgi_exports__SphereGeometry=__webpackgi_exports__.xo$,__webpackgi_exports__SphereSelectionWidget=__webpackgi_exports__.bIn,__webpackgi_exports__Spherical=__webpackgi_exports__.$V,__webpackgi_exports__SphericalHarmonics3=__webpackgi_exports__.lDi,__webpackgi_exports__SplineCurve=__webpackgi_exports__.gti,__webpackgi_exports__SpotLight=__webpackgi_exports__.PMe,__webpackgi_exports__SpotLight2=__webpackgi_exports__.iwP,__webpackgi_exports__SpotLightHelper=__webpackgi_exports__.FvO,__webpackgi_exports__Sprite=__webpackgi_exports__.jyi,__webpackgi_exports__SpriteMaterial=__webpackgi_exports__.xeV,__webpackgi_exports__SrcAlphaFactor=__webpackgi_exports__.k74,__webpackgi_exports__SrcAlphaSaturateFactor=__webpackgi_exports__.RlZ,__webpackgi_exports__SrcColorFactor=__webpackgi_exports__.KhW,__webpackgi_exports__StaticCopyUsage=__webpackgi_exports__.HgB,__webpackgi_exports__StaticDrawUsage=__webpackgi_exports__.W2J,__webpackgi_exports__StaticReadUsage=__webpackgi_exports__.JWc,__webpackgi_exports__StereoCamera=__webpackgi_exports__.u37,__webpackgi_exports__StreamCopyUsage=__webpackgi_exports__.Z6B,__webpackgi_exports__StreamDrawUsage=__webpackgi_exports__.QZ1,__webpackgi_exports__StreamReadUsage=__webpackgi_exports__.Ir4,__webpackgi_exports__StringKeyframeTrack=__webpackgi_exports__.NwF,__webpackgi_exports__SubtractEquation=__webpackgi_exports__.Wbm,__webpackgi_exports__SubtractiveBlending=__webpackgi_exports__.N4l,__webpackgi_exports__SwitchNodeBasePlugin=__webpackgi_exports__.Jxm,__webpackgi_exports__SwitchNodePlugin=__webpackgi_exports__.ej9,__webpackgi_exports__TOUCH=__webpackgi_exports__.QmN,__webpackgi_exports__TYPED_ARRAYS=__webpackgi_exports__.Y4W,__webpackgi_exports__TangentSpaceNormalMap=__webpackgi_exports__.IOt,__webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.NOD,__webpackgi_exports__TetrahedronBufferGeometry=__webpackgi_exports__.L5g,__webpackgi_exports__TetrahedronGeometry=__webpackgi_exports__.H$k,__webpackgi_exports__TextSVGOptions=__webpackgi_exports__.cuP,__webpackgi_exports__Texture=__webpackgi_exports__.xEZ,__webpackgi_exports__TextureLoader=__webpackgi_exports__.dpR,__webpackgi_exports__ThinFilmLayerPlugin=__webpackgi_exports__.wOD,__webpackgi_exports__ThreeMaterialLoader=__webpackgi_exports__.KNb,__webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN,__webpackgi_exports__TorusBufferGeometry=__webpackgi_exports__.Cne,__webpackgi_exports__TorusGeometry=__webpackgi_exports__.XvJ,__webpackgi_exports__TorusKnotBufferGeometry=__webpackgi_exports__.XZw,__webpackgi_exports__TorusKnotGeometry=__webpackgi_exports__.FE5,__webpackgi_exports__TransformControls2=__webpackgi_exports__.lVp,__webpackgi_exports__Triangle=__webpackgi_exports__.CJI,__webpackgi_exports__TriangleFanDrawMode=__webpackgi_exports__.z$h,__webpackgi_exports__TriangleStripDrawMode=__webpackgi_exports__.UlW,__webpackgi_exports__TrianglesDrawMode=__webpackgi_exports__.WwZ,__webpackgi_exports__TriplanarUVMappingPlugin=__webpackgi_exports__.zG7,__webpackgi_exports__TubeBufferGeometry=__webpackgi_exports__.Lcc,__webpackgi_exports__TubeGeometry=__webpackgi_exports__.WXh,__webpackgi_exports__TubeShapeGeometry=__webpackgi_exports__.Vjr,__webpackgi_exports__TweakpaneUiPlugin=__webpackgi_exports__.LuM,__webpackgi_exports__TweakpaneWrapper=__webpackgi_exports__.LP5,__webpackgi_exports__TwoPassDoubleSide=__webpackgi_exports__.ub3,__webpackgi_exports__UChartOptions=__webpackgi_exports__.OV,__webpackgi_exports__UPackOptions=__webpackgi_exports__.G_n,__webpackgi_exports__UVMapping=__webpackgi_exports__.xfE,__webpackgi_exports__Uint16BufferAttribute=__webpackgi_exports__.qlB,__webpackgi_exports__Uint32BufferAttribute=__webpackgi_exports__.lCJ,__webpackgi_exports__Uint8BufferAttribute=__webpackgi_exports__.WTc,__webpackgi_exports__Uint8ClampedBufferAttribute=__webpackgi_exports__.rAo,__webpackgi_exports__Uncharted2Tonemapping=__webpackgi_exports__.LZj,__webpackgi_exports__Uniform=__webpackgi_exports__.xWb,__webpackgi_exports__UniformsGroup=__webpackgi_exports__.gH0,__webpackgi_exports__UniformsLib=__webpackgi_exports__.rBU,__webpackgi_exports__UniformsUtils=__webpackgi_exports__.rDY,__webpackgi_exports__UnsignedByteType=__webpackgi_exports__.ywz,__webpackgi_exports__UnsignedInt248Type=__webpackgi_exports__.wJv,__webpackgi_exports__UnsignedIntType=__webpackgi_exports__.JQ4,__webpackgi_exports__UnsignedShort4444Type=__webpackgi_exports__.k0A,__webpackgi_exports__UnsignedShort5551Type=__webpackgi_exports__.irR,__webpackgi_exports__UnsignedShortType=__webpackgi_exports__.LsT,__webpackgi_exports__Unzip=__webpackgi_exports__.q5h,__webpackgi_exports__UnzipInflate=__webpackgi_exports__.TKh,__webpackgi_exports__UnzipPassThrough=__webpackgi_exports__.tyg,__webpackgi_exports__Unzlib=__webpackgi_exports__.Ro5,__webpackgi_exports__VSMShadowMap=__webpackgi_exports__.dwk,__webpackgi_exports__VariationConfiguratorEditorUiPlugin=__webpackgi_exports__.t0w,__webpackgi_exports__VariationConfiguratorGridUiPlugin=__webpackgi_exports__.M7$,__webpackgi_exports__VariationConfiguratorPlugin=__webpackgi_exports__.ML4,__webpackgi_exports__Vector2=__webpackgi_exports__.FM8,__webpackgi_exports__Vector3=__webpackgi_exports__.Pa4,__webpackgi_exports__Vector4=__webpackgi_exports__.Ltg,__webpackgi_exports__VectorKeyframeTrack=__webpackgi_exports__.yC1,__webpackgi_exports__VelocityBufferPlugin=__webpackgi_exports__.lHq,__webpackgi_exports__VideoTexture=__webpackgi_exports__.fO1,__webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA,__webpackgi_exports__ViewerState=__webpackgi_exports__.JzW,__webpackgi_exports__VignettePlugin=__webpackgi_exports__.QEt,__webpackgi_exports__WebGL1Renderer=__webpackgi_exports__.b5g,__webpackgi_exports__WebGL3DRenderTarget=__webpackgi_exports__.Ywn,__webpackgi_exports__WebGLArrayRenderTarget=__webpackgi_exports__.GVz,__webpackgi_exports__WebGLCubeRenderTarget=__webpackgi_exports__.oAp,__webpackgi_exports__WebGLMultipleRenderTargets=__webpackgi_exports__.kFz,__webpackgi_exports__WebGLRenderTarget=__webpackgi_exports__.dd2,__webpackgi_exports__WebGLRenderer=__webpackgi_exports__.CP7,__webpackgi_exports__WebGLUtils=__webpackgi_exports__.fQK,__webpackgi_exports__WebGiViewerElement=__webpackgi_exports__.Wd$,__webpackgi_exports__WindowiseDialogPlugin=__webpackgi_exports__.t1_,__webpackgi_exports__Wireframe=__webpackgi_exports__.v27,__webpackgi_exports__WireframeGeometry=__webpackgi_exports__.Uk6,__webpackgi_exports__WireframeGeometry2=__webpackgi_exports__.H7Z,__webpackgi_exports__WrapAroundEnding=__webpackgi_exports__._sL,__webpackgi_exports__XAtlasPlugin=__webpackgi_exports__.czO,__webpackgi_exports__ZeroCurvatureEnding=__webpackgi_exports__.Pnf,__webpackgi_exports__ZeroFactor=__webpackgi_exports__.c8b,__webpackgi_exports__ZeroSlopeEnding=__webpackgi_exports__._lf,__webpackgi_exports__ZeroStencilOp=__webpackgi_exports__.ad5,__webpackgi_exports__Zip=__webpackgi_exports__.sZV,__webpackgi_exports__ZipDeflate=__webpackgi_exports__.TfA,__webpackgi_exports__ZipLoader=__webpackgi_exports__.sKX,__webpackgi_exports__ZipPassThrough=__webpackgi_exports__.UdM,__webpackgi_exports__Zlib=__webpackgi_exports__.P0y,__webpackgi_exports___SRGBAFormat=__webpackgi_exports__.L_r,__webpackgi_exports__absMax=__webpackgi_exports__.zC5,__webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve,__webpackgi_exports__addBloomData=__webpackgi_exports__.b5G,__webpackgi_exports__addDracoLoader=__webpackgi_exports__.UeO,__webpackgi_exports__addEditorPlugins=__webpackgi_exports__.qCx,__webpackgi_exports__addGLTFExporter=__webpackgi_exports__.$nx,__webpackgi_exports__addGLTFLoader=__webpackgi_exports__.Bk6,__webpackgi_exports__addLUTData=__webpackgi_exports__.EER,__webpackgi_exports__addRGBELoader=__webpackgi_exports__.y4l,__webpackgi_exports__addSSBevel=__webpackgi_exports__.P39,__webpackgi_exports__aesGcmDecrypt=__webpackgi_exports__.HI1,__webpackgi_exports__aesGcmEncrypt=__webpackgi_exports__.ZYi,__webpackgi_exports__afterMain=__webpackgi_exports__.wXW,__webpackgi_exports__afterRead=__webpackgi_exports__.r5x,__webpackgi_exports__afterWrite=__webpackgi_exports__.MSI,__webpackgi_exports__angle=__webpackgi_exports__.EUu,__webpackgi_exports__animate=__webpackgi_exports__.jtH,__webpackgi_exports__animateAsync=__webpackgi_exports__.T0T,__webpackgi_exports__animateObject=__webpackgi_exports__.gAb,__webpackgi_exports__animateSet=__webpackgi_exports__.je_,__webpackgi_exports__animateTarget=__webpackgi_exports__.wBP,__webpackgi_exports__anticipate=__webpackgi_exports__.LU2,__webpackgi_exports__applyOffset=__webpackgi_exports__.wQL,__webpackgi_exports__applyStyles=__webpackgi_exports__.Zs7,__webpackgi_exports__arrayBufferToBase64=__webpackgi_exports__.sMc,__webpackgi_exports__arrow=__webpackgi_exports__.x7s,__webpackgi_exports__attract=__webpackgi_exports__.Mnd,__webpackgi_exports__attractExpo=__webpackgi_exports__.A0_,__webpackgi_exports__auto=__webpackgi_exports__.d73,__webpackgi_exports__autoCenterObject3D=__webpackgi_exports__.HCD,__webpackgi_exports__autoGPUInstanceMeshes=__webpackgi_exports__.YQ8,__webpackgi_exports__autoScaleObject3D=__webpackgi_exports__.RG9,__webpackgi_exports__backIn=__webpackgi_exports__.G2P,__webpackgi_exports__backInOut=__webpackgi_exports__.XLf,__webpackgi_exports__backOut=__webpackgi_exports__.CGN,__webpackgi_exports__base64ToArrayBuffer=__webpackgi_exports__.RGi,__webpackgi_exports__basePlacements=__webpackgi_exports__.mvg,__webpackgi_exports__basicMaterialPropList=__webpackgi_exports__.Hiy,__webpackgi_exports__beforeMain=__webpackgi_exports__.XMc,__webpackgi_exports__beforeRead=__webpackgi_exports__.N7M,__webpackgi_exports__beforeWrite=__webpackgi_exports__.iv,__webpackgi_exports__blobToDataURL=__webpackgi_exports__.n55,__webpackgi_exports__bottom=__webpackgi_exports__.IaC,__webpackgi_exports__bounceIn=__webpackgi_exports__.h9t,__webpackgi_exports__bounceInOut=__webpackgi_exports__.yDW,__webpackgi_exports__bounceOut=__webpackgi_exports__.gJv,__webpackgi_exports__buildCSGMeshBSP=__webpackgi_exports__.l$g,__webpackgi_exports__buildCSGMeshBVH=__webpackgi_exports__.vQi,__webpackgi_exports__cLinearToRGBM=__webpackgi_exports__.$MY,__webpackgi_exports__cRGBMToLinear=__webpackgi_exports__.wJl,__webpackgi_exports__circIn=__webpackgi_exports__.Z7Y,__webpackgi_exports__circInOut=__webpackgi_exports__.X7D,__webpackgi_exports__circOut=__webpackgi_exports__.BnX,__webpackgi_exports__clamp=__webpackgi_exports__.uZ5,__webpackgi_exports__clippingParents=__webpackgi_exports__.zVI,__webpackgi_exports__colorToDataUrl=__webpackgi_exports__.Wz1,__webpackgi_exports__combineDofShader=__webpackgi_exports__.DpF,__webpackgi_exports__compress=__webpackgi_exports__.nNb,__webpackgi_exports__compressSync=__webpackgi_exports__.cqZ,__webpackgi_exports__computeAverageGeometryNormal=__webpackgi_exports__.pKN,__webpackgi_exports__computeEigenVectors=__webpackgi_exports__.CN8,__webpackgi_exports__computeGeometryCenter=__webpackgi_exports__.DdI,__webpackgi_exports__computeGeometrySize=__webpackgi_exports__.rrX,__webpackgi_exports__computeMikkTSpaceTangents=__webpackgi_exports__.uqj,__webpackgi_exports__computeMorphedAttributes=__webpackgi_exports__.Z9P,__webpackgi_exports__computeOffsetMatrix=__webpackgi_exports__.KlC,__webpackgi_exports__computeScreenSpaceBoundingBox=__webpackgi_exports__.KVn,__webpackgi_exports__computeStyles=__webpackgi_exports__.oau,__webpackgi_exports__copyMaterialUserData=__webpackgi_exports__.aw9,__webpackgi_exports__copyObject3DUserData=__webpackgi_exports__.Aap,__webpackgi_exports__copyProps=__webpackgi_exports__.Dxg,__webpackgi_exports__copyTextureUserData=__webpackgi_exports__.MjT,__webpackgi_exports__createAnticipate=__webpackgi_exports__.F7Q,__webpackgi_exports__createAttractor=__webpackgi_exports__.IFq,__webpackgi_exports__createBackIn=__webpackgi_exports__.IJl,__webpackgi_exports__createCanvasElement=__webpackgi_exports__.O5A,__webpackgi_exports__createDiv=__webpackgi_exports__.wCn,__webpackgi_exports__createExpoIn=__webpackgi_exports__.gGT,__webpackgi_exports__createIFrameCSS3DObject=__webpackgi_exports__.pEc,__webpackgi_exports__createImage=__webpackgi_exports__.Bi6,__webpackgi_exports__createPopper=__webpackgi_exports__.fi_,__webpackgi_exports__createPopperBase=__webpackgi_exports__.TT,__webpackgi_exports__createPopperLite=__webpackgi_exports__.q2Z,__webpackgi_exports__createRenderTargetKey=__webpackgi_exports__.NyK,__webpackgi_exports__createScriptFromURL=__webpackgi_exports__.bgu,__webpackgi_exports__createStyles=__webpackgi_exports__.kcS,__webpackgi_exports__csgOperations=__webpackgi_exports__.rRN,__webpackgi_exports__css=__webpackgi_exports__.ivY,__webpackgi_exports__cubicBezier=__webpackgi_exports__._s1,__webpackgi_exports__dataTextureFromColor=__webpackgi_exports__._HO,__webpackgi_exports__dataTextureFromVec4=__webpackgi_exports__.tpL,__webpackgi_exports__decay=__webpackgi_exports__.DMK,__webpackgi_exports__decompress=__webpackgi_exports__.LjN,__webpackgi_exports__decompressSync=__webpackgi_exports__.iFs,__webpackgi_exports__deepAccessObject=__webpackgi_exports__.qTg,__webpackgi_exports__deepCloneAttribute=__webpackgi_exports__.J4G,__webpackgi_exports__defaultPresets=__webpackgi_exports__.Zj8,__webpackgi_exports__deflate=__webpackgi_exports__.Wtl,__webpackgi_exports__deflateSync=__webpackgi_exports__.DmK,__webpackgi_exports__degreesToRadians=__webpackgi_exports__.Htt,__webpackgi_exports__deinterleaveAttribute=__webpackgi_exports__.Nv0,__webpackgi_exports__deinterleaveGeometry=__webpackgi_exports__.tCp,__webpackgi_exports__deserializeObject=__webpackgi_exports__.Hx7,__webpackgi_exports__deserializers=__webpackgi_exports__.imt,__webpackgi_exports__detectOverflow=__webpackgi_exports__.US6,__webpackgi_exports__diamondMaterialPropList=__webpackgi_exports__.vZs,__webpackgi_exports__distance=__webpackgi_exports__.TE$,__webpackgi_exports__downloadBlob=__webpackgi_exports__.lmu,__webpackgi_exports__downloadFile=__webpackgi_exports__.SvO,__webpackgi_exports__easeIn=__webpackgi_exports__.YQY,__webpackgi_exports__easeInOut=__webpackgi_exports__.mZN,__webpackgi_exports__easeOut=__webpackgi_exports__.VvG,__webpackgi_exports__embedUrlRefs=__webpackgi_exports__.omp,__webpackgi_exports__end=__webpackgi_exports__.utz,__webpackgi_exports__envMapBackground=__webpackgi_exports__.TFV,__webpackgi_exports__escapeRegExp=__webpackgi_exports__.hrz,__webpackgi_exports__estimateBytesUsed=__webpackgi_exports__.H$s,__webpackgi_exports__eventListeners=__webpackgi_exports__.JKM,__webpackgi_exports__extractAnimationKey=__webpackgi_exports__.jZf,__webpackgi_exports__flattenUiConfig=__webpackgi_exports__.RjL,__webpackgi_exports__flip=__webpackgi_exports__.RRI,__webpackgi_exports__fontFormatExtensionMap=__webpackgi_exports__.RUq,__webpackgi_exports__generateUiConfig=__webpackgi_exports__._t4,__webpackgi_exports__generateUiFolder=__webpackgi_exports__.YHh,__webpackgi_exports__getEncodingComponents=__webpackgi_exports__.R8g,__webpackgi_exports__getFileHandle=__webpackgi_exports__.f1L,__webpackgi_exports__getFilenameFromPath=__webpackgi_exports__.Bbl,__webpackgi_exports__getKeyByValue=__webpackgi_exports__.V9r,__webpackgi_exports__getNewFileHandle=__webpackgi_exports__.a95,__webpackgi_exports__getOrCall=__webpackgi_exports__.PZ2,__webpackgi_exports__getPropertyDescriptor=__webpackgi_exports__.w7A,__webpackgi_exports__getTexelDecoding=__webpackgi_exports__.N6S,__webpackgi_exports__getTexelDecoding2=__webpackgi_exports__.Uxp,__webpackgi_exports__getTexelDecodingFunction=__webpackgi_exports__.tAz,__webpackgi_exports__getTexelEncoding=__webpackgi_exports__.R$F,__webpackgi_exports__getTexelEncodingFunction=__webpackgi_exports__.N33,__webpackgi_exports__getTextureColorSpaceFromMap=__webpackgi_exports__.JFD,__webpackgi_exports__getTextureDataType=__webpackgi_exports__.gw2,__webpackgi_exports__getTypedArray=__webpackgi_exports__.rfc,__webpackgi_exports__getUrlQueryParam=__webpackgi_exports__.wo6,__webpackgi_exports__glbEncryptionPreparser=__webpackgi_exports__.V4T,__webpackgi_exports__glsl=__webpackgi_exports__.H4P,__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.NLp,__webpackgi_exports__gunzip=__webpackgi_exports__.swA,__webpackgi_exports__gunzipSync=__webpackgi_exports__._Z3,__webpackgi_exports__gzip=__webpackgi_exports__.ivc,__webpackgi_exports__gzipSync=__webpackgi_exports__.rZ1,__webpackgi_exports__hide=__webpackgi_exports__.CpZ,__webpackgi_exports__html=__webpackgi_exports__.dyc,__webpackgi_exports__htmlToCanvas=__webpackgi_exports__.MxZ,__webpackgi_exports__htmlToPng=__webpackgi_exports__.btp,__webpackgi_exports__htmlToSvg=__webpackgi_exports__.mXy,__webpackgi_exports__iGeometryIgnoredUserData=__webpackgi_exports__.Ej0,__webpackgi_exports__iMaterialIgnoredUserData=__webpackgi_exports__.ep4,__webpackgi_exports__iModelIgnoredUserData=__webpackgi_exports__.DQP,__webpackgi_exports__iTextureIgnoredUserData=__webpackgi_exports__.VNr,__webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.V7q,__webpackgi_exports__imageDataToCanvas=__webpackgi_exports__.hiB,__webpackgi_exports__imageToCanvas=__webpackgi_exports__.zEk,__webpackgi_exports__imageUrlToImageData=__webpackgi_exports__.qfq,__webpackgi_exports__includesAll=__webpackgi_exports__.piB,__webpackgi_exports__inertia=__webpackgi_exports__.IIc,__webpackgi_exports__inflate=__webpackgi_exports__.rrF,__webpackgi_exports__inflateSync=__webpackgi_exports__.naq,__webpackgi_exports__interleaveAttributes=__webpackgi_exports__.zlD,__webpackgi_exports__interpolate=__webpackgi_exports__.sXR,__webpackgi_exports__isAnimatableType=__webpackgi_exports__.p5I,__webpackgi_exports__isPoint=__webpackgi_exports__.wps,__webpackgi_exports__isPoint3D=__webpackgi_exports__.wuo,__webpackgi_exports__isPropertyWritable=__webpackgi_exports__.GpE,__webpackgi_exports__keyframes=__webpackgi_exports__.F4b,__webpackgi_exports__khrMaterialsVariantsGLTF=__webpackgi_exports__.NN$,__webpackgi_exports__left=__webpackgi_exports__.t$v,__webpackgi_exports__lerpAngle=__webpackgi_exports__.tdn,__webpackgi_exports__lerpAngle2=__webpackgi_exports__.Y9t,__webpackgi_exports__linear=__webpackgi_exports__.GEo,__webpackgi_exports__longestCommonPrefix=__webpackgi_exports__.GGm,__webpackgi_exports__main=__webpackgi_exports__.DH3,__webpackgi_exports__makeColorSvg=__webpackgi_exports__.uxM,__webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.zH3,__webpackgi_exports__makeFilter=__webpackgi_exports__.MLs,__webpackgi_exports__makeSamplerUi=__webpackgi_exports__.xXG,__webpackgi_exports__makeSetterFor=__webpackgi_exports__.YM4,__webpackgi_exports__makeSetterForAnimObject=__webpackgi_exports__.B3r,__webpackgi_exports__makeTextSvg=__webpackgi_exports__.iAx,__webpackgi_exports__matDefine=__webpackgi_exports__.lDn,__webpackgi_exports__mergeAttributes=__webpackgi_exports__.P1O,__webpackgi_exports__mergeBufferAttributes=__webpackgi_exports__.iib,__webpackgi_exports__mergeBufferGeometries=__webpackgi_exports__.qf5,__webpackgi_exports__mergeGeometries=__webpackgi_exports__.n4s,__webpackgi_exports__mergeGroups=__webpackgi_exports__.fr,__webpackgi_exports__mergeVertices=__webpackgi_exports__.Z9s,__webpackgi_exports__mirrorEasing=__webpackgi_exports__.oaQ,__webpackgi_exports__mix=__webpackgi_exports__.CD7,__webpackgi_exports__mixColor=__webpackgi_exports__.Rc0,__webpackgi_exports__mixComplex=__webpackgi_exports__.iPG,__webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc,__webpackgi_exports__modifierPhases=__webpackgi_exports__.xsC,__webpackgi_exports__now=__webpackgi_exports__.zOc,__webpackgi_exports__objectHasOwn=__webpackgi_exports__.i8W,__webpackgi_exports__offset=__webpackgi_exports__.r46,__webpackgi_exports__onChange=__webpackgi_exports__.z2C,__webpackgi_exports__onChange2=__webpackgi_exports__.N4A,__webpackgi_exports__onChange3=__webpackgi_exports__.hjq,__webpackgi_exports__parseFileExtension=__webpackgi_exports__._X$,__webpackgi_exports__patchShaderEncodingSupport=__webpackgi_exports__._yn,__webpackgi_exports__pathJoin=__webpackgi_exports__.Dyg,__webpackgi_exports__physicalMaterialPropList=__webpackgi_exports__.cUc,__webpackgi_exports__pipe=__webpackgi_exports__.zGw,__webpackgi_exports__placements=__webpackgi_exports__.Ctq,__webpackgi_exports__pointFromVector=__webpackgi_exports__.$ch,__webpackgi_exports__popper=__webpackgi_exports__.k5b,__webpackgi_exports__popperGenerator=__webpackgi_exports__.kZl,__webpackgi_exports__popperOffsets=__webpackgi_exports__.OCg,__webpackgi_exports__prettyScrollbar=__webpackgi_exports__.Kd3,__webpackgi_exports__preventOverflow=__webpackgi_exports__.YjH,__webpackgi_exports__processViewer=__webpackgi_exports__.Ui8,__webpackgi_exports__progress=__webpackgi_exports__.YD2,__webpackgi_exports__radiansToDegrees=__webpackgi_exports__.vi9,__webpackgi_exports__read=__webpackgi_exports__.ij3,__webpackgi_exports__readFile=__webpackgi_exports__.pJq,__webpackgi_exports__reference=__webpackgi_exports__.YPW,__webpackgi_exports__remoteWorkerURL=__webpackgi_exports__._tY,__webpackgi_exports__removeDuplicateGeometries=__webpackgi_exports__.Bg1,__webpackgi_exports__replaceAll=__webpackgi_exports__.kon,__webpackgi_exports__reverseEasing=__webpackgi_exports__.M3g,__webpackgi_exports__right=__webpackgi_exports__.F2z,__webpackgi_exports__rotateDuplicatedMesh=__webpackgi_exports__.pJF,__webpackgi_exports__sRGBEncoding=__webpackgi_exports__.knz,__webpackgi_exports__safeSetProperty=__webpackgi_exports__.Ejo,__webpackgi_exports__serializable=__webpackgi_exports__.BgY,__webpackgi_exports__serialize=__webpackgi_exports__.qCG,__webpackgi_exports__serializeObject=__webpackgi_exports__.HD9,__webpackgi_exports__serializeTextureInExtras=__webpackgi_exports__.Rgz,__webpackgi_exports__serializers=__webpackgi_exports__.fEB,__webpackgi_exports__setMeshGeometry=__webpackgi_exports__.Udc,__webpackgi_exports__setMeshMaterial=__webpackgi_exports__.ZQg,__webpackgi_exports__setThreeRendererMode=__webpackgi_exports__.ofC,__webpackgi_exports__setUrlQueryParam=__webpackgi_exports__.yRy,__webpackgi_exports__setupCoreWebGiViewer=__webpackgi_exports__._NL,__webpackgi_exports__setupIModel=__webpackgi_exports__.LCA,__webpackgi_exports__setupModesStyles=__webpackgi_exports__.Sy1,__webpackgi_exports__setupModesUi=__webpackgi_exports__.Vs_,__webpackgi_exports__setupObject3dModel=__webpackgi_exports__.j1w,__webpackgi_exports__setupSandboxWebGiEditor=__webpackgi_exports__.i8J,__webpackgi_exports__shaderReplaceString=__webpackgi_exports__.p7C,__webpackgi_exports__slerp=__webpackgi_exports__.ZAS,__webpackgi_exports__smooth=__webpackgi_exports__.ipH,__webpackgi_exports__smoothFrame=__webpackgi_exports__.$TF,__webpackgi_exports__snap=__webpackgi_exports__.uZI,__webpackgi_exports__snapObject=__webpackgi_exports__.VWG,__webpackgi_exports__sphericalFromObject=__webpackgi_exports__.pQ7,__webpackgi_exports__spring=__webpackgi_exports__.STw,__webpackgi_exports__standardMaterialPropList=__webpackgi_exports__.jc8,__webpackgi_exports__start=__webpackgi_exports__.BL_,__webpackgi_exports__steps=__webpackgi_exports__.S6,__webpackgi_exports__strFromU8=__webpackgi_exports__.T8U,__webpackgi_exports__strToU8=__webpackgi_exports__.TD6,__webpackgi_exports__svgToCanvas=__webpackgi_exports__.akS,__webpackgi_exports__svgToPng=__webpackgi_exports__.QKE,__webpackgi_exports__svgUrl=__webpackgi_exports__.dKx,__webpackgi_exports__syncAnimSetUi=__webpackgi_exports__.OvX,__webpackgi_exports__texImageToCanvas=__webpackgi_exports__.doP,__webpackgi_exports__textureDataToImageData=__webpackgi_exports__.$jA,__webpackgi_exports__textureToCanvas=__webpackgi_exports__.T99,__webpackgi_exports__textureToDataUrl=__webpackgi_exports__.LJS,__webpackgi_exports__timeout=__webpackgi_exports__.VsW,__webpackgi_exports__toCreasedNormals=__webpackgi_exports__.LZE,__webpackgi_exports__toDecimal=__webpackgi_exports__.YMc,__webpackgi_exports__toIndexedGeometry=__webpackgi_exports__.aPg,__webpackgi_exports__toTitleCase=__webpackgi_exports__.LFn,__webpackgi_exports__toTrianglesDrawMode=__webpackgi_exports__.VsX,__webpackgi_exports__top=__webpackgi_exports__.wey,__webpackgi_exports__uiButton=__webpackgi_exports__.MaE,__webpackgi_exports__uiColor=__webpackgi_exports__.s4x,__webpackgi_exports__uiConfig=__webpackgi_exports__.FJA,__webpackgi_exports__uiDropdown=__webpackgi_exports__.vIA,__webpackgi_exports__uiFolder=__webpackgi_exports__.Spv,__webpackgi_exports__uiImage=__webpackgi_exports__.w8l,__webpackgi_exports__uiInput=__webpackgi_exports__.riG,__webpackgi_exports__uiMonitor=__webpackgi_exports__.Kbh,__webpackgi_exports__uiPanel=__webpackgi_exports__.BFq,__webpackgi_exports__uiSlider=__webpackgi_exports__.t8K,__webpackgi_exports__uiToggle=__webpackgi_exports__.Q7n,__webpackgi_exports__uiVector=__webpackgi_exports__.KGF,__webpackgi_exports__uniform=__webpackgi_exports__.e5,__webpackgi_exports__unzip=__webpackgi_exports__.Rik,__webpackgi_exports__unzipSync=__webpackgi_exports__.GZo,__webpackgi_exports__unzlib=__webpackgi_exports__.Bds,__webpackgi_exports__unzlibSync=__webpackgi_exports__.HTu,__webpackgi_exports__uploadFile=__webpackgi_exports__.cTq,__webpackgi_exports__vLinearToRGBM=__webpackgi_exports__.X_Y,__webpackgi_exports__vRGBMToLinear=__webpackgi_exports__.dA8,__webpackgi_exports__valueToUiType=__webpackgi_exports__.NSm,__webpackgi_exports__variationPlacements=__webpackgi_exports__.bwS,__webpackgi_exports__velocityPerFrame=__webpackgi_exports__.Lks,__webpackgi_exports__velocityPerSecond=__webpackgi_exports__.Rvq,__webpackgi_exports__verifyPermission=__webpackgi_exports__.P4F,__webpackgi_exports__viewerGLTFExtension=__webpackgi_exports__.Pd0,__webpackgi_exports__viewport=__webpackgi_exports__.Pjo,__webpackgi_exports__webgiLightExtrasExtension=__webpackgi_exports__.Tum,__webpackgi_exports__webgiMaterialExtrasExtension=__webpackgi_exports__.dRH,__webpackgi_exports__webgiObject3DExtrasExtension=__webpackgi_exports__.RX0,__webpackgi_exports__wrap=__webpackgi_exports__.reQ,__webpackgi_exports__write=__webpackgi_exports__.cWm,__webpackgi_exports__writeFile=__webpackgi_exports__.NC9,__webpackgi_exports__zip=__webpackgi_exports__.$Re,__webpackgi_exports__zipSync=__webpackgi_exports__.Xo9,__webpackgi_exports__zlib=__webpackgi_exports__.LNO,__webpackgi_exports__zlibSync=__webpackgi_exports__.iZP}}]);